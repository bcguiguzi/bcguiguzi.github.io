<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【OpenGL】谢尔宾斯基(Sierpinski)地毯 OpenGL分形（七） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【OpenGL】谢尔宾斯基(Sierpinski)地毯 OpenGL分形（七）" />
<meta property="og:description" content="文章目录 效果展示原理简介大致流程：关键点： 最终代码主函数代码着色器代码包含头文件 效果展示 https://www.bilibili.com/video/BV1Ri4y1g7Gg
阴影效果不是怎么好。
原理简介 大致流程： 使用的是现代OpenGL。
主要思路是首先递归（已改为迭代）生成每个正方体的偏移位置，保存到数组里面。总共迭代了5次，产生了3200000个正方体（每次正方体*20，再迭代一次的话，GPU渲染跟不上）。
然后根据OpenGL多实例渲染的特性，传入刚刚生成的偏移位置到顶点着色器（当然这些数据在代码渲染循环前已经设置为VBO传入到显存了，所以应该是着色器从显存里取）。通过在顶点着色器里面构造平移矩阵，在绘制正方体之前都平移到相应位置。
然后就是光照了，这里用的冯氏光照模型（着色处理在片段着色器）。最终产生该效果。
关键点： 内存解决： 因为VS x86运行最多给2G内存，然后迭代6次的话光存储偏移就用了接近1G的内存，所以并没有在主函数里面计算好模型矩阵后传入，而是直接传入正方体的偏移位置在着色器里面构造平移矩阵。但是这样虽然内存可以支持6次迭代，但是我的GTX1050渲染跟不上。这里产生谢尔宾斯基(Sierpinski)地毯的迭代方法是将一个基本的谢尔宾斯基(Sierpinski)地毯分解为20个正方体（下面一层和上面一层各8个，中间一层4个），即每增加一次迭代都将上一次的谢尔宾斯基(Sierpinski)地毯构造20个。使用了背面剔除，OpenGL中使用顶点绕序(winding order)来确定。所谓绕序就是当几何对象细分为三角形时，三角形顶点相对于中心的定义顺序。左侧的三角形顶点顺序为1-&gt;2-&gt;3,右侧的三角形顶点顺序为1-&gt;2-&gt;3。当观察者在右侧时，则右边的三角形方向为逆时针方向为正面，而左侧的三角形为顺时针则为背面；当观察者转到左侧时，左侧的三角形为逆时针绕序判定为正面，而右侧的三角形为顺时针绕序判定为背面。可以看出正面和背面是由三角形的顶点定义顺序和观察者的观察方向共同决定的，而且随着观察方向的改变，正面和背面将会跟着改变。 最后，talk is cheap, show me the code，我将代码都给出了，然后在关键地方添加了注释！
欢迎大家批判指正，如果有任何优化的地方都欢迎指出！
最终代码 主函数代码 main.cpp #include &lt;iostream&gt; #include &lt;vector&gt; #include &lt;cmath&gt; #define GLEW_STATIC #include &lt;GL/glew.h&gt; #include &lt;GLFW/glfw3.h&gt; #include &lt;glm/glm.hpp&gt; #include &lt;glm/gtc/matrix_transform.hpp&gt; #include &lt;glm/gtc/type_ptr.hpp&gt; #include &#34;Shader.h&#34; #include &#34;Camera.h&#34; bool stop = true; // 空格键 控制是否旋转 const GLfloat sizeCube = 0.1f; // 正方体大小 const int pos[] = { // 20个位置，表示一个谢尔宾斯基(Sierpinski)地毯 0, 0, 0, 0, 1, 0, 0, 2, 0, 1, 0, 0, 2, 0, 0, 1, 2, 0, 2, 1, 0, 2, 2, 0, 0, 0, 1, 0, 2, 1, 2, 0, 1, 2, 2, 1, 0, 0, 2, 0, 1, 2, 0, 2, 2, 1, 0, 2, 2, 0, 2, 1, 2, 2, 2, 1, 2, 2, 2, 2 }; GLfloat vertices[] = { // 正方体局部坐标	法向量（用于光照） // 正方体局部坐标	法向量（用于光照） // Back face -sizeCube, -sizeCube, -sizeCube, 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/513f0c68827d56f9485a1e4658845ed2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-10T09:43:22+08:00" />
<meta property="article:modified_time" content="2020-07-10T09:43:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【OpenGL】谢尔宾斯基(Sierpinski)地毯 OpenGL分形（七）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">效果展示</a></li><li><a href="#_12" rel="nofollow">原理简介</a></li><li><ul><li><a href="#_14" rel="nofollow">大致流程：</a></li><li><a href="#_24" rel="nofollow">关键点：</a></li></ul> 
  </li><li><a href="#_36" rel="nofollow">最终代码</a></li><li><ul><li><a href="#_38" rel="nofollow">主函数代码</a></li><li><a href="#_378" rel="nofollow">着色器代码</a></li><li><a href="#_476" rel="nofollow">包含头文件</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>效果展示</h2> 
<p><a href="https://www.bilibili.com/video/BV1Ri4y1g7Gg" rel="nofollow">https://www.bilibili.com/video/BV1Ri4y1g7Gg</a></p> 
<p><img src="https://images2.imgbox.com/ff/af/wTmYDhUb_o.gif" alt="在这里插入图片描述"></p> 
<p>阴影效果不是怎么好。</p> 
<p><img src="https://images2.imgbox.com/bd/f1/ehb005eu_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="_12"></a>原理简介</h2> 
<h3><a id="_14"></a>大致流程：</h3> 
<p>使用的是现代OpenGL。</p> 
<p>主要思路是首先递归（已改为迭代）生成每个正方体的偏移位置，保存到数组里面。总共迭代了5次，产生了3200000个正方体（每次正方体*20，再迭代一次的话，GPU渲染跟不上）。</p> 
<p>然后根据OpenGL多实例渲染的特性，传入刚刚生成的偏移位置到顶点着色器（当然这些数据在代码渲染循环前已经设置为VBO传入到显存了，所以应该是着色器从显存里取）。通过在顶点着色器里面构造平移矩阵，在绘制正方体之前都平移到相应位置。</p> 
<p>然后就是光照了，这里用的冯氏光照模型（着色处理在片段着色器）。最终产生该效果。</p> 
<h3><a id="_24"></a>关键点：</h3> 
<ul><li>内存解决： 因为VS x86运行最多给2G内存，然后迭代6次的话光存储偏移就用了接近1G的内存，所以并没有在主函数里面计算好模型矩阵后传入，而是直接传入正方体的偏移位置在着色器里面构造平移矩阵。但是这样虽然内存可以支持6次迭代，但是我的GTX1050渲染跟不上。</li><li>这里产生谢尔宾斯基(Sierpinski)地毯的迭代方法是将一个基本的谢尔宾斯基(Sierpinski)地毯分解为20个正方体（下面一层和上面一层各8个，中间一层4个），即每增加一次迭代都将上一次的谢尔宾斯基(Sierpinski)地毯构造20个。</li><li>使用了背面剔除，OpenGL中使用顶点绕序(winding order)来确定。所谓绕序就是当几何对象细分为三角形时，三角形顶点相对于中心的定义顺序。左侧的三角形顶点顺序为1-&gt;2-&gt;3,右侧的三角形顶点顺序为1-&gt;2-&gt;3。当观察者在右侧时，则右边的三角形方向为逆时针方向为正面，而左侧的三角形为顺时针则为背面；当观察者转到左侧时，左侧的三角形为逆时针绕序判定为正面，而右侧的三角形为顺时针绕序判定为背面。可以看出正面和背面是由三角形的顶点定义顺序和观察者的观察方向共同决定的，而且随着观察方向的改变，正面和背面将会跟着改变。</li></ul> 
<p><img src="https://images2.imgbox.com/8b/22/LsQdLNFB_o.png" alt="在这里插入图片描述"></p> 
<p>最后，talk is cheap, show me the code，我将代码都给出了，然后在关键地方添加了注释！</p> 
<p>欢迎大家批判指正，如果有任何优化的地方都欢迎指出！</p> 
<h2><a id="_36"></a>最终代码</h2> 
<h3><a id="_38"></a>主函数代码</h3> 
<ul><li>main.cpp</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> GLEW_STATIC</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;GL/glew.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;GLFW/glfw3.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Shader.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Camera.h"</span></span>

<span class="token keyword">bool</span> stop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 空格键 控制是否旋转</span>
<span class="token keyword">const</span> GLfloat sizeCube <span class="token operator">=</span> <span class="token number">0.1f</span><span class="token punctuation">;</span> <span class="token comment">// 正方体大小</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> pos<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 20个位置，表示一个谢尔宾斯基(Sierpinski)地毯</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>

		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>

		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
GLfloat vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 正方体局部坐标					法向量（用于光照）</span>
	<span class="token comment">// 正方体局部坐标					法向量（用于光照）</span>
	<span class="token comment">// Back face</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
	<span class="token comment">// Front face</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
	<span class="token comment">// Left face</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token comment">// Right face</span>
	 sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 <span class="token comment">// Bottom face</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token comment">// Top face</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	 sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  sizeCube<span class="token punctuation">,</span> <span class="token operator">-</span>sizeCube<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 把递归改成了迭代，step表示当前步数，k表示目标步数
*/</span>
<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>GLfloat<span class="token operator">&gt;</span><span class="token operator">&amp;</span> vec<span class="token punctuation">,</span> <span class="token keyword">int</span> step<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>step <span class="token operator">&lt;</span> k<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> stepLen <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> step<span class="token punctuation">)</span><span class="token punctuation">;</span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>GLfloat<span class="token operator">&gt;</span> temp <span class="token operator">=</span> vec<span class="token punctuation">;</span>
		<span class="token keyword">int</span> len <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">int</span> alphaX <span class="token operator">=</span> pos<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*</span> stepLen<span class="token punctuation">;</span>
			<span class="token keyword">int</span> alphaY <span class="token operator">=</span> pos<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> stepLen<span class="token punctuation">;</span>
			<span class="token keyword">int</span> alphaZ <span class="token operator">=</span> pos<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> stepLen<span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				vec<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span>j <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> alphaX<span class="token punctuation">)</span><span class="token punctuation">;</span>
				vec<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span>j <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> alphaY<span class="token punctuation">)</span><span class="token punctuation">;</span>
				vec<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span>j <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> alphaZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		step<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">key_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> scancode<span class="token punctuation">,</span> <span class="token keyword">int</span> action<span class="token punctuation">,</span> <span class="token keyword">int</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">double</span> xpos<span class="token punctuation">,</span> <span class="token keyword">double</span> ypos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword">double</span> yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">do_movement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Window dimensions</span>
<span class="token keyword">const</span> GLuint WIDTH <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">,</span> HEIGHT <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>

<span class="token comment">// Camera</span>
Camera <span class="token function">camera</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
GLfloat lastX <span class="token operator">=</span> WIDTH <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
GLfloat lastY <span class="token operator">=</span> HEIGHT <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> keys<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

glm<span class="token operator">::</span>vec3 lightPos<span class="token punctuation">;</span>

<span class="token comment">// Deltatime</span>
GLfloat deltaTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>    <span class="token comment">// Time between current frame and last frame</span>
GLfloat lastFrame <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>    <span class="token comment">// Time of last frame</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_PROFILE<span class="token punctuation">,</span> GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_RESIZABLE<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 全屏</span>
	<span class="token comment">/*bool isFullScreen = true;
	GLFWmonitor* pMonitor = isFullScreen ? glfwGetPrimaryMonitor() : NULL;
	GLFWwindow* window = glfwCreateWindow(WIDTH, HEIGHT, "LearnOpenGL", pMonitor, nullptr);*/</span>

	GLFWwindow<span class="token operator">*</span> window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span>WIDTH<span class="token punctuation">,</span> HEIGHT<span class="token punctuation">,</span> <span class="token string">"LearnOpenGL"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">glfwSetKeyCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> key_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwSetCursorPosCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> mouse_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glfwSetScrollCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> scroll_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// GLFW Options</span>
	<span class="token function">glfwSetInputMode</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_CURSOR<span class="token punctuation">,</span> GLFW_CURSOR_DISABLED<span class="token punctuation">)</span><span class="token punctuation">;</span>
	glewExperimental <span class="token operator">=</span> GL_TRUE<span class="token punctuation">;</span>
	<span class="token function">glewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Define the viewport dimensions</span>
	<span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WIDTH<span class="token punctuation">,</span> HEIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// OpenGL options</span>
	<span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 未开启面剔除、好像会影响渲染效果</span>

	Shader <span class="token function">lightingShader</span><span class="token punctuation">(</span><span class="token string">"lighting.vs"</span><span class="token punctuation">,</span> <span class="token string">"lighting.frag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正方体的着色器</span>
	Shader <span class="token function">lampShader</span><span class="token punctuation">(</span><span class="token string">"lamp.vs"</span><span class="token punctuation">,</span> <span class="token string">"lamp.frag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 中心灯的着色器</span>

	<span class="token keyword">const</span> <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 迭代次数</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>GLfloat<span class="token operator">&gt;</span> <span class="token function">vec</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> pos <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始赋值为pos</span>
	vec<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提前计算并分配好空间</span>
	<span class="token function">func</span><span class="token punctuation">(</span>vec<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> item <span class="token operator">:</span> vec<span class="token punctuation">)</span> item <span class="token operator">*</span><span class="token operator">=</span> sizeCube <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 每一项移动为正方体边长比例</span>
	lightPos<span class="token punctuation">.</span>x <span class="token operator">=</span> lightPos<span class="token punctuation">.</span>y <span class="token operator">=</span> lightPos<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token operator">*</span> sizeCube<span class="token punctuation">;</span> <span class="token comment">// 光源位置初始化为中央</span>
	GLuint amount <span class="token operator">=</span> vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 正方体个数</span>
	<span class="token comment">//std::cout &lt;&lt; amount;</span>

	<span class="token comment">// containerVAO 正方体VAO，使用一个顶点坐标和方向量的VBO和一个表示正方体偏移的instanceVBO</span>
	GLuint VBO<span class="token punctuation">,</span> instanceVBO<span class="token punctuation">,</span> containerVAO<span class="token punctuation">;</span>
	<span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>containerVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>containerVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Position attribute</span>
		<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">6</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>GLvoid<span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Normal attribute</span>
		<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">6</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>GLvoid<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>instanceVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> instanceVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vec<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 偏移（用于绘制多个正方体）</span>
		<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>GLvoid<span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一个参数2表示layout索引，第二个参数指定顶点属性的更新方式</span>
		<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// lightVAO 中心光源VAO, 同containerVAO共用VBO</span>
	GLuint lightVAO<span class="token punctuation">;</span>
	<span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>lightVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>lightVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">6</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>GLvoid<span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">glCullFace</span><span class="token punctuation">(</span>GL_BACK<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 设置剔除的面是背面（默认剔除背面）</span>
	<span class="token function">glFrontFace</span><span class="token punctuation">(</span>GL_CW<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 使用顺时针表示正面。clockwise（默认逆时针表示正面）</span>
	<span class="token function">glEnable</span><span class="token punctuation">(</span>GL_CULL_FACE<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 开启面剔除（默认不开启）</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		GLfloat currentFrame <span class="token operator">=</span> <span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		deltaTime <span class="token operator">=</span> currentFrame <span class="token operator">-</span> lastFrame<span class="token punctuation">;</span>
		lastFrame <span class="token operator">=</span> currentFrame<span class="token punctuation">;</span>

		<span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">do_movement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Clear the colorbuffer</span>
		<span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Use cooresponding shader when setting uniforms/drawing objects</span>
		lightingShader<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		GLint objectColorLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>lightingShader<span class="token punctuation">.</span>Program<span class="token punctuation">,</span> <span class="token string">"objectColor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		GLint lightColorLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>lightingShader<span class="token punctuation">.</span>Program<span class="token punctuation">,</span> <span class="token string">"lightColor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		GLint lightPosLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>lightingShader<span class="token punctuation">.</span>Program<span class="token punctuation">,</span> <span class="token string">"lightPos"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		GLint viewPosLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>lightingShader<span class="token punctuation">.</span>Program<span class="token punctuation">,</span> <span class="token string">"viewPos"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glUniform3f</span><span class="token punctuation">(</span>objectColorLoc<span class="token punctuation">,</span> <span class="token number">0.75f</span><span class="token punctuation">,</span> <span class="token number">0.75f</span><span class="token punctuation">,</span> <span class="token number">0.75f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glUniform3f</span><span class="token punctuation">(</span>lightColorLoc<span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glUniform3f</span><span class="token punctuation">(</span>lightPosLoc<span class="token punctuation">,</span> lightPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> lightPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> lightPos<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glUniform3f</span><span class="token punctuation">(</span>viewPosLoc<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>Position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>Position<span class="token punctuation">.</span>y<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>Position<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Create camera transformations</span>
		glm<span class="token operator">::</span>mat4 view <span class="token operator">=</span> camera<span class="token punctuation">.</span><span class="token function">GetViewMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		glm<span class="token operator">::</span>mat4 projection <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">perspective</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>Zoom<span class="token punctuation">,</span> <span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span>WIDTH <span class="token operator">/</span> <span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span>HEIGHT<span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		glm<span class="token operator">::</span>mat4 model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 让正方体旋转</span>
		<span class="token keyword">static</span> <span class="token keyword">float</span> angle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stop<span class="token punctuation">)</span> angle <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">0.1f</span><span class="token punctuation">;</span>
		model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">rotate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> angle<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Get the uniform locations</span>
		GLint modelLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>lightingShader<span class="token punctuation">.</span>Program<span class="token punctuation">,</span> <span class="token string">"model"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		GLint viewLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>lightingShader<span class="token punctuation">.</span>Program<span class="token punctuation">,</span> <span class="token string">"view"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		GLint projLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>lightingShader<span class="token punctuation">.</span>Program<span class="token punctuation">,</span> <span class="token string">"projection"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Pass the matrices to the shader</span>
		<span class="token function">glUniformMatrix4fv</span><span class="token punctuation">(</span>viewLoc<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">value_ptr</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glUniformMatrix4fv</span><span class="token punctuation">(</span>projLoc<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">value_ptr</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glUniformMatrix4fv</span><span class="token punctuation">(</span>modelLoc<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">value_ptr</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Draw the container (using container's vertex attributes)</span>
		<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>containerVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glDrawArraysInstanced</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Also draw the lamp object, again binding the appropriate shader</span>
		lampShader<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">translate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span>lightPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> lightPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> lightPos<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 光源移动到中心</span>
		<span class="token comment">// Get location objects for the matrices on the lamp shader (these could be different on a different shader)</span>
		modelLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>lampShader<span class="token punctuation">.</span>Program<span class="token punctuation">,</span> <span class="token string">"model"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		viewLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>lampShader<span class="token punctuation">.</span>Program<span class="token punctuation">,</span> <span class="token string">"view"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		projLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>lampShader<span class="token punctuation">.</span>Program<span class="token punctuation">,</span> <span class="token string">"projection"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Set matrices</span>
		<span class="token function">glUniformMatrix4fv</span><span class="token punctuation">(</span>viewLoc<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">value_ptr</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glUniformMatrix4fv</span><span class="token punctuation">(</span>projLoc<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">value_ptr</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glUniformMatrix4fv</span><span class="token punctuation">(</span>modelLoc<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">value_ptr</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Draw the light object (using light's vertex attributes)</span>
		<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>lightVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Swap the screen buffers</span>
		<span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Terminate GLFW, clearing any resources allocated by GLFW.</span>
	<span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Is called whenever a key is pressed/released via GLFW</span>
<span class="token keyword">void</span> <span class="token function">key_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> scancode<span class="token punctuation">,</span> <span class="token keyword">int</span> action<span class="token punctuation">,</span> <span class="token keyword">int</span> mode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> GLFW_KEY_ESCAPE <span class="token operator">&amp;&amp;</span> action <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
		<span class="token function">glfwSetWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GL_TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> key <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			keys<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> GLFW_KEY_SPACE<span class="token punctuation">)</span>
				stop <span class="token operator">=</span> <span class="token operator">!</span>stop<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">==</span> GLFW_RELEASE<span class="token punctuation">)</span>
			keys<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">do_movement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// Camera controls</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">[</span>GLFW_KEY_W<span class="token punctuation">]</span><span class="token punctuation">)</span>
		camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>FORWARD<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">[</span>GLFW_KEY_S<span class="token punctuation">]</span><span class="token punctuation">)</span>
		camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>BACKWARD<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">[</span>GLFW_KEY_A<span class="token punctuation">]</span><span class="token punctuation">)</span>
		camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>LEFT<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">[</span>GLFW_KEY_D<span class="token punctuation">]</span><span class="token punctuation">)</span>
		camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>RIGHT<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> firstMouse <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">double</span> xpos<span class="token punctuation">,</span> <span class="token keyword">double</span> ypos<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>firstMouse<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
		lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>
		firstMouse <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	GLfloat xoffset <span class="token operator">=</span> xpos <span class="token operator">-</span> lastX<span class="token punctuation">;</span>
	GLfloat yoffset <span class="token operator">=</span> lastY <span class="token operator">-</span> ypos<span class="token punctuation">;</span>  <span class="token comment">// Reversed since y-coordinates go from bottom to left</span>

	lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
	lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>

	camera<span class="token punctuation">.</span><span class="token function">ProcessMouseMovement</span><span class="token punctuation">(</span>xoffset<span class="token punctuation">,</span> yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword">double</span> yoffset<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	camera<span class="token punctuation">.</span><span class="token function">ProcessMouseScroll</span><span class="token punctuation">(</span>yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_378"></a>着色器代码</h3> 
<ul><li>lighting.vs</li></ul> 
<pre><code class="prism language-c"><span class="token macro property">#version 330 core</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 position<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 normal<span class="token punctuation">;</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> in vec3 pos<span class="token punctuation">;</span> <span class="token comment">// 正方体偏移</span>

out vec3 Normal<span class="token punctuation">;</span>
out vec3 FragPos<span class="token punctuation">;</span>

uniform mat4 model<span class="token punctuation">;</span>
uniform mat4 view<span class="token punctuation">;</span>
uniform mat4 projection<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    mat4 instanceMatrix <span class="token operator">=</span> <span class="token function">mat4</span><span class="token punctuation">(</span> <span class="token comment">// 平移矩阵的构造</span>
            <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
            pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">1.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> model <span class="token operator">*</span> instanceMatrix <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先平移到指定位置，再进行视图变换</span>
    FragPos <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>model <span class="token operator">*</span> instanceMatrix <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 需要顶点位置属性乘以模型矩阵(Model Matrix,只用模型矩阵不需要用观察和投影矩阵)来把它变换到世界空间坐标</span>
    Normal <span class="token operator">=</span> <span class="token function">mat3</span><span class="token punctuation">(</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token function">inverse</span><span class="token punctuation">(</span>model <span class="token operator">*</span> instanceMatrix<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> normal<span class="token punctuation">;</span>  <span class="token comment">// 修复不等比缩放,正规矩阵被定义为“模型矩阵左上角的逆矩阵的转置矩阵”</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>lighting.frag</li></ul> 
<pre><code class="prism language-c"><span class="token macro property">#version 330 core</span>
out vec4 color<span class="token punctuation">;</span>
  
in vec3 Normal<span class="token punctuation">;</span>  
in vec3 FragPos<span class="token punctuation">;</span>  

uniform vec3 lightPos<span class="token punctuation">;</span> 
uniform vec3 viewPos<span class="token punctuation">;</span>
uniform vec3 lightColor<span class="token punctuation">;</span>
uniform vec3 objectColor<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Ambient</span>
    <span class="token keyword">float</span> ambientStrength <span class="token operator">=</span> <span class="token number">0.1f</span><span class="token punctuation">;</span>
    vec3 ambient <span class="token operator">=</span> ambientStrength <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>

    <span class="token comment">// Diffuse </span>
    vec3 norm <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保证自身为单位向量</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>lightPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>norm<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// dot 点乘 为0表示垂直，a1b1+a2b2 第一个向量投影到第二个向量上</span>
    vec3 diffuse <span class="token operator">=</span> diff <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>
    
    <span class="token comment">// Specular</span>
    <span class="token keyword">float</span> specularStrength <span class="token operator">=</span> <span class="token number">0.5f</span><span class="token punctuation">;</span> <span class="token comment">// 镜面强度(Specular Intensity)变量specularStrength，给镜面高光一个中等亮度颜色，这样就不会产生过度的影响了。</span>
    vec3 viewDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>viewPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> norm<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// norm 标准化的法向量</span>
    <span class="token keyword">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 32是高光的发光值(Shininess)。一个物体的发光值越高，反射光的能力越强，散射得越少，高光点越小。</span>
    vec3 specular <span class="token operator">=</span> specularStrength <span class="token operator">*</span> spec <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>
    
    vec3 result <span class="token operator">=</span> <span class="token punctuation">(</span>ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">)</span> <span class="token operator">*</span>  objectColor<span class="token punctuation">;</span> <span class="token comment">// 冯氏光照模型</span>
    color <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre> 
<ul><li>lamp.vs</li></ul> 
<pre><code class="prism language-c"><span class="token macro property">#version 330 core</span>
layout <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 position<span class="token punctuation">;</span>

uniform mat4 model<span class="token punctuation">;</span>
uniform mat4 view<span class="token punctuation">;</span>
uniform mat4 projection<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>lamp.frag</li></ul> 
<pre><code class="prism language-c"><span class="token macro property">#version 330 core</span>
out vec4 color<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    color <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置四维向量的所有元素为 1.0f</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_476"></a>包含头文件</h3> 
<ul><li>Shader.h</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> SHADER_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> SHADER_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;GL/glew.h&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">Shader</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    GLuint Program<span class="token punctuation">;</span>

    <span class="token comment">// Constructor generates the shader on the fly</span>
    <span class="token function">Shader</span><span class="token punctuation">(</span><span class="token keyword">const</span> GLchar<span class="token operator">*</span> vertexPath<span class="token punctuation">,</span> <span class="token keyword">const</span> GLchar<span class="token operator">*</span> fragmentPath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. Retrieve the vertex/fragment source code from filePath</span>
        std<span class="token operator">::</span>string vertexCode<span class="token punctuation">;</span>
        std<span class="token operator">::</span>string fragmentCode<span class="token punctuation">;</span>
        std<span class="token operator">::</span>ifstream vShaderFile<span class="token punctuation">;</span>
        std<span class="token operator">::</span>ifstream fShaderFile<span class="token punctuation">;</span>
        <span class="token comment">// ensures ifstream objects can throw exceptions:</span>
        vShaderFile<span class="token punctuation">.</span><span class="token function">exceptions</span><span class="token punctuation">(</span>std<span class="token operator">::</span>ifstream<span class="token operator">::</span>badbit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fShaderFile<span class="token punctuation">.</span><span class="token function">exceptions</span><span class="token punctuation">(</span>std<span class="token operator">::</span>ifstream<span class="token operator">::</span>badbit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Open files</span>
            vShaderFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>vertexPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fShaderFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>fragmentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token operator">::</span>stringstream vShaderStream<span class="token punctuation">,</span> fShaderStream<span class="token punctuation">;</span>
            <span class="token comment">// Read file's buffer contents into streams</span>
            vShaderStream <span class="token operator">&lt;&lt;</span> vShaderFile<span class="token punctuation">.</span><span class="token function">rdbuf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fShaderStream <span class="token operator">&lt;&lt;</span> fShaderFile<span class="token punctuation">.</span><span class="token function">rdbuf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// close file handlers</span>
            vShaderFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fShaderFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Convert stream into string</span>
            vertexCode <span class="token operator">=</span> vShaderStream<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fragmentCode <span class="token operator">=</span> fShaderStream<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>ifstream<span class="token operator">::</span>failure e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::SHADER::FILE_NOT_SUCCESFULLY_READ"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> GLchar<span class="token operator">*</span> vShaderCode <span class="token operator">=</span> vertexCode<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> GLchar<span class="token operator">*</span> fShaderCode <span class="token operator">=</span> fragmentCode<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. Compile shaders</span>
        GLuint vertex<span class="token punctuation">,</span> fragment<span class="token punctuation">;</span>
        GLint success<span class="token punctuation">;</span>
        GLchar infoLog<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// Vertex Shader</span>
        vertex <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glShaderSource</span><span class="token punctuation">(</span>vertex<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vShaderCode<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glCompileShader</span><span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Print compile errors if any</span>
        <span class="token function">glGetShaderiv</span><span class="token punctuation">(</span>vertex<span class="token punctuation">,</span> GL_COMPILE_STATUS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">glGetShaderInfoLog</span><span class="token punctuation">(</span>vertex<span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> infoLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::SHADER::VERTEX::COMPILATION_FAILED\n"</span> <span class="token operator">&lt;&lt;</span> infoLog <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Fragment Shader</span>
        fragment <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_FRAGMENT_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glShaderSource</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fShaderCode<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glCompileShader</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Print compile errors if any</span>
        <span class="token function">glGetShaderiv</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span> GL_COMPILE_STATUS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">glGetShaderInfoLog</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> infoLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::SHADER::FRAGMENT::COMPILATION_FAILED\n"</span> <span class="token operator">&lt;&lt;</span> infoLog <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Shader Program</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>Program <span class="token operator">=</span> <span class="token function">glCreateProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glAttachShader</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>Program<span class="token punctuation">,</span> vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glAttachShader</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>Program<span class="token punctuation">,</span> fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glLinkProgram</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>Program<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Print linking errors if any</span>
        <span class="token function">glGetProgramiv</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>Program<span class="token punctuation">,</span> GL_LINK_STATUS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">glGetProgramInfoLog</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>Program<span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> infoLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::SHADER::PROGRAM::LINKING_FAILED\n"</span> <span class="token operator">&lt;&lt;</span> infoLog <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Delete the shaders as they're linked into our program now and no longer necessery</span>
        <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">// Uses the current shader</span>
    <span class="token keyword">void</span> <span class="token function">Use</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">glUseProgram</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>Program<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</code></pre> 
<ul><li>Camera.h</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> CAMERA_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CAMERA_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token comment">// Defines several possible options for camera movement. Used as abstraction to stay away from window-system specific input methods</span>
<span class="token keyword">enum</span> Camera_Movement <span class="token punctuation">{<!-- --></span>
    FORWARD<span class="token punctuation">,</span>
    BACKWARD<span class="token punctuation">,</span>
    LEFT<span class="token punctuation">,</span>
    RIGHT
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Default camera values</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> YAW <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">90.0f</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> PITCH <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> SPEED <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> SENSITIVITY <span class="token operator">=</span> <span class="token number">0.1f</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> ZOOM <span class="token operator">=</span> <span class="token number">45.0f</span><span class="token punctuation">;</span>


<span class="token comment">// An abstract camera class that processes input and calculates the corresponding Euler Angles, Vectors and Matrices for use in OpenGL</span>
<span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">// Camera Attributes</span>
    glm<span class="token operator">::</span>vec3 Position<span class="token punctuation">;</span>
    glm<span class="token operator">::</span>vec3 Front<span class="token punctuation">;</span>
    glm<span class="token operator">::</span>vec3 Up<span class="token punctuation">;</span>
    glm<span class="token operator">::</span>vec3 Right<span class="token punctuation">;</span>
    glm<span class="token operator">::</span>vec3 WorldUp<span class="token punctuation">;</span>
    <span class="token comment">// Euler Angles</span>
    <span class="token keyword">float</span> Yaw<span class="token punctuation">;</span>
    <span class="token keyword">float</span> Pitch<span class="token punctuation">;</span>
    <span class="token comment">// Camera options</span>
    <span class="token keyword">float</span> MovementSpeed<span class="token punctuation">;</span>
    <span class="token keyword">float</span> MouseSensitivity<span class="token punctuation">;</span>
    <span class="token keyword">float</span> Zoom<span class="token punctuation">;</span>

    <span class="token comment">// Constructor with vectors</span>
    <span class="token function">Camera</span><span class="token punctuation">(</span>glm<span class="token operator">::</span>vec3 position <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span>vec3 up <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">float</span> yaw <span class="token operator">=</span> YAW<span class="token punctuation">,</span> <span class="token keyword">float</span> pitch <span class="token operator">=</span> PITCH<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Front</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MovementSpeed</span><span class="token punctuation">(</span>SPEED<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MouseSensitivity</span><span class="token punctuation">(</span>SENSITIVITY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Zoom</span><span class="token punctuation">(</span>ZOOM<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Position <span class="token operator">=</span> position<span class="token punctuation">;</span>
        WorldUp <span class="token operator">=</span> up<span class="token punctuation">;</span>
        Yaw <span class="token operator">=</span> yaw<span class="token punctuation">;</span>
        Pitch <span class="token operator">=</span> pitch<span class="token punctuation">;</span>
        <span class="token function">updateCameraVectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Constructor with scalar values</span>
    <span class="token function">Camera</span><span class="token punctuation">(</span><span class="token keyword">float</span> posX<span class="token punctuation">,</span> <span class="token keyword">float</span> posY<span class="token punctuation">,</span> <span class="token keyword">float</span> posZ<span class="token punctuation">,</span> <span class="token keyword">float</span> upX<span class="token punctuation">,</span> <span class="token keyword">float</span> upY<span class="token punctuation">,</span> <span class="token keyword">float</span> upZ<span class="token punctuation">,</span> <span class="token keyword">float</span> yaw<span class="token punctuation">,</span> <span class="token keyword">float</span> pitch<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Front</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MovementSpeed</span><span class="token punctuation">(</span>SPEED<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MouseSensitivity</span><span class="token punctuation">(</span>SENSITIVITY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Zoom</span><span class="token punctuation">(</span>ZOOM<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Position <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span>posX<span class="token punctuation">,</span> posY<span class="token punctuation">,</span> posZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
        WorldUp <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span>upX<span class="token punctuation">,</span> upY<span class="token punctuation">,</span> upZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Yaw <span class="token operator">=</span> yaw<span class="token punctuation">;</span>
        Pitch <span class="token operator">=</span> pitch<span class="token punctuation">;</span>
        <span class="token function">updateCameraVectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Returns the view matrix calculated using Euler Angles and the LookAt Matrix</span>
    glm<span class="token operator">::</span>mat4 <span class="token function">GetViewMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>Position<span class="token punctuation">,</span> Position <span class="token operator">+</span> Front<span class="token punctuation">,</span> Up<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Processes input received from any keyboard-like input system. Accepts input parameter in the form of camera defined ENUM (to abstract it from windowing systems)</span>
    <span class="token keyword">void</span> <span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>Camera_Movement direction<span class="token punctuation">,</span> <span class="token keyword">float</span> deltaTime<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">float</span> velocity <span class="token operator">=</span> MovementSpeed <span class="token operator">*</span> deltaTime<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> FORWARD<span class="token punctuation">)</span>
            Position <span class="token operator">+</span><span class="token operator">=</span> Front <span class="token operator">*</span> velocity<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> BACKWARD<span class="token punctuation">)</span>
            Position <span class="token operator">-</span><span class="token operator">=</span> Front <span class="token operator">*</span> velocity<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> LEFT<span class="token punctuation">)</span>
            Position <span class="token operator">-</span><span class="token operator">=</span> Right <span class="token operator">*</span> velocity<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> RIGHT<span class="token punctuation">)</span>
            Position <span class="token operator">+</span><span class="token operator">=</span> Right <span class="token operator">*</span> velocity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Processes input received from a mouse input system. Expects the offset value in both the x and y direction.</span>
    <span class="token keyword">void</span> <span class="token function">ProcessMouseMovement</span><span class="token punctuation">(</span><span class="token keyword">float</span> xoffset<span class="token punctuation">,</span> <span class="token keyword">float</span> yoffset<span class="token punctuation">,</span> GLboolean constrainPitch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        xoffset <span class="token operator">*</span><span class="token operator">=</span> MouseSensitivity<span class="token punctuation">;</span>
        yoffset <span class="token operator">*</span><span class="token operator">=</span> MouseSensitivity<span class="token punctuation">;</span>

        Yaw <span class="token operator">+</span><span class="token operator">=</span> xoffset<span class="token punctuation">;</span>
        Pitch <span class="token operator">+</span><span class="token operator">=</span> yoffset<span class="token punctuation">;</span>

        <span class="token comment">// Make sure that when pitch is out of bounds, screen doesn't get flipped</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>constrainPitch<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Pitch <span class="token operator">&gt;</span> <span class="token number">89.0f</span><span class="token punctuation">)</span>
                Pitch <span class="token operator">=</span> <span class="token number">89.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Pitch <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">89.0f</span><span class="token punctuation">)</span>
                Pitch <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">89.0f</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Update Front, Right and Up Vectors using the updated Euler angles</span>
        <span class="token function">updateCameraVectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Processes input received from a mouse scroll-wheel event. Only requires input on the vertical wheel-axis</span>
    <span class="token keyword">void</span> <span class="token function">ProcessMouseScroll</span><span class="token punctuation">(</span><span class="token keyword">float</span> yoffset<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Zoom <span class="token operator">&gt;=</span> <span class="token number">1.0f</span> <span class="token operator">&amp;&amp;</span> Zoom <span class="token operator">&lt;=</span> <span class="token number">45.0f</span><span class="token punctuation">)</span>
            Zoom <span class="token operator">-</span><span class="token operator">=</span> yoffset<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Zoom <span class="token operator">&lt;=</span> <span class="token number">1.0f</span><span class="token punctuation">)</span>
            Zoom <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Zoom <span class="token operator">&gt;=</span> <span class="token number">45.0f</span><span class="token punctuation">)</span>
            Zoom <span class="token operator">=</span> <span class="token number">45.0f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Calculates the front vector from the Camera's (updated) Euler Angles</span>
    <span class="token keyword">void</span> <span class="token function">updateCameraVectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Calculate the new Front vector</span>
        glm<span class="token operator">::</span>vec3 front<span class="token punctuation">;</span>
        front<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>Yaw<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>Pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        front<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>Pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        front<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>Yaw<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>Pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Front <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>front<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Also re-calculate the Right and Up vector</span>
        Right <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">cross</span><span class="token punctuation">(</span>Front<span class="token punctuation">,</span> WorldUp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Normalize the vectors, because their length gets closer to 0 the more you look up or down which results in slower movement.</span>
        Up <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">cross</span><span class="token punctuation">(</span>Right<span class="token punctuation">,</span> Front<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9929f8d28f09389fe1e0ba093dea833a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机网络期末习题个人解法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e02a3399c8eb7828f74ee79dec534e96/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解递归式方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>