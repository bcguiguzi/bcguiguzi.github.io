<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>bond简单入门 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="bond简单入门" />
<meta property="og:description" content="一，bond概念 Bond（也被称为链路聚合、端口绑定或接口绑定）是一种网络技术，用于将多个物理网络接口（如以太网接口）组合成一个逻辑接口。这样做的目的是增加带宽、提高网络性能、实现负载均衡和冗余备份。
通过使用 Bond 技术，可以将多个网络接口绑定在一起，形成一个虚拟的逻辑接口。当数据包通过该逻辑接口传输时，它们会通过内部算法（如哈希函数）分发到每个物理接口上，实现负载均衡。这样可以充分利用每个物理接口的带宽，提高整体网络吞吐量。
另外，Bond 还提供了故障切换和冗余备份的功能。如果其中一个物理接口发生故障或不可用，数据包会自动切换到其他可用的接口上，确保网络的可靠性和连通性。
Bond 技术在服务器和网络设备中广泛应用，特别是在需要高带宽和可靠性的环境中，如数据中心、负载均衡器、集群服务器等。它可以提供更高的网络性能、冗余备份和容错能力，从而提高网络的可靠性和性能。
二，bond模式 在网络中，Bond（或被称为链路聚合、端口绑定）是一种技术，用于将多个物理网络接口（例如以太网接口）捆绑在一起形成一个逻辑接口。这样做可以提高网络带宽和冗余性，并实现负载均衡。
Bond 接口支持不同的模式，常见的有以下几种：
Mode 0 - Round Robin（轮询模式）：数据包按顺序发送到每个物理接口，实现负载均衡，但不支持接收负载均衡。
Mode 1 - Active-Backup（主备模式）：只有一个物理接口处于活动状态，其他接口作为备份。如果活动接口失效，备份接口会自动接管。
Mode 2 - XOR（异或模式）：通过对源和目标 MAC 地址进行异或操作，决定数据包发送到哪个物理接口。该模式支持负载均衡，但不支持接收负载均衡。
Mode 3 - Broadcast（广播模式）：数据包同时发送到所有物理接口。使用该模式时要注意避免网络环路。
Mode 4 - 802.3ad（IEEE 802.3ad 静态链接聚合）：使用 LACP（Link Aggregation Control Protocol）协商的动态链路聚合模式，通过链路状态进行负载均衡和故障切换。
Mode 5 - Balance-TLB（负载平衡-备用模式）：负载平衡和故障切换是通过网络流的传输层信息实现的。
Mode 6 - Balance-ALB（负载平衡模式）：同时使用了平衡-备用和平衡-TLB 模式，并尝试将数据包在网络上的所有接口之间分布。
在配置 Bond 接口时，可以选择适合特定需求的模式。不同的模式具有不同的优势和适用场景
三，bond配置 实现 Bond 接口的配置，需要按照以下步骤进行：
打开配置文件：打开 /etc/sysconfig/network-scripts/ 目录下的网络配置文件，找到对应的物理接口配置文件，例如 ifcfg-eth0。
复制文件并重命名：复制该文件，并将新文件命名为 ifcfg-bond0（其中 bond0 为自定义的 Bond 接口名称）。
编辑文件：用编辑器打开 ifcfg-bond0 文件，修改以下设置：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/8c6c1d53290c86dd6acb9fbdfd01dc17/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-18T16:40:33+08:00" />
<meta property="article:modified_time" content="2023-09-18T16:40:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">bond简单入门</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2></h2> 
<h3>一，bond概念</h3> 
<p>Bond（也被称为链路聚合、端口绑定或接口绑定）是一种网络技术，用于将多个物理网络接口（如以太网接口）组合成一个逻辑接口。这样做的目的是增加带宽、提高网络性能、实现负载均衡和冗余备份。</p> 
<p>通过使用 Bond 技术，可以将多个网络接口绑定在一起，形成一个虚拟的逻辑接口。当数据包通过该逻辑接口传输时，它们会通过内部算法（如哈希函数）分发到每个物理接口上，实现负载均衡。这样可以充分利用每个物理接口的带宽，提高整体网络吞吐量。</p> 
<p>另外，Bond 还提供了故障切换和冗余备份的功能。如果其中一个物理接口发生故障或不可用，数据包会自动切换到其他可用的接口上，确保网络的可靠性和连通性。</p> 
<p>Bond 技术在服务器和网络设备中广泛应用，特别是在需要高带宽和可靠性的环境中，如数据中心、负载均衡器、集群服务器等。它可以提供更高的网络性能、冗余备份和容错能力，从而提高网络的可靠性和性能。</p> 
<h3>二，bond模式</h3> 
<p>在网络中，Bond（或被称为链路聚合、端口绑定）是一种技术，用于将多个物理网络接口（例如以太网接口）捆绑在一起形成一个逻辑接口。这样做可以提高网络带宽和冗余性，并实现负载均衡。</p> 
<p>Bond 接口支持不同的模式，常见的有以下几种：</p> 
<ol><li> <p>Mode 0 - Round Robin（轮询模式）：数据包按顺序发送到每个物理接口，实现负载均衡，但不支持接收负载均衡。</p> </li><li> <p>Mode 1 - Active-Backup（主备模式）：只有一个物理接口处于活动状态，其他接口作为备份。如果活动接口失效，备份接口会自动接管。</p> </li><li> <p>Mode 2 - XOR（异或模式）：通过对源和目标 MAC 地址进行异或操作，决定数据包发送到哪个物理接口。该模式支持负载均衡，但不支持接收负载均衡。</p> </li><li> <p>Mode 3 - Broadcast（广播模式）：数据包同时发送到所有物理接口。使用该模式时要注意避免网络环路。</p> </li><li> <p>Mode 4 - 802.3ad（IEEE 802.3ad 静态链接聚合）：使用 LACP（Link Aggregation Control Protocol）协商的动态链路聚合模式，通过链路状态进行负载均衡和故障切换。</p> </li><li> <p>Mode 5 - Balance-TLB（负载平衡-备用模式）：负载平衡和故障切换是通过网络流的传输层信息实现的。</p> </li><li> <p>Mode 6 - Balance-ALB（负载平衡模式）：同时使用了平衡-备用和平衡-TLB 模式，并尝试将数据包在网络上的所有接口之间分布。</p> </li></ol> 
<p>在配置 Bond 接口时，可以选择适合特定需求的模式。不同的模式具有不同的优势和适用场景</p> 
<h3>三，bond配置</h3> 
<p>实现 Bond 接口的配置，需要按照以下步骤进行：</p> 
<ol><li> <p>打开配置文件：打开 <code>/etc/sysconfig/network-scripts/</code> 目录下的网络配置文件，找到对应的物理接口配置文件，例如 <code>ifcfg-eth0</code>。</p> </li><li> <p>复制文件并重命名：复制该文件，并将新文件命名为 <code>ifcfg-bond0</code>（其中 <code>bond0</code> 为自定义的 Bond 接口名称）。</p> </li><li> <p>编辑文件：用编辑器打开 <code>ifcfg-bond0</code> 文件，修改以下设置：</p> 
  <ul><li> <p><code>TYPE=Bond</code>：指定该接口类型为 Bond 接口。</p> </li><li> <p><code>BONDING_OPTS=</code>：在此设置 <code>Bond</code> 参数，包括链路监控、负载均衡模式等。</p> </li><li> <p><code>ONBOOT=yes</code>：指定系统启动时自动启用该网络接口。</p> </li></ul></li><li> <p>配置物理接口：将所有物理接口，例如 <code>eth0</code>、<code>eth1</code> 等，与 <code>bond0</code> 接口进行绑定。打开对应的物理接口配置文件，例如 <code>ifcfg-eth0</code>，并修改以下设置：</p> 
  <ul><li> <p><code>MASTER=bond0</code>：指定该接口所属的 Bond 接口为 <code>bond0</code>。</p> </li><li> <p><code>SLAVE=yes</code>：指定该接口为 Bond 接口的从属接口。</p> </li></ul></li><li> <p>保存文件：保存文件并退出编辑器。</p> </li><li> <p>重启网络服务：使用 <code>systemctl restart network</code> 命令重启网络服务，使配置生效。</p> </li></ol> 
<p>以上是配置 Bond 接口的基本步骤，需要针对实际情况进行调整。在选择负载均衡模式时，可以根据实际需求考虑使用哪种模式。在配置完成后，可以使用 <code>ifconfig</code> 命令查看接口状态，确认 Bond 接口已经成功绑定了所有物理接口。</p> 
<h3>四，bond参数 （对标BONDING_OPTS=）</h3> 
<p>在使用 Bond 技术时，可以使用一些参数来配置 Bond 接口。这些参数通常称为 Bonding 参数，主要包括以下几个方面：</p> 
<ol><li> <p>Mode （负载均衡模式）：指定数据包的负载均衡方式，可选值包括 Round-robin、Active-backup、Balance-xor、Broadcast、802.3ad（LACP）、Balance-tlb 以及 Balance-alb。</p> </li><li> <p>Miimon （链路监控间隔）：指定链路状态监测的时间间隔，默认为 100 毫秒。若设为0，则无链路监测。</p> </li><li> <p>Lacp_rate （LACP 协议速率）：指定 Link Aggregation Control Protocol (LACP) 的协商速率，可选值包括 Slow 和 Fast。</p> </li><li> <p>Ad_select（从属接口选择）：指定如何选择从属接口，可选的值包括 stable、bandwidth 和 count。</p> </li><li> <p>Xmit_hash_policy（哈希算法策略）：用于分配传输负载的哈希策略，主要包括 layer2、layer3+4、encap2、encap3+4 等。</p> </li><li> <p>Primary（首选从属接口）：指定首选使用的从属接口，即当所有从属接口中有多个可用时，优先使用的从属接口。</p> </li><li> <p>Fail_over_mac（故障转移 MAC 地址）：指定故障转移时使用的 MAC 地址。</p> </li></ol> 
<p>这些参数的具体使用方式和取值范围可能因不同的系统、环境和需求而有所不同，需要按照实际情况进行设置和调整。</p> 
<h3>五，标准bond文件示例</h3> 
<p>在 Linux 系统中，Bond 的配置通常存储在 <code>/etc/sysconfig/network-scripts/</code> 目录下的 ifcfg-bondX 文件中（其中 X 是 Bond 接口的编号）。以下是一个示例的标准 Bond 配置文件：</p> 
<blockquote> 
 <pre>DEVICE=bondX
NAME=bondX
TYPE=Bond
BONDING_MASTER=yes
BOOTPROTO=none
ONBOOT=yes
IPADDR=&lt;IP 地址&gt;
NETMASK=&lt;子网掩码&gt;
GATEWAY=&lt;网关地址&gt;
BONDING_OPTS="mode=&lt;负载均衡模式&gt; miimon=&lt;链路监控间隔&gt;"</pre> 
</blockquote> 
<p>其中，要根据实际情况进行替换的部分有：</p> 
<ul><li> <p><code>bondX</code>：Bond 接口的名称，可以根据需要进行命名，通常是 <code>bond0</code>、<code>bond1</code> 等。</p> </li><li> <p><code>&lt;IP 地址&gt;</code>：指定为 Bond 接口配置的 IP 地址。</p> </li><li> <p><code>&lt;子网掩码&gt;</code>：指定与 IP 地址相关联的子网掩码。</p> </li><li> <p><code>&lt;网关地址&gt;</code>：指定用于出站流量的网关地址。</p> </li><li> <p><code>&lt;负载均衡模式&gt;</code>：指定 Bond 接口的负载均衡模式，如 Round-robin、Active-backup、Balance-xor 等。</p> </li><li> <p><code>&lt;链路监控间隔&gt;</code>：指定链路监控的时间间隔。</p> </li></ul> 
<p>其他参数如果需要自定义设置，也可以在 <code>BONDING_OPTS</code> 中添加。请注意，以上仅为示例配置文件，实际配置可能因操作系统版本、网络环境和需求而有所不同，请根据实际情况进行适配和调整。</p> 
<p>在创建或修改完 Bond 配置文件后，需要重启网络服务或执行 <code>ifup bondX</code> 命令来应用配置。</p> 
<h3>六，bond配置检查</h3> 
<p>要检查 Bond 配置是否正确，可以按照以下步骤进行：</p> 
<ol><li> <p>确认 Bond 接口是否已经创建：使用命令 <code>ifconfig</code> 或 <code>ip addr show</code> 查看系统中已有的网络接口列表，确认是否存在名为 <code>bondX</code> 的接口（其中 X 为 Bond 接口的编号）。</p> </li><li> <p>检查 Bond 配置文件：在 Linux 系统中，Bond 的配置文件一般存储在 <code>/etc/sysconfig/network-scripts/</code> 目录下的 ifcfg-bondX 文件中。使用文本编辑器打开相应的文件（如 ifcfg-bond0），确保配置项的格式和内容正确。特别需要注意的是，确保配置项 <code>BONDING_MASTER</code> 设置为 <code>yes</code>，并且 <code>TYPE</code> 设置为 <code>Bond</code>。</p> </li><li> <p>确认 IP 地址、子网掩码和网关地址：检查 Bond 配置文件中的 <code>IPADDR</code>、<code>NETMASK</code> 和 <code>GATEWAY</code> 是否正确设置为所需的值。确保与网络环境匹配。</p> </li><li> <p>检查负载均衡模式和其他参数：检查 Bond 配置文件中的 <code>BONDING_OPTS</code> 是否正确设置了负载均衡模式（<code>mode</code>）和其他必要的参数。确保与预期的配置一致。</p> </li><li> <p>应用配置：保存并退出 Bond 配置文件后，重新启动网络服务或执行 <code>ifup bondX</code> 命令来应用新的配置。检查命令执行结果是否显示 Bond 接口已成功激活，并且没有错误信息提示。</p> </li><li> <p>验证网络连接：使用命令 <code>ifconfig</code> 或 <code>ip addr show</code> 检查 Bond 接口是否已经获得正确的 IP 地址、子网掩码和网关地址。尝试使用 Bond 接口进行网络通信，例如通过 ping 命令测试与其他主机的连通性。</p> </li></ol> 
<p>通过以上步骤，您可以检查并验证 Bond 配置是否正确。请注意，在调整和测试网络配置时，确保对系统做好适当的备份，并确保在生产环境中进行的更改是安全和可接受的。</p> 
<p><strong>拓展：</strong></p> 
<p><code>ethtool</code> 是一个常用的命令行工具，用于配置和查询网络接口的参数和统计信息。它可以帮助您获取关于以太网接口的详细信息，并对其进行配置。以下是一些常见的 <code>ethtool</code> 命令用法：</p> 
<ol><li> <p>查看接口信息：使用 <code>ethtool &lt;接口名&gt;</code> 命令来查看指定接口的详细信息。例如，要查看 eth0 接口的信息，可以执行：</p> 
  <blockquote> 
   <pre>ethtool eth0</pre> 
  </blockquote> </li><li> <p>查看接口速度和双工模式：使用 <code>-s</code> 选项来查看接口的当前速度和双工模式。例如：</p> 
  <blockquote> 
   <pre>ethtool -s eth0</pre> 
  </blockquote> </li><li> <p>修改接口速度和双工模式：使用 <code>-s</code> 选项结合速度和双工模式参数来修改接口的配置。例如，将 eth0 接口设置为 100 Mbps、全双工模式，可以执行：</p> 
  <blockquote> 
   <pre>ethtool -s eth0 speed 100 duplex full</pre> 
  </blockquote> </li><li> <p>查看接口统计信息：使用 <code>-S</code> 选项来获取接口的统计信息。例如：</p> 
  <blockquote> 
   <pre>ethtool -S eth0</pre> 
  </blockquote> </li><li> <p>打开或关闭接口的功能：使用 <code>-K</code> 选项结合功能参数来启用或禁用接口的特定功能。例如，要启用 eth0 接口的 TSO（TCP Segmentation Offload）功能，可以执行：</p> 
  <blockquote> 
   <pre>ethtool -K eth0 tso on</pre> 
  </blockquote> </li></ol> 
<p>这只是 <code>ethtool</code> 命令的一些基本用法示例，还有其他选项和参数可以根据需求进行使用。您可以通过 <code>ethtool --help</code> 命令或参考 <code>ethtool</code> 的手册页来获取更详细的帮助信息。请注意，使用 <code>ethtool</code> 修改网络接口的配置通常需要 root 权限</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd5e28e38c2246bf3d91251db2d3e3df/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【纯新手向】手把手带你使用模板创建第一个鸿蒙端云一体化元服务</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/77cc90066646431ea362312516e62a2f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">接入OnlyOffice，支持在线协同编辑Office文档，可私有化部署的企业知识库 zyplayer-doc 2.2.1 发布</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>