<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue项目中的deepClone - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue项目中的deepClone" />
<meta property="og:description" content="因为涉及到组件传值和表单双向绑定问题，要将后端返回的数据从value渲染为对应的text，免不了修改原数据，原数据就算赋值给别的变量，其内存地址还是一致，那样一旦在js中修改其中任意一项，提交时会造成返回和提交的数据格式不一致,从而出现修改和详情弹窗的各种bug，为了渲染正确的下拉框和树形结构绑定的数据，于是在项目中使用了深拷贝...
错误示范：
editrow(val) { this.editFormData = {}; this.editFormData = val; this.editDialogVisible.show = true; this.editFormData.data=123; //此时val中对应的数据也会改变！ } deepClone
export default function deepClone(target){ // 定义一个变量 let result; // 如果当前需要深拷贝的是一个对象的话 if (typeof target === &#34;object&#34;) { // 如果是一个数组的话 if (Array.isArray(target)) { result = []; // 将result赋值为一个数组，并且执行遍历 for (let i in target) { // 递归克隆数组中的每一项 result.push(deepClone(target[i])); } // 判断如果当前的值是null的话；直接赋值为null } else if (target === null) { result = null; // 判断如果当前的值是一个RegExp对象的话，直接赋值 } else if (target." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/a778c756babbe9af89989369056c24aa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-07T18:04:13+08:00" />
<meta property="article:modified_time" content="2022-05-07T18:04:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue项目中的deepClone</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p>  因为涉及到组件传值和表单双向绑定问题，要将后端返回的数据从value渲染为对应的text，免不了修改原数据，<strong>原数据就算赋值给别的变量，其内存地址还是一致，</strong>那样一旦在js中修改其中任意一项，提交时会造成返回和提交的数据格式不一致,从而出现修改和详情弹窗的各种bug，为了渲染正确的下拉框和树形结构绑定的数据，于是在项目中使用了深拷贝...</p> 
<p></p> 
<p>错误示范：</p> 
<pre><code class="language-javascript">editrow(val) {
   this.editFormData = {};
   this.editFormData = val;
   this.editDialogVisible.show = true;
   this.editFormData.data=123;  //此时val中对应的数据也会改变！
}
</code></pre> 
<p><strong>deepClone</strong></p> 
<pre><code class="language-javascript">export default function deepClone(target){
       // 定义一个变量
       let result;
       // 如果当前需要深拷贝的是一个对象的话
       if (typeof target === "object") {
         // 如果是一个数组的话
         if (Array.isArray(target)) {
           result = []; // 将result赋值为一个数组，并且执行遍历
           for (let i in target) {
             // 递归克隆数组中的每一项
             result.push(deepClone(target[i]));
           }
           // 判断如果当前的值是null的话；直接赋值为null
         } else if (target === null) {
           result = null;
           // 判断如果当前的值是一个RegExp对象的话，直接赋值
         } else if (target.constructor === RegExp) {
           result = target;
         } else {
           // 否则是普通对象，直接for in循环，递归赋值对象的所有值
           result = {};
           for (let i in target) {
             result[i] = deepClone(target[i]);
           }
         }
         // 如果不是对象的话，就是基本数据类型，那么直接赋值
       } else {
         result = target;
       }
       // 返回最终结果
    return result;
}</code></pre> 
<p>每次编辑或查看详情的时候深拷贝一份数据，修改拷贝后的数据，不会造成一些意外的bug</p> 
<pre><code class="language-javascript">import deepClone from "../../../utils/deepClone";

 editrow(val) {
      let data = deepClone(val);
      this.editFormData = {};
      this.isEdit = true;
      let tempArr = data.roleList.map((item) =&gt; {
        return item.id;
      });
      this.editFormData = data;
      this.editFormData.roleList = tempArr;

      this.viewFormItems[0].props.list[0].children.forEach((item, index) =&gt; {
        if (this.editFormData.companyName == item.label) { 
          this.editFormData.organizationId = item.id;
          this.editFormData.mark = item.parentId;
        }
      });
      this.editDialogVisible.show = true;
    },


    detailrow(val) {
      let data = deepClone(val);
      this.detailFormData = data;
      let temp = this.detailFormData.roleList.map((item) =&gt; {
        return item.roleName;
      });
      let tempValue = "";
      temp.forEach((item) =&gt; {
        tempValue += item + " ";
      });
      this.detailFormData.roleList = tempValue;
      this.detailDialogVisible.show = true;
    },</code></pre> 
<p>   这样提交修改时便会少很多bug~</p> 
<pre><code class="language-javascript"> handleEditSubmit(val) {
      this.editDialogVisible.show = false;
      if (val != null &amp;&amp; val.id != null) {
        this.editFormData.mark = val.parentId;
        this.editFormData.organizationId = val.serveID;
      } else this.editFormData.organizationId = this.editFormData.companyId;
      var paramData = JSON.parse(
        JSON.stringify(this.editFormData).replace(/roleList/g, "roleIdList")
      );
      var that = this;
      request({
        url: "/api-user/usergroup/update",
        method: "put",
        data: paramData,
      })
        .then((res) =&gt; {
           that.handleRequestData();
            })
      
    }
}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7595d9d588cba2f03056ea9f28048d65/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JWT简介与使用（安卓注意事项）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0d1d3bbbbaa051ea8947e8ee49ea548d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">学习笔记12-SG90舵机</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>