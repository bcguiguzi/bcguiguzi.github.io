<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apache RocketMQ之集成RocketMQ_MQTT 安装部署协议 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apache RocketMQ之集成RocketMQ_MQTT 安装部署协议" />
<meta property="og:description" content="Apache RocketMQ 安装说明
安装步骤 参考快速开始
https://rocketmq.apache.org/zh/docs/quickStart/01quickstart
安装可视化rocketmq_dashboard下载地址
https://rocketmq.apache.org/zh/docs/4.x/deployment/03Dashboard/
安装rocketmq_mqtt
https://rocketmq.apache.org/zh/docs/4.x/mqtt/01RocketMQMQTTOverview
broker.conf配置文件中添加参数，开启多队列分发特性 (备注：最好安装5.0.0版本) enableLmq = true enableMultiDispatch = true
2.打包rocketmq-mqtt git clone https://github.com/apache/rocketmq-mqtt
cd rocketmq-mqtt
mvn -Prelease-all -DskipTests clean install -U cd distribution/target/
target下是打包的包
3.配置rocketmq-mqtt 下面例子中 ROCKETMQ所在机器192.168.33.22，ROCKETMQ-MQTT服务所在机器172.16.10.160
修改conf/connect.conf
mqttPort=1883
enablePrometheus=true
修改conf/meta.conf
IP换成要运行服务的机器的
selfAddress=172.16.10.160:25000
membersAddress=172.16.10.160:25000
修改conf/service.conf
metaAddr的IP换成要运行服务的机器的
username和secretKey配置了要记住，mqtt生产者要使用它做认证
eventNotifyRetryTopic=xx //notify重试topic，提前创建
clientRetryTopic=xx //客户端消息重试topic，提前创建
NAMESRV_ADDR的IP换成RocketMQ nameserver服务所在机器的IP
如下：
username=test
secretKey=test
NAMESRV_ADDR=192.168.33.22:9876
eventNotifyRetryTopic=eventNotifyRetryTopic
clientRetryTopic=clientRetryTopic
metaAddr=172.16.10.160:25000
初始化操作 创建topic
mqadmin updatetopic -c {cluster} -t {topic} -n {namesrv}" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/8261f46e0419c895225a63cae701731a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-05T09:59:59+08:00" />
<meta property="article:modified_time" content="2023-08-05T09:59:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apache RocketMQ之集成RocketMQ_MQTT 安装部署协议</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;">Apache RocketMQ 安装说明</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">安装步骤 参考快速开始</p> 
<p style="margin-left:.0001pt;text-align:justify;"><a href="https://rocketmq.apache.org/zh/docs/quickStart/01quickstart" rel="nofollow" title="https://rocketmq.apache.org/zh/docs/quickStart/01quickstart">https://rocketmq.apache.org/zh/docs/quickStart/01quickstart</a></p> 
<p style="margin-left:.0001pt;text-align:justify;">安装可视化rocketmq_dashboard下载地址</p> 
<p style="margin-left:.0001pt;text-align:justify;"><a href="https://rocketmq.apache.org/zh/docs/4.x/deployment/03Dashboard/" rel="nofollow" title="https://rocketmq.apache.org/zh/docs/4.x/deployment/03Dashboard/">https://rocketmq.apache.org/zh/docs/4.x/deployment/03Dashboard/</a></p> 
<p style="margin-left:.0001pt;text-align:justify;">安装rocketmq_mqtt</p> 
<p style="margin-left:.0001pt;text-align:justify;"><a href="https://rocketmq.apache.org/zh/docs/4.x/mqtt/01RocketMQMQTTOverview" rel="nofollow" title="https://rocketmq.apache.org/zh/docs/4.x/mqtt/01RocketMQMQTTOverview">https://rocketmq.apache.org/zh/docs/4.x/mqtt/01RocketMQMQTTOverview</a></p> 
<ol><li style="text-align:justify;"><strong><span style="background-color:#ffffff;"><span style="color:#4f4f4f;"><strong>broker.conf配置文件中添加参数，开启多队列分发特性 (备注：最好安装5.0.0版本)</strong></span></span></strong></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">enableLmq = true </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">enableMultiDispatch = true</span></span></p> 
<h2 style="margin-left:0pt;text-align:left;"><span style="background-color:#ffffff;"><strong><strong><span style="background-color:#ffffff;"><span style="color:#4f4f4f;"><strong>2.</strong></span></span></strong><strong><span style="background-color:#ffffff;"><span style="color:#4f4f4f;"><strong>打包rocketmq-</strong></span></span></strong><a href="https://so.csdn.net/so/search?q=mqtt&amp;spm=1001.2101.3001.7020" title="mqtt">mqtt</a></strong></span></h2> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">git clone https://github.com/apache/rocketmq-mqtt</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">cd rocketmq-mqtt</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mvn -Prelease-all -DskipTests clean install -U </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">cd distribution/target/</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">target下是打包的包</span></span></p> 
<h2 style="text-align:left;"><span style="background-color:#ffffff;"><strong><strong><span style="background-color:#ffffff;"><span style="color:#4f4f4f;"><strong>3.</strong></span></span></strong><strong><span style="background-color:#ffffff;"><span style="color:#4f4f4f;"><strong>配置rocketmq-mqtt</strong></span></span></strong></strong></span></h2> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">下面例子中 ROCKETMQ所在机器192.168.33.22，ROCKETMQ-MQTT服务所在机器172.16.10.160</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;"><strong>修改conf/connect.conf</strong></span></span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqttPort=1883</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">enablePrometheus=true</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;"><strong>修改conf/meta.conf</strong></span></span></strong><br><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">IP换成要运行服务的机器的</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">selfAddress=172.16.10.160:25000</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">membersAddress=172.16.10.160:25000</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;"><strong>修改conf/service.conf</strong></span></span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">metaAddr的IP换成要运行服务的机器的</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">username和secretKey配置了要记住，mqtt生产者要使用它做认证</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">eventNotifyRetryTopic=xx //notify重试topic，提前创建</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">clientRetryTopic=xx //客户端消息重试topic，提前创建</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">NAMESRV_ADDR的IP换成RocketMQ nameserver服务所在机器的IP</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;"><strong>如下：</strong></span></span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">username=test</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">secretKey=test</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">NAMESRV_ADDR=192.168.33.22:9876</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">eventNotifyRetryTopic=eventNotifyRetryTopic</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">clientRetryTopic=clientRetryTopic</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">metaAddr=172.16.10.160:25000</span></span></p> 
<ol><li style="text-align:left;"><span style="background-color:#ffffff;"><strong><strong><span style="background-color:#ffffff;"><span style="color:#4f4f4f;"><strong>初始化操作</strong></span></span></strong></strong></span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">创建topic</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updatetopic -c {cluster} -t {topic} -n {namesrv}</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">上面配置的eventNotifyRetryTopic和clientRetryTopic也必须创建</span></span><br><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">实际执行如下：</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">sh </span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updatetopic -c DefaultCluster -t eventNotifyRetryTopic -n 192.168.33.22:9876</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">sh </span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updatetopic -c DefaultCluster -t clientRetryTopic -n 192.168.33.22:9876</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">sh </span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updatetopic -c DefaultCluster -t test-topic -n 192.168.33.22:9876</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">Configure Gateway Node List</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">：</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updateKvConfig -s LMQ -k LMQ_CONNECT_NODES -v {ip1,ip2} -n {namesrv}</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">实际执行命令</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">sh </span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updateKvConfig -s LMQ -k LMQ_CONNECT_NODES -v 172.16.10.160 -n 192.168.33.22:9876</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">Configure the first-level topic list</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updateKvConfig -s LMQ -k ALL_FIRST_TOPICS -v {topic1,topic2} -n {namesrv}</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">实际执行如下：</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">sh </span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updateKvConfig -s LMQ -k ALL_FIRST_TOPICS -v eventNotifyRetryTopic,clientRetryTopic,test-topic -n 192.168.33.22:9876</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">Configure a list of wildcard characters under each first-level topic</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updateKvConfig  -s LMQ -k {topic} -v {topic/+}  -n {namesrv}</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">实际执行如下：</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updateKvConfig  -s LMQ -k eventNotifyRetryTopic -v eventNotifyRetryTopic/+ -n 192.168.33.22:9876</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updateKvConfig  -s LMQ -k clientRetryTopic -v clientRetryTopic/+ -n 192.168.33.22:9876</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">mqadmin updateKvConfig  -s LMQ -k test-topic -v test-topic/+ -n 192.168.33.22:9876</span></span></p> 
<ol><li style="text-align:left;"><span style="background-color:#ffffff;"><strong><strong><span style="background-color:#ffffff;"><span style="color:#4f4f4f;"><strong>启动</strong></span></span></strong></strong></span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">cd bin</p> 
<p style="margin-left:.0001pt;text-align:justify;">sh meta.sh start</p> 
<p style="margin-left:.0001pt;text-align:justify;">sh mqtt.sh start</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">启动日志在$HOME/logs/start_out.log</span></span><br><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">启动完后应该meta对应25000端口，mqtt对应1883端口</span></span></p> 
<ol><li style="text-align:left;"><span style="background-color:#ffffff;"><strong><strong><span style="background-color:#ffffff;"><span style="color:#4f4f4f;"><strong>测试</strong></span></span></strong></strong></span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">使用rocketmq-mqtt工程中的mqtt-example做测试</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">将其中的一些IP、topic改为实际的</span></span><br><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">经测试，可以用mqtt做生产者，rocketmq做消费者</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">MqttProducer</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;"> 消息生产</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">RocketMQConsumer</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">  消息消费</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">备注：需要开发的端口号</span></span></p> 
<ol><li style="text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">R</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">ocketmq 端口号9876</span></span></li><li style="text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">R</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">ocketmq_dashboard 端口号：9875（默认是：8080。如果需要修改：在原代码配置文件调整端口号9875 编译好的重新上传到服务器上）。</span></span></li><li style="text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">R</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">ocketmq_mqtt 端口号1883 监听代理端口号：10911,10909</span></span></li><li style="text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">修改配置文件mqtt bin目录下 </span></span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">4.1. </span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">runserver.sh</span></span>   <span style="background-color:#ffffff;"><span style="color:#4d4d4d;">256m，256m 512m</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">4.2. runbroker.sh   512m 512m</span></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/897255bcfb7425913e64f340ccd6bc47/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">生产环境weblogic 10.3.6安装部署</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/be332fe660f8bb7c905d82ee5b2abcc9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">RuntimeError: Background label not declared (remeber that this should be label 0!)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>