<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Fragment 的使用 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Fragment 的使用" />
<meta property="og:description" content="Android 学习笔记 —— Fragment 的使用 FragmentFragment 的简单使用动态添加 Fragment在 Fragment 中模拟返回栈，返回上一个 FragmentFragment 和 Activity 之间进行通信使用限定符动态加载布局Fragment 的生命周期androidx.fragment.app.FragmentContainerViewonActivityCreated() 被弃用 Fragment Fragment 表示应用界面中可重复使用的一部分。Fragment 定义和管理自己的布局，具有自己的生命周期，并且可以处理自己的输入事件。Fragment 不能独立存在，而是必须由 Activity 或另一个 Fragment 托管。Fragment 的视图层次结构会成为宿主的视图层次结构的一部分，或附加到宿主的视图层次结构。
上面是官方对 Fragment 的介绍。其实 Fragment 和 Activity 很相似，但使用 Fragment 可以将一个完整的界面划分为离散的区块，然后嵌入到 Activity 中，从而将模块化和可重用性引入 Activity 的界面。说白了就是可以在不切换 Acitivty 的同时变更 UI 界面中某一区域的内容，Activity 适合放置全局元素，而 Fragment 更适合定义和管理单个屏幕或部分屏幕的界面。
Fragment 的简单使用 使用步骤：
编写 Fragment 的布局文件 fragment_left.xml 和 fragment_right.xml。
&lt;!-- fragment_left.xml --&gt; &lt;LinearLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34; android:orientation=&#34;vertical&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;match_parent&#34;&gt; &lt;Button android:id=&#34;@&#43;id/button_left_fragment&#34; android:layout_width=&#34;wrap_content&#34; android:layout_height=&#34;wrap_content&#34; android:layout_gravity=&#34;center_horizontal&#34; android:text=&#34;Button&#34; /&gt; &lt;/LinearLayout&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/5a64c803986f8d32870051b996ee9411/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-01T18:37:12+08:00" />
<meta property="article:modified_time" content="2022-10-01T18:37:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Fragment 的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Android 学习笔记 —— Fragment 的使用</h4> 
 <ul><li><a href="#Fragment_2" rel="nofollow">Fragment</a></li><li><ul><li><a href="#Fragment__8" rel="nofollow">Fragment 的简单使用</a></li><li><a href="#_Fragment_78" rel="nofollow">动态添加 Fragment</a></li><li><a href="#_Fragment__Fragment_174" rel="nofollow">在 Fragment 中模拟返回栈，返回上一个 Fragment</a></li><li><a href="#Fragment__Activity__201" rel="nofollow">Fragment 和 Activity 之间进行通信</a></li><li><a href="#_205" rel="nofollow">使用限定符动态加载布局</a></li><li><a href="#Fragment__211" rel="nofollow">Fragment 的生命周期</a></li><li><a href="#androidxfragmentappFragmentContainerView_242" rel="nofollow">androidx.fragment.app.FragmentContainerView</a></li><li><a href="#onActivityCreated__322" rel="nofollow">onActivityCreated() 被弃用</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Fragment_2"></a>Fragment</h2> 
<blockquote> 
 <p>Fragment 表示应用界面中可重复使用的一部分。Fragment 定义和管理自己的布局，具有自己的生命周期，并且可以处理自己的输入事件。Fragment 不能独立存在，而是必须由 Activity 或另一个 Fragment 托管。Fragment 的视图层次结构会成为宿主的视图层次结构的一部分，或附加到宿主的视图层次结构。</p> 
</blockquote> 
<p>上面是官方对 Fragment 的介绍。其实 Fragment 和 Activity 很相似，但使用 Fragment 可以将一个完整的界面划分为离散的区块，然后嵌入到 Activity 中，从而将模块化和可重用性引入 Activity 的界面。说白了就是可以在不切换 Acitivty 的同时变更 UI 界面中某一区域的内容，<strong>Activity 适合放置全局元素，而 Fragment 更适合定义和管理单个屏幕或部分屏幕的界面。</strong></p> 
<h3><a id="Fragment__8"></a>Fragment 的简单使用</h3> 
<p>使用步骤：</p> 
<ol><li> <p>编写 Fragment 的布局文件 fragment_left.xml 和 fragment_right.xml。</p> <pre><code class="prism language-xml"><span class="token comment">&lt;!-- fragment_left.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/button_left_fragment<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_horizontal<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Button<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> <pre><code class="prism language-xml"><span class="token comment">&lt;!-- fragment_right.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_horizontal<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>This is right fragment.<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p>分别创建对应的 Fragment 类 LeftFragment 和 RightFragment，并继承自 Fragment。重写 <code>onCreateView()</code> 方法。</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LeftFragment</span> <span class="token keyword">extends</span> <span class="token class-name">Fragment</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Nullable</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">LayoutInflater</span> inflater<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ViewGroup</span> container<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 使用布局加载器去加载对应 Fragment 的布局文件，转化成 View 对象并返回</span>
        <span class="token keyword">return</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fragment_left<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>在 Activity 的布局文件中添加 <code>&lt;fragment&gt;</code> 标签，指定 <code>android:name</code> 属性为对应的 Fragment 类。</p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/left_fragment<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.amie.test.LeftFragment<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/right_fragment<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.amie.test.RightFragment<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> </li></ol> 
<h3><a id="_Fragment_78"></a>动态添加 Fragment</h3> 
<p>接着上面的例子继续添加一个 Fragment。</p> 
<ol><li> <p>编写一个新的 Fragment 布局文件 fragment_another_right.xml。</p> <pre><code class="prism language-xml"><span class="token comment">&lt;!-- fragment_another_right.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ffff00<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_horizontal<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>This is another right fragment.<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p>创建对应 Fragment 类 AnotherRightFragment，并继承自 Fragment。重写 <code>onCreateView()</code> 方法。</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnotherRightFragment</span> <span class="token keyword">extends</span> <span class="token class-name">Fragment</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Nullable</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">LayoutInflater</span> inflater<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ViewGroup</span> container<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 使用布局加载器去加载对应 Fragment 的布局文件，转化成 View 对象并返回</span>
        <span class="token keyword">return</span> inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>fragment_another_right<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>修改 Activity 的布局文件，将右边 Fragment 的替换成 <code>&lt;FrameLayout&gt;</code>。因为要把动态加载的 Fragment 放入一个布局中，这个布局就只有这个 Fragment 没有其他东西，也不需要任何定位，那么会默认把控件放到左上角的 FrameLayout 就很适合。</p> <p>这里先不采用官方建议的 <a href="#androidxfragmentappfragmentcontainerview" rel="nofollow"><code>FragmentContainerView</code></a> 替代 <code>&lt;fragment&gt;</code> 标签和 <code>&lt;FrameLayout&gt;</code> 标签。</p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/left_fragment<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.amie.test.LeftFragment<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/right_frame_layout<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> </li><li> <p>在 Activtiy 中给 FrameLayout 添加内容，实现动态添加 Fragment。</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FragmentActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Button</span> button <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_left_button<span class="token punctuation">)</span><span class="token punctuation">;</span>
        button<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">replaceFragment</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RightFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * 创建一个用来替换 Fragment 的方法
    * @param fragment 需要被替换成的 Fragment 的实例
    */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">replaceFragment</span><span class="token punctuation">(</span><span class="token class-name">Fragment</span> fragment<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 调用 getSupportFragmentManager() 方法获取 FragmentManager 对象</span>
        <span class="token class-name">FragmentManager</span> fragmentManager <span class="token operator">=</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 通过 FragmentManager 调用 beginTransaction() 开启一个事务并获得 FragmentTransaction 对象</span>
        <span class="token class-name">FragmentTransaction</span> transaction <span class="token operator">=</span> fragmentManager<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 向容器内添加或替换 Fragment，可通过 replace() 方法实现</span>
        <span class="token comment">// 第一个参数是容器的资源 ID，第二个参数是需要被替换成的 Fragment 实例对象</span>
        transaction<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>right_frame_layout<span class="token punctuation">,</span> fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 提交事务</span>
        transaction<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_left_button<span class="token operator">:</span>
                <span class="token function">replaceFragment</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AnotherRightFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<h3><a id="_Fragment__Fragment_174"></a>在 Fragment 中模拟返回栈，返回上一个 Fragment</h3> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">replaceFragment</span><span class="token punctuation">(</span><span class="token class-name">Fragment</span> fragment<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 调用 getSupportFragmentManager() 方法获取 FragmentManager 对象</span>
    <span class="token class-name">FragmentManager</span> fragmentManager <span class="token operator">=</span> <span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 通过 findFragmentById() 方法获取当前 Fragment</span>
    <span class="token class-name">Fragment</span> current <span class="token operator">=</span> fragmentManager<span class="token punctuation">.</span><span class="token function">findFragmentById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>right_frame_layout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 当前 Fragment 不为空时，判断是否与目标 Fragment 类型相同，减少重复创建</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>current<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> fragment<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">FragmentTransaction</span> transaction <span class="token operator">=</span> fragmentManager<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    transaction<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>right_frame_layout<span class="token punctuation">,</span> fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 将此事务添加到后台堆栈。这意味着事务将在提交后被记住，并在以后从堆栈中弹出时将其操作反转</span>
    <span class="token comment">// 传入 null 即可，其他字符串也行</span>
    transaction<span class="token punctuation">.</span><span class="token function">addToBackStack</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 提交事务</span>
    transaction<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Fragment__Activity__201"></a>Fragment 和 Activity 之间进行通信</h3> 
<p>前面已经知道在 Activity 中通过 <code>getSupportFragmentManager().findFragmentById()</code> 方法获取对应的 Fragment 对象，那也就可以调用 Fragment 的方法进行操作了。但是在 Fragment 中如何调用 Activity 中的方法呢？其实很简单，在 Fragment 中直接调用 <code>getActivity()</code> 就可以获取到 Activity 对象了(也可以使用 <code>requireActivity()</code>，内部多了一个判空操作)。而 Fragment 与 Fragment 之间通信则可以通过 Activity 作为跳板来实现。</p> 
<h3><a id="_205"></a>使用限定符动态加载布局</h3> 
<p>前面使用的 Fragment 是显示在平板等大屏设备的双页模式下，但如果要在手机上运行应该显示成单页模式，那如何判断应该显示单页还是双页模式呢？这里可以在 res 资源目录下新建 layout-large 文件夹，在该文件夹下建立一个同名的布局文件，在这里编写双页模式的布局。这里的 large 就是一个限定符（Qualifier），系统会帮我们判断当前运行的设备是否是 large 大屏设备，然后加载对应的布局。当然，代码中的逻辑处理也需要改动一下。</p> 
<p>large 限定符可以解决大屏设备上的单双页判断问题，但是我们并不知道 large 限定的大屏是多大。对此，我们还可以使用最小限定符（Smallest-width Qualifier），它可以指定屏幕宽度的最小值（以 dp 为单位），但屏幕宽度大于该值就加载这里的布局。如，在 res 资源目录下新建 layout-sw600dp 文件夹。</p> 
<h3><a id="Fragment__211"></a>Fragment 的生命周期</h3> 
<p><strong>API 28 之前的旧版 Fragment 生命周期：</strong><br> <img src="https://images2.imgbox.com/c1/94/BUGw5NWN_o.png" alt="Fragment 的生命周期" width="264" height="700"></p> 
<ol><li><strong>onAttach()：</strong> 当 Fragment 和 Activity 相关联时调用。可以通过该方法获取 Activity 引用，还可以通过 <code>getArguments()</code> 获取参数。</li><li><strong>onCreate()：</strong> 当 Fragment 被创建时调用。</li><li><strong>onCreateView()：</strong> 当 Fragment 的布局被创建时调用。</li><li><strong>onActivityCreated()：</strong> 当 Activity 完成 <code>onCreate()</code> 时调用，已被弃用。</li><li><strong>onStart()：</strong> 当 Fragment 可见时调用。</li><li><strong>onResume()：</strong> 当 Fragment 可见且可交互时调用。</li><li><strong>onPause()：</strong> 当 Fragment 不可交互但可见时调用。</li><li><strong>onStop()：</strong> 当 Fragment 不可见时调用。</li><li><strong>onDestroyView()：</strong> 当 Fragment 的从视图结构中移除时调用。</li><li><strong>onDestroy()：</strong> 当销毁 Fragment 时调用。</li><li><strong>onDetach()：</strong> 当 Fragment 和 Activity 解除关联时调用。</li></ol> 
<p><strong>API 28 之后 的新版 Fragment 生命周期：</strong><br> <img src="https://images2.imgbox.com/fb/15/eU4ffu86_o.png" alt="Fragment 生命周期状态和回调以及 Fragment 视图生命周期的关系" width="490" height="600"></p> 
<p>新版 API 主要表现在 <code>onActivityCreated()</code> 被弃用，<code>onViewCreated()</code> 出现。将在后续篇章 <a href="#onactivitycreated-%E8%A2%AB%E5%BC%83%E7%94%A8" rel="nofollow">onActivityCreated() 被弃用</a> 中再作说明。</p> 
<p><strong>Fragment 生命周期状态和回调</strong><br> 在确定 Fragment 的生命周期状态时，FragmentManager 请考虑以下几点：</p> 
<ol><li>Fragment 的最大状态由它的 FragmentManager 决定。 一个 Fragment 不能超越 FragmentManager 的状态。</li><li>作为 FragmentTransaction 的一部分，您可以使用 <code>setMaxLifecycle()</code> 为 Fragment 设置最大生命周期状态。</li><li>Fragment 的生命周期状态永远不能大于其父级。例如，父 Fragment 或 Activity 必须在其子 Fragment 之前启动。同样，子 Fragment 必须在其父 Fragment 或 Activity 之前停止。</li></ol> 
<blockquote> 
 <p>注意：避免使用 <code>&lt;fragment&gt;</code> 标签来添加使用 XML 的Fragment ，因为 <code>&lt;fragment&gt;</code> 标签允许 Fragment 状态超出其 FragmentManager 状态. 相反，应该使用 <a href="#androidxfragmentappfragmentcontainerview" rel="nofollow">FragmentContainerView</a> 用于 XML 添加 Fragment 。</p> 
</blockquote> 
<h3><a id="androidxfragmentappFragmentContainerView_242"></a>androidx.fragment.app.FragmentContainerView</h3> 
<p>FragmentContainerView 是专为 Fragments 设计的自定义 Layout。它扩展了 FrameLayout，因此它可以可靠地处理 Fragment Transactions，并且它还具有与 Fragment 行为协调的附加功能。</p> 
<p>官方已经建议将 <code>&lt;fragment&gt;</code> 标签和用于切换 Fragment 的 <code>&lt;FrameLayout&gt;</code> 标签替换成 <code>androidx.fragment.app.FragmentContainerView</code> 了。那在代码中又要做出什么更改呢？</p> 
<p>在上面的例子中，如果直接替换容器的 <code>&lt;FrameLayout&gt;</code> 标签而不修改其他代码是没有问题的，不会影响程序运行。但是如果直接替换 <code>&lt;fragment&gt;</code> 标签就会出现在 Activity 中无法直接通过 <code>findViewById()</code> 获取到 Fragment 中的控件，这就会导致控件的 <code>setOnClickListenner()</code> 失败，报空指针异常。</p> 
<p>因为使用 <code>&lt;FrameLayout&gt;</code> 标签是需要动态加载 Fragment 的，而 <code>androidx.fragment.app.FragmentContainerView</code> 继承自 FrameLayout，也需要动态加载，所以替换后并不需要修改逻辑代码。动态加载的 Fragment，想要获取其内部控件必须要在 <code>onCreateView()</code> 中得到 Fragment 的布局 View 之后才可以。</p> 
<p>观察 Fragment 的源码发现，其中有个 <code>onViewCreated(View view, Bundle savedInstanceState)</code> 方法。该方法在 <code>onCreateView()</code> 结束后立即调用，其中的参数 View 正是 <code>onCreateView()</code> 返回的视图。</p> 
<blockquote> 
 <p><code>onCreateView()</code> 一般用于初始化 Fragment 的视图，<code>onViewCreated()</code> 一般用于初始化视图内各个控件，而 <code>onCreate()</code> 用于初始化与 Fragment 视图无关的变量。</p> 
</blockquote> 
<p>到这里其实就很好解决了，在 Fragment 中获取控件，然后将事件监听对象设置为 Activity 就好了。下面是修改后的代码。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LeftFragment</span> <span class="token keyword">extends</span> <span class="token class-name">Fragment</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Nullable</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">LayoutInflater</span> inflater<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ViewGroup</span> container<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span>  inflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>left_fragment<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onViewCreated</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">View</span> view<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onViewCreated</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取对应 Activity</span>
        <span class="token class-name">FragmentActivity</span> activity <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FragmentActivity</span><span class="token punctuation">)</span> <span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取控件实例</span>
        <span class="token class-name">Button</span> button1 <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>button1_left_fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将控件的事件监听交给 Activity 处理</span>
        <span class="token comment">// 让 Activity 处理是因为 FragmentManager 在 Activity 中</span>
        button<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">)</span> activity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- activity_fragment.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>horizontal<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/left_fragment_container<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.amie.firstlineofcode.LeftFragment<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/right_fragment_container<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">// 依旧实现 View.OnClickListener 接口</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FragmentActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// ...</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_left_fragment<span class="token operator">:</span>
                <span class="token function">replaceFragment</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AnotherRightFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="onActivityCreated__322"></a>onActivityCreated() 被弃用</h3> 
<p><code>onActivityCreated()</code> 是在宿主 Activity 的 <code>onCreate()</code> 完成之后立即调用，这也确保了宿主 Activity 的视图是完成了初始化。当然在这个方法内也可以操作宿主 Activity 视图的控件 View 或者获知其他 Fragment。</p> 
<p>执行该方法时，与 Fragment 绑定的 Activity 的 <code>onCreate()</code> 方法已经执行完成并返回，在 <code>onActivityCreated()</code> 内可以进行与 Activity 交互的 UI 操作。但是，如果在 <code>onActivityCreated()</code> 之前 Activity 的 <code>onCreate()</code> 方法尚未执行完成，提前进行交互操作，会引发空指针异常。</p> 
<p><strong>替代方案：</strong><br> 谷歌为了管理 Fragment 的生命周期，实现了 LifecycleOwner，暴露了一个可以通过getLifecycle() 方法访问的 Lifecycle 对象。</p> 
<p>因为 <code>onActivityCreated()</code> 是宿主 Activity 的 <code>onCreate()</code> 之后立即调用，所以可以在 <code>onAttach()</code> 的时候，通过订阅 Activity 的 lifecycle 来获取 Activity 的 <code>onCreate()</code> 事件，记得要 <code>removeObserver()</code>。</p> 
<pre><code class="prism language-java"> <span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAttach</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onAttach</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//requireActivity() 返回的是宿主 Activity</span>
    <span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLifecycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LifecycleEventObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStateChanged</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">LifecycleOwner</span> source<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Lifecycle<span class="token punctuation">.</span>Event</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getTargetState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Lifecycle<span class="token punctuation">.</span>State</span><span class="token punctuation">.</span>CREATED<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">// TODO</span>
                <span class="token function">getLifecycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 最后删除观察者</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8312c887bb3281d4277169e581772f7b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">仿记事本--含源码(java版)(基础功能版)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9b7f6d27bdf85ef42ca2f6a9cf73996c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Markdown语法如何添加按钮</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>