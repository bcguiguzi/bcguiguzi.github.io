<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>django form表单渲染和验证 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="django form表单渲染和验证" />
<meta property="og:description" content="django form表单渲染和验证 一、Form常用字段与插件1.initial 初始值，input框里面的初始值。2.error_messages 重写错误信息3.password 设置输入框为密码类型4.radioSelect 单选框，值为字符串5.单选Select6.多选Select7.单选checkbox8.多选checkbox9.date类型10.choice字段注意事项 二、Form所有内置字段三、字段校验四、钩子方法五、form表单渲染样式1.批量添加样式 六、ModelForm基本七、ModelForm验证save()方法 导入表单
from django import forms
一、Form常用字段与插件 1.initial 初始值，input框里面的初始值。 class LoginForm(forms.Form): username = forms.CharField( min_length=8, label=&#34;用户名&#34;, initial=&#34;张三&#34; # 设置默认值 ) pwd = forms.CharField(min_length=6, label=&#34;密码&#34;) 2.error_messages 重写错误信息 class LoginForm(forms.Form): username = forms.CharField( min_length=8, label=&#34;用户名&#34;, initial=&#34;张三&#34;, error_messages={ &#34;required&#34;: &#34;不能为空&#34;, &#34;invalid&#34;: &#34;格式错误&#34;, &#34;min_length&#34;: &#34;用户名最短8位&#34; } ) 3.password 设置输入框为密码类型 class LoginForm(forms.Form): ... pwd = forms.CharField( min_length=6, label=&#34;密码&#34;, widget=forms.widgets.PasswordInput(attrs={&#39;class&#39;: &#39;c1&#39;}, render_value=True) #这个密码字段和其他字段不一样，默认在前端输入数据错误的时候，点击提交之后，默认是不保存的原来数据的，但是可以通过这个render_value=True让这个字段在前端保留用户输入的数据 ) 4.radioSelect 单选框，值为字符串 class LoginForm(forms." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/fd4bda1bd05999f5d70701044db1c4c9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-04T20:03:06+08:00" />
<meta property="article:modified_time" content="2019-06-04T20:03:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">django form表单渲染和验证</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>django form表单渲染和验证</h4> 
 <ul><li><a href="#Form_3" rel="nofollow">一、Form常用字段与插件</a></li><li><ul><li><a href="#1initial_input_4" rel="nofollow">1.initial 初始值，input框里面的初始值。</a></li><li><a href="#2error_messages__14" rel="nofollow">2.error_messages 重写错误信息</a></li><li><a href="#3password__28" rel="nofollow">3.password 设置输入框为密码类型</a></li><li><a href="#4radioSelect__39" rel="nofollow">4.radioSelect 单选框，值为字符串</a></li><li><a href="#5Select_49" rel="nofollow">5.单选Select</a></li><li><a href="#6Select_60" rel="nofollow">6.多选Select</a></li><li><a href="#7checkbox_72" rel="nofollow">7.单选checkbox</a></li><li><a href="#8checkbox_82" rel="nofollow">8.多选checkbox</a></li><li><a href="#9date_93" rel="nofollow">9.date类型</a></li><li><a href="#10choice_101" rel="nofollow">10.choice字段注意事项</a></li></ul> 
  </li><li><a href="#Form_153" rel="nofollow">二、Form所有内置字段</a></li><li><a href="#_346" rel="nofollow">三、字段校验</a></li><li><a href="#_395" rel="nofollow">四、钩子方法</a></li><li><a href="#form_445" rel="nofollow">五、form表单渲染样式</a></li><li><ul><li><a href="#1_446" rel="nofollow">1.批量添加样式</a></li></ul> 
  </li><li><a href="#ModelForm_467" rel="nofollow">六、ModelForm基本</a></li><li><a href="#ModelForm_515" rel="nofollow">七、ModelForm验证</a></li><li><ul><li><a href="#save_516" rel="nofollow">save()方法</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<blockquote> 
 <p>导入表单<br> from django import forms</p> 
</blockquote> 
<h2><a id="Form_3"></a>一、Form常用字段与插件</h2> 
<h3><a id="1initial_input_4"></a>1.initial 初始值，input框里面的初始值。</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>  
        min_length<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"用户名"</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token string">"张三"</span>  <span class="token comment"># 设置默认值</span>
    <span class="token punctuation">)</span>
    pwd <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"密码"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2error_messages__14"></a>2.error_messages 重写错误信息</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        min_length<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"用户名"</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">,</span>
        error_messages<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token string">"不能为空"</span><span class="token punctuation">,</span>
            <span class="token string">"invalid"</span><span class="token punctuation">:</span> <span class="token string">"格式错误"</span><span class="token punctuation">,</span>
            <span class="token string">"min_length"</span><span class="token punctuation">:</span> <span class="token string">"用户名最短8位"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
</code></pre> 
<h3><a id="3password__28"></a>3.password 设置输入框为密码类型</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    pwd <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"密码"</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'c1'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> render_value<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> 
        <span class="token comment">#这个密码字段和其他字段不一样，默认在前端输入数据错误的时候，点击提交之后，默认是不保存的原来数据的，但是可以通过这个render_value=True让这个字段在前端保留用户输入的数据</span>
    <span class="token punctuation">)</span>
</code></pre> 
<h3><a id="4radioSelect__39"></a>4.radioSelect 单选框，值为字符串</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    gender <span class="token operator">=</span> forms<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>
        choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"女"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"保密"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"性别"</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>RadioSelect<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre> 
<h3><a id="5Select_49"></a>5.单选Select</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    hobby <span class="token operator">=</span> forms<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>  <span class="token comment">#注意，单选框用的是ChoiceField，并且里面的插件是Select，不然验证的时候会报错， Select a valid choice的错误。</span>
        choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"篮球"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"足球"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"双色球"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"爱好"</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>Select<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre> 
<h3><a id="6Select_60"></a>6.多选Select</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    hobby <span class="token operator">=</span> forms<span class="token punctuation">.</span>MultipleChoiceField<span class="token punctuation">(</span> 
    <span class="token comment">#多选框的时候用MultipleChoiceField，并且里面的插件用的是SelectMultiple，不然验证的时候会报错。</span>
        choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"篮球"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"足球"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"双色球"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"爱好"</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>SelectMultiple<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre> 
<h3><a id="7checkbox_72"></a>7.单选checkbox</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    keep <span class="token operator">=</span> forms<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>
        label<span class="token operator">=</span><span class="token string">"是否记住密码"</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token string">"checked"</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>CheckboxInput<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre> 
<h3><a id="8checkbox_82"></a>8.多选checkbox</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    hobby <span class="token operator">=</span> forms<span class="token punctuation">.</span>MultipleChoiceField<span class="token punctuation">(</span>
        choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"篮球"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"足球"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"双色球"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"爱好"</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>CheckboxSelectMultiple<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre> 
<h3><a id="9date_93"></a>9.date类型</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets
<span class="token keyword">class</span> <span class="token class-name">BookForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    date <span class="token operator">=</span> forms<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>widget<span class="token operator">=</span>widgets<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span><span class="token string">'date'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token comment">#必须指定type，不然不能渲染成选择时间的input框</span>
</code></pre> 
<h3><a id="10choice_101"></a>10.choice字段注意事项</h3> 
<p>在使用选择标签时，需要注意choices的选项可以配置从数据库中获取，但是由于是静态字段获取的值无法实时更新，需要重写构造方法从而实现choice实时更新。</p> 
<ul><li>方式一</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> Form
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> fields

<span class="token keyword">class</span> <span class="token class-name">MyForm</span><span class="token punctuation">(</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> fields<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>
        <span class="token comment"># choices=((1, '上海'), (2, '北京'),),</span>
        initial<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>widgets<span class="token punctuation">.</span>Select
    <span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span> 
        <span class="token comment">#注意重写init方法的时候，*args和**kwargs一定要写上，不然会出问题，并且验证总是不能通过，还不显示报错信息</span>
        self<span class="token punctuation">.</span>fields<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>choices <span class="token operator">=</span> models<span class="token punctuation">.</span>Classes<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'caption'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>方式二</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> fields
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> models <span class="token keyword">as</span> form_model

<span class="token keyword">class</span> <span class="token class-name">FInfo</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    authors <span class="token operator">=</span> forms<span class="token punctuation">.</span>ModelMultipleChoiceField<span class="token punctuation">(</span>
    queryset<span class="token operator">=</span>models<span class="token punctuation">.</span>NNewType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>  <span class="token comment"># 多选</span>
    
    <span class="token comment">#或者下面这种方式，通过forms里面的models中提供的方法也是一样的。</span>
    authors <span class="token operator">=</span> form_model<span class="token punctuation">.</span>ModelMultipleChoiceField<span class="token punctuation">(</span>
    queryset<span class="token operator">=</span>models<span class="token punctuation">.</span>NNewType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>  <span class="token comment"># 多选</span>
    
    authors <span class="token operator">=</span> form_model<span class="token punctuation">.</span>ModelChoiceField<span class="token punctuation">(</span>
    queryset<span class="token operator">=</span>models<span class="token punctuation">.</span>NNewType<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>  <span class="token comment"># 单选</span>
    
    <span class="token comment">#或者，	</span>
	forms<span class="token punctuation">.</span>ModelChoiceField<span class="token punctuation">(</span>
	queryset<span class="token operator">=</span>models<span class="token punctuation">.</span>Publisth<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>Select<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">)</span> <span class="token comment"># 单选</span>

	authors <span class="token operator">=</span> forms<span class="token punctuation">.</span>ModelMultipleChoiceField<span class="token punctuation">(</span>
    queryset<span class="token operator">=</span>models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    widget <span class="token operator">=</span> forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>Select<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span><span class="token punctuation">}</span>
   <span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token comment">#如果用这种方式，别忘了model表中，NNEWType的__str__方法要写上，不然选择框里面是一个个的object对象</span>
</code></pre> 
<h2><a id="Form_153"></a>二、Form所有内置字段</h2> 
<pre><code class="prism language-python">Field
    required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>               是否允许为空
    widget<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                 HTML插件
    label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                  用于生成Label标签或显示内容
    initial<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                初始值
    help_text<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                帮助信息<span class="token punctuation">(</span>在标签旁边显示<span class="token punctuation">)</span>
    error_messages<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>         错误信息 <span class="token punctuation">{<!-- --></span><span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token string">'不能为空'</span><span class="token punctuation">,</span> <span class="token string">'invalid'</span><span class="token punctuation">:</span> <span class="token string">'格式错误'</span><span class="token punctuation">}</span>
    validators<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>               自定义验证规则
    localize<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>              是否支持本地化
    disabled<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>              是否可以编辑
    label_suffix<span class="token operator">=</span><span class="token boolean">None</span>            Label内容后缀
 
 
CharField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    max_length<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>             最大长度
    min_length<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>             最小长度
    strip<span class="token operator">=</span><span class="token boolean">True</span>                   是否移除用户输入空白
 
IntegerField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    max_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              最大值
    min_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              最小值
 
FloatField<span class="token punctuation">(</span>IntegerField<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
DecimalField<span class="token punctuation">(</span>IntegerField<span class="token punctuation">)</span>
    max_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              最大值
    min_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              最小值
    max_digits<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>             总长度
    decimal_places<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>         小数位长度
 
BaseTemporalField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    input_formats<span class="token operator">=</span><span class="token boolean">None</span>          时间格式化   
 
DateField<span class="token punctuation">(</span>BaseTemporalField<span class="token punctuation">)</span>    格式：<span class="token number">2015</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">01</span>
TimeField<span class="token punctuation">(</span>BaseTemporalField<span class="token punctuation">)</span>    格式：<span class="token number">11</span><span class="token punctuation">:</span><span class="token number">12</span>
DateTimeField<span class="token punctuation">(</span>BaseTemporalField<span class="token punctuation">)</span>格式：<span class="token number">2015</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">12</span>
 
DurationField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>            时间间隔：<span class="token operator">%</span>d <span class="token operator">%</span>H<span class="token punctuation">:</span><span class="token operator">%</span>M<span class="token punctuation">:</span><span class="token operator">%</span>S<span class="token punctuation">.</span><span class="token operator">%</span>f
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
RegexField<span class="token punctuation">(</span>CharField<span class="token punctuation">)</span>
    regex<span class="token punctuation">,</span>                      自定制正则表达式
    max_length<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>            最大长度
    min_length<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>            最小长度
    error_message<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>         忽略，错误信息使用 error_messages<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'invalid'</span><span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">}</span>
 
EmailField<span class="token punctuation">(</span>CharField<span class="token punctuation">)</span>      
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
FileField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    allow_empty_file<span class="token operator">=</span><span class="token boolean">False</span>     是否允许空文件
 
ImageField<span class="token punctuation">(</span>FileField<span class="token punctuation">)</span>      
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    注：需要PIL模块，pip3 install Pillow
    以上两个字典使用时，需要注意两点：
        <span class="token operator">-</span> form表单中 enctype<span class="token operator">=</span><span class="token string">"multipart/form-data"</span>
        <span class="token operator">-</span> view函数中 obj <span class="token operator">=</span> MyForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">,</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">)</span>
 
URLField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
 
BooleanField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
NullBooleanField<span class="token punctuation">(</span>BooleanField<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
ChoiceField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    choices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                选项，如：choices <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'上海'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'北京'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>             是否必填
    widget<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>               插件，默认select插件
    label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                Label内容
    initial<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              初始值
    help_text<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>              帮助提示
 
 
ModelChoiceField<span class="token punctuation">(</span>ChoiceField<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                        django<span class="token punctuation">.</span>forms<span class="token punctuation">.</span>models<span class="token punctuation">.</span>ModelChoiceField
    queryset<span class="token punctuation">,</span>                  <span class="token comment"># 查询数据库中的数据</span>
    empty_label<span class="token operator">=</span><span class="token string">"---------"</span><span class="token punctuation">,</span>   <span class="token comment"># 默认空显示内容</span>
    to_field_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>        <span class="token comment"># HTML中value的值对应的字段</span>
    limit_choices_to<span class="token operator">=</span><span class="token boolean">None</span>      <span class="token comment"># ModelForm中对queryset二次筛选</span>
     
ModelMultipleChoiceField<span class="token punctuation">(</span>ModelChoiceField<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                        django<span class="token punctuation">.</span>forms<span class="token punctuation">.</span>models<span class="token punctuation">.</span>ModelMultipleChoiceField
 
 
     
TypedChoiceField<span class="token punctuation">(</span>ChoiceField<span class="token punctuation">)</span>
    <span class="token builtin">coerce</span> <span class="token operator">=</span> <span class="token keyword">lambda</span> val<span class="token punctuation">:</span> val   对选中的值进行一次转换
    empty_value<span class="token operator">=</span> <span class="token string">''</span>            空值的默认值
 
MultipleChoiceField<span class="token punctuation">(</span>ChoiceField<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
TypedMultipleChoiceField<span class="token punctuation">(</span>MultipleChoiceField<span class="token punctuation">)</span>
    <span class="token builtin">coerce</span> <span class="token operator">=</span> <span class="token keyword">lambda</span> val<span class="token punctuation">:</span> val   对选中的每一个值进行一次转换
    empty_value<span class="token operator">=</span> <span class="token string">''</span>            空值的默认值
 
ComboField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    fields<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                  使用多个验证，如下：即验证最大长度<span class="token number">20</span>，又验证邮箱格式
                               fields<span class="token punctuation">.</span>ComboField<span class="token punctuation">(</span>fields<span class="token operator">=</span><span class="token punctuation">[</span>fields<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fields<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 
MultiValueField<span class="token punctuation">(</span>Field<span class="token punctuation">)</span>
    PS<span class="token punctuation">:</span> 抽象类，子类中可以实现聚合多个字典去匹配一个值，要配合MultiWidget使用
 
SplitDateTimeField<span class="token punctuation">(</span>MultiValueField<span class="token punctuation">)</span>
    input_date_formats<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>   格式列表：<span class="token punctuation">[</span><span class="token string">'%Y--%m--%d'</span><span class="token punctuation">,</span> <span class="token string">'%m%d/%Y'</span><span class="token punctuation">,</span> <span class="token string">'%m/%d/%y'</span><span class="token punctuation">]</span>
    input_time_formats<span class="token operator">=</span><span class="token boolean">None</span>    格式列表：<span class="token punctuation">[</span><span class="token string">'%H:%M:%S'</span><span class="token punctuation">,</span> <span class="token string">'%H:%M:%S.%f'</span><span class="token punctuation">,</span> <span class="token string">'%H:%M'</span><span class="token punctuation">]</span>
 
FilePathField<span class="token punctuation">(</span>ChoiceField<span class="token punctuation">)</span>     文件选项，目录下文件显示在页面中
    path<span class="token punctuation">,</span>                      文件夹路径
    match<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                正则匹配
    recursive<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>           递归下面的文件夹
    allow_files<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>          允许文件
    allow_folders<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>       允许文件夹
    required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    widget<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    initial<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    help_text<span class="token operator">=</span><span class="token string">''</span>
 
GenericIPAddressField
    protocol<span class="token operator">=</span><span class="token string">'both'</span><span class="token punctuation">,</span>           both<span class="token punctuation">,</span>ipv4<span class="token punctuation">,</span>ipv6支持的IP格式
    unpack_ipv4<span class="token operator">=</span><span class="token boolean">False</span>          解析ipv4地址，如果是<span class="token punctuation">:</span><span class="token punctuation">:</span>ffff<span class="token punctuation">:</span><span class="token number">192.0</span><span class="token number">.2</span><span class="token number">.1</span>时候，可解析为<span class="token number">192.0</span><span class="token number">.2</span><span class="token number">.1</span>， PS：protocol必须为both才能启用
 
SlugField<span class="token punctuation">(</span>CharField<span class="token punctuation">)</span>           数字，字母，下划线，减号（连字符）
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
UUIDField<span class="token punctuation">(</span>CharField<span class="token punctuation">)</span>           uuid类型
</code></pre> 
<p><code>完整示例</code><br> <a href="http://views.py" rel="nofollow">views.py</a></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django <span class="token keyword">import</span> forms

<span class="token comment"># 按照Django form组件的要求自己写一个类</span>
<span class="token keyword">class</span> <span class="token class-name">RegForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">"用户名"</span><span class="token punctuation">)</span>  <span class="token comment">#form字段的名称写的是什么，那么前端生成input标签的时候，input标签的name属性的值就是什么</span>
    pwd <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">"密码"</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    form_obj <span class="token operator">=</span> RegForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        <span class="token comment"># 实例化form对象的时候，把post提交过来的数据直接传进去</span>
        form_obj <span class="token operator">=</span> RegForm<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>  <span class="token comment">#既然传过来的input标签的name属性值和form类对应的字段名是一样的，所以接过来后，form就取出对应的form字段名相同的数据进行form校验</span>
        <span class="token comment"># 调用form_obj校验数据的方法</span>
        <span class="token keyword">if</span> form_obj<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"注册成功"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">"register.html"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"form_obj"</span><span class="token punctuation">:</span> form_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>login.html</p> 
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>注册2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{% url <span class="token punctuation">'</span>register<span class="token punctuation">'</span> %}<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">novalidate</span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  #novalidate 告诉前端form表单，不要对输入的内容做校验
        {% csrf_token %}
        #{<!-- -->{ form_obj.as_p }}  直接写个这个，会没有样式全部输入
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{ form_obj.name.id_for_label }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ form_obj.name.label }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
            {<!-- -->{ form_obj.name }} {<!-- -->{ form_obj.name.errors.0 }}  #errors是这个字段所有的错误，我就用其中一个错误提示就可以了，再错了再提示，并且不是给你生成ul标签了，单纯的是错误文本
           {<!-- -->{ form_obj.errors }} #这是全局的所有错误，找对应字段的错误，就要form_obj.字段名
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{ form_obj.pwd.id_for_label }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ form_obj.pwd.label }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
            {<!-- -->{ form_obj.pwd }} {<!-- -->{ form_obj.pwd.errors.0 }}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 也可以用循环输入 --&gt;</span>
		{% for field in form_obj %}
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
	            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{ field.id_for_label }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ field.label }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
	            {<!-- -->{ field}} {<!-- -->{ field.errors.0 }}
	        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		{% endfor %}

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn btn-success<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>注册<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="_346"></a>三、字段校验</h2> 
<ol><li>RegexValidator验证器</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> Form
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> fields
<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>validators <span class="token keyword">import</span> RegexValidator
 
<span class="token keyword">class</span> <span class="token class-name">MyForm</span><span class="token punctuation">(</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> fields<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        validators<span class="token operator">=</span><span class="token punctuation">[</span>RegexValidator<span class="token punctuation">(</span>r<span class="token string">'^[0-9]+$'</span><span class="token punctuation">,</span> <span class="token string">'请输入数字'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RegexValidator<span class="token punctuation">(</span>r<span class="token string">'^159[0-9]+$'</span><span class="token punctuation">,</span> <span class="token string">'数字必须以159开头'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment"># RegexValidator(arg1,arg2) arg1：正则表达式 arg2：验证不通过的错误提示</span>
    <span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>自定义验证函数</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> re
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> Form
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> widgets
<span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> fields
<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ValidationError
 
<span class="token comment"># 自定义验证规则</span>
<span class="token keyword">def</span> <span class="token function">mobile_validate</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mobile_re <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>r<span class="token string">'^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> mobile_re<span class="token punctuation">.</span>match<span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'手机号码格式错误'</span><span class="token punctuation">)</span>  <span class="token comment">#自定义验证规则的时候，如果不符合你的规则，需要自己发起错误</span>
 
<span class="token keyword">class</span> <span class="token class-name">PublishForm</span><span class="token punctuation">(</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
 
    title <span class="token operator">=</span> fields<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
                            min_length<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
                            error_messages<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token string">'标题不能为空'</span><span class="token punctuation">,</span>
                                            <span class="token string">'min_length'</span><span class="token punctuation">:</span> <span class="token string">'标题最少为5个字符'</span><span class="token punctuation">,</span>
                                            <span class="token string">'max_length'</span><span class="token punctuation">:</span> <span class="token string">'标题最多为20个字符'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                            widget<span class="token operator">=</span>widgets<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">"form-control"</span><span class="token punctuation">,</span>
                                                          <span class="token string">'placeholder'</span><span class="token punctuation">:</span> <span class="token string">'标题5-20个字符'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 
    <span class="token comment"># 使用自定义验证规则</span>
    phone <span class="token operator">=</span> fields<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>validators<span class="token operator">=</span><span class="token punctuation">[</span>mobile_validate<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                            error_messages<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token string">'手机不能为空'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                            widget<span class="token operator">=</span>widgets<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">"form-control"</span><span class="token punctuation">,</span>
                                                          <span class="token string">'placeholder'</span><span class="token punctuation">:</span> <span class="token string">'手机号码'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 
    email <span class="token operator">=</span> fields<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                            error_messages<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token string">'邮箱不能为空'</span><span class="token punctuation">,</span><span class="token string">'invalid'</span><span class="token punctuation">:</span> u<span class="token string">'邮箱格式错误'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                            widget<span class="token operator">=</span>widgets<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">"form-control"</span><span class="token punctuation">,</span> <span class="token string">'placeholder'</span><span class="token punctuation">:</span> <span class="token string">'邮箱'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_395"></a>四、钩子方法</h2> 
<ol><li>局部钩子<br> 我们在Form类中定义 clean_字段名() 方法，就能够实现对特定字段进行校验。</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        min_length<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"用户名"</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">,</span>
        error_messages<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token string">"不能为空"</span><span class="token punctuation">,</span>
            <span class="token string">"invalid"</span><span class="token punctuation">:</span> <span class="token string">"格式错误"</span><span class="token punctuation">,</span>
            <span class="token string">"min_length"</span><span class="token punctuation">:</span> <span class="token string">"用户名最短8位"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>TextInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"class"</span><span class="token punctuation">:</span> <span class="token string">"form-control"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment"># 定义局部钩子，用来校验username字段,之前的校验股则还在，给你提供了一个添加一些校验功能的钩子</span>
    <span class="token keyword">def</span> <span class="token function">clean_username</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        value <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"666"</span> <span class="token keyword">in</span> value<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">"光喊666是不行的"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> value
</code></pre> 
<ol start="2"><li>全局钩子<br> 我们在Form类中定义 clean() 方法，就能够实现对字段进行全局校验，字段全部验证完，局部钩子也全部执行完之后，执行这个全局钩子校验</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    password <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"密码"</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> render_value<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    re_password <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"确认密码"</span><span class="token punctuation">,</span>
        widget<span class="token operator">=</span>forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> render_value<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment"># 定义全局的钩子，用来校验密码和确认密码字段是否相同，执行全局钩子的时候，cleaned_data里面肯定是有了通过前面验证的所有数据</span>
    <span class="token keyword">def</span> <span class="token function">clean</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        password_value <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
        re_password_value <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'re_password'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> password_value <span class="token operator">==</span> re_password_value<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>cleaned_data <span class="token comment">#全局钩子要返回所有的数据</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>add_error<span class="token punctuation">(</span><span class="token string">'re_password'</span><span class="token punctuation">,</span> <span class="token string">'两次密码不一致'</span><span class="token punctuation">)</span> <span class="token comment">#在re_password这个字段的错误列表中加上一个错误，并且clean_data里面会自动清除这个re_password的值，所以打印clean_data的时候会看不到它</span>
</code></pre> 
<h2><a id="form_445"></a>五、form表单渲染样式</h2> 
<h3><a id="1_446"></a>1.批量添加样式</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LoginForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        min_length<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">"用户名"</span><span class="token punctuation">,</span>
        initial<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">,</span>
        error_messages<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token string">"不能为空"</span><span class="token punctuation">,</span>
            <span class="token string">"invalid"</span><span class="token punctuation">:</span> <span class="token string">"格式错误"</span><span class="token punctuation">,</span>
            <span class="token string">"min_length"</span><span class="token punctuation">:</span> <span class="token string">"用户名最短8位"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">for</span> field <span class="token keyword">in</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>fields<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>fields<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'form-control'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="ModelForm_467"></a>六、ModelForm基本</h2> 
<p>modelform是form与model的终极结合，会根据你model中的字段转换成对应的form字段，并且生成标签等操作。</p> 
<ul><li>基础示例 form写法</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">BookForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>Book
        fields <span class="token operator">=</span> <span class="token string">"__all__"</span>
        labels <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 不写会找Book属性对应的 verbose_name</span>
            <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"书名"</span><span class="token punctuation">,</span>
            <span class="token string">"price"</span><span class="token punctuation">:</span> <span class="token string">"价格"</span>
        <span class="token punctuation">}</span>
        widgets <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"password"</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>PasswordInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"class"</span><span class="token punctuation">:</span> <span class="token string">"c1"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"publishDate"</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>DateInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"date"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        error_messages <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'title'</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span><span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">'不能为空'</span><span class="token punctuation">,</span><span class="token punctuation">}</span> <span class="token comment">#每个字段的错误都可以写</span>
        <span class="token punctuation">}</span>
        
	<span class="token comment">#局部钩子：</span>
    <span class="token keyword">def</span> <span class="token function">clean_title</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
　　<span class="token comment">#全局钩子</span>
    <span class="token keyword">def</span> <span class="token function">clean</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
        
	<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#批量操作</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">for</span> field <span class="token keyword">in</span> self<span class="token punctuation">.</span>fields<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>fields<span class="token punctuation">[</span>field <span class="token punctuation">]</span><span class="token punctuation">.</span>error_messages <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">'不能为空'</span><span class="token punctuation">}</span> 
            <span class="token comment">#批量添加错误信息,这是都一样的错误，不一样的还是要单独写。</span>
            self<span class="token punctuation">.</span>fields<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>widget<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'form-control'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>class Meta常用的参数</li></ul> 
<pre><code class="prism language-python">model <span class="token operator">=</span> models<span class="token punctuation">.</span>Book  <span class="token comment"># 对应的Model中的类</span>
fields <span class="token operator">=</span> <span class="token string">"__all__"</span>  <span class="token comment"># 字段，如果是__all__,就是表示列出所有的字段</span>
exclude <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 排除的字段</span>
labels <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 提示信息</span>
help_texts <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 帮助提示信息</span>
widgets <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 自定义插件</span>
error_messages <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 自定义错误信息</span>
error_messages <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'title'</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span><span class="token string">'required'</span><span class="token punctuation">:</span><span class="token string">'不能为空'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token comment">#每个字段的所有的错误都可以写，...是省略的意思，复制黏贴我代码的时候别忘了删了...</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="ModelForm_515"></a>七、ModelForm验证</h2> 
<h3><a id="save_516"></a>save()方法</h3> 
<p>每个ModelForm还具有一个save()方法。 这个方法根据表单绑定的数据创建并保存数据库对象。 ModelForm的子类可以接受现有的模型实例作为关键字参数instance；如果提供此功能，则save()将更新该实例。 如果没有提供，save() 将创建模型的一个新实例</p> 
<p>示例</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        form_obj <span class="token operator">=</span> BookForm<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'form_obj'</span><span class="token punctuation">:</span>form_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">else</span><span class="token punctuation">:</span>
        form_obj <span class="token operator">=</span> BookForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
        <span class="token keyword">if</span> form_obj<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># authors_obj = form_obj.cleaned_data.pop('authors')</span>
            <span class="token comment"># new_book_obj = models.Book.objects.create(**form_obj.cleaned_data)</span>
            <span class="token comment"># new_book_obj.authors.add(*authors_obj)</span>
            form_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#因为我们再Meta中指定了是哪张表，所以它会自动识别，不管是外键还是多对多等，都会自行处理保存，它完成的就是上面三句话做的事情，并且还有就是如果你验证的数据比你后端数据表中的字段多，那么他自会自动剔除多余的不需要保存的字段，比如那个重复确认密码就不要保存</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'show'</span><span class="token punctuation">)</span>

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>form_obj<span class="token punctuation">.</span>errors<span class="token punctuation">)</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'form_obj'</span><span class="token punctuation">:</span>form_obj<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>html写法</p> 
<pre><code class="prism language-html">{% load static %}
<span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{% static <span class="token punctuation">'</span>bootstrap-3.3.0-dist/dist/css/bootstrap.min.css<span class="token punctuation">'</span> %}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>编辑页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container-fluid<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-md-6 col-md-offset-3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{% url <span class="token punctuation">'</span>edit_book<span class="token punctuation">'</span> n %}<span class="token punctuation">"</span></span> <span class="token attr-name">novalidate</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                {% csrf_token %}
                {% for field in form %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{ field.id_for_label }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ field.label }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
                        {<!-- -->{ field }}
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-danger<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ field.errors.0 }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                {% endfor %}

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn btn-primary pull-right<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{% static <span class="token punctuation">'</span>bootstrap-3.3.0-dist/dist/jQuery/jquery-3.1.1.js<span class="token punctuation">'</span> %}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{% static <span class="token punctuation">'</span>bootstrap-3.3.0-dist/dist/js/bootstrap.min.js<span class="token punctuation">'</span> %}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><a href="http://views.py" rel="nofollow">views.py</a></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">edit_book</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>

    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>

        form <span class="token operator">=</span> BookForm<span class="token punctuation">(</span>instance<span class="token operator">=</span>book_obj<span class="token punctuation">)</span>

        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'edit_book.html'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'form'</span><span class="token punctuation">:</span>form<span class="token punctuation">,</span><span class="token string">'n'</span><span class="token punctuation">:</span>n<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#传递的这个n参数是给form表单提交数据的是的action的url用的，因为它需要一个参数来识别是更新的哪条记录</span>

    <span class="token keyword">else</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> BookForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">,</span>instance<span class="token operator">=</span>book_obj<span class="token punctuation">)</span> <span class="token comment">#必须指定instance，不然我们调用save方法的是又变成了添加操作</span>
        <span class="token keyword">if</span> form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            form<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'show'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'edit_book.html'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'form'</span><span class="token punctuation">:</span>form<span class="token punctuation">,</span><span class="token string">'n'</span><span class="token punctuation">:</span>n<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ce00cc077d94f01f4000a16a329924fa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SG ：一个简单的PHP语法糖扩展</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4ac4ac880d193ff80a563fc556e707bc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">八个开源的 Spring Boot 学习资源，你值得拥有</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>