<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>还在手工生成数据库文档？3个步骤自动完成了解一下 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="还在手工生成数据库文档？3个步骤自动完成了解一下" />
<meta property="og:description" content="自动化生成数据库文档，简单的3个步骤即可完成，了解一下。
1 前言 平时工作中，大家应该都会遇到需要导出数据库说明文档（也叫数据字典）的情况，即把各数据表的字段信息整理成一个个的表说明，然后用 excel/word/html/md 等文档格式进行保存。很多小伙伴还在用原始的手工方式，复制粘贴数据库的字段说明（名称、类型、长度、注释等），不得不说这种方式效率实在太低。作为程序员，能用编程解决的问题，就不是问题。下面介绍的方法很简单，只需要3个步骤。本文将对这3个步骤使用 python 进行编码实现，把数据表信息说明输出到 excel 文档中。因此，主要包含以下内容：
生成数据库文档的3步骤说明获取数据库表元信息获取数据表列的元信息生成数据库说明 excel 文档（可选）设置 excel 文档格式 2 生成数据库说明文档的3步骤 由于数据库都会保存相应的元数据信息（即描述数据库、数据表、数据字段本身的信息，如表名，字段表、类型等等），因此，总的来说，生成数据库说明文档的思路很简单，分为3步：
1）根据数据库名，从数据库中获取数据表元信息，主要是表名，表注释等2）根据数据表名，获取数据字段的元信息，主要是字段名、字段类型、是否可空、字段注释等3）根据元数据信息生成文档 根据这个思路，把这3个步骤通过编码即可自动生成文档。获取元数据信息，各种数据库会有不同的查询语句，具体可以查询相关官方文档，下面简单列一下 mysql 及 oracle 的：
# mysql 查询表信息及字段信息 SELECT * FROM information_schema.`TABLES` WHERE TABLE_SCHEMA = %db_name% SELECT * FROM information_schema.`COLUMNS` WHERE TABLE_SCHEMA = %db_name% AND TABLE_NAME = %table_name% # oracle 查询表信息及字段信息 SELECT * FROM all_tables WHERE where owner= %db_name% SELECT * FROM all_COL_COMMENTS WHERE owner = %db_name% and TABLE_NAME=%table_name% 实现方式也可以根据各人喜欢的编程语言来实现。在本文中，以 MySQL 为例，使用 python 编程实现，把数据信息输出到 excel 文档（具体 excel 操作，可参考我上一篇文章《 Python 处理 Excel 文件》）。输出效果如下所示：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/26049f89d8c6f8d917697fb971cc1aa8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-30T22:48:26+08:00" />
<meta property="article:modified_time" content="2020-08-30T22:48:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">还在手工生成数据库文档？3个步骤自动完成了解一下</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>自动化生成数据库文档，简单的3个步骤即可完成，了解一下。</p> 
</blockquote> 
<h3><a id="1__2"></a>1 前言</h3> 
<p>平时工作中，大家应该都会遇到需要导出数据库说明文档（也叫数据字典）的情况，即把各数据表的字段信息整理成一个个的表说明，然后用 excel/word/html/md 等文档格式进行保存。很多小伙伴还在用原始的手工方式，复制粘贴数据库的字段说明（名称、类型、长度、注释等），不得不说这种方式效率实在太低。作为程序员，能用编程解决的问题，就不是问题。下面介绍的方法很简单，只需要3个步骤。本文将对这3个步骤使用 python 进行编码实现，把数据表信息说明输出到 excel 文档中。因此，主要包含以下内容：</p> 
<ul><li>生成数据库文档的3步骤说明</li><li>获取数据库表元信息</li><li>获取数据表列的元信息</li><li>生成数据库说明 excel 文档</li><li>（可选）设置 excel 文档格式</li></ul> 
<h3><a id="2_3_12"></a>2 生成数据库说明文档的3步骤</h3> 
<p>由于数据库都会保存相应的元数据信息（即描述数据库、数据表、数据字段本身的信息，如表名，字段表、类型等等），因此，总的来说，生成数据库说明文档的思路很简单，分为3步：</p> 
<ul><li>1）根据数据库名，从数据库中获取数据表元信息，主要是表名，表注释等</li><li>2）根据数据表名，获取数据字段的元信息，主要是字段名、字段类型、是否可空、字段注释等</li><li>3）根据元数据信息生成文档</li></ul> 
<p>根据这个思路，把这3个步骤通过编码即可自动生成文档。获取元数据信息，各种数据库会有不同的查询语句，具体可以查询相关官方文档，下面简单列一下 mysql 及 oracle 的：</p> 
<pre><code class="prism language-sql"><span class="token comment"># mysql 查询表信息及字段信息</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token keyword">TABLES</span><span class="token punctuation">`</span> <span class="token keyword">WHERE</span> TABLE_SCHEMA <span class="token operator">=</span> <span class="token operator">%</span>db_name<span class="token operator">%</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token keyword">COLUMNS</span><span class="token punctuation">`</span> <span class="token keyword">WHERE</span> TABLE_SCHEMA <span class="token operator">=</span> <span class="token operator">%</span>db_name<span class="token operator">%</span> <span class="token operator">AND</span> TABLE_NAME <span class="token operator">=</span> <span class="token operator">%</span>table_name<span class="token operator">%</span>

<span class="token comment"># oracle 查询表信息及字段信息</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> all_tables <span class="token keyword">WHERE</span> <span class="token keyword">where</span> owner<span class="token operator">=</span> <span class="token operator">%</span>db_name<span class="token operator">%</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> all_COL_COMMENTS <span class="token keyword">WHERE</span> owner <span class="token operator">=</span> <span class="token operator">%</span>db_name<span class="token operator">%</span>  <span class="token operator">and</span> TABLE_NAME<span class="token operator">=</span><span class="token operator">%</span>table_name<span class="token operator">%</span>
</code></pre> 
<p>实现方式也可以根据各人喜欢的编程语言来实现。在本文中，以 MySQL 为例，使用 python 编程实现，把数据信息输出到 excel 文档（具体 excel 操作，可参考我上一篇文章《<a href="https://mp.weixin.qq.com/s/GAoOOXebxshW1fGCLJc8BQ" rel="nofollow"> Python 处理 Excel 文件</a>》）。输出效果如下所示：</p> 
<p><img src="https://images2.imgbox.com/f1/3c/HI1O9GTb_o.png" alt="数据库说明文档"></p> 
<p>下面就跟着我进行实现吧。</p> 
<h3><a id="3__38"></a>3 获取数据库表元信息</h3> 
<h4><a id="31__pymysql__40"></a>3.1 客户端 pymysql 基本使用</h4> 
<p>使用 python 进行 MySQL 读写操作，使用的是 <a href="https://github.com/PyMySQL/PyMySQL">pymysql</a>，读者可以访问它的<a href="https://pymysql.readthedocs.io/en/latest" rel="nofollow">官方文档</a>了解它的安装和使用。简单来说，对数据库进行读数据，需要以下几步：</p> 
<ul><li>连接数据库：<code>connect</code></li><li>获取读数据的游标（ cursor ）：<code>connection.cursor()</code></li><li>执行 SQL 语句获取数据：<code>cursor.execute(sql,args)</code>，<code>cursor.fetchall()</code>，<code>cursor.fetchone()</code>,<code>cursor.fetchmany()</code></li><li>关闭游标和连接：<code>connection.close()</code></li><li>获取正在使用的工作表：<code>workbook.active</code>，<code>cursor.close()</code></li></ul> 
<p>因此，我们在类的初始化（ <code>__init__</code> ）和关闭（<code>__del__</code> ）时，进行数据库连接和关闭操作。代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> user<span class="token punctuation">,</span> password<span class="token punctuation">,</span> db_name<span class="token punctuation">,</span> charset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 初始化数据库操作</span>

    self<span class="token punctuation">.</span>db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span>host<span class="token punctuation">,</span> port<span class="token operator">=</span>port<span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">,</span>password<span class="token operator">=</span>password<span class="token punctuation">,</span> database<span class="token operator">=</span>db_name<span class="token punctuation">,</span> charset<span class="token operator">=</span>charset<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>cursor <span class="token operator">=</span> self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 关闭数据库连接</span>

    self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="32__68"></a>3.2 获取数据库表元信息</h4> 
<p>根据上面说的 pymysql 的基本操作，只需要执行查询数据表元信息的 SQL 即可。前面已经提到，MySQL 的查询表元信息的 SQL 语句是<code>SELECT * FROM information_schema.TABLES WHERE TABLE_SCHEMA = %db_name%</code> ，而我们只需要表名及表注释即可。因此实现如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_table_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> db_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取数据表信息</span>

    sql <span class="token operator">=</span> <span class="token triple-quoted-string string">'''SELECT table_schema, table_name, table_comment FROM information_schema.`TABLES` WHERE TABLE_SCHEMA = %s order by table_name'''</span>
    params <span class="token operator">=</span> <span class="token punctuation">[</span>db_name<span class="token punctuation">]</span>
    <span class="token comment"># 查询数据</span>
    self<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>此函数功能：传入数据库名，返回所有表信息。</p> 
<h3><a id="4__87"></a>4 获取数据表字段的元信息</h3> 
<p>获取到表信息后，同样的道理，需要遍历每一个表，根据表名获取每个表的字段信息。前面已经到，MySQL 获取表的字段是查询表 <code>information_schema.COLUMNS</code>即可，而对于字段信息， 我们主要关注字段名、字段类型、 是否允许为空、字段的注释描述等信息。代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_table_column_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> database_name<span class="token punctuation">,</span> table_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取数据表列信息</span>

    params <span class="token operator">=</span> <span class="token punctuation">[</span>database_name<span class="token punctuation">,</span> table_name<span class="token punctuation">]</span>
    sql <span class="token operator">=</span> <span class="token triple-quoted-string string">'''SELECT
                TABLE_SCHEMA AS '库名',TABLE_NAME AS '表名',
                COLUMN_NAME AS '列名',ORDINAL_POSITION AS '列的排列顺序',
                COLUMN_DEFAULT AS '默认值',IS_NULLABLE AS '是否为空',
                DATA_TYPE AS '数据类型',CHARACTER_MAXIMUM_LENGTH AS '字符最大长度',
                NUMERIC_PRECISION AS '数值精度(最大位数)',NUMERIC_SCALE AS '小数精度',
                COLUMN_TYPE AS '列类型',COLUMN_COMMENT AS '注释'
            FROM information_schema.`COLUMNS`
            WHERE TABLE_SCHEMA = %s AND TABLE_NAME = %s
            ORDER BY TABLE_NAME, ORDINAL_POSITION'''</span>
    <span class="token comment"># 查询数据</span>
    self<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>此函数功能，根据数据库名及表名，获取此表的字段信息。</p> 
<h3><a id="5__excel__115"></a>5 生成 excel 文档</h3> 
<h4><a id="51__excel__117"></a>5.1 输出表字段信息到 excel 文档</h4> 
<p>对于 excel 的操作，我们使用 openpyxl 进行读写操作，具体 excel 操作，可参考我上一篇文章《<a href="https://mp.weixin.qq.com/s/GAoOOXebxshW1fGCLJc8BQ" rel="nofollow"> Python 处理 Excel 文件</a>》。而现在我们需要实现的功能是把每个表的字段信息，以表格的方式写入到 excel 表中，并按字段名、允许为空、字段类型、字段描述进行输出。</p> 
<p>还有一点就是，我们经常在设计表的的过程中，基本都会有一些公共的字段，比如 id ，创建时间、创建人、修改时间、修改人等，这些我们在导出字典时，可以选择过滤掉。因此，使用如下代码进行实现：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">create_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取文件，若文件不存在则创建，存在则删除后重新创建</span>

    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
    wb <span class="token operator">=</span> Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
    wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
    
<span class="token keyword">def</span> <span class="token function">save_column_info_to_excel</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> table_name<span class="token punctuation">,</span> table_comment<span class="token punctuation">,</span> column_info<span class="token punctuation">,</span> file_path<span class="token punctuation">,</span> col_names_skip<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 写入表信息到excel文件</span>

    workbook <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
    <span class="token comment"># 根据下标获取（下标从0开始）</span>
    sheet <span class="token operator">=</span> workbook<span class="token punctuation">.</span>worksheets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    row_data <span class="token operator">=</span> <span class="token punctuation">[</span>table_name<span class="token punctuation">]</span>
    <span class="token keyword">if</span> table_comment<span class="token punctuation">:</span>
        row_data <span class="token operator">=</span> <span class="token punctuation">[</span>table_name <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span> table_comment <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">]</span>
        sheet<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row_data<span class="token punctuation">)</span>
        rurrent_max_row <span class="token operator">=</span> sheet<span class="token punctuation">.</span>max_row
        <span class="token comment"># 空行分隔</span>
        sheet<span class="token punctuation">.</span>insert_rows<span class="token punctuation">(</span>rurrent_max_row<span class="token punctuation">)</span>
        <span class="token comment"># 列名</span>
        col_name_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"字段名"</span><span class="token punctuation">,</span> <span class="token string">"允许为空"</span><span class="token punctuation">,</span> <span class="token string">"类型"</span><span class="token punctuation">,</span> <span class="token string">"字段描述"</span><span class="token punctuation">]</span>
        sheet<span class="token punctuation">.</span>append<span class="token punctuation">(</span>col_name_data<span class="token punctuation">)</span>
        <span class="token keyword">for</span> row <span class="token keyword">in</span> column_info<span class="token punctuation">:</span>
            <span class="token comment"># 需要过滤的</span>
            <span class="token keyword">if</span> col_names_skip <span class="token operator">and</span> row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> col_names_skip<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"#"</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"跳过此字段："</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> row<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> row<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> row<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            row_data <span class="token operator">=</span> <span class="token punctuation">[</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
            sheet<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row_data<span class="token punctuation">)</span>
        <span class="token comment"># 保存文档</span>
        workbook<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
</code></pre> 
<p>此处包含两个函数，<code>create_file</code> 功能主要是创建文档，若文档存在则先删除。<code>save_column_info_to_excel</code>功能是根据表字段信息及需要过滤的字段名，使用 for 语句按行输出到 excel 中，输出过程中，若有需要过滤的字段则跳过，最后把文档保存到指定的路径中。</p> 
<h4><a id="52__162"></a>5.2 把各功能连接起来</h4> 
<p>前面已经实现数据库表元信息获取、数据表字段元信息获取及字段信息输出到 excel 文档三个功能。现在把这三个功能连接起来，就可以形成完整的数据库文档导出功能了。思路是遍历生成的表元信息( get_table_info )，根据表元信息获取表的字段信息( gen_table_column_info )，然后输出 excel 文档( save_column_info_to_excel )，如下所示：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">gen_db_table_info_skip_col</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> db_name<span class="token punctuation">,</span> file_path<span class="token punctuation">,</span> col_names_skip<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 过滤指定列，导出数据表信息到文档</span>

    table_info_rows <span class="token operator">=</span> self<span class="token punctuation">.</span>get_table_info<span class="token punctuation">(</span>db_name<span class="token punctuation">)</span>
    <span class="token keyword">for</span> table_row <span class="token keyword">in</span> table_info_rows<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">"*"</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"生成表信息："</span><span class="token punctuation">,</span> table_row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>gen_table_column_info<span class="token punctuation">(</span>table_row<span class="token punctuation">,</span> file_path<span class="token punctuation">,</span> col_names_skip<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">gen_table_column_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> table_info_row<span class="token punctuation">,</span> file_path<span class="token punctuation">,</span> col_names_skip<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 导出字段信息表到文档</span>

    database_name <span class="token operator">=</span> table_info_row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    table_name <span class="token operator">=</span> table_info_row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    table_comment <span class="token operator">=</span> table_info_row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token comment"># 从数据库获取表信息</span>
    column_info <span class="token operator">=</span> self<span class="token punctuation">.</span>get_table_column_info<span class="token punctuation">(</span>database_name<span class="token punctuation">,</span> table_name<span class="token punctuation">)</span>
    <span class="token comment"># 写入excel文件</span>
    self<span class="token punctuation">.</span>save_column_info_to_excel<span class="token punctuation">(</span>table_name<span class="token punctuation">,</span> table_comment<span class="token punctuation">,</span> column_info<span class="token punctuation">,</span> file_path<span class="token punctuation">,</span> col_names_skip<span class="token punctuation">)</span>
</code></pre> 
<p>此处包含两个函数，<code>gen_db_table_info_skip_col</code> 功能是根据数据库名、文件保存路径、需要过滤的字段名导出表元信息，然后使用 for 语句进行遍历。<code>gen_table_column_info</code> 是根据表信息及需要过滤的字段，先读表字段信息，然后写入到 excel 文档。注意，此处<code>col_names_skip</code> 默认值为 None ，即如果不需要过滤，不输入此参数即可。至此，我们自动生成数据库文档的功能已完成。在<code>__main__</code> 中执行看一下输出情况：</p> 
<pre><code class="prism language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 输出文档地址</span>
    excel_path <span class="token operator">=</span> <span class="token string">"E:/pythontest/test_tableinfo.xlsx"</span>
    <span class="token comment"># 数据库连接信息</span>
    host <span class="token operator">=</span> <span class="token string">"localhost"</span>
    port <span class="token operator">=</span> <span class="token number">3306</span>
    user <span class="token operator">=</span> <span class="token string">"root"</span>
    password <span class="token operator">=</span> <span class="token string">"123456"</span>
    db_name <span class="token operator">=</span> <span class="token string">"test"</span>
    charset <span class="token operator">=</span> <span class="token string">'utf8'</span>
    <span class="token comment"># 需要过滤的字段</span>
    col_names_to_skip <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"sys_create_time"</span><span class="token punctuation">,</span> <span class="token string">"sys_create_user"</span><span class="token punctuation">,</span> <span class="token string">"sys_update_time"</span><span class="token punctuation">,</span> <span class="token string">"sys_update_user"</span><span class="token punctuation">,</span> <span class="token string">"record_version"</span><span class="token punctuation">]</span>
	<span class="token comment"># 初始化类，创建文件，生成数据库说明文档</span>
    dbInfoGenerator <span class="token operator">=</span> DbInfoGenerator<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> user<span class="token punctuation">,</span> password<span class="token punctuation">,</span> db_name<span class="token punctuation">,</span> charset<span class="token punctuation">)</span>
    dbInfoGenerator<span class="token punctuation">.</span>create_file<span class="token punctuation">(</span>excel_path<span class="token punctuation">)</span>
    dbInfoGenerator<span class="token punctuation">.</span>gen_db_table_info_skip_col<span class="token punctuation">(</span>db_name<span class="token punctuation">,</span> excel_path<span class="token punctuation">,</span> col_names_to_skip<span class="token punctuation">)</span>
</code></pre> 
<p>结果如下：</p> 
<p><img src="https://images2.imgbox.com/c2/95/yzyKElv2_o.png" alt="无格式数据库说明文档"></p> 
<p>表的字段说明已输出到 excel 文档中，对应的字段也已过滤。只是格式不是很好看，因此，有需要的可以用 openpyxl 对 excel 文档的格式进行设置即可。</p> 
<h3><a id="6__excel__214"></a>6 （可选）设置 excel 文档格式</h3> 
<p>如果需要对 excel 文档进行格式设置，以下是我的一个基本格式设置，有需要的可以参考一下，制作适合自己的文档格式。格式的设置思路主要如下：</p> 
<ul><li>设置各列的宽度</li><li>遍历 excel 表每一行，如果是表名，则合并为一行作为表头，设置表头格式为加粗、加黑色边框、居中对齐、填充背景色。</li><li>如果表字段信息内容，则设置黑色边框即可。</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">set_file_format</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置表格式</span>

    <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"文件不存在，不处理"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    workbook <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
    sheet <span class="token operator">=</span> workbook<span class="token punctuation">.</span>worksheets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># 设置各列宽</span>
    sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">16</span>
    sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">"B"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">10</span>
    sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">20</span>
    sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">"D"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">40</span>

    <span class="token comment"># 设置表名格式</span>
    max_row <span class="token operator">=</span> sheet<span class="token punctuation">.</span>max_row
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_row <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        col1_value <span class="token operator">=</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        col2_value <span class="token operator">=</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
        <span class="token comment"># 首列有数据，第2列无数据，则为表名</span>
        <span class="token keyword">if</span> col1_value <span class="token operator">and</span> <span class="token operator">not</span> col2_value<span class="token punctuation">:</span>
            <span class="token comment"># 合并表名</span>
            sheet<span class="token punctuation">.</span>merge_cells<span class="token punctuation">(</span>start_row<span class="token operator">=</span>i<span class="token punctuation">,</span> start_column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> end_row<span class="token operator">=</span>i<span class="token punctuation">,</span> end_column<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
            <span class="token comment"># 加粗字体</span>
            font <span class="token operator">=</span> Font<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"微软雅黑"</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> bold<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> italic<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"000000"</span><span class="token punctuation">)</span>
            <span class="token comment"># 黑色边框</span>
            side_style <span class="token operator">=</span> Side<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">"thin"</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"000000"</span><span class="token punctuation">)</span>
            border <span class="token operator">=</span> Border<span class="token punctuation">(</span>left<span class="token operator">=</span>side_style<span class="token punctuation">,</span> right<span class="token operator">=</span>side_style<span class="token punctuation">,</span> top<span class="token operator">=</span>side_style<span class="token punctuation">,</span> bottom<span class="token operator">=</span>side_style<span class="token punctuation">)</span>
            <span class="token comment"># 居中对齐</span>
            cell_alignment <span class="token operator">=</span> Alignment<span class="token punctuation">(</span>horizontal<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">,</span> vertical<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">,</span> wrap_text<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token comment"># 填充背景色</span>
            p_fill <span class="token operator">=</span> PatternFill<span class="token punctuation">(</span>fill_type<span class="token operator">=</span><span class="token string">"solid"</span><span class="token punctuation">,</span> fgColor<span class="token operator">=</span><span class="token string">"BFBFBF"</span><span class="token punctuation">)</span>
            <span class="token comment"># 表名cell格式</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">.</span>font <span class="token operator">=</span> font
                sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">.</span>border <span class="token operator">=</span> border
                sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">.</span>alignment <span class="token operator">=</span> cell_alignment
                sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">.</span>fill <span class="token operator">=</span> p_fill
         <span class="token comment"># 若首列和第2列都有数据，则是表内容</span>
         <span class="token keyword">if</span> col1_value <span class="token operator">and</span> col2_value<span class="token punctuation">:</span>
            <span class="token comment"># 黑色边框</span>
            side_style <span class="token operator">=</span> Side<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">"thin"</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"000000"</span><span class="token punctuation">)</span>
            border <span class="token operator">=</span> Border<span class="token punctuation">(</span>left<span class="token operator">=</span>side_style<span class="token punctuation">,</span> right<span class="token operator">=</span>side_style<span class="token punctuation">,</span> top<span class="token operator">=</span>side_style<span class="token punctuation">,</span> bottom<span class="token operator">=</span>side_style<span class="token punctuation">)</span>
            <span class="token comment"># 表名cell格式</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">.</span>border <span class="token operator">=</span> border
    <span class="token comment"># 保存文档</span>
    workbook<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
</code></pre> 
<p>当生成数据库说明文档后，调用此函数，即可修改其文档格式，效果如下：</p> 
<p><img src="https://images2.imgbox.com/1b/b2/PwAEWAcx_o.png" alt="带格式的数据库说明文档"></p> 
<h3><a id="7__277"></a>7 总结</h3> 
<p>本文主要针对数据库说明文档（数据字典）的自动化生成进行讲解。通过使用 SQL 读取数据库表及字段元信息，然后输出到 excel 文档的思路，以 python 的实现方式完成自动生成文档功能。如果你还在手工生成数据库说明文档，可以试试这种方法，一定让你效率大增。希望可以帮助到有需要的人。如果想看完整的代码，可到我 <a href="https://github.com/mianshenglee/my-example/tree/master/python/tool-gen-db-doc">github</a> 地址中查看：<code>https://github.com/mianshenglee/my-example/tree/master/python/tool-gen-db-doc</code></p> 
<p>根据本文实现的思路，最后可以留几个思考题给大家，想想如何做：</p> 
<ul><li>不使用 python ，用其它你熟悉的语言来实现此功能。</li><li>如何只需要生成指定表的字段信息或者过滤指定表，怎么做？</li><li>数据库表名一般都会有前缀或后缀，能否根据前缀或后缀来过滤生成或者过滤，怎么做？</li><li>本文是生成 excel 文档，如果需要生成 word 、html 、md 、pdf 等格式的文档，怎么做？</li></ul> 
<h3><a id="_288"></a>参考资料</h3> 
<ul><li><a href="https://openpyxl.readthedocs.io/" rel="nofollow">openpyxl官方文档</a>: <code>https://openpyxl.readthedocs.io/</code></li><li><a href="https://pymysql.readthedocs.io/en/latest/" rel="nofollow">pymysql官方文档</a>: <code>https://pymysql.readthedocs.io/en/latest/</code></li></ul> 
<h3><a id="_295"></a>往期文章</h3> 
<ul><li><a href="https://mp.weixin.qq.com/s/GAoOOXebxshW1fGCLJc8BQ" rel="nofollow">Python 处理 Excel 文件</a></li><li><a href="https://mp.weixin.qq.com/s/neO8OuWu7Za41xcdmwu2wA" rel="nofollow">python基本操作-文件、目录及路径</a></li><li><a href="https://mp.weixin.qq.com/s/LX-4jhVV7FbB-TA8jcWYOA" rel="nofollow">MinIO 的分布式部署</a></li><li><a href="https://mp.weixin.qq.com/s/rzaqPmpTOUJJsKISr6eF9Q" rel="nofollow">利用MinIO轻松搭建静态资源服务</a></li><li><a href="https://mp.weixin.qq.com/s/ZzzPJZAhPiGCQjN3RNZJ3Q" rel="nofollow">搞定SpringBoot多数据源(3)：参数化变更源</a></li><li><a href="https://mp.weixin.qq.com/s/neIN3htjkn4bifPpdq5l7w" rel="nofollow">搞定SpringBoot多数据源(2)：动态数据源</a></li><li><a href="https://mp.weixin.qq.com/s/0J-FLYScYtEMnj0vZToX7g" rel="nofollow">搞定SpringBoot多数据源(1)：多套源策略</a></li><li><a href="https://mp.weixin.qq.com/s/a3x_pKUryb_at_4Xk48IiQ" rel="nofollow">java开发必学知识:动态代理</a></li><li><a href="https://mp.weixin.qq.com/s/Wlbjhohb_HrqT67lstwVwA" rel="nofollow">2019 读过的好书推荐</a></li></ul> 
<p>我的公众号（搜索<code>Mason技术记录</code>），获取更多技术记录：</p> 
<p><img src="https://images2.imgbox.com/c8/ec/5xISF4Sp_o.png" alt="mason"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/768975b1e19af01eb48cbb9c2cebe98f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">B站直播画中画设置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/253c66f8b500038ffc4d187c3c49e228/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何pycharm添加扩展工具 --学习pyqt5如何将ui文件转成py文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>