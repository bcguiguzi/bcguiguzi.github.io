<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>搭建个人智能家居 3 -第一个设备“点灯” - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="搭建个人智能家居 3 -第一个设备“点灯”" />
<meta property="og:description" content="搭建个人智能家居 3 -第一个外设“点灯” 前言ESPHome点灯 HomeAssistant 前言 前面我们已经完成了搭建这个智能家居所需要的环境HomeAssistant和ESPHome，今天我们开始在这个智能家居中添加我们的第一个设备（一颗LED灯），如果环境还没有搭建好，可以参考前面的两篇文章。
搭建个人智能家居 开篇（搭建Home Assistant）
搭建个人智能家居 2 -安装ESPHome
本次可以分成两步：
第一步是ESPHome编写yaml文件并烧录到ESP32开发板
第二步是HomeAssistant添加控制组件
ESPHome 点灯 这次点亮LED的演示会用ESP32开发板上的板载的LED，通过控制ESP32的某一个IO口输出高/低电平来控制LED灯的点亮和熄灭，这同样适用于用来控制继电器开关，这一类只有高低电平的两种状态的执行器、传感器在ESPHome中叫二进制传感器，在ESPHome中有专门的二进制组件去实现对这一类传感器的控制使用，但是ESPHome官方提供的Light组件中就包含有二进制LED，所以这一次控制的LED将会用ESPHome官方的Light组件去写yaml文件实现。那么现在开始在ESPHome创建设备并编写yaml文件。
在“ESPHome安装”（跳转）的那篇文章中有新建ESPHome的工程的演示，这里就不做过多的赘述，跳过新建工程的过程。
进入ESPHome的控制页面后点击“新建设备”
点击新建设备后会弹出一个对话框提示输入设备名称，按要求输入就行
接着点击“NEXT”下一步，然后跳过在线安装，选择设备，这边演示用的是ESP32的板子，所以选ESP32，如果用的是ESP32-S2、S3或者8266等选择相应的型号就行了
选择好开发板型号后，完成设备创建。
出现上面弹窗，里面的key可以记录一下，后续HomeAssistant里连接设备需要用，yaml文件里也有体现。点击跳过，到这里工程雏形已经创建好了，点击“EDIT”，进入编辑yaml文件
创建好的工程里面有一些默认的配置，开发板类型、框架、联网参数等，把鼠标的光标移到相应的地方会出现说明，感兴趣的可以去了解一下他的构成内容，这里不做过多讲解，继续“点灯”。
第一个要编辑的是把ESP32需要连接的wifi的SSID和Password填进去，注意ESP32不支持5G频段的WIFI，所以填入一个和HomeAssistant控制页面主机在同一个局域网的2.4GWIFI参数
然后在最后面插入我们调用Light组件控制LED亮起熄灭的代码。
light: - platform: binary name: &#34;led&#34; output: bin_led //说明： //创建一个名字为led的设备，创建的这个led继承Light组件，属于Light组件中的“binary（二进制）”类型的设备 //因为这个led是通过GPIO输出高低电平实现的，所以定义一个output的ID，与下面output的实现对应起来 output: - id: bin_led platform: gpio pin: GPIO2 //说明： //id对应上面的led这个设备的id，说明这个output是上面led设备的实现 //通过GPIO2来控制led的亮灭 由于这次用的ESP32板载的LED灯是用GPIO2控制的，所以配置的是GPIO2，如果你们控制led的引脚不同可以通过更改
pin: GPIOxx 实现。
到这里，控制手上ESP32开发板上的led需要写的yaml文件内容已经完成了点击右上角的“SAVE”保存再点“INSTALL”，弹窗选择安装yaml文件的，由于是第一次烧录，选择最后一个手动烧录
点击后开始编译
编译完成后弹窗提示选择烧录方式，选择第一个，生成bin文件用Flash Download Tools烧录
用Flash Download Tools（点击下载）把生成的bin文件烧录到ESP32开发板中，烧录过程这里不做赘述，跳过…
烧录完成后，打开串口助手，看串口返回的日志可以确认是否连上WIFI。
确认好ESP32成功联网并成功运行后，在和ESP32连的WIFI在同一局域网的主机运行HomeAsstant，并进入控制台。
HomeAssistant 运行HomeAssistant
打开控制台，点击左边导航栏的配置
如果上面配置的ESP32和这HomeAssistant主机是在同一个局域网，在“集成”中的已发现会出现在ESPHome中创建的设备名称。
点击配置" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/3491cead3110696fd77f0d59c8952d79/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-14T09:16:38+08:00" />
<meta property="article:modified_time" content="2024-03-14T09:16:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">搭建个人智能家居 3 -第一个设备“点灯”</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>搭建个人智能家居 3 -第一个外设“点灯”</h4> 
 <ul><li><a href="#_2" rel="nofollow">前言</a></li><li><a href="#ESPHome_11" rel="nofollow">ESPHome</a></li><li><ul><li><a href="#_12" rel="nofollow">点灯</a></li></ul> 
  </li><li><a href="#HomeAssistant_73" rel="nofollow">HomeAssistant</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>前言</h2> 
<p>前面我们已经完成了搭建这个智能家居所需要的环境HomeAssistant和ESPHome，今天我们开始在这个智能家居中添加我们的第一个设备（一颗LED灯），如果环境还没有搭建好，可以参考前面的两篇文章。<br> <a href="https://blog.csdn.net/qq_42250136/article/details/134979153?spm=1001.2014.3001.5501">搭建个人智能家居 开篇（搭建Home Assistant）</a><br> <a href="https://blog.csdn.net/qq_42250136/article/details/135544790?spm=1001.2014.3001.5501">搭建个人智能家居 2 -安装ESPHome</a><br> <img src="https://images2.imgbox.com/2c/71/TjfYJ7jB_o.jpg" alt="在这里插入图片描述" width="400"><br> 本次可以分成两步：<br> 第一步是ESPHome编写yaml文件并烧录到ESP32开发板<br> 第二步是HomeAssistant添加控制组件</p> 
<h2><a id="ESPHome_11"></a>ESPHome</h2> 
<h3><a id="_12"></a>点灯</h3> 
<p>这次点亮LED的演示会用ESP32开发板上的板载的LED，通过控制ESP32的某一个IO口输出高/低电平来控制LED灯的点亮和熄灭，这同样适用于用来控制继电器开关，这一类只有高低电平的两种状态的执行器、传感器在ESPHome中叫二进制传感器，在ESPHome中有专门的二进制组件去实现对这一类传感器的控制使用，但是ESPHome官方提供的Light组件中就包含有二进制LED，所以这一次控制的LED将会用ESPHome官方的Light组件去写yaml文件实现。那么现在开始在ESPHome创建设备并编写yaml文件。<br> 在“ESPHome安装”（<a href="https://blog.csdn.net/qq_42250136/article/details/135544790?spm=1001.2014.3001.5501">跳转</a>）的那篇文章中有新建ESPHome的工程的演示，这里就不做过多的赘述，跳过新建工程的过程。<br> 进入ESPHome的控制页面后点击“新建设备”<br> <img src="https://images2.imgbox.com/77/bd/QeG5TVGw_o.png" alt="在这里插入图片描述" width="400"><br> 点击新建设备后会弹出一个对话框提示输入设备名称，按要求输入就行<br> <img src="https://images2.imgbox.com/91/02/HCy2KEu4_o.png" alt="在这里插入图片描述" width="400"><br> 接着点击“NEXT”下一步，然后跳过在线安装，选择设备，这边演示用的是ESP32的板子，所以选ESP32，如果用的是ESP32-S2、S3或者8266等选择相应的型号就行了<br> <img src="https://images2.imgbox.com/15/ae/WCepGxVH_o.png" alt="在这里插入图片描述" width="400"><br> 选择好开发板型号后，完成设备创建。<br> <img src="https://images2.imgbox.com/d3/dd/d5E2oveY_o.png" alt="在这里插入图片描述" width="400"><br> 出现上面弹窗，里面的key可以记录一下，后续HomeAssistant里连接设备需要用，yaml文件里也有体现。点击跳过，到这里工程雏形已经创建好了，点击“EDIT”，进入编辑yaml文件<br> <img src="https://images2.imgbox.com/29/98/DAm2xKAv_o.png" alt="在这里插入图片描述" width="400"></p> 
<p>创建好的工程里面有一些默认的配置，开发板类型、框架、联网参数等，把鼠标的光标移到相应的地方会出现说明，感兴趣的可以去了解一下他的构成内容，这里不做过多讲解，继续“点灯”。<br> 第一个要编辑的是把ESP32需要连接的wifi的SSID和Password填进去，注意ESP32不支持5G频段的WIFI，所以填入一个和HomeAssistant控制页面主机在同一个局域网的2.4GWIFI参数<br> <img src="https://images2.imgbox.com/7b/a9/Qi5tjpFU_o.png" alt="在这里插入图片描述" width="400"><br> 然后在最后面插入我们调用Light组件控制LED亮起熄灭的代码。</p> 
<pre><code class="prism language-cpp">light<span class="token operator">:</span>
  <span class="token operator">-</span> platform<span class="token operator">:</span> binary
    name<span class="token operator">:</span> <span class="token string">"led"</span>
    output<span class="token operator">:</span> bin_led
<span class="token comment">//说明：</span>
<span class="token comment">//创建一个名字为led的设备，创建的这个led继承Light组件，属于Light组件中的“binary（二进制）”类型的设备</span>
<span class="token comment">//因为这个led是通过GPIO输出高低电平实现的，所以定义一个output的ID，与下面output的实现对应起来</span>

output<span class="token operator">:</span>
  <span class="token operator">-</span> id<span class="token operator">:</span> bin_led
    platform<span class="token operator">:</span> gpio
    pin<span class="token operator">:</span> GPIO2 
<span class="token comment">//说明：</span>
<span class="token comment">//id对应上面的led这个设备的id，说明这个output是上面led设备的实现</span>
<span class="token comment">//通过GPIO2来控制led的亮灭</span>


</code></pre> 
<p>由于这次用的ESP32板载的LED灯是用GPIO2控制的，所以配置的是GPIO2，如果你们控制led的引脚不同可以通过更改</p> 
<pre><code class="prism language-bash">pin: GPIOxx
</code></pre> 
<p>实现。<br> 到这里，控制手上ESP32开发板上的led需要写的yaml文件内容已经完成了点击右上角的“SAVE”保存再点“INSTALL”，弹窗选择安装yaml文件的，由于是第一次烧录，选择最后一个手动烧录<br> <img src="https://images2.imgbox.com/29/d3/Co99pios_o.png" alt="在这里插入图片描述" width="400"><br> 点击后开始编译<br> <img src="https://images2.imgbox.com/24/cd/b1EwVGA9_o.png" alt="在这里插入图片描述" width="400"><br> 编译完成后弹窗提示选择烧录方式，选择第一个，生成bin文件用Flash Download Tools烧录<br> <img src="https://images2.imgbox.com/cb/d2/8uAv9crO_o.png" alt="在这里插入图片描述" width="400"><br> <img src="https://images2.imgbox.com/a6/04/q8lFoEbp_o.png" alt="在这里插入图片描述" width="400"><br> 用Flash Download Tools（<a href="https://www.espressif.com.cn/sites/default/files/tools/flash_download_tool_3.9.5_0.zip" rel="nofollow">点击下载</a>）把生成的bin文件烧录到ESP32开发板中，烧录过程这里不做赘述，跳过…<br> 烧录完成后，打开串口助手，看串口返回的日志可以确认是否连上WIFI。<br> 确认好ESP32成功联网并成功运行后，在和ESP32连的WIFI在同一局域网的主机运行HomeAsstant，并进入控制台。</p> 
<h2><a id="HomeAssistant_73"></a>HomeAssistant</h2> 
<p>运行HomeAssistant<br> <img src="https://images2.imgbox.com/c4/06/dZQ2zIWg_o.png" alt="在这里插入图片描述" width="400"><br> 打开控制台，点击左边导航栏的配置<br> <img src="https://images2.imgbox.com/b9/e4/Q5oECTFo_o.png" alt="在这里插入图片描述" width="400"><br> <img src="https://images2.imgbox.com/3e/47/p6zVnjEw_o.png" alt="在这里插入图片描述" width="400"><br> 如果上面配置的ESP32和这HomeAssistant主机是在同一个局域网，在“集成”中的已发现会出现在ESPHome中创建的设备名称。<br> 点击配置<br> <img src="https://images2.imgbox.com/7b/f5/EhCKQv5Z_o.png" alt="在这里插入图片描述" width="400"><br> <img src="https://images2.imgbox.com/1a/62/UW5YSkhE_o.png" alt="在这里插入图片描述" width="400"><br> 在文本框中输入上面ESPHome创建设备时的密钥，如果忘记了可以打开ESPHome控制台进入设备的yaml文件看<br> <img src="https://images2.imgbox.com/72/be/0Wqy0xBx_o.png" alt="在这里插入图片描述" width="400"><br> <img src="https://images2.imgbox.com/ab/07/Kmqy77rY_o.png" alt="在这里插入图片描述" width="400"><br> 填入后，完成添加设备的一些个性化配置即可。<br> 配置完成后回到控制台的“概览”，你会发现主页中多了一个控制组件。<br> <img src="https://images2.imgbox.com/87/9f/OHs8WYxQ_o.png" alt="在这里插入图片描述" width="400"><br> 这就是，通过点击这个控制组件的开关就可以控制LED的亮灭了。<br> 关灯状态<br> <img src="https://images2.imgbox.com/46/0e/E2G3pQT7_o.png" alt="在这里插入图片描述" width="400"><br> <img src="https://images2.imgbox.com/a6/11/DtdoXn2F_o.png" alt="在这里插入图片描述" width="400"><br> 开灯状态<br> <img src="https://images2.imgbox.com/74/84/RNDwLvcF_o.png" alt="在这里插入图片描述" width="400"><br> <img src="https://images2.imgbox.com/c6/c8/1rxXJatD_o.png" alt="在这里插入图片描述" width="400"></p> 
<p>点灯完成。<br> 其他更多的二进制设备可以通过ESPHome官方提供的二进制组件去开发控制。<br> 移动端安装了HomeAssistant的APP通过局域网登录电脑端注册时的账号也是可以控制的，感兴趣的可以去试一下。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0dfc011b70f3731e4994695a3d053651/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VsCode免密登录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/806297c251f03cddeaa3b2298e918fbf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">生产实践｜腾讯欧拉平台数据血缘架构</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>