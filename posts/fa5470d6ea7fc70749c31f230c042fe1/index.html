<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CentOS 7 在vmware中的网络设置 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CentOS 7 在vmware中的网络设置" />
<meta property="og:description" content="一环境说明二centos在vmware中的安装三NAT网络设置四设置固定IP 1修改网卡配置说明2修改etcresolvconf 实现域名解析 五设置防火墙iptables 1 centos安装telnet2 防火墙iptables设置 六 总结 前言：由于工作中需要使用Linux，在虚拟机中装了CentOS7，以作实验之用，安装后使用过程中出现不少问题，主要是网络问题，安装后出现下列几种状况： （1）宿主机网络正常，在虚拟机的centos中无法访问外网。 （2）宿主机可以ping通，且可以使用SSH连接，但无法telnet虚拟机centos的端口。 （3）centos 固定IP问题 （4）防火墙设置问题 经过查阅相关资料及实践，才把网络问题解决，在此记录一下。
一、环境说明 vmware workstation 10Linunx系统：CentOS7，官网下载地址 二、centos在vmware中的安装 CentOS7在vmware虚拟机中安装流程不复杂，网上已有很多教程（可参考其中一篇(百度经验上的)），本文不重复，简要作以下说明及注意地方。
使用典型安装，安装程序光盘映像文件按机器实际情况选择CPU、磁盘大小，本机是i7，8g内存，分配了2g，2核给CentOS7。重点： 网络类型有三种可参考此文章，由于不想占用当前已有的IP，选择NAT，以宿主机为路由。安装软件类型可选择最小安装，也可选择文件服务器、基本网页服务器等。建议最小安装，干净。 三、NAT网络设置 使用NAT网络设置，不占用IP资源，设置方法可参考这篇文章，这里作主要几个重要设置点说明： （1）设置虚拟机为NAT网络，右击虚拟机-&gt;设置，如下图： （2）查看VMnet8的网络设置 控制面板-&gt;网络和 Internet-&gt;网络连接，可见vmnet1和vmnet8两个虚拟网卡，查看vmnet8，右击-&gt;属性，查看ipv4地址，可见vmware已自动分配了一个地址。如下： （3）共享网络 实际网卡-&gt;右击-&gt;共享，如下 （3）设置虚拟网络编辑器，编辑-&gt;虚拟网络编辑器，如下： 此处的子网IP与vmnet8网段一致，vmnet8是192.168.31.1，则此处设置为192.168.31.0即可。掩码与vmnet8一致。 另外，“使用本地dhcp服务将IP地址分配给虚拟机”可以先勾选，后面固定IP的时候再取消。 （4）NAT设置 设置后，进入虚拟机，如无意外，是可以正常连接网络了。 （5）查看IP并测试 使用ifconfig进行测试，此处可查看到虚拟的IP，它的IP是dhcp自动分配的。 [root@localhost sysconfig]# ifconfig 在虚拟机ping宿主机IP，测试是否连通： [root@localhost sysconfig]# ping 192.168.31.1 `` 在宿主机ping虚拟机IP，测试是否连通： [root@localhost sysconfig]# ping 192.168.31.128 “ 若能连通，即证明网络设置完成，可以使用SSH连接虚拟机centos了。
四、设置固定IP 按上述方法，虽然可以连通，但由于是使用dhcp动态分配的，每次重启后，可能会变化，因此最好把它设置为固定IP。可以参考此文 以下几点需要注意一下：
VMware虚拟网络编辑器中取消“使用本地DHCP服务将IP地址分配给虚拟机”的勾选。修改/etc/sysconfig/network-scripts/中ifcfg开头的对应的网卡配置。修改/etc/resolv.conf ，添加域名解析。 （1）修改网卡配置说明 注意当前网卡的名称，使用ifconfig可查看到，本机安装后网卡名称是：ifcfg-eno16777736； 打开此文件，主要配置以下几项（无则添加上去）：
ONBOOT=yes 设置为开机后启动 IPADDR=192.168.31.128 #此处设置固定的IP NETMASK=255.255.255.0 #此处设置掩码 GATEWAY=192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/fa5470d6ea7fc70749c31f230c042fe1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-08-30T17:10:12+08:00" />
<meta property="article:modified_time" content="2015-08-30T17:10:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CentOS 7 在vmware中的网络设置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <div class="toc"> 
  <ul><li> 
    <ul><li><a href="#%E4%B8%80%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E" rel="nofollow">一环境说明</a></li><li><a href="#%E4%BA%8Ccentos%E5%9C%A8vmware%E4%B8%AD%E7%9A%84%E5%AE%89%E8%A3%85" rel="nofollow">二centos在vmware中的安装</a></li><li><a href="#%E4%B8%89nat%E7%BD%91%E7%BB%9C%E8%AE%BE%E7%BD%AE" rel="nofollow">三NAT网络设置</a></li><li><a href="#%E5%9B%9B%E8%AE%BE%E7%BD%AE%E5%9B%BA%E5%AE%9Aip" rel="nofollow">四设置固定IP</a> 
      <ul><li><a href="#1%E4%BF%AE%E6%94%B9%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E" rel="nofollow">1修改网卡配置说明</a></li><li><a href="#2%E4%BF%AE%E6%94%B9etcresolvconf-%E5%AE%9E%E7%8E%B0%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90" rel="nofollow">2修改etcresolvconf 实现域名解析</a></li></ul> </li><li><a href="#%E4%BA%94%E8%AE%BE%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99iptables" rel="nofollow">五设置防火墙iptables</a> 
      <ul><li><a href="#51-centos%E5%AE%89%E8%A3%85telnet" rel="nofollow">1 centos安装telnet</a></li><li><a href="#52-%E9%98%B2%E7%81%AB%E5%A2%99iptables%E8%AE%BE%E7%BD%AE" rel="nofollow">2 防火墙iptables设置</a></li></ul> </li><li><a href="#%E5%85%AD-%E6%80%BB%E7%BB%93" rel="nofollow">六 总结</a></li></ul> </li></ul> 
 </div> 
</div> 
<p></p> 
<blockquote> 
 <p><strong>前言</strong>：由于工作中需要使用Linux，在虚拟机中装了CentOS7，以作实验之用，安装后使用过程中出现不少问题，主要是网络问题，安装后出现下列几种状况： <br> （1）宿主机网络正常，在虚拟机的centos中无法访问外网。 <br> （2）宿主机可以ping通，且可以使用SSH连接，但无法telnet虚拟机centos的端口。 <br> （3）centos 固定IP问题 <br> （4）防火墙设置问题 <br> 经过查阅相关资料及实践，才把网络问题解决，在此记录一下。</p> 
</blockquote> 
<hr> 
<h3 id="一环境说明">一、环境说明</h3> 
<ul><li>vmware workstation 10</li><li>Linunx系统：CentOS7，<a href="https://www.centos.org/download/%20%E5%AE%98%E7%BD%91%E4%B8%8B%E8%BD%BD" rel="nofollow">官网下载地址</a></li></ul> 
<h3 id="二centos在vmware中的安装">二、centos在vmware中的安装</h3> 
<p>CentOS7在vmware虚拟机中安装流程不复杂，网上已有很多教程（可参考其中一篇<a href="http://jingyan.baidu.com/article/eae0782787b4c01fec548535.html" rel="nofollow">(百度经验上的)</a>），本文不重复，简要作以下说明及注意地方。</p> 
<blockquote> 
 <ul><li>使用典型安装，安装程序光盘映像文件</li><li>按机器实际情况选择CPU、磁盘大小，本机是i7，8g内存，分配了2g，2核给CentOS7。</li><li><strong>重点：</strong> 网络类型有三种<a href="http://blog.itpub.net/29362142/viewspace-1062041/" rel="nofollow">可参考此文章</a>，由于不想占用当前已有的IP，选择NAT，以宿主机为路由。</li><li>安装软件类型可选择最小安装，也可选择文件服务器、基本网页服务器等。建议最小安装，干净。</li></ul> 
</blockquote> 
<hr> 
<h3 id="三nat网络设置">三、NAT网络设置</h3> 
<p>使用NAT网络设置，不占用IP资源，设置方法可参考<a href="http://blog.csdn.net/pang040328/article/details/12427359">这篇文章</a>，这里作主要几个重要设置点说明： <br> （1）设置虚拟机为NAT网络，右击虚拟机-&gt;设置，如下图： <br> <img src="https://images2.imgbox.com/a5/94/Zlms41I3_o.png" alt="设置虚拟机网络" title=""> <br> （2）查看VMnet8的网络设置 <br> 控制面板-&gt;网络和 Internet-&gt;网络连接，可见vmnet1和vmnet8两个虚拟网卡，查看vmnet8，右击-&gt;属性，查看ipv4地址，可见vmware已自动分配了一个地址。如下： <br> <img src="https://images2.imgbox.com/39/89/WvG247yj_o.png" alt="ipv4" title=""> <br> （3）共享网络 <br> 实际网卡-&gt;右击-&gt;共享，如下 <br> <img src="https://images2.imgbox.com/0f/51/n5QnOHId_o.png" alt="共享网络" title=""> <br> （3）设置虚拟网络编辑器，编辑-&gt;虚拟网络编辑器，如下： <br> 此处的子网IP与vmnet8网段一致，vmnet8是192.168.31.1，则此处设置为192.168.31.0即可。掩码与vmnet8一致。 <br> 另外，“使用本地dhcp服务将IP地址分配给虚拟机”可以先勾选，后面固定IP的时候再取消。 <br> <img src="https://images2.imgbox.com/94/ea/AK8MY8LY_o.png" alt="设置网络编辑器" title=""> <br> （4）NAT设置 <br> <img src="https://images2.imgbox.com/5a/05/VyYOwlNX_o.png" alt="nat设置" title=""> <br> 设置后，进入虚拟机，如无意外，是可以正常连接网络了。 <br> （5）查看IP并测试 <br> 使用ifconfig进行测试，此处可查看到虚拟的IP，它的IP是dhcp自动分配的。 <br> <code>[root@localhost sysconfig]# ifconfig</code> <br> <img src="https://images2.imgbox.com/1b/e1/uVKUghfy_o.png" alt="ifconfig" title=""> <br> 在虚拟机ping宿主机IP，测试是否连通： <br> <code>[root@localhost sysconfig]# ping 192.168.31.1 `` <br> 在宿主机ping虚拟机IP，测试是否连通： <br> </code> [root@localhost sysconfig]# ping 192.168.31.128 “ <br> 若能连通，即证明网络设置完成，可以使用SSH连接虚拟机centos了。</p> 
<hr> 
<h3 id="四设置固定ip">四、设置固定IP</h3> 
<p>按上述方法，虽然可以连通，但由于是使用dhcp动态分配的，每次重启后，可能会变化，因此最好把它设置为固定IP。<a href="http://blog.csdn.net/readiay/article/details/45338709">可以参考此文</a> <br> 以下几点需要注意一下：</p> 
<blockquote> 
 <ul><li>VMware虚拟网络编辑器中取消“使用本地DHCP服务将IP地址分配给虚拟机”的勾选。</li><li>修改/etc/sysconfig/network-scripts/中ifcfg开头的对应的网卡配置。</li><li>修改/etc/resolv.conf ，添加域名解析。</li></ul> 
</blockquote> 
<h4 id="1修改网卡配置说明">（1）修改网卡配置说明</h4> 
<p>注意当前网卡的名称，使用ifconfig可查看到，本机安装后网卡名称是：ifcfg-eno16777736； <br> 打开此文件，主要配置以下几项（无则添加上去）：</p> 
<p><code>ONBOOT=yes 设置为开机后启动 <br> IPADDR=192.168.31.128 #此处设置固定的IP <br> NETMASK=255.255.255.0 #此处设置掩码 <br> GATEWAY=192.168.31.2 #此处设置网关IP <br> BOOTPROTO=static</code> #设置为静态 <br> 如下图： <br> <img src="https://images2.imgbox.com/8b/20/inBljj6L_o.png" alt="配置说明" title=""></p> 
<h4 id="2修改etcresolvconf-实现域名解析">（2）修改/etc/resolv.conf 实现域名解析</h4> 
<p>未做此设置前，在虚拟机中ping外网域名，会报unknown host错误，如ping www.baidu.com，则报ping: unknown host www.baidu.com。 <br> 在/etc/resolv.conf中添加以下设置： <br> <code>nameserver 192.168.31.2</code> <br> 如下图： <br> <img src="https://images2.imgbox.com/63/e3/SyMgtP6Y_o.png" alt="resolv.conf" title=""> <br> 这样，虚拟机可以使用ping测试外网域名，正常。</p> 
<hr> 
<h3 id="五设置防火墙iptables">五、设置防火墙iptables</h3> 
<p>CentOS7默认的防火墙不是iptables,而是firewall，要使用iptables，需要先安装。完整安装过程网上已有很多教程，<a href="http://www.cnblogs.com/kreo/p/4368811.html" rel="nofollow">参考此篇</a>，安装完成后，即可使用iptables了。 <br> 由于在虚拟机上安装了mysql，并正常启动mysql，但是发现在宿主机无法连接到mysql，但是ping虚拟机是连通的，可想而知一定是端口问题。尝试在宿主机使用telnet 此端口，也是无法连接，<strong>可以ping能，端口却无法telnet</strong>，两种可能： <br> （1）centos没有开启telnet； <br> （2）防火墙没有开启3306端口。（主要是这个问题） <br> 下面逐一解决。</p> 
<h4 id="51-centos安装telnet">5.1 centos安装telnet</h4> 
<p>（1）先检查是否已经安装以下两个安装包:telnet-server、xinetd。命令如下： <br> <code>rpm -qa |grep telnet-server <br> rpm -qa |grep xinetd</code> <br> 如果没有安装，则先安装。 <br> （2）查看可安装的包及安装 <br> <code>yum list |grep telnet <br> yum install telnet-server.x86_64 <br> yum install telnet.x86_64 <br> yum list |grep xinetd <br> yum install xinetd.x86_64</code> <br> （3）加入开机启动 <br> <code>systemctl enable xinetd.service <br> systemctl enable telnet.socket</code> <br> （4）开机启动 <br> <code>systemctl start telnet.socket <br> systemctl start xinetd（或service xinetd start）</code> <br> telnet启动后，在宿主机telnet，还是连接不上，继续进行iptables设置。</p> 
<h4 id="52-防火墙iptables设置">5.2 防火墙iptables设置</h4> 
<p>iptables文件路径在/etc/sysconfig/iptables，centos默认只开启了22端口，因此，需要在文件中添加需要访问的端口，如telnet端口23，数据库端口3306等。 <br> 如果不添加，连接数据库时会报错“Can’t connect to MySQL server (10060)”。 <br> （1）添加端口规则。 <br> 如下：</p> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-attribute">-A</span> INPUT <span class="hljs-attribute">-m</span> state <span class="hljs-subst">--</span>state <span class="hljs-literal">NEW</span> <span class="hljs-attribute">-m</span> tcp <span class="hljs-attribute">-p</span> tcp <span class="hljs-subst">--</span>dport <span class="hljs-number">3306</span> <span class="hljs-attribute">-j</span> ACCEPT
<span class="hljs-attribute">-A</span> INPUT <span class="hljs-attribute">-p</span> tcp <span class="hljs-attribute">-m</span> state <span class="hljs-subst">--</span>state <span class="hljs-literal">NEW</span> <span class="hljs-attribute">-m</span> tcp <span class="hljs-subst">--</span>dport <span class="hljs-number">23</span> <span class="hljs-attribute">-j</span> ACCEPT</code></pre> 
<blockquote> 
 <p><em>说明：</em> <br> [-AI 链] <br> 针对某的链进行规则的 “插入” 或 “累加” <br> -A ：新增加一条规则，该规则增加在原本规则的最后面。 <br> -I ：插入一条规则。如果没有指定此规则的顺序，默认是插入变成第一条规则。 <br> 例如原本有四条规则，使用 -I 则该规则变成第一条，而原本四条变成 2~5 号链 ：有 INPUT, OUTPUT, FORWARD 等 <br> [-io 网络接口] <br> 设定封包进出的接口规范 <br> -i ：封包所进入的那个网络接口，例如 eth0, lo 等接口。需与 INPUT 链配合； <br> -o ：封包所传出的那个网络接口，需与 OUTPUT 链配合； <br> [-p tcp,udp] <br> -p 协定：设定此规则适用于哪种封包格式 <br> 主要的封包格式有： tcp, udp, icmp 及 all 。 <br> [ -m ]：一些 iptables 的外挂模块，主要常见的有： <br> state ：状态模块 <br> mac ：网络卡硬件地址 (hardware address) <br> [–state ]：一些封包的状态，主要有： <br> INVALID ：无效的封包，例如数据破损的封包状态 <br> ESTABLISHED：已经联机成功的联机状态； <br> NEW ：想要新建立联机的封包状态； <br> RELATED ：这个最常用！表示这个封包是与我们主机发送出去的封包有关 <br> [-s 来源IP/网域] <br> [–sport 端口范围] <br> –sport 端口范围：限制来源的端口号码，端口号码可以是连续的，例如 1024:65535 <br> [–dport 端口范围] <br> –dport 端口范围：限制目标的端口号码。 <br> [-j ]：后面接动作，主要的动作有接受(ACCEPT)、丢弃(DROP)、拒绝(REJECT)及记录(LOG)</p> 
</blockquote> 
<p>如下图所示： <br> <img src="https://images2.imgbox.com/12/8a/REvlGi4z_o.png" alt="iptables" title=""></p> 
<blockquote> 
 <p><strong>特别提醒：</strong> 添加的端口规则语句必须放在REJECT的规则之前，否则不起作用。即若把上面添加的两句端口规则放在-A FORWARD -j REECT….规则后面，则端口是不开放的，在外面telnet不进来。</p> 
</blockquote> 
<p>（2）重启iptables <br> <code>service iptables restart</code> <br> 重启后，再次使用telnet 192.168.31.128 3306，正常。 <br> 使用navicat连接数据库，正常。</p> 
<hr> 
<h3 id="六-总结">六 总结</h3> 
<blockquote> 
 <p>（1）宿主机网络正常，在虚拟机的centos中无法访问外网。 <br> <strong>解决方法</strong>：使用NAT连接模式，正确设置网卡配置，域名解析配置。 <br> （2）宿主机可以ping通，且可以使用SSH连接，但无法telnet虚拟机centos的端口。 <br> <strong>解决方法</strong>：安装telnet，添加防火墙端口规则。 <br> （3）centos 固定IP问题 <br> <strong>解决方法</strong>：设置ifcfg网卡文件，域名解析配置。 <br> （4）防火墙设置问题 <br> <strong>解决方法</strong>：安装iptables，添加端口规则，注意放在REJECT规则之前。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bcd56e24c29f111769c247bde6538859/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决XCODE配置LLVM环境出现的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/de342d8a0d86d1af021be397bb61d022/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">哪本书是对程序员最有影响、每个程序员都该阅读的书?</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>