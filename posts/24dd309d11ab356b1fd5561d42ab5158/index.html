<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Tomcat会话保持 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Tomcat会话保持" />
<meta property="og:description" content="文章目录 Tomcat会话保持1、代理服务器配置2、web服务器配置3、会话保持3.1 方法一：修改代理服务器配置（nginx）3.2 方法二：修改web服务器配置（tomcat）访问官方文档，查看需要添加的配置文件修改tomcat服务配置 Tomcat会话保持 1、代理服务器配置 安装nginx服务（地址：192.168.10.11） systemctl stop firewalld setenforce 0 #关闭防火墙和防护中心 yum install -y epel-release.noarch #安装yum额外源 yum install -y nginx #安装nginx systemctl start nginx #开启nginx服务 systemctl status nginx #查看nginx服务状态 #修改配置文件 vim /etc/nginx/nginx.conf upstream tomcat { server 192.168.10.12:8080; server 192.168.10.13:8080; } #在http模块下添加upstream，负载均衡 location ~* \.jsp$ { proxy_pass http://tomcat; } #在server模块下添加location，反向代理 nginx -t #检查语法 nginx -s reload #重新加载配置文件 2、web服务器配置 安装tomcat（web1地址：192.168.10.12）安装tomcat（web2地址：192.168.10.13） web1和web2相同配置 systemctl stop firewalld setenforce 0 #关闭防火墙和防护中心 (1)部署jdk #将需要的jdk二进制包上传 tar xf jdk-8u291-linux-x64." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/24dd309d11ab356b1fd5561d42ab5158/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-15T15:48:23+08:00" />
<meta property="article:modified_time" content="2024-03-15T15:48:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Tomcat会话保持</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#Tomcat_1" rel="nofollow">Tomcat会话保持</a></li><li><ul><li><a href="#1_3" rel="nofollow">1、代理服务器配置</a></li><li><a href="#2web_47" rel="nofollow">2、web服务器配置</a></li><li><a href="#3_184" rel="nofollow">3、会话保持</a></li><li><ul><li><a href="#31_nginx_186" rel="nofollow">3.1 方法一：修改代理服务器配置（nginx）</a></li><li><a href="#32_webtomcat_214" rel="nofollow">3.2 方法二：修改web服务器配置（tomcat）</a></li><li><ul><li><a href="#_218" rel="nofollow">访问官方文档，查看需要添加的配置文件</a></li><li><a href="#tomcat_281" rel="nofollow">修改tomcat服务配置</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="Tomcat_1"></a>Tomcat会话保持</h3> 
<h4><a id="1_3"></a>1、代理服务器配置</h4> 
<ul><li>安装nginx服务（地址：192.168.10.11）</li></ul> 
<pre><code class="prism language-nginx">systemctl stop firewalld
setenforce 0
#关闭防火墙和防护中心

yum install -y epel-release.noarch
#安装yum额外源

yum install -y nginx
#安装nginx

systemctl start nginx
#开启nginx服务

systemctl status nginx
#查看nginx服务状态

#修改配置文件
vim /etc/nginx/nginx.conf
 upstream tomcat {
    server 192.168.10.12:8080;
    server 192.168.10.13:8080;
    }
#在http模块下添加upstream，负载均衡
location ~* \.jsp$ {
        proxy_pass http://tomcat;
        }
#在server模块下添加location，反向代理

nginx -t
#检查语法

nginx -s reload
#重新加载配置文件
</code></pre> 
<p><img src="https://images2.imgbox.com/aa/71/ob1kbnOf_o.png" alt="image-20240315100919339"></p> 
<p><img src="https://images2.imgbox.com/d6/cc/Mgg6cG34_o.png" alt="image-20240315134914384"></p> 
<h4><a id="2web_47"></a>2、web服务器配置</h4> 
<ul><li>安装tomcat（web1地址：192.168.10.12）</li><li>安装tomcat（web2地址：192.168.10.13）</li></ul> 
<pre><code class="prism language-bash">web1和web2相同配置

systemctl stop firewalld
setenforce <span class="token number">0</span>
<span class="token comment">#关闭防火墙和防护中心</span>

<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>部署jdk
<span class="token comment">#将需要的jdk二进制包上传</span>

<span class="token function">tar</span> xf jdk-8u291-linux-x64.tar.gz <span class="token parameter variable">-C</span> /usr/local
<span class="token comment">#将二进制包解压到/usr/local目录</span>

<span class="token builtin class-name">cd</span> /usr/local/
<span class="token comment">#切换目录</span>

<span class="token function">ln</span> <span class="token parameter variable">-s</span> jdk1.8.0_291/ jdk
<span class="token comment">#做软连接</span>

<span class="token comment">#修改环境变量</span>
<span class="token function">vim</span> /etc/profile.d/jdk.sh
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/jdk
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JRE_HOME</span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/jre   
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/lib/:<span class="token variable">$JRE_HOME</span>/lib/

<span class="token builtin class-name">.</span> /etc/profile.d/jdk.sh
<span class="token comment">#运行</span>

<span class="token function">java</span> <span class="token parameter variable">-version</span>
<span class="token comment">#查看版本</span>

<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>安装tomcat
<span class="token comment">#将需要的tomcat二进制包上传</span>

<span class="token function">tar</span> xf apache-tomcat-9.0.16.tar.gz 
<span class="token comment">#解压到指定目录</span>

<span class="token function">cp</span> <span class="token parameter variable">-r</span> apache-tomcat-9.0.16 /usr/local/
<span class="token comment">#复制</span>

<span class="token builtin class-name">cd</span> /usr/local
<span class="token comment">#切换目录</span>

<span class="token function">ln</span> <span class="token parameter variable">-s</span> apache-tomcat-9.0.16/ tomcat
<span class="token comment">#做软连接</span>

<span class="token function">useradd</span> <span class="token parameter variable">-M</span> <span class="token parameter variable">-s</span> /sbin/nologin tomcat
<span class="token comment">#新建用户</span>

<span class="token function">chown</span> tomcat:tomcat /usr/local/tomcat/ <span class="token parameter variable">-R</span>
<span class="token comment">#修改属主和属组</span>

<span class="token function">vim</span> /usr/lib/systemd/system/tomcat.service
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Tomcat
<span class="token assign-left variable">After</span><span class="token operator">=</span>syslog.target network.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/tomcat/bin/startup.sh
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/usr/local/tomcat/bin/shutdown.sh
<span class="token assign-left variable">RestartSec</span><span class="token operator">=</span><span class="token number">3</span>
<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true
<span class="token assign-left variable">User</span><span class="token operator">=</span>tomcat
<span class="token assign-left variable">Group</span><span class="token operator">=</span>tomcat

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
   
systemctl daemon-reload
<span class="token comment">#重新加载配置</span>

systemctl start tomcat
<span class="token comment">#开启服务</span>

systemctl status tomcat
<span class="token comment">#查看tomcat服务状态</span>

<span class="token builtin class-name">cd</span> /usr/local/tomcat/webapps/ROOT
<span class="token comment">#切换目录</span>

<span class="token function">mv</span> index.jsp index.jsp.bak
<span class="token comment">#改名</span>

<span class="token comment">#编辑或者上传Java测试脚本，随机生成sessionID</span>
<span class="token function">cat</span> index.jsp
<span class="token operator">&lt;</span>%@ page <span class="token assign-left variable">import</span><span class="token operator">=</span><span class="token string">"java.util.*"</span> %<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>tomcat test<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>On <span class="token operator">&lt;</span>%<span class="token operator">=</span>request.getServerName<span class="token punctuation">(</span><span class="token punctuation">)</span> %<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>%<span class="token operator">=</span>request.getLocalAddr<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token string">":"</span> + request.getLocalPort<span class="token punctuation">(</span><span class="token punctuation">)</span> %<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>SessionID <span class="token operator">=</span> <span class="token operator">&lt;</span>span <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"color:blue"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>%<span class="token operator">=</span>session.getId<span class="token punctuation">(</span><span class="token punctuation">)</span> %<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/span<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>%<span class="token operator">=</span>new Date<span class="token punctuation">(</span><span class="token punctuation">)</span>%<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> 
<ul><li>web1服务器配置（地址：192.168.10.12）</li></ul> 
<p><img src="https://images2.imgbox.com/3f/94/3leDQmpf_o.png" alt="image-20240315135424778"></p> 
<p><img src="https://images2.imgbox.com/59/85/NxyEaUop_o.png" alt="image-20240315135649256"></p> 
<p><img src="https://images2.imgbox.com/38/2a/rkfrTjLK_o.png" alt="image-20240315135832303"></p> 
<p><img src="https://images2.imgbox.com/90/c9/JEiGAbGC_o.png" alt="image-20240315142932010"></p> 
<ul><li>web2服务器配置（地址：192.168.10.13）</li></ul> 
<p><img src="https://images2.imgbox.com/1c/82/n9ZUbxME_o.png" alt="image-20240315140419908"></p> 
<p><img src="https://images2.imgbox.com/52/02/zwPBz8z9_o.png" alt="image-20240315140915724"></p> 
<p><img src="https://images2.imgbox.com/47/70/ASjlJoHv_o.png" alt="image-20240315141000400"></p> 
<p><img src="https://images2.imgbox.com/ec/a0/4BbBlrMk_o.png" alt="image-20240315143246794"></p> 
<ul><li>访问验证</li></ul> 
<pre><code class="prism language-bash"><span class="token number">192.168</span>.10.11/index.jsp
<span class="token comment">#使用主机访问，每刷新一次，sessionID会发生改变</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/20/9e/ihDTAiYP_o.png" alt="image-20240315143506995"></p> 
<h4><a id="3_184"></a>3、会话保持</h4> 
<h5><a id="31_nginx_186"></a>3.1 方法一：修改代理服务器配置（nginx）</h5> 
<pre><code class="prism language-bash"><span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> /etc/nginx/nginx.conf
<span class="token builtin class-name">hash</span> <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
<span class="token comment">#在upstream模块下添加此行配置内容（$remote_addr表示存放客户端的地址）</span>

nginx <span class="token parameter variable">-t</span>
<span class="token comment">#检查语法</span>

nginx <span class="token parameter variable">-s</span> reload
<span class="token comment">#重新加载配置文件</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1e/fd/WDXOYOiq_o.png" alt="image-20240315144117920"></p> 
<ul><li>验证</li></ul> 
<pre><code class="prism language-bash"><span class="token number">192.168</span>.10.11/index.jsp
<span class="token comment">#使用主机访问，刷新后，sessionID不会再发生改变，实现会话绑定</span>

<span class="token comment">#这种方法有缺陷，会话实现绑定之后，web服务器也不会发生改变，会永远绑定在该web服务器上</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b4/bd/jRnqXV0v_o.png" alt="image-20240315144406951"></p> 
<h5><a id="32_webtomcat_214"></a>3.2 方法二：修改web服务器配置（tomcat）</h5> 
<ul><li>适用于后端服务器比较少的场景</li></ul> 
<h6><a id="_218"></a>访问官方文档，查看需要添加的配置文件</h6> 
<pre><code class="prism language-bash"><span class="token comment">#官方文档</span>
https://tomcat.apache.org/tomcat-9.0-doc/cluster-howto.html

<span class="token comment">#在配置文件/usr/local/tomcat/conf/server.xml中只需要将Receiver里面的address修改为本机的ip地址，除此之外不需要修改，粘贴到配置文件中即可</span>
For the impatient
The following is the default cluster configuration: 
<span class="token operator">&lt;</span>Cluster <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.tcp.SimpleTcpCluster"</span>
                 <span class="token assign-left variable">channelSendOptions</span><span class="token operator">=</span><span class="token string">"8"</span><span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>Manager <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.session.DeltaManager"</span>
                   <span class="token assign-left variable">expireSessionsOnShutdown</span><span class="token operator">=</span><span class="token string">"false"</span>
                   <span class="token assign-left variable">notifyListenersOnReplication</span><span class="token operator">=</span><span class="token string">"true"</span>/<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>Channel <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.group.GroupChannel"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Membership <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.membership.McastService"</span>
                        <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">"228.0.0.4"</span>
                        <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"45564"</span>
                        <span class="token assign-left variable">frequency</span><span class="token operator">=</span><span class="token string">"500"</span>
                        <span class="token assign-left variable">dropTime</span><span class="token operator">=</span><span class="token string">"3000"</span>/<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Receiver <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.transport.nio.NioReceiver"</span>
                      <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">"auto"</span>
                      <span class="token comment">#此处修改为本机的ip地址</span>
                      <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"4000"</span>
                      <span class="token assign-left variable">autoBind</span><span class="token operator">=</span><span class="token string">"100"</span>
                      <span class="token assign-left variable">selectorTimeout</span><span class="token operator">=</span><span class="token string">"5000"</span>
                      <span class="token assign-left variable">maxThreads</span><span class="token operator">=</span><span class="token string">"6"</span>/<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>Sender <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.transport.ReplicationTransmitter"</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>Transport <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.transport.nio.PooledParallelSender"</span>/<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/Sender<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Interceptor <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.group.interceptors.TcpFailureDetector"</span>/<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Interceptor <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.group.interceptors.MessageDispatchInterceptor"</span>/<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>/Channel<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.tcp.ReplicationValve"</span>
                 <span class="token assign-left variable">filter</span><span class="token operator">=</span><span class="token string">""</span>/<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.session.JvmRouteBinderValve"</span>/<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>Deployer <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.deploy.FarmWarDeployer"</span>
                    <span class="token assign-left variable">tempDir</span><span class="token operator">=</span><span class="token string">"/tmp/war-temp/"</span>
                    <span class="token assign-left variable">deployDir</span><span class="token operator">=</span><span class="token string">"/tmp/war-deploy/"</span>
                    <span class="token assign-left variable">watchDir</span><span class="token operator">=</span><span class="token string">"/tmp/war-listen/"</span>
                    <span class="token assign-left variable">watchEnabled</span><span class="token operator">=</span><span class="token string">"false"</span>/<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>ClusterListener <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.session.ClusterSessionListener"</span>/<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/Cluster<span class="token operator">&gt;</span>


<span class="token comment">#在配置文件/usr/local/tomcat/webapps/ROOT/WEB-INF/web.xml中添加&lt;distributable/&gt;配置内容</span>
Cluster Basics
Make sure your web.xml has the <span class="token operator">&lt;</span>distributable/<span class="token operator">&gt;</span> element
<span class="token comment">#如果使用web.xml，需要添加&lt;distributable/&gt;功能</span>
</code></pre> 
<ul><li>查看官方文档</li></ul> 
<p><img src="https://images2.imgbox.com/53/be/E6VqEafe_o.png" alt="image-20240315145741214"></p> 
<p><img src="https://images2.imgbox.com/11/f6/40igYFqH_o.png" alt="image-20240315150348814"></p> 
<h6><a id="tomcat_281"></a>修改tomcat服务配置</h6> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /usr/local/tomcat/conf
<span class="token comment">#切换目录</span>

<span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> server.xml
        <span class="token operator">&lt;</span>Cluster <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.tcp.SimpleTcpCluster"</span>
                 <span class="token assign-left variable">channelSendOptions</span><span class="token operator">=</span><span class="token string">"8"</span><span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>Manager <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.session.DeltaManager"</span>
                   <span class="token assign-left variable">expireSessionsOnShutdown</span><span class="token operator">=</span><span class="token string">"false"</span>
                   <span class="token assign-left variable">notifyListenersOnReplication</span><span class="token operator">=</span><span class="token string">"true"</span>/<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>Channel <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.group.GroupChannel"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Membership <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.membership.McastService"</span>
                        <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">"228.0.0.4"</span>
                        <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"45564"</span>
                        <span class="token assign-left variable">frequency</span><span class="token operator">=</span><span class="token string">"500"</span>
                        <span class="token assign-left variable">dropTime</span><span class="token operator">=</span><span class="token string">"3000"</span>/<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Receiver <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.transport.nio.NioReceiver"</span>
                      <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">"192.168.10.12"</span>
                      <span class="token comment">#address="192.168.10.13"</span>
                      <span class="token comment">#修改为本机的ip地址</span>
                      <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"4000"</span>
                      <span class="token assign-left variable">autoBind</span><span class="token operator">=</span><span class="token string">"100"</span>
                      <span class="token assign-left variable">selectorTimeout</span><span class="token operator">=</span><span class="token string">"5000"</span>
                      <span class="token assign-left variable">maxThreads</span><span class="token operator">=</span><span class="token string">"6"</span>/<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>Sender <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.transport.ReplicationTransmitter"</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>Transport <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.transport.nio.PooledParallelSender"</span>/<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/Sender<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Interceptor <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.group.interceptors.TcpFailureDetector"</span>/<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Interceptor <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.tribes.group.interceptors.MessageDispatchInterceptor"</span>/<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>/Channel<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.tcp.ReplicationValve"</span>
                 <span class="token assign-left variable">filter</span><span class="token operator">=</span><span class="token string">""</span>/<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.session.JvmRouteBinderValve"</span>/<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>Deployer <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.deploy.FarmWarDeployer"</span>
                    <span class="token assign-left variable">tempDir</span><span class="token operator">=</span><span class="token string">"/tmp/war-temp/"</span>
                    <span class="token assign-left variable">deployDir</span><span class="token operator">=</span><span class="token string">"/tmp/war-deploy/"</span>
                    <span class="token assign-left variable">watchDir</span><span class="token operator">=</span><span class="token string">"/tmp/war-listen/"</span>
                    <span class="token assign-left variable">watchEnabled</span><span class="token operator">=</span><span class="token string">"false"</span>/<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>ClusterListener <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.ha.session.ClusterSessionListener"</span>/<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/Cluster<span class="token operator">&gt;</span>


<span class="token builtin class-name">cd</span> /usr/local/tomcat/webapps/ROOT/WEB-INF
<span class="token comment">#切换目录</span>

<span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> web.xml
  <span class="token operator">&lt;</span>/description<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>distributable/<span class="token operator">&gt;</span>
<span class="token comment">#在此处添加此行配置内容</span>
<span class="token operator">&lt;</span>/web-app<span class="token operator">&gt;</span>

systemctl restart tomcat
<span class="token comment">#重启服务</span>
</code></pre> 
<ul><li>web1服务器配置（地址：192.168.10.12）</li></ul> 
<p><img src="https://images2.imgbox.com/af/8c/HNM4FQCP_o.png" alt="image-20240315151141956"></p> 
<p><img src="https://images2.imgbox.com/48/3f/weWmZlir_o.png" alt="image-20240315153715657"></p> 
<p><img src="https://images2.imgbox.com/e8/27/6gpxy8GL_o.png" alt="image-20240315151452524"></p> 
<p><img src="https://images2.imgbox.com/e7/57/3LvtHbFa_o.png" alt="image-20240315154450473"></p> 
<ul><li>web2服务器配置（地址：192.168.10.13）</li></ul> 
<p><img src="https://images2.imgbox.com/14/a9/Tp262n6J_o.png" alt="image-20240315153254450"></p> 
<p><img src="https://images2.imgbox.com/b5/45/FSjNCkd0_o.png" alt="image-20240315153209550"></p> 
<p><img src="https://images2.imgbox.com/4c/9c/eGAfMt8f_o.png" alt="image-20240315153416541"></p> 
<p><img src="https://images2.imgbox.com/7a/ba/GLXtAyB8_o.png" alt="image-20240315154420198"></p> 
<ul><li>验证</li></ul> 
<pre><code class="prism language-bash"><span class="token number">192.168</span>.10.11/index.jsp
<span class="token comment">#使用主机访问，刷新后，sessionID保持不变，实现会话绑定，web服务器依旧切换</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a2/ed/3RAR3HAN_o.png" alt="image-20240315154256730"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0db9deb97952b2f4d1f17176234f4923/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Go-知识select</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2efca5652dad88690a78aaf5d7b8548f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机设计大赛 题目：基于卷积神经网络的手写字符识别 - 深度学习</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>