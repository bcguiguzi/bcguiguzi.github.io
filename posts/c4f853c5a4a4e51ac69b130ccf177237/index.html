<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>F#奇妙游（35）：MVC模式和ADT分析 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="F#奇妙游（35）：MVC模式和ADT分析" />
<meta property="og:description" content="前言 经常在知乎上看帖子，给人的感觉就是桌面开发已经挂了。当然知乎上每天药丸的东西实在是太多了，什么C#药丸啊，感觉上是地球分分钟就要报销。但是在工业界，桌面应用还是有一些市场的，在上位机程序中、在功能非常复杂的桌面应用还是没办法被网页所替代。
就比如说我们用来开发程序的JetBrain系列工具，虽然免费的Eclipse荣光不在，但是收费的IDE居然还能活得好好的。这说明在行业软件中，人们依然依赖界面开发良好的桌面应用来完成信息化的操作。
前几天刚看了一个WPF可能药丸的帖子，说是WPF已经被微软抛弃了。我居然还回头来整MVC，可能也是太没前途了。人家WPF好歹是MVVM。
MVC的内涵 MVVM和MVC其实都是OOP时代对UI程序的开发框架。前者（MVVM）通过分离模型和视图，并把状态和行为结合到一个对象中，称为ViewModel，ViewModel则通过数据绑定来实现视图的更新。而这里面最为核心的行为，则需要通过事件的方式为ViewModel所处理，这种事件处理方式没有一致的机制，可以通过数据绑定，也可以通过注册事件处理函数。此外，ViewModel还必须维护一个运行状态的存储机制，这就带来更高的复杂性。
Owns Owns Notify Update View ViewModel Model MVC分离模型和视图的意图和MVVM一样，此外，MVC还定义了视图和控制器的分离。
Update Events Notify Update Controller Model View 在MVC中，控制器负责处理用户的输入（通常被抽象为事件），然后更新模型，模型更新后，会通过Controller通知视图进行更新。这里的模型和视图都是被动的（模型甚至可能是值），它们不会主动去更新自己，而是被控制器所更新。
这里核心的就是控制器对于事件的处理以及事件的抽象。这里最有意思的是对
于Controller而言，View不过就是一个事件流。
在.NET平台中，采用Observable和Observer模式来实现事件的抽象。这里的事件流就是一个Observable对象（也就是Subject），它的接口是public interface IObservable&lt;out T&gt;。这个接口的泛型类型T就是事件的类型，这个对象提供了事件的相关信息。官方文档中的描述是：
定义基于推送的通知的提供程序。
这个接口规定的方法是Subscribe，也就是把一个观察者注册到这个事件流中。
abstract member Subscribe: observer: IObserver&lt;&#39;T&gt; -&gt; IDisposable 这里的观察者就是Controller，它通过订阅事件流，来接受事件的通知。这里的事件就是View的事件。这样，我们就把MVC中的事件抽象为了一个事件流，这个事件流就是一个Observable对象。
在F#中提供了对于事件驱动的程序设计的支持，对应的命名空间为FSharp.Core.Control。下面的例子就是一个简单的事件流的例子。类型Event实现了IObservable接口，它的泛型类型就是事件的类型。其中Publish属性就是一个IObservable对象，Trigger方法用来触发事件。
IObservable&lt;T&gt; &#43;Subscribe(IObservable&lt;T&gt;) &#43;Add(IObservable&lt;T&gt;) Event&lt;T&gt; &#43;IObservable&lt;T&gt; Publish &#43;Trigger(T) open System.Collections.Generic type MyClassWithCLIEvent() = let event1 = new Event&lt;string&gt;() [&lt;CLIEvent&gt;] member this.Event1 = event1.Publish member this.TestEvent(arg) = event1.Trigger(arg) let classWithEvent = new MyClassWithCLIEvent() classWithEvent." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/c4f853c5a4a4e51ac69b130ccf177237/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-28T11:02:10+08:00" />
<meta property="article:modified_time" content="2023-09-28T11:02:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">F#奇妙游（35）：MVC模式和ADT分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>经常在知乎上看帖子，给人的感觉就是桌面开发已经挂了。当然知乎上每天药丸的东西实在是太多了，什么C#药丸啊，感觉上是地球分分钟就要报销。但是在工业界，桌面应用还是有一些市场的，在上位机程序中、在功能非常复杂的桌面应用还是没办法被网页所替代。</p> 
<p>就比如说我们用来开发程序的JetBrain系列工具，虽然免费的Eclipse荣光不在，但是收费的IDE居然还能活得好好的。这说明在行业软件中，人们依然依赖界面开发良好的桌面应用来完成信息化的操作。</p> 
<p>前几天刚看了一个WPF可能药丸的帖子，说是WPF已经被微软抛弃了。我居然还回头来整MVC，可能也是太没前途了。人家WPF好歹是MVVM。</p> 
<h2><a id="MVC_8"></a>MVC的内涵</h2> 
<p>MVVM和MVC其实都是OOP时代对UI程序的开发框架。前者（MVVM）通过分离模型和视图，并把状态和行为结合到一个对象中，称为ViewModel，ViewModel则通过数据绑定来实现视图的更新。而这里面最为核心的行为，则需要通过事件的方式为ViewModel所处理，这种事件处理方式没有一致的机制，可以通过数据绑定，也可以通过注册事件处理函数。此外，ViewModel还必须维护一个运行状态的存储机制，这就带来更高的复杂性。</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-5rovbl5no8nkPwpn" width="424.42498779296875" xmlns="http://www.w3.org/2000/svg" height="112.61250305175781" viewbox="0 0 424.42498779296875 112.61250305175781" class="mermaid-svg"> 
  <style>#mermaid-svg-5rovbl5no8nkPwpn {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-5rovbl5no8nkPwpn .error-icon{fill:#552222;}#mermaid-svg-5rovbl5no8nkPwpn .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-5rovbl5no8nkPwpn .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-5rovbl5no8nkPwpn .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-5rovbl5no8nkPwpn .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-5rovbl5no8nkPwpn .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-5rovbl5no8nkPwpn .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-5rovbl5no8nkPwpn .marker{fill:#333333;stroke:#333333;}#mermaid-svg-5rovbl5no8nkPwpn .marker.cross{stroke:#333333;}#mermaid-svg-5rovbl5no8nkPwpn svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-5rovbl5no8nkPwpn .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-5rovbl5no8nkPwpn .cluster-label text{fill:#333;}#mermaid-svg-5rovbl5no8nkPwpn .cluster-label span{color:#333;}#mermaid-svg-5rovbl5no8nkPwpn .label text,#mermaid-svg-5rovbl5no8nkPwpn span{fill:#333;color:#333;}#mermaid-svg-5rovbl5no8nkPwpn .node rect,#mermaid-svg-5rovbl5no8nkPwpn .node circle,#mermaid-svg-5rovbl5no8nkPwpn .node ellipse,#mermaid-svg-5rovbl5no8nkPwpn .node polygon,#mermaid-svg-5rovbl5no8nkPwpn .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-5rovbl5no8nkPwpn .node .label{text-align:center;}#mermaid-svg-5rovbl5no8nkPwpn .node.clickable{cursor:pointer;}#mermaid-svg-5rovbl5no8nkPwpn .arrowheadPath{fill:#333333;}#mermaid-svg-5rovbl5no8nkPwpn .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-5rovbl5no8nkPwpn .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-5rovbl5no8nkPwpn .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-5rovbl5no8nkPwpn .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-5rovbl5no8nkPwpn .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-5rovbl5no8nkPwpn .cluster text{fill:#333;}#mermaid-svg-5rovbl5no8nkPwpn .cluster span{color:#333;}#mermaid-svg-5rovbl5no8nkPwpn div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-5rovbl5no8nkPwpn :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g> 
   <g class="output"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <g class="edgePath LS-A LE-B" style="opacity: 1;" id="L-A-B"> 
      <path class="path" d="M61.203695587186814,48.62559449375972L69.86245465598901,46.07237066577958C78.52121372479121,43.51914683779945,95.8387318623956,38.41269918183918,113.17969830947673,37.873502248738056C130.52066475655786,37.33430531563693,147.88507951311576,41.362359105394965,156.56728689139467,43.37638600027398L165.24949426967362,45.390412895153" marker-end="url(#arrowhead212)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead212" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-B LE-C" style="opacity: 1;" id="L-B-C"> 
      <path class="path" d="M259.2578227920499,44.9465027558073L267.2763112322462,43.00646088415257C275.2947996724425,41.06641901249784,291.331776552835,37.18633526918837,307.3554315277344,37.609631772800995C323.3790865026338,38.03292827641362,339.38941957204014,42.75960502694833,347.39458610674325,45.122943402215675L355.3997526414464,47.486281777483036" marker-end="url(#arrowhead213)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead213" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-C LE-B" style="opacity: 1;" id="L-C-B"> 
      <path class="path" d="M355.3997526414464,65.12622127427477L347.39458610674325,67.48955964954213C339.38941957204014,69.85289802480948,323.3790865026338,74.5795747753442,307.3554315277344,75.00287127895682C291.331776552835,75.42616778256944,275.2947996724425,71.54608403925998,267.2763112322462,69.60604216760525L259.2578227920499,67.66600029595051" marker-end="url(#arrowhead214)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead214" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-B LE-A" style="opacity: 1;" id="L-B-A"> 
      <path class="path" d="M165.24949426967362,67.22209015660482L156.56728689139467,69.23611705148384C147.88507951311576,71.25014394636285,130.52066475655786,75.27819773612087,113.17969830947675,74.73900080301976C95.8387318623956,74.19980386991864,78.52121372479121,69.09335621395836,69.86245465598901,66.54013238597823L61.203695587186814,63.98690855799809" marker-end="url(#arrowhead215)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead215" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(113.15625,33.306251525878906)"> 
      <g transform="translate(-18.95625114440918,-13)" class="label"> 
       <rect rx="0" ry="0" width="37.91250228881836" height="26"></rect> 
       <foreignobject width="37.91250228881836" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-A-B" class="edgeLabel L-LS-A' L-LE-B">Owns</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(307.36875343322754,33.306251525878906)"> 
      <g transform="translate(-18.95625114440918,-13)" class="label"> 
       <rect rx="0" ry="0" width="37.91250228881836" height="26"></rect> 
       <foreignobject width="37.91250228881836" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-B-C" class="edgeLabel L-LS-B' L-LE-C">Owns</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(307.36875343322754,79.3062515258789)"> 
      <g transform="translate(-21.756250381469727,-13)" class="label"> 
       <rect rx="0" ry="0" width="43.51250076293945" height="26"></rect> 
       <foreignobject width="43.51250076293945" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-C-B" class="edgeLabel L-LS-C' L-LE-B">Notify</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(113.15625,79.3062515258789)"> 
      <g transform="translate(-25.84375,-13)" class="label"> 
       <rect rx="0" ry="0" width="51.6875" height="26"></rect> 
       <foreignobject width="51.6875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-B-A" class="edgeLabel L-LS-B' L-LE-A">Update</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default" style="opacity: 1;" id="flowchart-A-127" transform="translate(35.15625,56.306251525878906)"> 
      <circle x="-27.15625" y="-23" r="27.15625" class="label-container"></circle> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-17.15625,-13)"> 
        <foreignobject width="34.3125" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           View 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-B-128" transform="translate(212.3062515258789,56.306251525878906)"> 
      <circle x="-48.306251525878906" y="-23" r="48.306251525878906" class="label-container"></circle> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-38.306251525878906,-13)"> 
        <foreignobject width="76.61250305175781" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           ViewModel 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-C-129" transform="translate(385.27500343322754,56.306251525878906)"> 
      <circle x="-31.149999618530273" y="-23" r="31.149999618530273" class="label-container"></circle> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-21.149999618530273,-13)"> 
        <foreignobject width="42.29999923706055" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           Model 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>MVC分离模型和视图的意图和MVVM一样，此外，MVC还定义了视图和控制器的分离。</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-ZjpLbmSe4QFrsjSQ" width="272.4250183105469" xmlns="http://www.w3.org/2000/svg" height="196.30625915527344" viewbox="0 0 272.4250183105469 196.30625915527344" class="mermaid-svg"> 
  <style>#mermaid-svg-ZjpLbmSe4QFrsjSQ {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .error-icon{fill:#552222;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .marker{fill:#333333;stroke:#333333;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .marker.cross{stroke:#333333;}#mermaid-svg-ZjpLbmSe4QFrsjSQ svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .cluster-label text{fill:#333;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .cluster-label span{color:#333;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .label text,#mermaid-svg-ZjpLbmSe4QFrsjSQ span{fill:#333;color:#333;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .node rect,#mermaid-svg-ZjpLbmSe4QFrsjSQ .node circle,#mermaid-svg-ZjpLbmSe4QFrsjSQ .node ellipse,#mermaid-svg-ZjpLbmSe4QFrsjSQ .node polygon,#mermaid-svg-ZjpLbmSe4QFrsjSQ .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .node .label{text-align:center;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .node.clickable{cursor:pointer;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .arrowheadPath{fill:#333333;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .cluster text{fill:#333;}#mermaid-svg-ZjpLbmSe4QFrsjSQ .cluster span{color:#333;}#mermaid-svg-ZjpLbmSe4QFrsjSQ div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-ZjpLbmSe4QFrsjSQ :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g> 
   <g class="output"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <g class="edgePath LS-A LE-B" style="opacity: 1;" id="L-A-B"> 
      <path class="path" d="M90.39970229887275,69.39357783249247L100.5466269157273,61.327981527077064C110.69355153258182,53.262385221661646,130.9874007662909,37.13119261083082,149.80122360307595,31.496740874188145C168.61504643986095,25.86228913754546,185.94884287972192,30.72457827509092,194.61574109965238,33.15572284386365L203.28263931958287,35.58686741263638" marker-end="url(#arrowhead231)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead231" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-C LE-A" style="opacity: 1;" id="L-C-A"> 
      <path class="path" d="M207.1279676974198,159.64073227096932L197.8201814145165,162.25165182889614C188.51239513161318,164.86257138682296,169.8968225658066,170.08441050267663,150.44211166604876,164.62973375518803C130.9874007662909,159.17505700769945,110.69355153258182,143.04386439686863,100.54662691572729,134.9782680914532L90.39970229887275,126.9126717860378" marker-end="url(#arrowhead232)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead232" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-B LE-A" style="opacity: 1;" id="L-B-A"> 
      <path class="path" d="M204.15596081008712,55.06363661310413L195.34350900840593,58.411884645797635C186.53105720672474,61.76013267849114,168.90615360336236,68.45662874387814,151.41217812066995,73.86205688900701C133.91820263797752,79.26748503413589,116.55515527595502,83.38184525900664,107.87363159494377,85.43902537144201L99.19210791393252,87.49620548387739" marker-end="url(#arrowhead233)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead233" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-A LE-C" style="opacity: 1;" id="L-A-C"> 
      <path class="path" d="M99.19210791393252,108.81004413465288L107.87363159494377,110.86722424708826C116.55515527595502,112.92440435952363,133.91820263797752,117.0387645843944,152.03440472076278,122.68060468802646C170.15060680354804,128.3224447916585,189.0199636070961,135.49176477405192,198.45464200887014,139.0764247652486L207.88932041064416,142.6610847564453" marker-end="url(#arrowhead234)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead234" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(151.28125,21)"> 
      <g transform="translate(-25.84375,-13)" class="label"> 
       <rect rx="0" ry="0" width="51.6875" height="26"></rect> 
       <foreignobject width="51.6875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-A-B" class="edgeLabel L-LS-A' L-LE-B">Update</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(151.28125,175.30624961853027)"> 
      <g transform="translate(-23.348438262939453,-13)" class="label"> 
       <rect rx="0" ry="0" width="46.696876525878906" height="26"></rect> 
       <foreignobject width="46.696876525878906" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-C-A" class="edgeLabel L-LS-C' L-LE-A">Events</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(151.28125,75.15312480926514)"> 
      <g transform="translate(-21.756250381469727,-13)" class="label"> 
       <rect rx="0" ry="0" width="43.51250076293945" height="26"></rect> 
       <foreignobject width="43.51250076293945" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-B-A" class="edgeLabel L-LS-B' L-LE-A">Notify</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(151.28125,121.15312480926514)"> 
      <g transform="translate(-25.84375,-13)" class="label"> 
       <rect rx="0" ry="0" width="51.6875" height="26"></rect> 
       <foreignobject width="51.6875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-A-C" class="edgeLabel L-LS-A' L-LE-C">Update</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default" style="opacity: 1;" id="flowchart-A-142" transform="translate(54.21875,98.15312480926514)"> 
      <circle x="-46.21875" y="-23" r="46.21875" class="label-container"></circle> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-36.21875,-13)"> 
        <foreignobject width="72.4375" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           Controller 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-B-143" transform="translate(233.27499961853027,44)"> 
      <circle x="-31.149999618530273" y="-23" r="31.149999618530273" class="label-container"></circle> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-21.149999618530273,-13)"> 
        <foreignobject width="42.29999923706055" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           Model 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-C-144" transform="translate(233.27499961853027,152.30624961853027)"> 
      <circle x="-27.15625" y="-23" r="27.15625" class="label-container"></circle> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-17.15625,-13)"> 
        <foreignobject width="34.3125" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           View 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>在MVC中，控制器负责处理用户的输入（通常被抽象为事件），然后更新模型，模型更新后，会通过Controller通知视图进行更新。这里的模型和视图都是被动的（模型甚至可能是值），它们不会主动去更新自己，而是被控制器所更新。</p> 
<p>这里核心的就是控制器对于事件的处理以及事件的抽象。这里最有意思的是对<br> 于Controller而言，View不过就是一个事件流。</p> 
<p>在.NET平台中，采用Observable和Observer模式来实现事件的抽象。这里的事件流就是一个Observable对象（也就是Subject），它的接口是<code>public interface IObservable&lt;out T&gt;</code>。这个接口的泛型类型<code>T</code>就是事件的类型，这个对象提供了事件的相关信息。官方文档中的描述是：</p> 
<blockquote> 
 <p>定义基于推送的通知的提供程序。</p> 
</blockquote> 
<p>这个接口规定的方法是<code>Subscribe</code>，也就是把一个观察者注册到这个事件流中。</p> 
<pre><code class="prism language-fsharp">abstract member Subscribe: observer: IObserver&lt;'T&gt; -&gt; IDisposable
</code></pre> 
<p>这里的观察者就是Controller，它通过订阅事件流，来接受事件的通知。这里的事件就是View的事件。这样，我们就把MVC中的事件抽象为了一个事件流，这个事件流就是一个Observable对象。</p> 
<p>在F#中提供了对于事件驱动的程序设计的支持，对应的命名空间为<code>FSharp.Core.Control</code>。下面的例子就是一个简单的事件流的例子。类型Event实现了IObservable接口，它的泛型类型就是事件的类型。其中Publish属性就是一个IObservable对象，Trigger方法用来触发事件。</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-8u9npUY8WxwCeKkN" width="229.5625" xmlns="http://www.w3.org/2000/svg" height="316" viewbox="0 0 229.5625 316" class="mermaid-svg"> 
  <style>#mermaid-svg-8u9npUY8WxwCeKkN {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-8u9npUY8WxwCeKkN .error-icon{fill:#552222;}#mermaid-svg-8u9npUY8WxwCeKkN .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-8u9npUY8WxwCeKkN .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-8u9npUY8WxwCeKkN .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-8u9npUY8WxwCeKkN .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-8u9npUY8WxwCeKkN .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-8u9npUY8WxwCeKkN .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-8u9npUY8WxwCeKkN .marker{fill:#333333;stroke:#333333;}#mermaid-svg-8u9npUY8WxwCeKkN .marker.cross{stroke:#333333;}#mermaid-svg-8u9npUY8WxwCeKkN svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-8u9npUY8WxwCeKkN g.classGroup text{fill:#9370DB;fill:#131300;stroke:none;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:10px;}#mermaid-svg-8u9npUY8WxwCeKkN g.classGroup text .title{font-weight:bolder;}#mermaid-svg-8u9npUY8WxwCeKkN .nodeLabel,#mermaid-svg-8u9npUY8WxwCeKkN .edgeLabel{color:#131300;}#mermaid-svg-8u9npUY8WxwCeKkN .edgeLabel .label rect{fill:#ECECFF;}#mermaid-svg-8u9npUY8WxwCeKkN .label text{fill:#131300;}#mermaid-svg-8u9npUY8WxwCeKkN .edgeLabel .label span{background:#ECECFF;}#mermaid-svg-8u9npUY8WxwCeKkN .classTitle{font-weight:bolder;}#mermaid-svg-8u9npUY8WxwCeKkN .node rect,#mermaid-svg-8u9npUY8WxwCeKkN .node circle,#mermaid-svg-8u9npUY8WxwCeKkN .node ellipse,#mermaid-svg-8u9npUY8WxwCeKkN .node polygon,#mermaid-svg-8u9npUY8WxwCeKkN .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-8u9npUY8WxwCeKkN .divider{stroke:#9370DB;stroke:1;}#mermaid-svg-8u9npUY8WxwCeKkN g.clickable{cursor:pointer;}#mermaid-svg-8u9npUY8WxwCeKkN g.classGroup rect{fill:#ECECFF;stroke:#9370DB;}#mermaid-svg-8u9npUY8WxwCeKkN g.classGroup line{stroke:#9370DB;stroke-width:1;}#mermaid-svg-8u9npUY8WxwCeKkN .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5;}#mermaid-svg-8u9npUY8WxwCeKkN .classLabel .label{fill:#9370DB;font-size:10px;}#mermaid-svg-8u9npUY8WxwCeKkN .relation{stroke:#333333;stroke-width:1;fill:none;}#mermaid-svg-8u9npUY8WxwCeKkN .dashed-line{stroke-dasharray:3;}#mermaid-svg-8u9npUY8WxwCeKkN #compositionStart,#mermaid-svg-8u9npUY8WxwCeKkN .composition{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-8u9npUY8WxwCeKkN #compositionEnd,#mermaid-svg-8u9npUY8WxwCeKkN .composition{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-8u9npUY8WxwCeKkN #dependencyStart,#mermaid-svg-8u9npUY8WxwCeKkN .dependency{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-8u9npUY8WxwCeKkN #dependencyStart,#mermaid-svg-8u9npUY8WxwCeKkN .dependency{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-8u9npUY8WxwCeKkN #extensionStart,#mermaid-svg-8u9npUY8WxwCeKkN .extension{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-8u9npUY8WxwCeKkN #extensionEnd,#mermaid-svg-8u9npUY8WxwCeKkN .extension{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-8u9npUY8WxwCeKkN #aggregationStart,#mermaid-svg-8u9npUY8WxwCeKkN .aggregation{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-8u9npUY8WxwCeKkN #aggregationEnd,#mermaid-svg-8u9npUY8WxwCeKkN .aggregation{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-8u9npUY8WxwCeKkN .edgeTerminals{font-size:11px;}#mermaid-svg-8u9npUY8WxwCeKkN :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <defs> 
    <marker id="classDiagram-aggregationStart" class="marker aggregation classDiagram" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"> 
     <path d="M 18,7 L9,13 L1,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-aggregationEnd" class="marker aggregation classDiagram" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"> 
     <path d="M 18,7 L9,13 L1,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-extensionStart" class="marker extension classDiagram" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"> 
     <path d="M 1,7 L18,13 V 1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-extensionEnd" class="marker extension classDiagram" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"> 
     <path d="M 1,1 V 13 L18,7 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-compositionStart" class="marker composition classDiagram" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"> 
     <path d="M 18,7 L9,13 L1,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-compositionEnd" class="marker composition classDiagram" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"> 
     <path d="M 18,7 L9,13 L1,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-dependencyStart" class="marker dependency classDiagram" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"> 
     <path d="M 5,7 L9,13 L1,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-dependencyEnd" class="marker dependency classDiagram" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"> 
     <path d="M 18,7 L9,13 L14,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <g class="root"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <path d="M114.78125,133L114.78125,137.16666666666666C114.78125,141.33333333333334,114.78125,149.66666666666666,114.78125,158C114.78125,166.33333333333334,114.78125,174.66666666666666,114.78125,178.83333333333334L114.78125,183" id="id1" class="  edge-pattern-solid relation" style="fill:none" marker-start="url(#classDiagram-extensionStart)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default" id="classid-IObservable-8" transform="translate(114.78125, 70.5)"> 
      <rect class="outer title-state" x="-106.78125" y="-62.5" width="213.5625" height="125"></rect> 
      <line class="divider" x1="-106.78125" x2="106.78125" y1="-24.5" y2="-24.5"></line> 
      <line class="divider" x1="-106.78125" x2="106.78125" y1="-8.5" y2="-8.5"></line> 
      <g class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel"></span> 
        </div> 
       </foreignobject> 
       <foreignobject class="classTitle" width="116.6500015258789" height="26" transform="translate( -58.32500076293945, -55)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">IObservable&lt;T&gt;</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="198.5625" height="26" transform="translate( -99.28125, -1)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+Subscribe(IObservable&lt;T&gt;)</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="157.65000915527344" height="26" transform="translate( -99.28125, 29)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+Add(IObservable&lt;T&gt;)</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default" id="classid-Event-9" transform="translate(114.78125, 245.5)"> 
      <rect class="outer title-state" x="-94.76875305175781" y="-62.5" width="189.53750610351562" height="125"></rect> 
      <line class="divider" x1="-94.76875305175781" x2="94.76875305175781" y1="-24.5" y2="-24.5"></line> 
      <line class="divider" x1="-94.76875305175781" x2="94.76875305175781" y1="21.5" y2="21.5"></line> 
      <g class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel"></span> 
        </div> 
       </foreignobject> 
       <foreignobject class="classTitle" width="71.0625" height="26" transform="translate( -35.53125, -55)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Event&lt;T&gt;</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="174.53750610351562" height="26" transform="translate( -87.26875305175781, -13)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+IObservable&lt;T&gt; Publish</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="78.75" height="26" transform="translate( -87.26875305175781, 29)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+Trigger(T)</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<pre><code class="prism language-fsharp">open System.Collections.Generic

type MyClassWithCLIEvent() =

    let event1 = new Event&lt;string&gt;()

    [&lt;CLIEvent&gt;]
    member this.Event1 = event1.Publish

    member this.TestEvent(arg) =
        event1.Trigger(arg)

let classWithEvent = new MyClassWithCLIEvent()
classWithEvent.Event1.Subscribe(fun arg -&gt;
        printfn "Event1 occurred! Object data: %s" arg)

classWithEvent.TestEvent("Hello World!")

System.Console.ReadLine() |&gt; ignore
</code></pre> 
<p>这里调用<code>TestEvent</code>方法，就会触发事件，然后观察者就会收到通知。注册观察者的方法就是<code>Subscribe</code>，它的参数就是一个观察者，这里的观察者就是一个函数，它的参数就是事件的类型。这里的事件类型就是<code>string</code>。同时，FSharp还给IObservable接口提供了一个扩展方法<code>Add</code>，其语法和语义与<code>Subscribe</code>是一样的。</p> 
<p>在事件驱动的基础上，我们可以构造如下的MVC模式的程序。</p> 
<h2><a id="FMVC_90"></a>F#中的MVC</h2> 
<p>F#作为函数式程序设计语言，对于ADT的支持非常好，这里我们可以使用ADT来定义事件的抽象。</p> 
<p>我们还是用那个增减计数器的例子来说明F#对MVC的支持。</p> 
<pre><code class="prism language-fsharp">type UpDownEvent =
    | Up
    | Down

type View = IObservable&lt;UpDownEvent&gt;

type Model = {State: int}

type Controller = Model -&gt; UpDownEvent -&gt; Model

type Mvc = Controller -&gt; Model -&gt; View -&gt; Model
</code></pre> 
<p>从上面的代码中，可以看到：</p> 
<ol><li>增减计数器的事件用可区分联合类型来表示；</li><li>View抽象为一个事件流；</li><li>Model抽象为一个状态，用一个不可变的记录来表示；</li><li>Controller抽象为一个函数，它接受一个Model和一个事件，然后返回一个新的Model；</li><li>Mvc抽象为一个函数，它接受一个Controller、一个Model和一个View，然后返回一个Model。</li></ol> 
<p>通过上面的类型系统，可以很好地抽象出我们要表达的MVC模式。这个简单的例子与MVVM的面向对象实现截然不同。仅仅阅读这些类型（或者进行一些ADT的分析和对应组合数的计算），就能对整个系统的结构有很好的了解。</p> 
<p>如果我们为了适应UI开发中的绑定机制，则还可能把上面的描述做一定的修改，例如：</p> 
<pre><code class="prism language-fsharp">type UpDownEvent =
    | Up
    | Down
type View = IObservable&lt;UpDownEvent&gt;
type Model = {mutable State: int}
type Controller = Model -&gt; UpDownEvent -&gt; unit
type Mvc = Controller -&gt; Model -&gt; View -&gt; IDisposable
</code></pre> 
<p>这里的Model就变成了一个可变的记录，Controller也变成了一个不返回Model的函数，而是直接修改Model的状态。</p> 
<h2><a id="_133"></a>完整的例子</h2> 
<p>这里就能用<code>FSharp.Core.Event</code>来实现一个上面这个例子。</p> 
<pre><code class="prism language-fsharp">open System


type UpDownEvent =
    | Up
    | Down

type View = IObservable&lt;UpDownEvent&gt;
type Model = { mutable State: int }
type Controller = Model -&gt; UpDownEvent -&gt; unit
type Mvc = Controller -&gt; Model -&gt; View -&gt; IDisposable

// 事件流
let subject = Event&lt;UpDownEvent&gt;()

// 事件触发
let raiseEvents xs =
    xs |&gt; Seq.iter (fun x -&gt; subject.Trigger(x))

// IEvent&lt;`a&gt;实现了IObservable&lt;`a&gt;，所以可以直接用
let view = subject.Publish

// 实例化模型，初始化状态为0
let model: Model = { State = 0 }

// 控制器的实现十分干净，直接更改模型的状态
let controller model event =
    match event with
    | Up -&gt; model.State &lt;- model.State + 1
    | Down -&gt; model.State &lt;- model.State - 1

// MVC的实现
let mvc: Mvc =
    fun controller model view -&gt;
        view.Subscribe(fun event -&gt;
            controller model event
            printfn "%A ==&gt; Model state: %A" event model)

// 订阅事件流，返回一个IDisposable对象
let subscription = view |&gt; mvc controller model

// 模拟事件的触发
printfn "Raising events...%A" model
raiseEvents [ Up; Up; Down; Up; Down; Down ]

subscription.Dispose()
</code></pre> 
<p>这个程序就实现了前面说的MVC模式，运行</p> 
<pre><code class="prism language-bash">dotnet fsi mvc.fsx
</code></pre> 
<p>得到状态的变迁过程：</p> 
<pre><code>Raising events...{ State = 0 }
Up ==&gt; Model state: { State = 1 }
Up ==&gt; Model state: { State = 2 }
Down ==&gt; Model state: { State = 1 }
Up ==&gt; Model state: { State = 2 }
Down ==&gt; Model state: { State = 1 }
Down ==&gt; Model state: { State = 0 }
</code></pre> 
<p>这个例子中，最大的特点就是Controller的实现非常干净，并且编译器还能够提示是否所有的事件情况都被处理了。</p> 
<h2><a id="_207"></a>总结</h2> 
<ol><li>F#中的事件驱动编程，可以通过<code>FSharp.Core.Event</code>来实现；</li><li>通过ADT，可以很好地抽象出MVC模式；</li><li>通过MVC模式，可以很好地描述事件驱动的程序。</li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c07c65f034f4fbaf10ada21cbee3e4c1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue使用sort排序时报死循环错误:you may have an infinite update loop in a component render function</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/156aaefbe1424b0fec2c0fc1db797aaa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">服务器负载均衡配置——基于HTTPS流量的服务器负载均衡</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>