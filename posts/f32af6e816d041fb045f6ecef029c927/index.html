<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【深度学习】Pytorch基础 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【深度学习】Pytorch基础" />
<meta property="og:description" content="张量 运算与操作 加减乘除
pytorch中tensor运算逐元素进行，或者一一对应计算
常用操作
典型维度为N X C X H X W，N为图像张数，C为图像通道数，HW为图高宽。
sum()
一般，指定维度，且keepdim=True该维度上元素相加，长度变为1。升降维度
unsqueeze() 扩充维度 image = PIL.Image.open(&#39;lena.jpg&#39;).convert(&#39;RGB&#39;) transform = torchvision.tranforms.Compose([torchvision.transforms.ToTensor()]) img = transform(image) img = img.unsqueeze(0) sequeeze()将长度为1的维度抹除，数据不会减少。
将输入（图像）转换为张量，torchvision.transforms.ToTensor() class ToTensor: &#34;&#34;&#34;Convert a ``PIL Image`` or ``numpy.ndarray`` to tensor. This transform does not support torchscript. tensor转换为cvMat 获得元素反归一化变换通道顺序 维度展开 # 除第1维，其他维展开 x = torch.flatten(x, 1) Variable view()方法
卷积输出N*C*H*W，输入全连接层，需要变形为N*size
torchvision import torchvision as tv # 查看网络的结构 features = tv.models.alexnet().features # 在dim=1上求和，第1维度压缩为1 torch." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/f32af6e816d041fb045f6ecef029c927/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-05T17:52:05+08:00" />
<meta property="article:modified_time" content="2024-03-05T17:52:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【深度学习】Pytorch基础</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>张量</h3> 
<ul><li>运算与操作</li></ul> 
<ol><li> <p>加减乘除<br> pytorch中tensor运算逐元素进行，或者一一对应计算</p> </li><li> <p>常用操作<br> 典型维度为N X C X H X W，N为图像张数，C为图像通道数，HW为图高宽。</p> </li></ol> 
<ul><li>sum()<br> 一般，指定维度，且<code>keepdim=True</code>该维度上元素相加，长度变为1。</li><li>升降维度<br> unsqueeze() 扩充维度</li></ul> 
<pre><code class="prism language-python">    image <span class="token operator">=</span> PIL<span class="token punctuation">.</span>Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'lena.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">)</span>
    transform <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>tranforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> transform<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
    img <span class="token operator">=</span> img<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>sequeeze()将长度为1的维度抹除，数据不会减少。</p> 
<ul><li>将输入（图像）转换为张量，<code>torchvision.transforms.ToTensor()</code></li></ul> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">ToTensor</span><span class="token punctuation">:</span>
    <span class="token string">""</span>"Convert a ``PIL Image`` <span class="token keyword">or</span> ``numpy<span class="token punctuation">.</span>ndarray`` to tensor<span class="token punctuation">.</span> This transform does <span class="token keyword">not</span> support torchscript<span class="token punctuation">.</span>
</code></pre> 
<ul><li>tensor转换为cvMat</li></ul> 
<ol><li>获得元素</li><li>反归一化</li><li>变换通道顺序</li></ol> 
<ul><li>维度展开</li></ul> 
<pre><code class="prism language-python">    <span class="token comment"># 除第1维，其他维展开</span>
    x <span class="token operator">=</span> torch<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="Variable_43"></a>Variable</h4> 
<p>view()方法<br> 卷积输出<code>N*C*H*W</code>，输入全连接层，需要变形为<code>N*size</code></p> 
<h4><a id="torchvision_47"></a>torchvision</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torchvision <span class="token keyword">as</span> tv
<span class="token comment"># 查看网络的结构</span>
features <span class="token operator">=</span> tv<span class="token punctuation">.</span>models<span class="token punctuation">.</span>alexnet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>features
<span class="token comment"># 在dim=1上求和，第1维度压缩为1</span>
torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>in_feat<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="torchnn_56"></a>torch.nn</h4> 
<ol><li>Module<br> 用于构建神经网络模型的基类，有方法<br> <code>register_buffer</code>，<code>register_parameter</code>，声明常量与模型参数。</li><li>ModuleList</li><li>train()与eval()</li><li>ConvTranspose2d 图像反卷积，可实现上采样，如ConvTranspose2d(256, 128, 3, 2, 1, 1), 输入输出通道分别为256\128，反卷积核大小为3，反卷积的stride为2，即图像大小变为2倍，输出尺寸公式是卷积公式的逆运算；与卷积参数一致，形式即正逆。</li></ol> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           H 
          
          
          
            o 
           
          
            u 
           
          
            t 
           
          
         
        
          = 
         
        
          ( 
         
         
         
           H 
          
          
          
            i 
           
          
            n 
           
          
         
        
          − 
         
        
          1 
         
        
          ) 
         
        
          × 
         
        
          stride 
         
        
          [ 
         
        
          0 
         
        
          ] 
         
        
          − 
         
        
          2 
         
        
          × 
         
        
          padding 
         
        
          [ 
         
        
          0 
         
        
          ] 
         
        
          + 
         
        
          dilation 
         
        
          [ 
         
        
          0 
         
        
          ] 
         
        
          × 
         
        
          ( 
         
        
          kernel_size 
         
        
          [ 
         
        
          0 
         
        
          ] 
         
        
          − 
         
        
          1 
         
        
          ) 
         
        
          + 
         
        
          output_padding 
         
        
          [ 
         
        
          0 
         
        
          ] 
         
        
          + 
         
        
          1 
         
        
       
         H_{out} = (H_{in} - 1) \times \text{stride}[0] - 2 \times \text{padding}[0] + \text{dilation}[0] \times (\text{kernel\_size}[0] - 1) + \text{output\_padding}[0] + 1 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0813em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span class="" style="top: -2.55em; margin-left: -0.0813em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0813em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.0813em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">stride</span></span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">padding</span></span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">dilation</span></span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">kernel_size</span></span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mord text"><span class="mord">output_padding</span></span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span></span></p> 
<ol><li>模型参数</li></ol> 
<pre><code class="prism language-python">    <span class="token keyword">for</span> key <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span>para_task<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        para_task<span class="token punctuation">[</span>key<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'module.'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> para_task<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_78"></a>数据集的输入与处理</h4> 
<p>对图像预处理：https://pytorch.org/vision/stable/transforms.html<br> transforms.Compose()设置图像预处理模式组合，例如</p> 
<pre><code class="prism language-python">train_transforms <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span>
        <span class="token comment"># [transforms.RandomCrop(args.patch_size), transforms.ToTensor()]</span>
        <span class="token comment"># [transforms.ToTensor(),]</span>
        <span class="token comment"># 图像中心裁剪边长为256像素</span>
        <span class="token punctuation">[</span>transforms<span class="token punctuation">.</span>CenterCrop<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span> transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">from</span> torchvision <span class="token keyword">import</span> datasets<span class="token punctuation">,</span> transforms
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader
<span class="token comment"># 含义为把PIL图像转换为tensor格式，</span>
train_dataset <span class="token operator">=</span> datasets<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'data/'</span><span class="token punctuation">,</span>
                               train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                               transform<span class="token operator">=</span>transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
                                   transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                               <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                               download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test_dataset <span class="token operator">=</span> datasets<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'data/'</span><span class="token punctuation">,</span>
                              train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                              transform<span class="token operator">=</span>transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
                                  transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
train_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>train_dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>test_dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_112"></a>神经网络模型的构建与训练</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torchvision
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable

<span class="token comment"># 构建网络</span>
<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Model<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
            torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dense <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
            torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">14</span> <span class="token operator">*</span> <span class="token number">14</span> <span class="token operator">*</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span> <span class="token operator">*</span> <span class="token number">14</span> <span class="token operator">*</span> <span class="token number">128</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x
<span class="token comment"># device</span>
device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span>
<span class="token comment"># 声明待训练的模型和优化方法</span>
model <span class="token operator">=</span> Model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
cost <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># N epoch 训练</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sum_loss <span class="token operator">=</span> <span class="token number">0.0</span>
    train_correct <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> data <span class="token keyword">in</span> train_loader<span class="token punctuation">:</span>
        inputs<span class="token punctuation">,</span> labels <span class="token operator">=</span> data
        inputs<span class="token punctuation">,</span> labels <span class="token operator">=</span> Variable<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Variable<span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> cost<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>通过pytorch.nn.module、torchvision构建的网络模型是否训练</p> 
<pre><code class="prism language-python"><span class="token keyword">if</span> requires_grad<span class="token punctuation">:</span> <span class="token comment">#需要训练时，设为真</span>
    <span class="token keyword">for</span> para <span class="token keyword">in</span> <span class="token operator">&lt;</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>module 对象<span class="token operator">&gt;</span><span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        para<span class="token punctuation">.</span>requires_grad <span class="token operator">=</span> <span class="token boolean">True</span>
</code></pre> 
<p><code>torch.nn.module</code>的子类对象，如下可添加网络层数</p> 
<pre><code class="prism language-python">nn<span class="token punctuation">.</span>layers <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后把网络模型参数作为训练的优化参数</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Trainer</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>parameters <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>net<span class="token operator">&gt;</span><span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lr <span class="token operator">=</span> <span class="token number">1e-3</span>
        self<span class="token punctuation">.</span>optimizer_net <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>self<span class="token punctuation">.</span>parameters<span class="token punctuation">,</span>lr <span class="token operator">=</span> self<span class="token punctuation">.</span>lr<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_184"></a>池化</h4> 
<pre><code class="prism language-python"><span class="token comment"># power-2 pool of square window of size=3, stride=2</span>
nn<span class="token punctuation">.</span>LPPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">L2pooling</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filter_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> channels<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> pad_off<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>L2pooling<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>padding <span class="token operator">=</span> <span class="token punctuation">(</span>filter_size <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
        self<span class="token punctuation">.</span>stride <span class="token operator">=</span> stride
        self<span class="token punctuation">.</span>channels <span class="token operator">=</span> channels
        a <span class="token operator">=</span> np<span class="token punctuation">.</span>hanning<span class="token punctuation">(</span>filter_size<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        g <span class="token operator">=</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> a<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        g <span class="token operator">=</span> g <span class="token operator">/</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>
        <span class="token comment"># pdb.set_trace()</span>
        self<span class="token punctuation">.</span>register_buffer<span class="token punctuation">(</span>
            <span class="token string">"filter"</span><span class="token punctuation">,</span> g<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>channels<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">input</span> <span class="token operator">=</span> <span class="token builtin">input</span> <span class="token operator">**</span> <span class="token number">2</span>
        out <span class="token operator">=</span> F<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>
            <span class="token builtin">input</span><span class="token punctuation">,</span>
            self<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">,</span>
            stride<span class="token operator">=</span>self<span class="token punctuation">.</span>stride<span class="token punctuation">,</span>
            padding<span class="token operator">=</span>self<span class="token punctuation">.</span>padding<span class="token punctuation">,</span>
            groups<span class="token operator">=</span><span class="token builtin">input</span><span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>out <span class="token operator">+</span> <span class="token number">1e-12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_215"></a>错误</h4> 
<ol><li>分类标签有9类，在构建数据集的标签时写为1~9，运行时错误，将标签-1解错。</li><li>使用list错误，pytorch无法构造tensor。<br> TypeError: Variable data has to be a tensor, but got list<br> <code>label = np.zeros(10, dtype=np.float32)</code></li><li>numpy中float是双精度，pytorch变量均为单精度。</li><li>pytorch transform必须放在Dataset对象，且库为</li></ol> 
<pre><code class="prism language-python">torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
                                torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>RandomCrop<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">506</span><span class="token punctuation">,</span> <span class="token number">606</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li> <p>File “/home/zpk/CompressAI/iqa_models.py”, line 220, in forward<br> dist_s += (self.alpha0 * self.structure(mu0a, mu0b)<br> RuntimeError: Expected all tensors to be on the same device, but found at least two devices, cuda:0 and cpu!<br> 程序参数 忘记加–cuda，导致训练数据是在cpu上。</p> </li><li> <p>RuntimeError: grad can be implicitly created only for scalar outputs<br> 模型输出取mean()。</p> </li></ol> 
<h3><a id="COCO_238"></a>COCO数据集训练</h3> 
<p>使用fiftyone库实现训练。</p> 
<p>fiftyone下载数据集在/home//fiftyone，</p> 
<pre><code>fiftyone/coco-2017
├── info.json
├── raw
│   ├── captions_train2017.json
│   ├── captions_val2017.json
│   ├── instances_train2017.json
│   ├── instances_val2017.json
│   ├── person_keypoints_train2017.json
│   └── person_keypoints_val2017.json
├── train
│   ├── data -&gt; /home/zpk/Data/coco_real/train2017
│   └── labels.json
└── validation
    ├── data -&gt; /home/zpk/Data/coco_real/val2017
    └── labels.json
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> fiftyone <span class="token keyword">as</span> fo
<span class="token keyword">import</span> fiftyone<span class="token punctuation">.</span>zoo <span class="token keyword">as</span> foz
<span class="token keyword">from</span> fiftyone <span class="token keyword">import</span> ViewField <span class="token keyword">as</span> F
<span class="token keyword">class</span> <span class="token class-name">FiftyOneTorchDataset</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""A class to construct a PyTorch dataset from a FiftyOne dataset.

    Args:
        fiftyone_dataset: a FiftyOne dataset or view that will be used for training or testing
        transforms (None): a list of PyTorch transforms to apply to images and targets when loading
        gt_field ("ground_truth"): the name of the field in fiftyone_dataset that contains the 
            desired labels to load
        classes (None): a list of class strings that are used to define the mapping between
            class names and indices. If None, it will use all classes present in the given fiftyone_dataset.
    """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span>
        fiftyone_dataset<span class="token punctuation">,</span>
        transforms<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
        gt_field<span class="token operator">=</span><span class="token string">"ground_truth"</span><span class="token punctuation">,</span>
        classes<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>samples <span class="token operator">=</span> fiftyone_dataset
        self<span class="token punctuation">.</span>transforms <span class="token operator">=</span> transforms
        self<span class="token punctuation">.</span>gt_field <span class="token operator">=</span> gt_field
        self<span class="token punctuation">.</span>img_paths <span class="token operator">=</span> self<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">"filepath"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>classes <span class="token operator">=</span> classes
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>classes<span class="token punctuation">:</span>
            <span class="token comment"># Get list of distinct labels that exist in the view</span>
            self<span class="token punctuation">.</span>classes <span class="token operator">=</span> self<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>distinct<span class="token punctuation">(</span>
                <span class="token string">"%s.detections.label"</span> <span class="token operator">%</span> gt_field
            <span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>classes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"background"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>classes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"background"</span><span class="token punctuation">]</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>classes
        self<span class="token punctuation">.</span>labels_map_rev <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>c<span class="token punctuation">:</span> i <span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>classes<span class="token punctuation">)</span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        img_path <span class="token operator">=</span> self<span class="token punctuation">.</span>img_paths<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
        sample <span class="token operator">=</span> self<span class="token punctuation">.</span>samples<span class="token punctuation">[</span>img_path<span class="token punctuation">]</span>
        metadata <span class="token operator">=</span> sample<span class="token punctuation">.</span>metadata
        img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>img_path<span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">)</span>
        boxes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        area <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        iscrowd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        detections <span class="token operator">=</span> sample<span class="token punctuation">[</span>self<span class="token punctuation">.</span>gt_field<span class="token punctuation">]</span><span class="token punctuation">.</span>detections
        <span class="token keyword">for</span> det <span class="token keyword">in</span> detections<span class="token punctuation">:</span>
            category_id <span class="token operator">=</span> self<span class="token punctuation">.</span>labels_map_rev<span class="token punctuation">[</span>det<span class="token punctuation">.</span>label<span class="token punctuation">]</span>
            coco_obj <span class="token operator">=</span> fouc<span class="token punctuation">.</span>COCOObject<span class="token punctuation">.</span>from_label<span class="token punctuation">(</span>
                det<span class="token punctuation">,</span> metadata<span class="token punctuation">,</span> category_id<span class="token operator">=</span>category_id<span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
            x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> coco_obj<span class="token punctuation">.</span>bbox
            boxes<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">]</span><span class="token punctuation">)</span>
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>coco_obj<span class="token punctuation">.</span>category_id<span class="token punctuation">)</span>
            area<span class="token punctuation">.</span>append<span class="token punctuation">(</span>coco_obj<span class="token punctuation">.</span>area<span class="token punctuation">)</span>
            iscrowd<span class="token punctuation">.</span>append<span class="token punctuation">(</span>coco_obj<span class="token punctuation">.</span>iscrowd<span class="token punctuation">)</span>
        target <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        target<span class="token punctuation">[</span><span class="token string">"boxes"</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>as_tensor<span class="token punctuation">(</span>boxes<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
        target<span class="token punctuation">[</span><span class="token string">"labels"</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>as_tensor<span class="token punctuation">(</span>labels<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>int64<span class="token punctuation">)</span>
        target<span class="token punctuation">[</span><span class="token string">"image_id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>as_tensor<span class="token punctuation">(</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span>
        target<span class="token punctuation">[</span><span class="token string">"area"</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>as_tensor<span class="token punctuation">(</span>area<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
        target<span class="token punctuation">[</span><span class="token string">"iscrowd"</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>as_tensor<span class="token punctuation">(</span>iscrowd<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>int64<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>transforms <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            img<span class="token punctuation">,</span> target <span class="token operator">=</span> self<span class="token punctuation">.</span>transforms<span class="token punctuation">(</span>img<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
        <span class="token keyword">return</span> img<span class="token punctuation">,</span> target

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>img_paths<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_classes</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>classes
fo_dataset <span class="token operator">=</span> foz<span class="token punctuation">.</span>load_zoo_dataset<span class="token punctuation">(</span><span class="token string">"coco-2017"</span><span class="token punctuation">,</span> split <span class="token operator">=</span> <span class="token string">"train"</span><span class="token punctuation">)</span>
dataset_dir <span class="token operator">=</span> <span class="token string">"/path/to/coco-2017"</span>
<span class="token comment"># The type of the dataset being imported</span>
dataset_type <span class="token operator">=</span> fo<span class="token punctuation">.</span>types<span class="token punctuation">.</span>COCODetectionDataset  <span class="token comment"># for example</span>
dataset <span class="token operator">=</span> fo<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_dir<span class="token punctuation">(</span>
    dataset_dir<span class="token operator">=</span>dataset_dir<span class="token punctuation">,</span>
    dataset_type<span class="token operator">=</span>dataset_type<span class="token punctuation">,</span>
    name<span class="token operator">=</span>name<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
valid_view <span class="token operator">=</span> fo_dataset<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>F<span class="token punctuation">(</span><span class="token string">"ground_truth.detections"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
torch_dataset <span class="token operator">=</span> FiftyOneTorchDataset<span class="token punctuation">(</span>valid_view<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/97563d2d81065746e659897a83a4418b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于“xxx” Androidx平台的驱动及系统开发 之 触摸板篇</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6a2f1ebd0abe5a21cf003e7f7481c81a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">react-beautiful-dnd组件报Unable to find draggable with id</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>