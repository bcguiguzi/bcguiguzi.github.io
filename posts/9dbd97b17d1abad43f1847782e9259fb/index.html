<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于宽窄字符串和指针读取的问题 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="关于宽窄字符串和指针读取的问题" />
<meta property="og:description" content="最近这学习图像处理的入门课程，拿到老师给的源码之后半天跑不通，逐行调试的时候发现问题出在使用CString定义字符串的时候，使用char* 无法正确读取其中的内容。以下是老师所给出的源码
CString SFName; SFName = MyFDlg.GetPathName(); //读取文件名 char* fnstr;	//定义了一个char指针变量fnstr，用于存储SFName字符串的地址。 fnstr = SFName.GetBuffer(4); //read the name from string 但是给我报错说不能将“LPWSTR”类型的值分配到“char*”类型的实体。
因此我将
fnstr = SFName.GetBuffer(4); 修改为：
fnstr = (char*)SFName.GetBuffer(4); 然而这个操作之后，指针fnstr不能对SFName的内容进行完全读取，
如上面截图所示，fnstr指针只能读取到“D”而后面的路径就被完全舍去了。之后问了chatgpt，发现CString是宽字符串，需要将其改为窄字符串的类型CStringA的类型。
再次运行：
发现能够正常读取，并且使用len = strlen(fnstr);也能正确读取字符串长度，问题解决。
-------------------------------------分割线---------------------------------------------
因为不了解其中的原理，所以我查了一下chatgpt，回答如下：
为什么在使用 CString 类时，fnstr 只能获取到 &#34;D&#34; 而不是完整的路径，这可能是因为在 Unicode 模式下，CString 默认会将宽字符编码（Unicode）的路径存储在其中。因此，当你试图将宽字符指针强制转换为窄字符指针时，只能获取到第一个字符 &#34;D&#34;，因为窄字符指针无法正确解析宽字符编码的路径。而当你使用 CStringA 类型的 SFName 时，它已经明确指定了使用窄字符集，所以能够正常获取到完整的路径。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/9dbd97b17d1abad43f1847782e9259fb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-28T10:46:20+08:00" />
<meta property="article:modified_time" content="2024-02-28T10:46:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于宽窄字符串和指针读取的问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近这学习图像处理的入门课程，拿到老师给的源码之后半天跑不通，逐行调试的时候发现问题出在使用CString定义字符串的时候，使用char* 无法正确读取其中的内容。以下是老师所给出的源码</p> 
<pre><code class="language-cpp">        CString SFName;
		SFName = MyFDlg.GetPathName(); //读取文件名

		char* fnstr;	//定义了一个char指针变量fnstr，用于存储SFName字符串的地址。

		fnstr = SFName.GetBuffer(4); //read the name from string </code></pre> 
<p>但是给我报错说不能将“LPWSTR”类型的值分配到“char*”类型的实体。<br> 因此我将</p> 
<pre><code class="language-cpp">fnstr = SFName.GetBuffer(4);</code></pre> 
<p>修改为：</p> 
<pre><code class="language-cpp">fnstr = (char*)SFName.GetBuffer(4);</code></pre> 
<p>然而这个操作之后，指针fnstr不能对SFName的内容进行完全读取，</p> 
<p><img alt="" height="76" src="https://images2.imgbox.com/f5/95/nlvVbIAo_o.png" width="1002"></p> 
<p>如上面截图所示，fnstr指针只能读取到“D”而后面的路径就被完全舍去了。之后问了chatgpt，发现CString是宽字符串，需要将其改为窄字符串的类型CStringA的类型。<br> 再次运行：</p> 
<p><img alt="" height="115" src="https://images2.imgbox.com/54/89/ISGToLdv_o.png" width="880">发现能够正常读取，并且使用len = strlen(fnstr);也能正确读取字符串长度，问题解决。</p> 
<p></p> 
<p>-------------------------------------分割线---------------------------------------------</p> 
<p>因为不了解其中的原理，所以我查了一下chatgpt，回答如下：</p> 
<p><img alt="" height="362" src="https://images2.imgbox.com/e2/c4/drTtyg1I_o.png" width="1144">        为什么在使用 <code>CString</code> 类时，<code>fnstr</code> 只能获取到 "D" 而不是完整的路径，这可能是因为在 Unicode 模式下，<code>CString</code> 默认会将宽字符编码（Unicode）的路径存储在其中。因此，当你试图将宽字符指针强制转换为窄字符指针时，只能获取到第一个字符 "D"，因为窄字符指针无法正确解析宽字符编码的路径。而当你使用 <code>CStringA</code> 类型的 <code>SFName</code> 时，它已经明确指定了使用窄字符集，所以能够正常获取到完整的路径。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cf5d980bbbcd11221fff11f4e5ddd4a6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">企业销售员考核及奖金核算小程序计算机毕业设计</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dccd8341c7f52299581ea654b7035ada/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Docker的简单介绍以及常用命令介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>