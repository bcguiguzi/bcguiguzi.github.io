<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>rocky linux 8.8 安装 fail2ban 提示 No module named ‘fail2ban‘ - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="rocky linux 8.8 安装 fail2ban 提示 No module named ‘fail2ban‘" />
<meta property="og:description" content="环境 系统：rocky linux 8.8Python版本：Python 3.6.8 安装 安装过程大概如下：
# 下载 fail2ban 1.0.2版本 wget https://github.com/fail2ban/fail2ban/archive/refs/tags/1.0.2.tar.gz tar xzf 1.0.2.tar.gz &amp;&amp; cd fail2ban-1.0.2 # 执行fail2ban自带的fail2ban-2to3工具进行转换 ./fail2ban-2to3 # 无意外最后会提示Success! # 进行单元测试 ./fail2ban-testcases-all-python3 # 测试完成后，进行最后一步安装 python3 setup.py install cp build/fail2ban.service /lib/systemd/system/ 在执行systemctl start fail2ban.service后提示：
● fail2ban.service - Fail2Ban Service Loaded: loaded (/usr/lib/systemd/system/fail2ban.service; disabled; vendor preset: disabled) Active: failed (Result: exit-code) since Thu 2023-10-26 21:39:57 CST; 3s ago Docs: man:fail2ban(1) Process: 2610466 ExecStart=/usr/local/bin/fail2ban-server -xf start (code=exited, status=1/FAILURE) Process: 2610464 ExecStartPre=/bin/mkdir -p /run/fail2ban (code=exited, status=0/SUCCESS) Main PID: 2610466 (code=exited, status=1/FAILURE) Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/2f2a96d9db7a71ecaac786885d6ea5ca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-16T08:36:34+08:00" />
<meta property="article:modified_time" content="2024-01-16T08:36:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">rocky linux 8.8 安装 fail2ban 提示 No module named ‘fail2ban‘</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_1"></a>环境</h3> 
<ol><li>系统：rocky linux 8.8</li><li>Python版本：Python 3.6.8</li></ol> 
<h3><a id="_4"></a>安装</h3> 
<p>安装过程大概如下：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 下载 fail2ban 1.0.2版本</span>
<span class="token function">wget</span> https://github.com/fail2ban/fail2ban/archive/refs/tags/1.0.2.tar.gz
<span class="token function">tar</span> xzf <span class="token number">1.0</span>.2.tar.gz <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> fail2ban-1.0.2
<span class="token comment"># 执行fail2ban自带的fail2ban-2to3工具进行转换</span>
./fail2ban-2to3 
<span class="token comment"># 无意外最后会提示Success!</span>
<span class="token comment"># 进行单元测试</span>
./fail2ban-testcases-all-python3
<span class="token comment"># 测试完成后，进行最后一步安装</span>
python3 setup.py <span class="token function">install</span>
<span class="token function">cp</span> build/fail2ban.service /lib/systemd/system/
</code></pre> 
<p>在执行<code>systemctl start fail2ban.service</code>后提示：</p> 
<pre><code>● fail2ban.service - Fail2Ban Service
   Loaded: loaded (/usr/lib/systemd/system/fail2ban.service; disabled; vendor preset: disabled)
   Active: failed (Result: exit-code) since Thu 2023-10-26 21:39:57 CST; 3s ago
     Docs: man:fail2ban(1)
  Process: 2610466 ExecStart=/usr/local/bin/fail2ban-server -xf start (code=exited, status=1/FAILURE)
  Process: 2610464 ExecStartPre=/bin/mkdir -p /run/fail2ban (code=exited, status=0/SUCCESS)
 Main PID: 2610466 (code=exited, status=1/FAILURE)

Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Main process exited, code=exited, status=1/FAILURE
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Failed with result 'exit-code'.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Service RestartSec=100ms expired, scheduling restart.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Scheduled restart job, restart counter is at 5.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: Stopped Fail2Ban Service.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Start request repeated too quickly.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Failed with result 'exit-code'.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: Failed to start Fail2Ban Service.
</code></pre> 
<p>在查看<code>/var/log/messages</code>日志中，得到以下信息：</p> 
<pre><code>Oct 26 21:39:56 iZwz952biq4t3vffese51wZ systemd[1]: Starting Fail2Ban Service...
Oct 26 21:39:56 iZwz952biq4t3vffese51wZ systemd[1]: Started Fail2Ban Service.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ fail2ban-server[2610466]: Traceback (most recent call last):
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ fail2ban-server[2610466]:  File "/usr/local/bin/fail2ban-server", line 34, in &lt;module&gt;
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ fail2ban-server[2610466]:    from fail2ban.client.fail2banserver import exec_command_line, sys
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ fail2ban-server[2610466]: ModuleNotFoundError: No module named 'fail2ban'
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Main process exited, code=exited, status=1/FAILURE
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Failed with result 'exit-code'.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Service RestartSec=100ms expired, scheduling restart.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Scheduled restart job, restart counter is at 5.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: Stopped Fail2Ban Service.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Start request repeated too quickly.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: fail2ban.service: Failed with result 'exit-code'.
Oct 26 21:39:57 iZwz952biq4t3vffese51wZ systemd[1]: Failed to start Fail2Ban Service.
</code></pre> 
<h3><a id="_55"></a>解决</h3> 
<p>经查找原因，得知 Systemd 会以最小环境启动进程，因此如果从 systemd 单元启动，python 路径可能会有所不同。因此可以在 systemd-unit 环境中扩展 <code>PYTHONPATH</code>（以包含 <code>/usr/local/lib/python3.6/site-packages</code>）。</p> 
<p>编辑<code>/lib/systemd/system/fail2ban.service</code>文件，在<code>Service</code>添加一个<code>Environment="PYTHONPATH=/usr/local/lib/python3.6/site-packages"</code>环境变量：</p> 
<pre><code class="prism language-properties">[Unit]
Description=Fail2Ban Service
Documentation=man:fail2ban(1)
After=network.target iptables.service firewalld.service ip6tables.service ipset.service nftables.service
PartOf=iptables.service firewalld.service ip6tables.service ipset.service nftables.service

[Service]
Type=simple
Environment="PYTHONNOUSERSITE=1"
Environment="PYTHONPATH=/usr/local/lib/python3.6/site-packages"
ExecStartPre=/bin/mkdir -p /run/fail2ban
ExecStart=/usr/local/bin/fail2ban-server -xf start
# if should be logged in systemd journal, use following line or set logtarget to sysout in fail2ban.local
# ExecStart=/usr/local/bin/fail2ban-server -xf --logtarget=sysout start
ExecStop=/usr/local/bin/fail2ban-client stop
ExecReload=/usr/local/bin/fail2ban-client reload
PIDFile=/run/fail2ban/fail2ban.pid
Restart=on-failure
RestartPreventExitStatus=0 255

[Install]
WantedBy=multi-user.target
</code></pre> 
<p>更改完成后，尝试重新启动即可正常启动：</p> 
<pre><code class="prism language-bash">systemctl daemon-reload 
systemctl start fail2ban.service 
systemctl status fail2ban.service
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/959ad58d306df940591ce632f6fbef7e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">字符串与数组的异同</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d2d9d67bfff8dafe15d38423f1b401fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Jmeter接口测试实战篇：10分钟学会Jmeter的用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>