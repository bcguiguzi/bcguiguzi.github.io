<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>（二）vsftpd服务配置多用户多目录权限 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="（二）vsftpd服务配置多用户多目录权限" />
<meta property="og:description" content="（二）vsftpd服务配置多用户多目录权限 1，安装vsftpd服务 # 关闭SELINUX sed -i &#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39; /etc/selinux/config &amp;&amp; setenforce 0 # 关闭防火墙 systemctl stop firewalld &amp;&amp; systemctl disable firewalld # 时间同步 ntpdate 0.asia.pool.ntp.org # 安装服务 yum install vsftpd -y #此目录是配置文件目录 cd /etc/vsftpd/ &amp;&amp; ls # 启动 systemctl start vsftpd # 开机自启 systemctl enable vsftpd 2，场景化 搭建应用部FTP服务器，要求： 每位员工拥有独立根目录在自己目录下可见应用部公共目录publish（只读）、其他部门共享目录share（读写）在自己目录下有独立的日志（工作日报）目录，可写、可删除权限，但目录本身员工不可删除禁锢虚拟用户的主目录，同时禁止访问除主目录之外的目录开启日志，记录登录、上传、下载、删除信息 目录规划 应用部共享目录：/home/vsftpuser/share（任何用户可删除可上传可下载）
应用部公共目录：/home/vsftpuser/publish （任何用户可下载，特殊用户可上传下载删除）
员工个人独立目录：/home/vsftpuser/app/{xxx} （只能当前用户才能上传下载删除）
mkdir -p /home/vsftpuser/publish mkdir -p /home/vsftpuser/share mkdir -p /home/vsftpuser/app/zhangsan mkdir -p /home/vsftpuser/app/lisi 调整 vsftpd.conf 配置 vim /etc/vsftpd/vsftpd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/4087d1c87f7f96325cc04d2954b7e7ac/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-26T16:55:21+08:00" />
<meta property="article:modified_time" content="2022-07-26T16:55:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">（二）vsftpd服务配置多用户多目录权限</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="vsftpd_1"></a>（二）vsftpd服务配置多用户多目录权限</h2> 
<h3><a id="1vsftpd_3"></a>1，安装vsftpd服务</h3> 
<pre><code class="prism language-sh"># 关闭SELINUX
sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config &amp;&amp; setenforce 0
# 关闭防火墙
systemctl stop firewalld &amp;&amp; systemctl disable firewalld
# 时间同步
ntpdate 0.asia.pool.ntp.org
# 安装服务
yum install vsftpd -y
#此目录是配置文件目录
cd /etc/vsftpd/ &amp;&amp; ls
# 启动
systemctl start vsftpd
# 开机自启
systemctl enable vsftpd
</code></pre> 
<h3><a id="2_22"></a>2，场景化</h3> 
<h4><a id="FTP_24"></a>搭建应用部FTP服务器，要求：</h4> 
<ol><li>每位员工拥有独立根目录</li><li>在自己目录下可见应用部公共目录publish（只读）、其他部门共享目录share（读写）</li><li>在自己目录下有独立的日志（工作日报）目录，可写、可删除权限，但目录本身员工不可删除</li><li>禁锢虚拟用户的主目录，同时禁止访问除主目录之外的目录</li><li>开启日志，记录登录、上传、下载、删除信息</li></ol> 
<h3><a id="_32"></a><strong>目录规划</strong></h3> 
<p>应用部共享目录：/home/vsftpuser/share（任何用户可删除可上传可下载）</p> 
<p>应用部公共目录：/home/vsftpuser/publish （任何用户可下载，特殊用户可上传下载删除）</p> 
<p>员工个人独立目录：/home/vsftpuser/app/{xxx} （只能当前用户才能上传下载删除）</p> 
<pre><code class="prism language-sh">mkdir -p /home/vsftpuser/publish
mkdir -p /home/vsftpuser/share
mkdir -p /home/vsftpuser/app/zhangsan
mkdir -p /home/vsftpuser/app/lisi
</code></pre> 
<h4><a id="_vsftpdconf__47"></a>调整 vsftpd.conf 配置</h4> 
<pre><code class="prism language-sh">vim /etc/vsftpd/vsftpd.conf
</code></pre> 
<pre><code class="prism language-sh"># 修改 第12行
# 关闭匿名
anonymous_enable=NO

# 关闭注释 第100行
# 用户不可出根目录
chroot_local_user=YES
# 出根目录白名单
chroot_list_enable=YES
chroot_list_file=/etc/vsftpd/chroot_list

# 修改 第115行
listen=YES

# 打开注释 第123行
listen_ipv6=NO

# 修改
userlist_enable=YES
tcp_wrappers=YES

# 关闭注释 第43行
#connect_from_port_20=YES

# 新增
# 开启pam模块登录认证
pam_service_name=vsftpd.vu
# 禁锢虚拟用户的主目录，同时禁止访问除主目录之外的目录
virtual_use_local_privs=YES
guest_enable=YES
# 映射虚拟用户至系统用户（指定系统用户）
guest_username=vsftpuser
# 虚拟用户配置目录
user_config_dir=/etc/vsftpd/virconf/
allow_writeable_chroot=YES
# 开启被动模式
pasv_enable=YES
# 使用被动模式38001至39001端口
pasv_min_port=38001
pasv_max_port=39001

#使用本地时间
use_localtime=YES

pasv_address=192.168.56.90
pasv_addr_resolve=YES
ftp_data_port=16020

# 日志文件配置，并开启xferlog与vsftp.log双日志，xferlog记录上传与下载信息，vsftpd.log记录登录、上传、下载、删除等详细信息
dual_log_enable=YES
xferlog_enable=YES
log_ftp_protocol=YES
xferlog_std_format=YES
reverse_lookup_enable=NO
</code></pre> 
<h4><a id="_chroot_list__110"></a>创建 chroot_list 文件</h4> 
<pre><code class="prism language-sh">touch /etc/vsftpd/chroot_list
</code></pre> 
<h4><a id="_vsftpuser__116"></a>创建 vsftpuser 系统用户</h4> 
<pre><code class="prism language-sh"># 所有vsftpd虚拟用户需要映射到一个系统用户，该系统用户不需要密码，也不需要登录，主要用于虚拟用户映射使用
useradd -d /home/vsftpuser -s /sbin/nologin vsftpuser
</code></pre> 
<h4><a id="_123"></a>创建虚拟用户</h4> 
<pre><code class="prism language-sh">vim /etc/vsftpd/vsftpuser
</code></pre> 
<p>内容如下：</p> 
<pre><code class="prism language-txt">lisi  ##奇数行为用户名
123123 ##偶数行为密码
zhangsan
123123
</code></pre> 
<h4><a id="ftp_138"></a>生成ftp登录认证的数据库文件</h4> 
<pre><code class="prism language-sh">db_load -T -t hash -f vsftpuser vsftpuser.db
chmod 600 vsftpuser ##安全起见，不让别人看到，设置权限
chmod 600 vsftpuser.db
</code></pre> 
<h4><a id="ftp_146"></a>配置ftp使用虚拟用户</h4> 
<pre><code class="prism language-sh">vim /etc/pam.d/vsftpd.vu
</code></pre> 
<p>完整配置如下：</p> 
<pre><code class="prism language-properties">auth required pam_userdb.so db=/etc/vsftpd/vsftpuser ##识别转换过的数据库文件
account required pam_userdb.so db=/etc/vsftpd/vsftpuser ##连接的密码服务
</code></pre> 
<h4><a id="_159"></a>创建虚拟用户权限目录及配置</h4> 
<h5><a id="_161"></a>创建虚拟用户权限目录</h5> 
<pre><code class="prism language-sh">mkdir /etc/vsftpd/virconf
</code></pre> 
<h5><a id="_167"></a>虚拟用户权限配置</h5> 
<p>每个用户都有一个配置文件</p> 
<h5><a id="zhangsan_171"></a>zhangsan</h5> 
<pre><code class="prism language-sh">vi /etc/vsftpd/virconf/zhangsan
</code></pre> 
<pre><code class="prism language-sh">local_root=/home/vsftpuser/app/zhangsan
virtual_use_local_privs=YES
# 允许登录用户有可写权限
write_enable=YES
# 允许匿名用户上传文件权限，只在write_enable=YES时生效
anon_upload_enable=YES
# 允许匿名用户创建目录，只有在write_enable=YES时生效
anon_mkdir_write_enable=YES
# 可写
allow_writeable_chroot=YES
</code></pre> 
<p>参数说明：</p> 
<pre><code class="prism language-sh">完全权限：

cmds_allowed=ABOR,CWD,LIST,DELE,RMD,MDTM,MKD,NLST,PASS,PASV,PORT,PWD,QUIT,RETR,RNFR,RNTO,SIZE,STOR,TYPE,USER,ACCT,APPE,CDUP,HELP,MODE,NOOP,REIN,STAT,STOU,STRU,SYST

仅上传权限：

cmds_allowed=FEAT,REST,CWD,LIST,MDTM,MKD,NLST,PASS,PASV,PORT,PWD,QUIT,RMD,SIZE,STOR,TYPE,USER,ACCT,APPE,CDUP,HELP,MODE,NOOP,REIN,STAT,STOU,STRU,SYST


权限项详情：

commoncommands 常用命令：

# ABOR - abort a filetransfer 取消文件传输

# CWD - change workingdirectory 更改目录

# DELE - delete a remotefile 删除文件

# LIST - list remotefiles 列出目录

# MDTM - return themodification time of a file 返回文件的更新时间

# MKD - make a remotedirectory 新建文件夹

# NLST -name list of remote directory 文件夹重命名

# PASS -send password 发送密码

# PASV -enter passive mode 进入被动模式

# PORT - open a data port打开一个传输端口

# PWD - print workingdirectory 显示当前工作目录

# QUIT - terminate theconnection 退出

# RETR - retrieve aremote file 下载文件

# RMD -remove a remote directory 删除文件夹

# RNFR -rename from 重命名

# RNTO -rename to 重命名

# SITE -site-specific commands 特定的命令

# SIZE - return the sizeof a file 返回文件大小

# STOR - store a file onthe remote host 上传文件

# TYPE -set transfer type 设置传输类型

# USER -send username 发送的用户名

 

# lesscommon commands 不常用命令:

# ACCT*- send account information 发送账号信息

# APPE -append to a remote file 追加文件

# CDUP -CWD to the parent of the current directory 进入上级目录

# HELP -return help on using the server 返回帮助信息

# MODE -set transfer mode 设置传输模式

# NOOP -do nothing 等待，此命令不产生什么实际动作，它仅使服务器返回OK。

# REIN*- reinitialize the connection 重新初始化连接

# STAT -return server status 返回服务器状态

# STOU -store a file uniquely 唯一地存储文件

# STRU -set file transfer structure 设置文件传输结构

# SYST -return system type 返回系统类型
</code></pre> 
<h4><a id="_275"></a>设置公共目录</h4> 
<p>创建公共目录</p> 
<pre><code>mkdir -p /home/vsftpuser/app/zhangsan/publish
mkdir -p /home/vsftpuser/app/zhangsan/share
mkdir -p /home/vsftpuser/app/lisi/publish
mkdir -p /home/vsftpuser/app/lisi/share 
</code></pre> 
<p>使用mount -B -o rw,ro来将公共目录、日志目录添加至个人根目录</p> 
<p>因为1个虚拟用户只可以配置1个目录，故需要通过mount -B来实现目录共享</p> 
<pre><code class="prism language-sh">mount -B -o ro /home/vsftpuser/publish /home/vsftpuser/app/zhangsan/publish
mount -B -o rw /home/vsftpuser/share /home/vsftpuser/app/zhangsan/share
mount -B -o ro /home/vsftpuser/publish /home/vsftpuser/app/lisi/publish 
mount -B -o rw /home/vsftpuser/share /home/vsftpuser/app/lisi/share 
</code></pre> 
<p>注：mount -B 是保存在内存中，重启服务器失效，故需要将配置放入/etc/rc.local中</p> 
<p>解除挂载命令</p> 
<pre><code>umount /home/vsftpuser/app/zhangsan/publish
</code></pre> 
<p>当挂载目录的时候，如果所被挂载的目录有文件数据，那么挂载完以后原来的数据就看不见了。当解除挂载后又能看到。</p> 
<h5><a id="mount_307"></a>优化mount挂载</h5> 
<p><strong>方式一：直接写入/etc/rc.local文件</strong></p> 
<pre><code class="prism language-sh">vim /etc/rc.local
</code></pre> 
<p>追加内容如下：</p> 
<pre><code class="prism language-sh">mount -B -o ro /home/vsftpuser/publish /home/vsftpuser/app/zhangsan/publish
mount -B -o rw /home/vsftpuser/share /home/vsftpuser/app/zhangsan/share
mount -B -o ro /home/vsftpuser/publish /home/vsftpuser/app/lisi/publish 
mount -B -o rw /home/vsftpuser/share /home/vsftpuser/app/lisi/share 
</code></pre> 
<p>保存退出。</p> 
<p><strong>方式二：脚本执行</strong></p> 
<blockquote> 
 <p>#35为启动级别，10为关闭的优先级，90为启动的优先级</p> 
</blockquote> 
<pre><code class="prism language-sh"># touch /etc/init.d/mountVSFTPD_[虚拟用户]
vim /etc/init.d/mountVSFTPD_vsftpuser
</code></pre> 
<pre><code class="prism language-sh">#!/bin/bash
# chkconfig: 35 10 90
mount -B -o ro /home/vsftpuser/publish /home/vsftpuser/app/zhangsan/publish
mount -B -o rw /home/vsftpuser/share /home/vsftpuser/app/zhangsan/share
mount -B -o ro /home/vsftpuser/publish /home/vsftpuser/app/lisi/publish 
mount -B -o rw /home/vsftpuser/share /home/vsftpuser/app/lisi/share 
</code></pre> 
<p>保存退出。</p> 
<pre><code>chmod +x /etc/init.d/mountVSFTPD_vsftpuser
</code></pre> 
<pre><code class="prism language-sh">chkconfig --add mountVSFTPD_vsftpuser
</code></pre> 
<pre><code class="prism language-sh">chkconfig --level 35 mountVSFTPD_vsftpuser on
</code></pre> 
<pre><code class="prism language-sh">chkconfig --list
</code></pre> 
<h4><a id="_362"></a>查看操作日志</h4> 
<pre><code class="prism language-sh">tail -f /var/log/vsftpd.log
</code></pre> 
<h3><a id="_368"></a>汇总目录结构</h3> 
<pre><code class="prism language-sh">- /usr/sbin/vsftpd ---- VSFTPD的主程序
- /etc/rc.d/init.d/vsftpd ---- 启动脚本
- /etc/vsftpd/vsftpd.conf ---- 主配置文件
- /etc/pam.d/vsftpd.vu ---- PAM认证文件
- /etc/vsftpd.ftpusers ---- 禁止使用VSFTPD的用户列表文件
- /etc/vsftpd.user_list ---- 禁止或允许使用VSFTPD的用户列表文件
- /var/log/vsftpd.log  ---- 日志文件
</code></pre> 
<h4><a id="vsfpuser__380"></a>vsfpuser 目录授权</h4> 
<pre><code class="prism language-sh">chown -R vsftpuser:vsftpuser /home/vsftpuser
</code></pre> 
<h3><a id="3ftp_386"></a>3，启动ftp</h3> 
<pre><code class="prism language-sh"># 启动
systemctl restart vsftpd

# 查看状态
systemctl status vsftpd
</code></pre> 
<h3><a id="4cmdftp_396"></a>4，测试机上cmd使用用户登录ftp</h3> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>liuhm<span class="token operator">&gt;</span>ftp <span class="token number">192.168</span>.56.90
连接到 <span class="token number">192.168</span>.56.90。
<span class="token number">220</span> <span class="token punctuation">(</span>vsFTPd <span class="token number">3.0</span>.2<span class="token punctuation">)</span>
<span class="token number">200</span> Always <span class="token keyword">in</span> UTF8 mode.
用户<span class="token punctuation">(</span><span class="token number">192.168</span>.56.90:<span class="token punctuation">(</span>none<span class="token punctuation">))</span>: zhangsan <span class="token comment">## 登录</span>
<span class="token number">331</span> Please specify the password.
密码:
<span class="token number">230</span> Login successful.
ftp<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Here comes the directory listing.
<span class="token number">226</span> Directory send OK.
ftp<span class="token operator">&gt;</span> <span class="token builtin class-name">pwd</span>  <span class="token comment">## 展示当前目录</span>
<span class="token number">257</span> <span class="token string">"/"</span>
ftp<span class="token operator">&gt;</span> put test.log <span class="token comment">## 上传文件</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Ok to send data.
<span class="token number">226</span> Transfer complete.
ftp: 发送 <span class="token number">3072</span> 字节，用时 <span class="token number">0.00</span>秒 <span class="token number">3072.00</span>千字节/秒。
ftp<span class="token operator">&gt;</span> <span class="token function">ls</span> /
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Here comes the directory listing.
/test.log
<span class="token number">226</span> Directory send OK.
ftp: 收到 <span class="token number">14</span> 字节，用时 <span class="token number">0.00</span>秒 <span class="token number">14.00</span>千字节/秒。

<span class="token comment">#测试publish和share</span>
C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>liuhm<span class="token operator">&gt;</span>ftp <span class="token number">192.168</span>.56.90
连接到 <span class="token number">192.168</span>.56.90。
<span class="token number">220</span> <span class="token punctuation">(</span>vsFTPd <span class="token number">3.0</span>.2<span class="token punctuation">)</span>
<span class="token number">200</span> Always <span class="token keyword">in</span> UTF8 mode.
用户<span class="token punctuation">(</span><span class="token number">192.168</span>.56.90:<span class="token punctuation">(</span>none<span class="token punctuation">))</span>: zhangsan
<span class="token number">331</span> Please specify the password.
密码:
<span class="token number">230</span> Login successful.
ftp<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Here comes the directory listing.
publish
share
<span class="token number">226</span> Directory send OK.
ftp: 收到 <span class="token number">19</span> 字节，用时 <span class="token number">0.00</span>秒 <span class="token number">19.00</span>千字节/秒。
ftp<span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> publish  <span class="token comment">## 切换到publish</span>
<span class="token number">250</span> Directory successfully changed.
ftp<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Here comes the directory listing.
asdasd
xzcxz
<span class="token number">226</span> Directory send OK.
ftp: 收到 <span class="token number">18</span> 字节，用时 <span class="token number">0.00</span>秒 <span class="token number">18000.00</span>千字节/秒。
ftp<span class="token operator">&gt;</span> <span class="token builtin class-name">pwd</span>
<span class="token number">257</span> <span class="token string">"/publish"</span>
ftp<span class="token operator">&gt;</span> put test.log  <span class="token comment">## 上传文件</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">553</span> Could not create file.  <span class="token comment">## 上传失败文件</span>
ftp<span class="token operator">&gt;</span> get xzcxz  <span class="token comment">## 下载文件</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> xzcxz <span class="token punctuation">(</span><span class="token number">0</span> bytes<span class="token punctuation">)</span>.
<span class="token number">226</span> Transfer complete.
ftp<span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
<span class="token number">250</span> Directory successfully changed.
ftp<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Here comes the directory listing.
publish
share
<span class="token number">226</span> Directory send OK.
ftp: 收到 <span class="token number">19</span> 字节，用时 <span class="token number">0.00</span>秒 <span class="token number">19.00</span>千字节/秒。
ftp<span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> share
<span class="token number">250</span> Directory successfully changed.
ftp<span class="token operator">&gt;</span> <span class="token builtin class-name">pwd</span>
<span class="token number">257</span> <span class="token string">"/share"</span>
ftp<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Here comes the directory listing.
<span class="token number">1</span>.log
<span class="token number">11</span>.log
<span class="token number">226</span> Directory send OK.
ftp: 收到 <span class="token number">18</span> 字节，用时 <span class="token number">0.00</span>秒 <span class="token number">18.00</span>千字节/秒。
ftp<span class="token operator">&gt;</span> put test.log   <span class="token comment">## 上传文件</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Ok to send data.
<span class="token number">226</span> Transfer complete.  <span class="token comment">## 上传成功文件</span>
ftp: 发送 <span class="token number">3072</span> 字节，用时 <span class="token number">0.00</span>秒 <span class="token number">3072.00</span>千字节/秒。
ftp<span class="token operator">&gt;</span> <span class="token function">ls</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Here comes the directory listing.
<span class="token number">1</span>.log
<span class="token number">11</span>.log
test.log
<span class="token number">226</span> Directory send OK.
ftp: 收到 <span class="token number">28</span> 字节，用时 <span class="token number">0.00</span>秒 <span class="token number">28.00</span>千字节/秒。
ftp<span class="token operator">&gt;</span> get <span class="token number">1</span>.log <span class="token comment">## 下载文件</span>
<span class="token number">200</span> PORT <span class="token builtin class-name">command</span> successful. Consider using PASV.
<span class="token number">150</span> Opening BINARY mode data connection <span class="token keyword">for</span> <span class="token number">1</span>.log <span class="token punctuation">(</span><span class="token number">3072</span> bytes<span class="token punctuation">)</span>.
<span class="token number">226</span> Transfer complete.

</code></pre> 
<h3><a id="5_501"></a>5,初始用户脚本</h3> 
<p>使用步骤：<br> 在文件/etc/vsftpd/vsftpuser 增加用户</p> 
<p>执行下面的脚本</p> 
<pre><code>vi /etc/vsftpd/initFtpUser.sh  
</code></pre> 
<pre><code class="prism language-sh">#!/bin/sh

CURRENT_DIR=$(
   cd "$(dirname "$0")"
   pwd
)
# 特殊用户配置 大权限的用户
EXCLUDE_USER=("zhangsan")

#///
# 获取奇数行的用户名
rm -rf initFtpsuer.log
awk 'NR%2==1' vsftpuser  &gt;&gt; initFtpsuer.log

# 删除db
rm -rf vsftpuser.db
db_load -T -t hash -f vsftpuser vsftpuser.db
chmod 600 vsftpuser 
chmod 600 vsftpuser.db

# 创建虚拟用户权限目录
mkdir -p /etc/vsftpd/virconf

# 创建用户配置文件
for line in `cat initFtpsuer.log`
do

mkdir -p /home/vsftpuser/app/$line/publish
mkdir -p /home/vsftpuser/app/$line/share 

cat &gt; /etc/vsftpd/virconf/$line&lt;&lt;EOF
local_root=/home/vsftpuser/app/$line
virtual_use_local_privs=YES
# 允许登录用户有可写权限
write_enable=YES
# 允许匿名用户上传文件权限，只在write_enable=YES时生效
anon_upload_enable=YES
# 允许匿名用户创建目录，只有在write_enable=YES时生效
anon_mkdir_write_enable=YES
# 可写
allow_writeable_chroot=YES
EOF

echo "$line 的配置文件"
cat /etc/vsftpd/virconf/$line
done

# 脚本执行
cat &gt; /etc/init.d/mountVSFTPD_vsftpuser&lt;&lt;EOF
#!/bin/bash
# chkconfig: 35 10 90
EOF

for line in `cat initFtpsuer.log`
do

if [[ ! "${EXCLUDE_USER[@]}"  =~ "$line" ]] 
then
# 正常权限
echo "mount -B -o ro /home/vsftpuser/publish /home/vsftpuser/app/$line/publish" &gt;&gt; /etc/init.d/mountVSFTPD_lijian
echo "mount -B -o rw /home/vsftpuser/share /home/vsftpuser/app/$line/share" &gt;&gt; /etc/init.d/mountVSFTPD_lijian
umount /home/vsftpuser/app/$line/publish
umount /home/vsftpuser/app/$line/share
mount -B -o ro /home/vsftpuser/publish /home/vsftpuser/app/$line/publish
mount -B -o rw /home/vsftpuser/share /home/vsftpuser/app/$line/share
else 

echo "特殊权限 大权限 $line"
# 特殊权限 大权限
echo "mount -B -o rw /home/vsftpuser/publish /home/vsftpuser/app/$line/publish" &gt;&gt; /etc/init.d/mountVSFTPD_lijian
echo "mount -B -o rw /home/vsftpuser/share /home/vsftpuser/app/$line/share" &gt;&gt; /etc/init.d/mountVSFTPD_lijian
umount /home/vsftpuser/app/$line/publish
umount /home/vsftpuser/app/$line/share
mount -B -o rw /home/vsftpuser/publish /home/vsftpuser/app/$line/publish
mount -B -o rw /home/vsftpuser/share /home/vsftpuser/app/$line/share


fi	
done
echo "查看  /etc/init.d/mountVSFTPD_vsftpuser"
cat /etc/init.d/mountVSFTPD_vsftpuser
chmod +x /etc/init.d/mountVSFTPD_vsftpuser
#授权
chown -R vsftpuser:vsftpuser /home/vsftpuser

# 启动
systemctl restart vsftpd

# 查看状态
systemctl status vsftpd
</code></pre> 
<pre><code class="prism language-sh">cd /etc/vsftpd
chmod +x /etc/vsftpd/initFtpUser.sh 
sed -i 's/\r$//' initFtpUser.sh 
./initFtpUser.sh 
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/080cd8071c445bc555bd6a586de60413/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Kafka核心概念、优势、应用场景与基本架构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ae315757c0cef218678f985f34d6f918/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python实战故障诊断之CWRU数据集（一）：数据集初识</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>