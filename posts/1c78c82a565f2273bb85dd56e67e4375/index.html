<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android仿打字机打字效果 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android仿打字机打字效果" />
<meta property="og:description" content="最近不太忙,看了看JS方面的知识,偶然看到一个打字机打字的效果,感觉挺棒的,就打算用android搞一个试试.为了不造重复的轮子,先在度娘上找了找,果然有前辈已经写过这方面的文章.所以参考了一下,并且加入了一些自己的想法,做了一些优化.先来看一下效果吧:
图片可能有点掉帧,实际效果更好一些.
一、简单分析 看到这个效果,想一想其实并不太难,做一个定时器,然后一点一点的把文字显示出来就可以了,为了更加像打字机的效果,可以在每一个字显示出来时在后边加上一些修饰的符号比如” _ “或者” | ” 这些.下边就来实现一下.
二、具体实现 比较简单,先看一下代码:
package com.example.junweiliu.printertextview; import android.content.Context; import android.util.AttributeSet; import android.widget.TextView; import java.util.Timer; import java.util.TimerTask; /** * Created by junweiliu on 16/12/29. */ public class PrinterTextView extends TextView { /** * TAG */ private static final String TAG = &#34;PrinterTextView&#34;; /** * 默认打字字符 */ private final String DEFAULT_INTERVAL_CHAR = &#34;_&#34;; /** * 默认打字间隔时间 */ private final int DEFAULT_TIME_DELAY = 80; /** * 计时器 */ private Timer mTimer; /** * 需要打字的文字 */ private String mPrintStr; /** * 间隔时间 */ private int intervalTime = DEFAULT_TIME_DELAY; /** * 间隔时间 */ private String intervalChar = DEFAULT_INTERVAL_CHAR; /** * 打字进度 */ private int printProgress = 0; public PrinterTextView(Context context) { super(context); } public PrinterTextView(Context context, AttributeSet attrs) { super(context, attrs); } public PrinterTextView(Context context, AttributeSet attrs, int defStyleAttr) { super(context, attrs, defStyleAttr); } /** * 设置要打字的文字 * * @param str */ public void setPrintText(String str) { setPrintText(str, DEFAULT_TIME_DELAY); } /** * 设置需要打字的文字及打字间隔 * * @param str 打字文字 * @param time 打字间隔(ms) */ public void setPrintText(String str, int time) { setPrintText(str, time, DEFAULT_INTERVAL_CHAR); } /** * 设置需要打字的文字,打字间隔,间隔符号 * * @param str 打字文字 * @param time 打字间隔(ms) * @param intervalChar 间隔符号(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/1c78c82a565f2273bb85dd56e67e4375/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-12-29T20:35:37+08:00" />
<meta property="article:modified_time" content="2016-12-29T20:35:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android仿打字机打字效果</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近不太忙,看了看JS方面的知识,偶然看到一个打字机打字的效果,感觉挺棒的,就打算用android搞一个试试.为了不造重复的轮子,先在度娘上找了找,果然有前辈已经写过这方面的文章.所以参考了一下,并且加入了一些自己的想法,做了一些优化.先来看一下效果吧:</p> 
<p><img src="https://images2.imgbox.com/0c/35/MKupY3RY_o.gif" alt="这里写图片描述" title=""></p> 
<p>图片可能有点掉帧,实际效果更好一些.</p> 
<hr> 
<h3 id="一简单分析">一、简单分析</h3> 
<p>看到这个效果,想一想其实并不太难,做一个定时器,然后一点一点的把文字显示出来就可以了,为了更加像打字机的效果,可以在每一个字显示出来时在后边加上一些修饰的符号比如” _ “或者” | ” 这些.下边就来实现一下.</p> 
<h3 id="二具体实现">二、具体实现</h3> 
<p>比较简单,先看一下代码:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.printertextview;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.util.AttributeSet;
<span class="hljs-keyword">import</span> android.widget.TextView;

<span class="hljs-keyword">import</span> java.util.Timer;
<span class="hljs-keyword">import</span> java.util.TimerTask;

<span class="hljs-javadoc">/**
 * Created by junweiliu on 16/12/29.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PrinterTextView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TextView</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * TAG
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = <span class="hljs-string">"PrinterTextView"</span>;
    <span class="hljs-javadoc">/**
     * 默认打字字符
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String DEFAULT_INTERVAL_CHAR = <span class="hljs-string">"_"</span>;
    <span class="hljs-javadoc">/**
     * 默认打字间隔时间
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_TIME_DELAY = <span class="hljs-number">80</span>;
    <span class="hljs-javadoc">/**
     * 计时器
     */</span>
    <span class="hljs-keyword">private</span> Timer mTimer;
    <span class="hljs-javadoc">/**
     * 需要打字的文字
     */</span>
    <span class="hljs-keyword">private</span> String mPrintStr;
    <span class="hljs-javadoc">/**
     * 间隔时间
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> intervalTime = DEFAULT_TIME_DELAY;
    <span class="hljs-javadoc">/**
     * 间隔时间
     */</span>
    <span class="hljs-keyword">private</span> String intervalChar = DEFAULT_INTERVAL_CHAR;
    <span class="hljs-javadoc">/**
     * 打字进度
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> printProgress = <span class="hljs-number">0</span>;


    <span class="hljs-keyword">public</span> <span class="hljs-title">PrinterTextView</span>(Context context) {
        <span class="hljs-keyword">super</span>(context);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">PrinterTextView</span>(Context context, AttributeSet attrs) {
        <span class="hljs-keyword">super</span>(context, attrs);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">PrinterTextView</span>(Context context, AttributeSet attrs, <span class="hljs-keyword">int</span> defStyleAttr) {
        <span class="hljs-keyword">super</span>(context, attrs, defStyleAttr);
    }


    <span class="hljs-javadoc">/**
     * 设置要打字的文字
     *
     *<span class="hljs-javadoctag"> @param</span> str
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPrintText</span>(String str) {
        setPrintText(str, DEFAULT_TIME_DELAY);
    }

    <span class="hljs-javadoc">/**
     * 设置需要打字的文字及打字间隔
     *
     *<span class="hljs-javadoctag"> @param</span> str  打字文字
     *<span class="hljs-javadoctag"> @param</span> time 打字间隔(ms)
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPrintText</span>(String str, <span class="hljs-keyword">int</span> time) {
        setPrintText(str, time, DEFAULT_INTERVAL_CHAR);
    }

    <span class="hljs-javadoc">/**
     * 设置需要打字的文字,打字间隔,间隔符号
     *
     *<span class="hljs-javadoctag"> @param</span> str          打字文字
     *<span class="hljs-javadoctag"> @param</span> time         打字间隔(ms)
     *<span class="hljs-javadoctag"> @param</span> intervalChar 间隔符号("_")
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPrintText</span>(String str, <span class="hljs-keyword">int</span> time, String intervalChar) {
        <span class="hljs-keyword">if</span> (strIsEmpty(str) || <span class="hljs-number">0</span> == time || strIsEmpty(intervalChar)) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">this</span>.mPrintStr = str;
        <span class="hljs-keyword">this</span>.intervalTime = time;
        <span class="hljs-keyword">this</span>.intervalChar = intervalChar;
    }

    <span class="hljs-javadoc">/**
     * 开始打字
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startPrint</span>() {
        <span class="hljs-comment">// 判空处理</span>
        <span class="hljs-keyword">if</span> (strIsEmpty(mPrintStr)) {
            <span class="hljs-keyword">if</span> (!strIsEmpty(getText().toString())) {
                <span class="hljs-keyword">this</span>.mPrintStr = getText().toString();
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span>;
            }
        }
        <span class="hljs-comment">// 重置相关信息</span>
        setText(<span class="hljs-string">""</span>);
        stopPrint();
        printProgress = <span class="hljs-number">0</span>;
        mTimer = <span class="hljs-keyword">new</span> Timer();
        mTimer.schedule(<span class="hljs-keyword">new</span> PrinterTimeTask(), intervalTime, intervalTime);
    }

    <span class="hljs-javadoc">/**
     * 停止打字
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopPrint</span>() {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mTimer) {
            mTimer.cancel();
            mTimer = <span class="hljs-keyword">null</span>;
        }
    }

    <span class="hljs-javadoc">/**
     * 判断str是否为空
     *
     *<span class="hljs-javadoctag"> @param</span> str
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">strIsEmpty</span>(String str) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != str &amp;&amp; !<span class="hljs-string">""</span>.equals(str)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }
    }

    <span class="hljs-javadoc">/**
     * 打字计时器任务
     */</span>
    class PrinterTimeTask extends TimerTask {

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
            <span class="hljs-comment">// 需要刷新页面,必须在UI线程,使用post方法</span>
            post(<span class="hljs-keyword">new</span> Runnable() {
                <span class="hljs-annotation">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
                    <span class="hljs-comment">// 如果未显示完,继续显示</span>
                    <span class="hljs-keyword">if</span> (printProgress &lt; mPrintStr.length()) {
                        printProgress++;
                        <span class="hljs-comment">// (printProgress &amp; 1) == 1 等价于printProgress%2!=0</span>
                        setText(mPrintStr.substring(<span class="hljs-number">0</span>, printProgress) + ((printProgress &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">1</span> ? intervalChar : <span class="hljs-string">""</span>));
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// 如果完成打字,显示完整文字</span>
                        setText(mPrintStr);
                        stopPrint();
                    }
                }
            });
        }
    }
}
</code></pre> 
<p>注释比较全,也比较简单,需要注意的就几点,首先需要注意的是在PrinterTimeTask中,在线程中执行操作时,<font color="red">要使用post方法,因为不能在子线程中直接更新UI</font>,post方法用来处理这种需求(不了解的童鞋,可以看一下View的post方法,这里就不详细写了),然后在处理每次的显示的时候,为了更加像打字机的效果,在显示时做了一些处理,这里做的处理是当前显示的文字是奇数位时则在后边加上一个符号” _ “,当然也可以自己去设置,是偶数位时则不去处理.这样看起来就比较形象了.相关代码<font color="red">((printProgress &amp; 1) == 1 ? intervalChar : “”)</font>这里用了位运算,是因为效率应该会高一些,当然也可以用printProgress%2!=0来判断当前位置是奇数位还是偶数位,效果是一样的.</p> 
<h3 id="三完整代码">三、完整代码</h3> 
<p>MainActivity:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.printertextview;

<span class="hljs-keyword">import</span> android.support.v7.app.AppCompatActivity;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.view.View;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * 打印view
     */</span>
    <span class="hljs-keyword">private</span> PrinterTextView mPrinterTextView;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        mPrinterTextView = (PrinterTextView) findViewById(R.id.pt_my);
    }

    <span class="hljs-javadoc">/**
     * 开始打印
     *
     *<span class="hljs-javadoctag"> @param</span> view
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startPrint</span>(View view) {
        mPrinterTextView.setPrintText(<span class="hljs-string">"草原上有对狮子母子。小狮子问母狮子：“妈，幸福在哪里?”母狮子说：“幸福就在你的尾巴上。”\n"</span> +
                <span class="hljs-string">"　　于是小狮子不断追着尾巴跑，但始终咬不到。母狮子笑道：“傻瓜!幸福不是这样得到的!只要你昂首向前走，幸福就会一直跟随着你!”。"</span>, <span class="hljs-number">100</span>, <span class="hljs-string">"|"</span>);
        mPrinterTextView.startPrint();

    }
}</code></pre> 
<p>布局文件activity_main:</p> 
<pre class="prettyprint"><code class="language-xml hljs "><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout
</span>        <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
        <span class="hljs-attribute">xmlns:tools</span>=<span class="hljs-value">"http://schemas.android.com/tools"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:paddingBottom</span>=<span class="hljs-value">"@dimen/activity_vertical_margin"</span>
        <span class="hljs-attribute">android:paddingLeft</span>=<span class="hljs-value">"@dimen/activity_horizontal_margin"</span>
        <span class="hljs-attribute">android:paddingRight</span>=<span class="hljs-value">"@dimen/activity_horizontal_margin"</span>
        <span class="hljs-attribute">android:paddingTop</span>=<span class="hljs-value">"@dimen/activity_vertical_margin"</span>
        <span class="hljs-attribute">tools:context</span>=<span class="hljs-value">"com.example.junweiliu.printertextview.MainActivity"</span>&gt;</span>

    <span class="hljs-comment">&lt;!--android:text="某日,女秘书神色凝重地说：王总,我怀孕了。 王继续低头看文件,然后淡淡一笑:我早结扎了。 女秘书楞了一会媚笑道:我和您开玩笑呢! 王抬起头看了她一眼，喝了口茶说:我也是。"--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">com.example.junweiliu.printertextview.PrinterTextView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/pt_my"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"#999999"</span>
            <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"15sp"</span>
    /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Button
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/btn_start"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_centerInParent</span>=<span class="hljs-value">"true"</span>
            <span class="hljs-attribute">android:layout_marginTop</span>=<span class="hljs-value">"16dp"</span>
            <span class="hljs-attribute">android:onClick</span>=<span class="hljs-value">"startPrint"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"开始"</span>
    /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span>
</code></pre> 
<h4 id="源码地址">源码地址</h4> 
<p><a href="http://download.csdn.net/detail/u013904672/9725086">源码下载</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a187320da6b915639a119dd197acc6cc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CS143-project4基于滑窗的人脸检测 Face detection with a sliding window</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e71a33a337d1aaae2e8137ca871a8679/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">你的团队需要一个会讲故事的人读书笔记</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>