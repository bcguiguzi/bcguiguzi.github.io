<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Retrofit2简单使用 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Retrofit2简单使用" />
<meta property="og:description" content="一、Retrofit是什么？ 确切的讲，Retrofit是对okhttp的进一步封装，是一个现在比较火的网络请求框架。
二、使用步骤 1.引入库 implementation &#39;com.squareup.retrofit2:retrofit:2.9.0&#39; 2.创建一个interface，我们将这个interface取名为HttpBinService 代码如下（示例）：
package hk.hkiot.okhttp; import okhttp3.ResponseBody; import retrofit2.Call; import retrofit2.http.Field; import retrofit2.http.FormUrlEncoded; import retrofit2.http.GET; import retrofit2.http.POST; import retrofit2.http.Query; public interface HttpBinService { @POST(&#34;post&#34;) @FormUrlEncoded Call&lt;ResponseBody&gt; startPost(@Field(&#34;username&#34;) String username, @Field(&#34;pwd&#34;) String pwd); @GET(&#34;get&#34;) Call&lt;ResponseBody&gt; startGet(@Query(&#34;username&#34;) String username, @Query(&#34;pwd&#34;) String pwd); } 我们定义了startPost和startGet方法，其返回类型为retrofit的Call类型，尖括号里是okhttp的ResponseBody类型，@GET/@POST 注解的作用是声明采用GET/POST的方法进行网络请求。
startGet方法中添加参数在方法括号内添加@Query，后面是参数类型和参数字段，Retrofit会把两个字段拼接到接口中，追加到&#34;/get&#34;后面。比如：baseUrl为https://www.httpbin.org/，那么拼接网络接口注解中的地址后变为：https://www.httpbin.org/get，我们需要传入的username=testusername，pwd=123456，那么拼接参数后就是完整的请求地址：https://www.httpbin.org/get?username=testusername&amp;pwd=123456。
startPost方法则需要在头部添加@FormUrlEncoded注解，表示请求实体是一个From表单，每个键值对需要使用@Field注解，使用@Field添加参数，这是发送Post请求时，提交请求的表单字段，必须要添加的。
3.接下来就可以就可以进行网络请求了 public class MainActivity extends AppCompatActivity implements View.OnClickListener { private Button getAsynBtn; private Button postAsynBtn; private Retrofit retrofit; private HttpBinService httpBinService; private static final String TAG = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/8179a5813686b663ec3b568a5c93086c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-10T16:00:31+08:00" />
<meta property="article:modified_time" content="2022-03-10T16:00:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Retrofit2简单使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Retrofit_2"></a>一、Retrofit是什么？</h2> 
<p>确切的讲，Retrofit是对okhttp的进一步封装，是一个现在比较火的网络请求框架。</p> 
<h2><a id="_5"></a>二、使用步骤</h2> 
<h3><a id="1_6"></a>1.引入库</h3> 
<pre><code class="prism language-c">implementation <span class="token string">'com.squareup.retrofit2:retrofit:2.9.0'</span>
</code></pre> 
<h3><a id="2interfaceinterfaceHttpBinService_11"></a>2.创建一个interface，我们将这个interface取名为HttpBinService</h3> 
<p>代码如下（示例）：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> hk<span class="token punctuation">.</span>hkiot<span class="token punctuation">.</span>okhttp<span class="token punctuation">;</span>

<span class="token keyword">import</span> okhttp3<span class="token punctuation">.</span>ResponseBody<span class="token punctuation">;</span>
<span class="token keyword">import</span> retrofit2<span class="token punctuation">.</span>Call<span class="token punctuation">;</span>
<span class="token keyword">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Field<span class="token punctuation">;</span>
<span class="token keyword">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>FormUrlEncoded<span class="token punctuation">;</span>
<span class="token keyword">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>GET<span class="token punctuation">;</span>
<span class="token keyword">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>POST<span class="token punctuation">;</span>
<span class="token keyword">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Query<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HttpBinService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@POST</span><span class="token punctuation">(</span><span class="token string">"post"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@FormUrlEncoded</span>
    Call<span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span> <span class="token function">startPost</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> String username<span class="token punctuation">,</span> <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">)</span> String pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GET</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span>
    Call<span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span> <span class="token function">startGet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> String username<span class="token punctuation">,</span> <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"pwd"</span><span class="token punctuation">)</span> String pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>我们定义了startPost和startGet方法，其返回类型为retrofit的Call类型，尖括号里是okhttp的ResponseBody类型，@GET/@POST 注解的作用是声明采用GET/POST的方法进行网络请求。</p> 
<p>startGet方法中添加参数在方法括号内添加@Query，后面是参数类型和参数字段，Retrofit会把两个字段拼接到接口中，追加到"/get"后面。比如：baseUrl为https://www.httpbin.org/，那么拼接网络接口注解中的地址后变为：https://www.httpbin.org/get，我们需要传入的username=testusername，pwd=123456，那么拼接参数后就是完整的请求地址：https://www.httpbin.org/get?username=testusername&amp;pwd=123456。</p> 
<p>startPost方法则需要在头部添加@FormUrlEncoded注解，表示请求实体是一个From表单，每个键值对需要使用@Field注解，使用@Field添加参数，这是发送Post请求时，提交请求的表单字段，必须要添加的。</p> 
<h3><a id="3_40"></a>3.接下来就可以就可以进行网络请求了</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> <span class="token punctuation">{<!-- --></span>


    <span class="token keyword">private</span> Button getAsynBtn<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Button postAsynBtn<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Retrofit retrofit<span class="token punctuation">;</span>
    <span class="token keyword">private</span> HttpBinService httpBinService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String TAG <span class="token operator">=</span> <span class="token string">"MainActivity"</span><span class="token punctuation">;</span>



    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>Bundle savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>

        retrofit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Retrofit<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">"https://www.httpbin.org/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpBinService <span class="token operator">=</span> retrofit<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HttpBinService<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        getAsynBtn <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>getAsynBtn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        postAsynBtn <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>postAsynBtn<span class="token punctuation">)</span><span class="token punctuation">;</span>

        getAsynBtn<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        postAsynBtn<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span>View view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>view<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>getAsynBtn<span class="token operator">:</span>
                retrofit2<span class="token punctuation">.</span>Call<span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span> call <span class="token operator">=</span> httpBinService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"hangge"</span><span class="token punctuation">,</span> <span class="token string">"6666666"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                call<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResponse</span><span class="token punctuation">(</span>retrofit2<span class="token punctuation">.</span>Call<span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span> call<span class="token punctuation">,</span> retrofit2<span class="token punctuation">.</span>Response<span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                            Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span>response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFailure</span><span class="token punctuation">(</span>retrofit2<span class="token punctuation">.</span>Call<span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span> call<span class="token punctuation">,</span> Throwable t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>postAsynBtn<span class="token operator">:</span>
                retrofit2<span class="token punctuation">.</span>Call<span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span> call1 <span class="token operator">=</span> httpBinService<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"testusername"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                call1<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">retrofit2<span class="token punctuation">.</span>Callback</span><span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResponse</span><span class="token punctuation">(</span>retrofit2<span class="token punctuation">.</span>Call<span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span> call<span class="token punctuation">,</span> retrofit2<span class="token punctuation">.</span>Response<span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                            Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span>response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFailure</span><span class="token punctuation">(</span>retrofit2<span class="token punctuation">.</span>Call<span class="token generics function"><span class="token punctuation">&lt;</span>ResponseBody<span class="token punctuation">&gt;</span></span> call<span class="token punctuation">,</span> Throwable t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7967282b5e1a519121d2d8f49b57d2e6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android Studio构建新项目错误</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e56f83e71df743123fada8ce99828700/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UE4 打开系统的文件选择窗口|打开windows文件选取窗口</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>