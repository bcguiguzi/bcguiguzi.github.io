<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>åˆè¯†Umi.JS - ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="åˆè¯†Umi.JS" />
<meta property="og:description" content="ä»€ä¹ˆæ˜¯Umi.js? Umiï¼Œä¸­æ–‡å¯å‘éŸ³ä¸ºä¹Œç±³ï¼Œæ˜¯å¯æ‰©å±•çš„ä¼ä¸šçº§å‰ç«¯åº”ç”¨æ¡†æ¶ã€‚Umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼Œä¿è¯è·¯ç”±çš„åŠŸèƒ½å®Œå¤‡ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚ç„¶åé…ä»¥ç”Ÿå‘½å‘¨æœŸå®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå„ç§åŠŸèƒ½æ‰©å±•å’Œä¸šåŠ¡éœ€æ±‚ã€‚
ä¸ºä»€ä¹ˆä½¿ç”¨Umi.js? æˆ‘ä»¬åšreactå¼€å‘çš„æ—¶å€™ä¼šä¸ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼Ÿï¼š
1.é¡¹ç›®åšå¤§çš„æ—¶å€™ï¼Œå¼€å‘è°ƒè¯•çš„å¯åŠ¨å’Œçƒ­æ›´æ–°æ—¶é—´ä¼šå˜å¾—å¾ˆé•¿ã€‚
2.å¤§åº”ç”¨ä¸‹ï¼Œç½‘ç«™æ‰“å¼€å¾ˆæ…¢ï¼Œæœ‰æ²¡æœ‰åŠæ³•åŸºäºè·¯ç”±åšåˆ°æŒ‰éœ€åŠ è½½ã€‚
3.dvaçš„modelæ¯æ¬¡éƒ½è¦æ‰‹å†™è½½å…¥ï¼Œèƒ½å¦ä¸€å¼€å§‹å°±åŒé¡¹ç›®åˆå§‹åŒ–å¥½ï¼Ÿ
ä½¿ç”¨ä¹Œç±³ï¼Œå³å¯è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œå¹¶ä¸”è¿˜èƒ½æä¾›å¦‚ä¸‹ä¼˜åŠ¿ï¼š
ğŸ‰å¼€ç®±å³ç”¨ï¼Œå†…ç½® reactã€react-router ç­‰ğŸ“¦ç±» next.js ä¸”åŠŸèƒ½å®Œå¤‡çš„è·¯ç”±çº¦å®šï¼ŒåŒæ—¶æ”¯æŒé…ç½®çš„è·¯ç”±æ–¹å¼ğŸ å®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸğŸš€ ä¸€é”®å…¼å®¹åˆ° IE9ğŸ‰å®Œå–„çš„ TypeScript æ”¯æŒğŸ—ä¸ dva æ•°æ®æµçš„æ·±å…¥èåˆ umi æœ‰ 2 å’Œ 3 ä¸¤ä¸ªç‰ˆæœ¬ã€‚ä¸¤ä¸ªç‰ˆæœ¬çš„ä½¿ç”¨éƒ½å·®ä¸å¤šã€‚umi2 å¯¹ javascript æ”¯æŒæ¯”è¾ƒå¥½ï¼Œumi3 é»˜è®¤æ”¯æŒ typeScript
èµ·æ­¥Umi nodeç¯å¢ƒå®‰è£… å»ºè®®å®‰è£…æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ï¼Œç¬”è€…è¿™é‡Œä¸º 14.15.3ã€‚åŒæ—¶å»ºè®®ä½¿ç”¨ yarn
Umiå¿«é€Ÿä¸Šæ‰‹ åˆ›å»ºç©ºç›®å½• umi-learn
# æ–°å»ºåº”ç”¨ $ mkdir umi-learn &amp;&amp; cd umi-learn # ä½¿ç”¨å‘½ä»¤ $ yarn create umi # å®‰è£…ä¾èµ– $ yarn install å®‰è£…è¿‡ç¨‹é€‰æ‹© app
é¡¹ç›®å·¥ç¨‹ç»“æ„ mock // mockæ–‡ä»¶ src |-- assets // é™æ€èµ„æºæ–‡ä»¶ |-- layouts // å…¨å±€å¸ƒå±€æ–‡ä»¶ |-- pages // é¡¹ç›®é¡µé¢æ–‡ä»¶ |-- globals // å…¨å±€æ ·å¼ |--." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/8bd45773804600e29fa829ae9163c3ea/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-26T14:08:00+08:00" />
<meta property="article:modified_time" content="2021-01-26T14:08:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">åˆè¯†Umi.JS</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/53/be/VcvQ7OfJ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="Umijs_2"></a>ä»€ä¹ˆæ˜¯Umi.js?</h4> 
<p>Umiï¼Œä¸­æ–‡å¯å‘éŸ³ä¸º<strong>ä¹Œç±³</strong>ï¼Œæ˜¯å¯æ‰©å±•çš„ä¼ä¸šçº§å‰ç«¯åº”ç”¨æ¡†æ¶ã€‚Umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼Œä¿è¯è·¯ç”±çš„åŠŸèƒ½å®Œå¤‡ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚ç„¶åé…ä»¥ç”Ÿå‘½å‘¨æœŸå®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå„ç§åŠŸèƒ½æ‰©å±•å’Œä¸šåŠ¡éœ€æ±‚ã€‚</p> 
<h4><a id="Umijs_6"></a>ä¸ºä»€ä¹ˆä½¿ç”¨Umi.js?</h4> 
<p>æˆ‘ä»¬åšreactå¼€å‘çš„æ—¶å€™ä¼šä¸ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼Ÿï¼š<br> 1.é¡¹ç›®åšå¤§çš„æ—¶å€™ï¼Œå¼€å‘è°ƒè¯•çš„å¯åŠ¨å’Œçƒ­æ›´æ–°æ—¶é—´ä¼šå˜å¾—å¾ˆé•¿ã€‚<br> 2.å¤§åº”ç”¨ä¸‹ï¼Œç½‘ç«™æ‰“å¼€å¾ˆæ…¢ï¼Œæœ‰æ²¡æœ‰åŠæ³•åŸºäºè·¯ç”±åšåˆ°æŒ‰éœ€åŠ è½½ã€‚<br> 3.dvaçš„modelæ¯æ¬¡éƒ½è¦æ‰‹å†™è½½å…¥ï¼Œèƒ½å¦ä¸€å¼€å§‹å°±åŒé¡¹ç›®åˆå§‹åŒ–å¥½ï¼Ÿ</p> 
<p>ä½¿ç”¨ä¹Œç±³ï¼Œå³å¯è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œå¹¶ä¸”è¿˜èƒ½æä¾›å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p> 
<ul><li>ğŸ‰å¼€ç®±å³ç”¨ï¼Œå†…ç½® reactã€react-router ç­‰</li><li>ğŸ“¦ç±» next.js ä¸”åŠŸèƒ½å®Œå¤‡çš„è·¯ç”±çº¦å®šï¼ŒåŒæ—¶æ”¯æŒé…ç½®çš„è·¯ç”±æ–¹å¼</li><li>ğŸ å®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸ</li><li>ğŸš€ ä¸€é”®å…¼å®¹åˆ° IE9</li><li>ğŸ‰å®Œå–„çš„ TypeScript æ”¯æŒ</li><li>ğŸ—ä¸ dva æ•°æ®æµçš„æ·±å…¥èåˆ</li></ul> 
<hr> 
<p>umi æœ‰ 2 å’Œ 3 ä¸¤ä¸ªç‰ˆæœ¬ã€‚ä¸¤ä¸ªç‰ˆæœ¬çš„ä½¿ç”¨éƒ½å·®ä¸å¤šã€‚umi2 å¯¹ javascript æ”¯æŒæ¯”è¾ƒå¥½ï¼Œumi3 é»˜è®¤æ”¯æŒ typeScript</p> 
<h3><a id="Umi_24"></a>èµ·æ­¥Umi</h3> 
<h4><a id="node_26"></a>nodeç¯å¢ƒå®‰è£…</h4> 
<p>å»ºè®®å®‰è£…æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ï¼Œç¬”è€…è¿™é‡Œä¸º 14.15.3ã€‚åŒæ—¶å»ºè®®ä½¿ç”¨ yarn</p> 
<h4><a id="Umi_30"></a>Umiå¿«é€Ÿä¸Šæ‰‹</h4> 
<p>åˆ›å»ºç©ºç›®å½• umi-learn</p> 
<pre><code class="prism language-bash"><span class="token comment"># æ–°å»ºåº”ç”¨</span>
$ <span class="token function">mkdir</span> umi-learn <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> umi-learn

<span class="token comment"># ä½¿ç”¨å‘½ä»¤</span>
$ <span class="token function">yarn</span> create umi

<span class="token comment"># å®‰è£…ä¾èµ–</span>
$ <span class="token function">yarn</span> <span class="token function">install</span>
</code></pre> 
<p>å®‰è£…è¿‡ç¨‹é€‰æ‹© app</p> 
<p><img src="https://images2.imgbox.com/99/08/cZfZIAk8_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/8a/53/ckNyM0iq_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="_52"></a>é¡¹ç›®å·¥ç¨‹ç»“æ„</h4> 
<pre><code class="prism language-csharp">mock                    <span class="token comment">// mockæ–‡ä»¶</span>
src
  <span class="token operator">|</span><span class="token operator">--</span> assets        	<span class="token comment">// é™æ€èµ„æºæ–‡ä»¶</span>
  <span class="token operator">|</span><span class="token operator">--</span> layouts           <span class="token comment">// å…¨å±€å¸ƒå±€æ–‡ä»¶</span>
  <span class="token operator">|</span><span class="token operator">--</span> pages           	<span class="token comment">// é¡¹ç›®é¡µé¢æ–‡ä»¶</span>
  <span class="token operator">|</span><span class="token operator">--</span> globals           <span class="token comment">// å…¨å±€æ ·å¼</span>
  <span class="token operator">|</span><span class="token operator">--</span><span class="token punctuation">.</span>eslintignore     <span class="token comment">// eslintè¿‡æ»¤æ–‡ä»¶æ¸…å•</span>
  <span class="token operator">|</span><span class="token operator">--</span><span class="token punctuation">.</span>eslintrc<span class="token punctuation">.</span>js      <span class="token comment">// eslinté…ç½®</span>
  <span class="token operator">|</span><span class="token operator">--</span><span class="token punctuation">.</span>eslintignore     <span class="token comment">// eslintè¿‡æ»¤æ–‡ä»¶æ¸…å•</span>
  <span class="token operator">|</span><span class="token operator">--</span><span class="token punctuation">.</span>eslintignore     <span class="token comment">// eslintè¿‡æ»¤æ–‡ä»¶æ¸…å•</span>
  <span class="token operator">|</span><span class="token operator">--</span><span class="token punctuation">.</span>umirc<span class="token punctuation">.</span>js 		   <span class="token comment">// umi é…ç½®æ–‡ä»¶</span>

</code></pre> 
<h4><a id="_69"></a>çº¦å®šå¼è·¯ç”±</h4> 
<blockquote> 
 <p>å¯åŠ¨ umi start åï¼Œå¤§å®¶ä¼šå‘ç° pages ä¸‹å¤šäº†ä¸ª .umi çš„ç›®å½•ã€‚ä¸è¦ç›´æ¥åœ¨è¿™é‡Œä¿®æ”¹ä»£ç ï¼Œumi é‡å¯æˆ–è€… pages ä¸‹çš„æ–‡ä»¶ä¿®æ”¹éƒ½ä¼šé‡æ–°ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œçº¦å®š pages ä¸‹æ‰€æœ‰çš„ (j|t)sx? æ–‡ä»¶å³è·¯ç”±</p> 
</blockquote> 
<h4><a id="_73"></a>åŠ¨æ€ç”Ÿæˆè·¯ç”±</h4> 
<pre><code class="prism language-crystal">npx umi g page demo
</code></pre> 
<blockquote> 
 <p>page ç›®å½•ä¸‹ç”Ÿæˆ demo.js å’Œ demo.cssã€‚.umirc.js ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸å¯¹åº”çš„è·¯ç”±ï¼Œè®¿é—® /demo è·¯ç”±ã€‚å³å¯çœ‹åˆ°é¡µé¢</p> 
</blockquote> 
<pre><code class="prism language-crystal">npx umi g page class/index
</code></pre> 
<blockquote> 
 <p>page ç›®å½•ä¸‹ç”Ÿæˆ class æ–‡ä»¶å¤¹ / index.js å’Œ index.cssã€‚.umirc.js ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸å¯¹åº”çš„è·¯ç”±ï¼Œè®¿é—® /class/index è·¯ç”±ã€‚å³å¯çœ‹åˆ°é¡µé¢</p> 
</blockquote> 
<blockquote> 
 <p>æ‰‹åŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œ.umirc.js æ–‡ä»¶ä¸­ä¸ä¼šç”Ÿæˆç›¸å¯¹åº”çš„è·¯ç”±</p> 
</blockquote> 
<h4><a id="_89"></a>è·å–è·¯ç”±ä¸­çš„å‚æ•°</h4> 
<p>è¯¥æ–‡ä»¶å¿…é¡»ä»¥ $ å¼€å¤´å‘½åï¼Œè¿™æ—¶ .umi æ–‡ä»¶å¤¹ä¸‹çš„ router.js æ–‡ä»¶ä¼šç”Ÿæˆå¯¹åº”çš„è·¯ç”±</p> 
<h4><a id="umi2__umi3_93"></a>umi2 --&gt; umi3</h4> 
<pre><code class="prism language-bash">$ <span class="token function">yarn</span> create @umijs/umi-app
$ <span class="token function">yarn</span> <span class="token function">install</span>
</code></pre> 
<h4><a id="dva_102"></a>ä½¿ç”¨dva</h4> 
<p>åœ¨ umi é¡¹ç›®ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ dva æ¥å¤„ç†æ•°æ®æµï¼Œä»¥å“åº”ä¸€äº›å¤æ‚çš„äº¤äº’æ“ä½œã€‚<br> åœ¨ umi2 ä¸­è¦ä½¿ç”¨ dva çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œåªè¦ä½¿ç”¨ umi-plugin-react æ’ä»¶å¹¶é…ç½® dva:true å³å¯ã€‚<br> ä¿®æ”¹é…ç½®çš„æ–‡ä»¶ï¼š./umirc.js</p> 
<pre><code class="prism language-js"><span class="token comment">// ref: https://umijs.org/config/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ref: https://umijs.org/plugin/umi-plugin-react.html</span>
    <span class="token punctuation">[</span><span class="token string">'umi-plugin-react'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
      antd<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      dva<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// åœ¨æ­¤å¤„å¯ç”¨ dva</span>
      dynamicImport<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      title<span class="token operator">:</span> <span class="token string">'hero'</span><span class="token punctuation">,</span>
      dll<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      routes<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      hardSource<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>åœ¨dvaä¸­ï¼Œå¤„ç†æ•°æ®æµçš„æ–‡ä»¶ç»Ÿä¸€æ”¾åœ¨ models æ–‡ä»¶å¤¹ä¸‹ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶é»˜è®¤å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢åŒ…å«æ•°æ®å’Œå¤„ç†æ•°æ®çš„æ–¹æ³•ï¼Œé€šå¸¸æˆ‘ä»¬ç§°ä¹‹ä¸º model ã€‚å¦‚ä»¥ä¸‹count.jsï¼Œmodelç»“æ„ä¸€èˆ¬æ˜¯å¦‚æ­¤ï¼š</p> 
<h6><a id="srcmodelscountjs_130"></a>./src/models/count.js</h6> 
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  namespace<span class="token operator">:</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token comment">// é»˜è®¤ä¸æ–‡ä»¶åç›¸åŒ</span>
  state<span class="token operator">:</span> <span class="token string">'count'</span><span class="token punctuation">,</span>
  subscriptions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> dispatch<span class="token punctuation">,</span> history <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// åŒæ­¥</span>
  reducers<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_count</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// å¼‚æ­¥</span>
  effects<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">*</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> call<span class="token punctuation">,</span> put <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            type<span class="token operator">:</span> <span class="token string">'update'</span><span class="token punctuation">,</span>
            payload
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="model_158"></a>åœ¨é¡¹ç›®é¡µé¢ä¸­ä½¿ç”¨model</h4> 
<p>æˆ‘ä»¬éœ€è¦å¯¼å…¥connectå°†é¡µé¢å’Œmodelç»‘å®šåœ¨ä¸€èµ·ã€‚</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva'</span><span class="token punctuation">;</span>  
<span class="token keyword">function</span> <span class="token function">CountPage</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
 <span class="token comment">//ä»propså±æ€§ä¸­æ‰“å°namespaceä¸ºcountçš„modelçš„stateæ•°æ®       </span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>      
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>styles<span class="token punctuation">.</span>normal<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>æ•°é‡å¤§å°<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>This is <span class="token punctuation">{<!-- --></span>props<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>CountPage<span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre> 
<p>å¦‚æœä½¿ç”¨es7çš„è£…é¥°å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹æˆè¿™æ ·çš„å†™æ³•ï¼š</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva'</span><span class="token punctuation">;</span> 
<span class="token comment">// è£…é¥°å™¨ </span>
@<span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">CountPage</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
 <span class="token comment">// ä» props å±æ€§ä¸­æ‰“å° namespace ä¸º count çš„ model çš„ state æ•°æ®       </span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>      
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>styles<span class="token punctuation">.</span>normal<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>æ•°é‡å¤§å°<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>This is <span class="token punctuation">{<!-- --></span>props<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> CountPage<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="mock__196"></a>mock æ–‡ä»¶å¤¹</h4> 
<blockquote> 
 <p>ä¸€èˆ¬çš„æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼Œumi çš„ mock æ˜¯å¯¹ express çš„å°è£…</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'GET /api/getLists'</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        lists<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'GET /api/getListsAsync'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            lists<span class="token operator">:</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> query<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre> 
<h4><a id="src__services__214"></a>src / services æ–‡ä»¶å¤¹</h4> 
<blockquote> 
 <p>è¯·æ±‚æœ‰å…³çš„å¤„ç†æ–‡ä»¶</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getLists</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/getLists?value='</span> <span class="token operator">+</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>ä¸Šè¿°å†…å®¹å…¶å®åœ¨çœŸå®çš„é¡¹ç›®å¼€å‘å½“ä¸­æ‰€ç”¨ä¸å¤šï¼Œä½¿ç”¨ umi æ¡†æ¶å¼€å‘é¡¹ç›®çš„æ–¹å¼ï¼Œä¸ react å‡ ä¹æ— å¼‚ã€‚æ—¢ç„¶å¦‚ä½•é‚£ä¸ºä½•è¦å­¦ï¼Ÿè¯†ä¸‡å·ä¹¦ï¼Œè¡Œä¸‡é‡Œè·¯ã€‚è§å¾—ä¸œè¥¿è¶Šå¤šï¼Œè¶Šèƒ½æ˜ç™½è‡ªå·±çš„ä¸è¶³ä¹‹å¤„ã€‚</p> 
<p>ä¸‹é¢æ˜¯ç¬”è€…å¼€å‘é¡¹ç›®æ¶æ„ï¼Œå„ä½å¯ä»¥åšä¸ªå‚è€ƒ</p> 
<p><img src="https://images2.imgbox.com/27/b5/DsOHhU6L_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æºä»£ç å­˜æ”¾åœ¨ gitee ä¸­</p> 
<p>================================================================</p> 
<p>æ¥æ›´æ–°å•¦å•¦å•¦å•¦å•¦</p> 
<p>================================================================</p> 
<p>å¯ä»¥è‡ªå®šä¹‰ CLIï¼Œä»¥åä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿å¿«æ·ã€‚</p> 
<p>å•Šï¼Œç”Ÿæ´»å·²ç»å¾ˆç´¯äº†ï¼Œä¸ºå•¥ä½ è¿˜è¦æŠ˜ç£¨æˆ‘<br> <img src="https://images2.imgbox.com/d2/32/1BBh1eY1_o.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æˆ‘é‡å¤é€ è½®å­ä¸å°±è¡Œäº†å—ï¼Ÿï¼ˆéª‚éª‚å’§å’§ä¸­ï½ï½ï½ï½ï½ï¼‰å•Šï¼Œé‚£éšä½ å§<br> <img src="https://images2.imgbox.com/6d/88/R6u7zWzj_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p>PSï¼š<br> 1. <code>npm link</code> æˆ–è€… <code>npm</code> å…¶ä»–æƒ…å†µä¸‹å¦‚æœæŠ¥é”™ï¼Œè¯·ä½¿ç”¨ç®¡ç†å‘˜æƒé™ï¼ŒåŠ ä¸ª <code>sudo</code><br> 2. è¯·åœ¨ <code>github</code> ä¸Šåˆ›å»ºä¸€ä¸ªç»„ç»‡ï¼ŒåŠ å…¥è¿›å»ï¼Œåœ¨ç»„ç»‡ä¸­æ”¾å…¥è‡ªå·±çš„ä»£ç ï¼ˆä¸è¦é—®ä¸ºå•¥ï¼Œé—®å°±æ˜¯æˆ‘ä¸æƒ³ç»§ç»­æ¢ç´¢äº†ï¼Œæˆ‘é¥¿äº†ï¼Œæ‰¾äº†ä¸€ä¸ªæœ€ç®€å•çš„åŠæ³•å†™å®Œï¼Œæˆ‘æƒ³å»åƒé¥­ï¼‰</p> 
</blockquote> 
<p>å¦‚ä½•åœ¨ github ä¸Šåˆ›å»ºç»„ç»‡</p> 
<blockquote> 
 <p>PSï¼šgithub å®¹æ˜“æŠ½é£</p> 
</blockquote> 
<p>éœ€è¦å®ç°å“ªäº›åŸºæœ¬åŠŸèƒ½ï¼š</p> 
<ul><li>é€šè¿‡ <code>sumi create &lt;name&gt;</code> å‘½ä»¤å¯åŠ¨é¡¹ç›®</li><li>è¯¢é—®ç”¨æˆ·éœ€è¦ä¸‹è½½çš„æ¨¡æ¿</li><li>è¿œç¨‹æ‹‰å–æ¨¡æ¿</li></ul> 
<h4><a id="1__271"></a>1. åˆ›å»ºé¡¹ç›®</h4> 
<p>ç›®å½•ç»“æ„</p> 
<pre><code class="prism language-css">s-umi-cli           
â”œâ”€ bin                
â”‚  â””â”€ cli.js  # å¯åŠ¨æ–‡ä»¶      
â”œâ”€ README.md          
â””â”€ package.json       
</code></pre> 
<p>é…ç½®è„šæ‰‹æ¶å¯åŠ¨æ–‡ä»¶</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"s-umi-cli"</span><span class="token punctuation">,</span>
  <span class="token string">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token string">"description"</span><span class="token operator">:</span> <span class="token string">"umi cli"</span><span class="token punctuation">,</span>
  <span class="token string">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token string">"bin"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"sumi"</span><span class="token operator">:</span> <span class="token string">"./bin/cli.js"</span> <span class="token comment">// é…ç½®å¯åŠ¨æ–‡ä»¶è·¯å¾„ï¼Œsumi ä¸ºåˆ«å</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"author"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>cli.js</p> 
<pre><code class="prism language-javascript">#<span class="token operator">!</span> <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'~~~~~~~'</span><span class="token punctuation">)</span>
</code></pre> 
<p>ä¸ºäº†æ–¹ä¾¿å¼€å‘è°ƒè¯•ï¼Œä½¿ç”¨ npm link é“¾æ¥åˆ°å…¨å±€</p> 
<pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">link</span>
</code></pre> 
<blockquote> 
 <p>å¦‚æœæŠ¥é”™ï¼Œè¯·åŠ ä¸Š sudo</p> 
</blockquote> 
<p>ç»ˆç«¯è¾“å…¥</p> 
<pre><code class="prism language-bash">sumi
</code></pre> 
<p>å°±å¯ä»¥çœ‹è§ <code>console.log</code> ä¸­çš„å†…å®¹</p> 
<h4><a id="2__325"></a>2. åˆ›å»ºè„šæ‰‹æ¶å¯åŠ¨å‘½ä»¤</h4> 
<p>å€ŸåŠ© commander ä¾èµ–å»å®ç°è¿™ä¸ªéœ€æ±‚</p> 
<h5><a id="21__330"></a>2.1 å®‰è£…ä¾èµ–</h5> 
<pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> commander --save
</code></pre> 
<h5><a id="22__336"></a>2.2 åˆ›å»ºå‘½ä»¤</h5> 
<p>cli.js</p> 
<pre><code class="prism language-javascript">#<span class="token operator">!</span> <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span>

program
  <span class="token comment">// å®šä¹‰å‘½ä»¤å’Œå‚æ•°</span>
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'create &lt;app-name&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'create a new project'</span><span class="token punctuation">)</span>
  <span class="token comment">// -f or --force ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„ç›®å½•å­˜åœ¨åˆ™ç›´æ¥è¦†ç›–</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-f, --force'</span><span class="token punctuation">,</span> <span class="token string">'overwrite target directory if it exist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// æ‰“å°æ‰§è¡Œç»“æœ</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name:'</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span><span class="token string">'options:'</span><span class="token punctuation">,</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
program
   <span class="token comment">// é…ç½®ç‰ˆæœ¬å·ä¿¡æ¯</span>
  <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">v</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token string">'&lt;command&gt; [option]'</span><span class="token punctuation">)</span>
  
<span class="token comment">// è§£æç”¨æˆ·æ‰§è¡Œå‘½ä»¤ä¼ å…¥å‚æ•°</span>
program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>ä¸­ç«¯è¾“å…¥ sumi</p> 
<pre><code class="prism language-bash">sumi
</code></pre> 
<pre><code class="prism language-bash">Usage: sumi <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> <span class="token punctuation">[</span>option<span class="token punctuation">]</span>

Options:
  -V, --version                output the version number
  -h, --help                   display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span>

Commands:
  create <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>app-name<span class="token operator">&gt;</span>  create a new project
  <span class="token builtin class-name">help</span> <span class="token punctuation">[</span>command<span class="token punctuation">]</span>               display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span>
</code></pre> 
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>Commands</code> ä¸‹é¢å·²ç»æœ‰äº† <code>create [options] &lt;app-name&gt;</code>ï¼Œæ¥ç€æ‰§è¡Œä¸€ä¸‹è¿™ä¸ªå‘½ä»¤</p> 
<pre><code class="prism language-bash">sumi create
error: missing required argument <span class="token string">'app-name'</span>

sumi create my-project
æ‰§è¡Œç»“æœ <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> name: my-project options: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

sumi create my-project -f
æ‰§è¡Œç»“æœ <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> name: my-project options: <span class="token punctuation">{<!-- --></span> force: <span class="token boolean">true</span> <span class="token punctuation">}</span>

sumi create my-project --force
æ‰§è¡Œç»“æœ <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> name: my-project options: <span class="token punctuation">{<!-- --></span> force: <span class="token boolean">true</span> <span class="token punctuation">}</span>
</code></pre> 
<p>æˆåŠŸæ‹¿åˆ°å‘½ä»¤è¡Œè¾“å…¥ä¿¡æ¯</p> 
<h5><a id="23__401"></a>2.3 æ‰§è¡Œå‘½ä»¤</h5> 
<p>åˆ›å»º lib æ–‡ä»¶å¤¹å¹¶åœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»º create.js</p> 
<pre><code class="prism language-javascript"><span class="token comment">// lib/create.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// éªŒè¯æ˜¯å¦æ­£å¸¸å–åˆ°å€¼</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt; create.js'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>åœ¨ cli.js ä¸­ä½¿ç”¨ create.js</p> 
<pre><code class="prism language-javascript"><span class="token comment">// bin/cli.js</span>

<span class="token operator">...</span><span class="token operator">...</span>
program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'create &lt;app-name&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'create a new project'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-f, --force'</span><span class="token punctuation">,</span> <span class="token string">'overwrite target directory if it exist'</span><span class="token punctuation">)</span> <span class="token comment">// æ˜¯å¦å¼ºåˆ¶åˆ›å»ºï¼Œå½“æ–‡ä»¶å¤¹å·²ç»å­˜åœ¨</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// åœ¨ create.js ä¸­æ‰§è¡Œåˆ›å»ºä»»åŠ¡</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lib/create.js'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">...</span><span class="token operator">...</span>
</code></pre> 
<p>æ‰§è¡Œä¸€ä¸‹ <code>sumi create my-project</code>ï¼Œæ­¤æ—¶åœ¨ <code>create.js</code> æ­£å¸¸æ‰“å°äº†æˆ‘ä»¬å‡ºå…¥çš„ä¿¡æ¯</p> 
<pre><code class="prism language-bash">sumi create my-project
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> create.js
my-project <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>åœ¨åˆ›å»ºç›®å½•çš„æ—¶å€™ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨</p> 
<p>å¦‚æœå­˜åœ¨</p> 
<p>å½“ <code>{ force: true }</code> æ—¶ï¼Œç›´æ¥ç§»é™¤åŸæ¥çš„ç›®å½•ï¼Œç›´æ¥åˆ›å»º<br> å½“ <code>{ force: false }</code> æ—¶ è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦è¦†ç›–</p> 
<p>å¦‚æœä¸å­˜åœ¨ï¼Œç›´æ¥åˆ›å»º</p> 
<p>è¿™é‡Œç”¨åˆ°äº† fs çš„æ‰©å±•å·¥å…· fs-extraï¼Œå…ˆæ¥å®‰è£…ä¸€ä¸‹<br> fs-extra æ˜¯å¯¹ fs æ¨¡å—çš„æ‰©å±•ï¼Œæ”¯æŒ promise</p> 
<pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> fs-extra --save
</code></pre> 
<p>æ¥ç€å®Œå–„ä¸€ä¸‹ create.js å†…éƒ¨çš„å®ç°é€»è¾‘</p> 
<pre><code class="prism language-javascript"><span class="token comment">// lib/create.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// æ‰§è¡Œåˆ›å»ºå‘½ä»¤</span>

  <span class="token comment">// å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•</span>
  <span class="token keyword">const</span> cwd  <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€</span>
  <span class="token keyword">const</span> targetAir  <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>cwd<span class="token punctuation">,</span> name<span class="token punctuation">)</span>

  <span class="token comment">// ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>targetAir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// æ˜¯å¦ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Ÿ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>force<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>targetAir<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// è¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šè¦è¦†ç›–</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è¯¢é—®éƒ¨åˆ†çš„é€»è¾‘ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹æ–‡ç»§ç»­å®Œå–„</p> 
<h5><a id="24__486"></a>2.4 åˆ›å»ºæ›´å¤šå‘½ä»¤</h5> 
<p>å¦‚æœæƒ³æ·»åŠ å…¶ä»–å‘½ä»¤ä¹Ÿæ˜¯åŒæ ·çš„å¤„ç†æ–¹å¼</p> 
<pre><code class="prism language-javascript"><span class="token comment">// bin/cli.js</span>

<span class="token comment">// é…ç½® config å‘½ä»¤</span>
program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'config [value]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'inspect and modify the config'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-g, --get &lt;path&gt;'</span><span class="token punctuation">,</span> <span class="token string">'get value from option'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-s, --set &lt;path&gt; &lt;value&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-d, --delete &lt;path&gt;'</span><span class="token punctuation">,</span> <span class="token string">'delete option from config'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// é…ç½® ui å‘½ä»¤</span>
program
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'ui'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'start add open roc-cli ui'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-p, --port &lt;port&gt;'</span><span class="token punctuation">,</span> <span class="token string">'Port used for the UI Server'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="25__513"></a>2.5 å®Œå–„å¸®åŠ©ä¿¡æ¯</h5> 
<p>å¯ä»¥çœ‹ä¸€ä¸‹ vue-cli æ‰§è¡Œ --help æ‰“å°çš„ä¿¡æ¯</p> 
<p>å¯¹æ¯” sumi --help æ‰“å°çš„ç»“æœï¼Œç»“å°¾å¤„å°‘äº†ä¸€æ¡è¯´æ˜ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬åšè¡¥å……ï¼Œé‡ç‚¹éœ€è¦æ³¨æ„è¯´æ˜ä¿¡æ¯æ˜¯å¸¦æœ‰é¢œè‰²çš„ï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°æˆ‘ä»¬å·¥å…·åº“é‡Œé¢çš„ chalk æ¥å¤„ç†</p> 
<pre><code class="prism language-javascript"><span class="token comment">// bin/cli.js</span>

program
  <span class="token comment">// ç›‘å¬ --help æ‰§è¡Œ</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'--help'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// æ–°å¢è¯´æ˜ä¿¡æ¯</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\r\nRun </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sumi &lt;command&gt; --help</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> for detailed usage of given command\r\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="26__Logo_530"></a>2.6 æ‰“å°ä¸ª Logo</h5> 
<p>ç»™è„šæ‰‹æ¶æ¥ä¸€ä¸ª Logoï¼Œä½¿ç”¨å·¥å…·åº“é‡Œçš„ figlet</p> 
<pre><code class="prism language-javascript"><span class="token comment">// bin/cli.js</span>

program
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'--help'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ä½¿ç”¨ figlet ç»˜åˆ¶ Logo</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\r\n'</span> <span class="token operator">+</span> figlet<span class="token punctuation">.</span><span class="token function">textSync</span><span class="token punctuation">(</span><span class="token string">'sumi'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
      font<span class="token operator">:</span> <span class="token string">'Ghost'</span><span class="token punctuation">,</span>
      horizontalLayout<span class="token operator">:</span> <span class="token string">'default'</span><span class="token punctuation">,</span>
      verticalLayout<span class="token operator">:</span> <span class="token string">'default'</span><span class="token punctuation">,</span>
      width<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
      whitespaceBreak<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ–°å¢è¯´æ˜ä¿¡æ¯</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\r\nRun </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sumi &lt;command&gt; --help</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> show details\r\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="3__551"></a>3. è¯¢é—®ç”¨æˆ·é—®é¢˜è·å–åˆ›å»ºæ‰€éœ€ä¿¡æ¯</h4> 
<p>ä½¿ç”¨ inquirer è§£å†³å‘½ä»¤è¡Œäº¤äº’çš„é—®é¢˜<br> ä¸Šä¸€æ­¥é—ç•™ï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„ç›®å½•</p> 
<ul><li>ç”¨æˆ·é€‰æ‹©æ¨¡æ¿</li><li>ç”¨æˆ·é€‰æ‹©ç‰ˆæœ¬</li><li>è·å–ä¸‹è½½æ¨¡æ¿çš„é“¾æ¥</li></ul> 
<h5><a id="31__558"></a>3.1 è¯¢é—®æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„ç›®å½•</h5> 
<p>è¿™é‡Œè§£å†³ä¸Šä¸€æ­¥é—ç•™çš„é—®é¢˜ï¼š</p> 
<p>å¦‚æœç›®å½•å·²å­˜åœ¨</p> 
<p>å½“ <code>{ force: false }</code> æ—¶ è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦è¦†ç›–</p> 
<p>é€»è¾‘å®é™…ä¸Šå·²ç»å®Œæˆï¼Œè¿™é‡Œè¡¥å……ä¸€ä¸‹è¯¢é—®çš„å†…å®¹</p> 
<p>å®‰è£… inquirer</p> 
<pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> inquirer --save
</code></pre> 
<p>ç„¶åè¯¢é—®ç”¨æˆ·æ˜¯å¦è¿›è¡Œ Overwrite</p> 
<pre><code class="prism language-javascript"><span class="token comment">// lib/create.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token comment">// fs-extra æ˜¯å¯¹ fs æ¨¡å—çš„æ‰©å±•ï¼Œæ”¯æŒ promise è¯­æ³•</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// æ‰§è¡Œåˆ›å»ºå‘½ä»¤</span>

  <span class="token comment">// å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•</span>
  <span class="token keyword">const</span> cwd  <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€</span>
  <span class="token keyword">const</span> targetAir  <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>cwd<span class="token punctuation">,</span> name<span class="token punctuation">)</span>

  <span class="token comment">// ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>targetAir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// æ˜¯å¦ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Ÿ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>force<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>targetAir<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>

      <span class="token comment">// è¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šè¦è¦†ç›–</span>
      <span class="token keyword">let</span> <span class="token punctuation">{<!-- --></span> action <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          name<span class="token operator">:</span> <span class="token string">'action'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
          message<span class="token operator">:</span> <span class="token string">'Target directory already exists Pick an action:'</span><span class="token punctuation">,</span>
          choices<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
              name<span class="token operator">:</span> <span class="token string">'Overwrite'</span><span class="token punctuation">,</span>
              value<span class="token operator">:</span> <span class="token string">'overwrite'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
              name<span class="token operator">:</span> <span class="token string">'Cancel'</span><span class="token punctuation">,</span>
              value<span class="token operator">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>action<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">===</span> <span class="token string">'overwrite'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ç§»é™¤å·²å­˜åœ¨çš„ç›®å½•</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\r\nRemoving...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>targetAir<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>github æä¾›äº† api æ¥å£æ¥è·å–ä¿¡æ¯</p> 
<p>api.github.com/orgs/ æ¥å£è·å–æ¨¡æ¿ä¿¡æ¯<br> api.github.com/repos/ æ¥å£è·å–ç‰ˆæœ¬ä¿¡æ¯</p> 
<p>æˆ‘ä»¬åœ¨ lib ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª http.js ä¸“é—¨å¤„ç†æ¨¡æ¿å’Œç‰ˆæœ¬ä¿¡æ¯çš„è·å–</p> 
<pre><code class="prism language-javascript"><span class="token comment">// lib/http.js</span>

<span class="token comment">// é€šè¿‡ axios å¤„ç†è¯·æ±‚</span>
<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>

axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">/**
 * è·å–æ¨¡æ¿åˆ—è¡¨
 * @returns Promise
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getRepoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://api.github.com/orgs/zhurong-cli/repos'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * è·å–ç‰ˆæœ¬ä¿¡æ¯
 * @param {string} repo æ¨¡æ¿åç§°
 * @returns Promise
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span>  <span class="token function">getTagList</span><span class="token punctuation">(</span><span class="token parameter">repo</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.github.com/repos/zhurong-cli/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>repo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/tags</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  getRepoList<span class="token punctuation">,</span>
  getTagList
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="33__672"></a>3.3 ç”¨æˆ·é€‰æ‹©æ¨¡æ¿</h5> 
<p>æˆ‘ä»¬ä¸“é—¨æ–°å»ºä¸€ä¸ª Generator.js æ¥å¤„ç†é¡¹ç›®åˆ›å»ºé€»è¾‘</p> 
<pre><code class="prism language-javascript"><span class="token comment">// lib/Generator.js</span>

<span class="token keyword">class</span> <span class="token class-name">Generator</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> targetDir</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ç›®å½•åç§°</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºä½ç½®</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>targetDir <span class="token operator">=</span> targetDir<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// æ ¸å¿ƒåˆ›å»ºé€»è¾‘</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Generator<span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨ create.js ä¸­å¼•å…¥ Generator ç±»</p> 
<pre><code class="prism language-javascript"><span class="token comment">// lib/create.js</span>

<span class="token operator">...</span>
<span class="token keyword">const</span> Generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./Generator'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// æ‰§è¡Œåˆ›å»ºå‘½ä»¤</span>

  <span class="token comment">// å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•</span>
  <span class="token keyword">const</span> cwd  <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€</span>
  <span class="token keyword">const</span> targetAir  <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>cwd<span class="token punctuation">,</span> name<span class="token punctuation">)</span>

  <span class="token comment">// ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>targetAir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// åˆ›å»ºé¡¹ç›®</span>
  <span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> targetAir<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å¼€å§‹åˆ›å»ºé¡¹ç›®</span>
  generator<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è¯¢é—®ç”¨æˆ·é€‰æ‹©æ¨¡ç‰ˆçš„é€»è¾‘</p> 
<pre><code class="prism language-javascript"><span class="token comment">// lib/Generator.js</span>

<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> getRepoList <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span>

<span class="token comment">// æ·»åŠ åŠ è½½åŠ¨ç”»</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">wrapLoading</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// ä½¿ç”¨ ora åˆå§‹åŒ–ï¼Œä¼ å…¥æç¤ºä¿¡æ¯ message</span>
  <span class="token keyword">const</span> spinner <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å¼€å§‹åŠ è½½åŠ¨ç”»</span>
  spinner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// æ‰§è¡Œä¼ å…¥æ–¹æ³• fn</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºæˆåŠŸ</span>
    spinner<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºå¤±è´¥</span>
    spinner<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">'Request failed, refetch ...'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Generator</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> targetDir</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ç›®å½•åç§°</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºä½ç½®</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>targetDir <span class="token operator">=</span> targetDir<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è·å–ç”¨æˆ·é€‰æ‹©çš„æ¨¡æ¿</span>
  <span class="token comment">// 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®</span>
  <span class="token comment">// 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°</span>
  <span class="token comment">// 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°</span>

  <span class="token keyword">async</span> <span class="token function">getRepo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®</span>
    <span class="token keyword">const</span> repoList <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wrapLoading</span><span class="token punctuation">(</span>getRepoList<span class="token punctuation">,</span> <span class="token string">'waiting fetch template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>repoList<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token comment">// è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„æ¨¡æ¿åç§°</span>
    <span class="token keyword">const</span> repos <span class="token operator">=</span> repoList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°</span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> repo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      name<span class="token operator">:</span> <span class="token string">'repo'</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
      choices<span class="token operator">:</span> repos<span class="token punctuation">,</span>
      message<span class="token operator">:</span> <span class="token string">'Please choose a template to create project'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°</span>
    <span class="token keyword">return</span> repo<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// æ ¸å¿ƒåˆ›å»ºé€»è¾‘</span>
  <span class="token comment">// 1ï¼‰è·å–æ¨¡æ¿åç§°</span>
  <span class="token comment">// 2ï¼‰è·å– tag åç§°</span>
  <span class="token comment">// 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 1ï¼‰è·å–æ¨¡æ¿åç§°</span>
    <span class="token keyword">const</span> repo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRepo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·é€‰æ‹©äº†ï¼Œrepo='</span> <span class="token operator">+</span> repo<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Generator<span class="token punctuation">;</span>
</code></pre> 
<p>æ­¤æ—¶ï¼ŒæˆåŠŸæ‹¿åˆ°æ¨¡æ¿åç§° repo çš„ç»“æœ âœŒï¸</p> 
<h5><a id="34__802"></a>3.4 ç”¨æˆ·é€‰æ‹©ç‰ˆæœ¬</h5> 
<p>è¿‡ç¨‹å’Œ 3.3 ä¸€æ ·</p> 
<pre><code class="prism language-javascript"><span class="token comment">// lib/generator.js</span>

<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> getRepoList<span class="token punctuation">,</span> getTagList <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./http'</span><span class="token punctuation">)</span>
<span class="token operator">...</span>

<span class="token comment">// æ·»åŠ åŠ è½½åŠ¨ç”»</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">wrapLoading</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Generator</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> targetDir</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ç›®å½•åç§°</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºä½ç½®</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>targetDir <span class="token operator">=</span> targetDir<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è·å–ç”¨æˆ·é€‰æ‹©çš„æ¨¡æ¿</span>
  <span class="token comment">// 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®</span>
  <span class="token comment">// 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°</span>
  <span class="token comment">// 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°</span>

  <span class="token keyword">async</span> <span class="token function">getRepo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è·å–ç”¨æˆ·é€‰æ‹©çš„ç‰ˆæœ¬</span>
  <span class="token comment">// 1ï¼‰åŸºäº repo ç»“æœï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„ tag åˆ—è¡¨</span>
  <span class="token comment">// 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±éœ€è¦ä¸‹è½½çš„ tag</span>
  <span class="token comment">// 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„ tag</span>

  <span class="token keyword">async</span> <span class="token function">getTag</span><span class="token punctuation">(</span><span class="token parameter">repo</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1ï¼‰åŸºäº repo ç»“æœï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„ tag åˆ—è¡¨</span>
    <span class="token keyword">const</span> tags <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wrapLoading</span><span class="token punctuation">(</span>getTagList<span class="token punctuation">,</span> <span class="token string">'waiting fetch tag'</span><span class="token punctuation">,</span> repo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tags<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    
    <span class="token comment">// è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„ tag åç§°</span>
    <span class="token keyword">const</span> tagsList <span class="token operator">=</span> tags<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±éœ€è¦ä¸‹è½½çš„ tag</span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> tag <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      name<span class="token operator">:</span> <span class="token string">'tag'</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
      choices<span class="token operator">:</span> tagsList<span class="token punctuation">,</span>
      message<span class="token operator">:</span> <span class="token string">'Place choose a tag to create project'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„ tag</span>
    <span class="token keyword">return</span> tag
  <span class="token punctuation">}</span>

  <span class="token comment">// æ ¸å¿ƒåˆ›å»ºé€»è¾‘</span>
  <span class="token comment">// 1ï¼‰è·å–æ¨¡æ¿åç§°</span>
  <span class="token comment">// 2ï¼‰è·å– tag åç§°</span>
  <span class="token comment">// 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 1ï¼‰è·å–æ¨¡æ¿åç§°</span>
    <span class="token keyword">const</span> repo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRepo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 2) è·å– tag åç§°</span>
    <span class="token keyword">const</span> tag <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span>repo<span class="token punctuation">)</span>
     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·é€‰æ‹©äº†ï¼Œrepo='</span> <span class="token operator">+</span> repo <span class="token operator">+</span> <span class="token string">'ï¼Œtag='</span><span class="token operator">+</span> tag<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Generator<span class="token punctuation">;</span>
</code></pre> 
<p>åˆ°æ­¤è¯¢é—®çš„å·¥ä½œå°±ç»“æŸäº†ï¼Œå¯ä»¥è¿›è¡Œæ¨¡æ¿ä¸‹è½½äº†</p> 
<h4><a id="4__877"></a>4. ä¸‹è½½è¿œç¨‹æ¨¡æ¿</h4> 
<p>ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆéœ€è¦ä½¿ç”¨ download-git-repo å·¥å…·åŒ…ï¼Œä½†å®ƒæ˜¯ä¸æ”¯æŒ promiseçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œéœ€è¦ä½¿ç”¨ util æ¨¡å—ä¸­çš„ promisify æ–¹æ³•å¯¹å…¶è¿›è¡Œ promise åŒ–ã€‚</p> 
<h5><a id="41__promise__879"></a>4.1 å®‰è£…ä¾èµ–ä¸ promise åŒ–</h5> 
<pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> download-git-repo --save
</code></pre> 
<p>è¿›è¡Œ promise åŒ–å¤„ç†</p> 
<pre><code class="prism language-javascript"><span class="token comment">// lib/Generator.js</span>

<span class="token operator">...</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> downloadGitRepo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span> <span class="token comment">// ä¸æ”¯æŒ Promise</span>

<span class="token keyword">class</span> <span class="token class-name">Generator</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> targetDir</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>

    <span class="token comment">// å¯¹ download-git-repo è¿›è¡Œ promise åŒ–æ”¹é€ </span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>downloadGitRepo <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>downloadGitRepo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="42__906"></a>4.2 æ ¸å¿ƒä¸‹è½½åŠŸèƒ½</h5> 
<p>æ¥ç€ï¼Œå°±æ˜¯æ¨¡æ¿ä¸‹è½½éƒ¨åˆ†çš„é€»è¾‘äº†</p> 
<pre><code class="prism language-javascript"><span class="token comment">// lib/Generator.js</span>

<span class="token operator">...</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> downloadGitRepo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span> <span class="token comment">// ä¸æ”¯æŒ Promise</span>

<span class="token comment">// æ·»åŠ åŠ è½½åŠ¨ç”»</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">wrapLoading</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Generator</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> targetDir</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>

    <span class="token comment">// å¯¹ download-git-repo è¿›è¡Œ promise åŒ–æ”¹é€ </span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>downloadGitRepo <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>downloadGitRepo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
  
  <span class="token comment">// ä¸‹è½½è¿œç¨‹æ¨¡æ¿</span>
  <span class="token comment">// 1ï¼‰æ‹¼æ¥ä¸‹è½½åœ°å€</span>
  <span class="token comment">// 2ï¼‰è°ƒç”¨ä¸‹è½½æ–¹æ³•</span>
  <span class="token keyword">async</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token parameter">repo<span class="token punctuation">,</span> tag</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 1ï¼‰æ‹¼æ¥ä¸‹è½½åœ°å€</span>
    <span class="token keyword">const</span> requestUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">zhurong-cli/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>repo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tag<span class="token operator">?</span><span class="token string">'#'</span><span class="token operator">+</span>tag<span class="token operator">:</span><span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    <span class="token comment">// 2ï¼‰è°ƒç”¨ä¸‹è½½æ–¹æ³•</span>
    <span class="token keyword">await</span> <span class="token function">wrapLoading</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>downloadGitRepo<span class="token punctuation">,</span> <span class="token comment">// è¿œç¨‹ä¸‹è½½æ–¹æ³•</span>
      <span class="token string">'waiting download template'</span><span class="token punctuation">,</span> <span class="token comment">// åŠ è½½æç¤ºä¿¡æ¯</span>
      requestUrl<span class="token punctuation">,</span> <span class="token comment">// å‚æ•°1: ä¸‹è½½åœ°å€</span>
      path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>targetDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// å‚æ•°2: åˆ›å»ºä½ç½®</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// æ ¸å¿ƒåˆ›å»ºé€»è¾‘</span>
  <span class="token comment">// 1ï¼‰è·å–æ¨¡æ¿åç§°</span>
  <span class="token comment">// 2ï¼‰è·å– tag åç§°</span>
  <span class="token comment">// 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•</span>
  <span class="token comment">// 4ï¼‰æ¨¡æ¿ä½¿ç”¨æç¤º</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 1ï¼‰è·å–æ¨¡æ¿åç§°</span>
    <span class="token keyword">const</span> repo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRepo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 2) è·å– tag åç§°</span>
    <span class="token keyword">const</span> tag <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span>repo<span class="token punctuation">)</span>

    <span class="token comment">// 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> tag<span class="token punctuation">)</span>
    
    <span class="token comment">// 4ï¼‰æ¨¡æ¿ä½¿ç”¨æç¤º</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\r\nSuccessfully created project </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\r\n  cd </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'  npm run dev\r\n'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Generator<span class="token punctuation">;</span>
</code></pre> 
<p>å®Œæˆè¿™å—ï¼Œä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶å°±å®Œæˆäº†<br> æ¥è¯•ä¸€ä¸‹æ•ˆæœå¦‚ä½•ï¼Œæ‰§è¡Œ sumi create my-project</p> 
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ¨¡æ¿å°±å·²ç»åˆ›å»ºå¥½äº†<br> s-umi-cli</p> 
<pre><code class="prism language-javascript">â”œâ”€ bin                      
â”‚  â””â”€ cli<span class="token punctuation">.</span>js                
â”œâ”€ lib                      
â”‚  â”œâ”€ Generator<span class="token punctuation">.</span>js          
â”‚  â”œâ”€ create<span class="token punctuation">.</span>js             
â”‚  â””â”€ http<span class="token punctuation">.</span>js               
â”œâ”€ my<span class="token operator">-</span>project <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> æˆ‘ä»¬åˆ›å»ºçš„é¡¹ç›®             
â”‚  â”œâ”€ <span class="token keyword">public</span>                
â”‚  â”‚  â”œâ”€ favicon<span class="token punctuation">.</span>ico        
â”‚  â”‚  â””â”€ index<span class="token punctuation">.</span>html         
â”‚  â”œâ”€ src                   
â”‚  â”‚  â”œâ”€ assets             
â”‚  â”‚  â”‚  â””â”€ logo<span class="token punctuation">.</span>png        
â”‚  â”‚  â”œâ”€ components         
â”‚  â”‚  â”‚  â””â”€ HelloWorld<span class="token punctuation">.</span>vue  
â”‚  â”‚  â”œâ”€ App<span class="token punctuation">.</span>vue            
â”‚  â”‚  â””â”€ main<span class="token punctuation">.</span>js            
â”‚  â”œâ”€ <span class="token constant">README</span><span class="token punctuation">.</span>md             
â”‚  â”œâ”€ babel<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js       
â”‚  â””â”€ <span class="token keyword">package</span><span class="token punctuation">.</span>json          
â”œâ”€ <span class="token constant">README</span><span class="token punctuation">.</span>md                
â”œâ”€ <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json        
â””â”€ <span class="token keyword">package</span><span class="token punctuation">.</span>json             
</code></pre> 
<h4><a id="5__1006"></a>5. å‘å¸ƒé¡¹ç›®</h4> 
<p>ä¸Šé¢éƒ½æ˜¯åœ¨æœ¬åœ°æµ‹è¯•ï¼Œå®é™…åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½å°±éœ€è¦å‘å¸ƒåˆ° npm ä»“åº“ï¼Œé€šè¿‡ npm å…¨å±€å®‰è£…ä¹‹åï¼Œç›´æ¥åˆ°ç›®æ ‡ç›®å½•ä¸‹é¢å»åˆ›å»ºé¡¹ç›®ï¼Œå¦‚ä½•å‘å¸ƒå‘¢ï¼Ÿ</p> 
<p>ç¬¬ä¸€æ­¥ï¼Œåœ¨ git ä¸Šå»ºå¥½ä»“åº“<br> ç¬¬äºŒæ­¥ï¼Œå®Œå–„ package.json ä¸­çš„é…ç½®</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"zhurong-cli"</span><span class="token punctuation">,</span>
  <span class="token string">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.4"</span><span class="token punctuation">,</span>
  <span class="token string">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token string">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token string">"bin"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"zr"</span><span class="token operator">:</span> <span class="token string">"./bin/cli.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"bin"</span><span class="token punctuation">,</span>
    <span class="token string">"lib"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"author"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"T-Roc"</span><span class="token punctuation">,</span>
    <span class="token string">"email"</span><span class="token operator">:</span> <span class="token string">"lxp_work@163.com"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"zhurong-cli"</span><span class="token punctuation">,</span>
    <span class="token string">"zr"</span><span class="token punctuation">,</span>
    <span class="token string">"è„šæ‰‹æ¶"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>
  <span class="token string">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"axios"</span><span class="token operator">:</span> <span class="token string">"^0.21.1"</span><span class="token punctuation">,</span>
    <span class="token string">"chalk"</span><span class="token operator">:</span> <span class="token string">"^4.1.1"</span><span class="token punctuation">,</span>
    <span class="token string">"commander"</span><span class="token operator">:</span> <span class="token string">"^7.2.0"</span><span class="token punctuation">,</span>
    <span class="token string">"download-git-repo"</span><span class="token operator">:</span> <span class="token string">"^3.0.2"</span><span class="token punctuation">,</span>
    <span class="token string">"figlet"</span><span class="token operator">:</span> <span class="token string">"^1.5.0"</span><span class="token punctuation">,</span>
    <span class="token string">"fs-extra"</span><span class="token operator">:</span> <span class="token string">"^10.0.0"</span><span class="token punctuation">,</span>
    <span class="token string">"inquirer"</span><span class="token operator">:</span> <span class="token string">"^8.0.0"</span><span class="token punctuation">,</span>
    <span class="token string">"ora"</span><span class="token operator">:</span> <span class="token string">"^5.4.0"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨ npm publish è¿›è¡Œå‘å¸ƒï¼Œæ›´æ–°åˆ°æ—¶å€™ï¼Œæ³¨æ„ä¿®æ”¹ç‰ˆæœ¬å·</p> 
<p>è¿™æ ·å°±å‘å¸ƒæˆåŠŸäº†ï¼Œæˆ‘ä»¬æ‰“å¼€ npm ç½‘ç«™æœç´¢ä¸€ä¸‹ ğŸ”</p> 
<p>å·²ç»å¯ä»¥æ‰¾åˆ°å®ƒäº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ npm æˆ–è€… yarn å…¨å±€å®‰è£…ä½¿ç”¨äº†ã€‚</p> 
<p>å…³æ³¨å…¬ä¼—å·ï¼šå¤§æ˜è´µå¦‡ï¼Œè·å– Umi.js å­¦ä¹ èµ„æ–™ï¼ˆå›å¤ Umi ï¼‰ï¼ŒæœŸå¾…å„ä½å®¢å®˜æ¥ä¸´<br> <img src="https://images2.imgbox.com/a5/59/KDc8fkaY_o.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/dc493809a2fd</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e24e3c5c01314f9a879c573691fa9e4c/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">html è½¬æˆvue_æµ…æVueä¸¤ç§ç‰ˆæœ¬</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/545463d605f731e402ef7084ef4d7a01/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Numpyå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰åŸºæœ¬æ“ä½œ&amp;arrayçš„åˆ›å»º</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>