<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>解密数据清洗，SQL中的数据分析 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="解密数据清洗，SQL中的数据分析" />
<meta property="og:description" content="大家好，数据库表中的数据经常会很杂乱。数据可能包含缺失值、重复记录、异常值、不一致的数据输入等，在使用SQL进行分析之前清洗数据是非常重要的。
当学习SQL时，可以随意地创建数据库表，更改它们，根据需要更新和删除记录。但在实际操作中，几乎从不会这样，因为可能没有权限更改表、更新和删除记录。但如果有数据库的读取权限，可以运行大量的SELECT查询。
本文将创建一个数据库表，在其中填充记录，并了解如何使用SQL清洗数据。
创建一个名为employees的员工表，如下所示：
-- 创建employees表 CREATE TABLE employees ( employee_id INT PRIMARY KEY, employee_name VARCHAR(50), salary DECIMAL(10, 2), hire_date VARCHAR(20), department VARCHAR(50) ); 接下来，向表中插入一些虚构的样本记录：
-- 插入20个样本记录 INSERT INTO employees (employee_id, employee_name, salary, hire_date, department) VALUES (1, &#39;Amy West&#39;, 60000.00, &#39;2021-01-15&#39;, &#39;HR&#39;), (2, &#39;Ivy Lee&#39;, 75000.50, &#39;2020-05-22&#39;, &#39;Sales&#39;), (3, &#39;joe smith&#39;, 80000.75, &#39;2019-08-10&#39;, &#39;Marketing&#39;), (4, &#39;John White&#39;, 90000.00, &#39;2020-11-05&#39;, &#39;Finance&#39;), (5, &#39;Jane Hill&#39;, 55000.25, &#39;2022-02-28&#39;, &#39;IT&#39;), (6, &#39;Dave West&#39;, 72000." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/4a89881784e72f69efc9452b7aaf14a9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-30T23:53:51+08:00" />
<meta property="article:modified_time" content="2024-01-30T23:53:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">解密数据清洗，SQL中的数据分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>大家好，数据库表中的数据经常会很杂乱。数据可能包含缺失值、重复记录、异常值、不一致的数据输入等，在使用SQL进行分析之前清洗数据是非常重要的。</p> 
<p>当学习SQL时，可以随意地创建数据库表，更改它们，根据需要更新和删除记录。但在实际操作中，几乎从不会这样，因为可能没有权限更改表、更新和删除记录。但如果有数据库的读取权限，可以运行大量的SELECT查询。</p> 
<p>本文将创建一个数据库表，在其中填充记录，并了解如何使用SQL清洗数据。</p> 
<p>创建一个名为<code>employees</code>的员工表，如下所示：</p> 
<pre><code class="language-sql">-- 创建employees表
CREATE TABLE employees (
 employee_id INT PRIMARY KEY,
 employee_name VARCHAR(50),
 salary DECIMAL(10, 2),
 hire_date VARCHAR(20),
 department VARCHAR(50)
);
</code></pre> 
<p>接下来，向表中插入一些虚构的样本记录：</p> 
<pre><code class="language-sql">-- 插入20个样本记录
INSERT INTO employees (employee_id, employee_name, salary, hire_date, department) VALUES
(1, 'Amy West', 60000.00, '2021-01-15', 'HR'),
(2, 'Ivy Lee', 75000.50, '2020-05-22', 'Sales'),
(3, 'joe smith', 80000.75, '2019-08-10', 'Marketing'), 
(4, 'John White', 90000.00, '2020-11-05', 'Finance'),
(5, 'Jane Hill', 55000.25, '2022-02-28', 'IT'),
(6, 'Dave West', 72000.00, '2020-03-12', 'Marketing'),
(7, 'Fanny Lee', 85000.50, '2018-06-25', 'Sales'),
(8, 'Amy Smith', 95000.25, '2019-11-30', 'Finance'),
(9, 'Ivy Hill', 62000.75, '2021-07-18', 'IT'),
(10, 'Joe White', 78000.00, '2022-04-05', 'Marketing'),
(11, 'John Lee', 68000.50, '2018-12-10', 'HR'),
(12, 'Jane West', 89000.25, '2017-09-15', 'Sales'),
(13, 'Dave Smith', 60000.75, '2022-01-08', NULL),
(14, 'Fanny White', 72000.00, '2019-04-22', 'IT'),
(15, 'Amy Hill', 84000.50, '2020-08-17', 'Marketing'),
(16, 'Ivy West', 92000.25, '2021-02-03', 'Finance'),
(17, 'Joe Lee', 58000.75, '2018-05-28', 'IT'),
(18, 'John Smith', 77000.00, '2019-10-10', 'HR'),
(19, 'Jane Hill', 81000.50, '2022-03-15', 'Sales'),
(20, 'Dave White', 70000.25, '2017-12-20', 'Marketing');
</code></pre> 
<p>这里使用了一小部分名字和姓氏作为样本，并为记录构建了姓名字段。</p> 
<p><strong>注意：</strong>本教程中的所有查询都是针对MySQL的，但可以自由选择使用喜欢的关系型数据库管理系统（RDBMS）。</p> 
<h3>1. 缺失值</h3> 
<p>数据记录中的缺失值总是一个问题，因此必须对其进行相应的处理。</p> 
<p>一种简单的方法是删除包含一个或多个字段缺失值的所有记录。然而，除非确定没有其他更好的处理缺失值的方法，否则不应该这样做。</p> 
<p>在<code>employees</code>表中，可以看到<code>department</code>列中有一个NULL值（参见<code>employee_id</code>为<code>13</code>的行），表示该字段缺失：</p> 
<pre><code class="language-sql">SELECT * FROM employees;
</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="414" src="https://images2.imgbox.com/45/20/ZU4VRB13_o.png" width="531"></p> 
<p>可以使用<code>COALESCE()</code>函数将NULL值替换为<code>Unknown</code>字符串：</p> 
<pre><code class="language-sql">SELECT
 employee_id,
 employee_name,
 salary,
 hire_date,
 COALESCE(department, 'Unknown') AS department
FROM employees;
</code></pre> 
<p>运行上述查询应该会给出以下结果：</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="395" src="https://images2.imgbox.com/30/31/rU4sm2z8_o.png" width="532"></p> 
<h3>2. 重复记录</h3> 
<p>数据库表中的重复记录可能会扭曲分析结果。在数据库表中选择了<code>employee_id</code>作为主键，因此在<code>employee_data</code>表中不会有重复的员工记录。</p> 
<p>仍然可以使用<code>SELECT DISTINCT</code>语句：</p> 
<pre><code class="language-sql">SELECT DISTINCT * FROM employees;
</code></pre> 
<p>如预期所示，结果集包含了所有的20条记录：</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="421" src="https://images2.imgbox.com/ae/a8/pYWUKe1Y_o.png" width="551"></p> 
<h3>3. 数据类型转换</h3> 
<p>可以注意到，<code>hire_date</code>列目前是VARCHAR类型，而不是日期类型。为了在处理日期时更方便，使用<code>STR_TO_DATE()</code>函数，如下所示：</p> 
<pre><code class="language-sql">SELECT
 employee_id,
 employee_name,
 salary,
 STR_TO_DATE(hire_date, '%Y-%m-%d') AS hire_date,
 department
FROM employees;
</code></pre> 
<p>在这里只选择了<code>hire_date</code>列，而没有对日期值执行任何操作。因此，查询的输出结果应与前一个查询的结果相同。</p> 
<p>如果想执行诸如给值添加偏移日期之类的操作，那么该函数可能会有所帮助。</p> 
<h3>4. 异常值</h3> 
<p>一个或多个数值字段中的异常值可能会影响分析结果，因此应该检查并清除异常值，以过滤掉不相关的数据。判断哪些值构成异常值需要领域知识，还需要利用领域知识和历史数据。</p> 
<p>假设知道<code>salary</code>列的上限为100000，因此，<code>salary</code>列中的任何条目最多只能是100000，而大于此值的条目则是异常值。</p> 
<p>可以通过运行以下查询来检查这样的记录：</p> 
<pre><code class="language-sql">SELECT *
FROM employees
WHERE salary &gt; 100000;
</code></pre> 
<p>如图所示，<code>salary</code>列中的所有条目都是有效的。因此结果集为空：</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="116" src="https://images2.imgbox.com/ba/dc/0Zo4vSS9_o.png" width="380"></p> 
<h3>5. 数据输入不一致</h3> 
<p>数据输入和格式不一致的情况很常见，尤其是在日期和字符串列中。</p> 
<p>在<code>employees</code>表中，可以看到员工<code>joe smith</code>对应的记录不是以标题大小写形式显示的。</p> 
<p>但是，为了保持一致性，选择所有以标题大小写格式显示的姓名。需要将<code>CONCAT()</code>函数与<code>UPPER()</code>和<code>SUBSTRING()</code>函数结合使用，如下所示：</p> 
<pre><code class="language-sql">SELECT
 employee_id,
 CONCAT(
     UPPER(SUBSTRING(employee_name, 1, 1)), -- Capitalize the first letter of the first name
     LOWER(SUBSTRING(employee_name, 2, LOCATE(' ', employee_name) - 2)), -- Make the rest of the first name lowercase
     ' ',
     UPPER(SUBSTRING(employee_name, LOCATE(' ', employee_name) + 1, 1)), -- Capitalize the first letter of the last name
     LOWER(SUBSTRING(employee_name, LOCATE(' ', employee_name) + 2)) -- Make the rest of the last name lowercase
 ) AS employee_name_title_case,
 salary,
 hire_date,
 department
FROM employees;
</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="384" src="https://images2.imgbox.com/e8/c2/qA3093yR_o.png" width="571"></p> 
<h3>6. 验证范围</h3> 
<p>在谈论异常值时，希望对<code>salary</code>列设置上限为100000，并将任何超过100000的薪资条目视为异常值。但同样也不能在<code>salary</code>列中有任何负值。因此，可以运行以下查询来验证所有员工记录的<code>salary</code>列值是否都在0和100000之间：</p> 
<pre><code class="language-sql">SELECT
 employee_id,
 employee_name,
 salary,
 hire_date,
 department
FROM employees
WHERE salary &lt; 0 OR salary &gt; 100000;
</code></pre> 
<p>如图所示，<code>salary</code>列值都在0和100000之间。因此结果集为空：</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="193" src="https://images2.imgbox.com/7b/21/rtjIZLsW_o.png" width="477"></p> 
<h3>7. 派生新列</h3> 
<p>派生新列本质上并不是数据清洗的步骤。在实际操作中，可能需要使用现有列派生出对分析更有帮助的新列。</p> 
<p>例如，员工表包含一个<code>hire_date</code>列。更有帮助的字段可能是一个<code>years_of_service</code>列，表示员工在公司任职的年限。</p> 
<p>以下查询会计算当前年份与<code>hire_date</code>中年份值的差值，从而计算出<code>years_of_service</code>：</p> 
<pre><code class="language-sql">SELECT
 employee_id,
 employee_name,
 salary,
 hire_date,
 department,
 YEAR(CURDATE()) - YEAR(hire_date) AS years_of_service
FROM employees;
</code></pre> 
<p>应该会看到以下输出：</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="371" src="https://images2.imgbox.com/e7/1b/Do6m48X3_o.png" width="619"></p> 
<p>与我们运行的其他查询一样，这不会修改原始表。要向原始表中添加新列，需要拥有ALTER数据库表的权限。</p> 
<p>综上，希望大家理解相关的数据清洗任务如何提高数据质量并促进更相关的分析，同时学习如何检查缺失值、重复记录、不一致的格式、异常值等。可以尝试创建自己的关系型数据库表，并运行一些查询来执行常见的数据清洗任务。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/515c83071cbb5b2c5c535181bc7e03f3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringBoot基础</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/df39b27d68481fa98db808ca742cab82/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">springboot3整合支付宝沙箱网页版</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>