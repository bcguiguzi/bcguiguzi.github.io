<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>A股月份效应的研究——基于python量化视角(backtrader回测) - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="A股月份效应的研究——基于python量化视角(backtrader回测)" />
<meta property="og:description" content="A股月份效应的研究 前言 《易经》早就揭示出：物极必反，盛极必衰！
阴阳总是不断交替的。股票市场也一样，涨跌互现，涨多了会出现调整，跌多了会出现反弹，因此我们看到K线组合总是红（阳）绿（阴）相间的。
正是由于市场行情总是阴阳交替出现，交易者们才孜孜不倦地想通过择时（选股）来获取超额收益。指数的走势是各方资金博弈的结果，而博弈的过程存在一个时间的延续性，也就是说过去的走势对未来走向有一定的参考价值。
尽管过去不能代表未来，但统计发现历史总是“惊人的相似”，比如“月份效应”。实际上，不少实证研究发现大多数市场存在“月份效应”，即存在某个或某些特定月份的平均收益率年复一年显著地异于其他各月平均收益率的现象。
一、月度收益率分析 # 月份效应 # 获取数据 import numpy as np import pandas as pd import matplotlib.pyplot as plt import matplotlib.patches as mpatches #正常显示画图时出现的中文和负号 from pylab import mpl mpl.rcParams[&#39;font.sans-serif&#39;]=[&#39;SimHei&#39;] mpl.rcParams[&#39;axes.unicode_minus&#39;]=False def get_daily_ret(security,start_date,end_date): df=get_price(security, start_date,end_date, frequency=&#39;daily&#39;, fields=[&#39;open&#39;,&#39;close&#39;,&#39;high&#39;,&#39;low&#39;,&#39;volume&#39;,&#39;money&#39;]) df.index=pd.to_datetime(df.index) # 计算收益率 daily_ret=df[&#39;close&#39;].pct_change() # 删除缺失值 daily_ret=daily_ret.dropna() return daily_ret # 月度收益情况 def plot_monthly_ret(security,title): daily_ret=get_daily_ret(security,start_date,end_date) monthly_ret=daily_ret.resample(&#39;M&#39;).apply(lambda x:((1&#43;x).prod()-1)) plt.rcParams[&#39;figure.figsize&#39;]=[20,5] monthly_ret.plot() start=monthly_ret.index[0] end=monthly_ret.index[-1] #显示月收益率大于3/4分位数的点 dates=monthly_ret[monthly_ret&gt;monthly_ret.quantile(0.75)].index for i in range(0,len(dates)): plt.scatter(dates[i], monthly_ret[dates[i]],color=&#39;r&#39;) labs = mpatches." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/802a8eba1d53efc90c7ec639dc8055ab/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-03T22:24:19+08:00" />
<meta property="article:modified_time" content="2022-02-03T22:24:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">A股月份效应的研究——基于python量化视角(backtrader回测)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="A_0"></a>A股月份效应的研究</h2> 
<h2><a id="_3"></a>前言</h2> 
<p>《易经》早就揭示出：物极必反，盛极必衰！</p> 
<p>阴阳总是不断交替的。股票市场也一样，涨跌互现，涨多了会出现调整，跌多了会出现反弹，因此我们看到K线组合总是红（阳）绿（阴）相间的。</p> 
<p>正是由于市场行情总是阴阳交替出现，交易者们才孜孜不倦地想通过择时（选股）来获取超额收益。指数的走势是各方资金博弈的结果，而博弈的过程存在一个时间的延续性，也就是说过去的走势对未来走向有一定的参考价值。</p> 
<p>尽管过去不能代表未来，但统计发现历史总是“惊人的相似”，比如“月份效应”。实际上，不少实证研究发现大多数市场存在“月份效应”，即存在某个或某些特定月份的平均收益率年复一年显著地异于其他各月平均收益率的现象。</p> 
<h2><a id="_13"></a>一、月度收益率分析</h2> 
<pre><code class="prism language-bash"><span class="token comment"># 月份效应</span>
<span class="token comment"># 获取数据</span>
<span class="token function">import</span> numpy as np
<span class="token function">import</span> pandas as pd
<span class="token function">import</span> matplotlib.pyplot as plt
<span class="token function">import</span> matplotlib.patches as mpatches
<span class="token comment">#正常显示画图时出现的中文和负号</span>
from pylab <span class="token function">import</span> mpl
mpl.rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>
mpl.rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span><span class="token operator">=</span>False
</code></pre> 
<pre><code class="prism language-bash">def get_daily_ret<span class="token punctuation">(</span>security,start_date,end_date<span class="token punctuation">)</span>:
    <span class="token assign-left variable">df</span><span class="token operator">=</span>get_price<span class="token punctuation">(</span>security, start_date,end_date, <span class="token assign-left variable">frequency</span><span class="token operator">=</span><span class="token string">'daily'</span>, <span class="token assign-left variable">fields</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'open'</span>,<span class="token string">'close'</span>,<span class="token string">'high'</span>,<span class="token string">'low'</span>,<span class="token string">'volume'</span>,<span class="token string">'money'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    df.index<span class="token operator">=</span>pd.to_datetime<span class="token punctuation">(</span>df.index<span class="token punctuation">)</span>
<span class="token comment">#     计算收益率</span>
    <span class="token assign-left variable">daily_ret</span><span class="token operator">=</span>df<span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span>.pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#     删除缺失值</span>
    <span class="token assign-left variable">daily_ret</span><span class="token operator">=</span>daily_ret.dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin class-name">return</span> daily_ret
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 月度收益情况</span>
def plot_monthly_ret<span class="token punctuation">(</span>security,title<span class="token punctuation">)</span>:
    <span class="token assign-left variable">daily_ret</span><span class="token operator">=</span>get_daily_ret<span class="token punctuation">(</span>security,start_date,end_date<span class="token punctuation">)</span>
    <span class="token assign-left variable">monthly_ret</span><span class="token operator">=</span>daily_ret.resample<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span>.apply<span class="token punctuation">(</span>lambda x:<span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span><span class="token operator">+</span>x<span class="token punctuation">)</span>.prod<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">))</span></span>
    plt.rcParams<span class="token punctuation">[</span><span class="token string">'figure.figsize'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">20,5</span><span class="token punctuation">]</span>
    monthly_ret.plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">start</span><span class="token operator">=</span>monthly_ret.index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token assign-left variable">end</span><span class="token operator">=</span>monthly_ret.index<span class="token punctuation">[</span>-1<span class="token punctuation">]</span>

<span class="token comment">#显示月收益率大于3/4分位数的点</span>
    <span class="token assign-left variable">dates</span><span class="token operator">=</span>monthly_ret<span class="token punctuation">[</span>monthly_ret<span class="token operator">&gt;</span>monthly_ret.quantile<span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">)</span><span class="token punctuation">]</span>.index   
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span>,len<span class="token punctuation">(</span>dates<span class="token punctuation">))</span>:
        plt.scatter<span class="token punctuation">(</span>dates<span class="token punctuation">[</span>i<span class="token punctuation">]</span>, monthly_ret<span class="token punctuation">[</span>dates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>,color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
    labs <span class="token operator">=</span> mpatches.Patch<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">'red'</span>,alpha<span class="token operator">=</span>.5, <span class="token assign-left variable">label</span><span class="token operator">=</span><span class="token string">"月收益率高于3/4分位"</span><span class="token punctuation">)</span>
    plt.title<span class="token punctuation">(</span>title+<span class="token string">'月度收益率'</span>,size<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
    plt.legend<span class="token punctuation">(</span>handles<span class="token operator">=</span><span class="token punctuation">[</span>labs<span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt.xlabel<span class="token punctuation">(</span><span class="token string">'时间'</span><span class="token punctuation">)</span>
    plt.ylabel<span class="token punctuation">(</span><span class="token string">'收益率'</span><span class="token punctuation">)</span>
    plt.show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token assign-left variable">security</span><span class="token operator">=</span><span class="token string">'000300.XSHG'</span>
<span class="token assign-left variable">start_date</span><span class="token operator">=</span><span class="token string">'2010-01-01'</span>
<span class="token assign-left variable">end_date</span><span class="token operator">=</span><span class="token string">'2022-01-01'</span>
plot_monthly_ret<span class="token punctuation">(</span>security,<span class="token string">'沪深300指数'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/14/d1/OGzXHErt_o.png" alt="在这里插入图片描述"><br> 从图中可以看出，沪深300指数的月收益率围绕均线上下绕动。</p> 
<pre><code class="prism language-bash"><span class="token comment">#月波动率情况</span>
def plot_votil<span class="token punctuation">(</span>security,title<span class="token punctuation">)</span>:
    <span class="token assign-left variable">daily_ret</span><span class="token operator">=</span>get_daily_ret<span class="token punctuation">(</span>security,start_date,end_date<span class="token punctuation">)</span>
    <span class="token assign-left variable">monthly_annu</span><span class="token operator">=</span>daily_ret.resample<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span>.std<span class="token punctuation">(</span><span class="token punctuation">)</span>*np.sqrt<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
    plt.rcParams<span class="token punctuation">[</span><span class="token string">'figure.figsize'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">20,5</span><span class="token punctuation">]</span>
    monthly_annu.plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">start</span><span class="token operator">=</span>monthly_annu.index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token assign-left variable">end</span><span class="token operator">=</span>monthly_annu.index<span class="token punctuation">[</span>-1<span class="token punctuation">]</span>
    <span class="token assign-left variable">dates</span><span class="token operator">=</span>monthly_annu<span class="token punctuation">[</span>monthly_annu<span class="token operator">&gt;</span><span class="token number">0.07</span><span class="token punctuation">]</span>.index
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span>,len<span class="token punctuation">(</span>dates<span class="token punctuation">)</span>-1,3<span class="token punctuation">)</span>:
        plt.axvspan<span class="token punctuation">(</span>dates<span class="token punctuation">[</span>i<span class="token punctuation">]</span>,dates<span class="token punctuation">[</span>i+1<span class="token punctuation">]</span>,color<span class="token operator">=</span><span class="token string">'r'</span>,alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    plt.title<span class="token punctuation">(</span>title+<span class="token string">'月度收益率标准差'</span>,size<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">labs</span><span class="token operator">=</span>mpatches.Patch<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">'red'</span>,alpha<span class="token operator">=</span>.5, <span class="token assign-left variable">label</span><span class="token operator">=</span><span class="token string">"波动集聚"</span><span class="token punctuation">)</span>
    plt.legend<span class="token punctuation">(</span>handles<span class="token operator">=</span><span class="token punctuation">[</span>labs<span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt.xlabel<span class="token punctuation">(</span><span class="token string">'交易日'</span><span class="token punctuation">)</span>
    plt.ylabel<span class="token punctuation">(</span><span class="token string">'月度波动率'</span><span class="token punctuation">)</span>
    plt.show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6a/eb/UbdRCYWW_o.png" alt="在这里插入图片描述"><br> 从图中可以看出，沪深300指数的波动率存在聚集的现象。</p> 
<pre><code class="prism language-bash">
def plot_mean_ret<span class="token punctuation">(</span>security,title<span class="token punctuation">)</span>:
    <span class="token assign-left variable">daily_ret</span><span class="token operator">=</span>get_daily_ret<span class="token punctuation">(</span>security,start_date,end_date<span class="token punctuation">)</span>
    <span class="token assign-left variable">monthly_ret</span><span class="token operator">=</span>daily_ret.resample<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span>.apply<span class="token punctuation">(</span>lambda x:<span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span><span class="token operator">+</span>x<span class="token punctuation">)</span>.prod<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">))</span></span>
    <span class="token assign-left variable">mrets</span><span class="token operator">=</span><span class="token punctuation">(</span>monthly_ret.groupby<span class="token punctuation">(</span>monthly_ret.index.month<span class="token punctuation">)</span>.mean<span class="token punctuation">(</span><span class="token punctuation">))</span>.round<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">x</span><span class="token operator">=</span>list<span class="token punctuation">(</span>mrets.index<span class="token punctuation">)</span>
    <span class="token assign-left variable">y</span><span class="token operator">=</span>list<span class="token punctuation">(</span>mrets.values<span class="token punctuation">)</span>
      
    
    plt.rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>
    plt.rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> False
    plt.figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16,8</span><span class="token punctuation">))</span>

    <span class="token assign-left variable">ax</span><span class="token operator">=</span>plt.gca<span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token comment">#设置图片的右边框和上边框为不显示</span>
    ax.spines<span class="token punctuation">[</span><span class="token string">'right'</span><span class="token punctuation">]</span>.set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>
    ax.spines<span class="token punctuation">[</span><span class="token string">'left'</span><span class="token punctuation">]</span>.set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>
    ax.spines<span class="token punctuation">[</span><span class="token string">'bottom'</span><span class="token punctuation">]</span>.set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>
    ax.spines<span class="token punctuation">[</span><span class="token string">'top'</span><span class="token punctuation">]</span>.set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>

    <span class="token comment"># 百分比设置</span>
    from matplotlib.ticker <span class="token function">import</span> PercentFormatter
    plt.gca<span class="token punctuation">(</span><span class="token punctuation">)</span>.yaxis.set_major_formatter<span class="token punctuation">(</span>PercentFormatter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">))</span>

    <span class="token comment"># 坐标轴刻度大小</span>
    <span class="token comment">#设置x轴</span>
    plt.xticks<span class="token punctuation">(</span>fontname<span class="token operator">=</span><span class="token string">"SimHei"</span>,fontsize<span class="token operator">=</span><span class="token number">15</span>,rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    plt.yticks<span class="token punctuation">(</span>fontname<span class="token operator">=</span><span class="token string">"SimHei"</span>,fontsize<span class="token operator">=</span><span class="token number">15</span>,rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">bar</span><span class="token operator">=</span>plt.bar<span class="token punctuation">(</span>x,y,0.3,color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
    plt.ylabel<span class="token punctuation">(</span><span class="token string">'月平均收益率'</span>,fontsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
    plt.xlabel<span class="token punctuation">(</span><span class="token string">'月份'</span>,fontsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
    

    
    plt.title<span class="token punctuation">(</span>title+<span class="token string">'月平均收益率'</span>,fontsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
    <span class="token builtin class-name">return</span> bar,mrets
</code></pre> 
<p><img src="https://images2.imgbox.com/65/89/zrMZhelc_o.png" alt="在这里插入图片描述"><br> 从图中可以看出，平均月份的收益率均值也存在较大的差异，由此大致看出，月份效应确实存在。</p> 
<h2><a id="_133"></a>二、月份效应策略构建</h2> 
<pre><code class="prism language-bash"><span class="token comment"># 月份均值</span>
def monthly_ret_stats<span class="token punctuation">(</span>security,title<span class="token punctuation">)</span>:
    <span class="token assign-left variable">daily_ret</span><span class="token operator">=</span>get_daily_ret<span class="token punctuation">(</span>security,start_date,end_date<span class="token punctuation">)</span>
    <span class="token assign-left variable">monthly_ret</span><span class="token operator">=</span>daily_ret.resample<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span>.apply<span class="token punctuation">(</span>lambda x:<span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span><span class="token operator">+</span>x<span class="token punctuation">)</span>.prod<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">))</span></span>
    <span class="token assign-left variable">ret_stats</span><span class="token operator">=</span>monthly_ret.groupby<span class="token punctuation">(</span>monthly_ret.index.month<span class="token punctuation">)</span>.describe<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">pnm</span><span class="token operator">=</span>ret_stats<span class="token punctuation">[</span>ret_stats<span class="token punctuation">[</span><span class="token string">'mean'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0.01</span><span class="token punctuation">]</span>.index.to_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">nnm</span><span class="token operator">=</span>ret_stats<span class="token punctuation">[</span>ret_stats<span class="token punctuation">[</span><span class="token string">'mean'</span><span class="token punctuation">]</span><span class="token operator">&lt;</span>-0.01<span class="token punctuation">]</span>.index.to_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin class-name">return</span> pnm,nnm
</code></pre> 
<p>构建一个简单的月度择时策略并进行历史回测。即先对指数历史数据进行统计分析，计算月度收益率的历史均值，当月度收益率均值大于1%时做多当月，当月度收益率均值小于-1%时做空当月。</p> 
<p>首先计算出看多月份和看空月份，看多月份为[2, 4, 10, 12], 看空月份为[1, 6, 8]。</p> 
<p>接下来设置模拟的交易策略</p> 
<pre><code class="prism language-bash">def Month_Strategy<span class="token punctuation">(</span>security,is_short<span class="token punctuation">)</span>:
    daily_ret <span class="token operator">=</span> get_daily_ret<span class="token punctuation">(</span>security,start_date,end_date<span class="token punctuation">)</span>
    <span class="token comment">#月度收益率</span>
    mnthly_ret <span class="token operator">=</span> daily_ret.resample<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span>.apply<span class="token punctuation">(</span>lambda x <span class="token builtin class-name">:</span> <span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span><span class="token operator">+</span>x<span class="token punctuation">)</span>.prod<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">))</span></span>
    <span class="token comment">#设计买卖信号</span>
    <span class="token assign-left variable">df</span><span class="token operator">=</span>pd.DataFrame<span class="token punctuation">(</span>mnthly_ret.values,index<span class="token operator">=</span>mnthly_ret.index,columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'ret'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">#做多月份</span>
    <span class="token assign-left variable">ret_stats</span><span class="token operator">=</span>monthly_ret.groupby<span class="token punctuation">(</span>monthly_ret.index.month<span class="token punctuation">)</span>.describe<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">pnm</span><span class="token operator">=</span>ret_stats<span class="token punctuation">[</span>ret_stats<span class="token punctuation">[</span><span class="token string">'mean'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0.01</span><span class="token punctuation">]</span>.index.to_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">nnm</span><span class="token operator">=</span>ret_stats<span class="token punctuation">[</span>ret_stats<span class="token punctuation">[</span><span class="token string">'mean'</span><span class="token punctuation">]</span><span class="token operator">&lt;</span>-0.01<span class="token punctuation">]</span>.index.to_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
      

    print<span class="token punctuation">(</span>f<span class="token string">'做多月份：{pnm}'</span><span class="token punctuation">)</span>
    df<span class="token punctuation">[</span><span class="token string">'signal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">m</span> <span class="token keyword">in</span> pnm:
        df.loc<span class="token punctuation">[</span>df.index.month<span class="token operator">==</span>m,<span class="token string">'signal'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>
    <span class="token comment">#如果可以做空</span>
    <span class="token keyword">if</span> <span class="token assign-left variable">is_short</span><span class="token operator">==</span>True:
        <span class="token keyword">for</span> <span class="token for-or-select variable">n</span> <span class="token keyword">in</span> nnm:
            df.loc<span class="token punctuation">[</span>df.index.month<span class="token operator">==</span>n,<span class="token string">'signal'</span><span class="token punctuation">]</span><span class="token operator">=</span>-1
        print<span class="token punctuation">(</span>f<span class="token string">'做空月份：{nnm}'</span><span class="token punctuation">)</span>

    df<span class="token punctuation">[</span><span class="token string">'capital_ret'</span><span class="token punctuation">]</span><span class="token operator">=</span>df.ret.mul<span class="token punctuation">(</span>df.signal<span class="token punctuation">)</span>
    <span class="token comment">#计算标的、策略的累计收益率</span>
    df<span class="token punctuation">[</span><span class="token string">'策略净值'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>df.capital_ret+1.0<span class="token punctuation">)</span>.cumprod<span class="token punctuation">(</span><span class="token punctuation">)</span>
    df<span class="token punctuation">[</span><span class="token string">'指数净值'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>df.ret+1.0<span class="token punctuation">)</span>.cumprod<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin class-name">return</span> <span class="token function">df</span>
</code></pre> 
<p>不能做空时的情况：</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">title</span><span class="token operator">=</span><span class="token string">'沪深300指数'</span>
<span class="token assign-left variable">is_short</span><span class="token operator">=</span><span class="token string">'False'</span>
<span class="token assign-left variable">long</span><span class="token operator">=</span>Month_Strategy<span class="token punctuation">(</span>security,is_short<span class="token punctuation">)</span>
long
</code></pre> 
<p><img src="https://images2.imgbox.com/f0/b7/fvT4Psmd_o.png" alt="在这里插入图片描述"><br> 可以做空的情况：</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">title</span><span class="token operator">=</span><span class="token string">'沪深300指数'</span>
<span class="token assign-left variable">is_short</span><span class="token operator">=</span>True
<span class="token assign-left variable">long_short</span><span class="token operator">=</span>Month_Strategy<span class="token punctuation">(</span>security,is_short<span class="token punctuation">)</span>
long_short
</code></pre> 
<p><img src="https://images2.imgbox.com/e9/6b/vmjn2bgl_o.png" alt="在这里插入图片描述"><br> 将两者进行对比可以发现，做空策略下的收益率更高一些</p> 
<pre><code class="prism language-bash">plt.figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12,10</span><span class="token punctuation">))</span>
plt.plot<span class="token punctuation">(</span>long<span class="token punctuation">[</span><span class="token string">'策略净值'</span><span class="token punctuation">]</span>,label<span class="token operator">=</span><span class="token string">'不可做空下的策略净值'</span><span class="token punctuation">)</span>

plt.plot<span class="token punctuation">(</span>long_short<span class="token punctuation">[</span><span class="token string">'策略净值'</span><span class="token punctuation">]</span>,label<span class="token operator">=</span><span class="token string">'可做空下的策略净值'</span><span class="token punctuation">)</span>
plt.plot<span class="token punctuation">(</span>long<span class="token punctuation">[</span><span class="token string">'指数净值'</span><span class="token punctuation">]</span>,label<span class="token operator">=</span><span class="token string">'指数净值'</span><span class="token punctuation">)</span>
plt.legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt.show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7e/4e/pguCVgWI_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="backtrader_210"></a>三、backtrader回测</h2> 
<p>发现对沪深300指数进行月份策略有不错的收益率，那么接下来实盘操作一下，以沪深300指数的场内连接基金（ETF）为例进行实盘回测。</p> 
<pre><code class="prism language-bash">from datetime <span class="token function">import</span> datetime
<span class="token function">import</span> backtrader as bt
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 通过数据库获取数据</span>
def get_data<span class="token punctuation">(</span>security,start_date,end_date<span class="token punctuation">)</span>:
    <span class="token function">df</span> <span class="token operator">=</span> get_price<span class="token punctuation">(</span>security, start_date, end_date, <span class="token assign-left variable">frequency</span><span class="token operator">=</span><span class="token string">'daily'</span><span class="token punctuation">)</span>
    
    df<span class="token punctuation">[</span><span class="token string">'daily_ret'</span><span class="token punctuation">]</span><span class="token operator">=</span>df.close.pct_change<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token assign-left variable">month_ret</span><span class="token operator">=</span>df.daily_ret.resample<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span>.apply<span class="token punctuation">(</span>lambda x <span class="token builtin class-name">:</span> <span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span><span class="token operator">+</span>x<span class="token punctuation">)</span>.prod<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">))</span></span>
    df<span class="token punctuation">[</span><span class="token string">'month'</span><span class="token punctuation">]</span><span class="token operator">=</span>month_ret
    <span class="token assign-left variable">df</span><span class="token operator">=</span>df.dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
    df<span class="token punctuation">[</span><span class="token string">'openinterest'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token assign-left variable">df</span><span class="token operator">=</span>df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'open'</span>,<span class="token string">'high'</span>,<span class="token string">'low'</span>,<span class="token string">'close'</span>,<span class="token string">'volume'</span>,<span class="token string">'openinterest'</span>,<span class="token string">'month'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment">#按照back trader数据格式进行整合</span>
    <span class="token builtin class-name">return</span> <span class="token function">df</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token assign-left variable">security</span><span class="token operator">=</span><span class="token string">'510300.XSHG'</span>
<span class="token assign-left variable">start_date</span><span class="token operator">=</span><span class="token string">'2010-01-01'</span>
<span class="token assign-left variable">end_date</span><span class="token operator">=</span><span class="token string">'2022-01-01'</span>
<span class="token assign-left variable">stock_df</span><span class="token operator">=</span>get_data<span class="token punctuation">(</span>security,start_date,end_date<span class="token punctuation">)</span>
stock_df
</code></pre> 
<p>数据如下所示：<br> <img src="https://images2.imgbox.com/3e/dd/icZN8lqp_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment"># 将数据导入到back trader中</span>
<span class="token assign-left variable">fromdate</span><span class="token operator">=</span>datetime<span class="token punctuation">(</span><span class="token number">2010,1</span>,1<span class="token punctuation">)</span>
<span class="token assign-left variable">todate</span><span class="token operator">=</span>datetime<span class="token punctuation">(</span><span class="token number">2021,12</span>,31<span class="token punctuation">)</span>
<span class="token assign-left variable">data</span><span class="token operator">=</span>bt.feeds.PandasData<span class="token punctuation">(</span>dataname<span class="token operator">=</span>stock_df,fromdate<span class="token operator">=</span>fromdate,todate<span class="token operator">=</span>todate<span class="token punctuation">)</span>
</code></pre> 
<p>将做多和做空的月份安排如下：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 做多月份：[2, 4, 10, 12]</span>
<span class="token comment"># 做空月份：[1, 6, 8]</span>
</code></pre> 
<p>构建回测策略：</p> 
<pre><code class="prism language-bash">class TestStrategy<span class="token punctuation">(</span>bt.Strategy<span class="token punctuation">)</span>:
    
    def log<span class="token punctuation">(</span>self,txt,dt<span class="token operator">=</span>None<span class="token punctuation">)</span>:
        <span class="token assign-left variable">dt</span><span class="token operator">=</span>dt or self.datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.datetime.date<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        print<span class="token punctuation">(</span><span class="token string">'%s,%s'</span>%<span class="token punctuation">(</span>dt.isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>,txt<span class="token punctuation">))</span>
        
    def __init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        self.dataclose <span class="token operator">=</span> self.datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.close
        self.datatime<span class="token operator">=</span>self.datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.datetime.date<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        self.order<span class="token operator">=</span>None  <span class="token comment">#跟踪挂单</span>
        self.buyprice <span class="token operator">=</span> None
        self.buycomm <span class="token operator">=</span> None <span class="token comment">#加入手续费</span>
        
    def notify_order<span class="token punctuation">(</span>self,order<span class="token punctuation">)</span>:
        <span class="token keyword">if</span> order.status <span class="token keyword">in</span> <span class="token punctuation">[</span>order.Submitted,order.Accepted<span class="token punctuation">]</span>: <span class="token comment">#经纪商提交/接受/接受的买入/卖出订单 </span>
            <span class="token builtin class-name">return</span>
        <span class="token keyword">if</span> order.status <span class="token keyword">in</span> <span class="token punctuation">[</span>order.Completed<span class="token punctuation">]</span>: <span class="token comment">## 检查订单是否完成</span>
                                              <span class="token comment"># 注意：如果没有足够的现金，经纪人可能会拒绝订单</span>
            
            <span class="token keyword">if</span> order.isbuy<span class="token punctuation">(</span><span class="token punctuation">)</span>:
                self.log<span class="token punctuation">(</span>
                    <span class="token string">'BUY EXECUTED, Price: %.2f, Cost: %.2f, Comm %.2f'</span> %
                    <span class="token punctuation">(</span>order.executed.price,
                     order.executed.value,
                     order.executed.comm<span class="token punctuation">))</span>
                self.buyprice <span class="token operator">=</span> order.executed.price
                self.buycomm <span class="token operator">=</span> order.executed.comm
                         
            else:
                 self.log<span class="token punctuation">(</span><span class="token string">'SELL EXECUTED, Price: %.2f, Cost: %.2f, Comm %.2f'</span> %
                          <span class="token punctuation">(</span>order.executed.price,order.executed.value,order.executed.comm<span class="token punctuation">))</span>
                      
            self.bar_executed<span class="token operator">=</span>len<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
            
        <span class="token keyword">elif</span> order.status <span class="token keyword">in</span> <span class="token punctuation">[</span>order.Canceled,order.Margin,order.Rejected<span class="token punctuation">]</span>:
            self.log<span class="token punctuation">(</span><span class="token string">'Order Canceled/Margin/Rejected'</span><span class="token punctuation">)</span>
            
        self.order<span class="token operator">=</span>None <span class="token comment">#写下：无挂单</span>
    def next<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        self.log<span class="token punctuation">(</span><span class="token string">'Close,%.2f'</span>%self.dataclose<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self.order: <span class="token comment">## 检查订单是否处于待处理状态...如果是，我们不能发送第二个</span>
            <span class="token builtin class-name">return</span>
        <span class="token keyword">if</span> not self.position: <span class="token comment">#检查我们是否在市场上</span>
            <span class="token keyword">for</span> <span class="token for-or-select variable">m</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">2</span>, <span class="token number">4</span>, <span class="token number">10</span>, <span class="token number">12</span><span class="token punctuation">]</span>:
                <span class="token keyword">if</span> self.datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.datetime.date<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>.month<span class="token operator">==</span>m:
                    self.log<span class="token punctuation">(</span><span class="token string">'BUY CREATE,%.2f'</span>%self.dataclose<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    self.order<span class="token operator">=</span>self.buy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#跟踪创建的订单以避免第二个订单</span>
        else:
            <span class="token keyword">for</span> <span class="token for-or-select variable">n</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">6</span>, <span class="token number">8</span><span class="token punctuation">]</span>:
                <span class="token keyword">if</span> self.datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.datetime.date<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>.month<span class="token operator">==</span>n:
                    self.log<span class="token punctuation">(</span><span class="token string">'SELL CREATE,%.2f'</span>%self.dataclose<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    self.order<span class="token operator">=</span>self.sell<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>进化回测</p> 
<pre><code class="prism language-bash"><span class="token function">import</span> backtrader.analyzers as btanalyzers
<span class="token function">import</span> backtrader.feeds as btfeeds
<span class="token function">import</span> backtrader.strategies as btstrats

<span class="token keyword">if</span> <span class="token assign-left variable">__name__</span><span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token builtin class-name">:</span>
    <span class="token assign-left variable">cerebro</span><span class="token operator">=</span>bt.Cerebro<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cerebro.addstrategy<span class="token punctuation">(</span>TestStrategy<span class="token punctuation">)</span>
    cerebro.adddata<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    cerebro.addanalyzer<span class="token punctuation">(</span>btanalyzers.SharpeRatio, <span class="token assign-left variable">_name</span><span class="token operator">=</span><span class="token string">'mysharpe'</span><span class="token punctuation">)</span>

    cerebro.broker.setcash<span class="token punctuation">(</span><span class="token number">20000.0</span><span class="token punctuation">)</span>
    cerebro.broker.setcommission<span class="token punctuation">(</span>commission<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span> 
    print<span class="token punctuation">(</span>f<span class="token string">'组合初始价值:%.2f'</span>%cerebro.broker.getvalue<span class="token punctuation">(</span><span class="token punctuation">))</span>
<span class="token comment">#     运行broker</span>
    thestrats <span class="token operator">=</span> cerebro.run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    print<span class="token punctuation">(</span>f<span class="token string">'组合期末价值:%.2f'</span>%cerebro.broker.getvalue<span class="token punctuation">(</span><span class="token punctuation">))</span>
    cerebro.plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
    thestrat <span class="token operator">=</span> thestrats<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    print<span class="token punctuation">(</span><span class="token string">'Sharpe Ratio:'</span>, thestrat.analyzers.mysharpe.get_analysis<span class="token punctuation">(</span><span class="token punctuation">))</span>
</code></pre> 
<p>回测结果如下所示：</p> 
<hr> 
<h3><a id="_338"></a>不出意外就要出意外了</h3> 
<hr> 
<p>回测的具体买卖阶段如下，可以看出这样的回测结果，是不理想的，基本没有盈利，余额宝也没有跑赢。</p> 
<pre><code class="prism language-bash">组合初始价值:20000.00
<span class="token number">2012</span>-05-31,Close,2.26
<span class="token number">2012</span>-07-31,Close,2.04
<span class="token number">2012</span>-08-31,Close,1.93
<span class="token number">2012</span>-10-31,Close,1.96
<span class="token number">2012</span>-10-31,BUY CREATE,1.96
<span class="token number">2012</span>-11-30,BUY EXECUTED, Price: <span class="token number">1.85</span>, Cost: <span class="token number">1.85</span>, Comm <span class="token number">0.00</span>
<span class="token number">2012</span>-11-30,Close,1.86
<span class="token number">2012</span>-12-31,Close,2.20
<span class="token number">2013</span>-01-31,Close,2.34
<span class="token number">2013</span>-01-31,SELL CREATE,2.34
<span class="token number">2013</span>-02-28,SELL EXECUTED, Price: <span class="token number">2.27</span>, Cost: <span class="token number">1.85</span>, Comm <span class="token number">0.00</span>
<span class="token number">2013</span>-02-28,Close,2.32
<span class="token number">2013</span>-02-28,BUY CREATE,2.32
<span class="token number">2013</span>-05-31,BUY EXECUTED, Price: <span class="token number">2.30</span>, Cost: <span class="token number">2.30</span>, Comm <span class="token number">0.00</span>
<span class="token number">2013</span>-05-31,Close,2.27
<span class="token number">2013</span>-07-31,Close,1.95
<span class="token number">2013</span>-09-30,Close,2.15
<span class="token number">2013</span>-10-31,Close,2.12
<span class="token number">2013</span>-12-31,Close,2.07
<span class="token number">2014</span>-02-28,Close,1.93
<span class="token number">2014</span>-03-31,Close,1.91
<span class="token number">2014</span>-04-30,Close,1.91
<span class="token number">2014</span>-06-30,Close,1.94
<span class="token number">2014</span>-06-30,SELL CREATE,1.94
<span class="token number">2014</span>-07-31,SELL EXECUTED, Price: <span class="token number">2.11</span>, Cost: <span class="token number">2.30</span>, Comm <span class="token number">0.00</span>
<span class="token number">2014</span>-07-31,Close,2.13
<span class="token number">2014</span>-09-30,Close,2.22
<span class="token number">2014</span>-10-31,Close,2.27
<span class="token number">2014</span>-10-31,BUY CREATE,2.27
<span class="token number">2014</span>-12-31,BUY EXECUTED, Price: <span class="token number">3.10</span>, Cost: <span class="token number">3.10</span>, Comm <span class="token number">0.00</span>
<span class="token number">2014</span>-12-31,Close,3.18
<span class="token number">2015</span>-03-31,Close,3.63
<span class="token number">2015</span>-04-30,Close,4.26
<span class="token number">2015</span>-06-30,Close,4.03
<span class="token number">2015</span>-06-30,SELL CREATE,4.03
<span class="token number">2015</span>-07-31,SELL EXECUTED, Price: <span class="token number">3.46</span>, Cost: <span class="token number">3.10</span>, Comm <span class="token number">0.00</span>
<span class="token number">2015</span>-07-31,Close,3.46
<span class="token number">2015</span>-08-31,Close,3.05
<span class="token number">2015</span>-09-30,Close,2.90
<span class="token number">2015</span>-11-30,Close,3.25
<span class="token number">2015</span>-12-31,Close,3.40
<span class="token number">2015</span>-12-31,BUY CREATE,3.40
<span class="token number">2016</span>-02-29,BUY EXECUTED, Price: <span class="token number">2.67</span>, Cost: <span class="token number">2.67</span>, Comm <span class="token number">0.00</span>
<span class="token number">2016</span>-02-29,Close,2.62
<span class="token number">2016</span>-03-31,Close,2.93
<span class="token number">2016</span>-05-31,Close,2.90
<span class="token number">2016</span>-06-30,Close,2.89
<span class="token number">2016</span>-06-30,SELL CREATE,2.89
<span class="token number">2016</span>-08-31,SELL EXECUTED, Price: <span class="token number">3.08</span>, Cost: <span class="token number">2.67</span>, Comm <span class="token number">0.00</span>
<span class="token number">2016</span>-08-31,Close,3.10
<span class="token number">2016</span>-09-30,Close,3.04
<span class="token number">2016</span>-10-31,Close,3.10
<span class="token number">2016</span>-10-31,BUY CREATE,3.10
<span class="token number">2016</span>-11-30,BUY EXECUTED, Price: <span class="token number">3.31</span>, Cost: <span class="token number">3.31</span>, Comm <span class="token number">0.00</span>
<span class="token number">2016</span>-11-30,Close,3.29
<span class="token number">2017</span>-02-28,Close,3.20
<span class="token number">2017</span>-03-31,Close,3.21
<span class="token number">2017</span>-05-31,Close,3.24
<span class="token number">2017</span>-06-30,Close,3.42
<span class="token number">2017</span>-06-30,SELL CREATE,3.42
<span class="token number">2017</span>-07-31,SELL EXECUTED, Price: <span class="token number">3.51</span>, Cost: <span class="token number">3.31</span>, Comm <span class="token number">0.00</span>
<span class="token number">2017</span>-07-31,Close,3.52
<span class="token number">2017</span>-08-31,Close,3.61
<span class="token number">2017</span>-10-31,Close,3.77
<span class="token number">2017</span>-10-31,BUY CREATE,3.77
<span class="token number">2017</span>-11-30,BUY EXECUTED, Price: <span class="token number">3.81</span>, Cost: <span class="token number">3.81</span>, Comm <span class="token number">0.00</span>
<span class="token number">2017</span>-11-30,Close,3.77
<span class="token number">2018</span>-01-31,Close,4.01
<span class="token number">2018</span>-01-31,SELL CREATE,4.01
<span class="token number">2018</span>-02-28,SELL EXECUTED, Price: <span class="token number">3.78</span>, Cost: <span class="token number">3.81</span>, Comm <span class="token number">0.00</span>
<span class="token number">2018</span>-02-28,Close,3.77
<span class="token number">2018</span>-02-28,BUY CREATE,3.77
<span class="token number">2018</span>-05-31,BUY EXECUTED, Price: <span class="token number">3.52</span>, Cost: <span class="token number">3.52</span>, Comm <span class="token number">0.00</span>
<span class="token number">2018</span>-05-31,Close,3.57
<span class="token number">2018</span>-07-31,Close,3.36
<span class="token number">2018</span>-08-31,Close,3.18
<span class="token number">2018</span>-08-31,SELL CREATE,3.18
<span class="token number">2018</span>-10-31,SELL EXECUTED, Price: <span class="token number">2.98</span>, Cost: <span class="token number">3.52</span>, Comm <span class="token number">0.00</span>
<span class="token number">2018</span>-10-31,Close,3.01
<span class="token number">2018</span>-10-31,BUY CREATE,3.01
<span class="token number">2018</span>-11-30,BUY EXECUTED, Price: <span class="token number">3.00</span>, Cost: <span class="token number">3.00</span>, Comm <span class="token number">0.00</span>
<span class="token number">2018</span>-11-30,Close,3.04
<span class="token number">2019</span>-01-31,Close,3.06
<span class="token number">2019</span>-01-31,SELL CREATE,3.06
<span class="token number">2019</span>-02-28,SELL EXECUTED, Price: <span class="token number">3.51</span>, Cost: <span class="token number">3.00</span>, Comm <span class="token number">0.00</span>
<span class="token number">2019</span>-02-28,Close,3.50
<span class="token number">2019</span>-02-28,BUY CREATE,3.50
<span class="token number">2019</span>-04-30,BUY EXECUTED, Price: <span class="token number">3.72</span>, Cost: <span class="token number">3.72</span>, Comm <span class="token number">0.00</span>
<span class="token number">2019</span>-04-30,Close,3.73
<span class="token number">2019</span>-05-31,Close,3.48
<span class="token number">2019</span>-07-31,Close,3.73
<span class="token number">2019</span>-09-30,Close,3.70
<span class="token number">2019</span>-10-31,Close,3.77
<span class="token number">2019</span>-12-31,Close,3.98
<span class="token number">2020</span>-03-31,Close,3.57
<span class="token number">2020</span>-04-30,Close,3.80
<span class="token number">2020</span>-06-30,Close,4.06
<span class="token number">2020</span>-06-30,SELL CREATE,4.06
<span class="token number">2020</span>-07-31,SELL EXECUTED, Price: <span class="token number">4.58</span>, Cost: <span class="token number">3.72</span>, Comm <span class="token number">0.00</span>
<span class="token number">2020</span>-07-31,Close,4.62
<span class="token number">2020</span>-08-31,Close,4.74
<span class="token number">2020</span>-09-30,Close,4.51
<span class="token number">2020</span>-11-30,Close,4.89
<span class="token number">2020</span>-12-31,Close,5.14
<span class="token number">2020</span>-12-31,BUY CREATE,5.14
<span class="token number">2021</span>-03-31,BUY EXECUTED, Price: <span class="token number">5.00</span>, Cost: <span class="token number">5.00</span>, Comm <span class="token number">0.01</span>
<span class="token number">2021</span>-03-31,Close,4.97
<span class="token number">2021</span>-04-30,Close,5.05
<span class="token number">2021</span>-05-31,Close,5.26
<span class="token number">2021</span>-06-30,Close,5.17
<span class="token number">2021</span>-06-30,SELL CREATE,5.17
<span class="token number">2021</span>-08-31,SELL EXECUTED, Price: <span class="token number">4.81</span>, Cost: <span class="token number">5.00</span>, Comm <span class="token number">0.00</span>
<span class="token number">2021</span>-08-31,Close,4.80
<span class="token number">2021</span>-09-30,Close,4.86
<span class="token number">2021</span>-11-30,Close,4.84
<span class="token number">2021</span>-12-31,Close,4.93
<span class="token number">2021</span>-12-31,BUY CREATE,4.93
组合期末价值:20001.73
</code></pre> 
<p>不敢相信的夏普比率</p> 
<pre><code class="prism language-bash">Sharpe Ratio: OrderedDict<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'sharperatio'</span>, -557.5313463920106<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fa/57/8F7kKiQ3_o.png" alt="在这里插入图片描述"><br> 回测的买卖图如上。</p> 
<h2><a id="_469"></a>总结</h2> 
<p>对A股的月份效应进行了探索，根据沪深300指数的模拟能够取得十分不错的收益，但是基于ETF基金的回测，则效果十分不理想。</p> 
<p>后续有待改进该思路。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2524f73842690e5e9d9c073673decbde/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">面向C/C&#43;&#43;的json解析和合成的第三方库cJson</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/edb731cbea286f1c3642d591710b271b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Filesystem Hierarchy Standard (FHS)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>