<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>udp检验和计算方法 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="udp检验和计算方法" />
<meta property="og:description" content="一直都没太搞明白UDP/TCP检验和的计算方法，这两天终于琢磨明白了，原来是酱紫滴！
不过计算过程还是非常繁琐的，如果不使用代码实现光靠人工计算估计会让人有点想崩溃滴感觉！（这两天差点没吐血- -!）估计没有几个人能完整的将它计算出来%……￥&amp;……￥
追求真理的道路永远都是曲折的，在这个过程中吐血身亡的人已经不计其数，俺还是顽强的挺过来了，哈哈哈~~
不论如何算是有点小小的收获吧，以下是详细的计算过程：
一、下面的图是一个UDP的检验和所需要用到的所有信息，包括三个部分：
1.UDP伪首部
2.UDP首部
3.UDP的数据部分（切记不要遗漏该部分，否则就~吐血了~）
首先解释下伪首部的概念，伪首部包含IP首部一些字段。其目的是让UDP两次检查数据是否已经正确到达目的地，只是单纯为了做校验用的。
还有一个概念十分重要，那就是16位UDP总长度，请注意该长度不是报文的总长度，而只是UDP（包括UDP头和数据部分）的总长度（之前就是因为这个概念没弄清楚，走了不少弯路，吐血~~）。
二、计算检验和（checksum）的过程很关键，主要分为以下几个步骤：
1.把伪首部添加到UDP上；
2.计算初始时是需要将检验和字段添零的；
3.把所有位划分为16位（2字节）的字
4.把所有16位的字相加，如果遇到进位，则将高于16字节的进位部分的值加到最低位上，举例，0xBB5E&#43;0xFCED=0x1 B84B，则将1放到最低位，得到结果是0xB84C
5.将所有字相加得到的结果应该为一个16位的数，将该数取反则可以得到检验和checksum。
三、狮屎胜于雄辩，还是举个例子来分析一下吧，该例子计算的是一个TCP的检验和（和UDP的算法一致）
TCP计算检验和的报文结构如下所示：
抓包工具抓了一个TCP 的syn报文做研究，呵呵，下面就是整个报文：
1.首先将检验和部分添零；
2.然后将TCP伪首部部分，TCP首部部分，数据部分都划分成16位的一个个16进制数；
3.将这些数逐个相加，记得溢出的部分加到最低位上，这是循环加法：
0xc0a8&#43; 0x0166&#43;……&#43;0x0402=0x9b49
4.最后将得到的结果取反，则可以得到检验和位0x64B6
按照上述步骤进行计算就可以得到检验和为0x64B6，大家也可以试试看哦~" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/0217f108d7b4ee6593fc068c51232a98/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-05-03T15:19:31+08:00" />
<meta property="article:modified_time" content="2014-05-03T15:19:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">udp检验和计算方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 一直都没太搞明白UDP/TCP检验和的计算方法，这两天终于琢磨明白了，原来是酱紫滴！</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 不过计算过程还是非常繁琐的，如果不使用代码实现光靠人工计算估计会让人有点想崩溃滴感觉！（这两天差点没吐血- -!）估计没有几个人能完整的将它计算出来%……￥&amp;……￥</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 追求真理的道路永远都是曲折的，在这个过程中吐血身亡的人已经不计其数，俺还是顽强的挺过来了，哈哈哈~~</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 不论如何算是有点小小的收获吧，以下是详细的计算过程：</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 一、下面的图是一个UDP的检验和所需要用到的所有信息，包括三个部分：</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> <strong>1.UDP伪首部</strong></p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> <strong>2.UDP首部</strong></p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> <strong>3.UDP的数据部分</strong>（切记不要遗漏该部分，否则就~吐血了~）</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> <img src="https://images2.imgbox.com/3f/c9/9CWgxUGi_o.jpg" height="301" width="533" alt="" style="border:0px; margin-bottom:8px; clear:both; max-width:758px; vertical-align:top"></p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px">  </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> <span style="color:rgb(69,69,69)">首先解释下伪首部的概念，<strong>伪首部包含IP首部一些字段</strong>。</span><span style="color:#ff0000">其目的是让UDP两次检查数据是否已经正确到达目的地，只是单纯为了做校验用的</span><span style="color:#454545">。</span></p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 还有一个概念十分重要，那就是16位UDP总长度，请注意该长度不是报文的总长度，而只是UDP（包括UDP头和数据部分）的总长度（之前就是因为这个概念没弄清楚，走了不少弯路，吐血~~）。</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px">  </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 二、计算检验和（checksum）的过程很关键，主要分为以下几个步骤：</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 1.把伪首部添加到UDP上；</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> <strong>2.计算初始时是需要将检验和字段添零的；</strong></p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 3.把所有位划分为16位（2字节）的字</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 4.<strong>把所有16位的字相加，如果遇到进位，则将高于16字节的进位部分的值加到最低位上</strong>，举例，0xBB5E+0xFCED=0x1 B84B，则将1放到最低位，得到结果是0xB84C</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> <span style="color:#ff0000">5.将所有字相加得到的结果应该为一个16位的数，将该数取反则可以得到检验和checksum。</span></p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px">  </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 三、狮屎胜于雄辩，还是举个例子来分析一下吧，该例子计算的是一个TCP的检验和（和UDP的算法一致）</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> TCP计算检验和的报文结构如下所示：</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> <img src="https://images2.imgbox.com/a2/bb/m8bE4IGL_o.jpg" height="267" width="580" alt="" style="border:0px; margin-bottom:8px; clear:both; max-width:758px; vertical-align:top"></p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px">  </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 抓包工具抓了一个TCP 的syn报文做研究，呵呵，下面就是整个报文：</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> <img src="https://images2.imgbox.com/b8/63/THiSwMQw_o.jpg" height="361" width="580" alt="" style="border:0px; margin-bottom:8px; clear:both; max-width:758px; vertical-align:top"></p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px">  </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 1.首先将检验和部分添零；</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 2.然后将TCP伪首部部分，TCP首部部分，数据部分都划分成16位的一个个16进制数；</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 3.将这些数逐个相加，记得溢出的部分加到最低位上，这是循环加法：</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px">         0xc0a8+ 0x0166+……+0x0402=0x9b49</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 4.最后将得到的结果取反，则可以得到检验和位0x64B6</p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(69,69,69); font-family:tahoma,helvetica,arial; font-size:14px; line-height:21px"> 按照上述步骤进行计算就可以得到检验和为0x64B6，大家也可以试试看哦~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c34b6253a69692d503d92d88dff59249/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">三层架构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/133661ed2b25167dbcc215b67a4d1f4d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">rand()和RAND_MAX</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>