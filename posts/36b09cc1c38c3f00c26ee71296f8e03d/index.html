<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>onlyoffice aarch64编译 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="onlyoffice aarch64编译" />
<meta property="og:description" content="OnlyOffice ARM64编译 编译环境 1、系统环境
银河麒麟v10 sp1.要确保libc.so.6的版本大于等于2.29；可以执行以下命令查看：
Cd /lib/aarch64-linux-gnu
ls -l libc.*
可以去麒麟系统的官网下载该系统：https://www.kylinos.cn/support/trial.html?trial=5540。这里要选择自己对应的cpu，像本机就是飞腾。
也可以用镜像：leechm/kylin:v10-desktop-20210820.GFB。
镜像需要换源：vi /etc/apt/sources.list
deb http://archive.kylinos.cn/kylin/KYLIN-ALL 10.1 main universe multiverse restricted
deb http://archive2.kylinos.cn/deb/kylin/production/PART-V10-SP1/custom/partner/V10-SP1 default all
删掉etc/apt/sources.list.d下面的文件夹。
2、编译要求
CPU dual core 2 GHz or better
RAM 2 GB or more
HDD at least 40 GB of free space
Additional requirements at least 4 GB of swap
实际操作中，空闲盘符的大小至少是80G。建议至少选用256G硬盘，且初始化系统时分盘符，不用给系统多大，尽量给个人的空间150G。
3、操作要求
使用时，不要直接执行sudo apt-get update;sudo apt-get install;这一类的全局更新安装的命令，可能会导致apt冲突，然后无法执行任何apt命令。也尽量避免安装过的再跟新安装。Python一般都有，这里再安装一个git就行了
Sudo apt-get install git ;
代理 安装代理 略。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/36b09cc1c38c3f00c26ee71296f8e03d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-23T16:16:53+08:00" />
<meta property="article:modified_time" content="2021-11-23T16:16:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">onlyoffice aarch64编译</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="text-align:center;"><strong>OnlyOffice  ARM64编译</strong></h2> 
<ul><li style="text-align:left;"><strong><strong><strong>编译环境</strong></strong></strong></li></ul> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>1、系统环境</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">银河麒麟v10 sp1.要确保libc.so.6的版本大于等于2.29；可以执行以下命令查看：</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">Cd /lib/aarch64-linux-gnu</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">ls -l libc.*</span></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">可以去麒麟系统的官网下载该系统：https://www.kylinos.cn/support/trial.html?trial=5540。这里要选择自己对应的cpu，像本机就是飞腾。</p> 
<p style="margin-left:.0001pt;text-align:left;">也可以用镜像：leechm/kylin:v10-desktop-20210820.GFB。</p> 
<p style="margin-left:.0001pt;text-align:left;">镜像需要换源：vi /etc/apt/sources.list</p> 
<p style="margin-left:.0001pt;text-align:left;">deb http://archive.kylinos.cn/kylin/KYLIN-ALL 10.1 main universe multiverse restricted</p> 
<p style="margin-left:.0001pt;text-align:left;">deb http://archive2.kylinos.cn/deb/kylin/production/PART-V10-SP1/custom/partner/V10-SP1 default all</p> 
<p style="margin-left:.0001pt;text-align:left;">删掉etc/apt/sources.list.d下面的文件夹。</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>2、</strong></strong><strong><strong>编译要求</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">CPU dual core 2 GHz or better</p> 
<p style="margin-left:.0001pt;text-align:left;">RAM 2 GB or more</p> 
<p style="margin-left:.0001pt;text-align:left;">HDD at least 40 GB of free space</p> 
<p style="margin-left:.0001pt;text-align:left;">Additional requirements at least 4 GB of swap</p> 
<p style="margin-left:.0001pt;text-align:left;">实际操作中，空闲盘符的大小至少是80G。建议至少选用256G硬盘，且初始化系统时分盘符，不用给系统多大，尽量给个人的空间150G。</p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>3、</strong></strong><strong><strong>操作要求</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">使用时，不要直接执行<span style="background-color:#00ff00;">sudo apt-get update;sudo apt-get install</span>;这一类的全局更新安装的命令，可能会导致apt冲突，然后无法执行任何apt命令。也尽量避免安装过的再跟新安装。Python一般都有，这里再安装一个git就行了</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">Sudo apt-get install git ;</span></p> 
<ul><li style="text-align:left;"><strong><strong>代理</strong></strong></li></ul> 
<ol><li style="text-align:left;"><strong><strong>安装代理</strong></strong></li></ol> 
<p style="margin-left:.0001pt;text-align:left;">略。</p> 
<ol><li style="text-align:left;"><strong><strong>设置代理</strong></strong></li></ol> 
<p style="margin-left:.0001pt;text-align:left;">①在设置中选择网络--代理--手动设置代理。</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">②设置git代理（普通用户也设置，不然检出个别代码有问题）：</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">sudo git config --global http.proxy </span><u><span style="background-color:#00ff00;"><span style="color:#0000ff;"><u>http://127.0.0.1:7890</u></span></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">sudo git config --global https.proxy </span><u><span style="background-color:#00ff00;"><span style="color:#0000ff;"><u>https://127.0.0.1:7890</u></span></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">git config --global http.proxy </span><u><span style="background-color:#00ff00;"><span style="color:#0000ff;"><u>http://127.0.0.1:7890</u></span></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">git config --global https.proxy </span><a href="https://127.0.0.1:7890" rel="nofollow" title="https://127.0.0.1:7890">https://127.0.0.1:7890</a></p> 
<p style="margin-left:.0001pt;text-align:left;">③设置全局代理(curl也是用这个的)</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">sudo export http_proxy=</span><u><span style="background-color:#00ff00;"><span style="color:#0000ff;"><u>http://127.0.0.1:7890</u></span></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">sudo export https_proxy=</span><u><span style="background-color:#00ff00;"><span style="color:#0000ff;"><u>http://127.0.0.1:7890</u></span></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">export http_proxy=</span><u><span style="background-color:#00ff00;"><span style="color:#0000ff;"><u>http://127.0.0.1:7890</u></span></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">export https_proxy=</span><u><span style="background-color:#00ff00;"><span style="color:#0000ff;"><u>http://127.0.0.1:7890</u></span></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">Export </span><span style="background-color:#00ff00;">ALL_PROXY=socks://127.0.0.1:7891</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">Export all_proxy</span><span style="background-color:#00ff00;">=socks://127.0.0.1:7891</span></p> 
<p style="margin-left:.0001pt;text-align:left;">取消git代理：</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">git config --global --unset http.proxy</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">git config --global --unset https.proxy</span></p> 
<p style="margin-left:.0001pt;text-align:left;">查看git代理：</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">git config --global --get http.proxy</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">git config --global --get https.proxy</span></p> 
<p style="margin-left:.0001pt;text-align:left;">如果curl不能访问的话，请参考这里再设置一下：</p> 
<p style="margin-left:.0001pt;text-align:left;"><u><span style="color:#0000ff;"><u>https://www.coder.work/article/4020694</u></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;"><u><span style="color:#0000ff;"><u>https://www.cnblogs.com/panxuejun/p/10574038.html</u></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;">     <span style="background-color:#00ff00;">curl --proxy "http://user:pwd@1.0.0.1:8090" "http://httpbin.org/ip"</span></p> 
<ul><li style="text-align:left;"><strong><strong>编译工具</strong></strong>(参考：</li></ul> 
<p style="margin-left:.0001pt;text-align:left;">https://helpcenter.onlyoffice.com/installation/docs-community-compile.aspx)</p> 
<p style="margin-left:.0001pt;text-align:left;">创建空文件夹，例如</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#00ff00;">mkdir /hom/allbuild ;</span></p> 
<p style="margin-left:.0001pt;text-align:left;">检出onlyoffice的编译工具</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#f4f4f4;"><span style="color:#333333;">git clone </span></span><a href="https://github.com/ONLYOFFICE/build_tools.git" title="https://github.com/ONLYOFFICE/build_tools.git">https://github.com/ONLYOFFICE/build_tools.git</a></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#f4f4f4;"><span style="color:#333333;">cd build_tools/tools/linux</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#f4f4f4;"><span style="color:#333333;">vi </span></span><span style="background-color:#f4f4f4;"><span style="color:#333333;">./automate.py</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">修改注释几个已经安装的软件，比如cmake，要注释掉；</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">export DEPOT_TOOLS_UPDATE=0；这个是v8编译用的，待会会用到。</p> 
<p style="margin-left:.0001pt;text-align:left;">然后执行./automate.py server。</p> 
<p style="margin-left:.0001pt;text-align:left;">执行完成后，会有deploy.py里面的报错，说复制的文件夹不存在和删除的文件夹不存在，不用管他，去build_tools文件夹的同级目录下会有一个out文件夹。这就是我们的输出文件。然后按照本节大标题中的网址继续操作即可（https://helpcenter.onlyoffice.com/installation/docs-community-compile.aspx）；</p> 
<ul><li style="text-align:left;"><strong><strong>问题及解决</strong></strong></li></ul> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>1、</strong></strong><strong><strong>dpkg: 清理时出错:</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong> 已安装 cmake-data 软件包 post-installation 脚本 子进程返回错误状态 255</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">sudo mv /var/lib/dpkg/info /var/lib/dpkg/info_old</p> 
<p style="margin-left:.0001pt;text-align:left;">sudo mkdir /var/lib/dpkg/info</p> 
<p style="margin-left:.0001pt;text-align:left;">sudo apt-get update</p> 
<p style="margin-left:.0001pt;text-align:left;">sudo apt-get -f install</p> 
<p style="margin-left:.0001pt;text-align:left;">sudo mv /var/lib/dpkg/info/* /var/lib/dpkg/info_old</p> 
<p style="margin-left:.0001pt;text-align:left;">sudo rm -rf /var/lib/dpkg/info</p> 
<p style="margin-left:.0001pt;text-align:left;">sudo mv /var/lib/dpkg/info_old /var/lib/dpkg/info</p> 
<p style="margin-left:.0001pt;text-align:left;">解决：重装系统，在automate.py里面不要install  cmake等常见的软件。</p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>2</strong></strong><strong><strong>、Error: Command 'vpython v8/build/linux/sysroot_scripts/install-sysroot.py --running-as-hook' returned non-zero exit status 1 in /home/dai/allbuild/core/Common/3dParty/v8</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">Unrecognized host arch: aarch64</p> 
<p style="margin-left:.0001pt;text-align:left;">修改v8.py，注释掉clean，然后修改deps文件的235、236行：参考依据是：<u><span style="color:#0000ff;"><u>https://bbs.huaweicloud.com/blogs/detail/148360</u></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">同时注释掉这部分：</p> 
<p style="margin-left:.0001pt;text-align:left;"> #{<!-- --><br>   #  "name": "gn_linux",<br>   #  "pattern": ".",<br>   #  "action": [ "download_from_google_storage",<br>   #              "--no_resume",<br>   #              "--platform=linux*",<br>   #              "--no_auth",<br>   #              "--bucket", "chromium-gn",<br>   #              "-s", "v8/buildtools/linux64/gn.sha1",<br>   #  ],<br>   #},</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">这是为了防止后面手动cp的gn文件被替换。</p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>3、</strong></strong><strong><strong>OSError: [Errno 8] 可执行文件格式错误: '/home/dai/allbuild/core/Common/3dParty/v8/v8/buildtools/linux64/gn'</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>Error (gn): 1</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">解决：下载编译ninja和gn。参考依据（<u><span style="color:#0000ff;"><u>https://v8.dev/docs/compile-arm64</u></span></u>）</p> 
<p style="margin-left:.0001pt;text-align:left;">mkdir /home/ninja ;</p> 
<p style="margin-left:.0001pt;text-align:left;">cd ninja ;</p> 
<p style="margin-left:.0001pt;text-align:left;">git clone <u><span style="color:#0000ff;"><u>https://github.com/ninja-build/ninja.git</u></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;">Apt-get install re2c</p> 
<p style="margin-left:.0001pt;text-align:left;">./configure.py --bootstrap</p> 
<p style="margin-left:.0001pt;text-align:left;">export PATH=/home/dai/ninja:$PATH</p> 
<p style="margin-left:.0001pt;text-align:left;">sudo cp /home/ninja/ninja   \ /home/allbuild/core/Common/3dParty/v8/depot_tools/ninja-linux-aarch64</p> 
<p style="margin-left:.0001pt;text-align:left;">Vi /home/allbuild/core/Common/3dParty/v8/depot_tools/ninja</p> 
<p style="margin-left:.0001pt;text-align:left;">修改如下（31~21行）：</p> 
<p style="margin-left:.0001pt;text-align:left;">加一个case</p> 
<p style="margin-left:.0001pt;text-align:left;">aarch64)</p> 
<p style="margin-left:.0001pt;text-align:left;">        exec "${THIS_DIR}/ninja-linux-aarch64" "$@";;</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">编译gn：</p> 
<p style="margin-left:.0001pt;text-align:left;">不要用最新版gn，会报错：</p> 
<p style="margin-left:.0001pt;text-align:left;">ERROR at //build/config/BUILDCONFIG.gn:495:1: Unknown function.</p> 
<p style="margin-left:.0001pt;text-align:left;">set_sources_assignment_filter(sources_assignment_filter).因为这个函数随着gn的更新，已经在2020年废弃了。</p> 
<p style="margin-left:.0001pt;text-align:left;">去github找一个至少2年前的。</p> 
<p style="margin-left:.0001pt;text-align:left;">git clone  <u><span style="color:#0000ff;"><u>https://github.com/wangzq0807/gn.git</u></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;">cd gn</p> 
<p style="margin-left:.0001pt;text-align:left;">Sudo apt-get install clang；</p> 
<p style="margin-left:.0001pt;text-align:left;">python build/gen.py</p> 
<p style="margin-left:.0001pt;text-align:left;">ninja -C out</p> 
<p style="margin-left:.0001pt;text-align:left;">如果这一步有问题，比如clang++找不到，可以vi build/gen.py 将clang++全部替换成g++</p> 
<p style="margin-left:.0001pt;text-align:left;">sudo cp ./gn /home/allbuild/core/Common/3dParty/v8/v8/buildtools/linux64/</p> 
<p style="margin-left:.0001pt;text-align:left;">修改/home/build_tools/scripts/core_common/modules/v8.py如下：</p> 
<p style="margin-left:.0001pt;text-align:left;">os.chdir("v8")</p> 
<p style="margin-left:.0001pt;text-align:left;">  print("target_cpu changed ...")</p> 
<p style="margin-left:.0001pt;text-align:left;">  base_args64 = "target_cpu=\\\"arm64\\\" v8_target_cpu=\\\"arm64\\\" v8_static_library=true is_component_build=false v8_use_snapshot=false"</p> 
<p style="margin-left:.0001pt;text-align:left;">  base_args32 = "target_cpu=\\\"x86\\\" v8_target_cpu=\\\"x86\\\" v8_static_library=true is_component_build=false v8_use_snapshot=false"</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">  if config.check_option("platform", "linux_64"):</p> 
<p style="margin-left:.0001pt;text-align:left;">    base.cmd2("gn", ["gen", "out.gn/linux_64", "--args=\"is_debug=false " + base_args64 + " is_clang=" + "true "+" clang_base_path=\\\"/usr/\\\" "+" treat_warnings_as_errors=false " +"clang_use_chrome_plugins=false" + " use_sysroot=false treat_warnings_as_errors=false\""])</p> 
<p style="margin-left:.0001pt;text-align:left;">base.cmd("ninja", ["-C", "out.gn/linux_64","-j","8"])</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>4、</strong></strong><strong><strong>ERROR: Sub-project qmake file '/home/dai/allbuild/build_tools/../desktop-sdk/ChromiumBasedEditors/videoplayerlib/videoplayerlib.pro' is not exists.</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">修改build_tools的build.pro第15行：</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">注释掉。</p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>5、</strong></strong><strong><strong>Warning: Error: /home/allbuild/web-apps/build/node_modules/optipng-bin/vendor/optipng: 1: @@8�@@@@@@@�@@@@����: not found</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">重新编译optipng</p> 
<p style="margin-left:.0001pt;text-align:left;">下载：<u><span style="color:#0000ff;"><u>https://sourceforge.net/projects/optipng/</u></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;">./configure --prefix=/opt/runtime/opting </p> 
<p style="margin-left:.0001pt;text-align:left;">make</p> 
<p style="margin-left:.0001pt;text-align:left;">报错如下：</p> 
<p style="margin-left:.0001pt;text-align:left;"><u><span style="color:#0000ff;"><u>https://sourceforge.net/p/libpng/bugs/230/</u></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;">修改</p> 
<p style="margin-left:.0001pt;text-align:left;">${HOME}/opencv-3.3.1/3rdparty/libpng/pngpriv.h</p> 
<p style="margin-left:.0001pt;text-align:left;"> 128 /*#  if (defined(__ARM_NEON__) || defined(__ARM_NEON)) &amp;&amp; \*/</p> 
<p style="margin-left:.0001pt;text-align:left;"> 129 #   if defined(PNG_ARM_NEON) &amp;&amp; (defined(__ARM_NEON__) || defined(__ARM_NEON)) &amp;&amp; \</p> 
<p style="margin-left:.0001pt;text-align:left;">然后make clean 然后make。然后cp到该目录即可。</p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>6、</strong></strong><strong><strong>WARN @apideck/better-ajv-errors@0.2.7 requires a peer of ajv@&gt;=8 but none is installed. You must install peer dependencies yourself.</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">npm install ajv。没解决</p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>7、</strong></strong><strong><strong>SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.13: wanted {"os":"darwin","arch":"any"} (current: {"os":"linux","arch":"arm64"})</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">npm install copy-webpack-plugin --save dev。没解决</p> 
<p style="margin-left:.0001pt;text-align:left;"><strong><strong>8、</strong></strong><strong><strong>"/var/run/postgresql/.s.PGSQL.5432"上准备接受联接?</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">export LD_LIBRARY_PATH=/usr/lib/postgresql/12/lib</p> 
<p style="margin-left:.0001pt;text-align:left;">sudo service postgresql start</p> 
<p style="margin-left:.0001pt;text-align:left;">这里，新安装时会出现如下内容：</p> 
<p style="margin-left:.0001pt;text-align:left;">重新安装postgresql后出现：</p> 
<p style="margin-left:.0001pt;text-align:left;">/usr/lib/postgresql/12/bin/initdb -D /var/lib/postgresql/12/main --auth-local peer --auth-host md5</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffff00;">  成功。您现在可以用下面的命令开启数据库服务器：</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffff00;">    pg_ctlcluster 12 main start</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffff00;">Ver Cluster Port Status Owner    Data directory              Log file</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffff00;">12  main    5432 down   postgres /var/lib/postgresql/12/main /var/log/postgresql/postgresql-12-main.log</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffff00;">如果有错误日志写的很明白，说时key的权限不对，这里应该降低它的权限，按照报错的提示赋予他只读权限即可。</span></p> 
<p style="margin-left:.0001pt;text-align:left;">权限命令理解参考：<u><span style="color:#0000ff;"><u>https://www.cnblogs.com/koudaiyoutang/p/12168028.html</u></span></u></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<ul><li style="text-align:left;"><strong><strong>部署</strong></strong></li></ul> 
<p style="margin-left:.0001pt;text-align:left;">将build_tools/out/linux_64/onlyoffice文件夹，放到/var/www/下面即可完成部署。</p> 
<p style="margin-left:.0001pt;text-align:left;">然后重新执行Generate fonts data中的步骤，注意父目录不应该时out了，应该是/var/www/onlyoffice/documentserver/</p> 
<p style="margin-left:.0001pt;text-align:left;">如果部署在docker，参考启动脚本如下：</p> 
<p style="margin-left:.0001pt;text-align:left;">=====start.sh====</p> 
<p style="margin-left:.0001pt;text-align:left;">#!/bin/bash</p> 
<p style="margin-left:.0001pt;text-align:left;">echo nginx      start...</p> 
<p style="margin-left:.0001pt;text-align:left;">sudo service nginx start</p> 
<p style="margin-left:.0001pt;text-align:left;">echo postgresql start...</p> 
<p style="margin-left:.0001pt;text-align:left;">service postgresql start</p> 
<p style="margin-left:.0001pt;text-align:left;">echo rabbitmq   start...</p> 
<p style="margin-left:.0001pt;text-align:left;">service rabbitmq-server start</p> 
<p style="margin-left:.0001pt;text-align:left;">echo converter  start...</p> 
<p style="margin-left:.0001pt;text-align:left;">cd /var/www/onlyoffice/documentserver/server/FileConverter/</p> 
<p style="margin-left:.0001pt;text-align:left;">LD_LIBRARY_PATH=bin NODE_ENV=development-linux NODE_CONFIG_DIR=../Common/config ./converter &gt; dai-con.log &amp;</p> 
<p style="margin-left:.0001pt;text-align:left;">echo docservice start...</p> 
<p style="margin-left:.0001pt;text-align:left;">cd /var/www/onlyoffice/documentserver/server/DocService/</p> 
<p style="margin-left:.0001pt;text-align:left;">NODE_ENV=development-linux NODE_CONFIG_DIR=../Common/config ./docservice &gt; dai-doc.log &amp;</p> 
<p style="margin-left:.0001pt;text-align:left;">echo all start end...</p> 
<ul><li style="text-align:left;"><strong><strong>测试验证</strong></strong></li></ul> 
<p style="margin-left:.0001pt;text-align:left;">访问http://你的地址:80/welcome，出现正确页面即可。</p> 
<p style="margin-left:.0001pt;text-align:left;">结束语：感谢文章中出现的链接，或是启发，或是直接解决了问题，感谢！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b6b186fe0223e7a7f9652bd2d2c87bfd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ANR原理分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4fc7ccb91a39614bf9f2b0d03ab440d7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux——问题汇总记录</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>