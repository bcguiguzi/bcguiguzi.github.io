<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Retrofit2讲解 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Retrofit2讲解" />
<meta property="og:description" content="Retrofit2学习 前言：一. 概述：二：注解1. 请求方法注解2. 请求头注解3.请求参数注解4.请求和响应格式(标记)注解 三：注解详解1. @GET、@Query、@QueryMap的使用2.@POST、@FormUrlEncoded、@File、@FileMap、@Body的使用3.@Path4.@HTTP5.@Url6.@Streaming7.@Multipart、@part、@PartMap8. 有关MediaType方法 四：实例讲解实例4.1(演示GET请求)实例4.2（演示POST请求） 前言： 本文使用的网络请求API:
get请求：“https://devapi.qweather.com/v7/weather/now?location=101010100&amp;key=a5cf6ab782a14013b08fb92a57dd2f72”
此为和风天气的一个接口， 直接用浏览器登录查看返回json数据。
post请求：https://v2.alapi.cn/api/dog
此为ALAPI网站提供学者练习使用的一个API
一. 概述： 注意：
准却来说Retrofit是一个RESTful的HTTP网络请求的封装原因：网络请求的工作本质上是Okhttp完成，而Retrofit仅负责网络请求接口的封装 App应用程序通过 Retrofit 请求网络，实际上是使用 Retrofit 接口层封装请求参数、Header、Url 等信息，之后由 OkHttp 完成后续的请求操作在服务端返回数据之后，OkHttp 将原始的结果交给 Retrofit，Retrofit根据用户的需求对结果进行解析 Retrofit的优点：
超级解耦 ，接口定义、接口参数、接口回调不在耦合在一起可以配置不同的httpClient来实现网络请求，如okhttp、httpclient支持同步、异步、Rxjava可以配置不同反序列化工具类来解析不同的数据，如json、xml请求速度快，使用方便灵活简洁 二：注解 Retrofit使用大量注解来简化请求，Retrofit将okhttp请求抽象成java接口，使用注解来配置和描述网络请求参数。大概可以分为以下几类，我们先来看看各个注解的含义，再一一去实践解释。
1. 请求方法注解 请求方法注解说明@GETget请求@POSTpost请求@PUTput请求@DELETEdelete请求@PATCHpatch请求，该请求是对put请求的补充，用于更新局部资源@HEADhead请求@OPTIONSoptions请求@HTTP通过注解，可以替换以上所有的注解，它拥有三个属性：method、path、hasBody 2. 请求头注解 请求头注解说明@Headers用于添加固定请求头，可以同时添加多个，通过该注解的请求头不会相互覆盖，而是共同存在@Header作为方法的参数传入，用于添加不固定的header，它会更新已有请求头 3.请求参数注解 请求参数注解说明@Body多用于Post请求发送非表单数据，根据转换方式将实例对象转化为对应字符串传递参数，比如使用Post发送Json数据，添加GsonConverterFactory则是将body转化为json字符串进行传递@Filed多用于Post方式传递参数，需要结合@FromUrlEncoded使用，即以表单的形式传递参数@FiledMap多用于Post请求中的表单字段，需要结合@FromUrlEncoded使用（当存在多个表单时使用此注解，减少方法中参数的个数）@Part用于表单字段，Part和PartMap与@multipart注解结合使用，适合文件上传的情况@Query用于Get请求中的参数@PartMap用于表单字段，默认接受类型是Map&lt;String,RequestBody&gt;，可用于实现多文件上传@Path用于Url中的占位符@QueryMap与Query类似，用于不确定表单参数 4.请求和响应格式(标记)注解 解释：此注解添加至方法前声明此请求有发送表单，上传文件或下载大文件等动作。
标记类注解说明@FromUrlCoded表示请求发送编码表单数据，每个键值对需要使用@Filed注解@Multipart表示请求发送form_encoded数据(使用于有文件上传的场景)，每个键值对需要用@Part来注解键名，随后的对象需要提供值@Streaming表示响应用字节流的形式返回，如果没有使用注解，默认会把数据全部载入到内存中，该注解在下载大文件时特别有用 三：注解详解 概述：我们先来解释注解的使用和需要注意的问题(具体的使用步骤后面会给出)。上面提到注解是用来配置和描述网络请求参数的，我们来逐个讲解一下，首先创建网络接口类：
Retrofit将okhttp请求抽象成java接口，采用注解描述和配置网络请求参数，用动态代理将该接口的注解“翻译”成一个Http请求，最后执行Http请求。注意：接口中的每个方法的参数都要用注解标记，否则会报错。 简单来说，我们需要先创建一个用于网络请求的接口，通过为接口中定义的请求方法添加不同的注解实现不同的网络请求功能。
如：创建网络请求接口ApiService
public interface ApiService { } 1. @GET、@Query、@QueryMap的使用 此get请求使用前言中的get请求网址
无参的get请求 public interface ApiService { @GET(&#34;https://devapi.qweather.com/v7/weather/now?location=101010100&amp;key=a5cf6ab782a14013b08fb92a57dd2f72&#34;) Call&lt;*&gt; getCall(); } @GET 请求方法注解，get请求，括号内的是请求地址，Url的一部分Call&lt;*&gt; 返回类型，*表示接收数据的类，一般自定义,下文展示本接口接受数据类型的类getCall() 接口方法名称，括号内可以写入参数 此为网络接口最简单的一种形式，这是一个没有网络参数的get请求方式，需要在方法头部添加@GET注解，表示采用get方法访问网络请求，括号内的是请求的地址(Url的一部分，也可以是完整的Url，如上文) ，其中返回类型是Call&lt;*&gt;，*表示接收数据的类，如果想直接获取ResponseBody中的内容，可以定义网络请求返回值为Call，ResponseBody是请求网络后返回的原始数据，如果网络请求没有参数，不用写。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/3a130bcfdaa119558875367977c1d960/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-07T22:18:32+08:00" />
<meta property="article:modified_time" content="2021-12-07T22:18:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Retrofit2讲解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Retrofit2学习</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">前言：</a></li><li><a href="#__13" rel="nofollow">一. 概述：</a></li><li><a href="#_34" rel="nofollow">二：注解</a></li><li><ul><li><ul><li><a href="#1__38" rel="nofollow">1. 请求方法注解</a></li><li><a href="#2__51" rel="nofollow">2. 请求头注解</a></li><li><a href="#3_58" rel="nofollow">3.请求参数注解</a></li><li><a href="#4_71" rel="nofollow">4.请求和响应格式(标记)注解</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_81" rel="nofollow">三：注解详解</a></li><li><ul><li><ul><li><a href="#1_GETQueryQueryMap_98" rel="nofollow">1. @GET、@Query、@QueryMap的使用</a></li><li><a href="#2POSTFormUrlEncodedFileFileMapBody_165" rel="nofollow">2.@POST、@FormUrlEncoded、@File、@FileMap、@Body的使用</a></li><li><a href="#3Path_236" rel="nofollow">3.@Path</a></li><li><a href="#4HTTP_261" rel="nofollow">4.@HTTP</a></li><li><a href="#5Url_288" rel="nofollow">5.@Url</a></li><li><a href="#6Streaming_313" rel="nofollow">6.@Streaming</a></li><li><a href="#7MultipartpartPartMap_323" rel="nofollow">7.@Multipart、@part、@PartMap</a></li><li><a href="#8_MediaType_399" rel="nofollow">8. 有关MediaType方法</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_427" rel="nofollow">四：实例讲解</a></li><li><ul><li><ul><li><a href="#41GET_439" rel="nofollow">实例4.1(演示GET请求)</a></li><li><a href="#42POST_697" rel="nofollow">实例4.2（演示POST请求）</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>前言：</h3> 
<p>本文使用的网络请求API:</p> 
<p>get请求：“https://devapi.qweather.com/v7/weather/now?location=101010100&amp;key=a5cf6ab782a14013b08fb92a57dd2f72”</p> 
<p>此为和风天气的一个接口， 直接用浏览器登录查看返回json数据。</p> 
<p>post请求：https://v2.alapi.cn/api/dog</p> 
<p>此为<a href="https://www.alapi.cn/" rel="nofollow">ALAPI网站</a>提供学者练习使用的一个API</p> 
<h3><a id="__13"></a>一. 概述：</h3> 
<p><img src="https://images2.imgbox.com/04/76/DD7QAdyY_o.png" alt="在这里插入图片描述"><br> <strong>注意：</strong></p> 
<ul><li>准却来说Retrofit是一个RESTful的HTTP网络请求的封装</li><li>原因：网络请求的工作本质上是Okhttp完成，而Retrofit仅负责网络请求接口的封装</li></ul> 
<p><img src="https://images2.imgbox.com/89/be/jPUdGq1i_o.png" alt="在这里插入图片描述"></p> 
<ul><li>App应用程序通过 Retrofit 请求网络，实际上是使用 Retrofit 接口层封装请求参数、Header、Url 等信息，之后由 OkHttp 完成后续的请求操作</li><li>在服务端返回数据之后，OkHttp 将原始的结果交给 Retrofit，Retrofit根据用户的需求对结果进行解析</li></ul> 
<p><strong>Retrofit的优点：</strong></p> 
<blockquote> 
 <ul><li>超级解耦 ，接口定义、接口参数、接口回调不在耦合在一起</li><li>可以配置不同的httpClient来实现网络请求，如okhttp、httpclient</li><li>支持同步、异步、Rxjava</li><li>可以配置不同反序列化工具类来解析不同的数据，如json、xml</li><li>请求速度快，使用方便灵活简洁</li></ul> 
</blockquote> 
<h3><a id="_34"></a>二：注解</h3> 
<p>Retrofit使用大量注解来简化请求，Retrofit将okhttp请求抽象成java接口，使用注解来配置和描述网络请求参数。大概可以分为以下几类，我们先来看看各个注解的含义，再一一去实践解释。</p> 
<h5><a id="1__38"></a>1. 请求方法注解</h5> 
<table><thead><tr><th>请求方法注解</th><th>说明</th></tr></thead><tbody><tr><td>@GET</td><td>get请求</td></tr><tr><td>@POST</td><td>post请求</td></tr><tr><td>@PUT</td><td>put请求</td></tr><tr><td>@DELETE</td><td>delete请求</td></tr><tr><td>@PATCH</td><td>patch请求，该请求是对put请求的补充，用于更新局部资源</td></tr><tr><td>@HEAD</td><td>head请求</td></tr><tr><td>@OPTIONS</td><td>options请求</td></tr><tr><td>@HTTP</td><td>通过注解，可以替换以上所有的注解，它拥有三个属性：method、path、hasBody</td></tr></tbody></table> 
<h5><a id="2__51"></a>2. 请求头注解</h5> 
<table><thead><tr><th><strong>请求头注解</strong></th><th>说明</th></tr></thead><tbody><tr><td>@Headers</td><td>用于添加固定请求头，可以同时添加多个，通过该注解的请求头不会相互覆盖，而是共同存在</td></tr><tr><td>@Header</td><td>作为方法的参数传入，用于添加不固定的header，它会更新已有请求头</td></tr></tbody></table> 
<h5><a id="3_58"></a>3.请求参数注解</h5> 
<table><thead><tr><th><strong>请求参数注解</strong></th><th align="left"><strong>说明</strong></th></tr></thead><tbody><tr><td>@Body</td><td align="left">多用于Post请求发送非表单数据，根据转换方式将实例对象转化为对应字符串传递参数，比如使用Post发送Json数据，添加GsonConverterFactory则是将body转化为json字符串进行传递</td></tr><tr><td>@Filed</td><td align="left">多用于Post方式传递参数，需要结合@FromUrlEncoded使用，即以表单的形式传递参数</td></tr><tr><td>@FiledMap</td><td align="left">多用于Post请求中的表单字段，需要结合@FromUrlEncoded使用（当存在多个表单时使用此注解，减少方法中参数的个数）</td></tr><tr><td>@Part</td><td align="left">用于表单字段，Part和PartMap与@multipart注解结合使用，适合文件上传的情况</td></tr><tr><td>@Query</td><td align="left">用于Get请求中的参数</td></tr><tr><td>@PartMap</td><td align="left">用于表单字段，默认接受类型是Map&lt;String,RequestBody&gt;，可用于实现多文件上传</td></tr><tr><td>@Path</td><td align="left">用于Url中的占位符</td></tr><tr><td>@QueryMap</td><td align="left">与Query类似，用于不确定表单参数</td></tr></tbody></table> 
<h5><a id="4_71"></a>4.请求和响应格式(标记)注解</h5> 
<p>解释：此注解添加至方法前声明此请求有发送表单，上传文件或下载大文件等动作。</p> 
<table><thead><tr><th><strong>标记类注解</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>@FromUrlCoded</td><td>表示请求发送编码表单数据，每个键值对需要使用@Filed注解</td></tr><tr><td>@Multipart</td><td>表示请求发送form_encoded数据(使用于有文件上传的场景)，每个键值对需要用@Part来注解键名，随后的对象需要提供值</td></tr><tr><td>@Streaming</td><td>表示响应用字节流的形式返回，如果没有使用注解，默认会把数据全部载入到内存中，该注解在下载大文件时特别有用</td></tr></tbody></table> 
<h3><a id="_81"></a>三：注解详解</h3> 
<ol><li> <p>概述：我们先来解释注解的使用和需要注意的问题(具体的使用步骤后面会给出)。上面提到注解是用来配置和描述网络请求参数的，我们来逐个讲解一下，首先创建网络接口类：</p> 
  <blockquote> 
   <ul><li>Retrofit将okhttp请求抽象成java接口，采用注解描述和配置网络请求参数，用动态代理将该接口的注解“翻译”成一个Http请求，最后执行Http请求。</li><li>注意：接口中的每个方法的参数都要用注解标记，否则会报错。</li></ul> 
  </blockquote> <p>简单来说，我们需要先创建一个用于网络请求的接口，通过为接口中定义的请求方法添加不同的注解实现不同的网络请求功能。</p> <p>如：创建网络请求接口ApiService</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
   
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<h5><a id="1_GETQueryQueryMap_98"></a>1. @GET、@Query、@QueryMap的使用</h5> 
<p>此get请求使用前言中的get请求网址</p> 
<ol><li>无参的get请求</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token annotation punctuation">@GET</span><span class="token punctuation">(</span><span class="token string">"https://devapi.qweather.com/v7/weather/now?location=101010100&amp;key=a5cf6ab782a14013b08fb92a57dd2f72"</span><span class="token punctuation">)</span>
    <span class="token class-name">Call</span><span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token function">getCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>@GET 请求方法注解，get请求，括号内的是请求地址，Url的一部分</li><li>Call&lt;*&gt; 返回类型，*表示接收数据的类，一般自定义,下文展示本接口接受数据类型的类</li><li>getCall() 接口方法名称，括号内可以写入参数</li></ul> 
<p>此为网络接口最简单的一种形式，这是一个没有网络参数的get请求方式，需要在方法头部添加@GET注解，表示采用get方法访问网络请求，括号内的是请求的地址(Url的一部分，也可以是完整的Url，如上文) ，其中返回类型是Call&lt;*&gt;，*表示接收数据的类，如果想直接获取ResponseBody中的内容，可以定义网络请求返回值为Call，ResponseBody是请求网络后返回的原始数据，如果网络请求没有参数，不用写。</p> 
<p>简单Url介绍，对于上Url，它是一个请求天气的接口，通过Url组成不同，实现get请求到的数据不同，正常实现不同Url方式为字符串拼接，如：<br> <img src="https://images2.imgbox.com/ac/cb/tY96ibpm_o.png" alt="在这里插入图片描述"><br> 而Retrofit通过注解将Url分成两部分：一部分为在创建Retrofit实例时通过.baseUrl(”baseUrl“)设置，第二部分在网络接口注解中设置，如接口@get(“ApiUrl”)，网络请求的完整地址Url = baseUrl + ApiUrl。</p> 
<p>下面将上Url分割，分为baseUrl=“https://devapi.qweather.com/”,ApiUrl="v7/weather/now?location=101010100&amp;key=a5cf6ab782a14013b08fb92a57dd2f72"两部分。</p> 
<ol start="2"><li> <p>有参的get请求：</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
	<span class="token annotation punctuation">@GET</span><span class="token punctuation">(</span><span class="token string">"v7/weather/now"</span><span class="token punctuation">)</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"location"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> location<span class="token punctuation">,</span><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
  <ul><li>@Query 请求参数注解，用于Get请求中的参数</li><li>“location”/“key” 参数字段，与后台给的字段需要一致</li><li>String 声明的参数类型</li><li>location/key 实际参数</li></ul> <p>添加参数在方法括号内添加@Query，后面是参数类型和参数字段，表示后面location的取值作为"location"的值，key的取值作为"key"的值，其实就是键值对，Retrofit会把两个字段拼接到接口中，追加在"v7/weather/now"后面，此时若我们在方法点用时出入参数为（“101010100”, “a5cf6ab782a14013b08fb92a57dd2f72”），在retrofit实例设置baseUrl为"https://devapi.qweather.com/",那么拼接参数之后完整的请求参数就为"https://devapi.qweather.com/v7/weather/now?location=101010100&amp;key=a5cf6ab782a14013b08fb92a57dd2f72"。</p> <p>有关@QueryMap的使用：</p> <p>对于上参数我们发现其存在两个Query参数，对于这种@query较多的情况我们就可以将其用一个@QueryMap注解代替：</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
	<span class="token annotation punctuation">@GET</span><span class="token punctuation">(</span><span class="token string">"v7/weather/now"</span><span class="token punctuation">)</span>
	<span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@QueryMap</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
  <ul><li>@QueryMap 请求参数注解，与@Query类似，用于不确定表单参数</li><li>Map&lt;String, Object&gt; map 通过Map将不确定的参数传入，相当于多个Query参数</li></ul> <p>此map参数设置在接口方法被使用时传入，如：</p> <pre><code class="prism language-java">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span> <span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"location"</span><span class="token punctuation">,</span><span class="token string">"101010100"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span><span class="token string">"a5cf6ab782a14013b08fb92a57dd2f72"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span> call <span class="token operator">=</span> apiService<span class="token punctuation">.</span><span class="token function">getCall</span><span class="token punctuation">(</span><span class="token string">"now"</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <p>其主要用于表单参数不确定的情况，即Url中?号之后存在的参数不确定。</p> </li></ol> 
<h5><a id="2POSTFormUrlEncodedFileFileMapBody_165"></a>2.@POST、@FormUrlEncoded、@File、@FileMap、@Body的使用</h5> 
<p>​ 此post请求使用前言中的post请求网址</p> 
<p>​ 此post请求的baseUrl=“https://v2.alapi.cn/”</p> 
<ol><li> <p>无参的post方法的请求：</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@POST</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
	<span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResponseBody</span><span class="token punctuation">&gt;</span></span> <span class="token function">postCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
  <ul><li>@POST 请求方法注解，表示采用post方法访问网络请求，括号后面是部分的URL地址</li></ul> <p>post请求网络方法，需要在方法头部添加@POST注解，表示采用post方法访问网络请求.</p> </li><li> <p>有参的Post请求</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@FormUrlEncoded</span>
    <span class="token annotation punctuation">@POST</span><span class="token punctuation">(</span><span class="token string">"api/dog"</span><span class="token punctuation">)</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">postCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
  <ul><li>@FormUrlEncoded 请求格式注解，请求实体是一个From表单，每个键值对需要使用@Field注解</li><li>@Field 请求参数注解，提交请求的表单字段，必须要添加，而且需要配合@FormUrlEncoded使用</li><li>“token” 参数字段，与后台给的字段需要一致</li><li>String 声明的参数类型</li><li>token 实际参数，表示后面token的取值作为"token"的值</li></ul> <p>Post请求如果有参数需要在头部添加@FormUrlEncoded注解，表示请求实体是一个From表单，每个键值对需要使用@Field注解，使用@Field添加参数，这是发送Post请求时，提交请求的表单字段，必须要添加的，而且需要配合@FormUrlEncoded使用，若为在头部添加@FormUrlEncoded注解，会抛出如下异常：<br> <img src="https://images2.imgbox.com/11/4f/51wzuo72_o.png" alt="在这里插入图片描述"><br> <strong>有关@FieldMap的使用：</strong></p> <p>当有多个不确定参数时，我们可以使用@FieldMap注解，@FieldMap与@Field的作用一致，可以用于添加多个不确定的参数，类似@QueryMap，Map的key作为表单的键，Map的value作为表单的值。</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>	
	<span class="token annotation punctuation">@FormUrlEncoded</span>
    <span class="token annotation punctuation">@POST</span><span class="token punctuation">(</span><span class="token string">"api/dog"</span><span class="token punctuation">)</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">postCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@FieldMap</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <pre><code class="prism language-java">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span><span class="token string">"fTN2p6btdPMrU2Lf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"format"</span><span class="token punctuation">,</span><span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> post <span class="token operator">=</span> apiService1<span class="token punctuation">.</span><span class="token function">postCall</span><span class="token punctuation">(</span>map1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
  <ul><li>@FieldMap 请求参数注解，与@Field作用一致，用于不确定表单参数</li><li>Map&lt;String, Object&gt; map 通过Map将不确定的参数传入，相当于多个Field参数</li></ul> <p>适用于Post请求的还有一个注解@Body，<strong>@Body可以传递自定义类型数据给服务器，多用于post请求发送非表单数据</strong>，比如用传递Json格式数据，它可以注解很多东西，比如HashMap、实体类等，我们来看看它用法：</p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>	
	<span class="token annotation punctuation">@POST</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
	<span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPsotDataBody</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Body</span> <span class="token class-name">RequestBody</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p>特别注意：@Body注解<strong>不能用于表单或者支持文件上传的表单的编码，即不能与@FormUrlEncoded和@Multipart注解同时使用</strong></p> </li></ol> 
<h5><a id="3Path_236"></a>3.@Path</h5> 
<p>使用第一个get请求网址</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>	
    <span class="token annotation punctuation">@GET</span><span class="token punctuation">(</span><span class="token string">"v7/weather/{time}"</span><span class="token punctuation">)</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Path</span> <span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> time<span class="token punctuation">,</span> <span class="token annotation punctuation">@QueryMap</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>@QueryMap get请求方法参数的注解，上面已经解释了，这里就不重复讲</li><li>@Path 请求参数注解，用于Url中的占位符{}，在网址中的参数</li></ul> 
<p>@Path注解用于Url中的占位符{}，在网址中的参数，如上面 @GET(“v7/weather/{time}”)的time，通过{}占位符来标记time，使用@Path注解传入time的值，注意有的Url既有占位符又有"?"后面的键值对，其实@Query和@Path两者是可以共用的。在发起请求时，{time}会被替换为方法中第二个参数的值time。</p> 
<pre><code class="prism language-java">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span> <span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span> <span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"location"</span><span class="token punctuation">,</span><span class="token string">"101010100"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span><span class="token string">"a5cf6ab782a14013b08fb92a57dd2f72"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span> call <span class="token operator">=</span> apiService<span class="token punctuation">.</span><span class="token function">getCall</span><span class="token punctuation">(</span><span class="token string">"now"</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>最终{time}会被替换为now,此时形成的牵绊部分Url为：https://devapi.qweather.com/v7/weather/now，剩余**？号**后面的Url由@Query传入。</p> 
<h5><a id="4HTTP_261"></a>4.@HTTP</h5> 
<p>@HTTP注解的作用是替换@GET、@POST、@PUT、@DELETE、@HEAD以及更多拓展功能</p> 
<p>如可通过此注解代替@POST注解实现post请求，如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@FormUrlEncoded</span>
    <span class="token annotation punctuation">@POST</span><span class="token punctuation">(</span><span class="token string">"api/dog"</span><span class="token punctuation">)</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">postCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@FieldMap</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@FormUrlEncoded</span>
    <span class="token annotation punctuation">@HTTP</span><span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>path <span class="token operator">=</span> <span class="token string">"api/dog"</span><span class="token punctuation">,</span> hasBody <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">postCall1</span><span class="token punctuation">(</span><span class="token annotation punctuation">@FieldMap</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<ul><li>method 表示请求的方法，区分大小写，这里的值retrofit不会再做任何处理，必须要保证正确</li><li>path 网络请求地址路径</li><li>hasBody 是否有请求体，boolean类型</li></ul> 
<p>除请求接口部分的方法有变，别的部分与正常使用@POST请求一致，另外需要注意在使用@HTTP注解实现post请求时，若含有请求体，那么对应的标识注解@FormUrlEncoded一定要加上，若为别的请求体，那么就添加与之对应的标识注解。</p> 
<p>@HTTP注解可以通过method字段灵活设置具体请求方法，通过path设置网络请求地址，用的比较少。使用方法与设置的请求方法种类一致。</p> 
<h5><a id="5Url_288"></a>5.@Url</h5> 
<p>如果需要重新地址接口地址，可以使用@Url，将地址以参数的形式传入即可。如果有@Url注解时，GET传入的Url必须省略。不然会抛出如下异常。<br> <img src="https://images2.imgbox.com/b8/52/34eDyzgn_o.png" alt="在这里插入图片描述"><br> 如此种形式：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@FormUrlEncoded</span>
    <span class="token annotation punctuation">@POST</span><span class="token punctuation">(</span><span class="token string">"api/dog"</span><span class="token punctuation">)</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">postCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Url</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span><span class="token annotation punctuation">@FieldMap</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>正常应为：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@FormUrlEncoded</span>
    <span class="token annotation punctuation">@POST</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">postCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Url</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span><span class="token annotation punctuation">@FieldMap</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>@Url 表示指定请求路径，可以当做参数传入</li></ul> 
<h5><a id="6Streaming_313"></a>6.@Streaming</h5> 
<pre><code class="prism language-java">     <span class="token annotation punctuation">@Streaming</span>
     <span class="token annotation punctuation">@POST</span><span class="token punctuation">(</span><span class="token string">"gists/public"</span><span class="token punctuation">)</span>
     <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResponseBody</span><span class="token punctuation">&gt;</span></span> <span class="token function">getStreamingBig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>@Streaming 表示响应体的数据用流的方式返回，使用于返回数据比较大，该注解在下载大文件时特别有用</li></ul> 
<h5><a id="7MultipartpartPartMap_323"></a>7.@Multipart、@part、@PartMap</h5> 
<pre><code class="prism language-jaVA">    @Multipart
	@POST("user/followers")
	Call&lt;ResponseBody&gt; getPartData(@Part("name") RequestBody name, @Part MultipartBody.Part file);
</code></pre> 
<ul><li> <p>@Multipart 表示请求实体是一个支持文件上传的表单，需要配合@Part和@PartMap使用，适用于文件上传</p> </li><li> <p>@Part 用于表单字段，适用于文件上传的情况，@Part支持三种类型：RequestBody、MultipartBody.Part、 任意类型</p> </li><li> <p>@PartMap 用于多文件上传， 与@FieldMap和@QueryMap的使用类似</p> </li></ul> 
<p>代码使用逻辑：</p> 
<pre><code class="prism language-java">    <span class="token comment">//声明类型,这里是文字类型</span>
     <span class="token class-name">MediaType</span> textType <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"text/plain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//根据声明的类型创建RequestBody,就是转化为RequestBody对象</span>
    <span class="token class-name">RequestBody</span> name <span class="token operator">=</span> <span class="token class-name">RequestBody</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>textType<span class="token punctuation">,</span> <span class="token string">"周润发"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>​ 首先声明类型，通过MediaType实现类型的声明，此处使用的时文本类型，然后会根据该类型转化为RequestBody对象，此处使用的参数委RequestBody对象，相当于讲周润发以文本格式转换委RequestBody对象，最终上传时与name形成键值对。</p> 
<pre><code class="prism language-java"><span class="token comment">//创建文件，这里演示图片上传</span>
<span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"文件路径"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   file<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 
<span class="token comment">//将文件转化为RequestBody对象</span>
<span class="token comment">//需要在表单中进行文件上传时，就需要使用该格式：multipart/form-data</span>
<span class="token class-name">RequestBody</span> imgBody <span class="token operator">=</span> <span class="token class-name">RequestBody</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//将文件转化为MultipartBody.Part</span>
<span class="token comment">//第一个参数：上传文件的key；第二个参数：文件名；第三个参数：RequestBody对象</span>
<span class="token class-name">MultipartBody<span class="token punctuation">.</span>Part</span> filePart <span class="token operator">=</span> <span class="token class-name">MultipartBody<span class="token punctuation">.</span>Part</span><span class="token punctuation">.</span><span class="token function">createFormData</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> imgBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>对于文件类型的上传，我们一般使用MultipartBody.Part类型上传，在上面讲两个参数设置好后，然后调用接口使用请求方法即可：</p> 
<pre><code class="prism language-java"><span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResponseBody</span><span class="token punctuation">&gt;</span></span> partDataCall <span class="token operator">=</span> retrofit<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPartData</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> filePart<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>此种格式属于文本与文件混合发送的格式。</p> 
<p>@PartMap的使用与@FieldMap和@QueryMap的使用类似，用于多文件上传，我们直接看代码：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Multipart</span>
    <span class="token annotation punctuation">@POST</span><span class="token punctuation">(</span><span class="token string">"user/followers"</span><span class="token punctuation">)</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResponseBody</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPartMapData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PartMap</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">MultipartBody<span class="token punctuation">.</span>Part</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">    <span class="token class-name">File</span> file1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"文件路径"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> file2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"文件路径"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file1<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        file1<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file2<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        file2<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token class-name">RequestBody</span> requestBody1 <span class="token operator">=</span> <span class="token class-name">RequestBody</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RequestBody</span> requestBody2 <span class="token operator">=</span> <span class="token class-name">RequestBody</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MultipartBody<span class="token punctuation">.</span>Part</span> filePart1 <span class="token operator">=</span> <span class="token class-name">MultipartBody<span class="token punctuation">.</span>Part</span><span class="token punctuation">.</span><span class="token function">createFormData</span><span class="token punctuation">(</span><span class="token string">"file1"</span><span class="token punctuation">,</span> file1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestBody1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MultipartBody<span class="token punctuation">.</span>Part</span> filePart2 <span class="token operator">=</span> <span class="token class-name">MultipartBody<span class="token punctuation">.</span>Part</span><span class="token punctuation">.</span><span class="token function">createFormData</span><span class="token punctuation">(</span><span class="token string">"file2"</span><span class="token punctuation">,</span> file2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestBody2<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">MultipartBody<span class="token punctuation">.</span>Part</span><span class="token punctuation">&gt;</span></span> mapPart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapPart<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"file1"</span><span class="token punctuation">,</span>filePart1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapPart<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"file2"</span><span class="token punctuation">,</span>filePart2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="8_MediaType_399"></a>8. 有关MediaType方法</h5> 
<ol><li> <p>概述：MediaType，即是Internet Media Type，互联网媒体类型，也叫做MIME类型，在Http协议消息头中，使用Content-Type来表示具体请求中的媒体类型信息。（也就是说MediaType在网络协议的消息头里面叫做Content-Type）它使用两部分的标识符来确定一个类型，是为了表明我们传的东西是什么类型。</p> </li><li> <p><strong>常见的媒体格式类型如下：</strong></p> 
  <ul><li>text/html ： HTML格式</li><li>text/plain ：纯文本格式</li><li>text/xml ： XML格式</li><li>image/gif ：gif图片格式</li><li>image/jpeg ：jpg图片格式</li><li>image/png：png图片格式</li></ul> <p><strong>以application开头的媒体格式类型：</strong></p> 
  <ul><li>application/xhtml+xml ：XHTML格式</li><li>application/xml ：XML数据格式</li><li>application/atom+xml ：Atom XML聚合格式</li><li>application/json ：JSON数据格式</li><li>application/pdf ：pdf格式</li><li>application/msword ： Word文档格式</li><li>application/octet-stream ： 二进制流数据（如常见的文件下载、上传）</li><li>application/x-www-form-urlencoded ： 中默认的encType，form表单数据被编码为key/value格式发送到服务器（表单默认的提交数据的格式</li></ul> <p><strong>另外一种常见的媒体格式是上传文件之时使用的：</strong></p> 
  <ul><li>multipart/form-data ： 需要在表单中进行文件上传时，就需要使用该格式</li></ul> </li></ol> 
<h3><a id="_427"></a>四：实例讲解</h3> 
<p>使用 Retrofit 的步骤共有7个：</p> 
<blockquote> 
 <ol><li>添加Retrofit的依赖库</li><li>创建接收服务器返回数据的类</li><li>定义一个接口（封装URL地址和数据请求）</li><li>实例化Retrofit</li><li>通过Retrofit实例创建接口服务对象</li><li>接口服务对象调用接口中方法，获得Call对象</li><li>Call对象执行请求（异步、同步请求）</li></ol> 
</blockquote> 
<h5><a id="41GET_439"></a>实例4.1(演示GET请求)</h5> 
<p>使用Api为前言get请求Api：“https://devapi.qweather.com/v7/weather/now?location=101010100&amp;key=a5cf6ab782a14013b08fb92a57dd2f72”</p> 
<ol><li> <p><strong>添加Retrofit依赖库：（由于Retrofit库已经封装有okhttp所以不需要再添加okhttp的依赖库）</strong></p> <pre><code class="prism language-java">	implementation <span class="token string">'com.squareup.retrofit2:retrofit:2.5.0'</span>
</code></pre> </li><li> <p><strong>在清单中添加网络权限</strong></p> <pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.INTERNET<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> </li><li> <p><strong>创建服务器返回数据的接收类：</strong></p> <p>Api为一和风天气Api，返回数据类内容自己将url复制至浏览器，你会得到如下数据（一天天气数据）：</p> <p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-5Bzp6Tmq-1638885840654)(C:\Users\过客\AppData\Roaming\Typora\typora-user-images\image-20211207205030787.png)]</p> <p>若将now更改为7d,你将得到如下数据（七天天气数据）：</p> <p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Z0fwQ6eV-1638885840654)(C:\Users\过客\AppData\Roaming\Typora\typora-user-images\image-20211207205116238.png)]</p> <p>根据返回的json数据类型我们可以得到如下解析类：</p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>retrofit</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">SerializedName</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Wth_now_out</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"now"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Wth_now</span> now<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Wth_now</span> <span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> now<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNow</span><span class="token punctuation">(</span><span class="token class-name">Wth_now</span> now<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>now <span class="token operator">=</span> now<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">class</span> <span class="token class-name">Wth_now</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"temp"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> temp<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"feelsLike"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> feelsLike<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> wth_text<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"windDir"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> windDir<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"windScale"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> windScale<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"humidity"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> humidity<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"pressure"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> pressure<span class="token punctuation">;</span>


        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPressure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> pressure<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPressure</span><span class="token punctuation">(</span><span class="token class-name">String</span> pressure<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>pressure <span class="token operator">=</span> pressure<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTemp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> temp<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTemp</span><span class="token punctuation">(</span><span class="token class-name">String</span> temp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>temp <span class="token operator">=</span> temp<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFeelsLike</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> feelsLike<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFeelsLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> feelsLike<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>feelsLike <span class="token operator">=</span> feelsLike<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getWth_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> wth_text<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWth_text</span><span class="token punctuation">(</span><span class="token class-name">String</span> wth_text<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>wth_text <span class="token operator">=</span> wth_text<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getWindDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> windDir<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWindDir</span><span class="token punctuation">(</span><span class="token class-name">String</span> windDir<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>windDir <span class="token operator">=</span> windDir<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getWindScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> windScale<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWindScale</span><span class="token punctuation">(</span><span class="token class-name">String</span> windScale<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>windScale <span class="token operator">=</span> windScale<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getHumidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> humidity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setHumidity</span><span class="token punctuation">(</span><span class="token class-name">String</span> humidity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>humidity <span class="token operator">=</span> humidity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>另外上url的location的参数也可发生更改，更改后将查询别地的太难器数据。</p> <p>此处使用到Gson解析数据的注解，所以需要添加Gson的依赖库：</p> <pre><code class="prism language-java">implementation group<span class="token operator">:</span> <span class="token string">'com.google.code.gson'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'gson'</span><span class="token punctuation">,</span> version<span class="token operator">:</span> <span class="token string">'2.8.7'</span>
</code></pre> </li><li> <p><strong>创建用于描述网络请求的接口</strong></p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//此时我们将URl分割，并使用path注解使now的值随输入值改变。</span>
    <span class="token comment">//location与key即？后的部分由QueryMap注解最终通过方法录入。</span>
    <span class="token annotation punctuation">@GET</span><span class="token punctuation">(</span><span class="token string">"v7/weather/{time}"</span><span class="token punctuation">)</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Path</span> <span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> time<span class="token punctuation">,</span> <span class="token annotation punctuation">@QueryMap</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <p>在方法头部添加@GET注解，表示采用get方法访问网络请求，内部通过path最终录入{}占位符的值，</p> </li><li> <p><strong>实例化Retrofit</strong></p> <pre><code class="prism language-java"><span class="token class-name">String</span> baseUrl <span class="token operator">=</span> <span class="token string">"https://devapi.qweather.com/"</span><span class="token punctuation">;</span>
<span class="token class-name">Retrofit</span> mRetrofit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Retrofit<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span><span class="token class-name">GsonConverterFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <p>通过new Retrofit.Builder().buile()构建Retrofit实例对象，同时设置baseUrl地址，Retrofit把网络请求的URL 分成了两部分设置：<br> 第一部分：在创建Retrofit实例时通过.baseUrl()设置，</p> <pre><code class="prism language-java">	<span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span>
</code></pre> <p>第二部分在接口注解里设置：</p> <pre><code class="prism language-java">	<span class="token annotation punctuation">@GET</span><span class="token punctuation">(</span><span class="token string">"https://devapi.qweather.com/"</span><span class="token punctuation">)</span>
</code></pre> <p>上面两部分拼接后此时URl将为https://devapi.qweather.com/v7/weather/{time}，需要注意baseUrl必须以‘/’结尾，否则会报错。</p> <p>然后上面还添加了一个Conterter，这是一个解析器，它可将返回的json数据直接转换为我们所定义的json对象接收类。然后解析器也需要添加依赖：</p> <pre><code class="prism language-xml">	implementation 'com.squareup.retrofit2:converter-gson:2.0.2'
</code></pre> <p>Retrofit支持多种数据解析，需要在Gradle添加依赖：</p> 
  <table><thead><tr><th>数据解析器</th><th>Gradle依赖</th></tr></thead><tbody><tr><td>Gson</td><td>com.squareup.retrofit2:converter-gson:2.0.2</td></tr><tr><td>Jackson</td><td>com.squareup.retrofit2:converter-jackson:2.0.2</td></tr><tr><td>Simple XML</td><td>com.squareup.retrofit2:converter-simplexml:2.0.2</td></tr><tr><td>Protobuf</td><td>com.squareup.retrofit2:converter-protobuf:2.0.2</td></tr><tr><td>Moshi</td><td>com.squareup.retrofit2:converter-moshi:2.0.2</td></tr><tr><td>Wire</td><td>com.squareup.retrofit2:converter-wire:2.0.2</td></tr><tr><td>Scalars</td><td>com.squareup.retrofit2:converter-scalars:2.0.2</td></tr></tbody></table></li><li> <p><strong>通过Retrofit实例创建接口服务对象</strong></p> <pre><code class="prism language-java">	<span class="token class-name">ApiService</span> apiService <span class="token operator">=</span> mRetrofit<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">ApiService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p><strong>接口服务对象调用接口中方法，获得Call对象</strong></p> <pre><code class="prism language-java">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span> <span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"location"</span><span class="token punctuation">,</span><span class="token string">"101010100"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span><span class="token string">"a5cf6ab782a14013b08fb92a57dd2f72"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span> call <span class="token operator">=</span> apiService<span class="token punctuation">.</span><span class="token function">getCall</span><span class="token punctuation">(</span><span class="token string">"now"</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//获得call对象</span>
</code></pre> <p>此时传入了url的剩余部分，此时方法第一个参数传入now，它将替代原url占位符的位置，通过map向url传入了location和key的值，此时url将成为一个完整的url=“https://devapi.qweather.com/v7/weather/now?location=101010100&amp;key=a5cf6ab782a14013b08fb92a57dd2f72”。</p> </li><li> <p><strong>Call对象执行请求（异步、同步请求）</strong></p> <pre><code class="prism language-java"><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//发送异步请求</span>
        call<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResponse</span><span class="token punctuation">(</span><span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span> call<span class="token punctuation">,</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Wth_now_out</span> body <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Wth_now_out<span class="token punctuation">.</span>Wth_now</span> now <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">"天气:"</span> <span class="token operator">+</span> now<span class="token punctuation">.</span><span class="token function">getWth_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">";\n气温:"</span> <span class="token operator">+</span> now<span class="token punctuation">.</span><span class="token function">getTemp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">+</span> <span class="token string">";\n气压:"</span> <span class="token operator">+</span> now<span class="token punctuation">.</span><span class="token function">getPressure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">";\n风向:"</span> <span class="token operator">+</span> now<span class="token punctuation">.</span><span class="token function">getWindDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                tv<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFailure</span><span class="token punctuation">(</span><span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Wth_now_out</span><span class="token punctuation">&gt;</span></span> call<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <p>此处一个需要注意的点，retrofit一个call对象只能发送一次，若同一个call发送两次请求，此时会抛出如下异常：</p> <p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-24hCI8Yx-1638885840655)(C:\Users\过客\AppData\Roaming\Typora\typora-user-images\image-20211207213517573.png)]</p> <p>对于此种问题的解决，retrofit的call对象提供一个clone()方法，此方法将拷贝一个新的call对象，所以需要重复发送同一请求时，我们就可使用此方法现拷贝一个新的call对象，然后在发送请求。</p> <p>效果展示：<br> <img src="https://images2.imgbox.com/d6/e8/uj2QDcmt_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<p>重复点击get按钮也不会返送异常。</p> 
<h5><a id="42POST_697"></a>实例4.2（演示POST请求）</h5> 
<p>参照GET请求，重复的步骤将不做赘述。</p> 
<p>此post请求使用APi为：https://v2.alapi.cn/api/dog<br> <img src="https://images2.imgbox.com/ae/a9/G3CCUzwt_o.png" alt="在这里插入图片描述"><br> 此接口需要向发送如上两个表单（键值对）。</p> 
<p>此为<a href="https://www.alapi.cn/" rel="nofollow">ALAPI网站</a>提供学者练习使用的一个API，可以自己去网站寻找接口进行新的实验。</p> 
<p>创建网络请求接口：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token annotation punctuation">@FormUrlEncoded</span>		<span class="token comment">//配合post的Field或FieldMap注解使用。</span>
    <span class="token annotation punctuation">@POST</span><span class="token comment">//("api/dog")</span>
    <span class="token comment">//此处我们用一个Object对象接收数据</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">postCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Url</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span><span class="token annotation punctuation">@FieldMap</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>调用网络请求接口实例，处理返回数据（此接口数据并未解析，直接以Json类型接收并展示）：</p> 
<pre><code class="prism language-java">    
	<span class="token comment">//创建Retrofit实例</span>
	<span class="token class-name">Retrofit</span> mRetrofit2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Retrofit<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">"https://v2.alapi.cn/"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span><span class="token class-name">GsonConverterFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//根据Retrofit实例创建接口服务对象</span>
    <span class="token class-name">ApiService</span> apiService1 <span class="token operator">=</span> mRetrofit2<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">ApiService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//创建map用于参数输入</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span><span class="token string">"fTN2p6btdPMrU2Lf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"format"</span><span class="token punctuation">,</span><span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//调用请求方法，获得call对象</span>
    <span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> post <span class="token operator">=</span> apiService1<span class="token punctuation">.</span><span class="token function">postCall</span><span class="token punctuation">(</span><span class="token string">"api/dog"</span><span class="token punctuation">,</span>map1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>post<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//发送异步请求</span>
            post<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResponse</span><span class="token punctuation">(</span><span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> call<span class="token punctuation">,</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Object</span> body <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>body <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token comment">//接收数据，展示数据</span>
                    tv<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFailure</span><span class="token punctuation">(</span><span class="token class-name">Call</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> call<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"TAG"</span><span class="token punctuation">,</span> <span class="token string">"onFailure: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>效果展示：<br> <img src="https://images2.imgbox.com/33/53/hg819Auh_o.png" alt="在这里插入图片描述"><br> 结束……</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4248538869179129d4f35bd970acbc11/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">kubernetes 调度器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9919e58fd9b098a9368233d419624d2f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【看课必备】MOOC C语言进阶——翁恺 链表笔记</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>