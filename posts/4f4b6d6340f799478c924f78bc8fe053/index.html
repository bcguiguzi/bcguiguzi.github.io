<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>京东jos 获取授权及php-sdk的使用示例 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="京东jos 获取授权及php-sdk的使用示例" />
<meta property="og:description" content="背景：项目需要使用京东的物流服务，中间各种交流、签合同过程不做赘述，作为程序员，凭什么总要依靠代码实现能力来判断，鬼知道自己哪天是什么样子，以后不做程序猿，也是一条好汉！可惜，口水吐完还得老老实实来搬砖。
其实，很不喜欢泛泛而谈，以下是实现授权的操作流程，仅做参考。
1.平台配置信息 (1).首先创建应用，然后进行授权12345...在新建的应用下配置回调路径，以方便测试。
(2).建议熟悉京东云宙斯的技术开发文档
(3).在回调函数设置正确的前提下，点击测试按钮，然后进行账户密码的登录授权
(4).此时很有可能报出页面失效等提示，后面提供了简单的测试代码
2.提示： (1).注意回调Url的唯一性
(2).回调Url会返回不同情况下的信息，注意GET或POST的不同。
(3).因为根据应用的状态，access_token的时效性是不同的，有24小时的、有1年的。所以，可以将获得的access_token 以及账号公用信息存储到数据库中，以备后面的使用，等到下次时效到期，重新存储就好。
3.使用JOS所提供的php-sdk （简单举例：获取京东物流订单信息--此处使用的是京东物流） (1).注意：此处我使用的是ThinkPHP框架，所以在实例化类的时候，需要使用类似如下的代码：
Vendor(&#39;Jos.jd.JdClient&#39;); (2).开发文档中有明确指出
——正式环境授权地址：https://oauth.jd.com/oauth/authorize? （需要拼接参数，无法直接访问）
——Https调用入口地址：https://api.jd.com/routerjson 参考代码如下：
$this-&gt;server_url = &#34;https://api.jd.com/routerjson&#34;; 4.附录代码文件： &lt;?php namespace M\Controller; use Common\Model\JosModel; use Think\Controller; /* 红酒奖励 控制器 */ class JosController extends Controller { private $app_key;//应用的app_key private $app_secret;//即创建应用时的Appsecret（从JOS控制台-&gt;管理应用中获取） private $expires_in;//失效时间（从当前时间算起，单位：秒） private $access_token;//JOS 所回传的access_token值 private $refresh_token;//即授权时获取的刷新令牌 private $time;//授权的时间点（UNIX时间戳，单位：毫秒） private $jd_client ; private $server_url; public function __construct() { Vendor(&#39;Jos.jd.JdClient&#39;); $model = new JosModel(); $res = $model-&gt;getData(); $info = $res[0]; $this-&gt;app_key = $info[&#39;app_key&#39;]; $this-&gt;app_secret = $info[&#39;app_secret&#39;]; $this-&gt;expires_in = $info[&#39;expires_in&#39;]; $this-&gt;access_token = $info[&#39;access_token&#39;]; $this-&gt;refresh_token = $info[&#39;refresh_token&#39;]; $this-&gt;time = $info[&#39;time&#39;]; $this-&gt;jd_client = new \JdClient(); $this-&gt;server_url = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/4f4b6d6340f799478c924f78bc8fe053/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-12-06T20:37:12+08:00" />
<meta property="article:modified_time" content="2016-12-06T20:37:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">京东jos 获取授权及php-sdk的使用示例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-family:KaiTi_GB2312; font-size:18px">    背景：项目需要使用京东的物流服务，中间各种交流、签合同过程不做赘述，作为程序员，凭什么总要依靠代码实现能力来判断，鬼知道自己哪天是什么样子，以后不做程序猿，也是一条好汉！可惜，口水吐完还得老老实实来搬砖。</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:18px">    其实，很不喜欢泛泛而谈，以下是实现授权的操作流程，仅做参考。</span></p> 
<p style="color:rgb(169,183,198); background-color:rgb(43,43,43)"></p> 
<h4><span style="font-family:KaiTi_GB2312; font-size:18px">    1.平台配置信息</span></h4> 
<p></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:18px">    (1).首先创建应用，然后进行授权12345...在新建的应用下配置回调路径，以方便测试。<br> </span><span style="font-family:KaiTi_GB2312; font-size:18px">    <img src="https://images2.imgbox.com/d0/87/BdvM8vtZ_o.png" width="500" height="120" alt=""><br> </span><span style="font-family:KaiTi_GB2312; font-size:18px">    (2).建议熟悉<a target="_blank" href="http://jos.jd.com/doc/index.htm" rel="nofollow noopener noreferrer">京东云宙斯</a>的技术开发文档<br> </span><span style="font-family:KaiTi_GB2312; font-size:18px">    <img src="https://images2.imgbox.com/1c/ee/J7fKPXh3_o.png" width="520" height="300" alt=""><br> </span><span style="font-family:KaiTi_GB2312; font-size:18px">    (3).在回调函数设置正确的前提下，点击测试按钮，然后进行账户密码的登录授权<br> </span><span style="font-family:KaiTi_GB2312; font-size:18px">    <img src="https://images2.imgbox.com/05/3e/F9N8xcfw_o.png" width="520" height="300" alt=""><br> </span><span style="font-family:KaiTi_GB2312; font-size:18px">    <span style="font-family:KaiTi_GB2312; font-size:18px">(4).此时很有可能报出页面失效等提示，后面提供了简单的测试代码<br> </span></span><span style="font-family:KaiTi_GB2312; font-size:18px">    <img src="https://images2.imgbox.com/f4/c8/eYSAl8eW_o.png" width="600" height="200" alt=""><br> </span><span style="font-family:KaiTi_GB2312; font-size:18px">    </span></p> 
<p></p> 
<h4><span style="font-family:KaiTi_GB2312; font-size:18px">    2.提示：</span></h4> 
<span style="font-family:KaiTi_GB2312; font-size:18px">    (1).注意回调Url的唯一性<br> </span> 
<span style="font-family:KaiTi_GB2312; font-size:18px">    (2).回调Url会返回不同情况下的信息，注意GET或POST的不同。<br> </span> 
<span style="font-family:KaiTi_GB2312; font-size:18px">    (3).因为根据应用的状态，access_token的时效性是不同的，有24小时的、有1年的。所以，可以将获得的access_token 以及账号公用信息存储到数据库中，以备后面的使用，等到下次时效到期，重新存储就好。<br> </span> 
<span style="font-family:KaiTi_GB2312; font-size:18px">    </span> 
<p></p> 
<p></p> 
<h4><span style="font-family:KaiTi_GB2312; font-size:18px">    3.使用JOS所提供的php-sdk</span></h4> 
<span style="font-family:KaiTi_GB2312; font-size:18px">    （简单举例：获取京东物流订单信息--此处使用的是京东物流）</span> 
<p></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:18px">    (1).注意：此处我使用的是ThinkPHP框架，所以在实例化类的时候，需要使用类似如下的代码：</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:18px"></span></p> 
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Courier New'; font-size:10.8pt"><span style="background-color:#232525">    Vendor(</span><span style="color:#6a8759; background-color:#232525">'Jos.jd.JdClient'</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;</span></pre> 
<p></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:18px">    (2).开发文档中有明确指出</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:18px">    ——<span style="color:rgb(51,51,51); line-height:28px">正式环境授权地址：</span><span style="color:rgb(51,51,51); line-height:28px">https://oauth.jd.com/oauth/authorize? （需要拼接参数，无法直接访问）</span></span></p> 
<p><span style="color:rgb(51,51,51); line-height:28px"><span style="font-family:KaiTi_GB2312"><span style="font-size:18px"> </span><span style="font-size:18px">   ——<span lang="EN-US" style="color:rgb(51,51,51); line-height:28px">Https</span><span style="color:rgb(51,51,51); line-height:28px">调用入口地址：</span><span lang="EN-US" style="color:rgb(51,51,51); line-height:28px">https://api.jd.com/routerjson </span></span></span></span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:18px">    参考代码如下：</span></p> 
<p><span style="font-family:KaiTi_GB2312; font-size:18px"></span></p> 
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Courier New'; font-size:10.8pt"><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">server_url </span><span style="background-color:#232525">= </span><span style="color:#6a8759; background-color:#232525">"https://api.jd.com/routerjson"</span><span style="color:#cc7832; background-color:#232525">;</span></pre> 
<p></p> 
<div> 
 <div> 
  <span style="font-family:KaiTi_GB2312; font-size:18px"></span> 
 </div> 
 <div> 
  <span style="font-family:KaiTi_GB2312; font-size:18px"></span> 
 </div> 
</div> 
<h4><span style="font-family:KaiTi_GB2312; font-size:18px">   </span><span style="font-family:KaiTi_GB2312"><span style="font-size:18px"> 4.附录代码文件：</span></span></h4> 
<div> 
 <span style="font-family:KaiTi_GB2312"><span style="font-size:18px"></span></span> 
 <pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Courier New'; font-size:10.8pt"><span style="color:#cc7832; background-color:#232525"><strong>&lt;?php
</strong></span><span style="color:#cc7832; background-color:#232525"><strong>namespace </strong></span><span style="background-color:#232525">M\Controller</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525"><strong>use </strong></span><span style="background-color:#232525">Common\Model\JosModel</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525"><strong>use </strong></span><span style="background-color:#232525">Think\Controller</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#808080; background-color:#232525">/*
</span><span style="color:#808080; background-color:#232525">红酒奖励 控制器
</span><span style="color:#808080; background-color:#232525">*/
</span><span style="color:#cc7832; background-color:#232525"><strong>class </strong></span><span style="background-color:#232525">JosController </span><span style="color:#cc7832; background-color:#232525"><strong>extends </strong></span><span style="background-color:#232525">Controller {
</span><span style="background-color:#232525">
</span><span style="background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>private </strong></span><span style="color:#9876aa; background-color:#232525">$app_key</span><span style="color:#cc7832; background-color:#232525">;</span><span style="color:#808080; background-color:#232525">//应用的app_key
</span><span style="color:#808080; background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>private </strong></span><span style="color:#9876aa; background-color:#232525">$app_secret</span><span style="color:#cc7832; background-color:#232525">;</span><span style="color:#808080; background-color:#232525">//即创建应用时的Appsecret（从JOS控制台-&gt;管理应用中获取）
</span><span style="color:#808080; background-color:#232525">
</span><span style="color:#808080; background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>private </strong></span><span style="color:#9876aa; background-color:#232525">$expires_in</span><span style="color:#cc7832; background-color:#232525">;</span><span style="color:#808080; background-color:#232525">//失效时间（从当前时间算起，单位：秒）
</span><span style="color:#808080; background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>private </strong></span><span style="color:#9876aa; background-color:#232525">$access_token</span><span style="color:#cc7832; background-color:#232525">;</span><span style="color:#808080; background-color:#232525">//JOS 所回传的access_token值
</span><span style="color:#808080; background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>private </strong></span><span style="color:#9876aa; background-color:#232525">$refresh_token</span><span style="color:#cc7832; background-color:#232525">;</span><span style="color:#808080; background-color:#232525">//即授权时获取的刷新令牌
</span><span style="color:#808080; background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>private </strong></span><span style="color:#9876aa; background-color:#232525">$time</span><span style="color:#cc7832; background-color:#232525">;</span><span style="color:#808080; background-color:#232525">//授权的时间点（UNIX时间戳，单位：毫秒）
</span><span style="color:#808080; background-color:#232525">
</span><span style="color:#808080; background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>private </strong></span><span style="color:#9876aa; background-color:#232525">$jd_client </span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>private </strong></span><span style="color:#9876aa; background-color:#232525">$server_url</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>public function </strong></span><span style="color:#ffc66d; background-color:#232525">__construct</span><span style="background-color:#232525">()
</span><span style="background-color:#232525">    {
</span><span style="background-color:#232525">        Vendor(</span><span style="color:#6a8759; background-color:#232525">'Jos.jd.JdClient'</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$model </span><span style="background-color:#232525">= </span><span style="color:#cc7832; background-color:#232525"><strong>new </strong></span><span style="background-color:#232525">JosModel()</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$res </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$model</span><span style="background-color:#232525">-&gt;</span><span style="color:#ffc66d; background-color:#232525">getData</span><span style="background-color:#232525">()</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$info </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$res</span><span style="background-color:#232525">[</span><span style="color:#6897bb; background-color:#232525">0</span><span style="background-color:#232525">]</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">app_key </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$info</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'app_key'</span><span style="background-color:#232525">]</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">app_secret </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$info</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'app_secret'</span><span style="background-color:#232525">]</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">expires_in </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$info</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'expires_in'</span><span style="background-color:#232525">]</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">access_token </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$info</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'access_token'</span><span style="background-color:#232525">]</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">refresh_token </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$info</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'refresh_token'</span><span style="background-color:#232525">]</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">time </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$info</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'time'</span><span style="background-color:#232525">]</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client </span><span style="background-color:#232525">= </span><span style="color:#cc7832; background-color:#232525"><strong>new </strong></span><span style="background-color:#232525">\JdClient()</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">server_url </span><span style="background-color:#232525">= </span><span style="color:#6a8759; background-color:#232525">"https://api.jd.com/routerjson"</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">    </span><span style="background-color:#232525">}
</span><span style="background-color:#232525">
</span><span style="background-color:#232525">
</span><span style="background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>public function </strong></span><span style="color:#ffc66d; background-color:#232525">oauth</span><span style="background-color:#232525">(){
</span><span style="background-color:#232525">
</span><span style="background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$code </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$_GET</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'code'</span><span style="background-color:#232525">]</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$appKey </span><span style="background-color:#232525">= </span><span style="color:#6a8759; background-color:#232525">'DExxxxxxxxxxxxxxxxxxxxxx83'</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$appSecret </span><span style="background-color:#232525">= </span><span style="color:#6a8759; background-color:#232525">'40xxxxxxxxxxxxxxxxxxxxxxxxx31'</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$url </span><span style="background-color:#232525">= </span><span style="color:#6a8759; background-color:#232525">"http://www.xxxx.com/m/Jos/oauth.html"</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$toUrl </span><span style="background-color:#232525">=</span><span style="color:#6a8759; background-color:#232525">"https://oauth.jd.com/oauth/token?grant_type=authorization_code&amp;client_id="
</span><span style="color:#6a8759; background-color:#232525">            </span><span style="background-color:#232525">.</span><span style="color:#9876aa; background-color:#232525">$appKey
</span><span style="color:#9876aa; background-color:#232525">            </span><span style="background-color:#232525">.</span><span style="color:#6a8759; background-color:#232525">"&amp;client_secret="
</span><span style="color:#6a8759; background-color:#232525">            </span><span style="background-color:#232525">.</span><span style="color:#9876aa; background-color:#232525">$appSecret </span><span style="background-color:#232525">.</span><span style="color:#6a8759; background-color:#232525">"&amp;scope=read&amp;redirect_uri="
</span><span style="color:#6a8759; background-color:#232525">            </span><span style="background-color:#232525">.</span><span style="color:#9876aa; background-color:#232525">$url</span><span style="background-color:#232525">.</span><span style="color:#6a8759; background-color:#232525">"&amp;code="
</span><span style="color:#6a8759; background-color:#232525">            </span><span style="background-color:#232525">.</span><span style="color:#9876aa; background-color:#232525">$code</span><span style="background-color:#232525">.</span><span style="color:#6a8759; background-color:#232525">"&amp;state=1234"</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#cc7832; background-color:#232525"><strong>if</strong></span><span style="background-color:#232525">(!</span><span style="color:#9876aa; background-color:#232525">$code</span><span style="background-color:#232525">){
</span><span style="background-color:#232525">            </span><span style="color:#808080; background-color:#232525">//数据处理 此处其实是无法处理数据的，你问我，我问谁去啊？！！！
</span><span style="color:#808080; background-color:#232525">            </span><span style="color:#cc7832; background-color:#232525"><strong>echo </strong></span><span style="color:#6a8759; background-color:#232525">'hahahahhahahahah'</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="background-color:#232525">}</span><span style="color:#cc7832; background-color:#232525"><strong>else</strong></span><span style="background-color:#232525">{
</span><span style="background-color:#232525">            header(</span><span style="color:#6a8759; background-color:#232525">"Location:"</span><span style="background-color:#232525">.</span><span style="color:#9876aa; background-color:#232525">$toUrl</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="background-color:#232525">}
</span><span style="background-color:#232525">    }
</span><span style="background-color:#232525">
</span><span style="background-color:#232525">    </span><span style="color:#cc7832; background-color:#232525"><strong>public function </strong></span><span style="color:#ffc66d; background-color:#232525">test</span><span style="background-color:#232525">(){
</span><span style="background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$appKey </span><span style="background-color:#232525">= </span><span style="color:#6a8759; background-color:#232525">'DExxxxxxxxxxxxxxxxxxxxxx83'</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$url </span><span style="background-color:#232525">= </span><span style="color:#6a8759; background-color:#232525">'http://www.xxxx.com/m/Jos/oauth.html'</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$toUrl </span><span style="background-color:#232525">= </span><span style="color:#6a8759; background-color:#232525">'https://oauth.jd.com/oauth/authorize?response_type=code&amp;client_id='
</span><span style="color:#6a8759; background-color:#232525">            </span><span style="background-color:#232525">.</span><span style="color:#9876aa; background-color:#232525">$appKey</span><span style="background-color:#232525">.</span><span style="color:#6a8759; background-color:#232525">'&amp;redirect_uri='
</span><span style="color:#6a8759; background-color:#232525">            </span><span style="background-color:#232525">.</span><span style="color:#9876aa; background-color:#232525">$url</span><span style="background-color:#232525">.</span><span style="color:#6a8759; background-color:#232525">'&amp;state=123'</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="background-color:#232525">header(</span><span style="color:#6a8759; background-color:#232525">"Location:"</span><span style="background-color:#232525">.</span><span style="color:#9876aa; background-color:#232525">$toUrl</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">    </span><span style="background-color:#232525">}
</span><span style="background-color:#232525">
</span><span style="background-color:#232525">    </span><span style="color:#629755; background-color:#232525"><em>/**
</em></span><span style="color:#629755; background-color:#232525"><em>     * 将获取到的token等信息 添加到数据库  下面的为获取的其中一次数据 注意时效性
</em></span><span style="color:#629755; background-color:#232525"><em>     */
</em></span><span style="color:#629755; background-color:#232525"><em>    </em></span><span style="color:#cc7832; background-color:#232525"><strong>public function </strong></span><span style="color:#ffc66d; background-color:#232525">addData</span><span style="background-color:#232525">(){
</span><span style="background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$data </span><span style="background-color:#232525">= </span><span style="color:#cc7832; background-color:#232525"><strong>array</strong></span><span style="background-color:#232525">()</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$data</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'access_token'</span><span style="background-color:#232525">] = </span><span style="color:#6a8759; background-color:#232525">'24xxxxxxxxxxxxxxxxxxxxae0'</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$data</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'expires_in'</span><span style="background-color:#232525">] = </span><span style="color:#6a8759; background-color:#232525">'24xxxxxxxxxxxxxxxxxxxxxxxxe0'</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$data</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'refresh_token'</span><span style="background-color:#232525">] = </span><span style="color:#6a8759; background-color:#232525">'edxxxxxxxxxxxxxxxxxxxxxxxxxxx0f'</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$data</span><span style="background-color:#232525">[</span><span style="color:#6a8759; background-color:#232525">'time'</span><span style="background-color:#232525">] = </span><span style="color:#6a8759; background-color:#232525">'14xxxxx87475'</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$model </span><span style="background-color:#232525">= </span><span style="color:#cc7832; background-color:#232525"><strong>new </strong></span><span style="background-color:#232525">JosModel()</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$res </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$model</span><span style="background-color:#232525">-&gt;</span><span style="color:#ffc66d; background-color:#232525">addData</span><span style="background-color:#232525">(</span><span style="color:#9876aa; background-color:#232525">$data</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#cc7832; background-color:#232525"><strong>echo </strong></span><span style="color:#9876aa; background-color:#232525">$res</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">    </span><span style="background-color:#232525">}
</span><span style="background-color:#232525">
</span><span style="background-color:#232525">    </span><span style="color:#629755; background-color:#232525"><em>/**
</em></span><span style="color:#629755; background-color:#232525"><em>     * 查询京东快递物流跟踪信息
</em></span><span style="color:#629755; background-color:#232525"><em>     */
</em></span><span style="color:#629755; background-color:#232525"><em>    </em></span><span style="color:#cc7832; background-color:#232525"><strong>public function </strong></span><span style="color:#ffc66d; background-color:#232525">getTrace</span><span style="background-color:#232525">(){
</span><span style="background-color:#232525">        </span><span style="color:#808080; background-color:#232525">//获取订单号
</span><span style="color:#808080; background-color:#232525">        //$waybillCode = $_POST['waybillCode'];
</span><span style="color:#808080; background-color:#232525">
</span><span style="color:#808080; background-color:#232525">        //事例京东订单号
</span><span style="color:#808080; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$waybillCode </span><span style="background-color:#232525">= </span><span style="color:#6a8759; background-color:#232525">"23457562180"</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#808080; background-color:#232525">//https://api.jd.com/routerjson  注：以后统一都使用https方式调用，之前使用http方式的请尽快切换一下入口地址。
</span><span style="color:#808080; background-color:#232525">        </span><span style="background-color:#232525">Vendor(</span><span style="color:#6a8759; background-color:#232525">'Jos.jd.request.EtmsTraceGetRequest'</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">appKey </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">app_key</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">appSecret </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">app_secret</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">accessToken </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">access_token</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">serverUrl </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">server_url</span><span style="color:#cc7832; background-color:#232525">;</span><span style="color:#808080; background-color:#232525">//SERVER_URL;
</span><span style="color:#808080; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$req </span><span style="background-color:#232525">= </span><span style="color:#cc7832; background-color:#232525"><strong>new </strong></span><span style="background-color:#232525">\EtmsTraceGetRequest()</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$req</span><span style="background-color:#232525">-&gt;</span><span style="color:#ffc66d; background-color:#232525">setWaybillCode</span><span style="background-color:#232525">(</span><span style="color:#9876aa; background-color:#232525">$waybillCode</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$resp </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#ffc66d; background-color:#232525">execute</span><span style="background-color:#232525">(</span><span style="color:#9876aa; background-color:#232525">$req</span><span style="color:#cc7832; background-color:#232525">, </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">accessToken</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="background-color:#232525">var_dump(</span><span style="color:#9876aa; background-color:#232525">$resp</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">    </span><span style="background-color:#232525">}
</span><span style="background-color:#232525">
</span><span style="background-color:#232525">    </span><span style="color:#629755; background-color:#232525"><em>/**
</em></span><span style="color:#629755; background-color:#232525"><em>     * 360buy.order.get      获取单个订单
</em></span><span style="color:#629755; background-color:#232525"><em>     */
</em></span><span style="color:#629755; background-color:#232525"><em>    </em></span><span style="color:#cc7832; background-color:#232525"><strong>public function </strong></span><span style="color:#ffc66d; background-color:#232525">getSingleOrder</span><span style="background-color:#232525">(){
</span><span style="background-color:#232525">        Vendor(</span><span style="color:#6a8759; background-color:#232525">'Jos.jd.request.OrderGetRequest'</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">appKey </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">app_key</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">appSecret </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">app_secret</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">accessToken </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">access_token</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">serverUrl </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">server_url</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$req </span><span style="background-color:#232525">= </span><span style="color:#cc7832; background-color:#232525"><strong>new </strong></span><span style="background-color:#232525">\OrderGetRequest()</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#808080; background-color:#232525">//事例京东订单号
</span><span style="color:#808080; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$waybillCode </span><span style="background-color:#232525">= </span><span style="color:#6a8759; background-color:#232525">"23457562180"</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$req</span><span style="background-color:#232525">-&gt;</span><span style="color:#ffc66d; background-color:#232525">setOrderId</span><span style="background-color:#232525">(</span><span style="color:#9876aa; background-color:#232525">$waybillCode</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="color:#808080; background-color:#232525">//$req-&gt;setOptionalFields( "jingdong" );
</span><span style="color:#808080; background-color:#232525">        //$req-&gt;setOrderState( "jingdong" );
</span><span style="color:#808080; background-color:#232525">        </span><span style="color:#9876aa; background-color:#232525">$resp </span><span style="background-color:#232525">= </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#ffc66d; background-color:#232525">execute</span><span style="background-color:#232525">(</span><span style="color:#9876aa; background-color:#232525">$req</span><span style="color:#cc7832; background-color:#232525">, </span><span style="color:#9876aa; background-color:#232525">$this</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">jd_client</span><span style="background-color:#232525">-&gt;</span><span style="color:#9876aa; background-color:#232525">accessToken</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">        </span><span style="background-color:#232525">var_dump(</span><span style="color:#9876aa; background-color:#232525">$resp</span><span style="background-color:#232525">)</span><span style="color:#cc7832; background-color:#232525">;
</span><span style="color:#cc7832; background-color:#232525">
</span><span style="color:#cc7832; background-color:#232525">    </span><span style="background-color:#232525">}
</span><span style="background-color:#232525">}</span></pre> 
 <h4><span style="font-family:KaiTi_GB2312"><span style="font-size:18px">    5.参考如下获取某一个物流单号的物流信息</span></span></h4> 
</div> 
<div> 
 <span style="font-family:KaiTi_GB2312"><span style="font-size:18px">    <img src="https://images2.imgbox.com/f4/a3/XjNKeieg_o.png" width="520" height="200" alt=""><br> </span></span> 
</div> 
<div> 
 <span style="font-family:KaiTi_GB2312; font-size:18px"><br> </span> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/71e3eecdf5c51218064b284e3fd0e156/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">概率题（扔硬币）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0d0ca5943b00bd6e17e8fc1eb1b0502f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android Studio生成签名文件,自动签名,以及获取SHA1和MD5值</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>