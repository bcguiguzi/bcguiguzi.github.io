<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>再一次安装caffe - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="再一次安装caffe" />
<meta property="og:description" content="参考此博客装的caffehttps://blog.csdn.net/yhaolpz/article/details/71375762
安装过程中出现的问题（CUDA9.0&#43;Cudnn7.0）
问题1:compute_20
https://blog.csdn.net/tjuyanming/article/details/79249964?utm_source=blogxgwz6
nvcc fatal:unsupported gpu architecture &#34;compute_20&#34; 解决：
问题显示不支持compute_20，将Makefile.config中CUDA_ARCH的gencode arch=compute_20这行注释掉
#在caffe路径下 $vim Makefile.config #找到CUDA_PATH，删掉前两行 CUDA_ARCH :=-gencode arch=compute_30,code=sm_30 \ -gencode arch=compute_35,code=sm_35 \ -gencode arch=compute_50,code=sm_50 \ -gencode arch=compute_52,code=sm_52 \ -gencode arch=compute_60,code=sm_60 \ -gencode arch=compute_61,code=sm_61 \ -gencode arch=compute_61,code=compute_61 问题2:cudnn.h文件
./include/caffe/util/cndnn.hpp:5:19:fatal error:cndnn.h:No such file or directory 原因：没有cudnn.h文件，cudnn.h文件本应该在/usr/local/cuda-9.0/include/中，去查看了一下，确实没有，于是去同学那考了一个cudnn.h文件放到此文件夹下就行
#复制cudnn.h到/usr/local/cuda-9.0/include/ $sudo cp /home/ltpc/../cudnn.h /usr/local/cuda-9.0/include/ #其中/home/ltpc/../是cudnn.h所在的绝对路径 问题3：protobuf版本不同
https://blog.csdn.net/m0_38082419/article/details/80117132
.build_release/src/caffe/prete/caffe.pb.h:12:2:error:#error This file was generated by a new version of versin of protoc which is 原因：说protobuf版本太高了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/1f71e479d1b0e28fa0ff9d715cf3386f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-30T16:10:24+08:00" />
<meta property="article:modified_time" content="2019-04-30T16:10:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">再一次安装caffe</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>参考此博客装的caffe<a href="https://blog.csdn.net/yhaolpz/article/details/71375762">https://blog.csdn.net/yhaolpz/article/details/71375762</a></p> 
<p>安装过程中出现的问题（CUDA9.0+Cudnn7.0）</p> 
<p>问题1:compute_20</p> 
<p><a href="https://blog.csdn.net/tjuyanming/article/details/79249964?utm_source=blogxgwz6">https://blog.csdn.net/tjuyanming/article/details/79249964?utm_source=blogxgwz6</a></p> 
<pre class="has"><code>nvcc fatal:unsupported gpu architecture "compute_20"</code></pre> 
<p><img alt="" class="has" height="280" src="https://images2.imgbox.com/69/17/LYjqSvdb_o.png" width="554"></p> 
<p>解决：</p> 
<p>问题显示不支持compute_20，将Makefile.config中CUDA_ARCH的gencode arch=compute_20这行注释掉</p> 
<pre class="has"><code>#在caffe路径下
$vim Makefile.config
#找到CUDA_PATH，删掉前两行
CUDA_ARCH :=-gencode arch=compute_30,code=sm_30 \ 
            -gencode arch=compute_35,code=sm_35 \ 
            -gencode arch=compute_50,code=sm_50 \ 
            -gencode arch=compute_52,code=sm_52 \ 
            -gencode arch=compute_60,code=sm_60 \ 
            -gencode arch=compute_61,code=sm_61 \ 
            -gencode arch=compute_61,code=compute_61
</code></pre> 
<p>问题2:cudnn.h文件</p> 
<pre class="has"><code>./include/caffe/util/cndnn.hpp:5:19:fatal error:cndnn.h:No such file or directory</code></pre> 
<p><img alt="" class="has" height="125" src="https://images2.imgbox.com/36/58/xqdQtGVR_o.png" width="554"></p> 
<p>原因：没有cudnn.h文件，cudnn.h文件本应该在/usr/local/cuda-9.0/include/中，去查看了一下，确实没有，于是去同学那考了一个cudnn.h文件放到此文件夹下就行</p> 
<pre class="has"><code>#复制cudnn.h到/usr/local/cuda-9.0/include/
$sudo cp /home/ltpc/../cudnn.h /usr/local/cuda-9.0/include/
#其中/home/ltpc/../是cudnn.h所在的绝对路径</code></pre> 
<p>问题3：protobuf版本不同</p> 
<p><a href="https://blog.csdn.net/m0_38082419/article/details/80117132">https://blog.csdn.net/m0_38082419/article/details/80117132</a></p> 
<pre class="has"><code>.build_release/src/caffe/prete/caffe.pb.h:12:2:error:#error This file was generated by a new version of versin of protoc which is</code></pre> 
<p> </p> 
<p><img alt="" class="has" height="279" src="https://images2.imgbox.com/f2/57/T1ONupXQ_o.png" width="554"></p> 
<p> </p> 
<p>原因：说protobuf版本太高了。</p> 
<p>安装caffe的时候python的版本可选系统自带的python2.7或python3.5，也可以使用anaconda中的python版本，对应的Makefile.config中python路径对应的改变</p> 
<p>查看下系统中也安装的protobuf</p> 
<pre class="has"><code>#查看哪些路径下安装了protobuf
$where protoc</code></pre> 
<p><img alt="" class="has" height="43" src="https://images2.imgbox.com/19/c5/xNGEFWEf_o.png" width="811"></p> 
<p> </p> 
<pre class="has"><code>#查看默认默认使用的protobuf
$which protoc</code></pre> 
<p><img alt="" class="has" height="41" src="https://images2.imgbox.com/1d/53/v2uEkHtY_o.png" width="378"></p> 
<pre class="has"><code>#查看当前默认的protobuf的版本
$protoc --version</code></pre> 
<p><img alt="" class="has" height="40" src="https://images2.imgbox.com/59/6e/FUea33qc_o.png" width="444"></p> 
<pre class="has"><code>#查看系统的protobuf版本
$sudo protoc --version</code></pre> 
<p><img alt="" class="has" height="43" src="https://images2.imgbox.com/d5/a7/yZ6orY6k_o.png" width="477"></p> 
<p>问题往往是在于系统存在多个protobuf版本，而当前默认版本不能满足便于caffe的要求，此时我们需要修改Makefile文件内容，改成自己希望的版本目录</p> 
<pre class="has"><code>#打开Makefile
$vim Makefile</code></pre> 
<p>找到这两行</p> 
<pre class="has"><code>$(Q)protoc --proto_path=$(PROTO_SRC_DIR) --cpp_out=$(PROTO_BUILD_DIR) $&lt;
$(Q)protoc --proto_path=$(PROTO_SRC_DIR) --python_out=$(PY_PROTO_BUILD_DIR) $&lt;
</code></pre> 
<p>改为</p> 
<pre class="has"><code>$(Q)/usr/bin/protoc --proto_path=$(PROTO_SRC_DIR) --cpp_out=$(PROTO_BUILD_DIR) $&lt;
$(Q)/usr/bin/protoc --proto_path=$(PROTO_SRC_DIR) --python_out=$(PY_PROTO_BUILD_DIR) $&lt;
</code></pre> 
<p>问题4：找不到lopencv_imgcodes</p> 
<p><a href="https://blog.csdn.net/xw2017/article/details/85230744">https://blog.csdn.net/xw2017/article/details/85230744</a></p> 
<pre class="has"><code>/usr/bin/ld:cannot find -lopencv_imgcodes</code></pre> 
<p> </p> 
<p><img alt="" class="has" height="105" src="https://images2.imgbox.com/ca/12/JuDim0Ut_o.png" width="554"></p> 
<p>原因：</p> 
<p><img alt="" class="has" height="251" src="https://images2.imgbox.com/c8/95/vzjAul3R_o.png" width="542"></p> 
<p>opencv_imgcodecs是OpenCV3.0的类包，但是自己使用的是OpenCV2.4，版本不匹配，将Makefile.config中OPENCV_VERSION:=3注释掉就行</p> 
<pre class="has"><code>$vim Makefile.config
#OPENCV_VERSION:=3</code></pre> 
<p>问题5：找不到lcudnn</p> 
<p><a href="https://stackoverflow.com/questions/43996484/ubuntu-caffe-installation-error-usr-bin-ld-cannot-find-lcudnn" rel="nofollow">https://stackoverflow.com/questions/43996484/ubuntu-caffe-installation-error-usr-bin-ld-cannot-find-lcudnn</a></p> 
<pre class="has"><code>/usr/bin/ld:cannot find -lcudnn</code></pre> 
<p>将缺少的cudnn文件复制到/usr/local/cuda-9.0/lib64/下</p> 
<pre class="has"><code>sudo cp /home/ltpc/lib64/libcudnn.so /usr/local/cuda-9.0/lib64/
sudo cp /home/ltpc/lib64/libcudnn.so.7 /usr/local/cuda-9.0/lib64/
sudo cp /home/ltpc/lib64/libcudnn.so.7.0.3 /usr/local/cuda-9.0/lib64/
sudo cp /home/ltpc/lib64/libcudnn_static.a /usr/local/cuda-9.0/lib64/
#其中/home/ltpc/lib64/是存放文件的绝对路径，改成你自己的绝对路径即可</code></pre> 
<p>问题6：/usr/local/cuda/lib64/libcudnn.so:file not recognized:File format not recognized</p> 
<p style="margin-left:0cm;"><a href="https://blog.csdn.net/qq_33144323/article/details/85465975">https://blog.csdn.net/qq_33144323/article/details/85465975</a></p> 
<pre class="has"><code>/usr/local/cuda/lib64/libcudnn.so:file not recognized:File format not recognized
collect2:error:ld returned 1 exit status
Makefile:582:recipe for target './build_release/lib/libvaffe.so.1.0.0' failed
make:*** [.build_release/lib/libcaffe/so.1.0.0] Error 1</code></pre> 
<p><img alt="" class="has" height="56" src="https://images2.imgbox.com/e6/69/qR1noUbL_o.png" width="554"></p> 
<p>解决：</p> 
<p>移除除libcudnn.so.7.0.1以外的libcudnn.so文件</p> 
<pre class="has"><code>/usr/local/cuda/lib64$ sudo rm -rf libcudnn.so libcudnn.so.7 
</code></pre> 
<p>重新生成软连接</p> 
<pre class="has"><code>sudo ln -s libcudnn.so.7.0.1 libcudnn.so.7 
sudo ln -s libcudnn.so.7 libcudnn.so </code></pre> 
<p> 问题7：.build_release/tools/caffe:error while loading shared libraries:libcudart.so.9.0:cannot open shared object file:No such file or directory</p> 
<p> </p> 
<p><img alt="" class="has" height="70" src="https://images2.imgbox.com/a0/72/5pExtKB0_o.png" width="554"></p> 
<pre class="has"><code>.build_release/tools/caffe:error while loading shared libraries:libcudart.so.9.0:cannot open shared object file:No such file or directory
Makefile:542:recipe for target 'runtest' failed
Make:*** [runtest] Error 127</code></pre> 
<p>cuda9.0链接出错，解决方法：</p> 
<pre class="has"><code>sudo cp /usr/local/cuda-9.0/lib64/libcudart.so.9.0 /usr/local/lib/libcudart.so.9.0 &amp;&amp; sudo ldconfig 
sudo cp /usr/local/cuda-9.0/lib64/libcublas.so.9.0 /usr/local/lib/libcublas.so.9.0 &amp;&amp; sudo ldconfig 
sudo cp /usr/local/cuda-9.0/lib64/libcurand.so.9.0 /usr/local/lib/libcurand.so.9.0 &amp;&amp; sudo ldconfig
</code></pre> 
<p>问题8：error while loading shared libraries: libcudnn.so.7: cannot open shared object file: No such file or</p> 
<p><a href="https://blog.csdn.net/sinat_23619409/article/details/85047788">https://blog.csdn.net/sinat_23619409/article/details/85047788</a></p> 
<p><img alt="" class="has" height="59" src="https://images2.imgbox.com/1b/4e/736osSne_o.png" width="554"></p> 
<p>在/usr/local/lib/目录下找不到到libcudnn.so.7这个文件，该文件在/usr/local/cuda-9.0/lib64/目录下可以找到，将其复制一份即可</p> 
<pre class="has"><code>$sudo cp /usr/local/cuda-9.0/lib64 /usr/local/lib/</code></pre> 
<p>注：每次解决完问题，记得先sudo make clean,然后再make all -j8</p> 
<p>再次安装caffe，感觉比第一次有信心得多，面对这么些错误不是心里烦躁，而是一步步是查找到底问题出在哪里，对linux系统的一些指令也熟悉了许多，知道都是什么意思了，感觉自己进步了，哈哈哈哈哈，继续加油，也感谢小伙伴那么不厌其烦帮我，感谢</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d889e93d70c7c571d87d122ecf4e3a59/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">WPF设置Button的Style</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5bff201944adb732e86d1be6ed7eb5f0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算几何——向量的叉乘、点乘、夹角</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>