<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【零基础学爬虫】第四章：selenium模块使用 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【零基础学爬虫】第四章：selenium模块使用" />
<meta property="og:description" content="目录
一、初识selenium
二、selenium使用前准备
三、selenium的使用
1.实例化selenium对象
2.编写基于浏览器自动化的操作代码
四、动作链与iframe
五、iframe总结
六、无头浏览和规避检测
一、初识selenium ①selenium是基于浏览器自动化的一个模块，便捷的获取网站中动态加载的数据（之前文章中使用的ajax方法，很麻烦），便捷实现模拟登录（自动打开网页，进行一系列的点击操作）。
二、selenium使用前准备 ①安装selenium
由于我使用的是anaconda，因此自带selenium。
②下载一个浏览器的驱动程序（谷歌浏览器）
下载路径：http://chromedriver.storage.googleapis.com/index.html
驱动程序和浏览器的映射关系：https://blog.csdn.net/weixin_45532870/article/details/112036377?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161390536416780261967275%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161390536416780261967275&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-112036377.first_rank_v2_pc_rank_v29&amp;utm_term=chromedriver%E4%B8%8Echrome%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E8%A1%A8
③关于版本选择的说明：
一般直接按照浏览器版本去找对应的driver就行了。
（如果不能一一对应，就找大版本号对应的或者比浏览器版本号稍大的都行）
对于windows的用户来说，win64的操作系统用win32的即可。
所有Chromedriver均可在下面链接找到
④我的驱动版本
可以在谷歌浏览器中输入chrome://version/，查看浏览器版本
⑤将驱动器放置在代码文件中即可 ，稍后使用。
三、selenium的使用 1.实例化selenium对象 from selenium import webdriver #实例化一个浏览器对象（传入浏览器的驱动成） bro = webdriver.Chrome(executable_path=&#39;./chromedriver&#39;) 2.编写基于浏览器自动化的操作代码 ①发起请求
#让浏览器发起一个指定url对应请求 bro.get(&#39;http://scxk.nmpa.gov.cn:81/xk/&#39;) 案例一完整代码：
需求：存储动态加载的信息
from selenium import webdriver from lxml import etree from time import sleep #实例化一个浏览器对象（传入浏览器的驱动成） bro = webdriver.Chrome(executable_path=&#39;./chromedriver&#39;) #让浏览器发起一个指定url对应请求 bro.get(&#39;http://scxk.nmpa.gov.cn:81/xk/&#39;) #page_source获取浏览器当前页面的页面源码数据 page_text = bro.page_source #解析企业名称 tree = etree.HTML(page_text) li_list = tree." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/813737bb6e4e2ebcaf95bee6e597b8b5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-21T19:10:32+08:00" />
<meta property="article:modified_time" content="2021-02-21T19:10:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【零基础学爬虫】第四章：selenium模块使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E5%88%9D%E8%AF%86selenium-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E5%88%9D%E8%AF%86selenium" rel="nofollow">一、初识selenium</a></p> 
<p id="%E4%BA%8C%E3%80%81selenium%E4%BD%BF%E7%94%A8%E5%89%8D%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81selenium%E4%BD%BF%E7%94%A8%E5%89%8D%E5%87%86%E5%A4%87" rel="nofollow">二、selenium使用前准备</a></p> 
<p id="%E4%B8%89%E3%80%81selenium%E7%9A%84%E4%BD%BF%E7%94%A8-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81selenium%E7%9A%84%E4%BD%BF%E7%94%A8" rel="nofollow">三、selenium的使用</a></p> 
<p id="1.%E5%AE%9E%E4%BE%8B%E5%8C%96selenium%E5%AF%B9%E8%B1%A1-toc" style="margin-left:80px;"><a href="#1.%E5%AE%9E%E4%BE%8B%E5%8C%96selenium%E5%AF%B9%E8%B1%A1" rel="nofollow">1.实例化selenium对象</a></p> 
<p id="2.%E7%BC%96%E5%86%99%E5%9F%BA%E4%BA%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84%E6%93%8D%E4%BD%9C%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#2.%E7%BC%96%E5%86%99%E5%9F%BA%E4%BA%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84%E6%93%8D%E4%BD%9C%E4%BB%A3%E7%A0%81" rel="nofollow">2.编写基于浏览器自动化的操作代码</a></p> 
<p id="%E5%9B%9B%E3%80%81%E5%8A%A8%E4%BD%9C%E9%93%BE%E4%B8%8Eiframe-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81%E5%8A%A8%E4%BD%9C%E9%93%BE%E4%B8%8Eiframe" rel="nofollow">四、动作链与iframe</a></p> 
<p id="%E4%BA%94%E3%80%81iframe%E6%80%BB%E7%BB%93-toc" style="margin-left:40px;"><a href="#%E4%BA%94%E3%80%81iframe%E6%80%BB%E7%BB%93" rel="nofollow">五、iframe总结</a></p> 
<p id="%E5%85%AD%E3%80%81%E6%97%A0%E5%A4%B4%E6%B5%8F%E8%A7%88%E5%92%8C%E8%A7%84%E9%81%BF%E6%A3%80%E6%B5%8B-toc" style="margin-left:40px;"><a href="#%E5%85%AD%E3%80%81%E6%97%A0%E5%A4%B4%E6%B5%8F%E8%A7%88%E5%92%8C%E8%A7%84%E9%81%BF%E6%A3%80%E6%B5%8B" rel="nofollow">六、无头浏览和规避检测</a></p> 
<hr id="hr-toc"> 
<h3>一、初识selenium</h3> 
<p><strong>①selenium是基于浏览器自动化的一个模块，<span style="color:#f33b45;">便捷的获取网站中动态加载的数据（之前文章中使用的ajax方法，很麻烦），便捷实现模拟登录（自动打开网页，进行一系列的点击操作）。</span></strong></p> 
<h3 id="%E4%BA%8C%E3%80%81selenium%E4%BD%BF%E7%94%A8%E5%89%8D%E5%87%86%E5%A4%87">二、selenium使用前准备</h3> 
<p><strong>①安装selenium</strong></p> 
<p>由于我使用的是anaconda，因此自带selenium。</p> 
<p><strong>②</strong><strong>下载一个浏览器的驱动程序（谷歌浏览器）</strong></p> 
<p>下载路径：<a href="http://chromedriver.storage.googleapis.com/index.html" rel="nofollow">http://chromedriver.storage.googleapis.com/index.html</a></p> 
<p>驱动程序和浏览器的映射关系：<a href="https://blog.csdn.net/weixin_45532870/article/details/112036377?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161390536416780261967275%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161390536416780261967275&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-112036377.first_rank_v2_pc_rank_v29&amp;utm_term=chromedriver%E4%B8%8Echrome%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E8%A1%A8">https://blog.csdn.net/weixin_45532870/article/details/112036377?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161390536416780261967275%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161390536416780261967275&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-112036377.first_rank_v2_pc_rank_v29&amp;utm_term=chromedriver%E4%B8%8Echrome%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E8%A1%A8</a></p> 
<p><strong>③关于版本选择的说明：</strong></p> 
<ul><li> <p><span style="color:#f33b45;">一般直接按照浏览器版本去找对应的driver就行了。<br> （如果不能一一对应，就找大版本号对应的或者比浏览器版本号稍大的都行）</span></p> </li><li> <p><span style="color:#f33b45;">对于windows的用户来说，win64的操作系统用win32的即可。</span></p> </li><li> <p><span style="color:#f33b45;">所有Chromedriver均可在下面链接找到</span></p> </li></ul> 
<p><strong>④我的驱动版本</strong></p> 
<p>可以在谷歌浏览器中输入chrome://version/，查看浏览器版本</p> 
<p><img alt="" height="196" src="https://images2.imgbox.com/ee/b4/jfRhbDlV_o.png" width="918"></p> 
<p><strong>⑤将驱动器放置在代码文件中即可 ，稍后使用。</strong></p> 
<h3 id="%E4%B8%89%E3%80%81selenium%E7%9A%84%E4%BD%BF%E7%94%A8">三、selenium的使用</h3> 
<h4 id="1.%E5%AE%9E%E4%BE%8B%E5%8C%96selenium%E5%AF%B9%E8%B1%A1">1.实例化selenium对象</h4> 
<pre><code class="language-python">from selenium import webdriver

#实例化一个浏览器对象（传入浏览器的驱动成）
bro = webdriver.Chrome(executable_path='./chromedriver')</code></pre> 
<h4 id="2.%E7%BC%96%E5%86%99%E5%9F%BA%E4%BA%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84%E6%93%8D%E4%BD%9C%E4%BB%A3%E7%A0%81">2.编写基于浏览器自动化的操作代码</h4> 
<p><strong>①发起请求</strong></p> 
<pre><code class="language-python">#让浏览器发起一个指定url对应请求
bro.get('http://scxk.nmpa.gov.cn:81/xk/')</code></pre> 
<p><span style="color:#f33b45;"><strong>案例一完整代码：</strong></span></p> 
<p><span style="color:#f33b45;"><strong>需求：存储动态加载的信息</strong></span></p> 
<pre><code class="language-python">from selenium import webdriver
from lxml import etree
from time import sleep

#实例化一个浏览器对象（传入浏览器的驱动成）
bro = webdriver.Chrome(executable_path='./chromedriver')
#让浏览器发起一个指定url对应请求
bro.get('http://scxk.nmpa.gov.cn:81/xk/')

#page_source获取浏览器当前页面的页面源码数据
page_text = bro.page_source

#解析企业名称
tree = etree.HTML(page_text)
li_list = tree.xpath('//ul[@id="gzlist"]/li')
for li in li_list:
    name = li.xpath('./dl/@title')[0]
    print(name)
sleep(5)
bro.quit()</code></pre> 
<p><img alt="" height="243" src="https://images2.imgbox.com/f3/d5/CEMshjdK_o.png" width="396"></p> 
<p><strong>②标签定位</strong></p> 
<pre><code class="language-python">#标签定位，想在搜索框中输入关键词，需要定位到搜索框对应的标签
search_input = bro.find_element_by_id('q')</code></pre> 
<p><strong>③标签交互</strong></p> 
<p><span style="color:#f33b45;">可以点击、输入文本、控制滚轮等</span></p> 
<pre><code class="language-python">#标签交互，在搜索框中输入内容
search_input.send_keys('Iphone')

#点击搜索按钮
btn = bro.find_element_by_css_selector('.btn-search')
btn.click()

#执行一组js程序，滚轮向下拖动
bro.execute_script('window.scrollTo(0,document.body.scrollHeight)')</code></pre> 
<p><strong>④执行js程序</strong></p> 
<pre><code class="language-python">#执行一组js程序，滚轮向下拖动
bro.execute_script('window.scrollTo(0,document.body.scrollHeight)')</code></pre> 
<p><strong>⑤前进，后退</strong></p> 
<pre><code class="language-python">#回退
bro.back()

#前进
bro.forward()</code></pre> 
<p><strong>⑥关闭浏览器</strong></p> 
<pre><code class="language-python">bro.quit()</code></pre> 
<p><span style="color:#f33b45;"><strong>案例二完整代码：</strong></span></p> 
<p><span style="color:#f33b45;"><strong>需求：在淘宝搜索框中，输入“Iphone”，并点击搜索，然后使用滚轮向下滚动一屏的高度。（前提是登陆了淘宝，登录具体细节在其他文章中给出）</strong></span></p> 
<pre><code>from selenium import webdriver
from lxml import etree
from time import sleep

#实例化一个浏览器对象（传入浏览器的驱动成）
bro = webdriver.Chrome(executable_path='./chromedriver')
#让浏览器发起一个指定url对应请求
bro.get('https://www.taobao.com/')

#标签定位
search_input = bro.find_element_by_id('q')
#标签交互
search_input.send_keys('Iphone')


#执行一组js程序
bro.execute_script('window.scrollTo(0,document.body.scrollHeight)')
sleep(2)
#点击搜索按钮
btn = bro.find_element_by_css_selector('.btn-search')
btn.click()


bro.get('https://www.baidu.com')
sleep(2)
#回退
bro.back()
sleep(2)
#前进
bro.forward()


sleep(5)

bro.quit()
</code></pre> 
<h3 id="%E5%9B%9B%E3%80%81%E5%8A%A8%E4%BD%9C%E9%93%BE%E4%B8%8Eiframe">四、动作链与iframe</h3> 
<p><strong>iframe：在一个页面中，可以嵌套一个子页面，这样的操作可以使用iframe来实现。</strong></p> 
<p><span style="color:#f33b45;"><strong>案例需求：把下图方块拖动到指定位置</strong></span></p> 
<p><img alt="" height="654" src="https://images2.imgbox.com/98/4a/pHJJ1nVO_o.png" width="886"></p> 
<p><span style="color:#f33b45;"><strong>完整代码：</strong></span></p> 
<pre><code class="language-python">from selenium import webdriver
from time import sleep
#导入动作链对应的类
from selenium.webdriver import ActionChains
bro = webdriver.Chrome(executable_path='./chromedriver')

bro.get('https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable')

#如果定位的标签是存在于iframe标签之中的则必须通过如下操作在进行标签定位
bro.switch_to.frame('iframeResult')#切换浏览器标签定位的作用域
div = bro.find_element_by_id('draggable')

#动作链
action = ActionChains(bro)
#点击长按指定的标签
action.click_and_hold(div)

for i in range(5):
    #perform()立即执行动作链操作
    #move_by_offset(x,y):x水平方向 y竖直方向
    action.move_by_offset(17,0).perform()
    sleep(0.5)

#释放动作链
action.release()

# bro.quit()
</code></pre> 
<p><img alt="" height="321" src="https://images2.imgbox.com/73/8c/LdmCDCR9_o.png" width="978"></p> 
<p><img alt="" height="621" src="https://images2.imgbox.com/e4/25/xV2O9Hr5_o.png" width="946"></p> 
<p><span style="color:#f33b45;"><strong>如上图所示，要挪动的方块被嵌套在当前网页的子页面中。如果定位的标签存在在iframe之中，必须用上述代码中的方法切换作用域，切换到指定的iframe中，否则会默认在全局作用域。</strong></span></p> 
<p> </p> 
<h3 id="%E4%BA%94%E3%80%81iframe%E6%80%BB%E7%BB%93"><strong>五、</strong>iframe<strong>总结</strong></h3> 
<p><strong>- 如果定位的标签存在于iframe标签之中，则必须使用switch_to.frame(id) </strong></p> 
<p><strong>- 动作链（拖动）：from selenium.webdriver import ActionChains</strong></p> 
<p><strong>- 实例化一个动作链对象：action = ActionChains(bro) </strong></p> 
<p><strong>- click_and_hold（div）：长按且点击操作 </strong></p> 
<p><strong>- move_by_offset(x,y) </strong></p> 
<p><strong>- perform()让动作链立即执行 </strong></p> 
<p><strong>- action.release()释放动作链对象</strong></p> 
<p> </p> 
<h3 id="%E5%85%AD%E3%80%81%E6%97%A0%E5%A4%B4%E6%B5%8F%E8%A7%88%E5%92%8C%E8%A7%84%E9%81%BF%E6%A3%80%E6%B5%8B">六、无头浏览和规避检测</h3> 
<p><span style="color:#f33b45;"><strong>1.无头浏览就是不弹出浏览器</strong></span></p> 
<p><span style="color:#f33b45;"><strong>2.如果selenium被检测到，会被拒绝爬取，这也是一种反爬手段。因此我们需要规避selenium检测。</strong></span></p> 
<p><span style="color:#f33b45;"><strong>以上两条不需要背下来，用的时候copy就行。</strong></span></p> 
<p><span style="color:#f33b45;"><strong>目前好像有了新的规避方法，等我用到我会更新，欢迎大家和我交流！</strong></span></p> 
<pre><code class="language-python">from selenium import webdriver
from time import sleep
# 实现无可视化界面
from selenium.webdriver.chrome.options import Options
# 实现规避检测
from selenium.webdriver import ChromeOptions

# 实现无可视化界面的操作
chrome_options = Options()
chrome_options.add_argument('--headless')
chrome_options.add_argument('--disable-gpu')

# 实现规避检测
option = ChromeOptions()
option.add_experimental_option('excludeSwitches', ['enable-automation'])

# 如何实现让selenium规避被检测到的风险
bro = webdriver.Chrome(executable_path='./chromedriver',chrome_options=chrome_options,options=option)

# 无可视化界面（无头浏览器） phantomJs浏览器也可以，但是他已经停止更新维护了
bro.get('https://www.baidu.com')

print(bro.page_source)
sleep(2)
bro.quit()</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5408706172f9a21d7d99aad3b044c227/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【零基础学爬虫】第五章：scrapy框架的使用（一）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/315941f75150b394776fdd717785829c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java创建list对象_java – 创建一个包含多个对象类型的arraylist？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>