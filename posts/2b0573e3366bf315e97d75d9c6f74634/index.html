<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>BigDecimal可以用equals方法做等值比较吗？ - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="BigDecimal可以用equals方法做等值比较吗？" />
<meta property="og:description" content="结论是不可以，BigDecimal的equals方法不仅会比较值，还会比较精度，比如1.0和1.00虽然值是一样的，我们也倾向于认为是相同的，但是因为精度不同，最终得到的结论是false。 代码如下：
@Test public void compareBigDecimal(){ BigDecimal d1 = new BigDecimal(&#34;1.0&#34;); BigDecimal d2 = new BigDecimal(&#34;1.00&#34;); System.out.println(d1.equals(d2)); } 得到结果：
这是因为BigDecimal重写了equals方法，源码如下：
public boolean equals(Object x) { if (!(x instanceof BigDecimal)) return false; BigDecimal xDec = (BigDecimal) x; if (x == this) return true; if (scale != xDec.scale) return false; long s = this.intCompact; long xs = xDec.intCompact; if (s != INFLATED) { if (xs == INFLATED) xs = compactValFor(xDec.intVal); return xs == s; } else if (xs !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/2b0573e3366bf315e97d75d9c6f74634/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-09T15:19:10+08:00" />
<meta property="article:modified_time" content="2024-03-09T15:19:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">BigDecimal可以用equals方法做等值比较吗？</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>结论是不可以，<code>BigDecimal</code>的<code>equals</code>方法不仅会比较值，还会比较精度，比如<code>1.0</code>和<code>1.00</code>虽然值是一样的，我们也倾向于认为是相同的，但是因为精度不同，最终得到的结论是<code>false</code>。 代码如下：</p> 
<pre><code>@Test
public void compareBigDecimal(){
    BigDecimal d1 = new BigDecimal("1.0");
    BigDecimal d2 = new BigDecimal("1.00");
    System.out.println(d1.equals(d2));
}
</code></pre> 
<p>得到结果：</p> 
<p class="img-center"><img alt="image.png" height="118" src="https://images2.imgbox.com/27/42/B3WHonK0_o.png" width="337"></p> 
<p>这是因为<code>BigDecimal</code>重写了<code>equals</code>方法，源码如下：</p> 
<pre><code>public boolean equals(Object x) {
    if (!(x instanceof BigDecimal))
        return false;
    BigDecimal xDec = (BigDecimal) x;
    if (x == this)
        return true;
    if (scale != xDec.scale)
        return false;
    long s = this.intCompact;
    long xs = xDec.intCompact;
    if (s != INFLATED) {
        if (xs == INFLATED)
            xs = compactValFor(xDec.intVal);
        return xs == s;
    } else if (xs != INFLATED)
        return xs == compactValFor(this.intVal);

    return this.inflated().equals(xDec.inflated());
}
</code></pre> 
<p>这段代码是BigDecimal类中的equals方法的一部分，用于比较两个BigDecimal对象是否相等。以下是这段代码的详细解释：</p> 
<ol><li> <p><strong>检查对象类型</strong>:</p> </li></ol> 
<pre><code>if (!(x instanceof BigDecimal))  
    return false;
</code></pre> 
<p>如果传入的对象x不是BigDecimal的实例，那么返回false。 2. <strong>强制类型转换</strong>:</p> 
<pre><code>BigDecimal xDec = (BigDecimal) x;
</code></pre> 
<p>将对象x强制转换为BigDecimal类型，并赋值给xDec。 3. <strong>检查是否为同一个对象</strong>:</p> 
<pre><code>if (x == this)  
    return true;
</code></pre> 
<p>如果x和this引用的是同一个对象，那么返回true。 4. <strong>比较标度（scale）</strong>:</p> 
<pre><code>if (scale != xDec.scale)  
    return false;
</code></pre> 
<p>如果两个BigDecimal对象的标度（小数点后的位数）不同，那么返回false。 5. <strong>比较紧凑值</strong>:</p> 
<pre><code>long s = this.intCompact;  
long xs = xDec.intCompact;  
if (s != INFLATED) {  
    if (xs == INFLATED)  
        xs = compactValFor(xDec.intVal);  
    return xs == s;  
} else if (xs != INFLATED)  
    return xs == compactValFor(this.intVal);
</code></pre> 
<p>这部分代码比较了两个BigDecimal对象的紧凑值。紧凑值是一个用于存储小整数值的字段，当值的绝对值小于10^7时，它可以直接存储在这个字段中，而不需要使用更复杂的数据结构。如果this的紧凑值不是INFLATED（表示紧凑值有效），但xDec的紧凑值是INFLATED，那么会尝试获取xDec的紧凑值。然后，比较这两个紧凑值是否相等。 6. <strong>比较膨胀值</strong>:</p> 
<pre><code>return this.inflated().equals(xDec.inflated());
</code></pre> 
<p>如果上述比较都没有返回结果，那么这部分代码会比较两个BigDecimal对象的膨胀值。膨胀值是一个更复杂的数据结构，用于存储大于10^7的整数值或小数。这部分代码通过调用inflated()方法获取膨胀值，并使用equals方法进行比较。 重写后的<code>equals</code>方法实现了<code>BigDecimal</code>对象的等价性检查，它首先检查<strong>类型</strong>，然后检查<strong>标度</strong>，接着比较<strong>紧凑值</strong>，如果仍然不能确定等价性，最后会比较<strong>膨胀值</strong>。</p> 
<h2>那可以用==比较吗？</h2> 
<p>这当然也不行，这是因为 == 运算符在 Java 中用于比较对象的引用是否相同，即是否指向内存中的同一个对象实例，而不是比较它们的内容或值。</p> 
<h2>那应该怎么做等值比较呢？</h2> 
<p>可以使用 compareTo() 方法来比较两个 BigDecimal 对象的大小关系，而不是使用 equals() 方法进行等值比较。compareTo() 方法返回一个整数值，表示两个 BigDecimal 对象的大小关系：</p> 
<ul><li> <p>如果第一个 BigDecimal 对象小于第二个，则返回负数；</p> </li><li> <p>如果两个对象相等，则返回0；</p> </li><li> <p>如果第一个 BigDecimal 对象大于第二个，则返回正数。</p> </li></ul> 
<p>所以，你可以使用 compareTo() 方法来判断两个 BigDecimal 对象是否相等。如果返回的结果是0，则表示两个对象的数值相等。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eb80543fbc4caa33c0261b01802d72e0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">web安全攻防渗透测试实战指南_web安全攻防渗透测试实战指南</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/75b1c5157b9174e2517b0207e3759a67/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">学习和认知的四个阶段，以及学习方法分享</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>