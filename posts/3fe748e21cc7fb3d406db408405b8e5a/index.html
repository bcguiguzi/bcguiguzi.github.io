<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySql中一条语句递归查询所有子节点，递归删除所有子节点 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MySql中一条语句递归查询所有子节点，递归删除所有子节点" />
<meta property="og:description" content="一、使用什么技术 MySQL中可以使用WITH RECURSIVE关键字来实现递归查询。
二、表结构和数据背景 表结构
名类型注释namevarchar标签名称codevarchar标签codeparent_codevarchar父级标签codelevelint层级 label表中，level字段代表层级，更直观给大家展示数据
code是唯一标识
parent_code代表它的父级
现有数据如下 namecodeparent_codelevel第一级标签L0011第二级标签L002L0012第三级标签1L003L0023第四级标签1L004L0034第三级标签2L005L0023第四级标签2L006L0054 数据结构如下 第一级标签
└─ 第二级标签 (L002)
├─ 第三级标签1 (L003)
│ └─ 第四级标签1 (L004)
└─ 第三级标签2 (L005)
└─ 第四级标签2 (L006)
三、具体SQL实现 递归查询 传入最上层code，递归查询所有子节点
WITH RECURSIVE cte AS ( SELECT * FROM label WHERE code = &#39;最上层的code&#39; UNION ALL SELECT t.* FROM label t JOIN cte c ON t.parent_code = c.code ) SELECT * FROM cte; 递归删除 传入最上层code，递归删除最上层节点和对应所有子节点
WITH RECURSIVE cte AS ( SELECT code, parent_code FROM label WHERE code = &#39;最上层的code&#39; UNION ALL SELECT l." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/3fe748e21cc7fb3d406db408405b8e5a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-27T09:48:58+08:00" />
<meta property="article:modified_time" content="2023-04-27T09:48:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySql中一条语句递归查询所有子节点，递归删除所有子节点</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、使用什么技术</h2> 
<p><strong>MySQL中可以使用WITH RECURSIVE关键字来实现递归查询。</strong></p> 
<h2><a id="_3"></a>二、表结构和数据背景</h2> 
<p>表结构</p> 
<table><thead><tr><th>名</th><th>类型</th><th>注释</th></tr></thead><tbody><tr><td>name</td><td>varchar</td><td>标签名称</td></tr><tr><td>code</td><td>varchar</td><td>标签code</td></tr><tr><td>parent_code</td><td>varchar</td><td>父级标签code</td></tr><tr><td>level</td><td>int</td><td>层级</td></tr></tbody></table> 
<p>label表中，level字段代表层级，更直观给大家展示数据<br> code是唯一标识<br> parent_code代表它的父级</p> 
<h3><a id="_16"></a>现有数据如下</h3> 
<table><thead><tr><th>name</th><th>code</th><th>parent_code</th><th>level</th></tr></thead><tbody><tr><td>第一级标签</td><td>L001</td><td></td><td>1</td></tr><tr><td>第二级标签</td><td>L002</td><td>L001</td><td>2</td></tr><tr><td>第三级标签1</td><td>L003</td><td>L002</td><td>3</td></tr><tr><td>第四级标签1</td><td>L004</td><td>L003</td><td>4</td></tr><tr><td>第三级标签2</td><td>L005</td><td>L002</td><td>3</td></tr><tr><td>第四级标签2</td><td>L006</td><td>L005</td><td>4</td></tr></tbody></table> 
<h3><a id="_26"></a>数据结构如下</h3> 
<p>第一级标签<br> └─ 第二级标签 (L002)<br> ├─ 第三级标签1 (L003)<br> │ └─ 第四级标签1 (L004)<br> └─ 第三级标签2 (L005)<br> └─ 第四级标签2 (L006)</p> 
<h2><a id="SQL_34"></a>三、具体SQL实现</h2> 
<h3><a id="_35"></a>递归查询</h3> 
<p><strong>传入最上层code，递归查询所有子节点</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">WITH</span> RECURSIVE cte <span class="token keyword">AS</span> <span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> label <span class="token keyword">WHERE</span> code <span class="token operator">=</span> <span class="token string">'最上层的code'</span>
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> t<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> label t <span class="token keyword">JOIN</span> cte c <span class="token keyword">ON</span> t<span class="token punctuation">.</span>parent_code <span class="token operator">=</span> c<span class="token punctuation">.</span>code
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> cte<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_47"></a>递归删除</h3> 
<p><strong>传入最上层code，递归删除最上层节点和对应所有子节点</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">WITH</span> RECURSIVE cte <span class="token keyword">AS</span> <span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> code<span class="token punctuation">,</span> parent_code <span class="token keyword">FROM</span> label <span class="token keyword">WHERE</span> code <span class="token operator">=</span> <span class="token string">'最上层的code'</span>
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> l<span class="token punctuation">.</span>code<span class="token punctuation">,</span> l<span class="token punctuation">.</span>parent_code <span class="token keyword">FROM</span> label l <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> cte <span class="token keyword">ON</span> l<span class="token punctuation">.</span>parent_code <span class="token operator">=</span> cte<span class="token punctuation">.</span>code
<span class="token punctuation">)</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> label <span class="token keyword">WHERE</span> code <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> code <span class="token keyword">FROM</span> cte<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/18fb69d4d5fade2d34d665a7878e1356/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">领域自适应(Domain Adaptation)方法综述</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2ca065ceb0deb23ba6e01d07c99a5d88/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">前端程序员的职业发展规划与路线——ChatGPT的回答</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>