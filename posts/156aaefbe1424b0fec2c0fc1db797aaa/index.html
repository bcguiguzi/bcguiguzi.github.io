<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>服务器负载均衡配置——基于HTTPS流量的服务器负载均衡 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="服务器负载均衡配置——基于HTTPS流量的服务器负载均衡" />
<meta property="og:description" content="目录
一、组网需求
二、网络拓扑
三、配置要点
四、操作步骤
1、基础上网配置
2、配置负载均衡服务器
3、配置安全策略
五、验证效果
一、组网需求 如下图所示，公司内部有2台web服务器，服务器对外提供的域名为www.test.com, 需要通过https进行访问；在防火墙上配置负载均衡，将web服务负载到192.168.1.1 和192.168.1.2 两台服务器之上。
二、网络拓扑 三、配置要点 1、基础上网配置
2、配置负载均衡服务器
（1）配置健康检查
（2）配置负载均衡服务器
（3）配置真实服务器
3、配置安全策略
四、操作步骤 1、基础上网配置 配置详细过程请参照 “路由模式典型功能--单线上网--静态地址线路上网配置“一节：
接口IP如下：
路由配置如下：
2、配置负载均衡服务器 （1）配置负载均衡服务器
菜单： 防护墙&gt;负载均衡&gt;健康检查， 点击“新建”按钮，建立虚拟服务器，如下图所示：
名称： https（该名称为自定义，可根据需要进行修改）
类型：http，tcp，udp，ip等方式，本例选择为https，如果是dns服务器则需要选择udp类型。
接口：port15， 防火墙连接外网的端口。
服务器虚拟IP：服务器对外提供服务的IP，192.168.118.126
负载均衡方法：支持静态，轮询，加权，最早存活，最小响应时间，最小连接数，http host等多种方法
保持方法: http cookie
http 多路复用： 可选项，可以将客户请求的多个链接，合并为一条请求来链接服务器，降低服务器的负载。
安全套接卸载：client--RuijieGate客户端与防火墙之间为ssl链接， 防火墙与服务器之间为明文，减轻服务器负载。
client--RuijieGate--server 客户端与防火墙之间为ssl链接， 防火墙与服务器之间为ssl链接。
证书： 导入为服务器申请的证书，本例为网站的合法证书为web。
健康检查： 可选项，只有一个真实服务器，无需选择。
（2）配置真实服务器
菜单： 防护墙&gt;负载均衡&gt;真实服务器， 点击“新建”按钮，建立2台真实服务器，如下图所示：
虚拟服务器： https， 选择为哪台虚拟服务器来建立真实服务器。
IP地址： 真实服务器的ip地址。
端口： 真实服务器http服务端口，可以不与虚拟服务器的服务器端口相同。
权重： 本例不可选，如果选择了基于权重的负载方式，则可以在此处指定全总比如，比如 10：10 等，" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/156aaefbe1424b0fec2c0fc1db797aaa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-28T16:31:36+08:00" />
<meta property="article:modified_time" content="2023-09-28T16:31:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">服务器负载均衡配置——基于HTTPS流量的服务器负载均衡</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82" rel="nofollow">一、组网需求</a></p> 
<p id="%E4%BA%8C%E3%80%81%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91" rel="nofollow">二、网络拓扑</a></p> 
<p id="%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE%E8%A6%81%E7%82%B9-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE%E8%A6%81%E7%82%B9" rel="nofollow">三、配置要点</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4" rel="nofollow">四、操作步骤</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A01%E3%80%81%E5%9F%BA%E7%A1%80%E4%B8%8A%E7%BD%91%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A01%E3%80%81%E5%9F%BA%E7%A1%80%E4%B8%8A%E7%BD%91%E9%85%8D%E7%BD%AE" rel="nofollow">       1、基础上网配置</a></p> 
<p id="%C2%A0%C2%A02%E3%80%81%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A02%E3%80%81%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">  2、配置负载均衡服务器</a></p> 
<p id="3%E3%80%81%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5" rel="nofollow">3、配置安全策略</a></p> 
<p id="%E4%BA%94%E3%80%81%E9%AA%8C%E8%AF%81%E6%95%88%E6%9E%9C-toc" style="margin-left:40px;"><a href="#%E4%BA%94%E3%80%81%E9%AA%8C%E8%AF%81%E6%95%88%E6%9E%9C" rel="nofollow">五、验证效果</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p> </p> 
<div> 
 <h3 id="%E4%B8%80%E3%80%81%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82" style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#800000;">一、组网需求</span></strong></h3> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong>        </strong><span style="color:#000000;">如下图所示，公司内部有2台web服务器，服务器对外提供的域名为</span><span style="color:#000000;">www.test.com</span><span style="color:#000000;">, </span><span style="color:#000000;">需要通过https进行访问；在防火墙上配置负载均衡，将web服务负载到192.168.1.1 和192.168.1.2 两台服务器之上。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <h3 id="%E4%BA%8C%E3%80%81%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91" style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#800000;">二、网络拓扑</span></strong></h3> 
</div> 
<p class="img-center"><img alt="" height="304" src="https://images2.imgbox.com/3b/1a/Z2xnj6qj_o.png" width="472"></p> 
<div> 
 <h3 id="%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE%E8%A6%81%E7%82%B9" style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#800000;">三、配置要点</span></strong></h3> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong>      </strong><strong> </strong><span style="color:#000000;">1</span><span style="color:#000000;">、基础上网配置</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">       2</span><span style="color:#000000;">、配置负载均衡服务器</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（1）配置健康检查</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（2）配置负载均衡服务器</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（3）配置真实服务器</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">       3</span><span style="color:#000000;">、配置安全策略</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <h3 id="%E5%9B%9B%E3%80%81%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4" style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#800000;">四、操作步骤</span></strong></h3> 
 <h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A01%E3%80%81%E5%9F%BA%E7%A1%80%E4%B8%8A%E7%BD%91%E9%85%8D%E7%BD%AE" style="margin-left:.0001pt;text-align:justify;"><strong>       </strong><strong><span style="color:#000000;">1</span></strong><strong><span style="color:#000000;">、基础上网配置</span></strong></h4> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">配置详细过程请参照 </span><span style="color:#000000;">“</span><span style="color:#000000;">路由模式典型功能--单线上网--静态地址线路上网配置</span><span style="color:#000000;">“</span><span style="color:#000000;">一节：</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">接口IP如下：</span></p> 
</div> 
<p><img alt="" height="46" src="https://images2.imgbox.com/73/e6/x9bGN9FK_o.png" width="855"></p> 
<div> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">路由配置如下：</span></p> 
</div> 
<p><img alt="" height="165" src="https://images2.imgbox.com/02/8e/NySrOn7P_o.png" width="709"></p> 
<div> 
 <h4 id="%C2%A0%C2%A02%E3%80%81%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E5%99%A8" style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#000000;">  2</span></strong><strong><span style="color:#000000;">、配置负载均衡服务器</span></strong></h4> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（1）配置负载均衡服务器</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">菜单： 防护墙&gt;负载均衡&gt;健康检查， 点击</span><span style="color:#000000;">“</span><span style="color:#000000;">新建</span><span style="color:#000000;">”</span><span style="color:#000000;">按钮，建立虚拟服务器，如下图所示：</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="393" src="https://images2.imgbox.com/8f/b4/s4Ls7CKo_o.png" width="961"></p> 
</div> 
<div> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">名称： https（该名称为自定义，可根据需要进行修改）</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">类型：http，tcp，udp，ip等方式，本例选择为https，如果是dns服务器则需要选择udp类型。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">接口：port15， 防火墙连接外网的端口。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">服务器虚拟IP：服务器对外提供服务的IP，192.168.118.126</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">负载均衡方法：支持静态，轮询，加权，最早存活，最小响应时间，最小连接数，http host等多种方法</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">保持方法: http cookie</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">http </span><span style="color:#000000;">多路复用： 可选项，可以将客户请求的多个链接，合并为一条请求来链接服务器，降低服务器的负载。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">安全套接卸载：client--RuijieGate客户端与防火墙之间为ssl链接， 防火墙与服务器之间为明文，减轻服务器负载。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">                   client--RuijieGate--server       </span><span style="color:#000000;">客户端与防火墙之间为ssl链接， 防火墙与服务器之间为ssl链接。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">证书：  导入为服务器申请的证书，本例为网站的合法证书为web。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">健康检查： 可选项，只有一个真实服务器，无需选择。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（2）配置真实服务器</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">菜单： 防护墙&gt;负载均衡&gt;真实服务器， 点击</span><span style="color:#000000;">“</span><span style="color:#000000;">新建</span><span style="color:#000000;">”</span><span style="color:#000000;">按钮，建立2台真实服务器，如下图所示：</span></p> 
</div> 
<p><img alt="" height="276" src="https://images2.imgbox.com/35/9c/cFxvSKYE_o.png" width="861"></p> 
<div> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">虚拟服务器： https， 选择为哪台虚拟服务器来建立真实服务器。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">IP</span><span style="color:#000000;">地址： 真实服务器的ip地址。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">端口： 真实服务器http服务端口，可以不与虚拟服务器的服务器端口相同。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">权重：  本例不可选，如果选择了基于权重的负载方式，则可以在此处指定全总比如，比如 10：10 等，</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">最大连接数： 0为不做任何限制。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">模式：有效， 可选参数包括：有效，无效，备用。</span></p> 
 <div> 
  <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">（3）按上述方法建立第二台服务器，</span></p> 
 </div> 
</div> 
<p><img alt="" height="275" src="https://images2.imgbox.com/87/45/ilzLgAq2_o.png" width="743"></p> 
<p><img alt="" height="157" src="https://images2.imgbox.com/2c/89/0Ohz50B6_o.png" width="487"></p> 
<div> 
 <h4 id="3%E3%80%81%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5" style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#000000;">3</span></strong><strong><span style="color:#000000;">、配置安全策略</span></strong></h4> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">菜单： 防火墙--策略--策略， 点击 "新建"</span> <span style="color:#000000;">在新建窗口内，按如下的方式，添加一条策略：</span></p> 
</div> 
<p><img alt="" height="294" src="https://images2.imgbox.com/95/b5/elD6LLWD_o.png" width="800"></p> 
<div> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">点击</span><span style="color:#000000;">”</span><span style="color:#000000;">目的地址</span><span style="color:#000000;">“</span><span style="color:#000000;">右面的 </span><span style="color:#000000;">”</span><span style="color:#000000;">多个</span><span style="color:#000000;">“</span><span style="color:#000000;">按钮，选择将定义好的2个虚拟IP：</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"> <span style="color:#000000;">源接口/区：wan1    </span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">源地址：all</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">目的接口/区： internal</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">目的地址选择:   选择多个，https 和https1</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">服务: all</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">在策略中开启dlp的 http 存档功能，同时启用SSL/SSH检测。</span></p> 
</div> 
<p><img alt="" height="250" src="https://images2.imgbox.com/0f/a1/XnmMamaf_o.png" width="721"></p> 
<div> 
 <h3 id="%E4%BA%94%E3%80%81%E9%AA%8C%E8%AF%81%E6%95%88%E6%9E%9C" style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#800000;">五、验证效果</span></strong></h3> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">从外部进行访问http是://www.test.com, 本例以 锐捷防火墙 作为http服务器进行测试。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="454" src="https://images2.imgbox.com/51/d1/xialGBBz_o.png" width="827"></p> 
</div> 
<div> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">查看证书，依然为该网站的合法证书。</span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">查看日志：</span></p> 
</div> 
<p><img alt="" height="507" src="https://images2.imgbox.com/21/7a/UCFiX3cC_o.png" width="1200"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c4f853c5a4a4e51ac69b130ccf177237/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">F#奇妙游（35）：MVC模式和ADT分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/468775dee68f955c98f7ee3a33095f92/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">audio之mclk异常分析以及通道映射</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>