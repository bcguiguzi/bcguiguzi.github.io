<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在windows下安装nnUnet，并制作数据集以及运行（让隔壁奶奶也能学会的教程） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在windows下安装nnUnet，并制作数据集以及运行（让隔壁奶奶也能学会的教程）" />
<meta property="og:description" content="1.前言 nnUnet原代码是在Linux下运行，如果现在windows下安装的话，会报各种错误，得改很多的地方，所以可以直接下载nnUnet_windows文件，这是我已经在windows上成功编译的版本，只要安装成功就可以直接运行。该链接中还包含apex安装包以及制作自己数据格式的代码。
nnUnet的版本是2021/7月更新的。
2.安装虚拟环境与Pytorch 最好要安装虚拟环境，否则要是把python环境安装坏了，那就麻烦了。
1.在命令行输入一下代码，其中nnUnet是虚拟环境名称，选择的python3.7版本
conda create -n nnUnet python=3.7 2.激活虚拟环境输入
activate nnUnet 如果退出虚拟环境使用命令deactivate
3.安装Pytorch，我选的是最新的版本pytorch1.9.0，cuda版本为10.2，这个就不详细叙说了，网上有很多教程。
3.安装apex 在上面给的链接中 有apex安装包，或者你可以在官网上下载apex
然后cd 到apex文件下目录，输入命令
pip install -v --no-cache-dir --global-option=&#34;–cpp_ext&#34; --global-option=&#34;–cuda_ext&#34; ./ 如果这个命令报错的话就换下面命令试试
python setup.py install 这里我盗用一下网上的截图，因为我忘了截图了，如果是success则表示安装成功。有别的教程说要按照hiddenlayer，我还没有安装，反正没有出现问题，出现问题再说。如果想安装的先安装git，conda install git。然后以下输入命令
pip install --upgrade git&#43;https://github.com/nanohanno/hiddenlayer.git@bugfix/get_trace_graph#egg=hiddenlayer 4.安装nnUnet 你可以下载我上面提供的代码，你也可以下载nnUnet官方代码，但是在windows下需要改很多地方。
cd 到nnUnet文件目录，输入命令，别丢了一个&#34;.&#34;，否则你无法安装。
pip install -e . 如果没有报错的话，恭喜你安装成功，如果报错的话，建议你在官网下载最新的代码，然后升级到最新的python库以及pytorch版本。
5.运行nnUnet 如果你是第一次使用nnUnet的话，建议你先下载官方数据集跑一遍，如果成功的话，在制作自己的数据集。
1.创建文件夹
在nnUnet文件目录下创建Dataset文件夹，当然你也可以在其他地方创建其他名字。
下面创建的文件夹一定要一样，在Dataset文件夹下创建三分文件夹，如下图所示，其中nnUnet_preprocessed用于预处理后的数据，nnUnet_raw用于存储原数据和裁剪的数据，nnUnet_trained_models用于存储训练模型与日志。
然后在nnUnet_raw文件夹下载创建如下两个文件夹，nnUnet_cropped_data用于存放预处理数据， nnUNet_raw_data用于存放原数据。
设置文件路径，我从官网下载的是Task08_HepaticVessel数据集，随便找一个地方解压。 关键地方来了，这是所有教程没有提到的地方
在linux下要将上面创建的文件添加到系统环境中，但是在windows下没法操作，所以在nnUnet文件夹下找到paths.py文件，然后修改一下三处，注释掉红色框出来的地方，然后换成黄色框出来的地方，文件目录对应你自己的路径。注意：文件路径千万不要写成“//”，就像我下面写的那样就行。否则你会遇到各种错误，这就是windows一直报错的最大原因。
3.转换数据格式，使用以下命令
nnUNet_convert_decathlon_task -i D:\Task08_HepaticVessel\Task08_HepaticVessel 上面是我的路径，你可以换成自己的路径，但我不建议在命令行中运行代码，否则报错的话就很难查到原因，所以可以用下面的方式运行。下面又是干货。
在nnunet\experiment_planning文件夹下找到nnUNet_convert_decathlon_task.py，打开pycharm，然后点击图中地方
在红色框中输入-i D:\Task08_HepaticVessel\Task08_HepaticVessel，然后运行即可，这样报错的话，你可以慢慢调试，寻找错误的地方。
如果运行成功的话，你会在nnUNet_raw_data文件夹下得到如下文件与数据。imagesTr存放的是训练数据，imagesTs是存放测试数据，labelsTr存放的是训练数据的标签， dataset.json是对数据的说明，和存放数据地址。
4.对数据进行预处理，同样不建议使用命令行代码运行，在相同目录下找到nnUNet_plan_and_preprocess.py文件，输入参数" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/60b71887377f93b219290f8fbc74d48a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-11T21:24:46+08:00" />
<meta property="article:modified_time" content="2021-08-11T21:24:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在windows下安装nnUnet，并制作数据集以及运行（让隔壁奶奶也能学会的教程）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1.前言</h3> 
<p>nnUnet原代码是在Linux下运行，如果现在windows下安装的话，会报各种错误，得改很多的地方，所以可以直接下载<a href="https://download.csdn.net/download/weixin_42795611/21018160">nnUnet_windows文件</a>，这是我已经在windows上成功编译的版本，只要安装成功就可以直接运行。该链接中还包含apex安装包以及制作自己数据格式的代码。<br> nnUnet的版本是2021/7月更新的。</p> 
<h3><a id="2Pytorch_4"></a>2.安装虚拟环境与Pytorch</h3> 
<p>最好要安装虚拟环境，否则要是把python环境安装坏了，那就麻烦了。<br> 1.在命令行输入一下代码，其中nnUnet是虚拟环境名称，选择的python3.7版本</p> 
<pre><code class="prism language-bash">conda create -n nnUnet <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.7</span>
</code></pre> 
<p>2.激活虚拟环境输入</p> 
<pre><code class="prism language-bash">activate nnUnet
</code></pre> 
<p>如果退出虚拟环境使用命令<code>deactivate</code></p> 
<p>3.安装Pytorch，我选的是最新的版本pytorch1.9.0，cuda版本为10.2，这个就不详细叙说了，网上有很多教程。</p> 
<h3><a id="3apex_20"></a>3.安装apex</h3> 
<p>在上面给的链接中 有apex安装包，或者你可以在官网上下载<a href="https://github.com/NVIDIA/apex">apex</a><br> 然后cd 到apex文件下目录，输入命令</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> -v --no-cache-dir --global-option<span class="token operator">=</span><span class="token string">"–cpp_ext"</span> --global-option<span class="token operator">=</span><span class="token string">"–cuda_ext"</span> ./
</code></pre> 
<p>如果这个命令报错的话就换下面命令试试</p> 
<pre><code>python setup.py install
</code></pre> 
<p><img src="https://images2.imgbox.com/32/14/eptQVSVF_o.png" alt="在这里插入图片描述"><br> 这里我盗用一下网上的截图，因为我忘了截图了，如果是success则表示安装成功。有别的教程说要按照hiddenlayer，我还没有安装，反正没有出现问题，出现问题再说。如果想安装的先安装git，<code>conda install git</code>。然后以下输入命令</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> --upgrade git+https://github.com/nanohanno/hiddenlayer.git@bugfix/get_trace_graph<span class="token comment">#egg=hiddenlayer</span>
</code></pre> 
<h3><a id="4nnUnet_40"></a>4.安装nnUnet</h3> 
<p>你可以下载我上面提供的代码，你也可以下载<a href="https://github.com/MIC-DKFZ/nnUNet.git">nnUnet官方代码</a>，但是在windows下需要改很多地方。<br> cd 到nnUnet文件目录，输入命令，别丢了一个"."，否则你无法安装。</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> -e <span class="token builtin class-name">.</span>
</code></pre> 
<p>如果没有报错的话，恭喜你安装成功，如果报错的话，建议你在官网下载最新的代码，然后升级到最新的python库以及pytorch版本。</p> 
<h3><a id="5nnUnet_48"></a>5.运行nnUnet</h3> 
<p>如果你是第一次使用nnUnet的话，建议你先下载<a href="https://www.oschina.net/action/GoToLink?url=https://drive.google.com/drive/folders/1HqEgzS8BV2c7xYNrZdEAnrHk7osJJ--2" rel="nofollow">官方数据集</a>跑一遍，如果成功的话，在制作自己的数据集。</p> 
<p>1.创建文件夹<br> 在nnUnet文件目录下创建Dataset文件夹，当然你也可以在其他地方创建其他名字。<br> <img src="https://images2.imgbox.com/bb/ea/fMRe40pr_o.png" alt="在这里插入图片描述"><br> 下面创建的文件夹一定要一样，在Dataset文件夹下创建三分文件夹，如下图所示，其中nnUnet_preprocessed用于预处理后的数据，nnUnet_raw用于存储原数据和裁剪的数据，nnUnet_trained_models用于存储训练模型与日志。</p> 
<p><img src="https://images2.imgbox.com/86/12/lBlri3Aj_o.png" alt="在这里插入图片描述"><br> 然后在nnUnet_raw文件夹下载创建如下两个文件夹，nnUnet_cropped_data用于存放预处理数据， nnUNet_raw_data用于存放原数据。<br> <img src="https://images2.imgbox.com/a0/d1/XVXeVB8h_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>设置文件路径，我从官网下载的是Task08_HepaticVessel数据集，随便找一个地方解压。</li></ol> 
<p><em>关键地方来了</em>，这是所有教程没有提到的地方<br> 在linux下要将上面创建的文件添加到系统环境中，但是在windows下没法操作，所以在nnUnet文件夹下找到paths.py文件，然后修改一下三处，注释掉红色框出来的地方，然后换成黄色框出来的地方，文件目录对应你自己的路径。注意：文件路径千万不要写成“//”，就像我下面写的那样就行。否则你会遇到各种错误，这就是windows一直报错的最大原因。<br> <img src="https://images2.imgbox.com/c3/38/GMWkNbK2_o.png" alt="在这里插入图片描述"></p> 
<p>3.转换数据格式，使用以下命令</p> 
<pre><code class="prism language-bash">nnUNet_convert_decathlon_task -i D:<span class="token punctuation">\</span>Task08_HepaticVessel<span class="token punctuation">\</span>Task08_HepaticVessel
</code></pre> 
<p>上面是我的路径，你可以换成自己的路径，但我不建议在命令行中运行代码，否则报错的话就很难查到原因，所以可以用下面的方式运行。下面又是干货。<br> 在nnunet\experiment_planning文件夹下找到nnUNet_convert_decathlon_task.py，打开pycharm，然后点击图中地方<br> <img src="https://images2.imgbox.com/53/a6/cQ9srbxF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/02/2e/1r1tWYUV_o.png" alt="在这里插入图片描述"><br> 在红色框中输入-i D:\Task08_HepaticVessel\Task08_HepaticVessel，然后运行即可，这样报错的话，你可以慢慢调试，寻找错误的地方。</p> 
<p>如果运行成功的话，你会在nnUNet_raw_data文件夹下得到如下文件与数据。imagesTr存放的是训练数据，imagesTs是存放测试数据，labelsTr存放的是训练数据的标签， dataset.json是对数据的说明，和存放数据地址。<br> <img src="https://images2.imgbox.com/5a/eb/S8zXqg4u_o.png" alt="在这里插入图片描述"><br> 4.对数据进行预处理，同样不建议使用命令行代码运行，在相同目录下找到nnUNet_plan_and_preprocess.py文件，输入参数</p> 
<pre><code class="prism language-bash">-t <span class="token number">8</span>
</code></pre> 
<p>其中8对应数据的Id，如果是下载我编译好的代码的话，可以直接运行，如果下载的官方的代码，你会在这遇到一堆问题。<br> 当然你可能还会遇到一个问题，就是电脑cpu内存不够，我电脑的配置是32g内存依然不够，所以我在裁剪数据的时候，只挑选了其中一部分数据集。</p> 
<p>如果运行没报错的话，你会在nnUnet_preprocessed文件夹下生成如下的文件夹以及数据<br> <img src="https://images2.imgbox.com/3b/e8/aZF9Xpme_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_90"></a>5.开始训练</h3> 
<p>如果前面一切顺利的话，后面就可以直接运行了在命令行中输入<br> <code>nnUNet_train 3d_fullres nnUNetTrainerV2 8 4</code>，<br> 如果你想调试的话，但是你会发现找不到nnUNet_train文件，这是集成好的nnUNet_train.exe，位置在你安装虚拟环境中。所以换一个文件运行。<br> 在文件夹nnunet\run下找到run_training.py，输入参数，<code>3d_fullres nnUNetTrainerV2 8 4</code>。其中8代表你的任务ID，4代表五折交叉验证（0代表一折）。</p> 
<p>运行成功后你会在如下文件路径中得到训练的日志以及模型。如果少一个文件的话都有可能代表你运行失败，会影响后面的推理。<br> <img src="https://images2.imgbox.com/fc/77/p9DnUl4k_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6_98"></a>6.推理</h3> 
<p>在windows下使用多线程用的是<br> 训练完成后，找到imagesTs路径，就是上面制作数据集的路径，然后输入命令pathos库，所以可能需要安装，输入命令</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> pathos
</code></pre> 
<p>然后推理的时候输入命令</p> 
<pre><code class="prism language-bash">nnUNet_predict -i F:<span class="token punctuation">\</span>nnUNet_windows<span class="token punctuation">\</span>DataSet<span class="token punctuation">\</span>nnUnet_raw<span class="token punctuation">\</span>nnUNet_raw_data<span class="token punctuation">\</span>Task008_HepaticVessel<span class="token punctuation">\</span>imagesTs -o F:<span class="token punctuation">\</span>nnUNet_windows<span class="token punctuation">\</span>DataSet<span class="token punctuation">\</span>nnUnet_raw<span class="token punctuation">\</span>nnUNet_raw_data<span class="token punctuation">\</span>Task008_HepaticVessel<span class="token punctuation">\</span>imagesTs_infer -t <span class="token number">8</span> -m 3d_fullres -f <span class="token number">4</span>
</code></pre> 
<p>其中-i 参数的是输入路径，-o 参数是输出路径。</p> 
<p>如果你想调试的话，在inference文件夹中找到predict_simple.py文件，然后输入参数就可以调试了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b8981e6f913d26163bdc7cded1c635a2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">dns服务器如何修改静态dns条目,如何配置本地DNS静态域名解析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/39f58b661dcc676119813ab59a2eed00/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">魔方世界服务器文件,魔方世界服务器指令 | 手游网游页游攻略大全</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>