<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ansible中的角色使用 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ansible中的角色使用" />
<meta property="og:description" content="目录
ansible 角色简介
创建目录结构
role存放的路径在配置文件ansible.cfg中定义
例：vsftpd的安装和部署
ansible—galaxy命令工具
安装网络源
install local roles 安装本地roles
ansible 角色简介 *Ansible roles 是为了层次化，结构化的组织Playbook
* roles就是通过分别将变量、文件、任务、模块及处理器放置于单独的目录中，并可以便捷地include它们
* roles一般用于基于主机构建服务的场景中，在企业复杂业务场景中应用的频率很高
* 以特定的层级目录结构进行组织的tasks、variables、handlers、templates、files等；相当于函数的调用把各个功能切割 成片段来执行。
创建目录结构 ansible-galaxy init apache ansible-galaxy list
role存放的路径在配置文件ansible.cfg中定义 roles_path = ~/.ansible/westos （默认目录：/etc/ansible/roles）
roles目录结构
files
存放copy或script等模块调用的函数
tasks
定义各种task，要有main.yml，其他文件include包含调用
handlers
定义各种handlers，要有main.yml，其他文件include包含调用
vars
定义variables，要有main.yml，其他文件include包含调用
templates
存储由template模块调用的模板文本
meta
定义当前角色的特殊设定及其依赖关系，要有main.yml的文件
defaults 要有main.yml的文 件，用于设定默认变量
tests
用于测试角色
例：vsftpd的安装和部署 配置文件中的内容
tasks/main.yml
vars/main.yml
handlers/main.yml
templates/vsftpd.conf.j2
ansible—galaxy命令工具 * Ansible Galaxy 是一个免费共享和下载 Ansible 角色的网站，可以帮助我们更好的定义和学习roles。
* ansible-galaxy命令默认与https://galaxy.ansible.com网站API通信，可以查找、下载各种社区开发的 Ansible 角色" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/80b06e817ba5c8885073950343f30d50/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-02T16:01:34+08:00" />
<meta property="article:modified_time" content="2022-08-02T16:01:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ansible中的角色使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="ansible%20%E8%A7%92%E8%89%B2%E7%AE%80%E4%BB%8B-toc" style="margin-left:0px;"><a href="#ansible%20%E8%A7%92%E8%89%B2%E7%AE%80%E4%BB%8B" rel="nofollow">ansible 角色简介</a></p> 
<p id="%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-toc" style="margin-left:40px;"><a href="#%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" rel="nofollow">创建目录结构</a></p> 
<p id="role%E5%AD%98%E6%94%BE%E7%9A%84%E8%B7%AF%E5%BE%84%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6ansible.cfg%E4%B8%AD%E5%AE%9A%E4%B9%89-toc" style="margin-left:40px;"><a href="#role%E5%AD%98%E6%94%BE%E7%9A%84%E8%B7%AF%E5%BE%84%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6ansible.cfg%E4%B8%AD%E5%AE%9A%E4%B9%89" rel="nofollow">role存放的路径在配置文件ansible.cfg中定义</a></p> 
<p id="%C2%A0%E4%BE%8B%EF%BC%9Avsftpd%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2-toc" style="margin-left:0px;"><a href="#%C2%A0%E4%BE%8B%EF%BC%9Avsftpd%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2" rel="nofollow"> 例：vsftpd的安装和部署</a></p> 
<p id="ansible%E2%80%94galaxy%E5%91%BD%E4%BB%A4%E5%B7%A5%E5%85%B7-toc" style="margin-left:0px;"><a href="#ansible%E2%80%94galaxy%E5%91%BD%E4%BB%A4%E5%B7%A5%E5%85%B7" rel="nofollow">ansible—galaxy命令工具</a></p> 
<p id="%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E6%BA%90-toc" style="margin-left:40px;"><a href="#%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E6%BA%90" rel="nofollow">安装网络源</a></p> 
<p id="install%20local%20roles%20%E5%AE%89%E8%A3%85%E6%9C%AC%E5%9C%B0roles-toc" style="margin-left:40px;"><a href="#install%20local%20roles%20%E5%AE%89%E8%A3%85%E6%9C%AC%E5%9C%B0roles" rel="nofollow">install local roles 安装本地roles</a></p> 
<p></p> 
<h2 style="margin-left:0px;text-align:justify;">ansible 角色简介</h2> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>*</strong>Ansible roles 是为了层次化，结构化的组织Playbook</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>* </strong>roles就是通过分别将变量、文件、任务、模块及处理器放置于单独的目录中，并可以便捷地include它们</p> 
<p style="margin-left:.0001pt;text-align:justify;">* roles一般用于基于主机构建服务的场景中，在企业复杂业务场景中应用的频率很高</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>* </strong>以特定的层级目录结构进行组织的tasks、variables、handlers、templates、files等；相当于函数的调用把各个功能切割 成片段来执行。</p> 
<h3 id="%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" style="margin-left:.0001pt;text-align:justify;"><strong>创建目录结构</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">ansible-galaxy init apache </span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">ansible-galaxy list</span></p> 
<h3 id="role%E5%AD%98%E6%94%BE%E7%9A%84%E8%B7%AF%E5%BE%84%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6ansible.cfg%E4%B8%AD%E5%AE%9A%E4%B9%89" style="margin-left:.0001pt;text-align:justify;"><strong>role存放的路径在配置文件ansible.cfg中定义</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">roles_path = ~/.ansible/westos</span> （默认目录：/etc/ansible/roles）</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="273" src="https://images2.imgbox.com/99/5b/41SZMA3Z_o.png" width="567"></p> 
<p style="margin-left:.0001pt;text-align:justify;">roles目录结构</p> 
<p> <img alt="" height="45" src="https://images2.imgbox.com/9d/04/iWYltOlM_o.png" width="567"></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:.0001pt;text-align:justify;">files</p> </td><td style="border-color:#000000;vertical-align:top;width:339.95pt;"> <p style="margin-left:.0001pt;text-align:justify;">存放copy或script等模块调用的函数</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:.0001pt;text-align:justify;">tasks</p> </td><td style="vertical-align:top;width:339.95pt;"> <p style="margin-left:.0001pt;text-align:justify;">定义各种task，要有main.yml，其他文件include包含调用</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:.0001pt;text-align:justify;">handlers</p> </td><td style="vertical-align:top;width:339.95pt;"> <p style="margin-left:.0001pt;text-align:justify;">定义各种handlers，要有main.yml，其他文件include包含调用</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:.0001pt;text-align:justify;">vars</p> </td><td style="vertical-align:top;width:339.95pt;"> <p style="margin-left:.0001pt;text-align:justify;">定义variables，要有main.yml，其他文件include包含调用</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:.0001pt;text-align:justify;">templates</p> </td><td style="vertical-align:top;width:339.95pt;"> <p style="margin-left:.0001pt;text-align:justify;">存储由template模块调用的模板文本</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:.0001pt;text-align:justify;">meta</p> </td><td style="vertical-align:top;width:339.95pt;"> <p style="margin-left:.0001pt;text-align:justify;">定义当前角色的特殊设定及其依赖关系，要有main.yml的文件</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:.0001pt;text-align:justify;">defaults </p> </td><td style="vertical-align:top;width:339.95pt;"> <p style="margin-left:.0001pt;text-align:justify;">要有main.yml的文 件，用于设定默认变量</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:.0001pt;text-align:justify;">tests</p> </td><td style="vertical-align:top;width:339.95pt;"> <p style="margin-left:.0001pt;text-align:justify;">用于测试角色</p> </td></tr></tbody></table> 
<h2 id="%C2%A0%E4%BE%8B%EF%BC%9Avsftpd%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%83%A8%E7%BD%B2"> 例：vsftpd的安装和部署</h2> 
<p style="margin-left:.0001pt;text-align:justify;">配置文件中的内容</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">tasks/main.yml</span></p> 
<p><span style="color:#ff0000;">vars/main.yml</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="463" src="https://images2.imgbox.com/6f/96/9jCXav6K_o.png" width="567"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">handlers/main.yml</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">templates/vsftpd.conf.j2</span></p> 
<p> <img alt="" height="166" src="https://images2.imgbox.com/c8/5f/bF0MRo0N_o.png" width="567"></p> 
<p><img alt="" height="83" src="https://images2.imgbox.com/5e/28/KtOb6mXH_o.png" width="567"></p> 
<p><img alt="" height="320" src="https://images2.imgbox.com/5e/d2/tTQEp5YZ_o.png" width="567"></p> 
<h2 id="ansible%E2%80%94galaxy%E5%91%BD%E4%BB%A4%E5%B7%A5%E5%85%B7" style="margin-left:0px;text-align:justify;">ansible—galaxy命令工具</h2> 
<p style="margin-left:.0001pt;text-align:justify;">* Ansible Galaxy 是一个免费共享和下载 Ansible 角色的网站，可以帮助我们更好的定义和学习roles。</p> 
<p style="margin-left:.0001pt;text-align:justify;">* ansible-galaxy命令默认与https://galaxy.ansible.com网站API通信，可以查找、下载各种社区开发的 Ansible 角色</p> 
<p style="margin-left:.0001pt;text-align:justify;">* ansible-galaxy在 Ansible 1.4.2 就已经被包含了</p> 
<p style="margin-left:.0001pt;text-align:justify;">* 在galaxy.ansible.com网站查询roles</p> 
<p style="margin-left:.0001pt;text-align:justify;">安装选择的角色</p> 
<h3 id="%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E6%BA%90" style="margin-left:.0001pt;text-align:justify;">安装网络源</h3> 
<p style="margin-left:.0001pt;text-align:justify;">$ansible-galaxy install geerlingguy.nginx </p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="306" src="https://images2.imgbox.com/ea/cd/XsgCL2hj_o.png" width="567"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="311" src="https://images2.imgbox.com/4c/2f/jsCeq1C5_o.png" width="567"></p> 
<p><img alt="" height="190" src="https://images2.imgbox.com/a0/4b/n3UNNUt2_o.png" width="567"> </p> 
<h3 id="install%20local%20roles%20%E5%AE%89%E8%A3%85%E6%9C%AC%E5%9C%B0roles" style="margin-left:.0001pt;text-align:justify;"><strong>install local roles 安装本地roles</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">$ vim role.yml</p> 
<p style="margin-left:.0001pt;text-align:justify;">- src: file:///mnt/vsftpd.tar.gz</p> 
<p style="margin-left:.0001pt;text-align:justify;">name: vsftpd</p> 
<p style="margin-left:.0001pt;text-align:justify;">$ ansible-galaxy install -r role.yml</p> 
<p> <img alt="" height="158" src="https://images2.imgbox.com/32/b5/3Hk5xYm8_o.png" width="557"></p> 
<p><img alt="" height="354" src="https://images2.imgbox.com/06/42/bReFKM5k_o.png" width="567"> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c0c629ff8d164fdbc3f2360e2b17be1c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">@Test单元测试注入bean 3种方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/96c9da61c555ca8200c6832e20459088/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">学术写作科研工具推荐</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>