<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>前端FLV视频直播解决方案 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="前端FLV视频直播解决方案" />
<meta property="og:description" content="项目背景： 1. 后台给出一个地址，持续不断的推送flv视频流。
2.前端需要接收视频流，并寻找合适的播放插件。
一开始： 其实用的是xgplayer（西瓜视频）。
官网地址：西瓜播放器
使用的是直播，flv的插件：西瓜播放器 | xgplayer-flv。
但是无法播放，现象就是一直loading；
后来，查了好多资料，发现一个issue：
流数据正常下载，xgplayer-flv无法播放 · Issue #604 · bytedance/xgplayer · GitHub。
和我情况一模一样，但是暂时没有什么解决方案。说明，此路不通。
柳暗花明： 找了很久，找到一个万能播放插件 —— Jessibuca。
官网地址：Jessibuca
如何使用： 前端如何使用？建议直接下载相关资源，静态引入。
需要下载三个资源，如下图：
怎么找到这三个资源？去官网的network里找找吧，不在多说。
vue中使用详情： 首先，上边的三个文件引入public。在index.html文件中只需要引入jessibuca.js。
&lt;!-- public下的index.html 直接引入js文件 --&gt; .... &lt;script src=&#34;&lt;%= BASE_URL %&gt;jessibuca.js&#34;&gt;&lt;/script&gt; ..... 然后,创建视频播放组件 LiveVideoPlay.vue:
&lt;script&gt; export default { name: &#34;LiveVideoPlay&#34;, props: { // 播放地址 playUrl: { type: String, required: true, }, // 目标domid id: { type: String, required: true, }, }, data() { return { player: null, }; }, methods: { // 初始化视频组件 initPlayer() { if (Jessibuca) { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/c28ab6d5587458eeb9f03168fd81231f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-22T15:07:34+08:00" />
<meta property="article:modified_time" content="2023-12-22T15:07:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">前端FLV视频直播解决方案</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>项目背景：</h4> 
<p>1. 后台给出一个地址，持续不断的推送flv视频流。</p> 
<p>2.前端需要接收视频流，并寻找合适的播放插件。</p> 
<h4>一开始：</h4> 
<p>其实用的是xgplayer（西瓜视频）。</p> 
<p>官网地址：<a href="http://h5player.bytedance.com/" rel="nofollow" title="西瓜播放器">西瓜播放器</a></p> 
<p>使用的是直播，flv的插件：<a href="http://h5player.bytedance.com/plugins/extension/xgplayer-flv.html#%E5%AE%89%E8%A3%85" rel="nofollow" title="西瓜播放器 | xgplayer-flv">西瓜播放器 | xgplayer-flv</a>。</p> 
<p>但是无法播放，现象就是一直<strong>loading</strong>；</p> 
<p>后来，查了好多资料，发现一个issue：</p> 
<p><a href="https://github.com/bytedance/xgplayer/issues/604" title="流数据正常下载，xgplayer-flv无法播放 · Issue #604 · bytedance/xgplayer · GitHub">流数据正常下载，xgplayer-flv无法播放 · Issue #604 · bytedance/xgplayer · GitHub</a>。</p> 
<p><img alt="" height="370" src="https://images2.imgbox.com/3f/6a/44woD0up_o.png" width="1181"></p> 
<p>和我情况一模一样，但是暂时没有什么解决方案。说明，<strong>此路不通</strong>。</p> 
<h4>柳暗花明：</h4> 
<p>找了很久，找到一个万能播放插件 —— <strong>Jessibuca</strong>。</p> 
<p>官网地址：<a href="http://jessibuca.monibuca.com/" rel="nofollow" title="Jessibuca">Jessibuca</a></p> 
<p></p> 
<h4>如何使用：</h4> 
<p>前端如何使用？建议直接下载相关资源，静态引入。</p> 
<p>需要下载三个资源，如下图：</p> 
<p><img alt="" height="170" src="https://images2.imgbox.com/85/b2/bwNqLG1c_o.png" width="365"></p> 
<p>怎么找到这三个资源？去<strong>官网的network</strong>里找找吧，不在多说。</p> 
<p></p> 
<h4>vue中使用详情：</h4> 
<p>首先，上边的三个文件引入public。在index.html文件中<strong>只需要引入jessibuca.js。</strong></p> 
<pre><code class="language-html">&lt;!-- 

public下的index.html 直接引入js文件

--&gt;



....


&lt;script src="&lt;%= BASE_URL %&gt;jessibuca.js"&gt;&lt;/script&gt;





.....</code></pre> 
<p>然后,创建视频播放组件<strong> LiveVideoPlay.vue:</strong></p> 
<pre><code class="language-javascript">&lt;script&gt;
export default {
  name: "LiveVideoPlay",
  props: {
    // 播放地址
    playUrl: {
      type: String,
      required: true,
    },
    // 目标domid
    id: {
      type: String,
      required: true,
    },
  },
  data() {
    return {
      player: null,
    };
  },
  methods: {
    // 初始化视频组件
    initPlayer() {
      if (Jessibuca) {
        this.player = new Jessibuca({
          container: document.getElementById(this.id), //jessibuca需要容器
          videoBuffer: 0.2, // 缓存时长
          isResize: false,
          loadingText: "疯狂加载中...",
          useMSE: true,
          useWCS: true,
          debug: true,
          background: "@/assets/icons/svg/no-video.svg",
          supportDblclickFullscreen: true,
          showBandwidth: true, // 显示网速
          operateBtns: {
            fullscreen: true,
            screenshot: true,
            play: true,
            audio: true,
          },
          forceNoOffscreen: true,
          isNotMute: false,
          timeout: 10,
        });
        //console.log("this.player ----- ", this.player, this.playUrl);
        this.player.play(this.playUrl);
      }
    },
  },
  beforeDestroy() {
    // 销毁视频
    if (this.player) {
      this.player.destroy();
      this.player = null;
    }
  },
  mounted() {
    this.initPlayer();
  },
};
&lt;/script&gt;
&lt;template&gt;
  &lt;div class="video-player-outer" :id="id"&gt;&lt;/div&gt;
&lt;/template&gt;
&lt;style&gt;
.video-player-outer {
  width: 100%;
  height: 100%;
}
&lt;/style&gt;
</code></pre> 
<p>最后,父组件中直接引用:</p> 
<pre><code class="language-javascript">// 父组件中直接使用该组件

&lt;script&gt;
import LiveVideoPlay from "./LiveVideoPlay.vue";
export default {
    name: '',
    components: {
        LiveVideoPlay 
    },
    data () {
        return {
            playUrl1: null,
            playUrl2: null,
            showV1: false,
            showV2: false,
        }
    },
    methods: {
        handlePlayVideo(v) {
      if (v == 1) {
        this.playUrl1 =
          "https://xxxxxx/live/02.live.flv";
        this.showV1 = true;
      } else if (v == 2) {
        this.playUrl2 =
          "https://xxxxxx/live/02.live.flv";
        this.showV2 = true;
      }
    },
    StopPlayVideo(v) {
      if (v == 1) {
        this.showV1 = false;
      } else if (v == 2) {
        this.showV2 = false;
      }
    }, 
    },
}

&lt;/script&gt;

&lt;template&gt;

    &lt;div class="box"&gt;
          &lt;div class="video-box-item"&gt;
            &lt;el-button @click="handlePlayVideo(1)"&gt;播放视频1&lt;/el-button&gt;
            &lt;el-button @click="StopPlayVideo(1)"&gt;停止视频1&lt;/el-button&gt;
            &lt;LiveVideoPlay v-if="showV1" :playUrl="playUrl1" id="v1" /&gt;
          &lt;/div&gt;

          &lt;div class="video-box-item"&gt;
            &lt;el-button @click="handlePlayVideo(2)"&gt;播放视频2&lt;/el-button&gt;
            &lt;el-button @click="StopPlayVideo(2)"&gt;停止视频2&lt;/el-button&gt;
            &lt;LiveVideoPlay v-if="showV2" :playUrl="playUrl2" id="v2" /&gt;
          &lt;/div&gt;
    &lt;/div&gt;

&lt;/template&gt;</code></pre> 
<p>如上,可以试一试自己的播放地址是否可以成功播放视频.如果你的需求不那么高,不考虑延迟,到这里基本就够了,不需要卷下去.</p> 
<p>但是,如果你的要求比较高,又不想买jecibuca的收费版本,那么请继续往下看, 有更好的解决方案.</p> 
<p></p> 
<h4>优中选优:</h4> 
<p>现在这个功能是做出来了,但是视频延迟的问题比较突出.比如,我控制摄像头旋转一下位置,在上述解决方案中,会明显发现摄像头触发旋转进而回传视频明显延迟.那怎么办? 如果你要求不高,那么上边的解决方案足够使用,但是如果<strong>要求低延迟</strong>,那么就不得不祭出另个大杀器了 - <a href="https://www.liveqing.com/" rel="nofollow" title="LiveQing">LiveQing</a>.</p> 
<p>官网地址: <a href="https://www.liveqing.com/docs/manuals/LivePlayer.html#%E6%96%B9%E6%B3%95-method" rel="nofollow" title="LivePlayer H5播放器 | 青柿视频流媒体服务解决方案">LivePlayer H5播放器 | 青柿视频流媒体服务解决方案</a></p> 
<p>如何使用? <strong>vue2中</strong>大概分为这几步骤(vue3+vite的可以参考官网):</p> 
<p>1. 安装 Liveplayer:</p> 
<pre><code class="language-bash">npm install @liveqing/liveplayer</code></pre> 
<p>2. 安装 webpack 插件 copy-webpack-plugin</p> 
<pre><code class="language-bash">npm install copy-webpack-plugin@4.6.0</code></pre> 
<p><strong>注意: 如果你的版本是vuecli4.0+, 那么以上这个版本就够用了.但是 如果你的vuecli5.0+, 你需要升级这个copywebpack-plugins的版本,比如 <span style="color:#fe2c24;">copy-webpack-plugin@11.0.0</span> .亲测有效,一定要注意!!!</strong></p> 
<p>3. 配置vue.config.js</p> 
<pre><code class="language-javascript">/**  vue.config.js   */

// *****  注意 还是vuecli版本的问题
// *****  如果你的vuelci4.0+  就用下边这个配置

const CopyWebpackPlugin = require("copy-webpack-plugin");

module.exports = {

    ...


    configureWebpack: (config) =&gt; {
        config.devtool = "source-map";
        config.output.libraryExport =
                      "default"; /* 解决import UMD打包文件时, 组件install方法执行报错的问题！！ */



        // 增加配置如下  主要是 plugins

        const plugins = [
          new CopyWebpackPlugin([
            {
              from: "node_modules/@liveqing/liveplayer/dist/component/crossdomain.xml",
            },
            {
              from: "node_modules/@liveqing/liveplayer/dist/component/liveplayer.swf",
            },
            {
              from: "node_modules/@liveqing/liveplayer/dist/component/liveplayer-lib.min.js",
              to: "livePlayer/",
            },
      ]),
    ];
        config.plugins.push(...plugins);

      
    }
  },


    ...

}


// *****  如果你的vuelci5.0+  就用下边这个配置

const CopyWebpackPlugin = require("copy-webpack-plugin");


module.exports = {


    .....


    chainWebpack(config) {
        
        // 增加插件
        
        config.plugin('copy').use(CopyWebpackPlugin, [

           {
                 patterns: [
            {
              from: "node_modules/@liveqing/liveplayer/dist/component/crossdomain.xml",
            },
            {
              from: "node_modules/@liveqing/liveplayer/dist/component/liveplayer.swf",
            },
            {
              from: "node_modules/@liveqing/liveplayer/dist/component/liveplayer-lib.min.js",
              to: "livePlayer/",
            },
      ]
            }
        ])

        
    }
    


}</code></pre> 
<p>4. public中的index.html中引入js文件</p> 
<p><img alt="" height="237" src="https://images2.imgbox.com/79/a2/xuP2v6XQ_o.png" width="1200"></p> 
<p>5. 封装播放视频组件</p> 
<pre><code class="language-javascript">&lt;template&gt;
  &lt;LivePlayer
    class="component-wrapper video-panel"
    :class="{ fullscreen: flag }"
    :videoUrl="options.url"
    :videoTitle="options.title"
    :poster="options.poster"
    :controls="options.controls"
    :autoplay="options.autoplay"
    :live="options.live"
    :hide-snapshot-button="options.hideSnapshot"
    :muted="options.muted"
    :fluent="options.fluent"
    :stretch="options.stretch"
    :aspect="options.aspect"
    :loading="options.loading"
    :hide-big-play-button="options.hideBigPlay"
    @fullscreen="onFullscreen"
  &gt;
    &lt;slot&gt;&lt;/slot&gt;
  &lt;/LivePlayer&gt;
&lt;/template&gt;

&lt;script&gt;
import LivePlayer from "@liveqing/liveplayer";

export default {
  name: "LiveVideoRtcPlayer",
  components: {
    LivePlayer,
  },
  props: {
    params: {
      type: String,
    },
  },
  data() {
    return {
      flag: false,
    };
  },
  computed: {
    options() {
      return {
        // 播放地址
        url: this.params,
        // 视频标题
        title: "",
        // 视频封面图片
        poster: "",
        // 播放器控制栏
        controls: true,
        // 隐藏截图
        hideSnapshot: true,
        // 是否直播
        live: true,
        // 是否自动播放
        autoplay: true,
        // 是否静音
        muted: true,
        // 流畅模式
        fluent: true,
        // 是否拉伸
        stretch: true,
        // 全屏 - 适应div
        aspect: "fullscreen",
        // 指示加载状态
        loading: true,
        // 隐藏起播状态下的大播放按钮
        hideBigPlay: true,
      };
    },
  },
  created() {
    console.log("配置 ----- ", this.options);
  },
  beforeDestroy() {
    if (this.options) {
      this.options.url = "";
    }
    this.onExitFullscreen();
  },
  methods: {
    onExitFullscreen() {
      this.flag = false;
    },
    onFullscreen(status) {
      this.flag = status;
      if (!status) {
        this.onExitFullscreen();
        return;
      }
    },
  },
};
&lt;/script&gt;

&lt;style lang="scss" scoped&gt;
.component-wrapper.video-panel {
  position: relative;
  width: 100%;
  height: 100%;

  .video-wrapper .video-js {
    background-color: rgba(32, 46, 71, 0.6);

    .video-title {
      top: 4px;
      right: unset;
      left: 4px;
      padding: 4px 6px;
      max-width: 80%;
      font-size: 16px;
    }

    .video-control {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translate(-50%, -140%);
      margin-top: 0;
    }
  }

  &amp;.fullscreen .video-wrapper .video-js {
    .video-title {
      top: 60px;
      right: unset;
      left: 20px;
      padding: 5px 8px 6px;
      background: rgba(4, 16, 37, 0.6);
      border-radius: 4px;
    }
  }
}
&lt;/style&gt;
</code></pre> 
<p>6. 父组件中引用播放组件</p> 
<pre><code class="language-javascript">&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;!-- 视频 --&gt;
    &lt;div class="video-box"&gt;
      &lt;el-button @click="handlePlayVideo(1)"&gt;播放视频1&lt;/el-button&gt;
      &lt;el-button @click="StopPlayVideo(1)"&gt;停止视频1&lt;/el-button&gt;
      &lt;div class="video-box-item"&gt;
        &lt;LiveVideoRtcPlayer v-if="showV1" :params="playUrl1" id="v1" /&gt;
      &lt;/div&gt;
      &lt;el-button @click="handlePlayVideo(2)"&gt;播放视频2&lt;/el-button&gt;
      &lt;el-button @click="StopPlayVideo(2)"&gt;停止视频2&lt;/el-button&gt;
      &lt;div class="video-box-item"&gt;
        &lt;LiveVideoRtcPlayer v-if="showV2" :params="playUrl2" id="v2" /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
//import Child from "./Child.vue";
//import LiveVideoPlay from "./LiveVideoPlay.vue";
import LiveVideoRtcPlayer from "./LiveVideoRtcPlayer.vue";
export default {
  name: "App",
  components: {
    //LiveVideoPlay,
    LiveVideoRtcPlayer,
  },
  data() {
    return {
      playUrl1: null,
      playUrl2: null,
      showV1: false,
      showV2: false,
    };
  },
  methods: {
    handlePlayVideo(v) {
      if (v == 1) {
        // this.playUrl1 =
        //   "https://xxxxxxxxxxxx/live/02.live.flv";
        this.playUrl1 =
          "webrtcs://xxxxxxxxxxxxx/live/index/api";
        this.showV1 = true;
      } else if (v == 2) {
        this.playUrl2 = 'xxxxx 播放地址';
        this.showV2 = true;
      }
    },
    StopPlayVideo(v) {
      if (v == 1) {
        this.showV1 = false;
      } else if (v == 2) {
        this.showV2 = false;
      }
    },
  },
};
&lt;/script&gt;

&lt;style lang="scss" scoped&gt;
#app {
  height: 100%;
}

#app ::v-deep .box {
  font-size: 30px;
}

.video-box {
  width: 100%;
  height: 600px;
  overflow: hidden;

  &amp;-item {
    width: 300px;
    height: 400px;
    float: left;
    overflow: hidden;
    background-color: #f1f2f3;
    margin-left: 50px;
    position: relative;
  }
}
&lt;/style&gt;
&lt;style lang="scss"&gt;&lt;/style&gt;
</code></pre> 
<p>测试一下,nice.</p> 
<p>累了,就这样吧.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f91ba31f5300161ff45a40e0f69bda15/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2023 英特尔On技术创新大会直播让我感受到英特尔AI的强大</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f3c5819461d6c27ae2a7760ec703d848/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">凯斯西储大学轴承数据解读</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>