<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>javascript经典面试题之for循环click - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="javascript经典面试题之for循环click" />
<meta property="og:description" content="经典重现 &lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;utf-8&#34;&gt; &lt;title&gt;&lt;/title&gt; &lt;script type=&#34;text/javascript&#34;&gt; function onMyLoad(){ var arr = document.getElementsByTagName(&#34;p&#34;); for(var i = 0; i &lt; arr.length; i&#43;&#43;){ arr[i].onclick = function(){ alert(i); } } } &lt;/script&gt; &lt;/head&gt; &lt;body onload=&#34;onMyLoad()&#34;&gt; &lt;p&gt;0&lt;/p&gt; &lt;p&gt;1&lt;/p&gt; &lt;p&gt;2&lt;/p&gt; &lt;p&gt;3&lt;/p&gt; &lt;p&gt;4&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; 该段代码期望实现效果如下：点击p标签，弹出该p标签位置序号。请问上述代码能否实现该需求，如果不能，应该如何实现？
原题分析 答案显而易见，不能。点击每个p标签都会弹出5。
要解决此问题，首先要了解闭包的概念。闭包是JavaScript语言的一个难点，也是它的特色，很多高级应用都要依靠它来实现。
变量作用域 JavaScript变量作用域的特点在于，函数内部可以读取该函数外部的变量，但函数外部无法读取该函数内部定义的变量，但是我们可以通过变通的方式获得。那就是在函数内部再定义一个函数：
function foo(){ var n=999; function fee(){ alert(n); // 999 } } 在上面的代码中，函数fee就被包括在函数foo内部，这时foo内部的所有局部变量，对fee都是可见的。但是反过来就不行，fee内部的局部变量，对foo就是不可见的。这就是Javascript语言特有的&#34;链式作用域&#34;结构（chain scope），子对象会一级一级地向上寻找所有父对象的变量。所以，父对象的所有变量，对子对象都是可见的，反之则不成立。
既然fee可以读取foo中的局部变量，那么只要把fee作为返回值，我们不就可以在foo外部读取它的内部变量了吗！
闭包的概念 简而言之，闭包就是能够读取其他函数内部变量的函数，由于在JavaScript语言中，只有函数内部的子函数才能读取局部变量，因此可以把闭包简单理解成定义在一个函数内部的函数。所以，在本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁。
闭包的用途 闭包可以用在许多地方。它的最大用处有两个，一个是前面提到的可以读取函数内部的变量，另一个就是让这些变量的值始终保持在内存中。
function f1(){ var n=999; nAdd=function(){ n&#43;=1 } function f2(){ alert(n); } return f2; } var result=f1(); result(); // 999 nAdd(); result(); // 1000 在这段代码中，result实际上就是闭包f2函数，它一共运行了两次，第一次的值是999，第二次的值是1000。这证明了，函数f1中的局部变量n一直保存在内存中，并没有在f1调用后被自动清除。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/83eb6a3d3a878f0ef7908db6eebc6242/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-03-10T17:30:21+08:00" />
<meta property="article:modified_time" content="2017-03-10T17:30:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">javascript经典面试题之for循环click</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="preview html_preview"> 
 <div class="xiaoshujiang_element xsj_anchor"> 
  <br> 
  <span style="color: inherit; font-family: inherit; font-size: 38.5px">经典重现</span> 
 </div> 
 <div class="xiaoshujiang_code_container" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; position: relative; padding-bottom: 2em"> 
  <pre><code class="language-html hljs" style="border: 0; font-size: 90%; background-color: #d6dbdf; color: #657b83; display: block; background: #fdf6e3; padding: 0.5em"><span class="hljs-doctype" style="color: #93a1a1">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">html</span> <span class="hljs-attribute" style="color: #b58900">lang</span>=<span class="hljs-value" style="color: #2aa198">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">head</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">meta</span> <span class="hljs-attribute" style="color: #b58900">charset</span>=<span class="hljs-value" style="color: #2aa198">"utf-8"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title" style="color: #268bd2">title</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">script</span> <span class="hljs-attribute" style="color: #b58900">type</span>=<span class="hljs-value" style="color: #2aa198">"text/javascript"</span>&gt;</span><span class="javascript">
                <span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span> <span class="hljs-title" style="color: #268bd2">onMyLoad</span><span class="hljs-params">()</span></span>{
                     <span class="hljs-keyword" style="color: #859900">var</span> arr = <span class="hljs-built_in" style="color: #268bd2">document</span>.getElementsByTagName(<span class="hljs-string" style="color: #2aa198">"p"</span>);
                     <span class="hljs-keyword" style="color: #859900">for</span>(<span class="hljs-keyword" style="color: #859900">var</span> i = <span class="hljs-number" style="color: #2aa198">0</span>; i &lt; arr.length; i++){
                            arr[i].onclick = <span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span><span class="hljs-params">()</span></span>{
                                  alert(i);
                            }
                     }
                }
       </span><span class="hljs-tag">&lt;/<span class="hljs-title" style="color: #268bd2">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title" style="color: #268bd2">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">body</span> <span class="hljs-attribute" style="color: #b58900">onload</span>=<span class="hljs-value" style="color: #2aa198">"onMyLoad()"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">p</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-title" style="color: #268bd2">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">p</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title" style="color: #268bd2">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">p</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-title" style="color: #268bd2">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">p</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-title" style="color: #268bd2">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title" style="color: #268bd2">p</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-title" style="color: #268bd2">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title" style="color: #268bd2">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title" style="color: #268bd2">html</span>&gt;</span>
</code></pre> 
 </div> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">该段代码期望实现效果如下：点击p标签，弹出该p标签位置序号。请问上述代码能否实现该需求，如果不能，应该如何实现？</p> 
 <div class="xiaoshujiang_element xsj_anchor"> 
  <a class="blank_anchor_name" style="color: #0088cc; text-decoration: none" name="e58e9fe9a298e58886e69e90_2" target="_blank"></a> 
  <a id="e58e9fe9a298e58886e69e90_2" class="blank_anchor_id" style="color: #0088cc; text-decoration: none; float: left; visibility: hidden" target="_blank"></a> 
 </div> 
 <h2 style="margin-top: 1.0em; margin-right: 0; margin-bottom: .6em; margin-left: 0; font-family: inherit; font-weight: 500; line-height: 1.6; color: inherit; font-size: 38.5px">原题分析</h2> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">答案显而易见，不能。点击每个p标签都会弹出5。<br> 要解决此问题，首先要了解<strong style="font-weight: bold">闭包</strong>的概念。<strong style="font-weight: bold">闭包</strong>是JavaScript语言的一个难点，也是它的特色，很多高级应用都要依靠它来实现。</p> 
 <div class="xiaoshujiang_element xsj_anchor"> 
  <a class="blank_anchor_name" style="color: #0088cc; text-decoration: none" name="e58f98e9878fe4bd9ce794a8e59f9f_3" target="_blank"></a> 
  <a id="e58f98e9878fe4bd9ce794a8e59f9f_3" class="blank_anchor_id" style="color: #0088cc; text-decoration: none; float: left; visibility: hidden" target="_blank"></a> 
 </div> 
 <h3 style="margin-top: 1.0em; margin-right: 0; margin-bottom: .6em; margin-left: 0; font-family: inherit; font-weight: 500; line-height: 40px; color: inherit; font-size: 31.5px">变量作用域</h3> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">JavaScript变量作用域的特点在于，函数内部可以读取该函数外部的变量，但函数外部无法读取该函数内部定义的变量，但是我们可以通过变通的方式获得。那就是在函数内部再定义一个函数：</p> 
 <div class="xiaoshujiang_code_container" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; position: relative; padding-bottom: 2em"> 
  <pre><code class="language-javascript hljs" style="border: 0; font-size: 90%; background-color: #d6dbdf; color: #657b83; display: block; background: #fdf6e3; padding: 0.5em"><span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span> <span class="hljs-title" style="color: #268bd2">foo</span><span class="hljs-params">()</span></span>{
　　　　<span class="hljs-keyword" style="color: #859900">var</span> n=<span class="hljs-number" style="color: #2aa198">999</span>;
　　　　<span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span> <span class="hljs-title" style="color: #268bd2">fee</span><span class="hljs-params">()</span></span>{
　　　　　　alert(n); <span class="hljs-comment" style="color: #93a1a1">// 999</span>
　　　　}
　　}
</code></pre> 
 </div> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">在上面的代码中，函数fee就被包括在函数foo内部，这时foo内部的所有局部变量，对fee都是可见的。但是反过来就不行，fee内部的局部变量，对foo就是不可见的。这就是Javascript语言特有的"链式作用域"结构（chain scope），子对象会一级一级地向上寻找所有父对象的变量。所以，父对象的所有变量，对子对象都是可见的，反之则不成立。<br> 既然fee可以读取foo中的局部变量，那么只要把fee作为返回值，我们不就可以在foo外部读取它的内部变量了吗！</p> 
 <div class="xiaoshujiang_element xsj_anchor"> 
  <a class="blank_anchor_name" style="color: #0088cc; text-decoration: none" name="e997ade58c85e79a84e6a682e5bfb5_4" target="_blank"></a> 
  <a id="e997ade58c85e79a84e6a682e5bfb5_4" class="blank_anchor_id" style="color: #0088cc; text-decoration: none; float: left; visibility: hidden" target="_blank"></a> 
 </div> 
 <h3 style="margin-top: 1.0em; margin-right: 0; margin-bottom: .6em; margin-left: 0; font-family: inherit; font-weight: 500; line-height: 40px; color: inherit; font-size: 31.5px">闭包的概念</h3> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">简而言之，闭包就是<em style="font-style: italic">能够读取其他函数内部变量的函数</em>，由于在JavaScript语言中，只有函数内部的子函数才能读取局部变量，因此可以把闭包简单理解成<em style="font-style: italic">定义在一个函数内部的函数</em>。所以，在本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁。</p> 
 <div class="xiaoshujiang_element xsj_anchor"> 
  <a class="blank_anchor_name" style="color: #0088cc; text-decoration: none" name="e997ade58c85e79a84e794a8e98094_5" target="_blank"></a> 
  <a id="e997ade58c85e79a84e794a8e98094_5" class="blank_anchor_id" style="color: #0088cc; text-decoration: none; float: left; visibility: hidden" target="_blank"></a> 
 </div> 
 <h3 style="margin-top: 1.0em; margin-right: 0; margin-bottom: .6em; margin-left: 0; font-family: inherit; font-weight: 500; line-height: 40px; color: inherit; font-size: 31.5px">闭包的用途</h3> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">闭包可以用在许多地方。它的最大用处有两个，一个是前面提到的可以读取函数内部的变量，另一个就是让这些变量的值始终保持在内存中。</p> 
 <div class="xiaoshujiang_code_container" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; position: relative; padding-bottom: 2em"> 
  <pre><code class="language-javascript hljs" style="border: 0; font-size: 90%; background-color: #d6dbdf; color: #657b83; display: block; background: #fdf6e3; padding: 0.5em"><span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span> <span class="hljs-title" style="color: #268bd2">f1</span><span class="hljs-params">()</span></span>{
　　　　<span class="hljs-keyword" style="color: #859900">var</span> n=<span class="hljs-number" style="color: #2aa198">999</span>;
　　　　nAdd=<span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span><span class="hljs-params">()</span></span>{
　　　　    n+=<span class="hljs-number" style="color: #2aa198">1</span>
　　　　    }
　　　　<span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span> <span class="hljs-title" style="color: #268bd2">f2</span><span class="hljs-params">()</span></span>{
　　　　　　alert(n);
　　　　}
　　　　<span class="hljs-keyword" style="color: #859900">return</span> f2;
　　}
　　<span class="hljs-keyword" style="color: #859900">var</span> result=f1();
　　result(); <span class="hljs-comment" style="color: #93a1a1">// 999</span>
　　nAdd();
　　result(); <span class="hljs-comment" style="color: #93a1a1">// 1000</span>
</code></pre> 
 </div> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">在这段代码中，result实际上就是闭包f2函数，它一共运行了两次，第一次的值是999，第二次的值是1000。这证明了，函数f1中的局部变量n一直保存在内存中，并没有在f1调用后被自动清除。</p> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">为什么会这样呢？原因就在于f1是f2的父函数，而f2被赋给了一个全局变量，这导致f2始终在内存中，而f2的存在依赖于f1，因此f1也始终在内存中，不会在调用结束后，被垃圾回收机制（garbage collection）回收。</p> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">这段代码中另一个值得注意的地方，就是"nAdd=function(){n+=1}"这一行，首先在nAdd前面没有使用var关键字，因此nAdd是一个全局变量，而不是局部变量。其次，nAdd的值是一个匿名函数（anonymous function），而这个匿名函数本身也是一个闭包，所以nAdd相当于是一个setter，可以在函数外部对函数内部的局部变量进行操作。</p> 
 <div class="xiaoshujiang_element xsj_anchor"> 
  <a class="blank_anchor_name" style="color: #0088cc; text-decoration: none" name="e4bdbfe794a8e997ade58c85e79a84e6b3a8e6848fe782b9_6" target="_blank"></a> 
  <a id="e4bdbfe794a8e997ade58c85e79a84e6b3a8e6848fe782b9_6" class="blank_anchor_id" style="color: #0088cc; text-decoration: none; float: left; visibility: hidden" target="_blank"></a> 
 </div> 
 <h3 style="margin-top: 1.0em; margin-right: 0; margin-bottom: .6em; margin-left: 0; font-family: inherit; font-weight: 500; line-height: 40px; color: inherit; font-size: 31.5px">使用闭包的注意点</h3> 
 <ol style="margin-top: 0; margin-right: 0; margin-bottom: 10px; margin-left: 35px; padding: 0"><li>由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除。</li><li>闭包会在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。</li></ol> 
 <div class="xiaoshujiang_element xsj_anchor"> 
  <a class="blank_anchor_name" style="color: #0088cc; text-decoration: none" name="e6809de88083e9a298_7" target="_blank"></a> 
  <a id="e6809de88083e9a298_7" class="blank_anchor_id" style="color: #0088cc; text-decoration: none; float: left; visibility: hidden" target="_blank"></a> 
 </div> 
 <h3 style="margin-top: 1.0em; margin-right: 0; margin-bottom: .6em; margin-left: 0; font-family: inherit; font-weight: 500; line-height: 40px; color: inherit; font-size: 31.5px">思考题</h3> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">如果你能理解下面两段代码的运行结果，应该就算理解闭包的运行机制了。</p> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">代码一：</p> 
 <div class="xiaoshujiang_code_container" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; position: relative; padding-bottom: 2em"> 
  <pre><code class="language-javascript hljs" style="border: 0; font-size: 90%; background-color: #d6dbdf; color: #657b83; display: block; background: #fdf6e3; padding: 0.5em">　<span class="hljs-keyword" style="color: #859900">var</span> name = <span class="hljs-string" style="color: #2aa198">"The Window"</span>;
　　<span class="hljs-keyword" style="color: #859900">var</span> object = {
　　　　name : <span class="hljs-string" style="color: #2aa198">"My Object"</span>,
　　　　getNameFunc : <span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span><span class="hljs-params">()</span></span>{
　　　　　　<span class="hljs-keyword" style="color: #859900">return</span> <span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span><span class="hljs-params">()</span></span>{
　　　　　　　　<span class="hljs-keyword" style="color: #859900">return</span> <span class="hljs-keyword" style="color: #859900">this</span>.name;
　　　　　　};
　　　　}
　　};
　　alert(object.getNameFunc()());
</code></pre> 
 </div> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">代码二：</p> 
 <div class="xiaoshujiang_code_container" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; position: relative; padding-bottom: 2em"> 
  <pre><code class="language-javascript hljs" style="border: 0; font-size: 90%; background-color: #d6dbdf; color: #657b83; display: block; background: #fdf6e3; padding: 0.5em"><span class="hljs-keyword" style="color: #859900">var</span> name = <span class="hljs-string" style="color: #2aa198">"The Window"</span>;
　　<span class="hljs-keyword" style="color: #859900">var</span> object = {
　　　　name : <span class="hljs-string" style="color: #2aa198">"My Object"</span>,
　　　　getNameFunc : <span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span><span class="hljs-params">()</span></span>{
　　　　　　<span class="hljs-keyword" style="color: #859900">var</span> that = <span class="hljs-keyword" style="color: #859900">this</span>;
　　　　　　<span class="hljs-keyword" style="color: #859900">return</span> <span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span><span class="hljs-params">()</span></span>{
　　　　　　　　<span class="hljs-keyword" style="color: #859900">return</span> that.name;
　　　　　　};
　　　　}
　　};
　　alert(object.getNameFunc()());
</code></pre> 
 </div> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">接下来回到文章开始的题目，解释一下为什么打印出来的数字都是5.</p> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">arr中的每一项onclick都是一个函数实例，这个函数也产生了一个闭包域，这个闭包域引用了外部闭包域的变量，即<strong style="font-weight: bold">i</strong>，外部闭包域的私有变量内容发生变化,内部闭包域得到的值自然会发生改变（参照闭包的用途一节中的示例代码）</p> 
 <div class="xiaoshujiang_element xsj_anchor"> 
  <a class="blank_anchor_name" style="color: #0088cc; text-decoration: none" name="e8a7a3e586b3e696b9e6a188_8" target="_blank"></a> 
  <a id="e8a7a3e586b3e696b9e6a188_8" class="blank_anchor_id" style="color: #0088cc; text-decoration: none; float: left; visibility: hidden" target="_blank"></a> 
 </div> 
 <h2 style="margin-top: 1.0em; margin-right: 0; margin-bottom: .6em; margin-left: 0; font-family: inherit; font-weight: 500; line-height: 1.6; color: inherit; font-size: 38.5px">解决方案</h2> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">方法一：增加若干个对应的闭包域空间(采用匿名函数实现)专门用来存储原先需要引用的内容(下标值)，只限于基本类型(基本类型值传递，对象类型引用传递)</p> 
 <div class="xiaoshujiang_code_container" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; position: relative; padding-bottom: 2em"> 
  <pre><code class="language-javascript hljs" style="border: 0; font-size: 90%; background-color: #d6dbdf; color: #657b83; display: block; background: #fdf6e3; padding: 0.5em"><span class="hljs-keyword" style="color: #859900">for</span>(<span class="hljs-keyword" style="color: #859900">var</span> i = <span class="hljs-number" style="color: #2aa198">0</span>; i&lt;arr.length; i++){
       (<span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span> <span class="hljs-params">(arg)</span></span>{<!-- --><span class="hljs-comment" style="color: #93a1a1">//这个函数对象有一个本地私有变量arg(形参)，该函数的function scope的closure对象属性有两个引用：arr和i。i的值随外部改变，但是本地的私有变量(形参)arg不会受影响，其值在一开始被调用时就决定了</span>
            arr[i].onclick = <span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span> <span class="hljs-params">()</span> </span>{<!-- --><span class="hljs-comment" style="color: #93a1a1">//onclick函数实例的function scope的closure对象属性有一个引用arg</span>
                  alert(arg);<span class="hljs-comment" style="color: #93a1a1">//只要外部空间的arg不变，这里的引用值就不会改变</span>
            }
       })(i);<span class="hljs-comment" style="color: #93a1a1">//立即执行匿名函数，传递下标i(实参)</span>
}
</code></pre> 
 </div> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">方法二：将下标作为对象属性(name:"i",value:i的值)添加到每个数组项(p对象)中</p> 
 <div class="xiaoshujiang_code_container" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; position: relative; padding-bottom: 2em"> 
  <pre><code class="language-javascript hljs" style="border: 0; font-size: 90%; background-color: #d6dbdf; color: #657b83; display: block; background: #fdf6e3; padding: 0.5em"><span class="hljs-keyword" style="color: #859900">for</span>(<span class="hljs-keyword" style="color: #859900">var</span> i=<span class="hljs-number" style="color: #2aa198">0</span>; i&lt;arr.length; i++){
       <span class="hljs-comment" style="color: #93a1a1">//为当前数组项(当前p对象)添加一个名为i的属性，值为循环体i变量的值</span>
       <span class="hljs-comment" style="color: #93a1a1">//此时当前p对象的i属性并不是对循环体的i变量的引用，而是一个独立p对象的属性，属性值在声明的时候就确定了</span>
       arr[i].i = i;
       arr[i].onclick = <span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span> <span class="hljs-params">()</span></span>{
              alert(<span class="hljs-keyword" style="color: #859900">this</span>.i);
       }
}
</code></pre> 
 </div> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">方法三：增加若干个对应的闭包域空间用来存储下标。新增的匿名闭包空间内完成事件绑定。<br> //绑定的函数中的function scope中的closure对象的引用arg是指向将其返回的匿名函数的私有变量arg</p> 
 <div class="xiaoshujiang_code_container" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; position: relative; padding-bottom: 2em"> 
  <pre><code class="language-javascript hljs" style="border: 0; font-size: 90%; background-color: #d6dbdf; color: #657b83; display: block; background: #fdf6e3; padding: 0.5em"><span class="hljs-keyword" style="color: #859900">for</span>(<span class="hljs-keyword" style="color: #859900">var</span> i = <span class="hljs-number" style="color: #2aa198">0</span>; i&lt;arr.length; i++){
        arr[i].onclick = (<span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span><span class="hljs-params">(arg)</span></span>{
                <span class="hljs-keyword" style="color: #859900">return</span> <span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span> <span class="hljs-params">()</span> </span>{
                       alert(arg);
                }
        })(i);
}
</code></pre> 
 </div> 
 <p style="margin-top: 0; margin-right: 0; margin-bottom: 1.1em; margin-left: 0; line-height: 1.6">方法四：使用ES6的<strong style="font-weight: bold">let</strong>关键字</p> 
 <div class="xiaoshujiang_code_container" style="margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; position: relative; padding-bottom: 2em"> 
  <pre><code class="language-javascript hljs" style="border: 0; font-size: 90%; background-color: #d6dbdf; color: #657b83; display: block; background: #fdf6e3; padding: 0.5em"><span class="hljs-pi" style="color: #93a1a1">"use strict"</span>;
<span class="hljs-keyword" style="color: #859900">var</span> arr = <span class="hljs-built_in" style="color: #268bd2">document</span>.getElementsByTagName(<span class="hljs-string" style="color: #2aa198">"p"</span>);
<span class="hljs-keyword" style="color: #859900">for</span>(<span class="hljs-keyword" style="color: #859900">var</span> i = <span class="hljs-number" style="color: #2aa198">0</span>; i&lt;arr.length; i++){
      <span class="hljs-keyword" style="color: #859900">let</span> j = i;<span class="hljs-comment" style="color: #93a1a1">//块级变量</span>
      arr[i].onclick = <span class="hljs-function"><span class="hljs-keyword" style="color: #859900">function</span> <span class="hljs-params">()</span> </span>{
             alert(j);
      }
}
</code></pre> 
 </div> 
</div> 
<p>请使用手机"扫一扫"x</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/37c447bafbe2d72817f59358d77f3ca4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Matlab制作视频并转换成gif动态图的两种方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ebcb73e4f9e7e0c86b86b65d31d4a322/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Switch的的case同时付多个值的写法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>