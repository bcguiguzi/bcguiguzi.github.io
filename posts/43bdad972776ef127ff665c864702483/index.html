<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Visual Studio C&#43;&#43;与 Matlab 进行 TCP/IP 通信传送 double 类型数据 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Visual Studio C&#43;&#43;与 Matlab 进行 TCP/IP 通信传送 double 类型数据" />
<meta property="og:description" content="由于实验平台的需求，需要实现在 VS 和 Matlab之间进行通信，传送实验数据。都是在本机上。
目标是：VS和Matlab之间互传Double类型的数据，VS是服务器端，Matlab是客户端。（VS2019 &#43; Matlab2016）
1.类型转换 C&#43;&#43;这边Socket提供的接口提供函数只可以支持 char * 类型的指针（存疑，欢迎指正），所以想要传递double数据，首先需要进行一步类型转换，将 double 转化成 char 数组，Matlab接收到的是 浮点数的 ACSII 码值。
在这一步试了以下两种方法：
利用C&#43;&#43;提供的sprintf() 函数 ，将浮点数 传化成 char 数组，但是一次性传送多个数字的话，在传到 Matlab 之后，由于每个数的大小不一样，位数不一样，Matlab 不好分割，没办法处理。利用 union ，将double的八个字节塞给一个char数组，这样就可以保证每一次传送的位数是固定的 8位。union 内部的所有数据公用同一个地址，所以这一部分转换如下。 #define _CRT_SECURE_NO_WARNINGS #include&lt;stdio.h&gt; #include&lt;iostream&gt; #include&lt;string&gt; using namespace std; const int len_double = sizeof(double); typedef union doubletochar_8 { double num_double; char num_char[len_double]; }doubletochar; int main() { doubletochar num; char send_arr[len_double]; double x = 10; num.num_double = x; for (int i = 0; i &lt;= len_double-1;&#43;&#43;i) //小端模式：低字节在低位，高字节在高地址 { send_arr[i] = num." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/43bdad972776ef127ff665c864702483/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-17T20:21:55+08:00" />
<meta property="article:modified_time" content="2020-12-17T20:21:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Visual Studio C&#43;&#43;与 Matlab 进行 TCP/IP 通信传送 double 类型数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>由于实验平台的需求，需要实现在 VS 和 Matlab之间进行通信，传送实验数据。都是在本机上。<br> 目标是：VS和Matlab之间互传Double类型的数据，VS是服务器端，Matlab是客户端。（VS2019 + Matlab2016）</p> 
<h2><a id="1_2"></a>1.类型转换</h2> 
<p>C++这边Socket提供的接口提供函数只可以支持 char * 类型的指针（<strong>存疑，欢迎指正</strong>），所以想要传递double数据，首先需要进行一步类型转换，将 double 转化成 char 数组，Matlab接收到的是 浮点数的 ACSII 码值。<br> 在这一步试了以下两种方法：</p> 
<ul><li>利用C++提供的sprintf() 函数 ，将浮点数 传化成 char 数组，但是一次性传送多个数字的话，在传到 Matlab 之后，由于每个数的大小不一样，位数不一样，Matlab 不好分割，没办法处理。</li><li>利用 <strong>union</strong> ，将double的八个字节塞给一个char数组，这样就可以保证每一次传送的位数是固定的 8位。union 内部的所有数据公用同一个地址，所以这一部分转换如下。</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">define</span> _CRT_SECURE_NO_WARNINGS</span>

<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;string&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> len_double <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">union</span> doubletochar_8
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">double</span> num_double<span class="token punctuation">;</span>
	<span class="token keyword">char</span> num_char<span class="token punctuation">[</span>len_double<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>doubletochar<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	doubletochar num<span class="token punctuation">;</span>
	<span class="token keyword">char</span> send_arr<span class="token punctuation">[</span>len_double<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">double</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	num<span class="token punctuation">.</span>num_double <span class="token operator">=</span> x<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> len_double<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token comment">//小端模式：低字节在低位，高字节在高地址</span>
	<span class="token punctuation">{<!-- --></span>
		send_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> num<span class="token punctuation">.</span>num_char<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%02x\n"</span><span class="token punctuation">,</span> send_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="2sever_39"></a>2.sever端</h2> 
<p>接下来就是在C++这边写服务器端了，Socket编程的流程如下：</p> 
<ol><li>初始化</li><li>创建服务器的套接字 serviceSocket</li><li>绑定套接字，指定绑定的 IP地址 和 端口号 ：将 socketAddr 与 serviceSocket 绑定</li><li>服务器监听</li><li>接受请求 ：初始化一个接受的客户端socket—recvClientSocket</li><li>接收/发送数据 ：recv//send 这两个函数都要操作 recvClientSocket。这两个函数返回值是成功发送的位数。<a href="https://www.cnblogs.com/ellisonzhang/p/10412021.html" rel="nofollow">socket中send和recv函数</a> 一般改动的话也就是改这一部分，这篇讲得比较好。</li><li>关闭socket</li><li>终止</li></ol> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">define</span> _WINSOCK_DEPRECATED_NO_WARNINGS 	</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _CRT_SECURE_NO_WARNINGS</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;string&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;WS2tcpip.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;WinSock2.h&gt;</span>						</span><span class="token comment">//一般情况下,这个头文件位于windows.h之前,避免发生某些错误</span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "ws2_32.lib") 			</span><span class="token comment">//显示加载 ws2_32.dll	ws2_32.dll就是最新socket版本啦</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> len_double <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">union</span> doubletochar_8
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">double</span> num_double<span class="token punctuation">;</span>
	<span class="token keyword">char</span> num_char<span class="token punctuation">[</span>len_double<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>doubletochar<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-----------服务器-----------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token keyword">int</span> BUF_SIZE <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>
	<span class="token comment">//	1	初始化</span>
	WSADATA wsadata<span class="token punctuation">;</span>
	<span class="token function">WSAStartup</span><span class="token punctuation">(</span><span class="token function">MAKEWORD</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>wsadata<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//make word,你把鼠标移到WSAStartup看看参数列表,是不是就是一个word啊</span>


	<span class="token comment">//	2	创建服务器的套接字</span>
	SOCKET serviceSocket<span class="token punctuation">;</span>
	serviceSocket <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> IPPROTO_TCP<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//socket(协议族,socket数据传输方式,某个协议)	我们默认为0,其实就是一个宏</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>SOCKET_ERROR <span class="token operator">==</span> serviceSocket<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"套接字闯创建失败!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"套接字创建成功!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token comment">//	3	绑定套接字	指定绑定的IP地址和端口号</span>
	sockaddr_in socketAddr<span class="token punctuation">;</span>								<span class="token comment">//一个绑定地址:有IP地址,有端口号,有协议族</span>
	socketAddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
	socketAddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>S_un<span class="token punctuation">.</span>S_addr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// IP</span>
	socketAddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 端口号</span>
	<span class="token keyword">int</span> bRes <span class="token operator">=</span> <span class="token function">bind</span><span class="token punctuation">(</span>serviceSocket<span class="token punctuation">,</span> <span class="token punctuation">(</span>SOCKADDR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socketAddr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>SOCKADDR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//绑定注意的一点就是记得强制类型转换</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>SOCKET_ERROR <span class="token operator">==</span> bRes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"绑定失败!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"绑定成功!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//	4	服务器监听	</span>
	<span class="token keyword">int</span> lLen <span class="token operator">=</span> <span class="token function">listen</span><span class="token punctuation">(</span>serviceSocket<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//监听的第二个参数就是:能存放多少个客户端请求,到并发编程的时候很有用哦</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>SOCKET_ERROR <span class="token operator">==</span> lLen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"监听失败!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"监听成功!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token comment">//	5	接受请求</span>
	sockaddr_in revClientAddr<span class="token punctuation">;</span>
	SOCKET recvClientSocket <span class="token operator">=</span> INVALID_SOCKET<span class="token punctuation">;</span>	<span class="token comment">//初始化一个接受的客户端socket</span>
	<span class="token keyword">int</span> _revSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>sockaddr_in<span class="token punctuation">)</span><span class="token punctuation">;</span>
	recvClientSocket <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>serviceSocket<span class="token punctuation">,</span> <span class="token punctuation">(</span>SOCKADDR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>revClientAddr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>_revSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>INVALID_SOCKET <span class="token operator">==</span> recvClientSocket<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"服务端接受请求失败!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"服务端接受请求成功!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//	6	发送/接受 数据	</span>
	<span class="token keyword">char</span> recvBuf<span class="token punctuation">[</span>BUF_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> reLen <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>recvClientSocket<span class="token punctuation">,</span> recvBuf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>recvBuf<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	recvBuf<span class="token punctuation">[</span>reLen<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>SOCKET_ERROR <span class="token operator">==</span> reLen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"服务端接收数据失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"服务器接受到数据:    "</span> <span class="token operator">&lt;&lt;</span> recvBuf <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token comment">//cout &lt;&lt; typeid(recvBuf).name() &lt;&lt; endl;</span>
	<span class="token punctuation">}</span>

	doubletochar num<span class="token punctuation">;</span>
	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">double</span> aa <span class="token operator">=</span> count<span class="token punctuation">;</span>
		<span class="token keyword">char</span> send_arr<span class="token punctuation">[</span>len_double<span class="token punctuation">]</span><span class="token punctuation">;</span>
		num<span class="token punctuation">.</span>num_double <span class="token operator">=</span> aa<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> len_double <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token comment">//小端模式：低字节在低位，高字节在高地址</span>
		<span class="token punctuation">{<!-- --></span>
			send_arr<span class="token punctuation">[</span>len_double <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> num<span class="token punctuation">.</span>num_char<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">int</span> sLen <span class="token operator">=</span> <span class="token function">send</span><span class="token punctuation">(</span>recvClientSocket<span class="token punctuation">,</span> send_arr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>send_arr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>SOCKET_ERROR <span class="token operator">==</span> sLen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"count is "</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">+</span> count <span class="token operator">&lt;&lt;</span> <span class="token string">"服务端发送数据失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//cout &lt;&lt; "服务端发送数据成功" &lt;&lt; endl;</span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"count is "</span><span class="token operator">&lt;&lt;</span><span class="token number">1</span> <span class="token operator">+</span> count<span class="token operator">&lt;&lt;</span><span class="token string">" num is "</span><span class="token operator">&lt;&lt;</span>aa <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		count<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//	7	关闭socket</span>
	<span class="token function">closesocket</span><span class="token punctuation">(</span>recvClientSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">closesocket</span><span class="token punctuation">(</span>serviceSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//	8	终止</span>
	<span class="token function">WSACleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"服务器停止"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="3_Client_172"></a>3. Client端</h2> 
<p>Matlab端作为客户端，由于传过来的是一堆 ACSII 码 （即 recv），所以先将这些码转换成 十六进制（dec2hex）的，然后横向展开，每十六位进行一次分割，然后再转换回 double (hex2num)。</p> 
<pre><code class="prism language-cpp">clear
clc
close all
warning off all
<span class="token operator">%</span><span class="token operator">%</span> 设置连接参数，要连接的地址为<span class="token number">127.0</span><span class="token number">.0</span><span class="token punctuation">.</span><span class="token function">1</span><span class="token punctuation">(</span>即本地主机<span class="token punctuation">)</span>，端口号为<span class="token number">5000</span>，作为客户机连接。
Client<span class="token operator">=</span><span class="token function">tcpip</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">,</span><span class="token string">'NetworkRole'</span><span class="token punctuation">,</span><span class="token string">'client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Client<span class="token punctuation">.</span>BytesAvailable
<span class="token operator">%</span><span class="token operator">%</span> 建立连接，建立完成后进行下一步，否则报错
<span class="token function">fopen</span><span class="token punctuation">(</span>Client<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">%</span>与一个服务器建立连接，直到建立完成返回，否则报错。
<span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string">'成功建立连接'</span><span class="token punctuation">)</span>
<span class="token operator">%</span><span class="token operator">%</span> 发送字符串
sendtxt <span class="token operator">=</span> <span class="token string">'hello hello'</span><span class="token punctuation">;</span>
<span class="token function">fprintf</span><span class="token punctuation">(</span>Client<span class="token punctuation">,</span>sendtxt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">%</span> 接收字符串
Client<span class="token punctuation">.</span>BytesAvailable
<span class="token function">pause</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
recv<span class="token operator">=</span><span class="token function">fread</span><span class="token punctuation">(</span>Client<span class="token punctuation">,</span>Client<span class="token punctuation">.</span>BytesAvailable<span class="token punctuation">,</span><span class="token string">'char'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
recv1 <span class="token operator">=</span> <span class="token function">dec2hex</span><span class="token punctuation">(</span>recv<span class="token punctuation">)</span><span class="token punctuation">;</span>
recv2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>recv1<span class="token punctuation">)</span>
    recv2 <span class="token operator">=</span> <span class="token punctuation">[</span>recv2<span class="token punctuation">,</span><span class="token function">recv1</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">%</span>小端模式
end
count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
recv3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">%</span>转化成<span class="token keyword">double</span>
<span class="token keyword">while</span> count <span class="token operator">&lt;</span> <span class="token function">length</span><span class="token punctuation">(</span>recv1<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">8</span>
    recv3 <span class="token operator">=</span> <span class="token punctuation">[</span>recv3<span class="token punctuation">,</span><span class="token function">hex2num</span><span class="token punctuation">(</span><span class="token function">recv2</span><span class="token punctuation">(</span>count<span class="token operator">*</span><span class="token number">16</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>count<span class="token operator">*</span><span class="token number">16</span><span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
end
<span class="token operator">%</span><span class="token operator">%</span> 关闭客户端
<span class="token function">fclose</span><span class="token punctuation">(</span>Client<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_207"></a>注意事项</h2> 
<ol><li>Matlab默认的接收缓冲区是 512字节，所以如果matlab那边不做处理，C++那边一次最多传送64个数字。</li><li>先开启服务器端，然后开启客户端。</li><li>注意 IP 和 端口一致</li></ol> 
<p>参考博客：<br> [1] <a href="https://blog.csdn.net/printf123scanf/article/details/89433001">c++ Socket实现客户端与服务器数据传输</a><br> [2] <a href="https://blog.csdn.net/m0_37947204/article/details/80489431?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522160820478416780304654469%252522%25252C%252522scm%252522%25253A%25252220140713.130102334.pc%25255Fall.%252522%25257D&amp;request_id=160820478416780304654469&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-7-80489431.pc_search_result_cache&amp;utm_term=socket%E7%BC%96%E7%A8%8B">socket编程</a><br> [3] <a href="https://blog.csdn.net/qq_18820125/article/details/107589760">MATLAB和C++程序使用TCP/IP协议进行通信</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c5a7f670581cec965f8c75574ac4a7c8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于vue打印pdf的尝试总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/32f38dd8b8c184e6cbedfe702cd63440/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IT人员必须知道的14个学习网站</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>