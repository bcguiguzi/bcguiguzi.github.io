<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>UUID是什么  ? - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="UUID是什么  ?" />
<meta property="og:description" content="UUID是什么 ? UUID 是指Universally Unique Identifier，翻译为中文是通用唯一识别码，UUID 的目的是让分布式系统中的所有元素都能有唯一的识别信息。如此一来，每个人都可以创建不与其它人冲突的 UUID，就不需考虑数据库创建时的名称重复问题。
定义
UUID 是由一组32位数的16进制数字所构成，是故 UUID 理论上的总数为1632=2128，约等于3.4 x 10123。
也就是说若每纳秒产生1百万个 UUID，要花100亿年才会将所有 UUID 用完
格式
UUID 的十六个八位字节被表示为 32个十六进制数字，以连字号分隔的五组来显示，形式为 8-4-4-4-12，总共有 36个字符（即三十二个英数字母和四个连字号）。例如：
123e4567-e89b-12d3-a456-426655440000 xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx 数字 M的四位表示 UUID 版本，当前规范有5个版本，M可选值为1, 2, 3, 4, 5 ；
数字 N的一至四个最高有效位表示 UUID 变体( variant )，有固定的两位10xx因此只可能取值8, 9, a, b
UUID版本通过M表示，当前规范有5个版本，M可选值为1, 2, 3, 4, 5。这5个版本使用不同算法，利用不同的信息来产生UUID，各版本有各自优势，适用于不同情景。具体使用的信息
version 1, date-time &amp; MAC addressversion 2, date-time &amp; group/user idversion 3, MD5 hash &amp; namespaceversion 4, pseudo-random numberversion 5, SHA-1 hash &amp; namespace 使用较多的是版本1和版本4，其中版本1使用当前时间戳和MAC地址信息。版本4使用(伪)随机数信息，128bit中，除去版本确定的4bit和variant确定的2bit，其它122bit全部由(伪)随机数信息确定。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/0d524471c9f2b7e2a4de3d9e3b4d563f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-10T20:54:28+08:00" />
<meta property="article:modified_time" content="2020-10-10T20:54:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">UUID是什么  ?</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="UUID___0"></a>UUID是什么 ?</h2> 
<p><br><br><br></p> 
<p><strong>UUID</strong> 是指Universally Unique Identifier，翻译为中文是<strong>通用唯一识别码</strong>，UUID 的目的是让分布式系统中的所有元素都能有唯一的识别信息。如此一来，每个人都可以创建不与其它人冲突的 UUID，就不需考虑数据库创建时的名称重复问题。</p> 
<br> 
<blockquote> 
 <p>定义</p> 
</blockquote> 
<p>UUID 是由一组32位数的16进制数字所构成，是故 UUID 理论上的总数为1632=2128，约等于3.4 x 10123。</p> 
<p>也就是说若每纳秒产生1百万个 UUID，要花100亿年才会将所有 UUID 用完</p> 
<br> 
<blockquote> 
 <p>格式</p> 
</blockquote> 
<p>UUID 的十六个八位字节被表示为 32个十六进制数字，以连字号分隔的五组来显示，形式为 8-4-4-4-12，总共有 36个字符（即三十二个英数字母和四个连字号）。例如：</p> 
<pre><code>123e4567-e89b-12d3-a456-426655440000
xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx
</code></pre> 
<p>数字 <code>M</code>的四位表示 UUID 版本，当前规范有5个版本，M可选值为<code>1, 2, 3, 4, 5</code> ；</p> 
<p>数字 <code>N</code>的一至四个最高有效位表示 UUID 变体( variant )，有固定的两位<code>10xx</code>因此只可能取值<code>8, 9, a, b</code></p> 
<p>UUID版本通过M表示，当前规范有5个版本，M可选值为<code>1, 2, 3, 4, 5</code>。这5个版本使用不同算法，利用不同的信息来产生UUID，各版本有各自优势，适用于不同情景。具体使用的信息</p> 
<ul><li>version 1, date-time &amp; MAC address</li><li>version 2, date-time &amp; group/user id</li><li>version 3, MD5 hash &amp; namespace</li><li>version 4, pseudo-random number</li><li>version 5, SHA-1 hash &amp; namespace</li></ul> 
<p>使用较多的是版本1和版本4，其中版本1使用当前时间戳和MAC地址信息。版本4使用(伪)随机数信息，128bit中，除去版本确定的4bit和variant确定的2bit，其它122bit全部由(伪)随机数信息确定。</p> 
<p>因为时间戳和随机数的唯一性，版本1和版本4总是生成唯一的标识符。若希望对给定的一个字符串总是能生成相同的 UUID，使用版本3或版本5。</p> 
<br> 
<p><br><br></p> 
<blockquote> 
 <p>随机 UUID 的重复机率</p> 
</blockquote> 
<p>Java中 UUID 使用版本4进行实现，所以由<a href="http://java.sun.com/javase/6/docs/api/java/util/UUID.html" rel="nofollow">java.util.UUID</a>类产生的 UUID，128个比特中，有122个比特是随机产生，4个比特标识版本被使用，还有2个标识变体被使用。利用<a href="https://zh.wikipedia.org/wiki/%E7%94%9F%E6%97%A5%E6%82%96%E8%AB%96" rel="nofollow">生日悖论</a>，可计算出两笔 UUID 拥有相同值的机率约为</p> 
<p><img src="https://images2.imgbox.com/b0/05/kCtGPuuo_o.png" alt="img"></p> 
<p>其中<code>x</code>为 UUID 的取值范围，<code>n</code>为 UUID 的个数。</p> 
<p>以下是以 x = 2122 计算出n笔 UUID 后产生碰撞的机率：</p> 
<table><thead><tr><th>n</th><th>机率</th></tr></thead><tbody><tr><td>68,719,476,736 = 236</td><td>0.0000000000000004 (4 x 10-16)</td></tr><tr><td>2,199,023,255,552 = 241</td><td>0.0000000000004 (4 x 10-13)</td></tr><tr><td>70,368,744,177,664 = 246</td><td>0.0000000004 (4 x 10-10)</td></tr></tbody></table> 
<p>换句话说，每秒产生10亿笔 UUID ，100年后<em>只产生一次</em>重复的机率是50%。如果地球上每个人都各有6亿笔 UUID，发生一次重复的机率是50%。与被陨石击中的机率比较的话，已知一个人每年被陨石击中的机率估计为170亿分之1，也就是说机率大约是0.00000000006 (6 x 10-11)，等同于在一年内生产2000亿个 UUID 并发生一次重复。</p> 
<p>综上所述，产生重复 UUID 并造成错误的情况非常低，是故大可不必考虑此问题。</p> 
<p>机率也与随机数产生器的质量有关。若要避免重复机率提高，必须要使用基于密码学上的<strong>强伪随机数产生器</strong>来生成值才行。</p> 
<p><br><br></p> 
<blockquote> 
 <p>Java实现</p> 
</blockquote> 
<p>Java中 UUID 对版本4进行了实现，原理是由强伪随机数生成器生成伪随机数。</p> 
<pre><code class="prism language-java"> <span class="token comment">/**
     * 使用静态工厂来获取版本4（伪随机数生成器）的 UUID
     * Static factory to retrieve a type 4 (pseudo randomly generated) UUID.
     * 这个UUID生成使用了强加密的伪随机数生成器(PRNG)
     * The {@code UUID} is generated using a cryptographically strong pseudo
     * random number generator.
     *
     * @return  A randomly generated {@code UUID}
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> UUID <span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 与Random(弱伪随机数生成器)不一样，SecureRandom是强伪随机数生成器，结果不可预测</span>
        <span class="token comment">// 使用SecureRandom生成随机数，替换version和variant就是 UUID</span>
        SecureRandom ng <span class="token operator">=</span> Holder<span class="token punctuation">.</span>numberGenerator<span class="token punctuation">;</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> randomBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        ng<span class="token punctuation">.</span><span class="token function">nextBytes</span><span class="token punctuation">(</span>randomBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        randomBytes<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>  <span class="token operator">&amp;=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>  <span class="token comment">/* clear version        */</span>
        randomBytes<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>  <span class="token operator">|=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>  <span class="token comment">/* set to version 4     */</span>
        randomBytes<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span>  <span class="token operator">&amp;=</span> <span class="token number">0x3f</span><span class="token punctuation">;</span>  <span class="token comment">/* clear variant        */</span>
        randomBytes<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span>  <span class="token operator">|=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>  <span class="token comment">/* set to IETF variant  */</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UUID</span><span class="token punctuation">(</span>randomBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 对版本3的实现，对于给定的字符串（name）总能生成相同的UUID
     * Static factory to retrieve a type 3 (name based) {@code UUID} based on
     * the specified byte array.
     *
     * @param  name
     *         A byte array to be used to construct a {@code UUID}
     *
     * @return  A {@code UUID} generated from the specified array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> UUID <span class="token function">nameUUIDFromBytes</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        MessageDigest md<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            md <span class="token operator">=</span> MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> nsae<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalError</span><span class="token punctuation">(</span><span class="token string">"MD5 not supported"</span><span class="token punctuation">,</span> nsae<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> md5Bytes <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        md5Bytes<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>  <span class="token operator">&amp;=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>  <span class="token comment">/* clear version        */</span>
        md5Bytes<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>  <span class="token operator">|=</span> <span class="token number">0x30</span><span class="token punctuation">;</span>  <span class="token comment">/* set to version 3     */</span>
        md5Bytes<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span>  <span class="token operator">&amp;=</span> <span class="token number">0x3f</span><span class="token punctuation">;</span>  <span class="token comment">/* clear variant        */</span>
        md5Bytes<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span>  <span class="token operator">|=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>  <span class="token comment">/* set to IETF variant  */</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UUID</span><span class="token punctuation">(</span>md5Bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> 
<p><br><br></p> 
<blockquote> 
 <p>生成 UUID</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token comment">// Java语言实现</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>UUID<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UUIDProvider</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 利用伪随机数生成版本为4,变体为9的UUID</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 对于相同的命名空间总是生成相同的UUID,版本为3,变体为9</span>
        <span class="token comment">// 命名空间为"mwq"时生成的UUID总是为06523e4a-9a66-3687-9334-e41dab27cef4</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">nameUUIDFromBytes</span><span class="token punctuation">(</span><span class="token string">"mwq"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre> 
<blockquote> 
 <p>待补充</p> 
</blockquote> 
<p>snowflake算法<br> guid<br> varient<br> SecureRandom 版本4的UUID生成原理，与Random的区别等<br> https://resources.infosecinstitute.com/random-number-generation-java/<br> https://www.saowen.com/a/d2f3430d15558a740d95b76ff04b242d59b08ea44847ff5941a9ded0e08a65c1<br> http://yizhenn.iteye.com/blog/2306293<br> mysql UUID<br> https://dev.mysql.com/doc/refman/8.0/en/miscellaneous-functions.html#function_uuid<br> <a href="https://tech.meituan.com/MT_Leaf.html" rel="nofollow">Leaf——美团点评分布式ID生成系统</a></p> 
<p>参考链接:</p> 
<p>https://www.ietf.org/rfc/rfc4122.txt</p> 
<p>https://www.zhihu.com/question/34876910/answer/88924223</p> 
<p>链接：https://www.jianshu.com/p/da6dae36c290</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/58f130fa2863edad889d0a81ca69b87b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mybatis-plus 出现 WHERE null=?</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1e170c7666622fa1971353f044b2709b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">4分钟内说明sql窗口分析功能</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>