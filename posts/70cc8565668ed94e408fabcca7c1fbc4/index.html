<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GO学习之 数据库(mysql) - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GO学习之 数据库(mysql)" />
<meta property="og:description" content="GO系列 1、GO学习之Hello World
2、GO学习之入门语法
3、GO学习之切片操作
4、GO学习之 Map 操作
5、GO学习之 结构体 操作
6、GO学习之 通道(Channel)
7、GO学习之 多线程(goroutine)
8、GO学习之 函数(Function)
9、GO学习之 接口(Interface)
10、GO学习之 网络通信(Net/Http)
11、GO学习之 微框架(Gin)
12、GO学习之 数据库(mysql)
13、GO学习之 数据库(Redis)
14、GO学习之 搜索引擎(ElasticSearch)
15、GO学习之 消息队列(Kafka)
16、GO学习之 远程过程调用(RPC)
17、GO学习之 goroutine的调度原理
文章目录 GO系列前言一、简介二、准备操作三、Insert 操作四、Delete 操作五、Update 操作5.1 获取数据库链接5.2 更新操作 六、Select 操作五、事务六、总结 前言 按照公司目前的任务，go 学习是必经之路了，虽然行业卷，不过技多不压身，依旧努力！！！
数据持久化是必不可少的一部分，平日里开发，如果是专注于业务开发，那 99% 的工作也就是CRUD（增删改查）工程师了。
废话不多说，说了也没用，直接上手来操作，对数据库进行访问。
一、简介 对数据库操作，少不了各个语言对数据库操作的驱动，就像 JAVA 中有 mysql-driver 的驱动包，拉取下来就可以通过JDBC 对数据库操作了，当然 Spring、Mybatis 等框架也提供了对数据库很方便的操作。
那在 Go 中也是提供了驱动 github.com/go-sql-driver/mysql,我们通过 go get 拉取驱动来进行CRUD操作。
使用命令：go get github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/70cc8565668ed94e408fabcca7c1fbc4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-21T16:57:17+08:00" />
<meta property="article:modified_time" content="2023-10-21T16:57:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GO学习之 数据库(mysql)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="GO_0"></a>GO系列</h2> 
<p>1、<a href="https://blog.csdn.net/qq_19283249/article/details/129769486">GO学习之Hello World</a><br> 2、<a href="https://blog.csdn.net/qq_19283249/article/details/131348442">GO学习之入门语法</a><br> 3、<a href="https://blog.csdn.net/qq_19283249/article/details/131747709">GO学习之切片操作</a><br> 4、<a href="https://blog.csdn.net/qq_19283249/article/details/131864539">GO学习之 Map 操作</a><br> 5、<a href="https://blog.csdn.net/qq_19283249/article/details/131865994">GO学习之 结构体 操作</a><br> 6、<a href="https://blog.csdn.net/qq_19283249/article/details/131993360">GO学习之 通道(Channel)</a><br> 7、<a href="https://blog.csdn.net/qq_19283249/article/details/132019770">GO学习之 多线程(goroutine)</a><br> 8、<a href="https://blog.csdn.net/qq_19283249/article/details/132116497">GO学习之 函数(Function)</a><br> 9、<a href="https://blog.csdn.net/qq_19283249/article/details/132128093">GO学习之 接口(Interface)</a><br> 10、<a href="https://blog.csdn.net/qq_19283249/article/details/132136820">GO学习之 网络通信(Net/Http)</a><br> 11、<a href="https://blog.csdn.net/qq_19283249/article/details/132246169">GO学习之 微框架(Gin)</a><br> 12、<a href="https://blog.csdn.net/qq_19283249/article/details/132378899">GO学习之 数据库(mysql)</a><br> 13、<a href="https://blog.csdn.net/qq_19283249/article/details/132389199">GO学习之 数据库(Redis)</a><br> 14、<a href="https://blog.csdn.net/qq_19283249/article/details/132521248">GO学习之 搜索引擎(ElasticSearch)</a><br> 15、<a href="https://blog.csdn.net/qq_19283249/article/details/132634983">GO学习之 消息队列(Kafka)</a><br> 16、<a href="https://blog.csdn.net/qq_19283249/article/details/132919380">GO学习之 远程过程调用(RPC)</a><br> 17、<a href="https://blog.csdn.net/qq_19283249/article/details/133959367">GO学习之 goroutine的调度原理</a></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#GO_0" rel="nofollow">GO系列</a></li><li><a href="#_20" rel="nofollow">前言</a></li><li><a href="#_25" rel="nofollow">一、简介</a></li><li><a href="#_29" rel="nofollow">二、准备操作</a></li><li><a href="#Insert__57" rel="nofollow">三、Insert 操作</a></li><li><a href="#Delete__91" rel="nofollow">四、Delete 操作</a></li><li><a href="#Update__124" rel="nofollow">五、Update 操作</a></li><li><ul><li><a href="#51__126" rel="nofollow">5.1 获取数据库链接</a></li><li><a href="#52__149" rel="nofollow">5.2 更新操作</a></li></ul> 
  </li><li><a href="#Select__182" rel="nofollow">六、Select 操作</a></li><li><a href="#_227" rel="nofollow">五、事务</a></li><li><a href="#_295" rel="nofollow">六、总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_20"></a>前言</h2> 
<p>按照公司目前的任务，go 学习是必经之路了，虽然行业卷，不过技多不压身，依旧努力！！！<br> 数据持久化是必不可少的一部分，平日里开发，如果是专注于业务开发，那 99% 的工作也就是CRUD（增删改查）工程师了。<br> 废话不多说，说了也没用，直接上手来操作，对数据库进行访问。</p> 
<h2><a id="_25"></a>一、简介</h2> 
<p>对数据库操作，少不了各个语言对数据库操作的驱动，就像 JAVA 中有 mysql-driver 的驱动包，拉取下来就可以通过JDBC 对数据库操作了，当然 Spring、Mybatis 等框架也提供了对数据库很方便的操作。<br> 那在 Go 中也是提供了驱动 <code>github.com/go-sql-driver/mysql</code>,我们通过 go get 拉取驱动来进行CRUD操作。<br> 使用命令：<code>go get github.com/go-sql-driver/mysql</code> 来拉取驱动库。</p> 
<h2><a id="_29"></a>二、准备操作</h2> 
<p>首先在 MYSQL 数据库创建一个测试库叫 <code>go_demo</code>，然后来添加一张 <code>User</code> 表来操作，脚本如下：</p> 
<ul><li>新建表：</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>
</code></pre> 
<ul><li>插入测试数据</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> address<span class="token punctuation">,</span> age<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_time<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'悟空'</span><span class="token punctuation">,</span> <span class="token string">'五指山下'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> address<span class="token punctuation">,</span> age<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_time<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'唐僧'</span><span class="token punctuation">,</span> <span class="token string">'大唐东土'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> address<span class="token punctuation">,</span> age<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_time<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'八戒'</span><span class="token punctuation">,</span> <span class="token string">'高老庄'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> address<span class="token punctuation">,</span> age<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_time<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'沙森'</span><span class="token punctuation">,</span> <span class="token string">'流沙河'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>查询数据</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="Insert__57"></a>三、Insert 操作</h2> 
<blockquote> 
 <p>下面的示例中，首先使用 <code>database/sql</code> 和 <code>github.com/go-sql-driver/mysql</code> 包来连接 MySQL 数据库，获取到一个连接示例 db, 再通过 <code>db.Exec()</code> 函数来执行 <code>insert</code> 语句，成功把 <strong>白龙马</strong> 指派到了师徒四人的队伍中。</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"database/sql"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>
	<span class="token string">"time"</span>

	<span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 连接 MYSQL 数据库</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> <span class="token string">"root:123456@tcp(127.0.0.1:3306)/go_demo"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// defer 关键字来延迟关闭连接</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 插入数据</span>
	insertSql <span class="token operator">:=</span> <span class="token string">"INSERT INTO users (name, address, age, create_time, update_time) VALUES (?, ?, ?, ?, ?)"</span>
	datetime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span> insertErr <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>insertSql<span class="token punctuation">,</span> <span class="token string">"白龙马"</span><span class="token punctuation">,</span> <span class="token string">"东海"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> datetime<span class="token punctuation">,</span> datetime<span class="token punctuation">)</span>
	<span class="token keyword">if</span> insertErr <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>insertErr<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"插入数据成功！"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="Delete__91"></a>四、Delete 操作</h2> 
<blockquote> 
 <p>下面的示例中，首先使用 <code>database/sql</code> 和 <code>github.com/go-sql-driver/mysql</code> 包来连接 MySQL 数据库，获取到一个连接示例 db, 再通过 <code>db.Exec()</code> 函数来执行 <code>delete</code> 语句，成功把 <strong>悟空</strong> 逐出了队伍。<br> 可以看出来，从获取数据库连接到执行 SQL 语句，Go 代码基本一样的，想必定有框架做了此事了……</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"database/sql"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>

	<span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 连接mysql数据库</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> <span class="token string">"root:123456@tcp(127.0.0.1:3306)/go_demo"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">//删除悟空</span>
	deleteSql <span class="token operator">:=</span> <span class="token string">"delete from users where id = ?"</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span> deleteErr <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>deleteSql<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> deleteErr <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>deleteErr<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"删除成功！"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="Update__124"></a>五、Update 操作</h2> 
<blockquote> 
 <p>更新操作其实无外乎也是获取数据库连接，执行 <code>update</code> 语句，我们可以先封装一个公共的函数来获取数据库连接，在执行操作。</p> 
</blockquote> 
<h3><a id="51__126"></a>5.1 获取数据库链接</h3> 
<blockquote> 
 <p>这里的包是 <code>common</code>， 在另一个包中，并且 Conn 首字母大写，表明外部包是可以调用的。</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> common

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"database/sql"</span>
	<span class="token string">"log"</span>

	<span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">Conn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 连接mysql数据库</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> <span class="token string">"root:123456@tcp(127.0.0.1:3306)/go_demo"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> db
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="52__149"></a>5.2 更新操作</h3> 
<blockquote> 
 <p>下面案例，从上面封装的 common 包中通过 Conn() 函数获取数据库连接，再进行操作。<br> **注意：**这里需要用 <code>common.Conn()</code> 获取连接，不能用 <code>*common.Conn()</code> 获取，如果用 <code>*common.Conn()</code> 获取则在 后续的判断中 <code>db != nil</code> 出错：<code>mismatched types sql.DB and untyped nil</code>，因为<code>db</code>是一个指针类型，不能直接与 <code>nil</code> 进行比较。</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>

	<span class="token string">"gotest.com/test/src/common"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 获取数据库连接</span>
	db <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">Conn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> db <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment">// 更新八戒的地址，不再是高老庄</span>
		updateSql <span class="token operator">:=</span> <span class="token string">"update users set address = ? where id = ?"</span>
		<span class="token boolean">_</span><span class="token punctuation">,</span> updateErr <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>updateSql<span class="token punctuation">,</span> <span class="token string">"天上人间"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> updateErr <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>updateErr<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"更新成功！"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"获取数据库连接失败！"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Select__182"></a>六、Select 操作</h2> 
<blockquote> 
 <p>在下面的案例中：</p> 
 <ul><li>通过 自己封装的 <code>common.Conn()</code> 获取一个数据库链接</li><li>利用 <code>defer</code> 关键词来延迟关闭链接</li><li>通过 <code>db.Query()</code> 来执行一个查询</li><li>循环遍历，<code>rows.Next()</code> 来判断是否有下一条记录，如果返回 true，大括号<code>{}</code>表示一个代码块，其中包含了每次迭代式要执行的代码。</li><li>在<code>{}</code>中，可以对每条记录进行操作，比如利用 <code>Scan() </code>来扫描将记录的值赋值给相应定义的变量。</li><li>主要注意的是，rows.Scan(&amp;id, &amp;name…) 是指向 id、name 变量的指针，才能把记录中的值赋值给当前的变量。</li></ul> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>

	<span class="token string">"gotest.com/test/src/common"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 获取数据库连接</span>
	db <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">Conn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	selectSql <span class="token operator">:=</span> <span class="token string">"select id,name,address,age from users"</span>
	rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>selectSql<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 延迟关闭数据库连接</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 遍历结果, rows是数据库查询结果的迭代器，Next()函数来判断是否下一条记录</span>
	<span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">var</span> id <span class="token builtin">int</span>
		<span class="token keyword">var</span> name <span class="token builtin">string</span>
		<span class="token keyword">var</span> address <span class="token builtin">string</span>
		<span class="token keyword">var</span> age <span class="token builtin">int</span>
		err <span class="token operator">:=</span> rows<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">,</span> <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>address<span class="token punctuation">,</span> <span class="token operator">&amp;</span>age<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"id:"</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token string">"name:"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">"address:"</span><span class="token punctuation">,</span> address<span class="token punctuation">,</span> <span class="token string">"age:"</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_227"></a>五、事务</h2> 
<blockquote> 
 <p>下面示例中，使用<code>db.Begin()</code>来开启事务，本来要更新唐僧的地址为<strong>女儿国</strong>，唐僧也对女儿国王动心了，本来和女儿国王都说好了，玉帝哥哥陪国王白头到老（没头发如何白头到老），但是<em><strong>贫僧</strong></em>有要事在身，不得不离开，所以即便更新成功了，也得通过<code>tx.Rollback()</code>回滚回去。</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>

	<span class="token string">"gotest.com/test/src/common"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 获取数据库连接</span>
	db <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">Conn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> db <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// 开启事务</span>
		tx<span class="token punctuation">,</span> beginErr <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> beginErr <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>beginErr<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 更新唐僧的地址，不再是东土大唐，留在了女儿国</span>
		<span class="token comment">// 注意，这里要用事务 tx.Exec() 来执行操作</span>
		updateSql <span class="token operator">:=</span> <span class="token string">"update users set address = ? where id = ?"</span>
		result<span class="token punctuation">,</span> updateErr <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>updateSql<span class="token punctuation">,</span> <span class="token string">"女儿国"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
		count<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> result<span class="token punctuation">.</span><span class="token function">RowsAffected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// 如果影响行数大于 0</span>
		<span class="token keyword">if</span> count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 唐僧有使命在身，怎能为了儿女私情误了朕的大事</span>
			tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"唐僧最终离开了女儿国！"</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> updateErr <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>updateErr<span class="token punctuation">)</span>
			<span class="token comment">// 更新操作发生异常，事务回滚</span>
			tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 提交事务</span>
		commitErr <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> commitErr <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>commitErr<span class="token punctuation">)</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"更新提交失败！"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"更新成功！"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"获取数据库连接失败！"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li>运行前数据库记录如下：<br> <img src="https://images2.imgbox.com/4e/ff/GWd2U9tU_o.png" alt="修改前"></li><li>运行结果如下：</li></ul> 
<blockquote> 
 <p>可以看到，更新条数是 1，说明更新成功了！！！</p> 
</blockquote> 
<pre><code class="prism language-bash">PS D:<span class="token punctuation">\</span>workspaceGo<span class="token punctuation">\</span>src<span class="token punctuation">\</span>database<span class="token operator">&gt;</span> go run .<span class="token punctuation">\</span>updateTest.go
更新条数： <span class="token number">1</span>
唐僧最终离开了女儿国！
<span class="token number">2023</span>/08/19 <span class="token number">21</span>:29:26 sql: transaction has already been committed or rolled back
<span class="token builtin class-name">exit</span> status <span class="token number">1</span>
</code></pre> 
<ul><li>运行后数据库记录如下：<br> <img src="https://images2.imgbox.com/a1/88/Pt76qyh4_o.png" alt="运行后"></li></ul> 
<p><code>注意</code>：在使用 <code>tx, beginErr := db.Begin()</code>开启事务后，需要用 <code>tx.Exec()</code>来执行更新操作，这样后续的<code>tx.Rollback()</code>和<code>tx.Commit()</code>操作才会生效。刚开始我就使用了<code>db.Exec()</code>来执行的更新操作，结果回滚就不生效，才发现犯了这等低级错误…</p> 
<h2><a id="_295"></a>六、总结</h2> 
<p>此篇只对 Go 语言操作数据库进行简单的 CRUD 操作的示例，就像 JAVA 中用 JDBC 查库那样的基础操作，可发现基本就是通过获取的数据库链接通过函数进行对SQL的执行操作。</p> 
<p>那 Go 操作 MySQL 有哪些优势呢？</p> 
<ol><li><strong>高性能</strong>：Go 语言本身的设计目标就是高性能，所以也能够获得高性能的表现。</li><li><strong>并发支持</strong>：Go 语言天生支持并发，可以轻松的实现并发的数据库操作，更加适合高并发的操作。</li><li><strong>直接访问数据库</strong>：Go 语言通过标准库<code>database/sql</code>对SQL数据库直接访问的接口，允许直接操作数据库。</li></ol> 
<p>有哪些缺点呢？</p> 
<ol start="4"><li><strong>生态系统相对较新</strong>：相对于其他语言，Go 语言在社区和工具等相对较新，不是很全面。</li><li><strong>ORM 支持有限</strong>：Go 语言的 ORM（对象关系映射）相对与其他语言成熟度较低，需要手动编写SQL更多。</li></ol> 
<p>第三方开源库用于操作 MySQL 数据库：</p> 
<ol><li><strong>database/sql</strong>：Go 语言标准库提供了<code>database/sql</code>包，支持多种数据库的操作。它提供了通用的接口的方法，让你能够进行基本的数据库操作。</li><li><strong>github.com/go-sql-driver/mysql</strong>：这是一个 MySQL 驱动，对 MySQL 数据库进行操作。</li><li><strong>github.com/jinzhu/gorm</strong>：GORM 是 Go 语言中一个流行的 ORM 框架，它 提供了对数据库的高级抽象，支持多种数据库。它可以简化数据库的操作，但是性能上有些损耗。</li><li><strong>github.com/go-xorm/xorm</strong>：XORM 是一个流行的 ORM 框架，它提供了对多种数据库的支持。它有一些独特的特性，适用于一些特定的场景。</li><li><strong>github.com/jmoiron/sqlx</strong>： SQLx 是 database/sql 的扩展，提供更方便的数据库操作方法。</li></ol> 
<hr> 
<p>现阶段还是对 Go 语言的学习阶段，想必有一些地方考虑的不全面，本文示例全部是亲自手敲代码并且执行通过。<br> <strong>如有问题，还请指教。</strong><br> 评论去告诉我哦！！！一起学习一起进步！！！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3d263a66d9b6c5210e89c2ab748004a6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PTrade财务数据获取函数的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ec380c56b58944ae4c2e41e6bf205d5f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于LangChain的LLM应用开发3——记忆</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>