<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pandas 数据透视表 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pandas 数据透视表" />
<meta property="og:description" content="**我们可以使用df.pivot_table() ，来实现同样的功能，参数如下
index：行索引，传入原始数据的列名columns：列索引，传入原始数据的列名values: 要做聚合操作的列名aggfunc：聚合函数** 数据透视表 学习目标 知道什么是透视表掌握Pandas透视表（pivot_table）的使用方法 1 Pandas 透视表概述 透视表是一种可以对数据动态排布并且分类汇总的表格格式。或许大多数人都在Excel使用过数据透视表，也体会到它的强大功能，而在pandas中它被称作pivot_table。
数据透视表（Pivot Table）是一种交互式的表，可以进行某些计算，如求和与计数等。所进行的计算与数据，和数据透视表中的排列有关。之所以称为数据透视表，是因为可以动态地改变它们的版面布置，以便按照不同方式分析数据，也可以重新安排行号、列标和页字段。每一次改变版面布置时，数据透视表会立即按照新的布置重新计算数据。另外，如果原始数据发生更改，则可以更新数据透视表。在使用Excel做数据分析时，透视表是很常用的功能，Pandas也提供了透视表功能，对应的API为pivot_tablePandas pivot_table函数介绍：pandas有两个pivot_table函数 pandas.pivot_tablepandas.DataFrame.pivot_tablepandas.pivot_table 比 pandas.DataFrame.pivot_table 多了一个参数data，data就是一个dataframe，实际上这两个函数相同 pivot_table参数中最重要的四个参数 values,index,columns,aggfunc，下面通过案例介绍pivot_tabe的使用 2 零售会员数据分析案例 2.1 案例业务介绍 业务背景介绍
某女鞋连锁零售企业，当前业务以线下门店为主，线上销售为辅
通过对会员的注册数据以及的分析，监控会员运营情况，为后续会员运营提供决策依据
会员等级说明
① 白银: 注册(0)
② 黄金: 下单(1~3888)
③ 铂金: 3888~6888
④ 钻石: 6888以上
数据分析要达成的目标
描述性数据分析使用业务数据，分析出会员运营的基本情况 案例中用到的数据
① 会员信息查询.xlsx
② 会员消费报表.xlsx
③ 门店信息表.xlsx
④ 全国销售订单数量表.xlsx
分析会员运营的基本情况
从量的角度分析会员运营情况：
① 整体会员运营情况（存量，增量）
② 不同渠道（线上，线下）的会员运营情况
③ 线下业务，拆解到不同的地区、门店会员运营情况
从质的角度分析会员运营情况：
① 会销比
② 连带率
2.2 会员存量、增量分析 每月会员数量的存量和增量是最基本的指标，通过会员数量考察会员运营情况
加载数据：会员信息查询.xlsx，加载时间较久，耐心等待 import pandas as pd custom_info = pd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/68ce9c1e34c06491c393b47ca0cd2e39/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-01T20:31:26+08:00" />
<meta property="article:modified_time" content="2021-09-01T20:31:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pandas 数据透视表</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>**我们可以使用<code>df.pivot_table()</code> ，来实现同样的功能，参数如下</p> 
<ul><li>index：行索引，传入原始数据的列名</li><li>columns：列索引，传入原始数据的列名</li><li>values: 要做聚合操作的列名</li><li>aggfunc：聚合函数**</li></ul> 
<h2><a id="_7"></a>数据透视表</h2> 
<h3><a id="_9"></a>学习目标</h3> 
<ul><li>知道什么是透视表</li><li>掌握Pandas透视表（pivot_table）的使用方法</li></ul> 
<h3><a id="1_Pandas__16"></a>1 Pandas 透视表概述</h3> 
<blockquote> 
 <p>透视表是一种可以对<strong>数据动态排布并且分类汇总的表格格式</strong>。或许大多数人都在Excel使用过数据透视表，也体会到它的强大功能，<em><strong>而在pandas中它被称作pivot_table。</strong></em></p> 
 <ul><li>数据透视表（Pivot Table）是一种交互式的表，可以进行某些计算，如求和与计数等。所进行的计算与数据，和数据透视表中的排列有关。</li><li>之所以称为数据透视表，是因为可以动态地改变它们的版面布置，以便按照不同方式分析数据，也可以重新安排行号、列标和页字段。每一次改变版面布置时，数据透视表会立即按照新的布置重新计算数据。另外，如果原始数据发生更改，则可以更新数据透视表。</li><li>在使用Excel做数据分析时，透视表是很常用的功能，Pandas也提供了透视表功能，对应的API为pivot_table</li><li>Pandas pivot_table函数介绍：pandas有两个pivot_table函数 
   <ul><li>pandas.pivot_table</li><li>pandas.DataFrame.pivot_table</li><li>pandas.pivot_table 比 pandas.DataFrame.pivot_table 多了一个参数data，data就是一个dataframe，实际上这两个函数相同</li></ul> </li><li>pivot_table参数中最重要的四个参数 values,index,columns,aggfunc，下面通过案例介绍pivot_tabe的使用</li></ul> 
</blockquote> 
<h3><a id="2__31"></a>2 零售会员数据分析案例</h3> 
<h4><a id="21__33"></a>2.1 案例业务介绍</h4> 
<ul><li> <p>业务背景介绍</p> 
  <ul><li> <p>某女鞋连锁零售企业，当前业务以线下门店为主，线上销售为辅</p> </li><li> <p>通过对会员的注册数据以及的分析，监控会员运营情况，为后续会员运营提供决策依据</p> </li><li> <p>会员等级说明</p> <p>① 白银: 注册(0)</p> <p>② 黄金: 下单(1~3888)</p> <p>③ 铂金: 3888~6888</p> <p>④ 钻石: 6888以上</p> </li></ul> </li><li> <p>数据分析要达成的目标</p> 
  <ul><li>描述性数据分析</li><li>使用业务数据，分析出会员运营的基本情况</li></ul> </li><li> <p>案例中用到的数据</p> <p>① 会员信息查询.xlsx</p> <p>② 会员消费报表.xlsx</p> <p>③ 门店信息表.xlsx</p> <p>④ 全国销售订单数量表.xlsx</p> </li><li> <p>分析会员运营的基本情况</p> 
  <ul><li> <p>从量的角度分析会员运营情况：</p> <p>① 整体会员运营情况（存量，增量）</p> <p>② 不同渠道（线上，线下）的会员运营情况</p> <p>③ 线下业务，拆解到不同的地区、门店会员运营情况</p> </li><li> <p>从质的角度分析会员运营情况：</p> <p>① 会销比</p> <p>② 连带率</p> </li></ul> </li></ul> 
<h4><a id="22__82"></a>2.2 会员存量、增量分析</h4> 
<blockquote> 
 <p>每月会员数量的存量和增量是最基本的指标，通过会员数量考察会员运营情况</p> 
</blockquote> 
<ul><li>加载数据：<code>会员信息查询.xlsx</code>，加载时间较久，耐心等待</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd 
custom_info <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'data/会员信息查询.xlsx'</span><span class="token punctuation">)</span>
custom_info<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p><font color="red">显示结果：</font></p> 
 <pre><code class="prism language-python"><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'pandas.core.frame.DataFrame'</span><span class="token operator">&gt;</span>
RangeIndex<span class="token punctuation">:</span> <span class="token number">952714</span> entries<span class="token punctuation">,</span> <span class="token number">0</span> to <span class="token number">952713</span>
Data columns <span class="token punctuation">(</span>total <span class="token number">12</span> columns<span class="token punctuation">)</span><span class="token punctuation">:</span>
会员卡号      <span class="token number">952714</span> non<span class="token operator">-</span>null <span class="token builtin">object</span>
会员等级      <span class="token number">952714</span> non<span class="token operator">-</span>null <span class="token builtin">object</span>
会员来源      <span class="token number">952714</span> non<span class="token operator">-</span>null <span class="token builtin">object</span>
注册时间      <span class="token number">952714</span> non<span class="token operator">-</span>null datetime64<span class="token punctuation">[</span>ns<span class="token punctuation">]</span>
所属店铺编码    <span class="token number">952714</span> non<span class="token operator">-</span>null <span class="token builtin">object</span>
门店店员编码    <span class="token number">253828</span> non<span class="token operator">-</span>null <span class="token builtin">object</span>
省份        <span class="token number">264801</span> non<span class="token operator">-</span>null <span class="token builtin">object</span>
城市        <span class="token number">264758</span> non<span class="token operator">-</span>null <span class="token builtin">object</span>
性别        <span class="token number">952714</span> non<span class="token operator">-</span>null <span class="token builtin">object</span>
生日        <span class="token number">785590</span> non<span class="token operator">-</span>null <span class="token builtin">object</span>
年齡        <span class="token number">952705</span> non<span class="token operator">-</span>null float64
生命级别      <span class="token number">952714</span> non<span class="token operator">-</span>null <span class="token builtin">object</span>
dtypes<span class="token punctuation">:</span> datetime64<span class="token punctuation">[</span>ns<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> float64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
memory usage<span class="token punctuation">:</span> <span class="token number">87.2</span><span class="token operator">+</span> MB
</code></pre> 
</blockquote> 
<ul><li>会员信息数据集查看</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 会员信息查询</span>
custom_info<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-sPg0QTJC-1630499468923)(./img/数据透视表-01.png)]</p> 
<ul><li>pandas读取行数较多的xlsx文件速度较慢，可以将xlsx转为csv之后，pandas再次读取csv，速度就会快很多</li></ul> 
<pre><code class="prism language-python">custom_info<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'data/会员信息查询.csv'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
custom_info <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'data/会员信息查询.csv'</span><span class="token punctuation">)</span>
custom_info<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p><font color="red">显示结果：</font></p> 
 <pre><code class="prism language-python">C<span class="token punctuation">:</span>\ProgramData\Anaconda3\lib\site<span class="token operator">-</span>packages\IPython\core\interactiveshell<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">3146</span><span class="token punctuation">:</span> DtypeWarning<span class="token punctuation">:</span> Columns <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> have mixed types<span class="token punctuation">.</span>Specify dtype option on <span class="token keyword">import</span> <span class="token keyword">or</span> <span class="token builtin">set</span> low_memory<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">.</span>
has_raised <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>run_ast_nodes<span class="token punctuation">(</span>code_ast<span class="token punctuation">.</span>body<span class="token punctuation">,</span> cell_name<span class="token punctuation">,</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'pandas.core.frame.DataFrame'</span><span class="token operator">&gt;</span>
RangeIndex<span class="token punctuation">:</span> <span class="token number">952714</span> entries<span class="token punctuation">,</span> <span class="token number">0</span> to <span class="token number">952713</span>
Data columns <span class="token punctuation">(</span>total <span class="token number">13</span> columns<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment">#   Column      Non-Null Count   Dtype  </span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>      <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>   <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>  
<span class="token number">0</span>   Unnamed<span class="token punctuation">:</span> <span class="token number">0</span>  <span class="token number">952714</span> non<span class="token operator">-</span>null  int64  
<span class="token number">1</span>   会员卡号        <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">2</span>   会员等级        <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">3</span>   会员来源        <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">4</span>   注册时间        <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">5</span>   所属店铺编码      <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">6</span>   门店店员编码      <span class="token number">253828</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">7</span>   省份          <span class="token number">264801</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">8</span>   城市          <span class="token number">264758</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">9</span>   性别          <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">10</span>  生日          <span class="token number">785590</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">11</span>  年齡          <span class="token number">952705</span> non<span class="token operator">-</span>null  float64
<span class="token number">12</span>  生命级别        <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
dtypes<span class="token punctuation">:</span> float64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
memory usage<span class="token punctuation">:</span> <span class="token number">94.5</span><span class="token operator">+</span> MB
</code></pre> 
</blockquote> 
<ul><li>对比发现，csv数据比原xlsx多了一列<code>Unnamed: 0</code>，将其删除</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">del</span> custom_info<span class="token punctuation">[</span><span class="token string">'Unnamed: 0'</span><span class="token punctuation">]</span> 
custom_info<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p><font color="red">显示结果：</font></p> 
 <pre><code class="prism language-python"><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'pandas.core.frame.DataFrame'</span><span class="token operator">&gt;</span>
RangeIndex<span class="token punctuation">:</span> <span class="token number">952714</span> entries<span class="token punctuation">,</span> <span class="token number">0</span> to <span class="token number">952713</span>
Data columns <span class="token punctuation">(</span>total <span class="token number">12</span> columns<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment">#   Column  Non-Null Count   Dtype  </span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>   <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>  
<span class="token number">0</span>   会员卡号    <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">1</span>   会员等级    <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">2</span>   会员来源    <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">3</span>   注册时间    <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">4</span>   所属店铺编码  <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">5</span>   门店店员编码  <span class="token number">253828</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">6</span>   省份      <span class="token number">264801</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">7</span>   城市      <span class="token number">264758</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">8</span>   性别      <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">9</span>   生日      <span class="token number">785590</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
<span class="token number">10</span>  年齡      <span class="token number">952705</span> non<span class="token operator">-</span>null  float64
<span class="token number">11</span>  生命级别    <span class="token number">952714</span> non<span class="token operator">-</span>null  <span class="token builtin">object</span> 
dtypes<span class="token punctuation">:</span> float64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
memory usage<span class="token punctuation">:</span> <span class="token number">87.2</span><span class="token operator">+</span> MB
</code></pre> 
</blockquote> 
<ul><li>会员信息查询</li></ul> 
<pre><code class="prism language-python">custom_info<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-RqfXDYA3-1630499468925)(./img/数据透视表-01.png)]</p> 
<ul><li>需要按月统计注册的会员数量，注册时间原始数据需要处理成<code>年-月</code>的形式</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 给 会员信息表 添加年月列</span>
custom_info<span class="token punctuation">[</span><span class="token string">'注册时间'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
custom_info<span class="token punctuation">[</span><span class="token string">'注册时间'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span>
custom_info<span class="token punctuation">[</span><span class="token string">'注册年月'</span><span class="token punctuation">]</span> <span class="token operator">=</span> custom_info<span class="token punctuation">[</span><span class="token string">'注册时间'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
custom_info<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-bO9zDfEo-1630499468932)(./img/数据透视表-02.png)]</p> 
<ul><li>按月计算会员数量的增量</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 对注册年月列进行分组，分组后依据会员卡号计算每组数据的行数，因为会员卡号都是不同的</span>
month_count <span class="token operator">=</span> custom_info<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'注册年月'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'会员卡号'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
month_count <span class="token operator">=</span> month_count<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
month_count <span class="token operator">=</span> month_count<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'会员卡号'</span><span class="token punctuation">:</span> <span class="token string">'月增量'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
month_count<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 至此，我们完成了数据透视表，效果如下</span>
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-PkfbLPP9-1630499468934)(./img/数据透视表-03.png)]</p> 
<ul><li>我们可以使用<code>df.pivot_table()</code> ，来实现同样的功能，参数如下 
  <ul><li>index：行索引，传入原始数据的列名</li><li>columns：列索引，传入原始数据的列名</li><li>values: 要做聚合操作的列名</li><li>aggfunc：聚合函数</li></ul> </li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 以注册年月作为索引，对会员卡号列使用pandas内置的count函数进行计算，返回新的df对象</span>
month_count <span class="token operator">=</span> custom_info<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'注册年月'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'会员卡号'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">)</span>
month_count
<span class="token comment"># 返回结果一致</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-wD3lQIFX-1630499468935)(./img/数据透视表-04.png)]</p> 
<ul><li>重新设定行索引</li></ul> 
<pre><code class="prism language-python">month_count <span class="token operator">=</span> month_count<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
month_count <span class="token operator">=</span> month_count<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'会员卡号'</span><span class="token punctuation">:</span> <span class="token string">'月增量'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
month_count<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-o2XhB3t9-1630499468936)(./img/数据透视表-03.png)]</p> 
<ul><li>计算会员数量的存量</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#通过pandas.series对象的内置函数cumsum()对月增量做累积求和</span>
month_count<span class="token punctuation">[</span><span class="token string">'存量'</span><span class="token punctuation">]</span> <span class="token operator">=</span> month_count<span class="token punctuation">[</span><span class="token string">'月增量'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span>
month_count

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-V8hI9UKb-1630499468937)(./img/数据透视表-05.png)]</p> 
<h4><a id="23__266"></a>2.3 增量等级分布</h4> 
<blockquote> 
 <p>会员增量存量不能真实反映会员运营的质量，需要对会员的增量存量数据做进一步拆解</p> 
 <ul><li>首先思考：从哪些维度来拆解？ 
   <ul><li>从指标构成来拆解： 
     <ul><li>会员 = 白银会员+黄金会员+铂金会员+钻石会员</li></ul> </li><li>从业务流程来拆解： 
     <ul><li>当前案例，还可以按业务分线上、线下，也可以进一步拆解：按大区，按门店</li></ul> </li></ul> </li><li>接下来我们就按照会员等级进行拆解：<strong>会员等级分布分析的目的，以及要分析的指标</strong> 
   <ul><li>会员按照等级拆解分为：</li></ul> </li></ul> 
 <p>① 白银: 注册(0)</p> 
 <p>② 黄金: 下单(1~3888)</p> 
 <p>③ 铂金: 3888~6888</p> 
 <p>④ 钻石: 6888以上</p> 
 <ul><li>由于会员等级跟消费金额挂钩，所以<strong>会员等级分布分析可以说明会员的质量</strong></li></ul> 
</blockquote> 
<ul><li>通过groupby实现，注册年月，会员等级，按这两个字段分组，对任意字段计数</li></ul> 
<pre><code class="prism language-python">month_degree_count <span class="token operator">=</span> custom_info<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'注册年月'</span><span class="token punctuation">,</span><span class="token string">'会员等级'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'会员卡号'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
month_degree_count

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-nQAO8UT5-1630499468938)(./img/数据透视表-08.png)]</p> 
<ul><li>分组之后得到的是multiIndex类型的多级索引，我们使用<code>df.unstack()</code>使长数据变形为宽数据</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 长数据变形为宽数据</span>
month_degree_count <span class="token operator">=</span> month_degree_count<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">)</span>
month_degree_count

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-MlnMkSIy-1630499468938)(./img/数据透视表-09.png)]</p> 
<ul><li>可以通过<code>df.__dict__</code>，更清晰的查看df对象的多级索引关系</li></ul> 
<pre><code class="prism language-python">month_degree_count<span class="token punctuation">.</span>__dict__
<span class="token comment"># 输出结果如下</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'_is_copy'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
 <span class="token string">'_mgr'</span><span class="token punctuation">:</span> BlockManager
 Items<span class="token punctuation">:</span> MultiIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'会员卡号'</span><span class="token punctuation">,</span> <span class="token string">'白银会员'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             <span class="token punctuation">(</span><span class="token string">'会员卡号'</span><span class="token punctuation">,</span> <span class="token string">'钻石会员'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             <span class="token punctuation">(</span><span class="token string">'会员卡号'</span><span class="token punctuation">,</span> <span class="token string">'铂金会员'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             <span class="token punctuation">(</span><span class="token string">'会员卡号'</span><span class="token punctuation">,</span> <span class="token string">'黄金会员'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">'会员等级'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 Axis <span class="token number">1</span><span class="token punctuation">:</span> Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2017-08'</span><span class="token punctuation">,</span> <span class="token string">'2017-09'</span><span class="token punctuation">,</span> <span class="token string">'2017-10'</span><span class="token punctuation">,</span> <span class="token string">'2017-11'</span><span class="token punctuation">,</span> <span class="token string">'2017-12'</span><span class="token punctuation">,</span> <span class="token string">'2018-01'</span><span class="token punctuation">,</span>
        <span class="token string">'2018-02'</span><span class="token punctuation">,</span> <span class="token string">'2018-03'</span><span class="token punctuation">,</span> <span class="token string">'2018-04'</span><span class="token punctuation">,</span> <span class="token string">'2018-05'</span><span class="token punctuation">,</span> <span class="token string">'2018-06'</span><span class="token punctuation">,</span> <span class="token string">'2018-07'</span><span class="token punctuation">,</span>
        <span class="token string">'2018-08'</span><span class="token punctuation">,</span> <span class="token string">'2018-09'</span><span class="token punctuation">,</span> <span class="token string">'2018-10'</span><span class="token punctuation">,</span> <span class="token string">'2018-11'</span><span class="token punctuation">,</span> <span class="token string">'2018-12'</span><span class="token punctuation">,</span> <span class="token string">'2019-01'</span><span class="token punctuation">,</span>
        <span class="token string">'2019-02'</span><span class="token punctuation">,</span> <span class="token string">'2019-03'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'注册年月'</span><span class="token punctuation">)</span>
 IntBlock<span class="token punctuation">:</span> <span class="token builtin">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span> x <span class="token number">20</span><span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int64<span class="token punctuation">,</span>
 <span class="token string">'_item_cache'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token string">'_attrs'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span>

</code></pre> 
<ul><li>根据df的多级索引关系，尝试获取白银会员的增量数据</li></ul> 
<pre><code class="prism language-python">month_degree_count<span class="token punctuation">[</span><span class="token string">'会员卡号'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'白银会员'</span><span class="token punctuation">]</span>
<span class="token comment"># 输出结果如下</span>
注册年月
<span class="token number">2017</span><span class="token operator">-</span><span class="token number">08</span>    <span class="token number">376648</span>
<span class="token number">2017</span><span class="token operator">-</span><span class="token number">09</span>       <span class="token number">530</span>
<span class="token number">2017</span><span class="token operator">-</span><span class="token number">10</span>       <span class="token number">603</span>
<span class="token number">2017</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">1311</span>
<span class="token number">2017</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">3512</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">01</span>     <span class="token number">11244</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">02</span>      <span class="token number">9937</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">03</span>     <span class="token number">41546</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span>     <span class="token number">62613</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">05</span>     <span class="token number">19317</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">06</span>     <span class="token number">11292</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">07</span>      <span class="token number">3932</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">08</span>     <span class="token number">95584</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">09</span>    <span class="token number">133090</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">9093</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">6313</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">2808</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token number">3661</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span>      <span class="token number">4001</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span>     <span class="token number">10580</span>
Name<span class="token punctuation">:</span> 白银会员<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int64

</code></pre> 
<ul><li>获取索引值构成的列表</li></ul> 
<pre><code class="prism language-python">index_list <span class="token operator">=</span> month_degree_count<span class="token punctuation">.</span>index<span class="token punctuation">.</span>values<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
index_list
<span class="token comment"># 输出结果如下</span>
<span class="token punctuation">[</span><span class="token string">'2017-08'</span><span class="token punctuation">,</span>
 <span class="token string">'2017-09'</span><span class="token punctuation">,</span>
 <span class="token string">'2017-10'</span><span class="token punctuation">,</span>
 <span class="token string">'2017-11'</span><span class="token punctuation">,</span>
 <span class="token string">'2017-12'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-01'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-02'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-03'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-04'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-05'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-06'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-07'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-08'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-09'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-10'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-11'</span><span class="token punctuation">,</span>
 <span class="token string">'2018-12'</span><span class="token punctuation">,</span>
 <span class="token string">'2019-01'</span><span class="token punctuation">,</span>
 <span class="token string">'2019-02'</span><span class="token punctuation">,</span>
 <span class="token string">'2019-03'</span><span class="token punctuation">]</span>

</code></pre> 
<ul><li>根据已获取的索引值列表，以及白银会员每月的增量数据，构造新的df对象</li></ul> 
<pre><code class="prism language-python">new_degree_count <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'白银会员'</span><span class="token punctuation">:</span> month_degree_count<span class="token punctuation">[</span><span class="token string">'会员卡号'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'白银会员'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
                                index<span class="token operator">=</span>index_list<span class="token punctuation">)</span>
new_degree_count

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-BCZ6JXry-1630499468939)(./img/数据透视表-10.png)]</p> 
<ul><li>为新的df对象分别添加 黄金会员、铂金会员、钻石会员的增量数据</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># new_degree_count['白银会员'] = month_degree_count['会员卡号']['白银会员']</span>
new_degree_count<span class="token punctuation">[</span><span class="token string">'黄金会员'</span><span class="token punctuation">]</span> <span class="token operator">=</span> month_degree_count<span class="token punctuation">[</span><span class="token string">'会员卡号'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'黄金会员'</span><span class="token punctuation">]</span>
new_degree_count<span class="token punctuation">[</span><span class="token string">'铂金会员'</span><span class="token punctuation">]</span> <span class="token operator">=</span> month_degree_count<span class="token punctuation">[</span><span class="token string">'会员卡号'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'铂金会员'</span><span class="token punctuation">]</span>
new_degree_count<span class="token punctuation">[</span><span class="token string">'钻石会员'</span><span class="token punctuation">]</span> <span class="token operator">=</span> month_degree_count<span class="token punctuation">[</span><span class="token string">'会员卡号'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'钻石会员'</span><span class="token punctuation">]</span>
new_degree_count

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ozMEG60T-1630499468940)(./img/数据透视表-11.png)]</p> 
<ul><li>上述需求我们可以直接使用<code>df.pivot_table()</code>实现</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 以注册年月为索引，对会员等级进行长变宽（对会员等级列的值进行分组），针对会员卡号列的值进行计算，计算使用内置函数count求总数</span>
member_rating <span class="token operator">=</span> custom_info<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'注册年月'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'会员等级'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'会员卡号'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">)</span>
member_rating

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-RUARJRaA-1630499468941)(./img/数据透视表-12.png)]</p> 
<h4><a id="24__432"></a>2.4 增量等级占比分析</h4> 
<blockquote> 
 <p>增量等级占比分析，查看增量会员的消费情况</p> 
</blockquote> 
<ul><li>添加增量总计列</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 添加列，值为按行求和 axis='columns' 轴=列==&gt;按行计算</span>
member_rating<span class="token punctuation">[</span><span class="token string">'总计'</span><span class="token punctuation">]</span> <span class="token operator">=</span> member_rating<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">'columns'</span><span class="token punctuation">)</span>
member_rating<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-YZ00Xa8P-1630499468942)(./img/数据透视表-15.png)]</p> 
<ul><li>计算白银和黄金会员等级占比，铂金钻石会员数量太少暂不计算</li></ul> 
<pre><code class="prism language-python">member_rating<span class="token punctuation">[</span><span class="token string">'白银会员占比'</span><span class="token punctuation">]</span> <span class="token operator">=</span> member_rating<span class="token punctuation">[</span><span class="token string">'白银会员'</span><span class="token punctuation">]</span> <span class="token operator">/</span> member_rating<span class="token punctuation">[</span><span class="token string">'总计'</span><span class="token punctuation">]</span>
member_rating<span class="token punctuation">[</span><span class="token string">'黄金会员占比'</span><span class="token punctuation">]</span> <span class="token operator">=</span> member_rating<span class="token punctuation">[</span><span class="token string">'黄金会员'</span><span class="token punctuation">]</span> <span class="token operator">/</span> member_rating<span class="token punctuation">[</span><span class="token string">'总计'</span><span class="token punctuation">]</span>
<span class="token comment"># member_rating['铂金会员占比'] = member_rating['铂金会员'] / member_rating['总计']</span>
<span class="token comment"># member_rating['钻石会员占比'] = member_rating['钻石会员'] / member_rating['总计']</span>
member_rating

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-inCZqF9H-1630499468942)(./img/数据透视表-16.png)]</p> 
<h4><a id="25__462"></a>2.5 整体等级分布</h4> 
<blockquote> 
 <ul><li>需求：计算各个等级会员总数占整体的百分比</li><li>思路：按照会员等级分组，计算每组的会员数量，用每组会员数量/全部会员数量</li></ul> 
</blockquote> 
<ul><li>按照会员等级分组，计算每组的会员数量；通过之前的学习，有三种实现方式，代码如下</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 会员按等级分组groupby实现</span>
<span class="token comment"># ratio = custom_info.groupby('会员等级')[['会员卡号']].count().reset_index()</span>
<span class="token comment"># ratio</span>
<span class="token comment"># 另一种写法</span>
<span class="token comment"># ratio2 = custom_info.groupby('会员等级').agg({'会员卡号':'count'}).reset_index()</span>
<span class="token comment"># ratio2</span>
<span class="token comment"># df.pivot_table的实现方式</span>
ratio3 <span class="token operator">=</span> custom_info<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'会员等级'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'会员卡号'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
ratio3

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ExmFSzAn-1630499468943)(./img/数据透视表-18.png)]</p> 
<ul><li>计算占比：用每组会员数量/全部会员数量</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 修改列名</span>
ratio3<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'会员等级'</span><span class="token punctuation">,</span> <span class="token string">'会员数'</span><span class="token punctuation">]</span>
ratio3<span class="token punctuation">[</span><span class="token string">'占比'</span><span class="token punctuation">]</span> <span class="token operator">=</span> ratio3<span class="token punctuation">[</span><span class="token string">'会员数'</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token punctuation">(</span>ratio3<span class="token punctuation">[</span><span class="token string">'会员数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ratio3

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-YDxpaLqj-1630499468944)(./img/数据透视表-19.png)]</p> 
<h4><a id="26__496"></a>2.6 线上线下增量分析</h4> 
<blockquote> 
 <p>从业务角度，将会员数据拆分成线上和线下，比较每月线上线下会员的运营情况</p> 
</blockquote> 
<ul><li>将“<strong>会员来源</strong>”字段进行拆解，统计线上线下会员增量</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 原始数据</span>
custom_info
<span class="token comment"># 透视表实现：以注册年月列作为索引，对会员来源列的值进行分组，分组后对会员卡号列的值进行数量统计</span>
from_data <span class="token operator">=</span> custom_info<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'注册年月'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'会员来源'</span><span class="token punctuation">,</span> values <span class="token operator">=</span><span class="token string">'会员卡号'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">)</span>
from_data

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-wkMdP1b4-1630499468944)(./img/数据透视表-21.png)]</p> 
<ul><li>可视化</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 删除第一行数据</span>
from_data <span class="token operator">=</span> from_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment"># 出图</span>
from_data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> grid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"电商与线下会员增量分析"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-noDRU0HX-1630499468945)(./img/数据透视表-22.png)]</p> 
<h4><a id="27__528"></a>2.7 地区店均会员数量</h4> 
<ul><li>会员信息查询表中，只有店铺信息，没有地区信息，需要从门店信息表中关联地区信息</li><li>加载数据</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#查看门店信息表</span>
store_info <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'data/门店信息表.XLSX'</span><span class="token punctuation">)</span>
store_info

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-jgXPzqFf-1630499468946)(./img/数据透视表-23.png)]</p> 
<ul><li>只需要用到门店信息表中的<code>店铺代码</code>，<code>地区编码</code> 两列</li></ul> 
<pre><code class="prism language-python">store_info<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'店铺代码'</span><span class="token punctuation">,</span><span class="token string">'地区编码'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-L98mNRSK-1630499468947)(./img/数据透视表-24.png)]</p> 
<ul><li>合并df，使custom_info与store_info基于店铺编码进行关联，将地区编码添加到custom_info中</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># pd.merge合并df，左表custom_info，右表为store_info[['店铺代码','地区编码']]，分别指定左表和右表的关联字段（列）</span>
custom_info1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>custom_info<span class="token punctuation">,</span> store_info<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'店铺代码'</span><span class="token punctuation">,</span><span class="token string">'地区编码'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> left_on<span class="token operator">=</span><span class="token string">'所属店铺编码'</span><span class="token punctuation">,</span> right_on<span class="token operator">=</span><span class="token string">'店铺代码'</span><span class="token punctuation">)</span>
<span class="token comment"># 新表中就有了地区编码编码信息</span>
custom_info1

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-1LSnzz5X-1630499468947)(./img/数据透视表-25.png)]</p> 
<ul><li>按照不同地区，分别统计会员总数</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#统计不同地区的会员数量，注意电商入口的地区编码为GBL6D01</span>
district <span class="token operator">=</span> custom_info1<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'地区编码'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'会员卡号'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#修改列名</span>
district<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'会员数量'</span><span class="token punctuation">]</span>
district

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-exeh49IM-1630499468948)(./img/数据透视表-26.png)]</p> 
<ul><li>获取地区编码和店铺编码，并去重</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 只取2列返回df，对df按行去重</span>
store_info2 <span class="token operator">=</span> custom_info1<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'地区编码'</span><span class="token punctuation">,</span><span class="token string">'所属店铺编码'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span>
store_info2

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ODKXsRFK-1630499468949)(./img/数据透视表-27.png)]</p> 
<ul><li>计算每个地区的店铺数量</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 去重之后再统计每个地区店铺的总数</span>
store_count_s <span class="token operator">=</span> store_info2<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'地区编码'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'所属店铺编码'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
store_count_s
<span class="token comment"># 返回结果如下</span>
地区编码
GBL6010     <span class="token number">40</span>
GBL6020     <span class="token number">41</span>
GBL6030     <span class="token number">78</span>
GBL6040     <span class="token number">47</span>
GBL6050     <span class="token number">38</span>
GBL6060     <span class="token number">31</span>
GBL6070    <span class="token number">114</span>
GBL6080     <span class="token number">70</span>
GBL6090     <span class="token number">66</span>
GBL6100     <span class="token number">38</span>
GBL6110     <span class="token number">46</span>
GBL6120     <span class="token number">21</span>
GBL6130     <span class="token number">71</span>
GBL6140     <span class="token number">50</span>
GBL6D01      <span class="token number">4</span>
Name<span class="token punctuation">:</span> 所属店铺编码<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int64

</code></pre> 
<ul><li>对<code>不同地区会员总数</code>df添加<code>店铺数</code>列</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 添加列：店铺数</span>
district<span class="token punctuation">[</span><span class="token string">'店铺数'</span><span class="token punctuation">]</span> <span class="token operator">=</span> store_count_s
district

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-nBBCgVcz-1630499468949)(./img/数据透视表-28.png)]</p> 
<ul><li>计算地区每店平均会员数，以及全部店铺的平均会员数</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 计算每个地区 每店平均会员数量，并添加列</span>
district<span class="token punctuation">[</span><span class="token string">'每店平均会员数'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span>district<span class="token punctuation">[</span><span class="token string">'会员数量'</span><span class="token punctuation">]</span> <span class="token operator">/</span> district<span class="token punctuation">[</span><span class="token string">'店铺数'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 计算总体 每店平均会员数量，并添加列</span>
district<span class="token punctuation">[</span><span class="token string">'总平均会员数'</span><span class="token punctuation">]</span> <span class="token operator">=</span> district<span class="token punctuation">[</span><span class="token string">'会员数量'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> district<span class="token punctuation">[</span><span class="token string">'店铺数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 指定列排序，由大到小</span>
district <span class="token operator">=</span> district<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'每店平均会员数'</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
district<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-cOJlBIRZ-1630499468950)(./img/数据透视表-29.png)]</p> 
<h4><a id="28__648"></a>2.8 各地区会销比</h4> 
<blockquote> 
 <ul><li>什么是会销比：<strong>会销比统计的是会员消费占所有销售金额的比例</strong></li><li>会销比的作用：<strong>通过会销比可以衡量会员的整体质量</strong></li><li>会销比的计算：<strong>会销比 = 会员消费的金额 / 全部客户消费的金额</strong> 
   <ul><li>由于数据脱敏的原因，没有全部客户消费金额的数据，所以用如下方式替换 
     <ul><li><strong>会销比 = 会员消费的订单数 / 全部销售订单数</strong></li></ul> </li></ul> </li></ul> 
</blockquote> 
<ul><li>加载<code>data/会员消费报表.xlsx</code>数据，时间较长</li></ul> 
<pre><code class="prism language-python">custom_consume<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'data/会员消费报表.xlsx'</span><span class="token punctuation">)</span>
custom_consume<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<ul><li>加载<code>data/全国销售订单数量表.xlsx</code>数据，时间较长</li></ul> 
<pre><code class="prism language-python">all_orders<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'data/全国销售订单数量表.xlsx'</span><span class="token punctuation">)</span>
all_orders<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-1vJZ0MOQ-1630499468951)(./img/数据透视表-31.png)]</p> 
<ul><li>为会员消费报表添加年月列</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 添加年月列 这里年月要转换成整数,因为等会后面要链接的字段是整数</span>
<span class="token comment"># 取其中一条数据举例</span>
<span class="token builtin">int</span><span class="token punctuation">(</span>custom_consume<span class="token punctuation">[</span><span class="token string">'订单日期'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># lambda x: int(...)) 的...就是 int(custom_consume['订单日期'][0]</span>
custom_consume<span class="token punctuation">[</span><span class="token string">'年月'</span><span class="token punctuation">]</span> <span class="token operator">=</span> custom_consume<span class="token punctuation">[</span><span class="token string">'订单日期'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
custom_consume<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-RHRh7Rlp-1630499468952)(./img/数据透视表-32.png)]</p> 
<ul><li>为会员消费报表添加地区编码，合并custom_consume和store_info部分字段，两个表的关联字段是店铺代码</li></ul> 
<pre><code class="prism language-python">store_info<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
custom_consume<span class="token operator">=</span>pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>custom_consume<span class="token punctuation">,</span> store_info<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'店铺代码'</span><span class="token punctuation">,</span><span class="token string">'地区编码'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">'店铺代码'</span><span class="token punctuation">)</span>
custom_consume<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ykINC4qW-1630499468952)(./img/数据透视表-33.png)]</p> 
<ul><li>按地区编码，分年月统计会员购买订单数量</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 以地区编码作为索引，对年月列进行分组，对消费数量（订单数）按照aggfunc指定的函数进行计算</span>
<span class="token comment"># 参数margins=True表示，每行每列都执行aggfunc参数指定的函数，会新增汇总统计列All和汇总统计行All</span>
member_orders <span class="token operator">=</span> custom_consume<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'地区编码'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'年月'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'消费数量'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token builtin">sum</span><span class="token punctuation">,</span> margins<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
member_orders

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Q6ECUu1D-1630499468953)(./img/数据透视表-34.png)]</p> 
<ul><li>按地区编码，分年月统计全部（会员及非会员）购买订单数量</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 以地区作为索引，对年月进行分组，对全部订单数做sum求和计算，最后添加汇总统计行和汇总统计列</span>
country_sales<span class="token operator">=</span>all_orders<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'地区代码'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'年月'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'全部订单数'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token builtin">sum</span><span class="token punctuation">,</span> margins<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
country_sales

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-BZrkfZI3-1630499468954)(./img/数据透视表-35.png)]</p> 
<ul><li>计算各地区订单数量上的会销比</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 会销比 = 会员消费的订单数 / 全部销售订单数</span>
result <span class="token operator">=</span> member_orders <span class="token operator">/</span> country_sales
result
<span class="token comment"># df.applymap()对每一个值都保留2位小数；计算速度会慢</span>
result <span class="token operator">=</span> result<span class="token punctuation">.</span>applymap<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">".2%"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
result

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-yHLTwstS-1630499468955)(./img/数据透视表-36.png)]</p> 
<ul><li>统计线下地区的会销比</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 删除线上销售的GBL6D01行，仅统计线下的会销比</span>
member_orders <span class="token operator">=</span> member_orders<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GBL6D01'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 会销比 = 会员消费的订单数 / 全部销售订单数</span>
result <span class="token operator">=</span> member_orders <span class="token operator">/</span> country_sales
result
<span class="token comment"># df.applymap()对每一个值都保留2位小数</span>
result <span class="token operator">=</span> result<span class="token punctuation">.</span>applymap<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">".2%"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
result

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-x5CQa6Ic-1630499468957)(./img/数据透视表-37.png)]</p> 
<h4><a id="29__761"></a>2.9 会员连带率分析</h4> 
<blockquote> 
 <ul><li>连带率的概念：<strong>连带率 = 消费数量（售出货物的总数） / 订单数量，是指销售的件数和交易的次数相除后的数值，反映的是顾客平均单次消费的产品件数</strong></li><li>连带率的作用： 
   <ul><li>连带率直接影响到客单价：连带率越高、客单价越高</li><li>大多数情况下，连带率反应运营质量：连带率变高，说明客单价变高、顾客一次买的东西变多了，从而说明运营动作有效果</li></ul> </li><li>为什么要计算分析连带率？ 
   <ul><li>通过连带率分析可以反映出人、货、场几个角度的业务问题</li></ul> </li></ul> 
</blockquote> 
<ul><li>获取分母df：按地区、年月统计订单的数量</li></ul> 
<pre><code class="prism language-python">custom_consume <span class="token comment"># 查看消费和地区店铺的连接表</span>
<span class="token comment"># 去掉退单数据，去掉网店数据</span>
order_data <span class="token operator">=</span> custom_consume<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">" 订单类型=='下单' &amp; 地区编码!='GBL6D01'"</span><span class="token punctuation">)</span>
<span class="token comment"># 提取有用的字段，并去重</span>
order_count <span class="token operator">=</span> order_data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'年月'</span><span class="token punctuation">,</span><span class="token string">'地区编码'</span><span class="token punctuation">,</span><span class="token string">'订单号'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 按地区、年月统计订单的数量</span>
order_count <span class="token operator">=</span> order_count<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'地区编码'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'年月'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'订单号'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">)</span>
order_count

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-4gXE0E3d-1630499468957)(./img/数据透视表-38.png)]</p> 
<ul><li>获取分子df：按地区、年月统计消费商品数量的总和</li></ul> 
<pre><code class="prism language-python">order_data <span class="token comment"># 订单数据表</span>
<span class="token comment"># 按地区、年月统计消费数量的总和</span>
consume_count <span class="token operator">=</span> order_data<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">'地区编码'</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token string">'年月'</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'消费数量'</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token builtin">sum</span><span class="token punctuation">)</span>
consume_count<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-0VP3RNGp-1630499468958)(./img/数据透视表-39.png)]</p> 
<ul><li>计算连带率：连带率 = 消费数量（售出货物的总数） / 订单数量</li></ul> 
<pre><code class="prism language-python">result <span class="token operator">=</span> consume_count <span class="token operator">/</span> order_count
<span class="token builtin">round</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">201801</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 保留2位小数</span>
<span class="token comment"># 显示二位小数</span>
result <span class="token operator">=</span> result<span class="token punctuation">.</span>applymap<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
result

</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-NLVSjN74-1630499468958)(./img/数据透视表-40.png)]</p> 
<h3><a id="_817"></a>小结</h3> 
<ul><li>透视表是数据分析中经常使用的API，跟Excel中的数据透视表功能类似</li><li>Pandas的数据透视表，pivot_table，常用几个参数 index，values，columns，aggfuc，margin</li><li>Pandas的功能与groupby功能类似</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/22cc9aad3028ea0631c13d6cf1e44581/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">WGS84地理坐标系和CGCS2000坐标相互转换</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/796cb34297de5126701ad31a1e9f43d3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">你了解红黑树么？告诉你一个不一样的红黑树，说点有意思的吧！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>