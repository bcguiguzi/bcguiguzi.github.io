<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql事务学习 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql事务学习" />
<meta property="og:description" content="mysql事务 1 事务简介 事务 是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。
2 事务的操作 drop table if exists account; create table account( id int primary key AUTO_INCREMENT comment &#39;ID&#39;, name varchar(10) comment &#39;姓名&#39;, money double(10,2) comment &#39;余额&#39; ) comment &#39;账户表&#39;; insert into account(name, money) VALUES (&#39;张三&#39;,2000), (&#39;李四&#39;,2000); 2.1 为控制事务 1）测试正常情况
-- 1. 查询张三余额 select * from account where name = &#39;张三&#39;; -- 2. 张三的余额减少1000 update account set money = money - 1000 where name = &#39;张三&#39;; -- 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/032ddd153d067ec16740e9a0418c8a49/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-13T09:41:40+08:00" />
<meta property="article:modified_time" content="2024-03-13T09:41:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql事务学习</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="mysql_0"></a>mysql事务</h2> 
<h3><a id="1__1"></a>1 事务简介</h3> 
<p>事务 是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。</p> 
<h3><a id="2__4"></a>2 事务的操作</h3> 
<pre><code class="prism language-java">	drop table <span class="token keyword">if</span> exists account<span class="token punctuation">;</span>
	create table <span class="token function">account</span><span class="token punctuation">(</span>
	id <span class="token keyword">int</span> primary key <span class="token constant">AUTO_INCREMENT</span> comment <span class="token char">'ID'</span><span class="token punctuation">,</span>
	name <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> comment <span class="token char">'姓名'</span><span class="token punctuation">,</span>
	money <span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> comment <span class="token char">'余额'</span>
	<span class="token punctuation">)</span> comment <span class="token char">'账户表'</span><span class="token punctuation">;</span>
	insert into <span class="token function">account</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> money<span class="token punctuation">)</span> <span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token char">'张三'</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token char">'李四'</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="21__15"></a>2.1 为控制事务</h3> 
<p>1）测试正常情况</p> 
<pre><code class="prism language-java"><span class="token operator">--</span> <span class="token number">1.</span> 查询张三余额
select <span class="token operator">*</span> from account where name <span class="token operator">=</span> <span class="token char">'张三'</span><span class="token punctuation">;</span>
<span class="token operator">--</span> <span class="token number">2.</span> 张三的余额减少<span class="token number">1000</span>
update account set money <span class="token operator">=</span> money <span class="token operator">-</span> <span class="token number">1000</span> where name <span class="token operator">=</span> <span class="token char">'张三'</span><span class="token punctuation">;</span>
<span class="token operator">--</span> <span class="token number">3.</span> 李四的余额增加<span class="token number">1000</span>
update account set money <span class="token operator">=</span> money <span class="token operator">+</span> <span class="token number">1000</span> where name <span class="token operator">=</span> <span class="token char">'李四'</span><span class="token punctuation">;</span>
</code></pre> 
<p>测试完毕之后检查数据的状态, 可以看到数据操作前后是一致的。<br> <img src="https://images2.imgbox.com/49/6e/igspjEar_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>测试异常情况</li></ol> 
<pre><code class="prism language-java"><span class="token operator">--</span> <span class="token number">1.</span> 查询张三余额
select <span class="token operator">*</span> from account where name <span class="token operator">=</span> <span class="token char">'张三'</span><span class="token punctuation">;</span>
<span class="token operator">--</span> <span class="token number">2.</span> 张三的余额减少<span class="token number">1000</span>
update account set money <span class="token operator">=</span> money <span class="token operator">-</span> <span class="token number">1000</span> where name <span class="token operator">=</span> <span class="token char">'张三'</span><span class="token punctuation">;</span>
出错了<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">--</span> <span class="token number">3.</span> 李四的余额增加<span class="token number">1000</span>
update account set money <span class="token operator">=</span> money <span class="token operator">+</span> <span class="token number">1000</span> where name <span class="token operator">=</span> <span class="token char">'李四'</span><span class="token punctuation">;</span>
</code></pre> 
<p>我们把数据都恢复到2000，然后再次执行上述的sql语句(出错了 。。。 这句话不符合sql语法，执行就会报错)，检查最终的数据情况，发现数据在操作前后不一致了。</p> 
<h3><a id="22__43"></a>2.2 控制事务一</h3> 
<p>1）查看/设置事务提交方式</p> 
<pre><code class="prism language-java"><span class="token constant">SELECT</span> @<span class="token annotation punctuation">@autocommit</span><span class="token punctuation">;</span>
set @<span class="token annotation punctuation">@autocommit</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> 
<p>2）提交事务</p> 
<pre><code class="prism language-java"><span class="token constant">COMMIT</span>；
</code></pre> 
<ol start="3"><li>回滚事务</li></ol> 
<pre><code class="prism language-java"><span class="token constant">ROLLBACK</span>；
</code></pre> 
<blockquote> 
 <p>注意：上述的这种方式，我们是修改了事务的自动提交行为, 把默认的自动提交修改为了手动提<br> 交, 此时我们执行的DML语句都不会提交, 需要手动的执行commit进行提交。</p> 
</blockquote> 
<h3><a id="23__63"></a>2.3 控制事务二</h3> 
<p>1） 开启事务</p> 
<pre><code class="prism language-java">start transaction 或 <span class="token class-name">Begin</span>；
</code></pre> 
<p>2）提交事务<br> COMMIT；</p> 
<p>3）回滚事务</p> 
<pre><code class="prism language-java"><span class="token constant">ROLLBACK</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token operator">--</span> 开启事务
start transaction
<span class="token operator">--</span> <span class="token number">1.</span> 查询张三余额
select <span class="token operator">*</span> from account where name <span class="token operator">=</span> <span class="token char">'张三'</span><span class="token punctuation">;</span>
<span class="token operator">--</span> <span class="token number">2.</span> 张三的余额减少<span class="token number">1000</span>
update account set money <span class="token operator">=</span> money <span class="token operator">-</span> <span class="token number">1000</span> where name <span class="token operator">=</span> <span class="token char">'张三'</span><span class="token punctuation">;</span>
<span class="token operator">--</span> <span class="token number">3.</span> 李四的余额增加<span class="token number">1000</span>
update account set money <span class="token operator">=</span> money <span class="token operator">+</span> <span class="token number">1000</span> where name <span class="token operator">=</span> <span class="token char">'李四'</span><span class="token punctuation">;</span>
<span class="token operator">--</span> 如果正常执行完毕<span class="token punctuation">,</span> 则提交事务
commit<span class="token punctuation">;</span>
<span class="token operator">--</span> 如果执行过程中报错<span class="token punctuation">,</span> 则回滚事务
<span class="token operator">--</span> rollback<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="3__93"></a>3 事务四大特性</h2> 
<ul><li>原子性(Atomicity)：事务是不可分割的最小操作单元，要么全部成功，要么全部失败。</li><li>一致性(Consistency): 事务完成时，必须使所有的数据都保持一致状态</li><li>隔离性(Isolation)：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。</li><li>持久性(Durability): 事务一旦提交或回滚，它对数据库中的数据的改变就是永久的<br> 上述就是事务的四大特性，简称ACID。</li></ul> 
<h2><a id="4_101"></a>4.并发事务问题</h2> 
<ul><li>脏读：一个事务读到另外一个事务还没有提交的数据<br> <img src="https://images2.imgbox.com/bb/e1/KKGnigAP_o.png" alt="在这里插入图片描述"></li><li>不可重复读：一个事务先后读取同一条记录，单两次读取的数据不同，称之为不可重复读<br> <img src="https://images2.imgbox.com/f2/e0/WTY84yEr_o.png" alt="在这里插入图片描述"></li><li>幻读：一个事务按照条件查询数据时，没有对应的数据行，但是在插入数据时，又发现这行数据已经存在，好像出现了‘幻影’<br> <img src="https://images2.imgbox.com/b3/0e/7rIbS7XD_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="5_110"></a>5.事务隔离基本</h2> 
<p>为了解决并发事务所引发的问题，在数据库中引入了事务隔离级别。主要有以下几种：<br> <img src="https://images2.imgbox.com/6d/99/49X0Zm52_o.png" alt="在这里插入图片描述"></p> 
<p>1） 查看事务隔离级别</p> 
<blockquote> 
 <p>select @@Transaction_isolation;</p> 
</blockquote> 
<ol start="2"><li>设置事务隔离级别</li></ol> 
<blockquote> 
 <p>SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL { READ UNCOMMITTED |<br> READ COMMITTED | REPEATABLE READ | SERIALIZABLE }</p> 
 <p>注意：事务隔离级别越高，数据越安全，但是性能越低</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f33f6775c7f1214bf3576586ec97fefb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ES6（二）：解构赋值、Symbol、Map和Set、数组的扩展方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0dff066339bdde8653a0291238f5eb16/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Electron内调用网页出现 $ is not defined 或者 jQuery is not defined</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>