<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux之防火墙详解 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux之防火墙详解" />
<meta property="og:description" content="华子目录 什么时防火墙分类Netfilter（数据包过滤）定义Netfilter分析内容 防火墙无法完成的任务iptables与firewalld区别iptablesiptables执行原则原则防火墙规则规则链概念分析规则链分类注意例：物业管理公司有两条规定： 规则链之间的匹配顺序iptables流量处理动作iptables表四种规则表 安装iptables预处理管理命令规则链存储文件 iptables命令原则格式参数示例 实验1实验2实验3firewalld概念firewalld特点区域zone作用例分析zone文件中的过滤规则 firewall-cmd可视化界面工具安装使用 firewall-cmd命令行工具firewalld命令生效模式管理命令设置命令firewall-cmd参数示例1示例2示例3示例3总结 示例4示例5firewalld 富规则格式 什么时防火墙 防火墙时位于内部网和外部网之间的屏障，它按照系统管理员预先定义好的规则来控制数据包的进出。 分类 硬件防火墙：由厂商设计好的主机硬件，其操作系统主要以提供数据包数据的过滤机制为主，并去掉不必要的功能。软件防火墙：保护系统网络安全的一套软件（或称为机制） Netfilter（数据包过滤） 定义 netfilter是一个工作在Linux内核的网络数据包处理框架，用于分析进入主机的网络数据包，将数据包的头部数据（硬件地址，软件地址，TCP，UDP，ICMP等）提取出来进行分析，来决定该连接为放行还是抵挡的机制，主要用于分析OSI七层协议的2，3，4层 Netfilter分析内容 拒绝让Internet的数据包进入主机的某些端口拒绝某些来源IP的数据包进入拒绝让带有某些特殊标志（flag）的数据包进入，如：带有SYN的主动连接标志分析MAC地址决定是否连接 防火墙无法完成的任务 防火墙并不能杀毒或清除木马程序（假设主机开放了www服务，那么防火墙的设置一定是要将www服务的port开放给client端的。假设www服务器软件有漏洞，或者请求www服务的数据包本身就是病毒的一部分时，防火墙时阻止不了的）防火墙无法阻止来自内部LAN的攻击（防火墙对于内部的规则设置通常比较少，所以就很容易造成内部员工对于网络滥用的情况） iptables与firewalld区别 netfilter数据包过滤机制是由Linux内核建立的，不同的内核版本使用的设置防火墙策略的软件不一样，从红帽7系统开始firewalld服务取代了iptables服务iptables与firewalld都不是真正的防火墙，它们都只是用来定义防火墙策略的防火墙管理工具而已，即只是一种服务，而真正使用规则干活的是内核的netfilter总之，当前Linux系统中的防火墙管理工具，旨在方便运维人员管理Linux系统中的防火墙策略，我们只需要配置妥当其中的一个就足够了。当然这些工具各有优劣，但它们在防火墙策略的配置思路上是保持一致的 iptables 早期的Linux系统中，默认使用iptables防火墙来管理服务和配置防火墙，虽然新型的firewalld防火墙管理服务已经被投入使用多年，但是iptables在当前生产环境中还继续使用，具有顽强的生命力 iptables执行原则 原则 防火墙会从上至下的顺序来读取配置的策略规则，在找到匹配项后就立即结束配置工作并去执行匹配项中定义的行为（即放行或阻止）如果在读取完所有的策略规则后没有匹配项，就去执行默认的策略 防火墙规则 通（放行，允许）堵（阻止，拒绝）（一类：返回信息后拒绝，另一类：直接丢包）当默认策略为拒绝时，就要设置允许规则，否则数据包都进不来；若默认策略为允许时，就要设置拒绝规则=，否则数据包都能进来，防火墙也就失去了作用 规则链 概念 iptables服务把用于过滤流量的策略条目称之为规则，多条规则组成一个规则链 分析 数据包经过iptables处理必须闯过5个控制关卡，每个关卡放置5个规则链用于检查规则和处理，每一道关卡中有多个规则，数据报文必须按顺序一个一个匹配这些规则，这些规则串起来就像一条链，所以我们把这些关卡都叫作规则链 规则链分类 input链：数据包流入时，即数据包从内核流入用户空间output链：向外发送数据包（流出）时，即数据包从用户空间流出到内核空间，一般不配置forward链：处理数据包转发时，即在内核空间中，从一个网络接口进入到另一个网络接口去（转发过滤）prerouting链：在对数据包作路由选择之前，即互联网进入局域网postrouting链：在对数据包作路由选择之后，即局域网出互联网 注意 从内网向外网发送的流量一般都是可控且良性的，因此使用最多的是input规则链，该规则链可以增大黑客人员从外网入侵内网的难度
例：物业管理公司有两条规定： 1.禁止小商小贩进入社区2.各种车辆在进入社区时都要登记这两条规定是用于社区正门的（流量必须经过的地方），而不是每家的防盗门。根据防火墙策略的匹配顺序，可能会存在多种情况如：来访人员是小商小贩，则会被保安拒之门外，也就是无需再对车辆进行登记。若来访人员乘坐一辆汽车进入社区正门，则==&#34;禁止小商小贩进入社区&#34;的第一条规则就没有被匹配到==，因此按照顺序匹配第二条策略，既需要对车辆进行登记。如果是社区居民要进入正门，则这两条规定都不会匹配到，因此会执行默认的放行策略 规则链之间的匹配顺序 主机型防火墙：
入站数据（来自外界的数据包，且目标地址是防火墙本机）：prerouting------&gt;input----&gt;本机的应用程序出站数据（从防火墙本机向外部地址发送的数据包）：本机的应用程序-----&gt;output------&gt;postrouting 网络型防火墙：转发数据（需要经过防火墙转发的数据包）：prerouting------&gt;forward--------&gt;postrouting
规则链内的匹配顺序
自上向下按顺序依次进行检查，找到相匹配的规则就立即停止（log策略例外，表示记录相关日志）若在该链内找不到相匹配的规则，则按该链的默认策略处理（未修改的状况下，默认策略为允许） iptables流量处理动作 当规则链匹配后应采用以下几种动作来处理匹配的流量 accept：允许流量通过reject：拒绝流量通过，拒绝后回复拒绝信息log：记录日志信息drop：拒绝流量通过，流量丢弃不回复 例：若某天你正在家里看电视，突然听到有人敲门，透过防盗门的猫眼一看是推销商品的，便会在不需要的情况下开门并拒绝他们（reject）。但如果你看到的是债主带了十几个小弟来讨债，此时不仅要拒绝开门，还要默不作声，伪装成自己不在家的样子（drop） iptables表 规则链容纳了各种流量匹配规则，规则表则存储了不同功能对应的规则链，总之：表里有链，链里有规则 四种规则表 filter表：用于对数据包过滤（外网进入内网时），根据具体的规则决定是否放行该数据包（如drop，accept，reject，log），包含三个规则链：input，forward，output，所谓的防火墙其实基本上是指这张表上的过滤规则，常用nat表：network，address，translation，网络地址转换功能，主要用于修改数据包的源，目标IP地址，端口，包含三个规则链，output，prerouting，postroutingmangle表：拆解报文，做出修改，并重新封装，主要用于修改数据包的TOS(Type Of Service，服务类型)、TTL(Time To Live，生存周期)值以及为数据包设置Mark标记，由于需要相应的路由设备支持，因此应用并不广泛，包含全部五个规则链raw表：是自1.2.9以后版本的iptables新增的表，用于是否对该数据包进行状态跟踪，在匹配数据包时，raw表的规则要优先于其他表，包含两个规则链，OUTPUT、PREROUTING注意：最终定义的防火墙规则链，都会添加到这四张表中的其中一张表中，如图： 安装iptables 预处理 RHEL(Centos)9中默认使用的是firewalld，且与iptables之间有冲突，如果需要使用 iptables 需要先停止firewalld再进行安装： [root@server ~]# systemctl stop firewalld [root@server ~]# systemctl disable firewalld # RHEL9安装iptables： [root@server ~]# yum list | grep iptables # 查询安装包名 iptables-libs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/0916230a39d7428c3bca58868a1c7ed9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-12T01:35:59+08:00" />
<meta property="article:modified_time" content="2024-03-12T01:35:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux之防火墙详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>华子目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">什么时防火墙</a></li><li><a href="#_6" rel="nofollow">分类</a></li><li><a href="#Netfilter_10" rel="nofollow">Netfilter（数据包过滤）</a></li><li><ul><li><a href="#_11" rel="nofollow">定义</a></li><li><a href="#Netfilter_14" rel="nofollow">Netfilter分析内容</a></li></ul> 
  </li><li><a href="#_20" rel="nofollow">防火墙无法完成的任务</a></li><li><a href="#iptablesfirewalld_24" rel="nofollow">iptables与firewalld区别</a></li><li><a href="#iptables_29" rel="nofollow">iptables</a></li><li><a href="#iptables_32" rel="nofollow">iptables执行原则</a></li><li><ul><li><a href="#_33" rel="nofollow">原则</a></li><li><a href="#_37" rel="nofollow">防火墙规则</a></li><li><a href="#_42" rel="nofollow">规则链</a></li><li><ul><li><a href="#_43" rel="nofollow">概念</a></li><li><a href="#_46" rel="nofollow">分析</a></li><li><a href="#_49" rel="nofollow">规则链分类</a></li><li><ul><li><a href="#_57" rel="nofollow">注意</a></li><li><a href="#_59" rel="nofollow">例：物业管理公司有两条规定：</a></li></ul> 
    </li><li><a href="#_65" rel="nofollow">规则链之间的匹配顺序</a></li><li><a href="#iptables_75" rel="nofollow">iptables流量处理动作</a></li><li><a href="#iptables_83" rel="nofollow">iptables表</a></li><li><ul><li><a href="#_86" rel="nofollow">四种规则表</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#iptables_93" rel="nofollow">安装iptables</a></li><li><ul><li><a href="#_94" rel="nofollow">预处理</a></li><li><a href="#_125" rel="nofollow">管理命令</a></li><li><a href="#_142" rel="nofollow">规则链存储文件</a></li></ul> 
  </li><li><a href="#iptables_166" rel="nofollow">iptables命令</a></li><li><ul><li><a href="#_167" rel="nofollow">原则</a></li><li><a href="#_170" rel="nofollow">格式</a></li><li><a href="#_183" rel="nofollow">参数</a></li><li><a href="#_206" rel="nofollow">示例</a></li></ul> 
  </li><li><a href="#1_329" rel="nofollow">实验1</a></li><li><a href="#2_381" rel="nofollow">实验2</a></li><li><a href="#3_384" rel="nofollow">实验3</a></li><li><a href="#firewalld_408" rel="nofollow">firewalld概念</a></li><li><a href="#firewalld_412" rel="nofollow">firewalld特点</a></li><li><ul><li><a href="#zone_420" rel="nofollow">区域zone</a></li><li><ul><li><a href="#_421" rel="nofollow">作用</a></li><li><a href="#_425" rel="nofollow">例</a></li><li><a href="#_429" rel="nofollow">分析</a></li><li><a href="#zone_461" rel="nofollow">zone文件中的过滤规则</a></li></ul> 
  </li></ul> 
  </li><li><a href="#firewallcmd_480" rel="nofollow">firewall-cmd可视化界面工具</a></li><li><ul><li><a href="#_481" rel="nofollow">安装</a></li><li><a href="#_493" rel="nofollow">使用</a></li></ul> 
  </li><li><a href="#firewallcmd_500" rel="nofollow">firewall-cmd命令行工具</a></li><li><ul><li><a href="#firewalld_501" rel="nofollow">firewalld命令生效模式</a></li><li><a href="#_505" rel="nofollow">管理命令</a></li><li><a href="#firewallcmd_520" rel="nofollow">设置命令firewall-cmd参数</a></li><li><a href="#1_540" rel="nofollow">示例1</a></li><li><a href="#2_571" rel="nofollow">示例2</a></li><li><a href="#3_593" rel="nofollow">示例3</a></li><li><ul><li><a href="#3_621" rel="nofollow">示例3总结</a></li></ul> 
   </li><li><a href="#4_630" rel="nofollow">示例4</a></li><li><a href="#5_653" rel="nofollow">示例5</a></li><li><ul><li><a href="#firewalld__656" rel="nofollow">firewalld 富规则</a></li><li><a href="#_661" rel="nofollow">格式</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>什么时防火墙</h2> 
<ul><li>防火墙时位于<mark>内部网</mark>和<mark>外部网</mark>之间的屏障，它按照系统管理员<mark>预先</mark>定义好的<mark>规则</mark>来控制数据包的进出。</li></ul> 
<p><img src="https://images2.imgbox.com/cf/6e/pIWgfWzt_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_6"></a>分类</h2> 
<ul><li><mark>硬件防火墙</mark>：由厂商设计好的主机<mark>硬件</mark>，其操作系统主要以提供<mark>数据包数据的过滤机制</mark>为主，并去掉不必要的功能。</li><li><mark>软件防火墙</mark>：保护系统网络安全的一套<mark>软件</mark>（或称为机制）</li></ul> 
<h2><a id="Netfilter_10"></a>Netfilter（数据包过滤）</h2> 
<h3><a id="_11"></a>定义</h3> 
<ul><li><mark>netfilter</mark>是一个工作在<mark>Linux内核</mark>的<mark>网络数据包处理框架</mark>，用于<mark>分析进入主机的网络数据包</mark>，将数据包的头部数据（<mark>硬件地址，软件地址，TCP，UDP，ICMP等</mark>）提取出来进行分析，来决定该连接为<mark>放行</mark>还是<mark>抵挡</mark>的机制，主要用于分析<mark>OSI七层协议的2，3，4层</mark></li></ul> 
<h3><a id="Netfilter_14"></a>Netfilter分析内容</h3> 
<ul><li><mark>拒绝让Internet的数据包</mark>进入主机的<mark>某些端口</mark></li><li>拒绝某些<mark>来源IP</mark>的数据包<mark>进入</mark></li><li>拒绝让带有某些<mark>特殊标志（flag）的数据包进入</mark>，如：带有<mark>SYN</mark>的主动连接标志</li><li>分析<mark>MAC地址决定是否连接</mark></li></ul> 
<h2><a id="_20"></a>防火墙无法完成的任务</h2> 
<ul><li>防火墙并<mark>不能杀毒</mark>或<mark>清除木马程序</mark>（假设主机<mark>开放了www服务</mark>，那么防火墙的设置一定是要<mark>将www服务的port开放给client端的</mark>。假设<mark>www服务器软件有漏洞</mark>，或者<mark>请求www服务的数据包本身就是病毒</mark>的一部分时，<mark>防火墙时阻止不了的</mark>）</li><li><mark>防火墙无法阻止来自内部LAN的攻击</mark>（防火墙对于<mark>内部的规则设置通常比较少</mark>，所以就很容易造成<mark>内部员工对于网络滥用的情况</mark>）</li></ul> 
<h2><a id="iptablesfirewalld_24"></a>iptables与firewalld区别</h2> 
<ul><li><mark>netfilter数据包过滤机制</mark>是由<mark>Linux内核</mark>建立的，<mark>不同的内核版本</mark>使用的<mark>设置防火墙策略</mark>的<mark>软件</mark>不一样，从<mark>红帽7</mark>系统开始<mark>firewalld服务取代了iptables服务</mark></li><li><mark>iptables</mark>与<mark>firewalld</mark>都<mark>不是真正的防火墙</mark>，它们都只是用来定义防火墙策略的<mark>防火墙管理工具</mark>而已，即只是<mark>一种服务</mark>，而<mark>真正</mark>使用规则<mark>干活</mark>的是<mark>内核的netfilter</mark></li><li>总之，当前Linux系统中的<mark>防火墙管理工具</mark>，旨在<mark>方便运维人员管理Linux系统中的防火墙策略</mark>，我们只需要配置妥当其中的一个就足够了。当然这些工具<mark>各有优劣</mark>，但它们在防火墙策略的<mark>配置思路上是保持一致的</mark></li></ul> 
<h2><a id="iptables_29"></a>iptables</h2> 
<ul><li>早期的Linux系统中，<mark>默认使用iptables防火墙</mark>来管理服务和配置<mark>防火墙</mark>，虽然<mark>新型的firewalld防火墙管理服务已经被投入使用多年</mark>，但是<mark>iptables</mark>在当前生产环境中<mark>还继续使用，具有顽强的生命力</mark></li></ul> 
<h2><a id="iptables_32"></a>iptables执行原则</h2> 
<h3><a id="_33"></a>原则</h3> 
<ul><li><mark>防火墙</mark>会<mark>从上至下</mark>的顺序来<mark>读取配置的策略规则</mark>，在<mark>找到匹配项</mark>后就<mark>立即结束配置工作</mark>并去<mark>执行匹配项中定义的行为（即放行或阻止）</mark></li><li>如果在<mark>读取完所有的策略规则后没有匹配项</mark>，就去<mark>执行默认的策略</mark></li></ul> 
<h3><a id="_37"></a>防火墙规则</h3> 
<ul><li><mark>通（放行，允许）</mark></li><li><mark>堵（阻止，拒绝）（一类：返回信息后拒绝，另一类：直接丢包）</mark></li><li>当<mark>默认策略为拒绝时</mark>，就要设置<mark>允许规则</mark>，否则数据包都进不来；若<mark>默认策略为允许</mark>时，就要<mark>设置拒绝规则</mark>=，否则数据包都能进来，防火墙也就失去了作用</li></ul> 
<h3><a id="_42"></a>规则链</h3> 
<h4><a id="_43"></a>概念</h4> 
<ul><li><mark>iptables服务</mark>把用于<mark>过滤流量</mark>的<mark>策略条目</mark>称之为<mark>规则</mark>，<mark>多条规则</mark>组成一个<mark>规则链</mark></li></ul> 
<h4><a id="_46"></a>分析</h4> 
<ul><li><mark>数据包经过iptables处理</mark>必须<mark>闯过5个控制关卡</mark>，<mark>每个关卡放置5个规则链</mark>用于检查规则和处理，每一道关卡中有<mark>多个规则</mark>，数据报文必须<mark>按顺序</mark>一个一个匹配这些规则，<mark>这些规则串起来就像一条链</mark>，所以我们把这些关卡都叫作<mark>规则链</mark></li><li><img src="https://images2.imgbox.com/22/08/iInq1AE5_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="_49"></a>规则链分类</h4> 
<p><img src="https://images2.imgbox.com/1d/0b/ni5IjFeg_o.png" alt="在这里插入图片描述"></p> 
<ul><li><mark>input链</mark>：<mark>数据包流入</mark>时，即数据包从<mark>内核</mark>流入<mark>用户空间</mark></li><li><mark>output链</mark>：<mark>向外发送</mark>数据包（流出）时，即数据包从<mark>用户空间</mark>流出到<mark>内核空间</mark>，一般不配置</li><li><mark>forward链</mark>：处理数据包<mark>转发</mark>时，即<mark>在内核空间中，从一个网络接口进入到另一个网络接口去（转发过滤）</mark></li><li><mark>prerouting链</mark>：在对数据包作<mark>路由选择之前</mark>，即<mark>互联网进入局域网</mark></li><li><mark>postrouting链</mark>：在对数据包作<mark>路由选择之后</mark>，即<mark>局域网出互联网</mark></li></ul> 
<h5><a id="_57"></a>注意</h5> 
<p><mark>从内网向外网发送的流量一般都是可控且良性的</mark>，因此使用最多的是<mark>input规则链</mark>，该规则链可以<mark>增大</mark>黑客人员从外网入侵内网的<mark>难度</mark></p> 
<h5><a id="_59"></a>例：物业管理公司有两条规定：</h5> 
<ul><li><mark>1.禁止小商小贩进入社区</mark></li><li><mark>2.各种车辆在进入社区时都要登记</mark></li><li>这两条规定是用于社区正门的（流量必须经过的地方），而不是每家的防盗门。根据防火墙策略的匹配顺序，可能会存在多种情况</li><li>如：来访人员是<mark>小商小贩</mark>，则会被<mark>保安拒之门外</mark>，也就是<mark>无需再对车辆进行登记</mark>。若<mark>来访人员乘坐一辆汽车进入社区正门</mark>，则=="禁止小商小贩进入社区"的第一条规则就没有被匹配到==，因此<mark>按照顺序匹配第二条策略</mark>，既<mark>需要对车辆进行登记</mark>。如果是<mark>社区居民要进入正门</mark>，则这两条规定<mark>都不会匹配到</mark>，因此<mark>会执行默认的放行策略</mark></li></ul> 
<h4><a id="_65"></a>规则链之间的匹配顺序</h4> 
<ul><li> <p><mark>主机型防火墙：</mark></p> 
  <ul><li><mark>入站数据</mark>（来自外界的数据包，且<mark>目标</mark>地址是<mark>防火墙本机</mark>）：<mark>prerouting------&gt;input----&gt;本机的应用程序</mark></li><li><mark>出站数据</mark>（从防火墙本机<mark>向外部地址发送</mark>的数据包）：<mark>本机的应用程序-----&gt;output------&gt;postrouting</mark></li></ul> </li><li> <p><mark>网络型防火墙</mark>：转发数据（需要<mark>经过防火墙转发</mark>的数据包）：<mark>prerouting------&gt;forward--------&gt;postrouting</mark></p> </li><li> <p><mark>规则链内的匹配顺序</mark></p> 
  <ul><li><mark>自上向下</mark>按顺序<mark>依次进行检查</mark>，找到<mark>相匹配的规则就立即停止</mark>（log策略例外，表示记录相关日志）</li><li><mark>若在该链内找不到相匹配的规则</mark>，则<mark>按该链的默认策略处理（未修改的状况下，默认策略为允许）</mark></li></ul> </li></ul> 
<h4><a id="iptables_75"></a>iptables流量处理动作</h4> 
<ul><li><mark>当规则链匹配后</mark>应采用以下<mark>几种动作来处理匹配的流量</mark> 
  <ul><li><mark>accept：允许流量通过</mark></li><li><mark>reject：拒绝流量通过，拒绝后回复拒绝信息</mark></li><li><mark>log：记录日志信息</mark></li><li><mark>drop：拒绝流量通过，流量丢弃不回复</mark></li></ul> </li><li>例：若某天你正在家里看电视，突然听到有人敲门，透过防盗门的猫眼一看是推销商品的，便会<mark>在不需要的情况下开门并拒绝他们（reject</mark>）。但<mark>如果你看到的是债主带了十几个小弟来讨债，此时不仅要拒绝开门，还要默不作声，伪装成自己不在家的样子（drop）</mark></li></ul> 
<h4><a id="iptables_83"></a>iptables表</h4> 
<ul><li><mark>规则链容纳了各种流量匹配规则</mark>，<mark>规则表则存储了不同功能对应的规则链</mark>，总之：<mark>表里有链，链里有规则</mark></li></ul> 
<h5><a id="_86"></a>四种规则表</h5> 
<ul><li><mark>filter表</mark>：用于对<mark>数据包过滤</mark>（<mark>外网进入内网时</mark>），根据具体的规则决定是否放行该数据包（<mark>如drop，accept，reject，log</mark>），<mark>包含三个规则链：input，forward，output</mark>，<mark>所谓的防火墙其实基本上是指这张表上的过滤规则，常用</mark></li><li><mark>nat表</mark>：network，address，translation，网络地址转换功能，<mark>主要用于修改数据包的源，目标IP地址，端口</mark>，包含<mark>三个规则链，output，prerouting，postrouting</mark></li><li><mark>mangle表</mark>：拆解报文，做出修改，并重新封装，<mark>主要用于修改数据包的TOS(Type Of Service，服务类型)、TTL(Time To Live，生存周期)值以及为数据包设置Mark标记</mark>，由于需要相应的路由设备支持，因此应用并不广泛，<mark>包含全部五个规则链</mark></li><li><mark>raw表</mark>：是自1.2.9以后版本的<mark>iptables新增的表</mark>，<mark>用于是否对该数据包进行状态跟踪</mark>，在匹配数据包时，<mark>raw表的规则要优先于其他表</mark>，<mark>包含两个规则链，OUTPUT、PREROUTING</mark></li><li><mark>注意：最终定义的防火墙规则链，都会添加到这四张表中的其中一张表中，如图：</mark></li><li><img src="https://images2.imgbox.com/05/af/iyzuY4Gt_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="iptables_93"></a>安装iptables</h2> 
<h3><a id="_94"></a>预处理</h3> 
<ul><li>R<mark>HEL(Centos)9</mark>中默认使用的是<mark>firewalld</mark>，且与<mark>iptables之间有冲突</mark>，如果需要<mark>使用 iptables</mark> 需要先<mark>停止firewalld再进行安装：</mark></li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop  firewalld</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl disable  firewalld</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># RHEL9安装iptables：</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># yum  list  |  grep  iptables  # 查询安装包名</span>
iptables-libs.x86_64                                 <span class="token number">1.8</span>.8-4.el9                        @anaconda
iptables-nft.x86_64                                  <span class="token number">1.8</span>.8-4.el9                        @anaconda
iptables-devel.i686                                  <span class="token number">1.8</span>.10-2.el9                       app
iptables-devel.x86_64                                <span class="token number">1.8</span>.10-2.el9                       app
iptables-libs.i686                                   <span class="token number">1.8</span>.10-2.el9                       base
iptables-libs.x86_64                                 <span class="token number">1.8</span>.10-2.el9                       base
iptables-nft.x86_64                                  <span class="token number">1.8</span>.10-2.el9
       base
iptables-nft-services.noarch                         <span class="token number">1.8</span>.10-2.el9
       app
iptables-utils.x86_64                                <span class="token number">1.8</span>.10-2.el9
       base


<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># yum  install  iptables-nft-services  -y</span>

<span class="token comment"># RHEL8安装iptables：</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># yum  install iptables-services -y</span>
</code></pre> 
<h3><a id="_125"></a>管理命令</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl start iptables</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable iptables</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl status iptables</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop iptables</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart iptables</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># service  iptables save   #保存设置的规则</span>
<span class="token comment"># 注意：保存设置的规则，否则重启后会恢复默认设置，不能用systemctl save  iptables</span>
</code></pre> 
<h3><a id="_142"></a>规则链存储文件</h3> 
<p>规则链存储文件在 <mark>/etc/sysconfig/iptables</mark></p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># vim   /etc/sysconfig/iptables</span>

<span class="token comment"># sample configuration for iptables service</span>
<span class="token comment"># you can edit this manually or use system-config-firewall</span>
<span class="token comment"># please do not ask us to add additional ports/services to this default configuration</span>
*filter
:INPUT ACCEPT <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:FORWARD ACCEPT <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:OUTPUT ACCEPT <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
<span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> RELATED,ESTABLISHED <span class="token parameter variable">-j</span> ACCEPT
<span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-j</span> ACCEPT
<span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-i</span> lo <span class="token parameter variable">-j</span> ACCEPT
<span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> NEW <span class="token parameter variable">-m</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> ACCEPT
<span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-j</span> REJECT --reject-with icmp-host-prohibited
<span class="token parameter variable">-A</span> FORWARD <span class="token parameter variable">-j</span> REJECT --reject-with icmp-host-prohibited
COMMIT
</code></pre> 
<ul><li><mark>前三行为注释</mark></li><li><mark>这是filter表的规则链</mark></li></ul> 
<h2><a id="iptables_166"></a>iptables命令</h2> 
<h3><a id="_167"></a>原则</h3> 
<ul><li><mark>iptables</mark> 命令根据流量的<mark>源地址、目的地址、传输协议、服务类型等信息</mark>进行匹配，若匹配成，则iptables 会根据<mark>策略规则</mark>所预设的动作<mark>来处理这些流量</mark>，由于策略规则的匹配顺序是<mark>从上至下</mark>，则要<mark>把较为严格、优先级较高的策略规则放到前面，以免发生错误</mark></li></ul> 
<h3><a id="_170"></a>格式</h3> 
<ul><li>简化</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables [-t 表名] 选项 [链名] [条件] [-j 控制动作]</span>

</code></pre> 
<ul><li>详细</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables -t 表名 &lt;-A/I/D/R&gt; 规则链名 [规则号] &lt;-i/o 网卡名&gt; -p 协议名 &lt;-s 源IP/源子网&gt; --sport 源端口 &lt;-d 目标IP/目标子网&gt; --dport 目标端口 -j 控制动作</span>
</code></pre> 
<h3><a id="_183"></a>参数</h3> 
<table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-t</td><td>对<mark>指定的表进行操作</mark>，<mark>table必须是raw，nat，filter，mangle中的一个</mark>，<mark>默认是filter</mark></td></tr><tr><td>-p</td><td>指定要匹配的数据包<mark>协议类型</mark></td></tr><tr><td>-s</td><td>匹配<mark>源地址ip/mask</mark>，若有，表示取反</td></tr><tr><td>-d</td><td>匹配<mark>目的地址ip/mask</mark></td></tr><tr><td>-i 网卡名</td><td>匹配<mark>从这块网卡流入的数据</mark></td></tr><tr><td>-o 网卡名</td><td>匹配<mark>从这块网卡流出的数据</mark></td></tr><tr><td>-L</td><td><mark>列出规则链上的所有规则</mark>，<mark>如果没有指定链，列出表上所有链的所有规则</mark></td></tr><tr><td>-A</td><td>在规则链的<mark>末尾加入新规则</mark></td></tr><tr><td>-l num</td><td>在规则链的<mark>头部加入新规则</mark></td></tr><tr><td>-D num</td><td><mark>删除</mark>指定规则</td></tr><tr><td>-R num</td><td><mark>替换/修改第几条规则</mark></td></tr><tr><td>-P</td><td>设置默认策略</td></tr><tr><td>-F</td><td><mark>清空所有规则(F:flush是“冲洗、冲掉”的意思)</mark></td></tr><tr><td>-N</td><td><mark>创建新规则链</mark></td></tr><tr><td>-X</td><td>删除指定规则链，这个链必须没有被其它任何规则引用，而且这条链上必须没有任何规则。如果没有指定链名，则会删除该表中所有非内置的链</td></tr><tr><td>-E</td><td>用<mark>指定的新名字去重命名指定的链</mark></td></tr><tr><td>-Z</td><td>把指定链，或者表中的<mark>所有链</mark>上的<mark>所有计数器清零</mark></td></tr><tr><td>-j</td><td><mark>满足某条件时该执行什么样的动作</mark></td></tr><tr><td>-h</td><td>显示帮助信息</td></tr></tbody></table> 
<h3><a id="_206"></a>示例</h3> 
<ul><li><mark>查看已有的防火墙规则链</mark></li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables -nvxL --line</span>
<span class="token comment"># 参数释义</span>
	<span class="token comment"># -n：显示源</span>
	<span class="token comment"># -v：详细信息</span>
	<span class="token comment"># -x：单位自动转换为KB\MB</span>
	<span class="token comment"># -L：写在最后，列出所有规则</span>
	<span class="token comment"># --line：增加行号</span>


<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables -nvxL --line</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination
<span class="token number">1</span>         <span class="token number">159</span>    <span class="token number">24271</span> ACCEPT     <span class="token number">0</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            state RELATED,ESTABLISHED
<span class="token number">2</span>           <span class="token number">0</span>        <span class="token number">0</span> ACCEPT     <span class="token number">1</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">3</span>           <span class="token number">0</span>        <span class="token number">0</span> ACCEPT     <span class="token number">0</span>    --  lo     *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">4</span>           <span class="token number">0</span>        <span class="token number">0</span> ACCEPT     <span class="token number">6</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            state NEW tcp dpt:22
<span class="token number">5</span>          <span class="token number">19</span>     <span class="token number">1843</span> REJECT     <span class="token number">0</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            reject-with icmp-host-prohibited

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination
<span class="token number">1</span>           <span class="token number">0</span>        <span class="token number">0</span> REJECT     <span class="token number">0</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            reject-with icmp-host-prohibited

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">143</span> packets, <span class="token number">12422</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination


<span class="token comment"># 显示释义</span>
	<span class="token comment"># num：规则的行号</span>
	<span class="token comment"># pkts：数据包数量</span>
	<span class="token comment"># bytes：数据包字节数</span>
	<span class="token comment"># target：动作（放行、拒绝）</span>
	<span class="token comment"># port：端口</span>
	<span class="token comment"># in：入站网卡</span>
	<span class="token comment"># out：出站网卡</span>
</code></pre> 
<ul><li>清空规则</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -F             # 清空规则（清空所有表的所有链）</span>


<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -nvxL  --line  # 查看规则链信息</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">44</span> packets, <span class="token number">2552</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">24</span> packets, <span class="token number">1880</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination



<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart iptables.service  # 重启服务</span>


<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -nvxL  --line   # 再次查看，恢复原状，说明未保存设置</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination
<span class="token number">1</span>         <span class="token number">159</span>    <span class="token number">24271</span> ACCEPT     <span class="token number">0</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            state RELATED,ESTABLISHED
<span class="token number">2</span>           <span class="token number">0</span>        <span class="token number">0</span> ACCEPT     <span class="token number">1</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">3</span>           <span class="token number">0</span>        <span class="token number">0</span> ACCEPT     <span class="token number">0</span>    --  lo     *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
<span class="token number">4</span>           <span class="token number">0</span>        <span class="token number">0</span> ACCEPT     <span class="token number">6</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            state NEW tcp dpt:22
<span class="token number">5</span>          <span class="token number">19</span>     <span class="token number">1843</span> REJECT     <span class="token number">0</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            reject-with icmp-host-prohibited

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination
<span class="token number">1</span>           <span class="token number">0</span>        <span class="token number">0</span> REJECT     <span class="token number">0</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            reject-with icmp-host-prohibited

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">143</span> packets, <span class="token number">12422</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination


<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -F    # 再次清空规则</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -nvxL  --line   # 再次查看</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">44</span> packets, <span class="token number">2552</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">24</span> packets, <span class="token number">1880</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination


<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># service iptables save   # 保持设置</span>
iptables: Saving firewall rules to /etc/sysconfig/iptables: <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>


<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart iptables.service   # 重启服务</span>


<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -nvxL  --line  # 再次查看，发现规则已清空</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">44</span> packets, <span class="token number">2552</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">24</span> packets, <span class="token number">1880</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>
destination
</code></pre> 
<h2><a id="1_329"></a>实验1</h2> 
<ul><li><mark>搭建web服务器，设置任何人都能通过80端口访问http服务</mark></li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -F    # 再次清空规则</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># service iptables save   # 保持设置</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart iptables.service   # 重启服务</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># mkdir  -p  /www/web</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># echo  "hello world"  &gt;  /www/web/index.html</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># yum  install  httpd -y</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># vim  /etc/httpd/conf/httpd.conf </span>
DocumentRoot <span class="token string">"/www/web"</span>
<span class="token operator">&lt;</span>Directory <span class="token string">"/www/web"</span><span class="token operator">&gt;</span>
    AllowOverride None
    <span class="token comment"># Allow open access:</span>
    Require all granted
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>


<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart httpd</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -A  INPUT  -p tcp  --dport 80  -j ACCEPT</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># service iptables save</span>
iptables: Saving firewall rules to /etc/sysconfig/iptables: <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -nvxL  --line</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">236</span> packets, <span class="token number">14221</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination

<span class="token number">1</span>           <span class="token number">3</span>      <span class="token number">122</span> ACCEPT     <span class="token number">6</span>    --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            tcp dpt:80

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination


Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">127</span> packets, <span class="token number">10036</span> bytes<span class="token punctuation">)</span>
num      pkts      bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination



<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart iptables.service </span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables -nL</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token builtin class-name">source</span>               destination
ACCEPT     <span class="token number">6</span>    --  <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            tcp dpt:80

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token builtin class-name">source</span>               destination

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token builtin class-name">source</span>               destination
</code></pre> 
<h2><a id="2_381"></a>实验2</h2> 
<ul><li><mark>搭建web服务器，设置任何人都不能通过80端口访问http服务</mark></li></ul> 
<h2><a id="3_384"></a>实验3</h2> 
<ul><li>禁止所有人使用ssh进行远程登录</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables -F  # 清空所有规则</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># service iptables save</span>
iptables: Saving firewall rules to /etc/sysconfig/iptables: <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables -nL   #发现没有策略了</span>


<span class="token comment"># 插入新规则</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -A  INPUT  -p  tcp  --dport  22  -j  REJECT   #当回车之后，xshell就不能用了，需要在虚拟机中进行配置</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># service iptables save</span>
iptables: Saving firewall rules to /etc/sysconfig/iptables: <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -nL</span>

<span class="token comment"># 恢复连接（在虚拟机中配置）</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -nL  --line</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># iptables  -D  INPUT  1    # 删除INPUT链中的1号规则</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># service iptables save</span>
<span class="token comment">#保存之后，继续使用xshell进行ssh连接</span>
</code></pre> 
<h2><a id="firewalld_408"></a>firewalld概念</h2> 
<ul><li><mark>firewalld</mark>（Dynamic Firewall Manager of Linux systems，Linux 系统的动态防火墙管理器）服务是<mark>默认的防火墙配置管理工具</mark>，从RHEL 7开始，用firewalld服务替代了iptables服务</li><li><mark>RHEL 9采用firewalld</mark>管理<mark>netfilter子系统</mark>，默认情况，firewalld则是交由内核层面的nftables包过滤框架来处理</li></ul> 
<h2><a id="firewalld_412"></a>firewalld特点</h2> 
<ul><li><mark>firewalld</mark>可以<mark>动态修改单条规则</mark>，不需要像iptables那样，<mark>修改规则后必须全部刷新才可生效</mark></li><li><mark>firewalld</mark>默认动作是<mark>拒绝</mark>，则<mark>每个服务都需要去设置才能放行</mark>，而<mark>iptables里默认是每个服务是允许</mark>，需要拒绝的才去限制</li><li>iptables防火墙类型为<mark>静态防火墙firewalld</mark> 防火墙类型为<mark>动态防火墙</mark></li><li><mark>firewalld和iptables一样自身并不具备防火墙功能，它们的作用都是用于维护规则，而真正使用规则干活的是内核防火墙模块</mark></li><li><mark>firewalld 加入了区域（zone，一系列规则的集合）概念</mark></li></ul> 
<h3><a id="zone_420"></a>区域zone</h3> 
<h4><a id="_421"></a>作用</h4> 
<ul><li><mark>firewalld</mark>防火墙为了<mark>简化管理</mark>，将<mark>所有网络流量分为多个区域(zone)</mark>，然后<mark>根据数据包的源IP地址或传入的网络接口等条件将流量传入相应区域</mark>，每个区域都定义了自己打开或者关闭的端口和服务列表</li><li>区域：<mark>zone本质为firewalld 预先准备了几套防火墙策略集合（策略模板</mark>），用户可以根据<mark>生产场景的不同</mark>而<mark>选择合适的策略集合</mark>，从而实现防火墙策略之间的快速切换</li></ul> 
<h4><a id="_425"></a>例</h4> 
<ul><li>有一台笔记本电脑，每天都要在公司、咖啡厅和家里使用。这三者的安全性按照由高到低的顺序是：家庭、公司办公室、咖啡厅。若希望指定如下防火墙策略规则：在家中允许访问所有服务；在公司办公室内仅允许访问文件共享服务；在咖啡厅仅允许上网浏览。以往，我们需要频繁地手动设置防火墙策略规则，而现在只需要预设好区域集合，然后只需轻点鼠标就可以自动切换了，从而极大地提升了防火墙策略的应用效率。</li></ul> 
<h4><a id="_429"></a>分析</h4> 
<ul><li><mark>firewalld</mark>的一个<mark>zone</mark>就是一个<mark>可信等级</mark>，一个<mark>等级</mark>对应一套<mark>过滤规则（规则集合</mark>）</li><li><mark>数据包必须要经过某个zone才能入站或出站</mark></li><li><mark>每个zone都有一个处理行为</mark>（default、ACCEPT、REJECT、DROP）</li><li><mark>firewalld的zone根据信任级别分成9个默认zone</mark></li></ul> 
<table><thead><tr><th>区域</th><th>默认策略规则</th></tr></thead><tbody><tr><td><mark>trusted（信任区域</mark>）</td><td><mark>允许所有的传入流量</mark></td></tr><tr><td>home （家庭区域）</td><td>允许与<mark>SSH、MDNS（多播DNS）、IPP客户端、samba-客户端、DHCPv6客户端、cockpit（服务器管理工具）服务</mark>匹配的流量传入，其余拒绝</td></tr><tr><td>internal （内部区域）</td><td>默认值时与homel区域相同</td></tr><tr><td>work（工作区域）</td><td>允许 与<mark>SSH、DHCPv6客户端、cockpit服务</mark>匹配的流量传入，其余拒绝、</td></tr><tr><td><mark>public （公共区域</mark>）</td><td>允许与<mark>SSH或DHCPv6客户端、cockpit服务</mark>匹配的流量传入，<mark>其余拒绝</mark> （是默认区域）</td></tr><tr><td>external（外部区域）</td><td><mark>允许与SSH服务匹配的流量传入</mark>，其余拒绝</td></tr><tr><td>dmz （隔离区域）</td><td>也称为非军事区域，内外网络之间增加的一层网络，起到缓冲作用，<mark>允许与SSH服务匹配的流量传入</mark>，其余拒绝</td></tr><tr><td><mark>block (阻塞区域</mark>)</td><td><mark>拒绝所有传入流量</mark>,返回<mark>icmp-host-prohibited</mark>消息</td></tr><tr><td>drop （丢弃区域）</td><td><mark>丢弃所有传入流量</mark>，且<mark>没有任何回复</mark>，类似DROP</td></tr></tbody></table> 
<ul><li><mark>firewalld的配置文件</mark>有<mark>两个</mark>主要的目录 <mark>/usr/lib/firewalld/zones（系统配置文件，尽量不要修改</mark>）和 <mark>/etc/firewalld/zones（用户配置文件，可以自行修改</mark>），每个<mark>zone</mark>单独对应一个<mark>xml配置文件</mark>，文件名为 <mark>&lt;zone名称&gt;.xml</mark></li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/lib/firewalld/zones</span>
<span class="token punctuation">[</span>root@server zones<span class="token punctuation">]</span><span class="token comment"># ls</span>
block.xml  drop.xml      home.xml      nm-shared.xml  trusted.xml
dmz.xml    external.xml  internal.xml  public.xml     work.xml

<span class="token punctuation">[</span>root@server zones<span class="token punctuation">]</span><span class="token comment"># cd /etc/firewalld/zones</span>
<span class="token punctuation">[</span>root@server zones<span class="token punctuation">]</span><span class="token comment"># ls</span>
public.xml  public.xml.old
</code></pre> 
<ul><li><mark>用法</mark>是：把<mark>可信任的IP地址</mark>添加到<mark>trusted区域</mark>，把<mark>不可信任的IP地址添加到block区域</mark>，把<mark>要公开的网络服务添加到public区域</mark>，所以常用区域为：<mark>trusted、block、public</mark></li></ul> 
<h4><a id="zone_461"></a>zone文件中的过滤规则</h4> 
<ul><li> <p><mark>过滤规则优先级：</mark></p> 
  <ul><li>source（最高）（IP地址）</li><li>interface（次之）（接口）</li><li>默认zone（最低）</li></ul> </li><li> <p>规则</p> </li></ul> 
<table><thead><tr><th>规则</th><th>作用</th></tr></thead><tbody><tr><td>scource</td><td><mark>源IP地址过滤（常用）</mark></td></tr><tr><td>interface</td><td><mark>网卡过滤</mark></td></tr><tr><td>service</td><td>服务名（实际是关联端口）过滤</td></tr><tr><td>port</td><td><mark>端口过滤</mark></td></tr><tr><td>icmp-block</td><td>ICMP报文过滤</td></tr><tr><td>masquerade</td><td>IP地址伪装</td></tr><tr><td>forward-port</td><td>端口转发过滤</td></tr><tr><td>rule</td><td>自定义规则</td></tr></tbody></table> 
<h2><a id="firewallcmd_480"></a>firewall-cmd可视化界面工具</h2> 
<h3><a id="_481"></a>安装</h3> 
<pre><code class="prism language-bash"><span class="token comment">#先卸载iptables</span>
<span class="token punctuation">[</span>root@server zones<span class="token punctuation">]</span><span class="token comment"># yum remove iptables-nft-services.noarch</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl  start firewalld     # 启用</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl  enable  firewalld   # 开机启动</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># yum  install  firewall-config  -y  # 安装图形化界面</span>
</code></pre> 
<h3><a id="_493"></a>使用</h3> 
<pre><code class="prism language-bash"><span class="token comment"># 虚拟机中执行，不要在xshell执行</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-config</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/85/f4/QdlhA0d3_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="firewallcmd_500"></a>firewall-cmd命令行工具</h2> 
<h3><a id="firewalld_501"></a>firewalld命令生效模式</h3> 
<ul><li><mark>runtime模式</mark>：运行时模式，立即生效，重启失效</li><li><mark>permanent模式</mark>：永久模式，重启生效</li></ul> 
<h3><a id="_505"></a>管理命令</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl start firewalld </span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl disable firewalld</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart firewalld</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable firewalld</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl status firewalld</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld</span>
</code></pre> 
<h3><a id="firewallcmd_520"></a>设置命令firewall-cmd参数</h3> 
<table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>–get-default-zone</td><td>查询默认的区域名称</td></tr><tr><td>–set-default-zone=&lt;区域名称&gt;</td><td>设置默认的区域，使其永久生效</td></tr><tr><td>–get-zones</td><td>显示可用的区域</td></tr><tr><td>–get-services</td><td>显示预先定义的服务</td></tr><tr><td>–get-active-zones</td><td>显示当前正在使用的区域与网卡名称</td></tr><tr><td>–add-source=</td><td>将源自此 IP 或子网的流量导向指定的区域</td></tr><tr><td>–remove-source=</td><td>不再将源自此 IP 或子网的流量导向某个指定区域</td></tr><tr><td>–add-interface=&lt;网卡名称&gt;</td><td>将源自该网卡的所有流量都导向某个指定区域</td></tr><tr><td>–change-interface=&lt;网卡名称&gt;</td><td>将某个网卡与区域进行关联</td></tr><tr><td>–list-all</td><td>显示当前区域的网卡配置参数、资源、端口以及服务等信息</td></tr><tr><td>–list-all-zones</td><td>显示所有区域的网卡配置参数、资源、端口以及服务等信息</td></tr><tr><td>–add-service=&lt;服务名&gt;</td><td>设置默认区域允许该服务的流量</td></tr><tr><td>–add-port=&lt;端口号/协议&gt;</td><td>设置默认区域允许该端口的流量</td></tr><tr><td>–remove-service=&lt;服务名&gt;</td><td>设置默认区域不再允许该服务的流量</td></tr><tr><td>–remove-port=&lt;端口号/协议&gt;</td><td>设置默认区域不再允许该端口的流量</td></tr></tbody></table> 
<h3><a id="1_540"></a>示例1</h3> 
<ul><li>基本命令</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd   --version  # 查看版本</span>
<span class="token number">1.3</span>.4

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd   --help  # 查看帮助信息</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd   --state  # 显示状态</span>
running

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd   --get-services   # 查看防火墙支持的服务 （不支持nginx服务，需要手动添加）</span>


<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd   --list-all  # 查看当前区域的规则信息</span>
public <span class="token punctuation">(</span>active<span class="token punctuation">)</span>
  target: default
  icmp-block-inversion: no
  interfaces: ens160
  sources:
  services: cockpit dhcpv6-client <span class="token function">ssh</span>
  ports:
  protocols:
  forward: <span class="token function">yes</span>
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
</code></pre> 
<h3><a id="2_571"></a>示例2</h3> 
<ul><li>设置区域zone</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server zones<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --get-default-zone</span>
public  <span class="token comment"># 查看当前生效的域</span>

<span class="token punctuation">[</span>root@server zones<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --get-zones   # 查看当前支持的域</span>
block dmz drop external home internal nm-shared public trusted work

<span class="token punctuation">[</span>root@server zones<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --set-default-zone=trusted   # 设置当前区域为信任区域</span>
success

<span class="token punctuation">[</span>root@server zones<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --get-default-zone</span>
trusted

<span class="token punctuation">[</span>root@server zones<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --set-default-zone=public</span>
success

<span class="token punctuation">[</span>root@server zones<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --get-default-zone</span>
public
</code></pre> 
<h3><a id="3_593"></a>示例3</h3> 
<ul><li>搭建web网站，配置firewall防火墙</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># yum  install  httpd  -y</span>
<span class="token comment"># 使用xftp将sxhkt网页目录上传到/</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># ls  /sxhkt/</span>
css  dingban.mp4  img  index.html  js  temp
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># vim  /etc/httpd/conf/httpd.conf </span>
DocumentRoot <span class="token string">"/sxhkt"</span>
<span class="token operator">&lt;</span>Directory <span class="token string">"/sxhkt"</span><span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># systemctl start httpd  # 发现网页无法访问，需要配置防火墙策略</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd   --list-all  # 查看当前区域的放行的服务，发现无httpd</span>
<span class="token comment"># 向域中添加http放行策略</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --permanent --zone=public  --add-service=http</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd  --reload  # 配合永久生效会立即生效</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd   --list-all  # 再次查看放行服务</span>
<span class="token comment"># 测试：浏览器中输入IP地址可以查看到网页</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --permanent --zone=public  --remove-service=http   # 移除放行的服务</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --reload   # 配合永久生效会立即生效</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd   --list-all</span>

<span class="token comment"># 第二种方法：</span>
<span class="token comment"># 以端口号/协议的方式添加到策略也可以实现放行http服务</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --permanent --zone=public  --add-port=80/tcp</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd  --reload  # 配合永久生效会立即生效</span>
<span class="token comment"># 测试：浏览器中输入IP地址可以查看到网页</span>
</code></pre> 
<h4><a id="3_621"></a>示例3总结</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 总结：</span>
<span class="token comment"># 放行服务：</span>
firewall-cmd <span class="token parameter variable">--permanent</span> <span class="token parameter variable">--zone</span><span class="token operator">=</span>public  --add-service<span class="token operator">=</span>服务名
<span class="token comment"># 放行服务端口</span>
firewall-cmd <span class="token parameter variable">--permanent</span> <span class="token parameter variable">--zone</span><span class="token operator">=</span>public  --add-port<span class="token operator">=</span>端口号/传输协议
</code></pre> 
<h3><a id="4_630"></a>示例4</h3> 
<ul><li><mark>某些服务需要编辑zone文件才能进行添加，如：添加nginx</mark></li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd   --get-services   # 查看支持的服务列表</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># yum  install  nginx  -y</span>
<span class="token comment"># 此时添加nginx服务会报错</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd  --add-service=nginx  --permanent </span>
Error: INVALID_SERVICE: Zone <span class="token string">'public'</span><span class="token builtin class-name">:</span> <span class="token string">'nginx'</span> not among existing services
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># vim  /etc/firewalld/services/nginx.xml  # 编辑服务配置文件</span>
<span class="token comment"># 添加如下内容：</span>
<span class="token operator">&lt;</span>service<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>short<span class="token operator">&gt;</span>Nginx<span class="token operator">&lt;</span>/short<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span>nginx<span class="token operator">&lt;</span>/description<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>port <span class="token assign-left variable">protocol</span><span class="token operator">=</span><span class="token string">"tcp"</span>  <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"80"</span>/<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>port <span class="token assign-left variable">protocol</span><span class="token operator">=</span><span class="token string">"tcp"</span>  <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"443"</span>/<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/service<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd  --add-service=nginx  --permanent </span>
success
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd  --reload </span>
success
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd   --get-services   </span>
</code></pre> 
<h3><a id="5_653"></a>示例5</h3> 
<ul><li><mark>禁止192.168.80.130 网段的地址对192.168.80.129进行ping</mark></li></ul> 
<h4><a id="firewalld__656"></a>firewalld 富规则</h4> 
<ul><li><mark>firewalld 富规则</mark>：用于<mark>更细致、更详细</mark>的防火墙策略配置，它可以针对<mark>系统服务、端口号、源地址和目标地址等诸多信息</mark>进行更有正对性的策略配置</li><li><mark>firewalld富规则优先级最高</mark></li></ul> 
<h4><a id="_661"></a>格式</h4> 
<p><img src="https://images2.imgbox.com/c0/a2/TdOP44JE_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4b/91/g9DCXHms_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment"># 如：</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="源IP" service name="http"   reject'</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd  --permanent --add-rich-rule='rule family="ipv4" source address="192.168.80.130" protocol  value="icmp"  reject'</span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd  --reload </span>

<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --list-all</span>

<span class="token comment"># 测试：定位node1中进行ping  192.168.80.129  发现目标不可达</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b332edad93cc072dc88eafbdb50e5726/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决com.mysql.cj.jdbc.exceptions.PacketTooBigException: Packet for query is too large</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a1a6943497e50a0ce22ef7e3ac640bb8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">架构师之路：中台和微服务区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>