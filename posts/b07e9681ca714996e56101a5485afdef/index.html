<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python 国际化（i18n） 支持 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python 国际化（i18n） 支持" />
<meta property="og:description" content="python使用gettext来实现i18n支持。具体参数信息请看gettext module帮助。 python中对于国际化的字符串，只需要外加_()即可。 如： print(_(&#39;hello world&#39;)) 然后根据user选择的语言，创建translation对象，然后调用install方法install_()函数 到Python’s builtins namespace。如： import gettext en_trans = gettext.install(&#39;messages&#39;, locale=&#39;i18n_path&#39;, languages=[&#39;default_language&#39;]) zh_trans = gettext.install(&#39;messages&#39;, locale&#39;i18n_path&#39;, languages=[&#39;zh_CH&#39;]) print(_(&#39;hello world&#39;)) zh_trans.install() print(_(&#39;hello world&#39;)) 而对于web服务中前端页面的国际化支持也非常简单，和python source文档中一样 在需要国际化的字符串前面添加_()即可。然后在render函数中，把当前translation对象 传入模板即可。如Tornado render_string的实现: def render_string(self, template_name, **kwargs): # If no template_path is specified, use the path of the calling file ... ... args = dict( handler=self, request=self.request, current_user=self.current_user, locale=self.locale, _=self.locale.translate, static_url=self.static_url, xsrf_form_html=self.xsrf_form_html, reverse_url=self.application.reverse_url ) args.update(self.ui) args.update(kwargs) return t.generate(**args) 好了，上面搭建好i18n所需要的环境，下面就是准备对语言字符资源了。 python 工具： pygettext msgfmt 其他工具： msgmerge 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/b07e9681ca714996e56101a5485afdef/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-02-07T22:45:51+08:00" />
<meta property="article:modified_time" content="2017-02-07T22:45:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python 国际化（i18n） 支持</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style=""> 
 <div style="">
   python使用gettext来实现i18n支持。具体参数信息请看gettext 
 </div> 
 <div style="">
   module帮助。 
 </div> 
 <div style=""> 
  <br style=""> 
 </div> 
 <div style="">
   python中对于国际化的字符串，只需要外加_()即可。 
 </div> 
 <div style=""> 
  <br style=""> 
 </div> 
 <div style="">
   如： print(_('hello world')) 
 </div> 
 <div style="">
   然后根据user选择的语言，创建translation对象，然后调用install方法install_()函数 
 </div> 
 <div style="">
   到Python’s builtins namespace。如： 
 </div> 
 <br> 
</div> 
<div style=""> 
 <pre><code class="language-python">import gettext
en_trans = gettext.install('messages', locale='i18n_path', languages=['default_language'])
zh_trans = gettext.install('messages', locale'i18n_path', languages=['zh_CH'])
print(_('hello world'))
zh_trans.install()
print(_('hello world'))
</code></pre> 
 <br> 
 <div style="">
   而对于web服务中前端页面的国际化支持也非常简单，和python source文档中一样 
 </div> 
 <div style="">
   在需要国际化的字符串前面添加_()即可。然后在render函数中，把当前translation对象 
 </div> 
 <div style="">
   传入模板即可。如Tornado render_string的实现: 
 </div> 
 <br> 
</div> 
<div style=""> 
 <pre><code class="language-python">def render_string(self, template_name, **kwargs):
        # If no template_path is specified, use the path of the calling file
        ... ...
        args = dict(
            handler=self,
            request=self.request,
            current_user=self.current_user,
            locale=self.locale,
            _=self.locale.translate,             
            static_url=self.static_url,
            xsrf_form_html=self.xsrf_form_html,
            reverse_url=self.application.reverse_url
        )
        args.update(self.ui)
        args.update(kwargs)
        return t.generate(**args)</code></pre> 
 <div style=""> 
  <br> 
 </div> 
 <div style="">
   好了，上面搭建好i18n所需要的环境，下面就是准备对语言字符资源了。 
 </div> 
 <div style=""> 
  <br style=""> 
 </div> 
 <div style="">
   python 工具： pygettext msgfmt 
 </div> 
 <div style=""> 
  <br style=""> 
 </div> 
 <div style="">
   其他工具： msgmerge 
 </div> 
 <div style="">
   1. 创建po文档 
 </div> 
 <div style=""> 
  <br style=""> 
 </div> 
 <div style="">
   在当前目录下创建locale文件夹，下面分别建en_US/LC_MESSAGES/ 和 zh_CN/LC_MESSAGES/目录。 
 </div> 
 <div style="">
   在locale下面创建名为 demo.html的文件内容如下： 
 </div> 
 <pre><code class="language-html">&lt;html&gt;
	&lt;head&gt;
		&lt;title&gt;${_('title')}&lt;/title&gt;
	&lt;/head&gt;
	&lt;body&gt;
	&lt;a href=''&gt;${_('body')}&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
 <br> 
 <div style="">
   然后打开命令行窗口，输入 python pygettext.py -a -v -d messages -o messages.po \*.py \*.html 
 </div> 
 <div style="">
   完成后，在当前目录生成 messages.po 文件。 
 </div> 
 <div style="">
   打开message.po 会看到其中的格式内容： 
 </div> 
 <div style=""> 
  <br> 
 </div> 
 <div style=""> 
  <pre><code class="language-plain"># SOME DESCRIPTIVE TITLE.
# Copyright (C) YEAR ORGANIZATION
# FIRST AUTHOR &lt;EMAIL@ADDRESS&gt;, YEAR.
#
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\\n"
"POT-Creation-Date: %(time)s\\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\\n"
"Last-Translator: FULL NAME &lt;EMAIL@ADDRESS&gt;\\n"
"Language-Team: LANGUAGE &lt;LL@li.org&gt;\\n"
"MIME-Version: 1.0\\n"
"Content-Type: text/plain; charset=CHARSET\\n"
"Content-Transfer-Encoding: ENCODING\\n"
"Generated-By: pygettext.py %(version)s\\n"

#: demo.html:3
msgid "title"
msgstr ""

#: demo.html:6
msgid "body"
msgstr ""</code></pre> 
  <br> 
  <br> 
 </div> 
 <div style="">
   说明：  
  <span style=""> </span>#: demo.html:3 
 </div> 
 <div style=""> 
  <span style=""></span>msgid "title"      #待转换的字符串 
 </div> 
 <div style=""> 
  <span style=""></span>msgstr ""          #转换后的字符bytes，如果为空，则返回原字符 
 </div> 
 <div style=""> 
  <br style=""> 
 </div> 
 <div style="">
   关键信息："Content-Type: text/plain; charset=CHARSET\n 
 </div> 
 <div style="">
   这里的CHARSET 指定了 msgstr的codeset。一般推荐charset设定为utf-8. 
 </div> 
 <div style="">
   关于msgstr保存的信息需要说明：实际上它是一个bytes，是翻译后的字符串 
 </div> 
 <div style="">
   调用encode结果。 
 </div> 
 <div style="">
   而当调用_()函数时，实际上会调用translation设置的默认charset来decode（具体请参考gettext module）。 
 </div> 
 <div style="">
   即我们在message.po设置的charset。 
 </div> 
 <div style=""> 
  <br> 
 </div> 
 <div style="">
   2. 翻译字符资源 
 </div> 
 <div style="">
   将生成的messages.po的分别copy至 en_US/LC_MESSAGES/ 和 zh_CN/LC_MESSAGES/目录下。 
 </div> 
 <div style="">
   分别切换至en_US/LC_MESSAGES/ 和 zh_CN/LC_MESSAGES/ 目录， 
 </div> 
 <div style="">
   编辑messages.po，修改添加翻译后的字符（注:source.encode(charset)） 
 </div> 
 <div style=""> 
  <br style=""> 
 </div> 
 <div style="">
   3. 生成mo文件 
 </div> 
 <div style="">
   分别切换目录至en_US/LC_MESSAGES/ 和 zh_CN/LC_MESSAGES/， 
 </div> 
 <div style="">
   在命令行输入： python msgfmt.py messages.po 生成mo文件。 
 </div> 
 <div style=""> 
  <br style=""> 
 </div> 
 <div style="">
   最终生成的locale tree的目录类似linux系统的/usr/share/locale， 
 </div> 
 <div style=""> 
  <div style="">
     locale/{lang}/LC_MESSAGES/{domain}.mo 
  </div> 
 </div> 
 <div style=""> 
  <br style=""> 
 </div> 
 <div style="">
   测试： 
 </div> 
 <div style=""> 
  <br> 
 </div> 
 <pre><code class="language-python">&gt;&gt;&gt; import gettext
&gt;&gt;&gt; en_trans = gettext.translation('messages', 'e:/python/locale', languages=['en_US'])
&gt;&gt;&gt; zh_trans = gettext.translation('messages', 'e:/python/locale', languages=['zh_CN'])
&gt;&gt;&gt; en_trans.gettext('title'), en_trans.gettext('body')
('title', 'body')
&gt;&gt;&gt; zh_trans.gettext('title'), zh_trans.gettext('body')
('HTML Head 头', 'HTML Body 测试')
&gt;&gt;&gt; en_trans.install()
&gt;&gt;&gt; _('title'), _('body'), _('hello')
('title', 'body', 'hello')
&gt;&gt;&gt; zh_trans.install()
&gt;&gt;&gt; _('title'), _('body'), _('hello')
('HTML Head 头', 'HTML Body 测试', 'hello')</code></pre> 
 <br> 
 <span style='color:rgb(61,70,77); font-family:"Pingfang SC",STHeiti,"Lantinghei SC","Open Sans",Arial,"Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",SimSun,sans-serif; font-size:16px; background-color:rgb(248,248,248)'>上例使用的python解析器是python3.2.2 2.*版本有些method参数稍有不同，请注意！</span> 
 <br> 
 <br> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/59642d5dc4dc5c2a5da8ff330b44a8f8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">yacc&amp;lex-Chapter1</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/54fb4f1950dbd7176ae60b71475450a6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">双控开关接线</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>