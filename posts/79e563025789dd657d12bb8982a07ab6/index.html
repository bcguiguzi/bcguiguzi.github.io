<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenCV&#43; moviepy &#43; tkinter 视频车道线智能识别项目源码 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenCV&#43; moviepy &#43; tkinter 视频车道线智能识别项目源码" />
<meta property="og:description" content="项目完整源代码，使用 OpenCV 的Hough 直线检测算法，提取出道路车道线并绘制出来。通过tkinter 提供GUI界面展示效果。
1、导入相关模块 import matplotlib.pyplot as plt import numpy as np import cv2 import os import matplotlib.image as mpimg from moviepy.editor import VideoFileClip import math 2. 用掩码获取ROI区域 def interested_region(img, vertices): if len(img.shape) &gt; 2: mask_color_ignore = (255,) * img.shape[2] else: mask_color_ignore = 255 cv2.fillPoly(np.zeros_like(img), vertices, mask_color_ignore) return cv2.bitwise_and(img, np.zeros_like(img)) 3、Hough变换空间, 转换像素到直线 def hough_lines(img, rho, theta, threshold, min_line_len, max_line_gap): lines = cv2.HoughLinesP(img, rho, theta, threshold, np.array([]), minLineLength=min_line_len, maxLineGap=max_line_gap) line_img = np." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/79e563025789dd657d12bb8982a07ab6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-02T22:25:41+08:00" />
<meta property="article:modified_time" content="2024-02-02T22:25:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenCV&#43; moviepy &#43; tkinter 视频车道线智能识别项目源码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>项目完整源代码，使用 OpenCV 的Hough 直线检测算法，提取出道路车道线并绘制出来。通过tkinter 提供GUI界面展示效果。<br> <img src="https://images2.imgbox.com/9f/fe/AL1T7DwM_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1_3"></a>1、导入相关模块</h3> 
<pre><code class="prism language-py"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> os
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>image <span class="token keyword">as</span> mpimg
<span class="token keyword">from</span> moviepy<span class="token punctuation">.</span>editor <span class="token keyword">import</span> VideoFileClip
<span class="token keyword">import</span> math
</code></pre> 
<h3><a id="2_ROI_13"></a>2. 用掩码获取ROI区域</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">interested_region</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> vertices<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span> 
        mask_color_ignore <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">*</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        mask_color_ignore <span class="token operator">=</span> <span class="token number">255</span>
        
    cv2<span class="token punctuation">.</span>fillPoly<span class="token punctuation">(</span>np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> mask_color_ignore<span class="token punctuation">)</span>
    <span class="token keyword">return</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>img<span class="token punctuation">,</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="3Hough__24"></a>3、Hough变换空间, 转换像素到直线</h3> 
<pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">hough_lines</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> rho<span class="token punctuation">,</span> theta<span class="token punctuation">,</span> threshold<span class="token punctuation">,</span> min_line_len<span class="token punctuation">,</span> max_line_gap<span class="token punctuation">)</span><span class="token punctuation">:</span>
    lines <span class="token operator">=</span> cv2<span class="token punctuation">.</span>HoughLinesP<span class="token punctuation">(</span>img<span class="token punctuation">,</span> rho<span class="token punctuation">,</span> theta<span class="token punctuation">,</span> threshold<span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> minLineLength<span class="token operator">=</span>min_line_len<span class="token punctuation">,</span> maxLineGap<span class="token operator">=</span>max_line_gap<span class="token punctuation">)</span>
    line_img <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
    lines_drawn<span class="token punctuation">(</span>line_img<span class="token punctuation">,</span>lines<span class="token punctuation">)</span>
    <span class="token keyword">return</span> line_img
</code></pre> 
<h3><a id="4Hough_32"></a>4、在Hough变换后，每帧增加两条线</h3> 
<pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">lines_drawn</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> lines<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> cache
    <span class="token keyword">global</span> first_frame
    slope_l<span class="token punctuation">,</span> slope_r <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    lane_l<span class="token punctuation">,</span>lane_r <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span>

    α <span class="token operator">=</span><span class="token number">0.2</span>        <span class="token comment"># 希腊字母阿尔法</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
        <span class="token keyword">for</span> x1<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y2 <span class="token keyword">in</span> line<span class="token punctuation">:</span>
            slope <span class="token operator">=</span> <span class="token punctuation">(</span>y2<span class="token operator">-</span>y1<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>x2<span class="token operator">-</span>x1<span class="token punctuation">)</span>
            <span class="token keyword">if</span> slope <span class="token operator">&gt;</span> <span class="token number">0.4</span><span class="token punctuation">:</span>
                slope_r<span class="token punctuation">.</span>append<span class="token punctuation">(</span>slope<span class="token punctuation">)</span>
                lane_r<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> slope <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">:</span>
                slope_l<span class="token punctuation">.</span>append<span class="token punctuation">(</span>slope<span class="token punctuation">)</span>
                lane_l<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
        img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span>y2<span class="token punctuation">,</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>lane_l<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>lane_r<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'no lane detected'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    slope_mean_l <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>slope_l<span class="token punctuation">,</span>axis <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    slope_mean_r <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>slope_r<span class="token punctuation">,</span>axis <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    mean_l <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>lane_l<span class="token punctuation">)</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    mean_r <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>lane_r<span class="token punctuation">)</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>slope_mean_r <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span>slope_mean_l <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'dividing by zero'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    
    x1_l <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> mean_l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span>slope_mean_l <span class="token operator">*</span> mean_l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>slope_mean_l<span class="token punctuation">)</span> 
    x2_l <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> mean_l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span>slope_mean_l <span class="token operator">*</span> mean_l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>slope_mean_l<span class="token punctuation">)</span>   
    x1_r <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> mean_r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span>slope_mean_r <span class="token operator">*</span> mean_r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>slope_mean_r<span class="token punctuation">)</span>
    x2_r <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> mean_r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span>slope_mean_r <span class="token operator">*</span> mean_r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>slope_mean_r<span class="token punctuation">)</span>
    
   
    <span class="token keyword">if</span> x1_l <span class="token operator">&gt;</span> x1_r<span class="token punctuation">:</span>
        x1_l <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x1_l<span class="token operator">+</span>x1_r<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
        x1_r <span class="token operator">=</span> x1_l
        y1_l <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>slope_mean_l <span class="token operator">*</span> x1_l <span class="token punctuation">)</span> <span class="token operator">+</span> mean_l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span>slope_mean_l <span class="token operator">*</span> mean_l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        y1_r <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>slope_mean_r <span class="token operator">*</span> x1_r <span class="token punctuation">)</span> <span class="token operator">+</span> mean_r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span>slope_mean_r <span class="token operator">*</span> mean_r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        y2_l <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>slope_mean_l <span class="token operator">*</span> x2_l <span class="token punctuation">)</span> <span class="token operator">+</span> mean_l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span>slope_mean_l <span class="token operator">*</span> mean_l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        y2_r <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>slope_mean_r <span class="token operator">*</span> x2_r <span class="token punctuation">)</span> <span class="token operator">+</span> mean_r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span>slope_mean_r <span class="token operator">*</span> mean_r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        y1_l <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        y2_l <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        y1_r <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        y2_r <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      
    present_frame <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>x1_l<span class="token punctuation">,</span>y1_l<span class="token punctuation">,</span>x2_l<span class="token punctuation">,</span>y2_l<span class="token punctuation">,</span>x1_r<span class="token punctuation">,</span>y1_r<span class="token punctuation">,</span>x2_r<span class="token punctuation">,</span>y2_r<span class="token punctuation">]</span><span class="token punctuation">,</span>dtype <span class="token operator">=</span><span class="token string">"float32"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> first_frame <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        next_frame <span class="token operator">=</span> present_frame        
        first_frame <span class="token operator">=</span> <span class="token number">0</span>        
    <span class="token keyword">else</span> <span class="token punctuation">:</span>
        prev_frame <span class="token operator">=</span> cache
        next_frame <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>α<span class="token punctuation">)</span><span class="token operator">*</span>prev_frame<span class="token operator">+</span>α<span class="token operator">*</span>present_frame
             
    cv2<span class="token punctuation">.</span>line<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>next_frame<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>next_frame<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>next_frame<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>next_frame<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> thickness<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>line<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>next_frame<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>next_frame<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>next_frame<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>next_frame<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> thickness<span class="token punctuation">)</span>
    
    cache <span class="token operator">=</span> next_frame
    
</code></pre> 
<h3><a id="5_97"></a>5、处理每帧画面</h3> 
<pre><code class="prism language-python">
<span class="token keyword">def</span> <span class="token function">weighted_img</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> initial_img<span class="token punctuation">,</span> α<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> β<span class="token operator">=</span><span class="token number">1.</span><span class="token punctuation">,</span> λ<span class="token operator">=</span><span class="token number">0.</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> cv2<span class="token punctuation">.</span>addWeighted<span class="token punctuation">(</span>initial_img<span class="token punctuation">,</span> α<span class="token punctuation">,</span> img<span class="token punctuation">,</span> β<span class="token punctuation">,</span> λ<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">process_image</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">global</span> first_frame

    gray_image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    img_hsv <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2HSV<span class="token punctuation">)</span>


    lower_yellow <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype <span class="token operator">=</span> <span class="token string">"uint8"</span><span class="token punctuation">)</span>
    upper_yellow <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"uint8"</span><span class="token punctuation">)</span>

    mask_yellow <span class="token operator">=</span> cv2<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>img_hsv<span class="token punctuation">,</span> lower_yellow<span class="token punctuation">,</span> upper_yellow<span class="token punctuation">)</span>
    mask_white <span class="token operator">=</span> cv2<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>gray_image<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
    mask_yw <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_or<span class="token punctuation">(</span>mask_white<span class="token punctuation">,</span> mask_yellow<span class="token punctuation">)</span>
    mask_yw_image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>gray_image<span class="token punctuation">,</span> mask_yw<span class="token punctuation">)</span>
	<span class="token comment"># gause blue </span>
    gauss_gray<span class="token operator">=</span> cv2<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span>mask_yw_image<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token comment"># detect edge</span>
    canny_edges<span class="token operator">=</span>cv2<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>gauss_gray<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">150</span>，apertureSize<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

    imshape <span class="token operator">=</span> image<span class="token punctuation">.</span>shape
    lower_left <span class="token operator">=</span> <span class="token punctuation">[</span>imshape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">9</span><span class="token punctuation">,</span>imshape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    lower_right <span class="token operator">=</span> <span class="token punctuation">[</span>imshape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>imshape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">9</span><span class="token punctuation">,</span>imshape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    top_left <span class="token operator">=</span> <span class="token punctuation">[</span>imshape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">-</span>imshape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">,</span>imshape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span>imshape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">]</span>
    top_right <span class="token operator">=</span> <span class="token punctuation">[</span>imshape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span>imshape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">,</span>imshape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span>imshape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">]</span>
    vertices <span class="token operator">=</span> <span class="token punctuation">[</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>lower_left<span class="token punctuation">,</span>top_left<span class="token punctuation">,</span>top_right<span class="token punctuation">,</span>lower_right<span class="token punctuation">]</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span><span class="token punctuation">]</span>
    roi_image <span class="token operator">=</span> interested_region<span class="token punctuation">(</span>canny_edges<span class="token punctuation">,</span> vertices<span class="token punctuation">)</span>

    theta <span class="token operator">=</span> np<span class="token punctuation">.</span>pi<span class="token operator">/</span><span class="token number">180</span>

    line_image <span class="token operator">=</span> hough_lines<span class="token punctuation">(</span>roi_image<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> theta<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> weighted_img<span class="token punctuation">(</span>line_image<span class="token punctuation">,</span> image<span class="token punctuation">,</span> α<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> β<span class="token operator">=</span><span class="token number">1.</span><span class="token punctuation">,</span> λ<span class="token operator">=</span><span class="token number">0.</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
</code></pre> 
<p>:</p> 
<h3><a id="6moviepyvideofileClip_process_image_139"></a>6、用moviepy的videofileClip 读出视频，调用process_image方法处理后保存至文件</h3> 
<pre><code class="prism language-py">first_frame <span class="token operator">=</span> <span class="token number">1</span>
white_output <span class="token operator">=</span> <span class="token string">'__path_to_output_file__'</span>
clip1 <span class="token operator">=</span> VideoFileClip<span class="token punctuation">(</span><span class="token string">"__path_to_input_file__"</span><span class="token punctuation">)</span>
new_clip <span class="token operator">=</span> clip1<span class="token punctuation">.</span>fl_image<span class="token punctuation">(</span>process_image<span class="token punctuation">)</span>
new_clip<span class="token punctuation">.</span>write_videofile<span class="token punctuation">(</span>white_output<span class="token punctuation">,</span> audio<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  

</code></pre> 
<h3><a id="7tkinterGUI_149"></a>7、用tkinter编写车道线检测项目的GUI图形界面</h3> 
<pre><code class="prism language-py"><span class="token keyword">import</span> tkinter <span class="token keyword">as</span> tk
<span class="token keyword">from</span> tkinter <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> cv2
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageTk
<span class="token keyword">import</span> os
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">global</span> last_frame1                                   
last_frame1 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token keyword">global</span> last_frame2                                      
last_frame2 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token keyword">global</span> cap1
<span class="token keyword">global</span> cap2
cap_input <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">"path_to_input_test_video"</span><span class="token punctuation">)</span>
cap_drawlane <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">"path_to_resultant_lane_detected_video"</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">show_input_video</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                       
    <span class="token keyword">if</span> <span class="token keyword">not</span> cap_input<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                             
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"无法打开原始视频"</span><span class="token punctuation">)</span>
    flag1<span class="token punctuation">,</span> frame1 <span class="token operator">=</span> cap_input<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    frame1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>frame1<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> flag1 <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"原视频读帧错误"</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> flag1<span class="token punctuation">:</span>
        <span class="token keyword">global</span> last_frame1
        last_frame1 <span class="token operator">=</span> frame1<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        pic <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>last_frame1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>     
        img <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>pic<span class="token punctuation">)</span>
        imgtk <span class="token operator">=</span> ImageTk<span class="token punctuation">.</span>PhotoImage<span class="token punctuation">(</span>image<span class="token operator">=</span>img<span class="token punctuation">)</span>
        lmain<span class="token punctuation">.</span>imgtk <span class="token operator">=</span> imgtk
        lmain<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>image<span class="token operator">=</span>imgtk<span class="token punctuation">)</span>
        lmain<span class="token punctuation">.</span>after<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> show_input_video<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">show_drawlane_video</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> cap_drawlane<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                             
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"无法打开车道线视频"</span><span class="token punctuation">)</span>
    flag2<span class="token punctuation">,</span> frame2 <span class="token operator">=</span> cap_drawlane<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    frame2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>frame2<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> flag2 <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"车道线视频读帧错误"</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> flag2<span class="token punctuation">:</span>
        <span class="token keyword">global</span> last_frame2
        last_frame2 <span class="token operator">=</span> frame2<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        pic2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>last_frame2<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
        img2 <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>pic2<span class="token punctuation">)</span>
        img2tk <span class="token operator">=</span> ImageTk<span class="token punctuation">.</span>PhotoImage<span class="token punctuation">(</span>image<span class="token operator">=</span>img2<span class="token punctuation">)</span>
        lmain2<span class="token punctuation">.</span>img2tk <span class="token operator">=</span> img2tk
        lmain2<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>image<span class="token operator">=</span>img2tk<span class="token punctuation">)</span>
        lmain2<span class="token punctuation">.</span>after<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> show_drawlane_video<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    root<span class="token operator">=</span>tk<span class="token punctuation">.</span>Tk<span class="token punctuation">(</span><span class="token punctuation">)</span>                                     
    lmain <span class="token operator">=</span> tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>master<span class="token operator">=</span>root<span class="token punctuation">)</span>
    lmain2 <span class="token operator">=</span> tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>master<span class="token operator">=</span>root<span class="token punctuation">)</span>

    lmain<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side <span class="token operator">=</span> LEFT<span class="token punctuation">)</span>
    lmain2<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side <span class="token operator">=</span> RIGHT<span class="token punctuation">)</span>
    root<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"车道线检测"</span><span class="token punctuation">)</span>            
    root<span class="token punctuation">.</span>geometry<span class="token punctuation">(</span><span class="token string">"900x700+100+10"</span><span class="token punctuation">)</span> 
    exitbutton <span class="token operator">=</span> Button<span class="token punctuation">(</span>root<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">'退出'</span><span class="token punctuation">,</span>fg<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span>command<span class="token operator">=</span>   root<span class="token punctuation">.</span>destroy<span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side <span class="token operator">=</span> BOTTOM<span class="token punctuation">,</span><span class="token punctuation">)</span>
    show_input_video<span class="token punctuation">(</span><span class="token punctuation">)</span>
    show_drawlane_video<span class="token punctuation">(</span><span class="token punctuation">)</span>
    root<span class="token punctuation">.</span>mainloop<span class="token punctuation">(</span><span class="token punctuation">)</span>                                  
    cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/725e4eab8fa25845649e4aa5864d07f1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux ssh 无法登录的情况记录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9da96baf98281ee96839f718c42ed738/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ONLYOFFICE是一站式协作免费开源办公神器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>