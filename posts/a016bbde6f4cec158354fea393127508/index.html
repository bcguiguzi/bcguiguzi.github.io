<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>webpack plugin源码解析(六) CompressionWebpackPlugin - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="webpack plugin源码解析(六) CompressionWebpackPlugin" />
<meta property="og:description" content="文章目录 作用涉及 webpack API处理 asset 钩子compilation.hooks.processAssets返回或新建缓存：compilation.getCache返回 asset 文件信息：compilation.getAsset文件名匹配函数：compiler.webpack.ModuleFilenameHelpers.matchObject模版字符串替换：compilation.getPath 实现constructorapply生成输出压缩文件 作用 压缩打包后的文件，可以配置是否删除源文件 const CompressionPlugin = require(&#34;compression-webpack-plugin&#34;); new CompressionPlugin() 涉及 webpack API 处理 asset 钩子compilation.hooks.processAssets PROCESS_ASSETS_STAGE_OPTIMIZE_TRANSFER：优化已有 asset 的转换操作阶段，例如对 asset 进行压缩，并作为独立的 assetadditionalAssets: true 会多次调用回调，一次是在指定 stage 添加资产时触发回调，另一次是后来由插件添加资产时，这里为 CompressionWebpackPlugin 添加的压缩文件后触发 compiler.hooks.thisCompilation.tap(pluginName, compilation =&gt; { compilation.hooks.processAssets.tapPromise({ name: pluginName, // 优化已有 asset 的转换操作，例如对 asset 进行压缩，并作为独立的 asset stage: compiler.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE_TRANSFER, additionalAssets: true // true会多次调用回调，一次是在指定 stage 添加资产时触发回调，另一次是后来由插件添加资产时 }, assets =&gt; this.compress(compiler, compilation, assets)); }); 返回或新建缓存：compilation.getCache 具体查看 copy-webpack-plugin 解析文章 返回 asset 文件信息：compilation." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/a016bbde6f4cec158354fea393127508/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-19T17:03:04+08:00" />
<meta property="article:modified_time" content="2023-04-19T17:03:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">webpack plugin源码解析(六) CompressionWebpackPlugin</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">作用</a></li><li><a href="#_webpack_API_11" rel="nofollow">涉及 webpack API</a></li><li><ul><li><a href="#_asset_compilationhooksprocessAssets_13" rel="nofollow">处理 asset 钩子compilation.hooks.processAssets</a></li><li><a href="#compilationgetCache_29" rel="nofollow">返回或新建缓存：compilation.getCache</a></li><li><a href="#_asset_compilationgetAsset_31" rel="nofollow">返回 asset 文件信息：compilation.getAsset</a></li><li><a href="#compilerwebpackModuleFilenameHelpersmatchObject_40" rel="nofollow">文件名匹配函数：compiler.webpack.ModuleFilenameHelpers.matchObject</a></li><li><a href="#compilationgetPath_42" rel="nofollow">模版字符串替换：compilation.getPath</a></li></ul> 
  </li><li><a href="#_45" rel="nofollow">实现</a></li><li><ul><li><a href="#constructor_47" rel="nofollow">constructor</a></li><li><a href="#apply_137" rel="nofollow">apply</a></li><li><a href="#_282" rel="nofollow">生成输出压缩文件</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>作用</h2> 
<ul><li>压缩打包后的文件，可以配置是否删除源文件</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> CompressionPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"compression-webpack-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_webpack_API_11"></a>涉及 webpack API</h2> 
<ul><li> <h3><a id="_asset_compilationhooksprocessAssets_13"></a>处理 asset 钩子compilation.hooks.processAssets</h3> 
  <ul><li>PROCESS_ASSETS_STAGE_OPTIMIZE_TRANSFER：优化已有 asset 的转换操作阶段，例如对 asset 进行压缩，并作为独立的 asset</li><li>additionalAssets: true 会多次调用回调，一次是在指定 stage 添加资产时触发回调，另一次是后来由插件添加资产时，这里为 CompressionWebpackPlugin 添加的压缩文件后触发</li></ul> </li></ul> 
<pre><code class="prism language-javascript">compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>thisCompilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">,</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>processAssets<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> pluginName<span class="token punctuation">,</span>
    <span class="token comment">// 优化已有 asset 的转换操作，例如对 asset 进行压缩，并作为独立的 asset</span>
    <span class="token literal-property property">stage</span><span class="token operator">:</span> compiler<span class="token punctuation">.</span>webpack<span class="token punctuation">.</span>Compilation<span class="token punctuation">.</span><span class="token constant">PROCESS_ASSETS_STAGE_OPTIMIZE_TRANSFER</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">additionalAssets</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// true会多次调用回调，一次是在指定 stage 添加资产时触发回调，另一次是后来由插件添加资产时</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">assets</span> <span class="token operator">=&gt;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compilation<span class="token punctuation">,</span> assets<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li> <h3><a id="compilationgetCache_29"></a>返回或新建缓存：compilation.getCache</h3> 
  <ul><li>具体查看 copy-webpack-plugin 解析文章</li></ul> </li><li> <h3><a id="_asset_compilationgetAsset_31"></a>返回 asset 文件信息：compilation.getAsset</h3> </li></ul> 
<pre><code class="prism language-javascript">   <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
     info<span class="token punctuation">,</span>
     source
   <span class="token punctuation">}</span> <span class="token operator">=</span>compilation<span class="token punctuation">.</span><span class="token function">getAsset</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name:"main.js" 打包后输出文件的 name</span>
</code></pre> 
<ul><li> <h3><a id="compilerwebpackModuleFilenameHelpersmatchObject_40"></a>文件名匹配函数：compiler.webpack.ModuleFilenameHelpers.matchObject</h3> 
  <ul><li>具体查看 copy-webpack-plugin 解析文章</li></ul> </li><li> <h3><a id="compilationgetPath_42"></a>模版字符串替换：compilation.getPath</h3> 
  <ul><li>具体查看 copy-webpack-plugin 解析文章</li></ul> </li></ul> 
<h2><a id="_45"></a>实现</h2> 
<h3><a id="constructor_47"></a>constructor</h3> 
<ul><li>初始化选项和压缩配置，以及默认使用 zlib 库进行压缩</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">class</span> <span class="token class-name">CompressionPlugin</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">validate</span><span class="token punctuation">(</span>
    <span class="token comment">/** @type {Schema} */</span>
    schema<span class="token punctuation">,</span> options <span class="token operator">||</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Compression Plugin"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">baseDataPath</span><span class="token operator">:</span> <span class="token string">"options"</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
      test<span class="token punctuation">,</span>
      include<span class="token punctuation">,</span>
      exclude<span class="token punctuation">,</span>
      algorithm <span class="token operator">=</span> <span class="token string">"gzip"</span><span class="token punctuation">,</span>
      compressionOptions <span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      filename <span class="token operator">=</span> <span class="token punctuation">(</span>options <span class="token operator">||</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>algorithm <span class="token operator">===</span> <span class="token string">"brotliCompress"</span> <span class="token operator">?</span> <span class="token string">"[path][base].br"</span> <span class="token operator">:</span> <span class="token string">"[path][base].gz"</span><span class="token punctuation">,</span>
      threshold <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      minRatio <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
      deleteOriginalAssets <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
      test<span class="token punctuation">,</span>
      include<span class="token punctuation">,</span>
      exclude<span class="token punctuation">,</span>
      algorithm<span class="token punctuation">,</span>
      compressionOptions<span class="token punctuation">,</span>
      filename<span class="token punctuation">,</span>
      threshold<span class="token punctuation">,</span>
      minRatio<span class="token punctuation">,</span>
      deleteOriginalAssets
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">/**
    {
	  test: undefined,
	  include: undefined,
	  exclude: undefined,
	  algorithm: "gzip",
	  compressionOptions: {
	    level: 9,
	  },
	  filename: "[path][base].gz",
	  threshold: 0,
	  minRatio: 0.8,
	  deleteOriginalAssets: false,
	}
	*/</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>algorithm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>algorithm<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>algorithm <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

      <span class="token keyword">const</span> zlib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"zlib"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 默认使用 zlib 压缩</span>


      <span class="token keyword">this</span><span class="token punctuation">.</span>algorithm <span class="token operator">=</span> zlib<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>algorithm<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>algorithm<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Algorithm "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>algorithm<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" is not found in "zlib"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> defaultCompressionOptions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">gzip</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">level</span><span class="token operator">:</span> zlib<span class="token punctuation">.</span>constants<span class="token punctuation">.</span><span class="token constant">Z_BEST_COMPRESSION</span> <span class="token comment">// 9</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">deflate</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">level</span><span class="token operator">:</span> zlib<span class="token punctuation">.</span>constants<span class="token punctuation">.</span><span class="token constant">Z_BEST_COMPRESSION</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">deflateRaw</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">level</span><span class="token operator">:</span> zlib<span class="token punctuation">.</span>constants<span class="token punctuation">.</span><span class="token constant">Z_BEST_COMPRESSION</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">brotliCompress</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">[</span>zlib<span class="token punctuation">.</span>constants<span class="token punctuation">.</span><span class="token constant">BROTLI_PARAM_QUALITY</span><span class="token punctuation">]</span><span class="token operator">:</span> zlib<span class="token punctuation">.</span>constants<span class="token punctuation">.</span><span class="token constant">BROTLI_MAX_QUALITY</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">[</span>algorithm<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      
      <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>compressionOptions <span class="token operator">=</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 传递给 zlib 的压缩参数</span>
        <span class="token operator">...</span>defaultCompressionOptions<span class="token punctuation">,</span>
        <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>compressionOptions
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="apply_137"></a>apply</h3> 
<ul><li>通过 processAssets 钩子的 PROCESS_ASSETS_STAGE_OPTIMIZE_TRANSFER 阶段进行 assets 压缩</li></ul> 
<pre><code class="prism language-javascript"> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 
   <span class="token keyword">const</span> pluginName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
   
   compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>thisCompilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">,</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
     compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>processAssets<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
       <span class="token literal-property property">name</span><span class="token operator">:</span> pluginName<span class="token punctuation">,</span>
       <span class="token comment">// 优化已有 asset 的转换操作，例如对 asset 进行压缩，并作为独立的 asset</span>
       <span class="token literal-property property">stage</span><span class="token operator">:</span> compiler<span class="token punctuation">.</span>webpack<span class="token punctuation">.</span>Compilation<span class="token punctuation">.</span><span class="token constant">PROCESS_ASSETS_STAGE_OPTIMIZE_TRANSFER</span><span class="token punctuation">,</span> 
       <span class="token literal-property property">additionalAssets</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// true会多次调用回调，一次是在指定 stage 添加资产时触发回调，另一次是后来由插件添加资产时，这里为 CompressionWebpackPlugin 添加的压缩文件后触发</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">assets</span> <span class="token operator">=&gt;</span> 
       <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compilation<span class="token punctuation">,</span> assets<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>statsPrinter<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">,</span> <span class="token parameter">stats</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
       stats<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>print<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">"asset.info.compressed"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">"compression-webpack-plugin"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compressed<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
         green<span class="token punctuation">,</span>
         formatFlag
       <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> compressed <span class="token operator">?</span>
         <span class="token function">green</span><span class="token punctuation">(</span><span class="token function">formatFlag</span><span class="token punctuation">(</span><span class="token string">"compressed"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

</code></pre> 
<p>compress</p> 
<ul><li>遍历源 asset 进行压缩，会通过缓存已压缩文件来优化性能</li></ul> 
<p>asset 数据结构<br> <img src="https://images2.imgbox.com/7a/6e/CHaqKUBK_o.png" alt="在这里插入图片描述" width="50%" height="50%"></p> 
<pre><code class="prism language-javascript"><span class="token keyword">async</span> <span class="token function">compress</span><span class="token punctuation">(</span><span class="token parameter">compiler<span class="token punctuation">,</span> compilation<span class="token punctuation">,</span> assets</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">const</span> cache <span class="token operator">=</span> compilation<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">"CompressionWebpackPlugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 遍历文件</span>
	<span class="token keyword">const</span> assetsForMinify <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	  <span class="token comment">// 获取文件信息</span>
	  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
        info<span class="token punctuation">,</span>
        source
      <span class="token punctuation">}</span> <span class="token operator">=</span>compilation<span class="token punctuation">.</span><span class="token function">getAsset</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>compressed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 当插件第一次添加压缩文件后，因为 additionalAssets:true 会第二次触发插件回调，如果第一次被压缩了 info.compressed 为 true</span>
	  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
    <span class="token comment">// 通过开发者传递的 test、exclude、include 匹配文件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>compiler<span class="token punctuation">.</span>webpack<span class="token punctuation">.</span>ModuleFilenameHelpers<span class="token punctuation">.</span><span class="token function">matchObject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 获取压缩相关 name</span>
    <span class="token keyword">let</span> relatedName<span class="token punctuation">;</span> <span class="token comment">// "gzipped"</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>algorithm <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>filename <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        relatedName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">compression-function-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">"md5"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * @type {string}
         */</span>
        <span class="token keyword">let</span> filenameForRelatedName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">;</span>
        <span class="token keyword">const</span> index <span class="token operator">=</span> filenameForRelatedName<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          filenameForRelatedName <span class="token operator">=</span> filenameForRelatedName<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        relatedName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>filenameForRelatedName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ed</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>algorithm <span class="token operator">===</span> <span class="token string">"gzip"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      relatedName <span class="token operator">=</span> <span class="token string">"gzipped"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      relatedName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>algorithm<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ed</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>related <span class="token operator">&amp;&amp;</span> info<span class="token punctuation">.</span>related<span class="token punctuation">[</span>relatedName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
	<span class="token comment">// 缓存文件相关</span>
	<span class="token keyword">const</span> cacheItem <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">getItemCache</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 第一个参数key：序列化成字符串，通过 serialize-javascript 库序列化成字符串</span>
	  name<span class="token punctuation">,</span>
	  <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>algorithm<span class="token punctuation">,</span>
	  <span class="token literal-property property">compressionOptions</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>compressionOptions
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">getLazyHashedEtag</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第二个参数 etag: 根据资源文件内容生成 hash</span>
	<span class="token comment">// 返回缓存内容</span>
	<span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> cacheItem<span class="token punctuation">.</span><span class="token function">getPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 返回文件 buffer</span>
	<span class="token keyword">let</span> buffer<span class="token punctuation">;</span> <span class="token comment">// No need original buffer for cached files</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>output<span class="token punctuation">.</span>source<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> source<span class="token punctuation">.</span>buffer <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	   buffer <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token punctuation">}</span> <span class="token comment">// Compatibility with webpack plugins which don't use `webpack-sources`</span>
	 <span class="token comment">// See https://github.com/webpack-contrib/compression-webpack-plugin/issues/236</span>
	 <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
	   buffer <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	     <span class="token comment">// eslint-disable-next-line no-param-reassign</span>
	     buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
	   <span class="token punctuation">}</span>
	 <span class="token punctuation">}</span>
	
	 <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>threshold<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 小于开发者传入的要压缩的阈值退出</span>
	   <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	 <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
	 name<span class="token punctuation">,</span>
	 source<span class="token punctuation">,</span>
	 info<span class="token punctuation">,</span>
	 buffer<span class="token punctuation">,</span>
	 output<span class="token punctuation">,</span>
	 cacheItem<span class="token punctuation">,</span>
	 relatedName
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">assetForMinify</span> <span class="token operator">=&gt;</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>assetForMinify<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// webpack 格式文件，用于生成输出文件 </span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
    RawSource
  <span class="token punctuation">}</span> <span class="token operator">=</span> compiler<span class="token punctuation">.</span>webpack<span class="token punctuation">.</span>sources<span class="token punctuation">;</span>
  <span class="token keyword">const</span> scheduledTasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 压缩操作</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> asset <span class="token keyword">of</span> assetsForMinify<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	  scheduledTasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	  	<span class="token comment">// ...</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>scheduledTasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_282"></a>生成输出压缩文件</h3> 
<pre><code class="prism language-javascript">  <span class="token comment">// 压缩操作</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> asset <span class="token keyword">of</span> assetsForMinify<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	  scheduledTasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
          name<span class="token punctuation">,</span>
          source<span class="token punctuation">,</span>
          buffer<span class="token punctuation">,</span>
          output<span class="token punctuation">,</span>
          cacheItem<span class="token punctuation">,</span>
          info<span class="token punctuation">,</span>
          relatedName
        <span class="token punctuation">}</span> <span class="token operator">=</span> asset<span class="token punctuation">;</span>
        
        <span class="token comment">// 优先将压缩相关内容存入缓存</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>output<span class="token punctuation">.</span>source<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>output<span class="token punctuation">.</span>compressed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
              <span class="token comment">// 文件内容压缩</span>
              output<span class="token punctuation">.</span>compressed <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">runCompressionAlgorithm</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              compilation<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
		  <span class="token comment">// 压缩效果相关阈值，&gt; 开发者传入的值跳过</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>output<span class="token punctuation">.</span>compressed<span class="token punctuation">.</span>length <span class="token operator">/</span> buffer<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>minRatio<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">await</span> cacheItem<span class="token punctuation">.</span><span class="token function">storePromise</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
              <span class="token literal-property property">compressed</span><span class="token operator">:</span> output<span class="token punctuation">.</span>compressed
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
		  <span class="token comment">// 根据压缩后的内容生成文件</span>
          output<span class="token punctuation">.</span>source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RawSource</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>compressed<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">await</span> cacheItem<span class="token punctuation">.</span><span class="token function">storePromise</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存入 source、compressed</span>
        <span class="token punctuation">}</span>
		
		<span class="token comment">// this.options.filename："[path][base].gz" , filename："main.css"</span>
		<span class="token comment">// newFilename：'main.css.gz'</span>
		<span class="token keyword">const</span> newFilename <span class="token operator">=</span> compilation<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">filename</span><span class="token operator">:</span> name <span class="token comment">// name："main.css"</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> newInfo <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">compressed</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 是否删除源文件，通过 compilation.updateAsset 更新源文件信息</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>deleteOriginalAssets<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>deleteOriginalAssets <span class="token operator">===</span> <span class="token string">"keep-source-map"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            compilation<span class="token punctuation">.</span><span class="token function">updateAsset</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> source<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
              <span class="token comment">// @ts-ignore</span>
              <span class="token literal-property property">related</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> <span class="token keyword">null</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          compilation<span class="token punctuation">.</span><span class="token function">deleteAsset</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          compilation<span class="token punctuation">.</span><span class="token function">updateAsset</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> source<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">related</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token punctuation">[</span>relatedName<span class="token punctuation">]</span><span class="token operator">:</span> newFilename
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		<span class="token comment">// 生成压缩文件</span>
		compilation<span class="token punctuation">.</span><span class="token function">emitAsset</span><span class="token punctuation">(</span>newFilename<span class="token punctuation">,</span> output<span class="token punctuation">.</span>source<span class="token punctuation">,</span> newInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</code></pre> 
<p>runCompressionAlgorithm</p> 
<ul><li>通过 zlib 进行压缩</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> zlib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"zlib"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>algorithm <span class="token operator">=</span> zlib<span class="token punctuation">[</span><span class="token string">'gzip'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

 <span class="token function">runCompressionAlgorithm</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">algorithm</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>compressionOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
         <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
         <span class="token function">resolve</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
         <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aac8be79bd1f1a6104af6ae8c95a6a0a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机毕设答辩前必看干货</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bf490ca0c8c1b4c1f729f760f88c22ed/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python 运行报错 UnicodeDecodeError 解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>