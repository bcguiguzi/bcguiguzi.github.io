<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用MySQL进行数据分析——以淘宝用户数据为例 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用MySQL进行数据分析——以淘宝用户数据为例" />
<meta property="og:description" content="使用MySQL进行数据分析——以淘宝用户数据为例 1. 背景介绍 本文主要是练习使用 mysql 进行数据分析，结合 excel 进行可视化分析，数据来源为阿里云天池的淘宝用户数据集，本数据集(UserBehavior.csv)包含了2017年11月25日至2017年12月3日之间，有行为的约一百万随机用户的所有行为（行为包括点击、购买、加购、喜欢）。数据集的每一行表示一条用户行为，由用户ID、商品ID、商品类目ID、行为类型和时间戳组成，并以逗号分隔。
字段解释为：
列名称说明用户ID整数类型，序列化后的用户ID商品ID整数类型，序列化后的商品ID商品类目ID整数类型，序列化后的商品所属类目ID行为类型字符串，枚举类型，包括(‘pv’, ‘buy’, ‘cart’, ‘fav’)时间戳行为发生的时间戳 注意到用户行为类型有四种，分别是：
行为类型说明pv商品详情页pv，等价于点击buy商品购买cart将商品加入购物车fav收藏商品 关于数据集的大小说明：
维度数量用户数量987,994商品数量4,162,024用户数量987,994商品类目数量9,439所有行为数量100,150,807 由于数据集太过庞大，本人电脑可能不堪重负，用 python 读取发现有十亿条数据，用 mysql 载入也太费时间（导入一个小时才导入了几百万条），因此本文使用部分数据进行分析。
2. 3. 数据清洗 3.1 缺失值处理 select count(UserID),count(ItemID),count(CategoryID),count(BehaviorType),count(TimeStamp) from userbehavior 发现并没有缺失值，总共有3694900条数据
3.2 重复值处理 select UserID,ItemID,Timestamp from userbehavior group by UserID,ItemID,Timestamp having count(*) &gt; 1 发现有两行数据是重复的，因此删除这两行数据。
3.3 时间变量处理 观察数据发现Timestamp字段为时间戳，并非传统的时间日期，需要对这一字段进行处理。
alter table userbehavior add date DATE ,add time VARCHAR(10) 新增 日期date 和 时间time 字段
update userbehavior set date = from_unixtime(Timestamp,&#39;%Y-%m-%d&#39;), time = from_unixtime(Timestamp,&#39;%k&#39;) 利用 from_unixtime 函数将 日期 和 时间 从时间戳中提取出来，这一过程时间很长，可能需要几分钟，大家可以喝口水稍等一会儿 😃😃😃" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/b655a2d7f0cb2d8e40afd43afde7aed4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-10T23:59:10+08:00" />
<meta property="article:modified_time" content="2021-07-10T23:59:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用MySQL进行数据分析——以淘宝用户数据为例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="MySQL_0"></a>使用MySQL进行数据分析——以淘宝用户数据为例</h2> 
<h2><a id="1__2"></a>1. 背景介绍</h2> 
<p>本文主要是练习使用 mysql 进行数据分析，结合 excel 进行可视化分析，数据来源为阿里云天池的<a href="https://tianchi.aliyun.com/dataset/dataDetail?dataId=649" rel="nofollow">淘宝用户数据集</a>，本数据集(<a href="https://tianchi.aliyun.com/dataset/dataDetail?dataId=649" rel="nofollow">UserBehavior.csv</a>)包含了2017年11月25日至2017年12月3日之间，有行为的约一百万随机用户的所有行为（行为包括点击、购买、加购、喜欢）。数据集的每一行表示一条用户行为，由用户ID、商品ID、商品类目ID、行为类型和时间戳组成，并以逗号分隔。</p> 
<p>字段解释为：</p> 
<table><thead><tr><th>列名称</th><th>说明</th></tr></thead><tbody><tr><td>用户ID</td><td>整数类型，序列化后的用户ID</td></tr><tr><td>商品ID</td><td>整数类型，序列化后的商品ID</td></tr><tr><td>商品类目ID</td><td>整数类型，序列化后的商品所属类目ID</td></tr><tr><td>行为类型</td><td>字符串，枚举类型，包括(‘pv’, ‘buy’, ‘cart’, ‘fav’)</td></tr><tr><td>时间戳</td><td>行为发生的时间戳</td></tr></tbody></table> 
<p>注意到用户行为类型有四种，分别是：</p> 
<table><thead><tr><th>行为类型</th><th>说明</th></tr></thead><tbody><tr><td>pv</td><td>商品详情页pv，等价于点击</td></tr><tr><td>buy</td><td>商品购买</td></tr><tr><td>cart</td><td>将商品加入购物车</td></tr><tr><td>fav</td><td>收藏商品</td></tr></tbody></table> 
<p>关于数据集的大小说明：</p> 
<table><thead><tr><th>维度</th><th>数量</th></tr></thead><tbody><tr><td>用户数量</td><td>987,994</td></tr><tr><td>商品数量</td><td>4,162,024</td></tr><tr><td>用户数量</td><td>987,994</td></tr><tr><td>商品类目数量</td><td>9,439</td></tr><tr><td>所有行为数量</td><td>100,150,807</td></tr></tbody></table> 
<p>由于数据集太过庞大，本人电脑可能不堪重负，用 python 读取发现有十亿条数据，用 mysql 载入也太费时间（导入一个小时才导入了几百万条），因此本文使用部分数据进行分析。</p> 
<h2><a id="2_32"></a>2.</h2> 
<h2><a id="3__33"></a>3. 数据清洗</h2> 
<h3><a id="31__34"></a>3.1 缺失值处理</h3> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>UserID<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>ItemID<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>CategoryID<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>BehaviorType<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">TimeStamp</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> userbehavior
</code></pre> 
<p><img src="https://images2.imgbox.com/64/3d/99oQUPFa_o.png" alt="在这里插入图片描述"></p> 
<p>发现并没有缺失值，总共有3694900条数据</p> 
<h3><a id="32__43"></a>3.2 重复值处理</h3> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> UserID<span class="token punctuation">,</span>ItemID<span class="token punctuation">,</span><span class="token keyword">Timestamp</span>
<span class="token keyword">from</span> userbehavior 
<span class="token keyword">group</span> <span class="token keyword">by</span> UserID<span class="token punctuation">,</span>ItemID<span class="token punctuation">,</span><span class="token keyword">Timestamp</span>
<span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/60/d2/j1T35H4W_o.png" alt="在这里插入图片描述"><br> 发现有两行数据是重复的，因此删除这两行数据。</p> 
<h3><a id="33__53"></a>3.3 时间变量处理</h3> 
<p>观察数据发现Timestamp字段为时间戳，并非传统的时间日期，需要对这一字段进行处理。</p> 
<pre><code class="prism language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> userbehavior <span class="token keyword">add</span> <span class="token keyword">date</span> <span class="token keyword">DATE</span> <span class="token punctuation">,</span><span class="token keyword">add</span> <span class="token keyword">time</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> 
</code></pre> 
<p>新增 日期date 和 时间time 字段</p> 
<pre><code class="prism language-sql"><span class="token keyword">update</span> userbehavior <span class="token keyword">set</span> <span class="token keyword">date</span> <span class="token operator">=</span> from_unixtime<span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">,</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">time</span> <span class="token operator">=</span> from_unixtime<span class="token punctuation">(</span><span class="token keyword">Timestamp</span><span class="token punctuation">,</span><span class="token string">'%k'</span><span class="token punctuation">)</span>
</code></pre> 
<p>利用 from_unixtime 函数将 日期 和 时间 从时间戳中提取出来，这一过程时间很长，可能需要几分钟，大家可以喝口水稍等一会儿 😃😃😃<br> 处理好了！！！(上一步我并没有删除重复值) 😦<br> <img src="https://images2.imgbox.com/9f/29/nxnkkc4U_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="34__70"></a>3.4 离群值处理</h3> 
<p>此数据集中存在的离群值可能是日期时间不在我们研究的范围内，我们研究的时间范围是2017年11月25日至2017年12月3日之间，因此在这之外的均属于离群值</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> userbehavior
<span class="token keyword">where</span> <span class="token keyword">date</span><span class="token operator">&lt;</span><span class="token string">'2017-11-25'</span> <span class="token operator">or</span> <span class="token keyword">date</span><span class="token operator">&gt;</span><span class="token string">'2017-12-03'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/db/25/Nl85Szy5_o.png" alt="在这里插入图片描述"><br> 因此，删除这1870行数据，</p> 
<pre><code class="prism language-sql"><span class="token keyword">delete</span>
<span class="token keyword">from</span> userbehavior
<span class="token keyword">where</span> <span class="token keyword">date</span><span class="token operator">&lt;</span><span class="token string">'2017-11-25'</span> <span class="token operator">or</span> <span class="token keyword">date</span><span class="token operator">&gt;</span><span class="token string">'2017-12-03'</span>
</code></pre> 
<p>删除完成，数据集已经处理完毕，最终数据集为3693030行数据。</p> 
<h2><a id="4__88"></a>4. 数据分析</h2> 
<h3><a id="41__89"></a>4.1 用户行为分析</h3> 
<p>类似于 用户漏斗分析<br> 首先创建一个新视图，</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">view</span> behaviorcount<span class="token punctuation">(</span>
<span class="token keyword">select</span> Behaviortype<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> count
<span class="token keyword">from</span> userbehavior
<span class="token keyword">group</span> <span class="token keyword">by</span> Behaviortype<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> Behaviortype<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> count<span class="token punctuation">,</span> concat<span class="token punctuation">(</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3693030</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span> 比例<span class="token punctuation">,</span>
       <span class="token keyword">case</span> <span class="token keyword">when</span> Behaviortype<span class="token operator">=</span><span class="token string">'pv'</span> <span class="token keyword">then</span> <span class="token number">1</span>
		    <span class="token keyword">when</span> Behaviortype<span class="token operator">=</span><span class="token string">'cart'</span> <span class="token keyword">then</span> concat<span class="token punctuation">(</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> count <span class="token keyword">from</span> behaviorcount <span class="token keyword">where</span> Behaviortype<span class="token operator">=</span><span class="token string">'cart'</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">select</span> count <span class="token keyword">from</span> behaviorcount <span class="token keyword">where</span> Behaviortype<span class="token operator">=</span><span class="token string">'pv'</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span>
		    <span class="token keyword">when</span> Behaviortype<span class="token operator">=</span><span class="token string">'fav'</span> <span class="token keyword">then</span> concat<span class="token punctuation">(</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> count <span class="token keyword">from</span> behaviorcount <span class="token keyword">where</span> Behaviortype<span class="token operator">=</span><span class="token string">'fav'</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">select</span> count <span class="token keyword">from</span> behaviorcount <span class="token keyword">where</span> Behaviortype<span class="token operator">=</span><span class="token string">'cart'</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span>
			<span class="token keyword">when</span> Behaviortype<span class="token operator">=</span><span class="token string">'buy'</span> <span class="token keyword">then</span> concat<span class="token punctuation">(</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> count <span class="token keyword">from</span> behaviorcount <span class="token keyword">where</span> Behaviortype<span class="token operator">=</span><span class="token string">'buy'</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">select</span> count <span class="token keyword">from</span> behaviorcount <span class="token keyword">where</span> Behaviortype<span class="token operator">=</span><span class="token string">'fav'</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span> 
			<span class="token keyword">end</span> <span class="token keyword">as</span> 上一阶段比例
<span class="token keyword">from</span> userbehavior
<span class="token keyword">group</span> <span class="token keyword">by</span> Behaviortype
<span class="token keyword">order</span> <span class="token keyword">by</span> count <span class="token keyword">desc</span>
</code></pre> 
<p>结果如下：<br> <img src="https://images2.imgbox.com/85/85/6rCzHQA4_o.png" alt="在这里插入图片描述"><br> 由运行结果可以看出，用户点击量、加购、收藏、购买占比分别为89.53%、5.57%、2.89%、2.00%，从用户浏览到用户购买的转化率仅仅有2.00%，所以我们要对如此低的转化率进行分析。而2.00%只是整体的从用户开始浏览到下单成功的转化率，一般用户来到商品页面可能会有以下几个可能的行为路径：浏览-购买、浏览-加购-购买、浏览-收藏-购买、浏览-加购并收藏-购买、浏览-流失，那么我们就从这几个方面进行拆解，运用漏斗分析方法分析找出具体哪种路径的哪个环节出了问题，造成整体转化率低。<br> 根据上一阶段比例，可以看出从 浏览-购物车 仅占比6.22%，从 加购-收藏 占比为51.91%，从收藏-购买占比为69.28%。</p> 
<p>计算各个阶段的转化率<br> 创建视图<br> 根据用户和商品计算出 四种行为 的数量</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">view</span> user_b
<span class="token keyword">as</span>
<span class="token keyword">select</span> UserID<span class="token punctuation">,</span>ItemID<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> Behaviortype<span class="token operator">=</span><span class="token string">'pv'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> 点击<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> BehaviorType<span class="token operator">=</span><span class="token string">'cart'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> 加购<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> BehaviorType<span class="token operator">=</span><span class="token string">'fav'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> 收藏<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> BehaviorType<span class="token operator">=</span><span class="token string">'buy'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> 购买
<span class="token keyword">from</span> userbehavior
<span class="token keyword">group</span> <span class="token keyword">by</span> UserID<span class="token punctuation">,</span>ItemID
</code></pre> 
<p><img src="https://images2.imgbox.com/6e/90/4SzbubCa_o.png" alt="在这里插入图片描述"><br> 计算各个阶段的数量</p> 
<pre><code class="prism language-sql"><span class="token comment">#点击量-3306494</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>点击<span class="token punctuation">)</span> <span class="token keyword">FROM</span> user_b<span class="token punctuation">;</span>

<span class="token comment">#点击-购买-36343</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>购买<span class="token punctuation">)</span> <span class="token keyword">FROM</span> user_b
<span class="token keyword">WHERE</span> 点击<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 购买<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 收藏<span class="token operator">=</span><span class="token number">0</span> <span class="token operator">AND</span> 加购<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">#点击-加购-99087</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>加购<span class="token punctuation">)</span> <span class="token keyword">FROM</span> user_b
<span class="token keyword">WHERE</span> 点击<span class="token operator">&gt;</span><span class="token number">0</span>  <span class="token operator">AND</span> 收藏<span class="token operator">=</span><span class="token number">0</span> <span class="token operator">AND</span> 加购<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">#点击-加购-购买-10488</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>购买<span class="token punctuation">)</span> <span class="token keyword">FROM</span> user_b
<span class="token keyword">WHERE</span> 点击<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 购买<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 收藏<span class="token operator">=</span><span class="token number">0</span> <span class="token operator">AND</span> 加购<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">#点击-收藏-41269</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>收藏<span class="token punctuation">)</span> <span class="token keyword">FROM</span> user_b
<span class="token keyword">WHERE</span> 点击<span class="token operator">&gt;</span><span class="token number">0</span>  <span class="token operator">AND</span> 收藏<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 加购<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">#点击-收藏-购买-3550</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>购买<span class="token punctuation">)</span> <span class="token keyword">FROM</span> user_b
<span class="token keyword">WHERE</span> 点击<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 购买<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 收藏<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 加购<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>


<span class="token comment">#点击-收藏+加购-6497</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>收藏<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">SUM</span><span class="token punctuation">(</span>加购<span class="token punctuation">)</span> <span class="token keyword">FROM</span> user_b
<span class="token keyword">WHERE</span> 点击<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 收藏<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 加购<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">#点击-收藏+加购-购买-475</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>购买<span class="token punctuation">)</span> <span class="token keyword">FROM</span> user_b
<span class="token keyword">WHERE</span> 点击<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 收藏<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 加购<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 购买<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">#点击-流失-2910307</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>点击<span class="token punctuation">)</span> <span class="token keyword">FROM</span> user_b
<span class="token keyword">WHERE</span> 点击<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> 收藏<span class="token operator">=</span><span class="token number">0</span> <span class="token operator">AND</span> 加购<span class="token operator">=</span><span class="token number">0</span> <span class="token operator">AND</span> 购买<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/51/80/2ROU1eUq_o.png" alt="在这里插入图片描述"><br> 从计算结果可以看出，用户直接购买的转化率为1.1%，加购后购买的转化率为10.58%，收藏后购买的转化率为8.6%，加购并收藏后购买的转化率为7.31%，很明显，用户在加购、收藏后购买的转化率比浏览之后直接购买的转化率高的多，针对这种情况，商家店铺可以从优化产品宣传介绍页面、鼓励用户收藏加购的优惠活动、限时优惠活动等营销手段方面促进用户加购收藏行为，从而一定程度上提升购买转化率。</p> 
<p>另外，浏览量很大，但是有购买行动的却是非常少，大量用户流失，从浏览到直接购买、加购、收藏、加购并收藏的转化率都非常低，也许是用户在浏览过程中没有找到喜欢的，对此，可以针对不同用户的喜好，精准推荐顾客喜欢的比较热销的一些产品，从而促进转化。</p> 
<h3><a id="42__174"></a>4.2 分析转化率</h3> 
<p>针对平台问题，运用假设分析方法，假设：用户推荐机制不合理，平台推荐商品不是用户喜欢的，造成转化率低。</p> 
<p>通过分析高浏览量商品和高购买量商品是否相关，如果是，则假设不成立，如果不是，则假设成立；</p> 
<p>浏览量前10的商品类：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> CategoryID<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> 点击次数
<span class="token keyword">from</span> userbehavior
<span class="token keyword">where</span> Behaviortype <span class="token operator">=</span> <span class="token string">'pv'</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> CategoryID
<span class="token keyword">order</span> <span class="token keyword">by</span> 点击次数 <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">10</span>
</code></pre> 
<p>购买量前10的商品类：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> CategoryID<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> 点击次数
<span class="token keyword">from</span> userbehavior
<span class="token keyword">where</span> Behaviortype <span class="token operator">=</span> <span class="token string">'buy'</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> CategoryID
<span class="token keyword">order</span> <span class="token keyword">by</span> 点击次数 <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">10</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b8/72/oC1JFpjM_o.png" alt="在这里插入图片描述"><br> 由结果可以看出，高点击量不一定高购买量</p> 
<p>再细分到每个商品分析；<br> 分析浏览量前10的商品的购买次数</p> 
<pre><code class="prism language-sql"><span class="token comment">#利用之前创建的视图uesr_b</span>
<span class="token keyword">select</span> ItemID<span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>点击<span class="token punctuation">)</span> 点击次数<span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>购买<span class="token punctuation">)</span> 购买量
<span class="token keyword">from</span> user_b
<span class="token keyword">where</span> ItemID <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token keyword">select</span> u1<span class="token punctuation">.</span>ItemID 
<span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> ItemID<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>ItemID<span class="token punctuation">)</span> 点击次数
<span class="token keyword">from</span> userbehavior
<span class="token keyword">where</span> Behaviortype <span class="token operator">=</span> <span class="token string">'pv'</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> ItemID
<span class="token keyword">order</span> <span class="token keyword">by</span> 点击次数 <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">)</span> u1<span class="token punctuation">)</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> ItemID
</code></pre> 
<p><img src="https://images2.imgbox.com/d1/5f/dJoy15rZ_o.png" alt="在这里插入图片描述"><br> 接着分析购买量前10的商品的浏览量：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> ItemID<span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>点击<span class="token punctuation">)</span> 点击次数<span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>购买<span class="token punctuation">)</span> 购买量
<span class="token keyword">from</span> user_b
<span class="token keyword">where</span> ItemID <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token keyword">select</span> u1<span class="token punctuation">.</span>ItemID 
<span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> ItemID<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>ItemID<span class="token punctuation">)</span> 购买量
<span class="token keyword">from</span> userbehavior
<span class="token keyword">where</span> Behaviortype <span class="token operator">=</span> <span class="token string">'buy'</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> ItemID
<span class="token keyword">order</span> <span class="token keyword">by</span> 购买量 <span class="token keyword">desc</span>
<span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">)</span> u1<span class="token punctuation">)</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> ItemID
</code></pre> 
<p><img src="https://images2.imgbox.com/93/61/CLamrH2D_o.png" alt="在这里插入图片描述"><br> 分析结果，点击量高的商品购买量却很低，几乎没有，意味着高流量商品最后转化率很低；而购买量高的商品浏览量并不是很高，而且没有点击量前10的商品，即高购买量并没有是由高浏览量带来；</p> 
<p>结论：平台的推荐机制不合理，给了高流量的商品最后并没有带来转化，没有带来效益，最后造成抓化率低。应该把流量推给购买量高的商品类和具体商品，如商品类目2735466、1464116，商品3122135、2964774等。</p> 
<p>转化率低原因分析总结：</p> 
<p>1、优化平台推荐机制，把更多流量给到购买量高的商品，提升转化率；</p> 
<p>2、针对大量流失用户，通过积分会员制、店铺页面优化、更精准用户推荐等措施降低流失率；</p> 
<p>3、引导加购、收藏，可通过限时优惠活动、加购收藏后享受优惠等活动间接提高用户购买转化率；</p> 
<h3><a id="43__246"></a>4.3 用户活跃时间分析</h3> 
<p>根据不同日期对用户行为进行分析<br> 假设1：用户在周末购买量会增加；</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">date</span><span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> Behaviortype <span class="token operator">=</span> <span class="token string">'pv'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'点击'</span><span class="token punctuation">,</span>
	   <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> Behaviortype <span class="token operator">=</span> <span class="token string">'cart'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'加购'</span><span class="token punctuation">,</span>
	   <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> Behaviortype <span class="token operator">=</span> <span class="token string">'fav'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'收藏'</span><span class="token punctuation">,</span>
	   <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> Behaviortype <span class="token operator">=</span> <span class="token string">'buy'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'购买'</span>
<span class="token keyword">from</span> userbehavior 
<span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token keyword">date</span>
</code></pre> 
<p>利用excel进行可视化分析<br> <img src="https://images2.imgbox.com/29/92/KI85q18D_o.png" alt="在这里插入图片描述"><br> 从图标可以看出，在周六、周日用户点击量、加购量、收藏量、购买量均有小幅增加，说明假设成立。但是由于周期较短，本案例数据仅仅有一周数据可供分析，所以结果有待考量。</p> 
<p>假设2：用户在一天中晚上时间活跃度上升；</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">time</span><span class="token punctuation">,</span>
     <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> Behaviortype <span class="token operator">=</span> <span class="token string">'pv'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'点击'</span><span class="token punctuation">,</span>
	   <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> Behaviortype <span class="token operator">=</span> <span class="token string">'cart'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'加购'</span><span class="token punctuation">,</span>
	   <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> Behaviortype <span class="token operator">=</span> <span class="token string">'fav'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'收藏'</span><span class="token punctuation">,</span>
	   <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> Behaviortype <span class="token operator">=</span> <span class="token string">'buy'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'购买'</span>
<span class="token keyword">from</span> userbehavior 
<span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token keyword">time</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">time</span> <span class="token keyword">asc</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4c/82/Uour154k_o.png" alt="在这里插入图片描述"><br> 由用户活跃可视化图可以看出，用户在一天中零点到4点时段活跃快速下降，从4点到10点逐步上升，10点到18点基本平稳，从18点到22点活跃度急剧上升，达到最高。所以用户在晚上的时段确实更活跃，假设成立。在这个时段可以加大商品推荐和促销活动，从而提高转化率。</p> 
<h3><a id="44_RFM_277"></a>4.4 RFM分析法对用户价值进行分类</h3> 
<p>RFM是三个指标缩写，分别为最近一次消费时间间隔Recency，消费频率Frequency，消费金额Monetary，往往通过这3个指标对用户进行价值分类。</p> 
<p>R=当前时间-最近一次购买时间</p> 
<p>F=在分析周期内购买的次数</p> 
<p>M=在分析周期内用户消费额</p> 
<p>本文由于没有用户消费相关数据，所以不作分析，接下来对R、F值进行计算：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> UserID<span class="token punctuation">,</span> datediff<span class="token punctuation">(</span><span class="token string">'2017-12-03'</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span> R<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>behaviortype<span class="token punctuation">)</span> F
<span class="token keyword">from</span> userbehavior
<span class="token keyword">where</span> Behaviortype <span class="token operator">=</span> <span class="token string">'buy'</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> UserID
</code></pre> 
<p><img src="https://images2.imgbox.com/cc/30/Cjb86Rzg_o.png" alt="在这里插入图片描述"><br> 给R、F值打分（具体公司分析业务可根据业务情况制定打分标准）：</p> 
<table><thead><tr><th>按价值打分</th><th>R</th><th>F</th></tr></thead><tbody><tr><td>1</td><td>8-9天</td><td>1-6次</td></tr><tr><td>2</td><td>5-7天</td><td>7-12次</td></tr><tr><td>3</td><td>3-5天</td><td>13-18次</td></tr><tr><td>4</td><td>2天内</td><td>19次以及以上</td></tr></tbody></table> 
<p>接下来对上述结果进行打分：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>
			 <span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> R <span class="token operator">between</span> <span class="token number">8</span> <span class="token operator">and</span> <span class="token number">9</span> <span class="token keyword">then</span> <span class="token number">1</span>
					  <span class="token keyword">when</span> R <span class="token operator">between</span> <span class="token number">5</span> <span class="token operator">and</span> <span class="token number">7</span> <span class="token keyword">then</span> <span class="token number">2</span>
					  <span class="token keyword">when</span> R <span class="token operator">between</span> <span class="token number">3</span> <span class="token operator">and</span> <span class="token number">5</span> <span class="token keyword">then</span> <span class="token number">3</span>
						<span class="token keyword">when</span> R <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token keyword">then</span> <span class="token number">4</span> 
			 <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> R_score<span class="token punctuation">,</span>
			 <span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> F <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">6</span> <span class="token keyword">then</span> <span class="token number">1</span>
			      <span class="token keyword">when</span> F <span class="token operator">between</span> <span class="token number">7</span> <span class="token operator">and</span> <span class="token number">12</span> <span class="token keyword">then</span> <span class="token number">2</span>
						<span class="token keyword">when</span> F <span class="token operator">between</span> <span class="token number">13</span> <span class="token operator">and</span> <span class="token number">18</span> <span class="token keyword">then</span> <span class="token number">3</span>
						<span class="token keyword">when</span> F <span class="token operator">&gt;=</span> <span class="token number">19</span> <span class="token keyword">then</span> <span class="token number">4</span>
				<span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> F_score
<span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> UserID<span class="token punctuation">,</span> datediff<span class="token punctuation">(</span><span class="token string">'2017-12-03'</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span> R<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>behaviortype<span class="token punctuation">)</span> F
			<span class="token keyword">from</span> userbehavior
			<span class="token keyword">where</span> Behaviortype <span class="token operator">=</span> <span class="token string">'buy'</span>
			<span class="token keyword">group</span> <span class="token keyword">by</span> UserID<span class="token punctuation">)</span> m
</code></pre> 
<p><img src="https://images2.imgbox.com/0d/f1/OsSoR4ys_o.png" alt="在这里插入图片描述"><br> 计算 R 和 F 的均值</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>R_score<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>F_score<span class="token punctuation">)</span>
<span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>
			 <span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> R <span class="token operator">between</span> <span class="token number">8</span> <span class="token operator">and</span> <span class="token number">9</span> <span class="token keyword">then</span> <span class="token number">1</span>
					  <span class="token keyword">when</span> R <span class="token operator">between</span> <span class="token number">5</span> <span class="token operator">and</span> <span class="token number">7</span> <span class="token keyword">then</span> <span class="token number">2</span>
					  <span class="token keyword">when</span> R <span class="token operator">between</span> <span class="token number">3</span> <span class="token operator">and</span> <span class="token number">5</span> <span class="token keyword">then</span> <span class="token number">3</span>
						<span class="token keyword">when</span> R <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token keyword">then</span> <span class="token number">4</span> 
			 <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> R_score<span class="token punctuation">,</span>
			 <span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> F <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">6</span> <span class="token keyword">then</span> <span class="token number">1</span>
			      <span class="token keyword">when</span> F <span class="token operator">between</span> <span class="token number">7</span> <span class="token operator">and</span> <span class="token number">12</span> <span class="token keyword">then</span> <span class="token number">2</span>
						<span class="token keyword">when</span> F <span class="token operator">between</span> <span class="token number">13</span> <span class="token operator">and</span> <span class="token number">18</span> <span class="token keyword">then</span> <span class="token number">3</span>
						<span class="token keyword">when</span> F <span class="token operator">&gt;=</span> <span class="token number">19</span> <span class="token keyword">then</span> <span class="token number">4</span>
				<span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> F_score
<span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> UserID<span class="token punctuation">,</span> datediff<span class="token punctuation">(</span><span class="token string">'2017-12-03'</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span> R<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>behaviortype<span class="token punctuation">)</span> F
			<span class="token keyword">from</span> userbehavior
			<span class="token keyword">where</span> Behaviortype <span class="token operator">=</span> <span class="token string">'buy'</span>
			<span class="token keyword">group</span> <span class="token keyword">by</span> UserID<span class="token punctuation">)</span> m<span class="token punctuation">)</span>n
</code></pre> 
<p><img src="https://images2.imgbox.com/94/b8/ok5NUQUf_o.png" alt="在这里插入图片描述"><br> RFM用户价值分类规则如下：<br> <img src="https://images2.imgbox.com/6d/7a/rTnXy1FQ_o.png" alt="在这里插入图片描述"><br> 找出不同价值用户的人数：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> p<span class="token punctuation">.</span>客户类型<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"人数"</span>
<span class="token keyword">from</span> 
<span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> R_score <span class="token operator">&gt;</span> <span class="token number">3.0477</span> <span class="token operator">and</span> F_score <span class="token operator">&gt;</span> <span class="token number">1.1035</span> <span class="token keyword">then</span> <span class="token string">'重要价值客户'</span>
     <span class="token keyword">when</span> R_score <span class="token operator">&gt;</span> <span class="token number">3.0477</span> <span class="token operator">and</span> F_score <span class="token operator">&lt;</span> <span class="token number">1.1035</span> <span class="token keyword">then</span> <span class="token string">'重要发展客户'</span>
		 <span class="token keyword">when</span> R_score <span class="token operator">&lt;</span> <span class="token number">3.0477</span> <span class="token operator">and</span> F_score <span class="token operator">&gt;</span> <span class="token number">1.1035</span> <span class="token keyword">then</span> <span class="token string">'重要保持客户'</span>
		 <span class="token keyword">when</span> R_score <span class="token operator">&lt;</span> <span class="token number">3.0477</span> <span class="token operator">and</span> F_score <span class="token operator">&lt;</span> <span class="token number">1.1035</span> <span class="token keyword">then</span> <span class="token string">'重要挽留客户'</span> <span class="token keyword">end</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'客户类型'</span>
<span class="token keyword">from</span> 
<span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>
			 <span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> R <span class="token operator">between</span> <span class="token number">8</span> <span class="token operator">and</span> <span class="token number">9</span> <span class="token keyword">then</span> <span class="token number">1</span>
					  <span class="token keyword">when</span> R <span class="token operator">between</span> <span class="token number">5</span> <span class="token operator">and</span> <span class="token number">7</span> <span class="token keyword">then</span> <span class="token number">2</span>
					  <span class="token keyword">when</span> R <span class="token operator">between</span> <span class="token number">3</span> <span class="token operator">and</span> <span class="token number">5</span> <span class="token keyword">then</span> <span class="token number">3</span>
						<span class="token keyword">when</span> R <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token keyword">then</span> <span class="token number">4</span> 
			 <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> R_score<span class="token punctuation">,</span>
			 <span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> F <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">6</span> <span class="token keyword">then</span> <span class="token number">1</span>
			      <span class="token keyword">when</span> F <span class="token operator">between</span> <span class="token number">7</span> <span class="token operator">and</span> <span class="token number">12</span> <span class="token keyword">then</span> <span class="token number">2</span>
						<span class="token keyword">when</span> F <span class="token operator">between</span> <span class="token number">13</span> <span class="token operator">and</span> <span class="token number">18</span> <span class="token keyword">then</span> <span class="token number">3</span>
						<span class="token keyword">when</span> F <span class="token operator">&gt;=</span> <span class="token number">19</span> <span class="token keyword">then</span> <span class="token number">4</span>
				<span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> F_score
      <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> UserID<span class="token punctuation">,</span> datediff<span class="token punctuation">(</span><span class="token string">'2017-12-03'</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span> R<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>behaviortype<span class="token punctuation">)</span> F
			      <span class="token keyword">from</span> userbehavior
			      <span class="token keyword">where</span> Behaviortype <span class="token operator">=</span> <span class="token string">'buy'</span>
			      <span class="token keyword">group</span> <span class="token keyword">by</span> UserID<span class="token punctuation">)</span> m<span class="token punctuation">)</span>n<span class="token punctuation">)</span>p
<span class="token keyword">group</span> <span class="token keyword">by</span> p<span class="token punctuation">.</span>客户类型
</code></pre> 
<p><img src="https://images2.imgbox.com/59/44/y39GIZqe_o.png" alt="在这里插入图片描述"><br> 结论：</p> 
<p>对于重要价值用户，消费频率高且最近消费距离现在时间短，需要给其提供VIP服务；</p> 
<p>对于占比较大的重要发展用户，其消费频率低，但最近消费距离现在时间较短，想办法提高其消费频率；</p> 
<p>对于重要保持用户，最近消费距离现在时间较远，也就是R值低，但是消费频次高，这样的用户，是一段时间没来的忠实客户，可以采取邮件推送、APP推送提醒、促销活动时短信提醒等方式主动和他们保持联系，提高复购率；</p> 
<p>对于占比较大的重要挽留用户，最近消费时间距离现在较远、消费频率低，这种用户有即将流失的危险，需要主动联系用户，调查清楚哪里出了问题，并想办法挽回；</p> 
<blockquote> 
 <p>参考资料 <a href="https://zhuanlan.zhihu.com/p/353557952" rel="nofollow">SQL数据分析实战案例</a></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6bd7264523c88a05f9958618eca540b7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机管理 看内存个数,电脑不拆机怎么查看内存条插槽个数?</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/79f8a0389465e127cb4db601ab962e3f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机论文答辩注意哪些问题,计算机毕业设计答辩（问题&#43;技巧）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>