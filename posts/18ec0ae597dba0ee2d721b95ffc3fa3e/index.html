<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android通用的筛选栏实现 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android通用的筛选栏实现" />
<meta property="og:description" content="最近事情比较多,不管是生活还是工作,感觉节奏都在赶着走,对于之前相对比较喜欢自由的我,也要慢慢适应之后的节奏了,不管怎样,生活还在继续,加油~~
今天来写一个通用的筛选栏的实现,也是因为之前项目中要好多地方用到筛选栏这么个东西,所以为了之后用起来比较方便,就简单的做了一些封装.废话不多说,看一下效果图:
很多APP都有用到这个筛选栏,相信大家也不陌生.
一、需求分析 看到这个筛选栏之后,先来考虑一下布局,在开始接触android时候的我,可能看到这个布局的想法是:筛选栏这个部分,一个LinearLayout的横向布局,然后再分为3个部分,每个部分各占比重为1,然后在每个部分中放一个TextView和ImageView,之后监听每个部分的点击事件,对TextView和ImageView进行颜色、文字、方向等的处理.确实,这样做能实现功能,不过写起来很麻烦,需要手动的去处理TextView和ImageView的变化,可能筛选栏多了之后就会乱掉,而且还要花费大量时间去查找修改BUG,可能有一个小地方写反了,效果就乱掉了.
所以思考一下,对于筛选栏这个部分,有没有更好的布局设计呢?翻了翻能用的控件,发现CheckBox其实用在这里很好用(之前可能对于CheckBox的用法,只停留在勾选个对勾这样),怎么说它好用呢,因为CheckBox有两种状态(选中和未选中)刚好可以符合需求,选中的时候将字体颜色变为蓝色,并且将图标转换方向和颜色,未选中时重置为起始的样式,并且可以通过设置selector轻松的完成样式的转变.只需管理CheckBox的状态即可.
对于弹出框,很简单,自定义一个popWindow就可以了.不过需要注意的是因为需要在弹框弹出的时候,改变背景色的透明度,并且在弹出框消失之后恢复背景色的透明度,所以需要做一些特殊处理,这里打算去监听popWindow的变化来去完成相关处理.
二、代码实现及优化 根据上边的分析,布局设计如下:
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt; &lt;RelativeLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34; xmlns:tools=&#34;http://schemas.android.com/tools&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;match_parent&#34; tools:context=&#34;com.example.junweiliu.filterdemo.MainActivity&#34;&gt; &lt;!--筛选栏--&gt; &lt;LinearLayout android:id=&#34;@&#43;id/ll_stay_visit_selsect&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;40dp&#34; android:background=&#34;@color/white&#34; android:gravity=&#34;center_vertical&#34; android:orientation=&#34;horizontal&#34;&gt; &lt;!--筛选地点--&gt; &lt;LinearLayout android:id=&#34;@&#43;id/ll_place_tab&#34; android:layout_width=&#34;0dp&#34; android:layout_height=&#34;match_parent&#34; android:layout_weight=&#34;1&#34; android:gravity=&#34;center&#34;&gt; &lt;CheckBox android:id=&#34;@&#43;id/cb_place&#34; android:layout_width=&#34;wrap_content&#34; android:layout_height=&#34;wrap_content&#34; android:background=&#34;@null&#34; android:button=&#34;@null&#34; android:drawablePadding=&#34;10dp&#34; android:drawableRight=&#34;@drawable/seletor_stock_arrow&#34; android:gravity=&#34;center&#34; android:text=&#34;地点&#34; android:textColor=&#34;@drawable/selector_text_stock&#34; android:textSize=&#34;15sp&#34;/&gt; &lt;/LinearLayout&gt; &lt;!--筛选类型--&gt; &lt;LinearLayout android:id=&#34;@&#43;id/ll_type&#34; android:layout_width=&#34;0dp&#34; android:layout_height=&#34;match_parent&#34; android:layout_weight=&#34;1&#34; android:gravity=&#34;center&#34;&gt; &lt;CheckBox android:id=&#34;@&#43;id/cb_type&#34; android:layout_width=&#34;wrap_content&#34; android:layout_height=&#34;wrap_content&#34; android:background=&#34;@null&#34; android:button=&#34;@null&#34; android:drawablePadding=&#34;10dp&#34; android:drawableRight=&#34;@drawable/seletor_stock_arrow&#34; android:gravity=&#34;center&#34; android:text=&#34;条件&#34; android:textColor=&#34;@drawable/selector_text_stock&#34; android:textSize=&#34;15sp&#34;/&gt; &lt;/LinearLayout&gt; &lt;!--筛选时间--&gt; &lt;LinearLayout android:id=&#34;@&#43;id/ll_time&#34; android:layout_width=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/18ec0ae597dba0ee2d721b95ffc3fa3e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-11-22T09:04:49+08:00" />
<meta property="article:modified_time" content="2016-11-22T09:04:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android通用的筛选栏实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近事情比较多,不管是生活还是工作,感觉节奏都在赶着走,对于之前相对比较喜欢自由的我,也要慢慢适应之后的节奏了,不管怎样,生活还在继续,加油~~</p> 
<p>今天来写一个通用的筛选栏的实现,也是因为之前项目中要好多地方用到筛选栏这么个东西,所以为了之后用起来比较方便,就简单的做了一些封装.废话不多说,看一下效果图:</p> 
<p><img src="https://images2.imgbox.com/1c/e3/UrsR85ub_o.gif" alt="这里写图片描述" title=""></p> 
<p>很多APP都有用到这个筛选栏,相信大家也不陌生.</p> 
<hr> 
<h4 id="一需求分析">一、需求分析</h4> 
<p>看到这个筛选栏之后,先来考虑一下布局,在开始接触android时候的我,可能看到这个布局的想法是:筛选栏这个部分,一个LinearLayout的横向布局,然后再分为3个部分,每个部分各占比重为1,然后在每个部分中放一个TextView和ImageView,之后监听每个部分的点击事件,对TextView和ImageView进行颜色、文字、方向等的处理.确实,这样做能实现功能,不过写起来很麻烦,需要手动的去处理TextView和ImageView的变化,可能筛选栏多了之后就会乱掉,而且还要花费大量时间去查找修改BUG,可能有一个小地方写反了,效果就乱掉了.</p> 
<p>所以思考一下,对于筛选栏这个部分,有没有更好的布局设计呢?翻了翻能用的控件,发现CheckBox其实用在这里很好用(之前可能对于CheckBox的用法,只停留在勾选个对勾这样),怎么说它好用呢,因为CheckBox有两种状态(选中和未选中)刚好可以符合需求,选中的时候将字体颜色变为蓝色,并且将图标转换方向和颜色,未选中时重置为起始的样式,并且可以通过设置selector轻松的完成样式的转变.只需管理CheckBox的状态即可.</p> 
<p>对于弹出框,很简单,自定义一个popWindow就可以了.不过需要注意的是因为需要在弹框弹出的时候,改变背景色的透明度,并且在弹出框消失之后恢复背景色的透明度,所以需要做一些特殊处理,这里打算去监听popWindow的变化来去完成相关处理.</p> 
<hr> 
<h4 id="二代码实现及优化">二、代码实现及优化</h4> 
<p>根据上边的分析,布局设计如下:</p> 
<pre class="prettyprint"><code class="language-xml hljs "><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout
</span>        <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
        <span class="hljs-attribute">xmlns:tools</span>=<span class="hljs-value">"http://schemas.android.com/tools"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">tools:context</span>=<span class="hljs-value">"com.example.junweiliu.filterdemo.MainActivity"</span>&gt;</span>

    <span class="hljs-comment">&lt;!--筛选栏--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/ll_stay_visit_selsect"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"40dp"</span>
            <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@color/white"</span>
            <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center_vertical"</span>
            <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"horizontal"</span>&gt;</span>
        <span class="hljs-comment">&lt;!--筛选地点--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>                <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/ll_place_tab"</span>
                <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"0dp"</span>
                <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
                <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
                <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">CheckBox
</span>                    <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/cb_place"</span>
                    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
                    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
                    <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@null"</span>
                    <span class="hljs-attribute">android:button</span>=<span class="hljs-value">"@null"</span>
                    <span class="hljs-attribute">android:drawablePadding</span>=<span class="hljs-value">"10dp"</span>
                 <span class="hljs-attribute">android:drawableRight</span>=<span class="hljs-value">"@drawable/seletor_stock_arrow"</span>
                    <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center"</span>
                    <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"地点"</span>
                    <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"@drawable/selector_text_stock"</span>
                    <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"15sp"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>
        <span class="hljs-comment">&lt;!--筛选类型--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>                <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/ll_type"</span>
                <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"0dp"</span>
                <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
                <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
                <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">CheckBox
</span>                    <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/cb_type"</span>
                    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
                    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
                    <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@null"</span>
                    <span class="hljs-attribute">android:button</span>=<span class="hljs-value">"@null"</span>
                    <span class="hljs-attribute">android:drawablePadding</span>=<span class="hljs-value">"10dp"</span>
                    <span class="hljs-attribute">android:drawableRight</span>=<span class="hljs-value">"@drawable/seletor_stock_arrow"</span>
                    <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center"</span>
                    <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"条件"</span>
                    <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"@drawable/selector_text_stock"</span>
                    <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"15sp"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>
        <span class="hljs-comment">&lt;!--筛选时间--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>                <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/ll_time"</span>
                <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"0dp"</span>
                <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
                <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
                <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">CheckBox
</span>                    <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/cb_time"</span>
                    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
                    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
                    <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@null"</span>
                    <span class="hljs-attribute">android:button</span>=<span class="hljs-value">"@null"</span>
                    <span class="hljs-attribute">android:drawablePadding</span>=<span class="hljs-value">"10dp"</span>
                    <span class="hljs-attribute">android:drawableRight</span>=<span class="hljs-value">"@drawable/seletor_stock_arrow"</span>
                    <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center"</span>
                    <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"时间"</span>
                    <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"@drawable/selector_text_stock"</span>
                    <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"15sp"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span></code></pre> 
<p>设置了3部分,并且每个部分都使用CheckBox,CheckBox中设置了两个selector,分别是android:drawableRight=”@drawable/seletor_stock_arrow” <br> 和android:textColor=”@drawable/selector_text_stock”</p> 
<p>设置如下:</p> 
<p>设置箭头样式的seletor_stock_arrow:</p> 
<pre class="prettyprint"><code class="language-xml hljs "><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">selector</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
    <span class="hljs-comment">&lt;!--选中的箭头样式--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">android:drawable</span>=<span class="hljs-value">"@mipmap/arrow_up_blue"</span> <span class="hljs-attribute">android:state_checked</span>=<span class="hljs-value">"true"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!--未选中的箭头样式--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">android:drawable</span>=<span class="hljs-value">"@mipmap/arrow_down_black"</span> <span class="hljs-attribute">android:state_checked</span>=<span class="hljs-value">"false"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">selector</span>&gt;</span></code></pre> 
<p>设置文字样式的selector_text_stock:</p> 
<pre class="prettyprint"><code class="language-xml hljs "><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">selector</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">android:color</span>=<span class="hljs-value">"@color/gray"</span> <span class="hljs-attribute">android:state_checked</span>=<span class="hljs-value">"false"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">android:color</span>=<span class="hljs-value">"@color/colorPrimary"</span> <span class="hljs-attribute">android:state_checked</span>=<span class="hljs-value">"true"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">selector</span>&gt;</span></code></pre> 
<p>实现很简单,来看一下效果:</p> 
<p><img src="https://images2.imgbox.com/76/a4/bf7nzXD7_o.gif" alt="这里写图片描述" title=""></p> 
<p>效果还不错,接下来就是在代码中去管理每个CheckBox的状态就可以了.在做这部分之前,先来搞定popWindow,后续需要配合CheckBox来使用.</p> 
<p>popWindow很简单,继承PopupWindow,然后自定义一些样式和布局即可,直接放代码:</p> 
<p>CommonFilterPop:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.filterdemo.pop;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.graphics.drawable.BitmapDrawable;
<span class="hljs-keyword">import</span> android.view.LayoutInflater;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.view.ViewGroup;
<span class="hljs-keyword">import</span> android.widget.AdapterView;
<span class="hljs-keyword">import</span> android.widget.ListView;
<span class="hljs-keyword">import</span> android.widget.PopupWindow;

<span class="hljs-keyword">import</span> com.example.junweiliu.filterdemo.R;
<span class="hljs-keyword">import</span> com.example.junweiliu.filterdemo.adapter.CommPopAdapter;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-javadoc">/**
 * Created by junweiliu on 16/11/7.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommonFilterPop</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PopupWindow</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * 布局填充器
     */</span>
    <span class="hljs-keyword">private</span> LayoutInflater mInflater;
    <span class="hljs-javadoc">/**
     * 上下文
     */</span>
    <span class="hljs-keyword">private</span> Context mContext;
    <span class="hljs-javadoc">/**
     * 只显示String类型的数据
     */</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; mDatas = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-javadoc">/**
     * pop整体View
     */</span>
    <span class="hljs-keyword">private</span> View popupView;
    <span class="hljs-javadoc">/**
     * 选择条件的list
     */</span>
    <span class="hljs-keyword">private</span> ListView contentLv;
    <span class="hljs-javadoc">/**
     * 筛选条件选择后的回调
     */</span>
    AdapterView.OnItemClickListener itemClickListener;
    <span class="hljs-javadoc">/**
     * 适配器
     */</span>
    CommPopAdapter adapter;


    <span class="hljs-javadoc">/**
     * 构造函数
     *
     *<span class="hljs-javadoctag"> @param</span> context
     *<span class="hljs-javadoctag"> @param</span> mDatas
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title">CommonFilterPop</span>(Context context, List&lt;String&gt; mDatas) {
        <span class="hljs-keyword">this</span>.mInflater = LayoutInflater.from(context);
        <span class="hljs-keyword">this</span>.mContext = context;
        <span class="hljs-keyword">this</span>.mDatas = (mDatas);
        popupView = mInflater.inflate(
                R.layout.common_popup_list_dialog, <span class="hljs-keyword">null</span>);
        <span class="hljs-comment">//设置View</span>
        <span class="hljs-keyword">this</span>.setContentView(popupView);
        <span class="hljs-comment">//设置弹出窗体的宽高</span>
        <span class="hljs-keyword">this</span>.setWidth(ViewGroup.LayoutParams.MATCH_PARENT);
        <span class="hljs-keyword">this</span>.setHeight(ViewGroup.LayoutParams.WRAP_CONTENT);
        <span class="hljs-comment">//初始化控件</span>
        initPopView();
        <span class="hljs-keyword">this</span>.setFocusable(<span class="hljs-keyword">true</span>);
        <span class="hljs-keyword">this</span>.setTouchable(<span class="hljs-keyword">true</span>);
        <span class="hljs-keyword">this</span>.setOutsideTouchable(<span class="hljs-keyword">true</span>);
        <span class="hljs-keyword">this</span>.setBackgroundDrawable(<span class="hljs-keyword">new</span> BitmapDrawable());
        <span class="hljs-comment">//需要动画效果的话可以设置</span>
        <span class="hljs-comment">//this.setAnimationStyle(R.style.PopupWindowAnimation);</span>
        <span class="hljs-keyword">this</span>.update();
    }


    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initPopView</span>() {
        contentLv = (ListView) popupView.findViewById(R.id.lv_pop);
        adapter = <span class="hljs-keyword">new</span> CommPopAdapter(mContext, mDatas);
        contentLv.setAdapter(adapter);
    }


    <span class="hljs-javadoc">/**
     * listview点击事件
     *
     *<span class="hljs-javadoctag"> @param</span> itemClickListener
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setOnItemSelectedListener</span>(AdapterView.OnItemClickListener itemClickListener) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != itemClickListener &amp;&amp; <span class="hljs-keyword">null</span> != contentLv) {
            contentLv.setOnItemClickListener(itemClickListener);
        }
    }
}</code></pre> 
<p>适配器CommPopAdapter:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.filterdemo.adapter;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.view.LayoutInflater;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.view.ViewGroup;
<span class="hljs-keyword">import</span> android.widget.BaseAdapter;
<span class="hljs-keyword">import</span> android.widget.TextView;

<span class="hljs-keyword">import</span> com.example.junweiliu.filterdemo.R;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-javadoc">/**
 * Created by junweiliu on 16/11/7.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommPopAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseAdapter</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * 筛选条件数据
     */</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; mDatas = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-javadoc">/**
     * 布局加载器
     */</span>
    <span class="hljs-keyword">private</span> LayoutInflater mInflater;

    <span class="hljs-keyword">public</span> <span class="hljs-title">CommPopAdapter</span>(Context context, List&lt;String&gt; mDatas) {
        <span class="hljs-keyword">this</span>.mDatas = mDatas;
        mInflater = LayoutInflater.from(context);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getCount</span>() {
        <span class="hljs-keyword">return</span> mDatas.size();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title">getItem</span>(<span class="hljs-keyword">int</span> i) {
        <span class="hljs-keyword">return</span> mDatas.get(i);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getItemId</span>(<span class="hljs-keyword">int</span> i) {
        <span class="hljs-keyword">return</span> i;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> View <span class="hljs-title">getView</span>(<span class="hljs-keyword">int</span> i, View convertView, ViewGroup viewGroup) {
        ViewHolder viewHolder = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (convertView == <span class="hljs-keyword">null</span>) {
            viewHolder = <span class="hljs-keyword">new</span> ViewHolder();
            convertView = mInflater.inflate(
                    R.layout.common_popup_list_item, <span class="hljs-keyword">null</span>);
            viewHolder.mTitleTv = (TextView) convertView.findViewById(R.id.tv_common_listpop_title);
            convertView.setTag(viewHolder);
        } <span class="hljs-keyword">else</span> {
            viewHolder = (ViewHolder) convertView.getTag();
        }
        viewHolder.mTitleTv.setText(mDatas.get(i));
        <span class="hljs-keyword">return</span> convertView;
    }

    <span class="hljs-javadoc">/**
     * vh
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewHolder</span> {<!-- --></span>
        <span class="hljs-javadoc">/**
         * 筛选项文字tv
         */</span>
        TextView mTitleTv;
    }

}</code></pre> 
<p>相关XML文件:</p> 
<p>pop布局文件common_popup_list_dialog:</p> 
<pre class="prettyprint"><code class="language-xml hljs "><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
              <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
              <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
              <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@android:color/transparent"</span>
              <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"bottom"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@android:color/transparent"</span>
            <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">View
</span>                <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
                <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"1dp"</span>
                <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@color/divider_line"</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">ListView
</span>                <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/lv_pop"</span>
                <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
                <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"0dp"</span>
                <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
                <span class="hljs-attribute">android:divider</span>=<span class="hljs-value">"@null"</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">View
</span>                <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
                <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"1dp"</span>
                <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@color/divider_line"</span>/&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span></code></pre> 
<p>适配器中的布局common_popup_list_item:</p> 
<pre class="prettyprint"><code class="language-xml hljs "><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
              <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
              <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
              <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@color/white"</span>
              <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span>
&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout
</span>            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@color/white"</span>
    &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>                <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/tv_common_listpop_title"</span>
                <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
                <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
                <span class="hljs-attribute">android:layout_centerHorizontal</span>=<span class="hljs-value">"true"</span>
                <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center"</span>
                <span class="hljs-attribute">android:padding</span>=<span class="hljs-value">"15dip"</span>
                <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"@string/app_name"</span>
        /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">View
</span>            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"0.5dip"</span>
            <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@color/divider_line"</span>
            <span class="hljs-attribute">android:scaleType</span>=<span class="hljs-value">"fitXY"</span>/&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span></code></pre> 
<p>注释很全,也很简单,就不多做解释.</p> 
<p>接下来就是调用popWindow,在那调用这个popWinow比较好呢,因为要写一个通用的筛选栏,所以把这些公共的部分都提取出来,放到BaseActivity中,需要用到的Activity直接继承BaseActivity,方便之后使用.</p> 
<p>创建一个BaseActivity并在其中对popWindow进行处理,代码如下</p> 
<p>BaseActivity:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.filterdemo;

<span class="hljs-keyword">import</span> android.app.Activity;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.support.annotation.Nullable;
<span class="hljs-keyword">import</span> android.support.v7.app.AppCompatActivity;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.view.WindowManager;
<span class="hljs-keyword">import</span> android.widget.AdapterView;
<span class="hljs-keyword">import</span> android.widget.PopupWindow;

<span class="hljs-keyword">import</span> com.example.junweiliu.filterdemo.pop.CommonFilterPop;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-javadoc">/**
 * Created by junweiliu on 16/11/7.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> {<!-- --></span>

    <span class="hljs-javadoc">/**
     * 筛选pop
     */</span>
    <span class="hljs-keyword">private</span> CommonFilterPop mPopupWindow;
    <span class="hljs-javadoc">/**
     * 当前上下文实例
     */</span>
    <span class="hljs-keyword">protected</span> Activity activity;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(@Nullable Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        <span class="hljs-keyword">this</span>.activity = <span class="hljs-keyword">this</span>;
    }

    <span class="hljs-javadoc">/**
     * 列表选择popupWindow
     *
     *<span class="hljs-javadoctag"> @param</span> parentView        父View
     *<span class="hljs-javadoctag"> @param</span> itemTexts         列表项文本集合
     *<span class="hljs-javadoctag"> @param</span> itemClickListener 列表项点击事件
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showFilterPopupWindow</span>(View parentView,
                                      List&lt;String&gt; itemTexts,
                                      AdapterView.OnItemClickListener itemClickListener,
                                      CustomerDismissListener dismissListener) {
        showFilterPopupWindow(parentView, itemTexts, itemClickListener, dismissListener, <span class="hljs-number">0</span>);
    }

    <span class="hljs-javadoc">/**
     * 列表选择popupWindow
     *
     *<span class="hljs-javadoctag"> @param</span> parentView        父View
     *<span class="hljs-javadoctag"> @param</span> itemTexts         列表项文本集合
     *<span class="hljs-javadoctag"> @param</span> itemClickListener 列表项点击事件
     *<span class="hljs-javadoctag"> @param</span> alpha             背景透明度 
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showFilterPopupWindow</span>(View parentView,
                                      List&lt;String&gt; itemTexts,
                                      AdapterView.OnItemClickListener itemClickListener,
                                      CustomerDismissListener dismissListener, <span class="hljs-keyword">float</span> alpha) {

        <span class="hljs-comment">// 判断当前是否显示</span>
        <span class="hljs-keyword">if</span> (mPopupWindow != <span class="hljs-keyword">null</span> &amp;&amp; mPopupWindow.isShowing()) {
            mPopupWindow.dismiss();
            mPopupWindow = <span class="hljs-keyword">null</span>;
        }
        mPopupWindow = <span class="hljs-keyword">new</span> CommonFilterPop(activity, itemTexts);
        mPopupWindow.setOnDismissListener(dismissListener);
        <span class="hljs-comment">// 绑定筛选点击事件</span>
        mPopupWindow.setOnItemSelectedListener(itemClickListener);
        <span class="hljs-comment">// 如果透明度设置为0的话,则默认设置为0.6f</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == alpha) {
            alpha = <span class="hljs-number">0.6</span>f;
        }
        <span class="hljs-comment">// 设置背景透明度</span>
        WindowManager.LayoutParams lp = activity.getWindow().getAttributes();
        lp.alpha = alpha;
        activity.getWindow().setAttributes(lp);
        <span class="hljs-comment">// 显示pop</span>
        mPopupWindow.showAsDropDown(parentView);

    }

    <span class="hljs-javadoc">/**
     * 自定义OnDismissListener
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerDismissListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">PopupWindow</span>.<span class="hljs-title">OnDismissListener</span> {<!-- --></span>
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDismiss</span>() {
            <span class="hljs-comment">// 当pop消失的时候,重置背景色透明度</span>
            WindowManager.LayoutParams lp = activity.getWindow().getAttributes();
            lp.alpha = <span class="hljs-number">1.0</span>f;
            activity.getWindow().setAttributes(lp);
        }
    }

    <span class="hljs-javadoc">/**
     * 隐藏pop
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hidePopListView</span>() {
        <span class="hljs-comment">// 判断当前是否显示,如果显示则dismiss</span>
        <span class="hljs-keyword">if</span> (mPopupWindow != <span class="hljs-keyword">null</span> &amp;&amp; mPopupWindow.isShowing()) {
            mPopupWindow.dismiss();
            mPopupWindow = <span class="hljs-keyword">null</span>;
        }
    }
}</code></pre> 
<p>在BaseActivity中对popWindow的显示消失做了处理,在popWindow创建时,改变了背景的透明度,重写了CustomerDismissListener来处理popWindow消失时恢复背景透明度.</p> 
<p>搞定了popWindow之后,就来结合CheckBox来使用吧.使用时应该是这样:</p> 
<pre class="prettyprint"><code class="language-java hljs ">        <span class="hljs-comment">// cb1操作</span>
        cb1.setOnCheckedChangeListener(<span class="hljs-keyword">new</span> CompoundButton.OnCheckedChangeListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCheckedChanged</span>(CompoundButton compoundButton, <span class="hljs-keyword">boolean</span> b) {
                <span class="hljs-comment">// 将其他的cb设置为未选中,将自己设置为选中</span>
                cb1.setChecked(<span class="hljs-keyword">true</span>);
                cb2.setChecked(<span class="hljs-keyword">false</span>);
                cb3.setChecked(<span class="hljs-keyword">false</span>);
                showFilterPopupWindow(showView, showMes1, <span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
                            <span class="hljs-annotation">@Override</span>
                            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; adapterView, View view, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">long</span> l) {
                             cb1.setText(showMes1.get(position));
                            }
                        },
                        <span class="hljs-keyword">new</span> CustomerDismissListener(){
                            <span class="hljs-annotation">@Override</span>
                            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDismiss</span>() {
                                <span class="hljs-keyword">super</span>.onDismiss();
                                <span class="hljs-comment">// 消失的时候,需要将当前的cb设置为未选中</span>
                                cb1.setChecked(<span class="hljs-keyword">false</span>);
                            }
                        });
            }
        });

        <span class="hljs-comment">// cb2操作</span>
        cb2.setOnCheckedChangeListener(<span class="hljs-keyword">new</span> CompoundButton.OnCheckedChangeListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCheckedChanged</span>(CompoundButton compoundButton, <span class="hljs-keyword">boolean</span> b) {
                <span class="hljs-comment">// 将其他的cb设置为未选中,将自己设置为选中</span>
                cb2.setChecked(<span class="hljs-keyword">true</span>);
                cb1.setChecked(<span class="hljs-keyword">false</span>);
                cb3.setChecked(<span class="hljs-keyword">false</span>);
                showFilterPopupWindow(showView, showMes2, <span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
                            <span class="hljs-annotation">@Override</span>
                            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; adapterView, View view, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">long</span> l) {
                             cb2.setText(showMes1.get(position));
                            }
                        },
                        <span class="hljs-keyword">new</span> CustomerDismissListener(){
                            <span class="hljs-annotation">@Override</span>
                            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDismiss</span>() {
                                <span class="hljs-keyword">super</span>.onDismiss();
                                <span class="hljs-comment">// 消失的时候,需要将当前的cb设置为未选中</span>
                                cb2.setChecked(<span class="hljs-keyword">false</span>);
                            }
                        });
            }
        });
        <span class="hljs-comment">// cb3操作</span>
        cb3.setOnCheckedChangeListener(<span class="hljs-keyword">new</span> CompoundButton.OnCheckedChangeListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCheckedChanged</span>(CompoundButton compoundButton, <span class="hljs-keyword">boolean</span> b) {
                <span class="hljs-comment">// 将其他的cb设置为未选中,将自己设置为选中</span>
                cb3.setChecked(<span class="hljs-keyword">true</span>);
                cb1.setChecked(<span class="hljs-keyword">false</span>);
                cb2.setChecked(<span class="hljs-keyword">false</span>);
                showFilterPopupWindow(showView, showMes3, <span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
                            <span class="hljs-annotation">@Override</span>
                            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; adapterView, View view, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">long</span> l) {
                             cb3.setText(showMes3.get(position));
                            }
                        },
                        <span class="hljs-keyword">new</span> CustomerDismissListener(){
                            <span class="hljs-annotation">@Override</span>
                            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDismiss</span>() {
                                <span class="hljs-keyword">super</span>.onDismiss();
                                <span class="hljs-comment">// 消失的时候,需要将当前的cb设置为未选中</span>
                                cb3.setChecked(<span class="hljs-keyword">false</span>);
                            }
                        });
            }
        });</code></pre> 
<p>有很多重复的部分,比如在onDismiss方法中,都是将当前cb设置为未选中状态,还有初始化选中状态部分,代码冗余太多,所以来封装一下,在BaseActivity当中封装一个方法</p> 
<pre class="prettyprint"><code class="language-java hljs ">    <span class="hljs-javadoc">/**
     * Tab筛选栏切换
     *
     *<span class="hljs-javadoctag"> @param</span> isChecked         选中状态
     *<span class="hljs-javadoctag"> @param</span> showView          展示pop的跟布局
     *<span class="hljs-javadoctag"> @param</span> showMes           展示选择的数据
     *<span class="hljs-javadoctag"> @param</span> itemClickListener 点击回调
     *<span class="hljs-javadoctag"> @param</span> tabs              所有的cb(需要几个输入几个就可以,cb1,cb2....)
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">filterTabToggle</span>(<span class="hljs-keyword">boolean</span> isChecked, View showView, List&lt;String&gt; showMes, AdapterView.OnItemClickListener itemClickListener, <span class="hljs-keyword">final</span> CheckBox... tabs) {
        <span class="hljs-keyword">if</span> (isChecked) {
            <span class="hljs-keyword">if</span> (tabs.length &lt;= <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-comment">// 第一个checkBox为当前点击选中的cb,其他cb进行setChecked(false);</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; tabs.length; i++) {
                tabs[i].setChecked(<span class="hljs-keyword">false</span>);
            }

            showFilterPopupWindow(showView, showMes, itemClickListener, <span class="hljs-keyword">new</span> CustomerDismissListener() {
                <span class="hljs-annotation">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDismiss</span>() {
                    <span class="hljs-keyword">super</span>.onDismiss();
                    <span class="hljs-comment">// 当pop消失时对第一个cb进行.setChecked(false)操作</span>
                    tabs[<span class="hljs-number">0</span>].setChecked(<span class="hljs-keyword">false</span>);
                }
            });
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 关闭checkBox时直接隐藏popuwindow</span>
            hidePopListView();
        }
    }</code></pre> 
<p>考虑到通用性,用了不定长参数… ,之前用过List,不过用起来不太好用,每次使用的时候,都需要创建list然后去组装一个list,用起来怪麻烦的.这样使用的时候只需要把需要选中的cb放在不定长参数的第一位,其他需要设置未选中的cb放在之后即可.用一下:</p> 
<pre class="prettyprint"><code class="language-java hljs ">        <span class="hljs-comment">// cb操作</span>
        cb1.setOnCheckedChangeListener(<span class="hljs-keyword">new</span> CompoundButton.OnCheckedChangeListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCheckedChanged</span>(CompoundButton compoundButton, <span class="hljs-keyword">boolean</span> isChecked) {
                filterTabToggle(isChecked, showView, showMes1, <span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; adapterView, View view, <span class="hljs-keyword">int</span> position, <span class="hljs-keyword">long</span> l) {
                        hidePopListView();
                        cb1.setText(showMes1.get(position));
                    }
                }, cb1, cb2, cb3);
            }
        });</code></pre> 
<p>用起来舒服了很多,可之后又发现了一个比较尴尬的问题.就是需要传入的showMes需要是一个List&lt; String &gt;,有的时候得到的数据并不是一个字符串类型的List,可能是各种类型的List&lt; Bean &gt;,这肿么办?解决方法有很多,比如可以这样做:</p> 
<pre class="prettyprint"><code class="language-java hljs ">    <span class="hljs-javadoc">/**
     * 展示时间的数据
     */</span>
    List&lt;TimeBean&gt; mTimes = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-javadoc">/**
     * 展示的时间str集合
     */</span>
    List&lt;String&gt; mTimeStr = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();

    <span class="hljs-javadoc">/**
     * 筛选数据
     */</span> 
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">forMatData</span>(){
       <span class="hljs-comment">// 初始化时间</span>
        TimeBean timeBean1 = <span class="hljs-keyword">new</span> TimeBean(<span class="hljs-string">"1天内"</span>, <span class="hljs-string">"去玩"</span>);
        TimeBean timeBean2 = <span class="hljs-keyword">new</span> TimeBean(<span class="hljs-string">"3天内"</span>, <span class="hljs-string">"去购物"</span>);
        TimeBean timeBean3 = <span class="hljs-keyword">new</span> TimeBean(<span class="hljs-string">"10天内"</span>, <span class="hljs-string">"去旅行"</span>);
        TimeBean timeBean4 = <span class="hljs-keyword">new</span> TimeBean(<span class="hljs-string">"30天内"</span>, <span class="hljs-string">"去赚钱"</span>);
        mTimes.add(timeBean1);
        mTimes.add(timeBean2);
        mTimes.add(timeBean3);
        mTimes.add(timeBean4);
        <span class="hljs-comment">// 获取时间中可用于筛选的数据</span>
        <span class="hljs-keyword">for</span> (TimeBean bean : mTimes) {
            mTimeStr.add(bean.getTimeStr());
        }
    } </code></pre> 
<p>可以从数据源中提取出用到的数据showMes,也不太麻烦,不过有没有更好的办法呢.毕竟每次都从不同的数据源中提取这些数据,也怪费时间的,考虑到这些之后,思来想去,想到一个不错的方法,使用通配符?,首先提出来一个公共接口BaseFilter,在其中规定一个统一的获取筛选字段的方法,如下:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.filterdemo.bean;

<span class="hljs-javadoc">/**
 * Created by junweiliu on 16/11/22.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BaseFilter</span> {<!-- --></span>

    <span class="hljs-javadoc">/**
     * 获取筛选的
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getFilterStr</span>();
}</code></pre> 
<p>然后让需要用到筛选功能的Bean实现这个接口中的getFilterStr方法并且去实现它.再对之前的filterTabToggle方法做一下修改,如下:</p> 
<p>Bean:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.filterdemo.bean;

<span class="hljs-javadoc">/**
 * Created by junweiliu on 16/11/22.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimeBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BaseFilter</span>{<!-- --></span>
    <span class="hljs-javadoc">/**
     * 时间str
     */</span>
    String timeStr;
    <span class="hljs-javadoc">/**
     * 时间事件
     */</span>
    String timeEvent;

    <span class="hljs-keyword">public</span> <span class="hljs-title">TimeBean</span>(String timeStr, String timeEvent) {
        <span class="hljs-keyword">this</span>.timeStr = timeStr;
        <span class="hljs-keyword">this</span>.timeEvent = timeEvent;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">getTimeStr</span>() {
        <span class="hljs-keyword">return</span> timeStr;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTimeStr</span>(String timeStr) {
        <span class="hljs-keyword">this</span>.timeStr = timeStr;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">getTimeEvent</span>() {
        <span class="hljs-keyword">return</span> timeEvent;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTimeEvent</span>(String timeEvent) {
        <span class="hljs-keyword">this</span>.timeEvent = timeEvent;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getFilterStr</span>() {
        <span class="hljs-keyword">return</span> timeStr;
    }
}</code></pre> 
<p>filterTabToggleT方法:</p> 
<pre class="prettyprint"><code class="language-java hljs ">    <span class="hljs-javadoc">/**
     * Tab筛选栏切换
     *
     *<span class="hljs-javadoctag"> @param</span> isChecked         选中状态
     *<span class="hljs-javadoctag"> @param</span> showView          展示pop的跟布局
     *<span class="hljs-javadoctag"> @param</span> showMes           展示选择的数据源
     *<span class="hljs-javadoctag"> @param</span> itemClickListener 点击回调
     *<span class="hljs-javadoctag"> @param</span> tabs              所有的cb(需要几个输入几个就可以,cb1,cb2....)
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">filterTabToggleT</span>(<span class="hljs-keyword">boolean</span> isChecked, View showView, List&lt;? extends BaseFilter&gt; showMes, AdapterView.OnItemClickListener itemClickListener, <span class="hljs-keyword">final</span> CheckBox... tabs) {
        <span class="hljs-keyword">if</span> (isChecked) {
            <span class="hljs-keyword">if</span> (tabs.length &lt;= <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-comment">// 第一个checkBox为当前点击选中的cb,其他cb进行setChecked(false);</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; tabs.length; i++) {
                tabs[i].setChecked(<span class="hljs-keyword">false</span>);
            }
            <span class="hljs-comment">// 从数据源中提取出展示的筛选条件</span>
            List&lt;String&gt; showStr = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
            <span class="hljs-keyword">for</span> (BaseFilter baseFilter : showMes) {
                showStr.add(baseFilter.getFilterStr());
            }
            showFilterPopupWindow(showView, showStr, itemClickListener, <span class="hljs-keyword">new</span> CustomerDismissListener() {
                <span class="hljs-annotation">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDismiss</span>() {
                    <span class="hljs-keyword">super</span>.onDismiss();
                    <span class="hljs-comment">// 当pop消失时对第一个cb进行.setChecked(false)操作</span>
                    tabs[<span class="hljs-number">0</span>].setChecked(<span class="hljs-keyword">false</span>);
                }
            });
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 关闭checkBox时直接隐藏popuwindow</span>
            hidePopListView();
        }
    }</code></pre> 
<p>这样在使用的时候,直接将List&lt; Bean &gt; 类型的数据传进去就可以了.这样整个的通用的筛选栏就实现了.当然根据需求的不同,需要去做修改 <br> ,不过大体的思路及实现就是这样.之后就可以这样用:</p> 
<pre class="prettyprint"><code class="language-java hljs ">        <span class="hljs-comment">// 选择时间cb</span>
        mTimeCb.setOnCheckedChangeListener(<span class="hljs-keyword">new</span> CompoundButton.OnCheckedChangeListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCheckedChanged</span>(CompoundButton compoundButton, <span class="hljs-keyword">boolean</span> isChecked) {
                filterTabToggleT(isChecked, mTimeAll, mTimes, <span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; adapterView, View view, <span class="hljs-keyword">int</span> position, <span class="hljs-keyword">long</span> l) {
                        hidePopListView();
                        mTimeCb.setText(mTimeStr.get(position));
                    }
                }, mTimeCb, mPlaceCb, mTypeCb);
            }
        });</code></pre> 
<p>最后贴一下完整的MainActivity和BaseActivity</p> 
<p>MainActivity:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.filterdemo;

<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.AdapterView;
<span class="hljs-keyword">import</span> android.widget.CheckBox;
<span class="hljs-keyword">import</span> android.widget.CompoundButton;
<span class="hljs-keyword">import</span> android.widget.LinearLayout;

<span class="hljs-keyword">import</span> com.example.junweiliu.filterdemo.bean.PlaceBean;
<span class="hljs-keyword">import</span> com.example.junweiliu.filterdemo.bean.TimeBean;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseActivity</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * 展示城市的数据源
     */</span>
    List&lt;PlaceBean&gt; mPopBeens = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-javadoc">/**
     * 展示类型的数据
     */</span>
    List&lt;String&gt; mTypes = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-javadoc">/**
     * 展示时间的数据
     */</span>
    List&lt;TimeBean&gt; mTimes = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-javadoc">/**
     * 展示的时间str集合
     */</span>
    List&lt;String&gt; mTimeStr = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-javadoc">/**
     * 筛选地区整体
     */</span>
    LinearLayout mPlaceAll;
    <span class="hljs-javadoc">/**
     * 筛选城市cb
     */</span>
    CheckBox mPlaceCb;
    <span class="hljs-javadoc">/**
     * 筛选类型整体
     */</span>
    LinearLayout mTypeAll;
    <span class="hljs-javadoc">/**
     * 筛选类型整体
     */</span>
    CheckBox mTypeCb;
    <span class="hljs-javadoc">/**
     * 筛选时间整体
     */</span>
    LinearLayout mTimeAll;
    <span class="hljs-javadoc">/**
     * 筛选时间整体
     */</span>
    CheckBox mTimeCb;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        initDate();
        initView();
    }


    <span class="hljs-javadoc">/**
     * 初始化数据
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initDate</span>() {
        <span class="hljs-comment">// 初始化城市</span>
        PlaceBean placeBean1 = <span class="hljs-keyword">new</span> PlaceBean(<span class="hljs-string">"天津"</span>);
        PlaceBean placeBean2 = <span class="hljs-keyword">new</span> PlaceBean(<span class="hljs-string">"北京"</span>);
        PlaceBean placeBean3 = <span class="hljs-keyword">new</span> PlaceBean(<span class="hljs-string">"上海"</span>);
        PlaceBean placeBean4 = <span class="hljs-keyword">new</span> PlaceBean(<span class="hljs-string">"深圳"</span>);
        PlaceBean placeBean5 = <span class="hljs-keyword">new</span> PlaceBean(<span class="hljs-string">"四川"</span>);
        PlaceBean placeBean6 = <span class="hljs-keyword">new</span> PlaceBean(<span class="hljs-string">"杭州"</span>);
        PlaceBean placeBean7 = <span class="hljs-keyword">new</span> PlaceBean(<span class="hljs-string">"苏州"</span>);
        mPopBeens.add(placeBean1);
        mPopBeens.add(placeBean2);
        mPopBeens.add(placeBean3);
        mPopBeens.add(placeBean4);
        mPopBeens.add(placeBean5);
        mPopBeens.add(placeBean6);
        mPopBeens.add(placeBean7);
        <span class="hljs-comment">// 初始化类型</span>
        mTypes.add(<span class="hljs-string">"美食"</span>);
        mTypes.add(<span class="hljs-string">"电影"</span>);
        mTypes.add(<span class="hljs-string">"化妆品"</span>);
        mTypes.add(<span class="hljs-string">"衣服"</span>);
        mTypes.add(<span class="hljs-string">"玩具"</span>);
        mTypes.add(<span class="hljs-string">"电器"</span>);
        mTypes.add(<span class="hljs-string">"装饰"</span>);
        mTypes.add(<span class="hljs-string">"超市"</span>);
        <span class="hljs-comment">// 初始化时间</span>
        TimeBean timeBean1 = <span class="hljs-keyword">new</span> TimeBean(<span class="hljs-string">"1天内"</span>, <span class="hljs-string">"去玩"</span>);
        TimeBean timeBean2 = <span class="hljs-keyword">new</span> TimeBean(<span class="hljs-string">"3天内"</span>, <span class="hljs-string">"去购物"</span>);
        TimeBean timeBean3 = <span class="hljs-keyword">new</span> TimeBean(<span class="hljs-string">"10天内"</span>, <span class="hljs-string">"去旅行"</span>);
        TimeBean timeBean4 = <span class="hljs-keyword">new</span> TimeBean(<span class="hljs-string">"30天内"</span>, <span class="hljs-string">"去赚钱"</span>);
        mTimes.add(timeBean1);
        mTimes.add(timeBean2);
        mTimes.add(timeBean3);
        mTimes.add(timeBean4);
        <span class="hljs-comment">// 获取时间中可用于筛选的数据</span>
        <span class="hljs-keyword">for</span> (TimeBean bean : mTimes) {
            mTimeStr.add(bean.getTimeStr());
        }
    }


    <span class="hljs-javadoc">/**
     * 初始化控件
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span>() {
        mPlaceAll = (LinearLayout) findViewById(R.id.ll_place_tab);
        mPlaceCb = (CheckBox) findViewById(R.id.cb_place);
        mTypeAll = (LinearLayout) findViewById(R.id.ll_type);
        mTypeCb = (CheckBox) findViewById(R.id.cb_type);
        mTimeAll = (LinearLayout) findViewById(R.id.ll_time);
        mTimeCb = (CheckBox) findViewById(R.id.cb_time);
        <span class="hljs-comment">// 点击选择城市整体</span>
        mPlaceAll.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View view) {
                <span class="hljs-keyword">if</span> (mPlaceCb.isChecked())
                    mPlaceCb.setChecked(<span class="hljs-keyword">false</span>);
                <span class="hljs-keyword">else</span>
                    mPlaceCb.setChecked(<span class="hljs-keyword">true</span>);
            }
        });
        <span class="hljs-comment">// 点击选择类型整体</span>
        mTypeAll.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View view) {
                <span class="hljs-keyword">if</span> (mTypeCb.isChecked())
                    mTypeCb.setChecked(<span class="hljs-keyword">false</span>);
                <span class="hljs-keyword">else</span>
                    mTypeCb.setChecked(<span class="hljs-keyword">true</span>);
            }
        });
        <span class="hljs-comment">// 点击选择时间整体</span>
        mTimeAll.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View view) {
                <span class="hljs-keyword">if</span> (mTimeCb.isChecked())
                    mTimeCb.setChecked(<span class="hljs-keyword">false</span>);
                <span class="hljs-keyword">else</span>
                    mTimeCb.setChecked(<span class="hljs-keyword">true</span>);
            }
        });

        <span class="hljs-comment">// 选择城市cb</span>
        mPlaceCb.setOnCheckedChangeListener(<span class="hljs-keyword">new</span> CompoundButton.OnCheckedChangeListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCheckedChanged</span>(CompoundButton compoundButton, <span class="hljs-keyword">boolean</span> isChecked) {
                filterTabToggleT(isChecked, mPlaceAll, mPopBeens, <span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; adapterView, View view, <span class="hljs-keyword">int</span> position, <span class="hljs-keyword">long</span> l) {
                        hidePopListView();
                        mPlaceCb.setText(mPopBeens.get(position).getFilterStr());
                    }
                }, mPlaceCb, mTypeCb, mTimeCb);
            }
        });

        <span class="hljs-comment">// 选择类型cb</span>
        mTypeCb.setOnCheckedChangeListener(<span class="hljs-keyword">new</span> CompoundButton.OnCheckedChangeListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCheckedChanged</span>(CompoundButton compoundButton, <span class="hljs-keyword">boolean</span> isChecked) {
                filterTabToggle(isChecked, mTypeAll, mTypes, <span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; adapterView, View view, <span class="hljs-keyword">int</span> position, <span class="hljs-keyword">long</span> l) {
                        hidePopListView();
                        mTypeCb.setText(mTypes.get(position));
                    }
                }, mTypeCb, mPlaceCb, mTimeCb);
            }
        });
        <span class="hljs-comment">// 选择时间cb</span>
        mTimeCb.setOnCheckedChangeListener(<span class="hljs-keyword">new</span> CompoundButton.OnCheckedChangeListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCheckedChanged</span>(CompoundButton compoundButton, <span class="hljs-keyword">boolean</span> isChecked) {
                filterTabToggle(isChecked, mTimeAll, mTimeStr, <span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; adapterView, View view, <span class="hljs-keyword">int</span> position, <span class="hljs-keyword">long</span> l) {
                        hidePopListView();
                        mTimeCb.setText(mTimeStr.get(position));
                    }
                }, mTimeCb, mPlaceCb, mTypeCb);
            }
        });

    }
}</code></pre> 
<p>BaseActivity:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.filterdemo;

<span class="hljs-keyword">import</span> android.app.Activity;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.support.annotation.Nullable;
<span class="hljs-keyword">import</span> android.support.v7.app.AppCompatActivity;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.view.WindowManager;
<span class="hljs-keyword">import</span> android.widget.AdapterView;
<span class="hljs-keyword">import</span> android.widget.CheckBox;
<span class="hljs-keyword">import</span> android.widget.PopupWindow;

<span class="hljs-keyword">import</span> com.example.junweiliu.filterdemo.bean.BaseFilter;
<span class="hljs-keyword">import</span> com.example.junweiliu.filterdemo.pop.CommonFilterPop;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-javadoc">/**
 * Created by junweiliu on 16/11/7.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> {<!-- --></span>

    <span class="hljs-javadoc">/**
     * 筛选pop
     */</span>
    <span class="hljs-keyword">private</span> CommonFilterPop mPopupWindow;
    <span class="hljs-javadoc">/**
     * 当前上下文实例
     */</span>
    <span class="hljs-keyword">protected</span> Activity activity;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(@Nullable Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        <span class="hljs-keyword">this</span>.activity = <span class="hljs-keyword">this</span>;
    }

    <span class="hljs-javadoc">/**
     * 列表选择popupWindow
     *
     *<span class="hljs-javadoctag"> @param</span> parentView        父View
     *<span class="hljs-javadoctag"> @param</span> itemTexts         列表项文本集合
     *<span class="hljs-javadoctag"> @param</span> itemClickListener 列表项点击事件
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showFilterPopupWindow</span>(View parentView,
                                      List&lt;String&gt; itemTexts,
                                      AdapterView.OnItemClickListener itemClickListener,
                                      CustomerDismissListener dismissListener) {
        showFilterPopupWindow(parentView, itemTexts, itemClickListener, dismissListener, <span class="hljs-number">0</span>);
    }

    <span class="hljs-javadoc">/**
     * 列表选择popupWindow
     *
     *<span class="hljs-javadoctag"> @param</span> parentView        父View
     *<span class="hljs-javadoctag"> @param</span> itemTexts         列表项文本集合
     *<span class="hljs-javadoctag"> @param</span> itemClickListener 列表项点击事件
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showFilterPopupWindow</span>(View parentView,
                                      List&lt;String&gt; itemTexts,
                                      AdapterView.OnItemClickListener itemClickListener,
                                      CustomerDismissListener dismissListener, <span class="hljs-keyword">float</span> alpha) {

        <span class="hljs-comment">// 判断当前是否显示</span>
        <span class="hljs-keyword">if</span> (mPopupWindow != <span class="hljs-keyword">null</span> &amp;&amp; mPopupWindow.isShowing()) {
            mPopupWindow.dismiss();
            mPopupWindow = <span class="hljs-keyword">null</span>;
        }
        mPopupWindow = <span class="hljs-keyword">new</span> CommonFilterPop(activity, itemTexts);
        mPopupWindow.setOnDismissListener(dismissListener);
        <span class="hljs-comment">// 绑定筛选点击事件</span>
        mPopupWindow.setOnItemSelectedListener(itemClickListener);
        <span class="hljs-comment">// 如果透明度设置为0的话,则默认设置为0.6f</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> == alpha) {
            alpha = <span class="hljs-number">0.6</span>f;
        }
        <span class="hljs-comment">// 设置背景透明度</span>
        WindowManager.LayoutParams lp = activity.getWindow().getAttributes();
        lp.alpha = alpha;
        activity.getWindow().setAttributes(lp);
        <span class="hljs-comment">// 显示pop</span>
        mPopupWindow.showAsDropDown(parentView);

    }

    <span class="hljs-javadoc">/**
     * Tab筛选栏切换
     *
     *<span class="hljs-javadoctag"> @param</span> isChecked         选中状态
     *<span class="hljs-javadoctag"> @param</span> showView          展示pop的跟布局
     *<span class="hljs-javadoctag"> @param</span> showMes           展示选择的数据
     *<span class="hljs-javadoctag"> @param</span> itemClickListener 点击回调
     *<span class="hljs-javadoctag"> @param</span> tabs              所有的cb(需要几个输入几个就可以,cb1,cb2....)
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">filterTabToggle</span>(<span class="hljs-keyword">boolean</span> isChecked, View showView, List&lt;String&gt; showMes, AdapterView.OnItemClickListener itemClickListener, <span class="hljs-keyword">final</span> CheckBox... tabs) {
        <span class="hljs-keyword">if</span> (isChecked) {
            <span class="hljs-keyword">if</span> (tabs.length &lt;= <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-comment">// 第一个checkBox为当前点击选中的cb,其他cb进行setChecked(false);</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; tabs.length; i++) {
                tabs[i].setChecked(<span class="hljs-keyword">false</span>);
            }

            showFilterPopupWindow(showView, showMes, itemClickListener, <span class="hljs-keyword">new</span> CustomerDismissListener() {
                <span class="hljs-annotation">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDismiss</span>() {
                    <span class="hljs-keyword">super</span>.onDismiss();
                    <span class="hljs-comment">// 当pop消失时对第一个cb进行.setChecked(false)操作</span>
                    tabs[<span class="hljs-number">0</span>].setChecked(<span class="hljs-keyword">false</span>);
                }
            });
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 关闭checkBox时直接隐藏popuwindow</span>
            hidePopListView();
        }
    }

    <span class="hljs-javadoc">/**
     * Tab筛选栏切换
     *
     *<span class="hljs-javadoctag"> @param</span> isChecked         选中状态
     *<span class="hljs-javadoctag"> @param</span> showView          展示pop的跟布局
     *<span class="hljs-javadoctag"> @param</span> showMes           展示选择的数据源
     *<span class="hljs-javadoctag"> @param</span> itemClickListener 点击回调
     *<span class="hljs-javadoctag"> @param</span> tabs              所有的cb(需要几个输入几个就可以,cb1,cb2....)
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">filterTabToggleT</span>(<span class="hljs-keyword">boolean</span> isChecked, View showView, List&lt;? extends BaseFilter&gt; showMes, AdapterView.OnItemClickListener itemClickListener, <span class="hljs-keyword">final</span> CheckBox... tabs) {
        <span class="hljs-keyword">if</span> (isChecked) {
            <span class="hljs-keyword">if</span> (tabs.length &lt;= <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-comment">// 第一个checkBox为当前点击选中的cb,其他cb进行setChecked(false);</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; tabs.length; i++) {
                tabs[i].setChecked(<span class="hljs-keyword">false</span>);
            }
            <span class="hljs-comment">// 从数据源中提取出展示的筛选条件</span>
            List&lt;String&gt; showStr = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
            <span class="hljs-keyword">for</span> (BaseFilter baseFilter : showMes) {
                showStr.add(baseFilter.getFilterStr());
            }
            showFilterPopupWindow(showView, showStr, itemClickListener, <span class="hljs-keyword">new</span> CustomerDismissListener() {
                <span class="hljs-annotation">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDismiss</span>() {
                    <span class="hljs-keyword">super</span>.onDismiss();
                    <span class="hljs-comment">// 当pop消失时对第一个cb进行.setChecked(false)操作</span>
                    tabs[<span class="hljs-number">0</span>].setChecked(<span class="hljs-keyword">false</span>);
                }
            });
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 关闭checkBox时直接隐藏popuwindow</span>
            hidePopListView();
        }
    }

    <span class="hljs-javadoc">/**
     * 自定义OnDismissListener
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerDismissListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">PopupWindow</span>.<span class="hljs-title">OnDismissListener</span> {<!-- --></span>
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDismiss</span>() {
            <span class="hljs-comment">// 当pop消失的时候,重置背景色透明度</span>
            WindowManager.LayoutParams lp = activity.getWindow().getAttributes();
            lp.alpha = <span class="hljs-number">1.0</span>f;
            activity.getWindow().setAttributes(lp);
        }
    }

    <span class="hljs-javadoc">/**
     * 隐藏pop
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hidePopListView</span>() {
        <span class="hljs-comment">// 判断当前是否显示,如果显示则dismiss</span>
        <span class="hljs-keyword">if</span> (mPopupWindow != <span class="hljs-keyword">null</span> &amp;&amp; mPopupWindow.isShowing()) {
            mPopupWindow.dismiss();
            mPopupWindow = <span class="hljs-keyword">null</span>;
        }
    }
}</code></pre> 
<hr> 
<p><a href="http://download.csdn.net/detail/u013904672/9689972">源码地址</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f4affefe61f31a574e4d1b71229941d2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JavaScript for循环中使用Ajax发送请求</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6f71690ae1c853e0e727fefe83a7d145/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一步一步开始FPGA逻辑设计 - 高速接口之PCIe</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>