<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OSS云存储的权限控制、开放接口规范和错误响应以及SpringBoot整合OSS - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OSS云存储的权限控制、开放接口规范和错误响应以及SpringBoot整合OSS" />
<meta property="og:description" content="一、OSS云存储的权限控制 1、权限控制方式 针对存放在 Bucket 的 Object 的访问，OSS 提供了多种权限控制方式，包括 ACL、RAM Policy 和Bucket Policy。
ACL：OSS 为权限控制提供访问控制列表（ACL）。ACL是基于资源的授权策略，可授予 Bucket和 Object 访问权限。 可以在创建 Bucket 或上传 Object 时设置 ACL，也可以在创建 Bucket或上传Object 后的任意时间内修改 ACL。RAM Policy：RAM （Resource Access Management）是阿里云提供的资源访问控制服务。RAMPolicy 是基于用户的授权策略。Bucket Policy：Bucket Policy 是基于资源的授权策略。相比于 RAM Policy，Bucket Policy 操作简单，支持在控制台直接进行图形化配置。 2、ACL Bucket ACL
Bucket ACL是 Bucket 级别的权限访问控制。目前有三种访问权限：public-read-write，publicread 和 private，含义如下：
操作方式
Object ACL
Object ACL是Object 级别的权限访问控制。目前有四种访问权限：private、public-read、publicread-write、default。PutObjectACL 操作通过 Put 请求中的 x-oss-object-acl 头来设置，这个操作只有 Bucket Owner 有权限执行。
Object ACL 的四种访问权限含义如下：
操作方式和上面类似 参考官方文档即可
https://help.aliyun.com/document_detail/100676.html?spm=a2c4g.11186623.2.9.695b5a5bnz0mcm#concept-blw-yqm-2gb
3、RAM Policy RAM（Resource Access Management）是阿里云提供的资源访问控制服务，RAM Policy是基于用户的授权策略。使用RAM，您可以创建、管理RAM用户，并可以控制这些RAM用户对资源的操作权限。当您的企业存在多用户协同操作资源时，使用RAM可以让您避免与其他用户共享云账号密钥，按需为用户分配最小权限，管理更加方便，权限更加明确，信息更加安全。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/104dfdf5d419a2ec0f5386755e07ac74/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-23T09:33:55+08:00" />
<meta property="article:modified_time" content="2022-03-23T09:33:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OSS云存储的权限控制、开放接口规范和错误响应以及SpringBoot整合OSS</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="OSS_0"></a>一、OSS云存储的权限控制</h3> 
<h4><a id="1_1"></a>1、权限控制方式</h4> 
<p>针对存放在 Bucket 的 Object 的访问，OSS 提供了多种权限控制方式，包括 ACL、RAM Policy 和Bucket Policy。</p> 
<ul><li>ACL：OSS 为权限控制提供访问控制列表（ACL）。ACL是基于资源的授权策略，可授予 Bucket和 Object 访问权限。 可以在创建 Bucket 或上传 Object 时设置 ACL，也可以在创建 Bucket或上传Object 后的任意时间内修改 ACL。</li><li>RAM Policy：RAM （Resource Access Management）是阿里云提供的资源访问控制服务。RAMPolicy 是基于用户的授权策略。</li><li>Bucket Policy：Bucket Policy 是基于资源的授权策略。相比于 RAM Policy，Bucket Policy 操作简单，支持在控制台直接进行图形化配置。</li></ul> 
<h4><a id="2ACL_6"></a>2、ACL</h4> 
<ol><li> <p>Bucket ACL<br> Bucket ACL是 Bucket 级别的权限访问控制。目前有三种访问权限：public-read-write，publicread 和 private，含义如下：<br> <img src="https://images2.imgbox.com/be/f6/TpnhgZf5_o.png" alt="在这里插入图片描述"><br> 操作方式<br> <img src="https://images2.imgbox.com/ca/b7/i7QEC9lH_o.png" alt="在这里插入图片描述"></p> </li><li> <p>Object ACL<br> Object ACL是Object 级别的权限访问控制。目前有四种访问权限：private、public-read、publicread-write、default。PutObjectACL 操作通过 Put 请求中的 x-oss-object-acl 头来设置，这个操作只有 Bucket Owner 有权限执行。<br> Object ACL 的四种访问权限含义如下：<br> <img src="https://images2.imgbox.com/50/c2/yIMATeiI_o.png" alt="在这里插入图片描述"><br> 操作方式和上面类似 参考官方文档即可<br> https://help.aliyun.com/document_detail/100676.html?spm=a2c4g.11186623.2.9.695b5a5bnz0mcm#concept-blw-yqm-2gb</p> </li></ol> 
<h4><a id="3RAM_Policy_20"></a>3、RAM Policy</h4> 
<p>RAM（Resource Access Management）是阿里云提供的资源访问控制服务，RAM Policy是基于用户的授权策略。使用RAM，您可以创建、管理RAM用户，并可以控制这些RAM用户对资源的操作权限。当您的企业存在多用户协同操作资源时，使用RAM可以让您避免与其他用户共享云账号密钥，按需为用户分配最小权限，管理更加方便，权限更加明确，信息更加安全。</p> 
<p><img src="https://images2.imgbox.com/c1/11/VDo2dTsE_o.png" alt="在这里插入图片描述"></p> 
<p>注意</p> 
<ul><li>如果您选择使用RAM Policy，建议您通过官方工具RAM策略编辑器快速生成所需的RAM Policy。</li><li>RAM Policy操作比较复杂，强烈推荐您使用简单易用的图形化配置方式Bucket Policy。<br> https://help.aliyun.com/document_detail/102600.html?spm=a2c4g.11186623.6.693.143258f6f33HST</li></ul> 
<h4><a id="4Bucket_Policy_30"></a>4、Bucket Policy</h4> 
<p>Bucket Policy是基于资源的授权策略。相比于RAM Policy，Bucket Policy支持在控制台直接进行图形化配置操作，并且Bucket拥有者直接可以进行访问授权。</p> 
<p>Bucket Policy常见的应用场景如下：</p> 
<ul><li>向其他账号的RAM用户授权访问。<br> 您可以授予其他账号的RAM用户访问您的OSS资源的权限。</li><li>向匿名用户授予带特定IP条件限制的访问权限。<br> 某些场景下，您需要向匿名用户授予带IP限制的访问策略。例如，企业内部的机密文档，只允许在企业内部访问，不允许在其他区域访问。由于企业内部人员较多，如果针对每个人配置RAMPolicy，工作量非常大。此时，您可以基于Bucket Policy设置带IP限制的访问策略，从而高效方便地进行授权。</li></ul> 
<p>Bucket Policy的配置方法和教程视频请参见使用Bucket Policy授权其他用户访问OSS资源</p> 
<h3><a id="OSS___41"></a>二、OSS存储开放接口规范 和 错误响应</h3> 
<h4><a id="1_42"></a>1、开放接口规范</h4> 
<p>开发者在发送请求给 OSS 时，既可以使用 带签名认证的请求，也可以使用匿名访问。OSS提供的相关API接口如下<br> 关于Service操作<br> <img src="https://images2.imgbox.com/4d/df/WEf8NTma_o.png" alt="在这里插入图片描述"><br> 关于Bucket的操作<br> <img src="https://images2.imgbox.com/83/b3/yh3ogkGC_o.png" alt="在这里插入图片描述"></p> 
<p>关于Object的操作<br> <img src="https://images2.imgbox.com/d6/ba/VWVS3wYx_o.png" alt="在这里插入图片描述"></p> 
<p>关于Multipart Upload的操作<br> <img src="https://images2.imgbox.com/b1/b4/DXY8at8H_o.png" alt="在这里插入图片描述"><br> 跨域资源共享（CORS）<br> <img src="https://images2.imgbox.com/97/4c/DGszDZYu_o.png" alt="在这里插入图片描述"><br> 关于Live Channel的操作<br> <img src="https://images2.imgbox.com/f9/e5/WVPUz83v_o.png" alt="在这里插入图片描述"></p> 
<p>案例剖析<br> 从上面的请求中 挑选任意接口分析<br> createBucket 创建Bucket<br> putObject 上传Object<br> getObject 下载Object</p> 
<h4><a id="2OSS_64"></a>2、OSS云存储错误响应</h4> 
<p>当用户访问OSS出现错误时，OSS会返回给用户相应的错误码和错误信息，便于用户定位问题，并做出适当的处理</p> 
<ol><li>OSS的错误响应格式<br> 当用户访问OSS出错时，OSS会返回给用户一个合适的3xx，4xx或者5xx的HTTP状态码；以及一个application/xml格式的消息体。</li></ol> 
<p>错误响应的消息体例子：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Error</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>”http://doc.oss.aliyuncs.com”</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span><span class="token punctuation">&gt;</span></span>
		AccessDenied
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Code</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span><span class="token punctuation">&gt;</span></span>
		Query-string authentication requires the Signature, Expires and
		OSSAccessKeyId parameters
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RequestId</span><span class="token punctuation">&gt;</span></span>
		1D842BC5425544BB
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RequestId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HostId</span><span class="token punctuation">&gt;</span></span>
		oss.aliyuncs.com
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HostId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Error</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>所有错误的消息体中都包括以下几个元素：</p> 
<ul><li>Code：OSS返回给用户的错误码。</li><li>Message：OSS给出的详细错误信息。</li><li>RequestId：用于唯一标识该次请求的UUID；当你无法解决问题时，可以凭这个RequestId来请求OSS开发工程师的帮助。</li><li>HostId：用于标识访问的OSS集群（目前统一为oss.aliyuncs.com）</li></ul> 
<ol start="2"><li> <p>OSS的错误码<br> <img src="https://images2.imgbox.com/96/3e/3GZpjTub_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3b/2a/ybXtV7Xf_o.png" alt="在这里插入图片描述"></p> </li><li> <p>请求一个需要Referer字段的Object<br> https://xxx-imgs.oss-cn-beijing.aliyuncs.com/1.png</p> </li><li> <p>OSS参数不支持的操作<br> 如果在OSS合法的操作中，添加了OSS不支持的请求头参数（例如在PUT的时候，加入If-ModifiedSince参数），OSS会返回501 Not Implemented错误</p> </li></ol> 
<p>错误请求示例：</p> 
<pre><code>PUT /my-image.jpg HTTP/1.1
Host:oss-example. oss.aliyuncs.com
Date: Wed, 28 May 2011 22:32:00 GMT
If-Modified-Since: Wed, 06 Apr 2011 10:02:46 GMT
</code></pre> 
<p>返回示例：</p> 
<pre><code class="prism language-xml">501 Not Implemented
x-oss-request-id: 77E534EBF90372BE
Content-Type: application/xml
Transfer-Encoding: chunked
Date: Thu, 28 Apr 2011 08:03:07 GMT
Connection: close
Server: AliyunOSS


<span class="token prolog">&lt;?xml version="1.0" ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Error</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>”http://doc.oss.aliyuncs.com”</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span><span class="token punctuation">&gt;</span></span>
		NotImplemented
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Code</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span><span class="token punctuation">&gt;</span></span>
		A header you provided implies functionality that is not implemented.
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Header</span><span class="token punctuation">&gt;</span></span>
		If-Modified-Since
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Header</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RequestId</span><span class="token punctuation">&gt;</span></span>
		77E534EBF90372BE
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RequestId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HostId</span><span class="token punctuation">&gt;</span></span>
		oss.aliyuncs.com
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HostId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Error</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ol start="5"><li>OSS不支持的操作<br> 如果试图以OSS不支持的操作来访问某个资源，返回405 Method Not Allowed错误</li></ol> 
<p>错误请求示例：</p> 
<pre><code>abc / HTTP/1.1
Host:oss-example. oss.aliyuncs.com
Date: date
Authorization: signatureValue
</code></pre> 
<p>返回示例：</p> 
<pre><code class="prism language-xml">x-oss-request-id: 2403382433A2EDA8
Allow: GET, DELETE, HEAD, PUT
Content-Type: application/xml
Transfer-Encoding: chunked
Date: Thu, 31 Mar 2011 10:01:52 GMT
Server: AliyunOSS


<span class="token prolog">&lt;?xml version="1.0" ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Error</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>”http://doc.oss.aliyuncs.com”</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span><span class="token punctuation">&gt;</span></span>
		MethodNotAllowed
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Code</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Message</span><span class="token punctuation">&gt;</span></span>
		The specified method is not allowed against this resource.
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Message</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ResourceType</span><span class="token punctuation">&gt;</span></span>
		BUCKET
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ResourceType</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Method</span><span class="token punctuation">&gt;</span></span>
		abc
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Method</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RequestId</span><span class="token punctuation">&gt;</span></span>
		2403382433A2EDA8
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RequestId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HostId</span><span class="token punctuation">&gt;</span></span>
		oss.aliyuncs.com
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HostId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Error</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="OSS_188"></a>三、OSS云储存代码案例</h3> 
<h4><a id="1SpringBootOSS_189"></a>1、SpringBoot整合OSS上传</h4> 
<ol><li>需求描述<br> 使用SpringBoot完成上传图片</li><li>配置文件<br> pom.xml</li></ol> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>application.properties</p> 
<pre><code># Spring boot application
#server.servlet.context-path=/oss-server
server.port = 8999
#logging.level.root=DEBUG
</code></pre> 
<p>aliyun.properties</p> 
<pre><code>aliyun.endpoint=http://oss-cn-beijing.aliyuncs.com
aliyun.accessKeyId=xxxxx
aliyun.accessKeySecret=xxxxx
aliyun.bucketName=xxxxx
aliyun.urlPrefix=https://xxxxx.oss-cn-beijing.aliyuncs.com/
</code></pre> 
<ol start="3"><li>编码实现<br> AliyunConfig</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:aliyun.properties"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"aliyun"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliyunConfig</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span> <span class="token class-name">String</span> endpoint<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> accessKeyId<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> accessKeySecret<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> bucketName<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> urlPrefix<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">OSSClient</span> <span class="token function">oSSClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OSSClient</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>实体对象</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpLoadResult</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 文件唯一标识</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> uid<span class="token punctuation">;</span>
<span class="token comment">// 文件名</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token comment">// 状态有：uploading done error removed</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>
<span class="token comment">// 服务端响应内容，如：'{"status": "success"}'</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>FileUpLoadService</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUpLoadService</span> <span class="token punctuation">{<!-- --></span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">AliyunConfig</span> aliyunConfig<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">OSSClient</span> ossClient<span class="token punctuation">;</span>
	<span class="token comment">// 允许上传的格式</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> IMAGE_TYPE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token string">".bmp"</span><span class="token punctuation">,</span> <span class="token string">".jpg"</span><span class="token punctuation">,</span><span class="token string">".jpeg"</span><span class="token punctuation">,</span> <span class="token string">".gif"</span><span class="token punctuation">,</span> <span class="token string">".png"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">UpLoadResult</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> uploadFile<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 校验图片格式</span>
		<span class="token keyword">boolean</span> isLegal <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> type <span class="token operator">:</span> IMAGE_TYPE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">endsWithIgnoreCase</span><span class="token punctuation">(</span>uploadFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				isLegal <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> 
		<span class="token class-name">UpLoadResult</span> uploadResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UpLoadResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLegal<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			uploadResult<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> uploadResult<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> 
		<span class="token class-name">String</span> fileName <span class="token operator">=</span> uploadFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token function">getFilePath</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>aliyunConfig<span class="token punctuation">.</span><span class="token function">getBucketName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>filePath<span class="token punctuation">,</span> <span class="token keyword">new</span>
			<span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>uploadFile<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//上传失败</span>
			uploadResult<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> uploadResult<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> 
		uploadResult<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		uploadResult<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>aliyunConfig<span class="token punctuation">.</span><span class="token function">getUrlPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
		uploadResult<span class="token punctuation">.</span><span class="token function">setUid</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> uploadResult<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
	<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token class-name">String</span> sourceFileName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">DateTime</span> dateTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token string">"images/"</span> <span class="token operator">+</span> dateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"yyyy"</span><span class="token punctuation">)</span>
		<span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> dateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"MM"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span>
		<span class="token operator">+</span> dateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"dd"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"."</span> <span class="token operator">+</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substringAfterLast</span><span class="token punctuation">(</span>sourceFileName<span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>UpLoadController 控制器</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/pic"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpLoadController</span> <span class="token punctuation">{<!-- --></span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">FileUpLoadService</span> fileUpLoadService<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@ResponseBody</span>
	<span class="token keyword">public</span> <span class="token class-name">UpLoadResult</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> multipartFile<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fileUpLoadService<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>multipartFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2_321"></a>2、数据处理</h4> 
<ol><li>介绍<br> 阿里云OSS为在云上的数据打通了一个处理与使用的快速通道。通过简单的 RESTful 接口，可以在任何时间、任何地点、任何互联网设备上对存储在OSS中的数据进行分析处理。<br> 数据处理包含以下两种：</li></ol> 
<ul><li>阿里云OSS原生处理服务<br> 阿里云OSS原生处理服务包括图片处理和视频截帧，其中图片处理包括图片的缩略、剪裁、参数调节等。 OSS原生处理服务无需开通，默认集成在OSS中，创建完Bucket后即可使用。产生的数据处理费用直接在OSS上结算。</li><li>智能媒体管理服务<br> 阿里云OSS与智能媒体管理（IMM）深度结合，支持文档预览、文档格式转换、人脸识别、图片分析、二维码识别等丰富的数据分析处理操作。</li></ul> 
<ol start="2"><li>图片处理<br> 如何快速使用OSS图片处理服务。您可以通过三种方式处理图片：为图片URL添加参数进行单次处理、使用图片样式对不同图片进行相同处理，或使用OSS SDK对图片进行处理</li></ol> 
<p><img src="https://images2.imgbox.com/c3/74/Mmtx6Vv4_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>视频截祯<br> 注意事项<br> 当前仅支持对视频编码格式为H264的视频文件进行视频截帧。<br> OSS当前没有默认保存视频截帧的操作，视频截帧的图片需手动下载到本地。</li></ol> 
<p>参数说明<br> 操作名称：snapshot<br> <img src="https://images2.imgbox.com/31/3d/emdWJKSU_o.png" alt="在这里插入图片描述"><br> https://help.aliyun.com/document_detail/64555.html</p> 
<ol start="4"><li>音视频处理<br> 存储在OSS上的多媒体音视频数据，可以通过经济、弹性、高扩展的阿里云媒体转码服务，转换成适合在移动端、PC、TV上播放的格式。</li></ol> 
<p>媒体转码核心能力包括：</p> 
<ul><li>转换媒体格式，支持多平台播放。</li><li>保证相同画质质量的前提下，调整视频码率、提高视频压缩效率、减小文件体积，从而减少播放卡顿并节省存储空间和流量费用。</li><li>添加水印logo，突出品牌，增加产品识别度。</li><li>对视频进行剪辑/拼接等二次创作。</li><li>针对画质较差的视频，去除画面中的毛刺、马赛克等，修复为高清晰版本。![]imges\音视频处理.jpg)</li></ul> 
<p>https://help.aliyun.com/document_detail/65583.html</p> 
<ol start="5"><li>智能媒体管理（IMM）<br> 阿里云 OSS 能够与智能媒体管理（IMM）深度结合，支持文档预览、文档格式转换、人脸识别、图片分析、二维码识别等丰富的数据分析处理操作。下面介绍如何在 OSS 控制台中使用 IMM 的功能。</li></ol> 
<p>前提条件</p> 
<ul><li>要在 OSS 中使用 IMM 功能，您需要开通 IMM 服务并进行授权。有关开通服务及授权的详细步骤，请参见开通产品及创建项目中的前提条件部分。</li><li>如果您使用 RAM 子账号进行本文中的操作，需要同时开通对应存储空间的访问权限和AliyunIMMFullAccess 权限。</li><li>创建 IMM Project 及使用 IMM 功能会产生一定的费用，如果您不需要使用 IMM 的功能，请及时解绑 IMM。详细费用请参见计费说明。</li></ul> 
<h4><a id="3CDN______akmai_367"></a>3、CDN 加速 (阿里 网宿 微软 亚马逊 akmai)</h4> 
<p>对象存储OSS与阿里云CDN服务结合，可优化静态热点文件下载加速的场景（即同一地区大量用户同时下载同一个静态文件的场景）。您可以将OSS的存储空间（Bucket）作为源站，利用阿里云CDN将源内容发布到边缘节点。当大量终端用户重复访问同一文件时，可以直接从边缘节点获取已缓存的数据，提高访问的响应速度。</p> 
<p><img src="https://images2.imgbox.com/e9/a5/8hXQYj8G_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b56e55687a112015fb2e660cb32351fc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Go语言基础教程：遵从传统，从简单的Go示例开始</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1cf50330655efc6948057978fbfb6ecf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">函数式编程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>