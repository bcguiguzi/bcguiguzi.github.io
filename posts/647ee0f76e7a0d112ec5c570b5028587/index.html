<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>云发布的Docker部署文档 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="云发布的Docker部署文档" />
<meta property="og:description" content="云发布的Docker部署文档 文章目录 云发布的Docker部署文档1、服务器安装 Docker2、修改后端微服务的配置2.1 修改 MySQL 的配置2.2 修改 Redis 的配置2.3 修改 Nacos 的配置 3、生成微服务镜像4、拉取远程镜像5、生成前端镜像5.1 准备文件5.2 构建前端镜像 6、基于镜像生成并运行容器6.1 MySQL6.2 Redis6.3 Nacos6.4 三个后端微服务和网关服务6.5 前端服务 7、最终镜像和容器情况展示7.1 镜像展示7.2 容器展示 8、安全组设置9、访问本系统10、附录 1、服务器安装 Docker 我在华为云服务器上选择的系统是 CentOS 7，因此使用 yum 安装Docker ，并拉取OpenJDK的镜像。使用的是root账户。
sudo yum install -y yum-utils device-mapper-persistent-data lvm2 sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo sudo yum makecache fast sudo yum -y install docker-ce sudo service docker start docker pull openjdk:8 2、修改后端微服务的配置 2.1 修改 MySQL 的配置 原配置：
url: jdbc:mysql://localhost:3306/tp_music?serverTimezone=Asia/Shanghai&amp;useSSL=false 修改后的配置：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/647ee0f76e7a0d112ec5c570b5028587/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-18T21:04:36+08:00" />
<meta property="article:modified_time" content="2023-05-18T21:04:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">云发布的Docker部署文档</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Docker_0"></a>云发布的Docker部署文档</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Docker_0" rel="nofollow">云发布的Docker部署文档</a></li><li><ul><li><a href="#1_Docker_3" rel="nofollow">1、服务器安装 Docker</a></li><li><a href="#2_20" rel="nofollow">2、修改后端微服务的配置</a></li><li><ul><li><a href="#21__MySQL__21" rel="nofollow">2.1 修改 MySQL 的配置</a></li><li><a href="#22__Redis__36" rel="nofollow">2.2 修改 Redis 的配置</a></li><li><a href="#23__Nacos__53" rel="nofollow">2.3 修改 Nacos 的配置</a></li></ul> 
   </li><li><a href="#3_72" rel="nofollow">3、生成微服务镜像</a></li><li><a href="#4_95" rel="nofollow">4、拉取远程镜像</a></li><li><a href="#5_106" rel="nofollow">5、生成前端镜像</a></li><li><ul><li><a href="#51__107" rel="nofollow">5.1 准备文件</a></li><li><a href="#52__111" rel="nofollow">5.2 构建前端镜像</a></li></ul> 
   </li><li><a href="#6_120" rel="nofollow">6、基于镜像生成并运行容器</a></li><li><ul><li><a href="#61_MySQL_121" rel="nofollow">6.1 MySQL</a></li><li><a href="#62_Redis_129" rel="nofollow">6.2 Redis</a></li><li><a href="#63_Nacos_135" rel="nofollow">6.3 Nacos</a></li><li><a href="#64__141" rel="nofollow">6.4 三个后端微服务和网关服务</a></li><li><a href="#65__151" rel="nofollow">6.5 前端服务</a></li></ul> 
   </li><li><a href="#7_159" rel="nofollow">7、最终镜像和容器情况展示</a></li><li><ul><li><a href="#71__160" rel="nofollow">7.1 镜像展示</a></li><li><a href="#72__171" rel="nofollow">7.2 容器展示</a></li></ul> 
   </li><li><a href="#8_181" rel="nofollow">8、安全组设置</a></li><li><a href="#9_185" rel="nofollow">9、访问本系统</a></li><li><a href="#10_189" rel="nofollow">10、附录</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1_Docker_3"></a>1、服务器安装 Docker</h3> 
<p>我在华为云服务器上选择的系统是 CentOS 7，因此使用 yum 安装Docker ，并拉取OpenJDK的镜像。使用的是root账户。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2

<span class="token function">sudo</span> yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

<span class="token function">sudo</span> yum makecache fast
<span class="token function">sudo</span> yum -y <span class="token function">install</span> docker-ce

<span class="token function">sudo</span> <span class="token function">service</span> docker start

docker pull openjdk:8
</code></pre> 
<h3><a id="2_20"></a>2、修改后端微服务的配置</h3> 
<h4><a id="21__MySQL__21"></a>2.1 修改 MySQL 的配置</h4> 
<p>原配置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/tp_music<span class="token punctuation">?</span>serverTimezone=Asia/Shanghai<span class="token important">&amp;useSSL=false</span>
</code></pre> 
<p>修改后的配置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//mysql/tp_music<span class="token punctuation">?</span>serverTimezone=Asia/Shanghai<span class="token important">&amp;useSSL=false</span>
</code></pre> 
<p>其中，tp_music是自己要使用的数据库名。</p> 
<h4><a id="22__Redis__36"></a>2.2 修改 Redis 的配置</h4> 
<p>原配置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">redis</span> <span class="token punctuation">:</span>
	<span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
	<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
</code></pre> 
<p>修改后的配置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">redis</span><span class="token punctuation">:</span>
	<span class="token key atrule">host</span><span class="token punctuation">:</span> redis
</code></pre> 
<h4><a id="23__Nacos__53"></a>2.3 修改 Nacos 的配置</h4> 
<p>原配置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
</code></pre> 
<p>修改后的配置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span><span class="token number">8848</span>
</code></pre> 
<h3><a id="3_72"></a>3、生成微服务镜像</h3> 
<p>将三个后端微服务、一个Gateway网关服务与它们对应的 Dockerfile 文件分别放在一起，使用WinSCP文件上传工具上传到服务器后，在服务器上使用 Docker 镜像构建命令构建镜像。</p> 
<p>关于Dockerfile文件的具体写法，可以去看 <a href="https://blog.csdn.net/qq_42582489/article/details/129857756">虚拟机下Ubuntu系统的Docker部署</a> 的第三节对应部分</p> 
<p>接着分别进入四个文件夹中使用对应的命令构建镜像。注意，这里的文件夹地址是文件上传到服务器的具体地址，例如我这里是 ~/Music</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> ~/Music/User
docker build -t user <span class="token builtin class-name">.</span>

<span class="token builtin class-name">cd</span> ~/Music/Manage
docker build -t manage <span class="token builtin class-name">.</span>

<span class="token builtin class-name">cd</span> ~/Music/Apply
docker build -t apply <span class="token builtin class-name">.</span>

<span class="token builtin class-name">cd</span> ~/Music/Gateway
docker build -t gateway <span class="token builtin class-name">.</span>
</code></pre> 
<h3><a id="4_95"></a>4、拉取远程镜像</h3> 
<p>去 DockerHub 拉取 MySQL、Redis、Nacos 和 Nginx 的镜像。</p> 
<pre><code class="prism language-bash">docker pull mysql:5.7
docker pull redis
docker pull nacos/nacos-server:v2.1.2-slim
docker pull nginx
</code></pre> 
<h3><a id="5_106"></a>5、生成前端镜像</h3> 
<h4><a id="51__107"></a>5.1 准备文件</h4> 
<p>将 nginx 配置文件，前端打包的网页文件和 Dockerfile 放在一起，并上传到服务器上。同样地，上传的地址自己要记住。</p> 
<h4><a id="52__111"></a>5.2 构建前端镜像</h4> 
<p>在服务器上使用 Docker 镜像构建命令构建前端镜像。</p> 
<pre><code class="prism language-bash">docker build -t vue <span class="token builtin class-name">.</span>
docker build -t vue2 <span class="token builtin class-name">.</span>
</code></pre> 
<h3><a id="6_120"></a>6、基于镜像生成并运行容器</h3> 
<h4><a id="61_MySQL_121"></a>6.1 MySQL</h4> 
<p>Mysql容器生成之后，不要忘了还需要进行sql数据的导入</p> 
<pre><code class="prism language-bash">docker run -d -p <span class="token number">3306</span>:3306 --name mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> mysql:5.7
</code></pre> 
<h4><a id="62_Redis_129"></a>6.2 Redis</h4> 
<pre><code class="prism language-bash">docker run -d -p <span class="token number">6379</span>:6379 --name redis redis
</code></pre> 
<h4><a id="63_Nacos_135"></a>6.3 Nacos</h4> 
<pre><code class="prism language-bash">docker run -d -p <span class="token number">8848</span>:8848 --name nacos -e <span class="token assign-left variable">PREFER_HOST_MODE</span><span class="token operator">=</span>hostname -e <span class="token assign-left variable">MODE</span><span class="token operator">=</span>standalone nacos/nacos-server:v2.1.2-slim
</code></pre> 
<h4><a id="64__141"></a>6.4 三个后端微服务和网关服务</h4> 
<pre><code class="prism language-bash">docker run -d -p <span class="token number">8881</span>:8881 --name user --link mysql --link redis --link nacos user
docker run -d -p <span class="token number">8882</span>:8882 --name manage --link mysql --link redis --link nacos manage
docker run -d -p <span class="token number">8883</span>:8883 --name apply --link mysql --link redis --link nacos apply
docker run -d -p <span class="token number">8888</span>:8888 --name gateway --link redis --link nacos --link user --link manage --link apply gateway
</code></pre> 
<h4><a id="65__151"></a>6.5 前端服务</h4> 
<pre><code class="prism language-bash">docker run -d -p <span class="token number">80</span>:80 --name vue vue
docker run -d -p <span class="token number">81</span>:81 --name vue2 vue2
</code></pre> 
<h3><a id="7_159"></a>7、最终镜像和容器情况展示</h3> 
<h4><a id="71__160"></a>7.1 镜像展示</h4> 
<pre><code class="prism language-bash">docker images
</code></pre> 
<p><img src="https://images2.imgbox.com/93/07/mLrmYuWd_o.png" alt="1"></p> 
<p>其中 openjdk、mysql、redis、nacos/nacos-server、nginx、vue、vue2、user、manage、apply 和 gateway 为本项目的所有镜像。</p> 
<h4><a id="72__171"></a>7.2 容器展示</h4> 
<pre><code class="prism language-bash">docker <span class="token function">ps</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d8/0d/hKqNFCll_o.png" alt="2"></p> 
<p>图中所示九个容器即为本项目的所有容器。</p> 
<h3><a id="8_181"></a>8、安全组设置</h3> 
<p>我们需要去华为云服务器管理控制台设置安全组，将需要开放的端口打开，需要开放8848、3306、6379、8888、8881、8882、8883和80、81端口。<br> <img src="https://images2.imgbox.com/bf/2a/jn6w8hTJ_o.png" alt="3"></p> 
<h3><a id="9_185"></a>9、访问本系统</h3> 
<p>打开浏览器，输入 http://ip 即可访问本系统，其中ip为华为云服务器的公网ip地址。</p> 
<h3><a id="10_189"></a>10、附录</h3> 
<p>我们在 docker 中启动容器，肯定需要停止容器，附录简单介绍下 docker 容器的一些操作。</p> 
<p><strong>1、查看容器</strong></p> 
<p>该命令可以查看各个容器的名字，状态等信息。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查看正在运行镜像，不包括未运行镜像</span>
docker <span class="token function">ps</span>
<span class="token comment"># 查看所有运行镜像，包括未运行镜像</span>
docker <span class="token function">ps</span> -a
</code></pre> 
<p><strong>2、启动容器</strong></p> 
<p>启动容器有 run 和 start 两种，run是通过镜像生成容器并启动，start仅启动已经生成的容器。</p> 
<ul><li>-d 是设置容器以守护形式在后台运行，并且容器所运行的程序不能结束</li><li>-p 是设置端口，8881即为该容器的映射端口</li><li>–name是为容器指定一个名字</li></ul> 
<pre><code class="prism language-bash">docker run -d -p <span class="token number">8881</span>:8881 --name user
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># user是容器名</span>
docerk start user
</code></pre> 
<p><strong>3、停止容器</strong></p> 
<pre><code class="prism language-bash"><span class="token comment"># user是容器名</span>
docker stop user
</code></pre> 
<p><strong>4、强制结束容器</strong></p> 
<p>如果stop命令无法将容器停止运行，可以使用 kill 命令杀掉容器。</p> 
<pre><code class="prism language-bash"><span class="token comment"># user是容器名</span>
docker <span class="token function">kill</span> user
</code></pre> 
<p><strong>5、删除容器</strong></p> 
<p><strong>注意，正常删除容器前请一定要记得先使用stop命令使其停止运行。</strong> 加了 -f 是强制删除。</p> 
<pre><code class="prism language-bash"><span class="token comment"># user是容器名</span>
docker <span class="token function">rm</span> user
docker <span class="token function">rm</span> -f user
</code></pre> 
<p>删除镜像与删除容器类似，把镜像下的容器全部停止运行后可以直接使用 rmi 删除镜像，如果还有容器在运行，则要加 -f 强制删除镜像。</p> 
<pre><code class="prism language-bash"><span class="token comment"># apply是镜像名</span>
docker rmi apply
docker rmi -f apply
</code></pre> 
<p><strong>6、批量操作</strong></p> 
<pre><code class="prism language-bash"><span class="token comment"># start启动所有容器</span>
docker start <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -a -q<span class="token variable">)</span></span>
 
<span class="token comment"># stop停止所有容器</span>
docker stop <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -a -q<span class="token variable">)</span></span>
 
<span class="token comment"># remove删除所有容器</span>
docker <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -a -q<span class="token variable">)</span></span> 
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c817f8c2eb109edc2a5375855aee6797/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Requests-翻页请求实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3256b6467e698d3241e6492311d34deb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">前端(Vue)sha512加密、后端(Java)sha512加密后加盐实现完整流程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>