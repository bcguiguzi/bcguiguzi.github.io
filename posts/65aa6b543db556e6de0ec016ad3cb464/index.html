<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在 Shell 提示符中显示 Git 分支名称的方法 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在 Shell 提示符中显示 Git 分支名称的方法" />
<meta property="og:description" content="PS1介绍 PS1介绍
配置 获取branch名称 通过git branch获取（不推荐）
git branch --no-color 2&gt; /dev/null | sed -e &#39;/^[^*]/d&#39; -e &#39;s/* \(.*\)/(\1)/&#39; 通过.git/HEAD 获取（推荐）
vi .git/HEAD ############ ef: refs/heads/dev ############ 配置.bashrc vim ~/.bashrc ###################### #获取branch名称 find_git_branch () { local dir=. head until [ &#34;$dir&#34; -ef / ]; do if [ -f &#34;$dir/.git/HEAD&#34; ]; then head=$(&lt; &#34;$dir/.git/HEAD&#34;) if [[ $head = ref:\ refs/heads/* ]]; then git_branch=&#34;${head#*/*/}&#34; elif [[ $head != &#39;&#39; ]]; then git_branch=&#34;detached&#34; else git_branch=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/65aa6b543db556e6de0ec016ad3cb464/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-18T17:54:08+08:00" />
<meta property="article:modified_time" content="2017-07-18T17:54:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在 Shell 提示符中显示 Git 分支名称的方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="ps1介绍">PS1介绍</h2> 
<p><a href="http://blog.csdn.net/Webben/article/details/75314942" target="_blank" rel="noopener noreferrer">PS1介绍</a></p> 
<h2 id="配置">配置</h2> 
<h3 id="获取branch名称">获取branch名称</h3> 
<p>通过git branch获取（不推荐）</p> 
<pre class="prettyprint"><code class=" hljs lasso">git branch <span class="hljs-subst">--</span>no<span class="hljs-attribute">-color</span> <span class="hljs-number">2</span><span class="hljs-subst">&gt;</span> /dev/<span class="hljs-built_in">null</span> <span class="hljs-subst">|</span> sed <span class="hljs-attribute">-e</span> <span class="hljs-string">'/^[^*]/d'</span> <span class="hljs-attribute">-e</span> <span class="hljs-string">'s/* \(.*\)/(\1)/'</span></code></pre> 
<p>通过.git/HEAD 获取（推荐）</p> 
<pre class="prettyprint"><code class=" hljs vala">vi .git/HEAD
<span class="hljs-preprocessor">############</span>
ef: refs/heads/dev
<span class="hljs-preprocessor">############</span></code></pre> 
<h3 id="配置bashrc">配置.bashrc</h3> 
<pre class="prettyprint"><code class=" hljs bash">vim ~/.bashrc
<span class="hljs-comment">######################</span>
<span class="hljs-comment">#获取branch名称</span>
<span class="hljs-function"><span class="hljs-title">find_git_branch</span></span> () {
    local dir=. head
    until [ <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span> -ef / ]; <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> [ <span class="hljs-operator">-f</span> <span class="hljs-string">"<span class="hljs-variable">$dir</span>/.git/HEAD"</span> ]; <span class="hljs-keyword">then</span>
            head=$(&lt; <span class="hljs-string">"<span class="hljs-variable">$dir</span>/.git/HEAD"</span>)
                <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$head</span> = ref:\ refs/heads/* ]]; <span class="hljs-keyword">then</span>
                    git_branch=<span class="hljs-string">"<span class="hljs-variable">${head#*/*/}</span>"</span>
                <span class="hljs-keyword">elif</span> [[ <span class="hljs-variable">$head</span> != <span class="hljs-string">''</span> ]]; <span class="hljs-keyword">then</span>
                    git_branch=<span class="hljs-string">"detached"</span>
                <span class="hljs-keyword">else</span>
                    git_branch=<span class="hljs-string">"unknow"</span>
                <span class="hljs-keyword">fi</span>
                git_name_left=<span class="hljs-string">"git:("</span>
                git_name_right=<span class="hljs-string">")"</span>
                <span class="hljs-keyword">return</span>
            <span class="hljs-keyword">fi</span>
        dir=<span class="hljs-string">"../<span class="hljs-variable">$dir</span>"</span>
    <span class="hljs-keyword">done</span>
    git_branch=<span class="hljs-string">''</span>
    git_name_left=<span class="hljs-string">""</span>
    git_name_right=<span class="hljs-string">""</span>
}

<span class="hljs-comment">#将这个函数加入到 PROMPT_COMMAND 中，保证 Bash 在创建 prompt 之前调用这个函数取得分支名称：</span>
PROMPT_COMMAND=<span class="hljs-string">"find_git_branch; <span class="hljs-variable">$PROMPT_COMMAND</span>"</span>

<span class="hljs-comment">#颜色配置</span>
black=$<span class="hljs-string">'\[\e[1;30m\]'</span>
red=$<span class="hljs-string">'\[\e[1;31m\]'</span>
green=$<span class="hljs-string">'\[\e[1;32m\]'</span>
yellow=$<span class="hljs-string">'\[\e[1;33m\]'</span>
blue=$<span class="hljs-string">'\[\e[1;34m\]'</span>
magenta=$<span class="hljs-string">'\[\e[1;35m\]'</span>
cyan=$<span class="hljs-string">'\[\e[1;36m\]'</span>
white=$<span class="hljs-string">'\[\e[1;37m\]'</span>
normal=$<span class="hljs-string">'\[\e[m\]'</span>

<span class="hljs-comment">#配置PS1</span>
PS1=<span class="hljs-string">"<span class="hljs-variable">$green</span>➜ <span class="hljs-variable">$cyan</span>\W<span class="hljs-variable">$blue</span> \$git_name_left<span class="hljs-variable">$red</span>\$git_branch<span class="hljs-variable">$blue</span>\$git_name_right\$ <span class="hljs-variable">$normal</span>"</span>
<span class="hljs-comment">####################</span>

<span class="hljs-built_in">source</span> ~/.bashrc</code></pre> 
<p>Git仓库效果： <br> <img src="https://images2.imgbox.com/f5/74/ibz5x1Fa_o.png" alt="在 Shell 提示符中显示 Git 分支名称的方法" title=""></p> 
<p>非Git仓库效果 <br> <img src="https://images2.imgbox.com/91/3a/WrlgMjhE_o.png" alt="这里写图片描述" title=""></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d65fb7a291f1c52aa711c3b894ecaee2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">架构师之路-网络框架的搭建（高逼格）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3802c3c7e33e385356f4e39ab1ed3911/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">css3动画--小熊快跑</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>