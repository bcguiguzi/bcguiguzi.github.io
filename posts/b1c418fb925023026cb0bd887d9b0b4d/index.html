<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Go参数传递：值类型、引用类型和指针类型】 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Go参数传递：值类型、引用类型和指针类型】" />
<meta property="og:description" content="修改参数
func main() { p := person{name : &#34;zhangsan&#34;， age : 18} modifyPerson(p) fmt.Println(&#34;name:&#34;, p.name, &#34;age:&#34;, p.age) } func modifyPerson(p person) { p.name = &#34;lisi&#34; p.age = 19 } type person struct { name string age int } // 输出结果 name:zhangsan， age:18 // 发现结果没有被改变，我们改成指针类型试试呢？ modifyPerson(&amp;p) func modifyPerson(p *person){ p.name = &#34;lisi&#34; p.age = 19 } // 输出结果 name: lisi, age: 19 // 接收参数修改为指针参数，就可以满足需求了。 值类型
​ 上述示例中，定义的普通变量p是person类型的。在Go语言中，person是一个值类型，而&amp;p获取的指针是*person类型的，即指针类型。那么为什么值类型在参数传递中无法修改呢？ 要从内存讲起。
​ 变量的值是存储在内存中的，而内存都有一个编号，称为内存地址。所以要想修改内存中的数据，就要找到这个内存地址。我们来对比值类型变量在函数内外的内存地址，如下" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/b1c418fb925023026cb0bd887d9b0b4d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-18T10:52:06+08:00" />
<meta property="article:modified_time" content="2021-12-18T10:52:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Go参数传递：值类型、引用类型和指针类型】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>修改参数</strong></p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    p <span class="token operator">:=</span> person<span class="token punctuation">{<!-- --></span>name <span class="token punctuation">:</span> <span class="token string">"zhangsan"</span>， age <span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span>
    <span class="token function">modifyPerson</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"name:"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"age:"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">modifyPerson</span><span class="token punctuation">(</span>p person<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    p<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"lisi"</span>
    p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">19</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> person <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    name <span class="token builtin">string</span>
    age <span class="token builtin">int</span> 
<span class="token punctuation">}</span>

<span class="token comment">// 输出结果</span>
name<span class="token punctuation">:</span>zhangsan， age<span class="token punctuation">:</span><span class="token number">18</span>    <span class="token comment">// 发现结果没有被改变，我们改成指针类型试试呢？</span>


<span class="token function">modifyPerson</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function">modifyPerson</span><span class="token punctuation">(</span>p <span class="token operator">*</span>person<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	p<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"lisi"</span>
	p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">19</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输出结果</span>
name<span class="token punctuation">:</span> lisi<span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">19</span>   <span class="token comment">// 接收参数修改为指针参数，就可以满足需求了。</span>
</code></pre> 
<p><strong>值类型</strong></p> 
<p>​ 上述示例中，定义的普通变量p是person类型的。在Go语言中，<strong>person是一个值类型，而&amp;p获取的指针是*person类型的，即指针类型</strong>。那么为什么值类型在参数传递中无法修改呢？ 要从内存讲起。</p> 
<p>​ 变量的值是存储在内存中的，而内存都有一个编号，称为内存地址。所以要想修改内存中的数据，就要找到这个内存地址。我们来对比值类型变量在函数内外的内存地址，如下</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    p <span class="token operator">:=</span> person<span class="token punctuation">{<!-- --></span>name <span class="token punctuation">:</span> <span class="token string">"zhangsan"</span>， age <span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"main函数，p的内存地址："</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p<span class="token punctuation">)</span>
    <span class="token function">modifyPerson</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"name:"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"age:"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">modifyPerson</span><span class="token punctuation">(</span>p person<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"modifyPerson 函数p的内存地址："</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p<span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"lisi"</span>
    p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">19</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输出结果</span>
main函数，p的内存地址： <span class="token number">0x0000a3020</span>
modifyPerson 函数p的内存地址：<span class="token number">0x0000a3040</span>
name<span class="token punctuation">:</span>zhangsan<span class="token punctuation">,</span> age<span class="token punctuation">:</span><span class="token number">18</span>

<span class="token comment">// 我们发现内存地址不一样，意味着，在modifyPerson函数中修改的参数p和main函数中的变量p不是同一个，这就是为什么我们在modifyPerson函数中修改了参数p，但是在main函数中打印结果中没有修改的原因</span>
</code></pre> 
<p>​ 导致这种结果的原因是<strong>Go语言中函数传参都是值传递</strong>。值传递值得是传递原来数据的一份拷贝，而不是原来的数据本身。</p> 
<p><img src="https://images2.imgbox.com/cf/8a/wat5djkt_o.png" alt="image-20211217101053089"></p> 
<p>​ 调用modifyPerson函数传递变量p的时候，Go语言会拷贝一个p放在新的内存中，这样新的p的内存地址就和原来的不一样了，但是里面的值是一样的。即<strong>副本的意思</strong>，变量中的数据一样，但是内存地址不一样。</p> 
<pre><code>除了struct外，**浮点型、整型、字符串、布尔、数组，这些都是值类型**。
</code></pre> 
<p><strong>指针类型</strong></p> 
<p>​ 指针类型的变量保存的值就是数据对应的内存地址，所以在函数参数传递是传值的原则下，拷贝的值也是内存地址。</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    p <span class="token operator">:=</span> person<span class="token punctuation">{<!-- --></span>name <span class="token punctuation">:</span> <span class="token string">"zhangsan"</span>， age <span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"main函数，p的内存地址："</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p<span class="token punctuation">)</span>
    <span class="token function">modifyPerson</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">)</span>
    
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"name:"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"age:"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">modifyPerson</span><span class="token punctuation">(</span>p <span class="token operator">*</span>person<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"modifyPerson 函数p的内存地址："</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p<span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"lisi"</span>
    p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">19</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输出结果</span>
main函数，p的内存地址： <span class="token number">0x0000a3020</span>
modifyPerson 函数p的内存地址：<span class="token number">0x0000a3020</span>
name<span class="token punctuation">:</span>lisi<span class="token punctuation">,</span> age<span class="token punctuation">:</span><span class="token number">19</span>
</code></pre> 
<p>​ <strong>指针类型的参数是永远可以修改原数据的，因为在参数传递时，传递的是内存地址。</strong></p> 
<blockquote> 
 <p>提示： 值传递的是指针，即内存地址。通过内存地址可以找到元数据的那块内存，所以修改它也就等于修改了原数据。</p> 
</blockquote> 
<p><strong>引用类型</strong></p> 
<p>​ 引用类型，包括map、slice和chan。</p> 
<p>​ <strong>map</strong></p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    m <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    m<span class="token punctuation">[</span><span class="token string">"奔跑的蜗牛"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">18</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"age:"</span> <span class="token punctuation">:</span> m<span class="token punctuation">[</span><span class="token string">"奔跑的蜗牛"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token function">modifyMap</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"age:"</span> <span class="token punctuation">:</span> m<span class="token punctuation">[</span><span class="token string">"奔跑的蜗牛"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">modifyMap</span><span class="token punctuation">(</span>m <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    p<span class="token punctuation">[</span><span class="token string">"奔跑的蜗牛"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">19</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输出结果</span>
age<span class="token punctuation">:</span><span class="token number">18</span>
age<span class="token punctuation">:</span><span class="token number">19</span>

<span class="token comment">// 我们发现修改成功了。为什么没有使用指针，只是使用了map类型的参数，按照Go语言值传递原则，modifyMap函数中map是一个副本，为什么修改成功了呢？</span>
</code></pre> 
<p>​ 一切原因要从 <strong>make 这个Go语言內建的函数说起</strong>。在Go语言中，任何创建map的代码(不管是字面量还是make函数)最终调用的都是 <strong>runtime.makemap函数</strong>。</p> 
<blockquote> 
 <p>提示： 用字面量或者make函数的方式创建map，并转换成 makemap 函数的调用，这个转换是Go语言编译器自动帮我们做的。</p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">makmap</span><span class="token punctuation">(</span>t <span class="token operator">*</span>maptype<span class="token punctuation">,</span> hint <span class="token builtin">int</span><span class="token punctuation">,</span> h<span class="token operator">*</span>hmap<span class="token punctuation">)</span> <span class="token operator">*</span>hamp<span class="token punctuation">{<!-- --></span>
    
<span class="token punctuation">}</span>
</code></pre> 
<p>​ 从源码可以看出，Go语言的map类型本质上就是 *hmap，所以根据替换原则，<code>modifyMap(a map) 函数其实就是modifyMap(a *hmap)</code>。 这就和上面的指针类型的参数调用一样了，也就是通过map类型的参数可以修改原始数据的原因，因为本质上就是指针。</p> 
<p>​ 为了验证创建的map是一个指针，修改上述示例，</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    m <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    m<span class="token punctuation">[</span><span class="token string">"奔跑的蜗牛"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">18</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"age:"</span> <span class="token punctuation">:</span> m<span class="token punctuation">[</span><span class="token string">"奔跑的蜗牛"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"main函数内存地址："</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span>
    <span class="token function">modifyMap</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"age:"</span> <span class="token punctuation">:</span> m<span class="token punctuation">[</span><span class="token string">"奔跑的蜗牛"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">modifyMap</span><span class="token punctuation">(</span>m <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    p<span class="token punctuation">[</span><span class="token string">"奔跑的蜗牛"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">19</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"modifyMap函数内存地址："</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输出结果</span>
age<span class="token punctuation">:</span><span class="token number">18</span>
main函数内存地址：<span class="token number">0x000060170</span>
age<span class="token punctuation">:</span><span class="token number">19</span>
modifyMap函数内存地址：<span class="token number">0x000060170</span>

<span class="token comment">// 从输出结果看，内存地址一模一样，所以可以修改原始数据。而且在打印指针的时候，直接使用的是变量m和p，并没有用取地址符&amp;，因为他们本省就是指针，所以没必要在使用&amp;取地址了</span>
</code></pre> 
<p>​ Go语言通过make函数或字面量的包装为我们省去了指针的操作，让我们可以更容易的使用map。其实就是<strong>语法糖</strong>，这是编程界的老传统了。</p> 
<blockquote> 
 <p>注意： 这里的map可以理解为引用类型， 但是它本质是指针，只是可以叫做引用类型而已。在参数传递时，它还是值传递，并不是其他编程语言中所谓的引用传递。</p> 
</blockquote> 
<p><strong>chan</strong></p> 
<p>​ channel也可以理解为引用类型， 而它本质也是一个指针。</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">makechan</span><span class="token punctuation">(</span>t <span class="token operator">*</span>chantype<span class="token punctuation">,</span> size <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token operator">*</span>hchan<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">// 从源码可以看到，所创建的chan其实是个*hchan，所以它在参数传递中也和map一样</span>
</code></pre> 
<p>​ <strong>严格的说，Go语言没有引用类型</strong>，但是我们可以把map、chan称为引用类型，这样便于理解。除了map、chan外，Go语言中的函数、接口、slice切片都可以称为引用类型。</p> 
<p><strong>类型零值</strong></p> 
<p>​ 在Go语言中，定义变量要么通过声明、要么通过make和new函数，不一样的是make和new函数属于显示声明并初始化。如果我们声明的变量没有显示声明初始化，那么该变量的默认值就是对应类型的零值。</p> 
<table><thead><tr><th align="center">类型</th><th align="center">零值</th></tr></thead><tbody><tr><td align="center">数值类型(int、float)</td><td align="center">0</td></tr><tr><td align="center">bool</td><td align="center">false</td></tr><tr><td align="center">string</td><td align="center">“”（空字符串）</td></tr><tr><td align="center">struct</td><td align="center">内部字段零值</td></tr><tr><td align="center">slice</td><td align="center">nil</td></tr><tr><td align="center">map</td><td align="center">nil</td></tr><tr><td align="center">指针</td><td align="center">nil</td></tr><tr><td align="center">函数</td><td align="center">nil</td></tr><tr><td align="center">chan</td><td align="center">nil</td></tr><tr><td align="center">interface</td><td align="center">nil</td></tr></tbody></table> 
<p><strong>总结</strong>：在Go语言中，<strong>函数的参数传递只有值传递</strong>，而且传递的实参都是原始数据的一份拷贝。如果拷贝的内容是值类型的，那么在函数中无法修改原始数据，如果拷贝的内容是指针(或者可以理解为引用类型)，那么可以在函数中修改原始数据。</p> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/12007fd5eac4a3db4e7cb56eb1cba8e0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android 代码中动态设置字体大小-TextView.SetTextSize()</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c23fdde5068a35b8cbd49157f93e8b19/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java的Comparator升序降序的记法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>