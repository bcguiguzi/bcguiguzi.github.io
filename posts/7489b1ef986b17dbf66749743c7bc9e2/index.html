<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python数据分析入门笔记9——数据预处理案例综合练习（男篮女篮运动员） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python数据分析入门笔记9——数据预处理案例综合练习（男篮女篮运动员）" />
<meta property="og:description" content="系列文章目录 Python数据分析入门笔记1——学习前的准备
Python数据分析入门笔记2——pandas数据读取
Python数据分析入门笔记3——数据预处理之缺失值
Python数据分析入门笔记4——数据预处理之重复值
Python数据分析入门笔记5——数据预处理之异常值
Python数据分析入门笔记6——数据清理案例练习
Python数据分析入门笔记7——数据集成、变换与规约
Python数据分析入门笔记8——Pandas处理日期时间类型数据
Python数据分析入门笔记 系列文章目录前言预备知识： 一、任务说明1. 数据文件下载：2. 任务要求： 二、任务分析与预处理1. 数据分析流程2. 数据获取与初步处理（1）文件的读取——read_csv()和read_excel()（2）文件的合并——merge()（3）数据的筛选 3. 数据清理（1）检测与处理重复值——duplicated()和drop_duplicates()（2）处理缺失值，统一单位——fillna()（3）检测与处理异常值——3σ和箱型图 三、 任务执行：分析运动员数据1. 计算中国男篮、女篮运动员的平均身高与平均体重，保留一位小数2. 分析中国篮球运动员的年龄分布3. 计算中国篮球运动员的体质指数 总结 前言 前面学过了pandas数据清理、数据集成、数据变换和数据规约相关知识，今天用一个运动员基本信息的案例来练习删除重复值、填充缺失值、确认异常值、分组与聚合、轴向旋转和降采样等操作，以达到清理数据、整合数据、减少数据量、变换数据形式的目的。
预备知识： 一、任务说明 1. 数据文件下载： 运动员信息采集01.csv
运动员信息采集02.xlsx
运动员信息采集01.csv文件部分内容如下：
运动员信息采集02.xlsx
2. 任务要求： （1）计算中国男篮、女篮运动员的平均身高与平均体重。
（2）分析中国篮球运动员的年龄分布
（3）计算中国篮球运动员的体质指数
二、任务分析与预处理 1. 数据分析流程 在进行数据分析之前，必须事先对数据进行预处理。
2. 数据获取与初步处理 （1）文件的读取——read_csv()和read_excel() 首先读取这两个文件，由于文件中含有中文，因此读取csv文件时需要设置编码为‘gbk’。
代码如下：
import pandas as pd file_one=pd.read_csv(&#39;data/运动员信息采集01.csv&#39;,encoding=&#39;gbk&#39;) file_two=pd.read_excel(&#39;data/运动员信息采集02.xlsx&#39;) 报错说明——若读取csv的时候未设置中文编码，会报如下错误：
UnicodeDecodeError: ‘utf-8’ codec can’t decode byte 0xd6 in position 0: invalid continuation byte报错说明——若读取excel的时候，设置了encoding，会报如下错误：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/7489b1ef986b17dbf66749743c7bc9e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-30T10:09:54+08:00" />
<meta property="article:modified_time" content="2023-07-30T10:09:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python数据分析入门笔记9——数据预处理案例综合练习（男篮女篮运动员）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_2"></a>系列文章目录</h2> 
<font color="#999AAA"> </font> 
<hr color="#000000" size='1"'> 
<p><a href="https://editor.csdn.net/md/?articleId=122657779" rel="nofollow">Python数据分析入门笔记1——学习前的准备</a></p> 
<p><a href="https://editor.csdn.net/md/?articleId=122673616" rel="nofollow">Python数据分析入门笔记2——pandas数据读取</a></p> 
<p><a href="https://editor.csdn.net/md/?articleId=122676838" rel="nofollow">Python数据分析入门笔记3——数据预处理之缺失值</a></p> 
<p><a href="https://editor.csdn.net/md/?articleId=122676852" rel="nofollow">Python数据分析入门笔记4——数据预处理之重复值</a></p> 
<p><a href="https://editor.csdn.net/md/?articleId=122676867" rel="nofollow">Python数据分析入门笔记5——数据预处理之异常值</a></p> 
<p><a href="https://editor.csdn.net/md/?articleId=122766646" rel="nofollow">Python数据分析入门笔记6——数据清理案例练习</a></p> 
<p><a href="https://editor.csdn.net/md/?articleId=122766668" rel="nofollow">Python数据分析入门笔记7——数据集成、变换与规约</a></p> 
<p><a href="https://editor.csdn.net/md/?articleId=122766728" rel="nofollow">Python数据分析入门笔记8——Pandas处理日期时间类型数据</a><br> </p> 
<div class="toc"> 
 <h4>Python数据分析入门笔记</h4> 
 <ul><li><a href="#_2" rel="nofollow">系列文章目录</a></li><li><a href="#_27" rel="nofollow">前言</a></li><li><ul><li><a href="#_29" rel="nofollow">预备知识：</a></li></ul> 
  </li><li><a href="#_37" rel="nofollow">一、任务说明</a></li><li><ul><li><a href="#1__38" rel="nofollow">1. 数据文件下载：</a></li><li><a href="#2__45" rel="nofollow">2. 任务要求：</a></li></ul> 
  </li><li><a href="#_50" rel="nofollow">二、任务分析与预处理</a></li><li><ul><li><a href="#1__51" rel="nofollow">1. 数据分析流程</a></li><li><a href="#2__54" rel="nofollow">2. 数据获取与初步处理</a></li><li><ul><li><a href="#1read_csvread_excel_55" rel="nofollow">（1）文件的读取——read_csv()和read_excel()</a></li><li><a href="#2merge_70" rel="nofollow">（2）文件的合并——merge()</a></li><li><a href="#3_80" rel="nofollow">（3）数据的筛选</a></li></ul> 
   </li><li><a href="#3__97" rel="nofollow">3. 数据清理</a></li><li><ul><li><a href="#1duplicateddrop_duplicates_99" rel="nofollow">（1）检测与处理重复值——duplicated()和drop_duplicates()</a></li><li><a href="#2fillna_123" rel="nofollow">（2）处理缺失值，统一单位——fillna()</a></li><li><a href="#33_269" rel="nofollow">（3）检测与处理异常值——3σ和箱型图</a></li></ul> 
  </li></ul> 
  </li><li><a href="#__333" rel="nofollow">三、 任务执行：分析运动员数据</a></li><li><ul><li><a href="#1__334" rel="nofollow">1. 计算中国男篮、女篮运动员的平均身高与平均体重，保留一位小数</a></li><li><a href="#2__343" rel="nofollow">2. 分析中国篮球运动员的年龄分布</a></li><li><a href="#3__364" rel="nofollow">3. 计算中国篮球运动员的体质指数</a></li></ul> 
  </li><li><a href="#_439" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_27"></a>前言</h2> 
<p>前面学过了pandas数据清理、数据集成、数据变换和数据规约相关知识，今天用一个运动员基本信息的案例来练习删除重复值、填充缺失值、确认异常值、分组与聚合、轴向旋转和降采样等操作，以达到清理数据、整合数据、减少数据量、变换数据形式的目的。</p> 
<h3><a id="_29"></a>预备知识：</h3> 
<p><img src="https://images2.imgbox.com/32/60/lGtlUbUK_o.png" alt="在这里插入图片描述"></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_37"></a>一、任务说明</h2> 
<h3><a id="1__38"></a>1. 数据文件下载：</h3> 
<p><a href="https://download.csdn.net/download/akun1213/85387829">运动员信息采集01.csv</a><br> <a href="https://download.csdn.net/download/akun1213/85387837">运动员信息采集02.xlsx</a><br> 运动员信息采集01.csv文件部分内容如下：<br> <img src="https://images2.imgbox.com/7e/a9/hoPB6SBn_o.png" alt="“运动员信息采集01.csv”"><br> 运动员信息采集02.xlsx<br> <img src="https://images2.imgbox.com/8f/0c/2VS2oQcp_o.png" alt="运动员信息采集02.xlsx"></p> 
<h3><a id="2__45"></a>2. 任务要求：</h3> 
<p>（1）计算中国男篮、女篮运动员的平均身高与平均体重。<br> （2）分析中国篮球运动员的年龄分布<br> （3）计算中国篮球运动员的体质指数</p> 
<h2><a id="_50"></a>二、任务分析与预处理</h2> 
<h3><a id="1__51"></a>1. 数据分析流程</h3> 
<p>在进行数据分析之前，必须事先对数据进行预处理。<br> <img src="https://images2.imgbox.com/1f/92/xM6AcWvR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2__54"></a>2. 数据获取与初步处理</h3> 
<h4><a id="1read_csvread_excel_55"></a>（1）文件的读取——read_csv()和read_excel()</h4> 
<p>首先读取这两个文件，由于文件中含有中文，因此读取csv文件时需要设置编码为‘gbk’。<br> 代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
file_one<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'data/运动员信息采集01.csv'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'gbk'</span><span class="token punctuation">)</span>
file_two<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'data/运动员信息采集02.xlsx'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>报错说明——若读取csv的时候未设置中文编码，会报如下错误：<br> UnicodeDecodeError: ‘utf-8’ codec can’t decode byte 0xd6 in position 0: invalid continuation byte</li><li>报错说明——若读取excel的时候，设置了encoding，会报如下错误：<br> TypeError：read_excel() got an unexpected keyword argument ‘encoding’</li><li>一点疑问——读取中文必须gbk吗？为什么utf-8也不识别？read_excel方法中原来是有encoding参数的，取消掉以后如果再遇到编码问题要如何处理？</li></ul> 
<h4><a id="2merge_70"></a>（2）文件的合并——merge()</h4> 
<p>首先观察两个文件中的列索引，万幸的是，两张表中的列索引完全一致，也就是属性方面是匹配的，因此，我们可以直接进入数据集成环节。<br> 这个案例中的合并类似于两个班级表的合并，因此，主键合并可直接用merge方法，选用outer全外连接的方式，保留两张表中所有原始数据。<br> 代码如下：</p> 
<pre><code class="prism language-python">all_data<span class="token operator">=</span>pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>left<span class="token operator">=</span>file_one<span class="token punctuation">,</span>right<span class="token operator">=</span>file_two<span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'outer'</span><span class="token punctuation">)</span>
all_data
</code></pre> 
<p>合并后的数据如下:<br> <img src="https://images2.imgbox.com/6d/5a/qi2ITxci_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3_80"></a>（3）数据的筛选</h4> 
<p>由于题目要求对中国篮球运动员进行分析，因此需要根据国籍筛选一下，只保留国籍为中国的运动员。<br> 我又忘记怎么写了，先单独筛选国籍看看？<br> <img src="https://images2.imgbox.com/9d/0b/jqdo289K_o.png" alt="在这里插入图片描述"><br> 一堆布尔值，所以，我想要的应该是all_data中，布尔值为True的那些数据。<br> 完整代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># 筛选出国籍为中国的运动员</span>
all_data<span class="token operator">=</span>all_data<span class="token punctuation">[</span>all_data<span class="token punctuation">[</span><span class="token string">'国籍'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'中国'</span><span class="token punctuation">]</span>
<span class="token comment"># 查看DataFrame类对象的摘要，包括索引、各列数据类型、非空值数量、内存使用情况等</span>
all_data<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4b/c1/80BeuVRh_o.png" alt="在这里插入图片描述"><br> 观察输出结果可知，数据中后5列的非空值数量不等，说明可能存在缺失值、重复值等；所有列的数据类型均为Object型，因此后续需要先对部分列进行数据类型转换操作，之后才能计算要求的统计指标。<br> 进入下一步，数据清理。</p> 
<h3><a id="3__97"></a>3. 数据清理</h3> 
<p>在对数据进行分析之前，我们需要先解决前面发现的数据问题，包括重复值、缺失值和异常值的检测与处理，从而为后期分析工作提供高质量的数据。</p> 
<h4><a id="1duplicateddrop_duplicates_99"></a>（1）检测与处理重复值——duplicated()和drop_duplicates()</h4> 
<p><img src="https://images2.imgbox.com/60/0b/blP4vQ3g_o.png" alt="在这里插入图片描述"><br> 如图，执行all_data.duplicated()方法只能拿到一堆布尔值，True代表重复，False代表没重复，要想看到里面到底有哪些重复值，需要筛选all_data中检测值为True的项。</p> 
<p>因此，检测重复值的代码如下：</p> 
<pre><code class="prism language-python">all_data<span class="token punctuation">[</span>all_data<span class="token punctuation">.</span>duplicated<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">==</span><span class="token boolean">True</span><span class="token punctuation">]</span>
</code></pre> 
<p>找到以下五条重复值<br> <img src="https://images2.imgbox.com/e2/2f/m9m1jOLY_o.png" alt="在这里插入图片描述"><br> 调用drop_duplicates()方法删除重复值，ignore_index参数设置为True，删除重复值后重新设置索引，代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># 删除all_data中的重复值，并重新为每行数据设置索引</span>
all_data<span class="token operator">=</span>all_data<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
all_data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果如图：<br> <img src="https://images2.imgbox.com/0a/3a/u5DfgdXJ_o.png" alt="在这里插入图片描述"></p> 
<ul><li>常见错误：<br> <img src="https://images2.imgbox.com/3d/b3/Wx7RlWxY_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="2fillna_123"></a>（2）处理缺失值，统一单位——fillna()</h4> 
<p>由于本例只需要分析中国篮球运动员，因此需要进一步筛选项目为“篮球”的数据。</p> 
<pre><code class="prism language-python"><span class="token comment"># 筛选出项目为篮球的数据</span>
basketball_data <span class="token operator">=</span> all_data<span class="token punctuation">[</span>all_data<span class="token punctuation">[</span><span class="token string">'项目'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'篮球'</span><span class="token punctuation">]</span>
</code></pre> 
<p>运行结果部分数据如下：<br> <img src="https://images2.imgbox.com/de/6b/v6bOMJ3Z_o.png" alt="在这里插入图片描述"><br> ①处理“出生日期”列的缺失值<br> 单独查看“出生日期”列的数据，看是否有缺失？</p> 
<pre><code class="prism language-python"><span class="token comment"># 访问“出生日期”一列的数据</span>
basketball_data<span class="token punctuation">[</span><span class="token string">'出生日期'</span><span class="token punctuation">]</span>
</code></pre> 
<p>发现“出生日期”这一列没有缺失值，但包含“X年X月X日”、“X年X月”、“X年”和“X”等多种类型的数据。<br> 为保证“出生日期”一列数据的一致性，这里统一将数据修改为“X年”格式，代码如下（虽然要素过多，但研究了半小时后我顿悟了，所以不要直接放弃，加油！）：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> datetime
<span class="token comment"># ?????这句我不懂</span>
basketball_data<span class="token operator">=</span>basketball_data<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 将以“X”显示的日期转换成以“X年X月X日”形式显示的日期</span>
<span class="token comment"># 小白碎碎念：这里的数字值“X”，比如32599、33757等，指的是与1900年1月1日相差的天数，这一句里的第一个datetime是模块名，第二个datetime是里面的对象，strptime是方法名，意为将基准日期转换为年月日的形式</span>
initial_time<span class="token operator">=</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span><span class="token string">'1900-01-01'</span><span class="token punctuation">,</span><span class="token string">'%Y-%M-%d'</span><span class="token punctuation">)</span>
<span class="token comment"># 访问“出生日期”一列的数据</span>
<span class="token comment"># 小白碎碎念：这个冒号很玄妙，loc[行号, 列号],行号这里的冒号代表全部，列号这里指定了“出生日期”，因此basketball_data.loc[:,'出生日期']取到的是“出生日期”这一列中的所有行的数据</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> basketball_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'出生日期'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
	<span class="token comment"># 只处理纯五位数字的日期，其他X年X月类似文本日期都跳过</span>
    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">int</span><span class="token punctuation">:</span>
    	<span class="token comment"># 基准日期加上偏移天数，再转换为XXXX年XX月XX日的形式，这里必须是大写的Y，如果小写的话输出格式会变成XX年，后面的.format是格式化输出，花括号里的y,m,d都是占位置用的，实际值是format中的值</span>
        new_time<span class="token operator">=</span><span class="token punctuation">(</span>initial_time<span class="token operator">+</span>datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y{y}%m{m}%d{d}'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token string">'年'</span><span class="token punctuation">,</span>m<span class="token operator">=</span><span class="token string">'月'</span><span class="token punctuation">,</span>d<span class="token operator">=</span><span class="token string">'日'</span><span class="token punctuation">)</span>
        <span class="token comment"># 调用replace函数，将原来的数字替换为转换好的新日期</span>
        basketball_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'出生日期'</span><span class="token punctuation">]</span><span class="token operator">=</span>basketball_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'出生日期'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>i<span class="token punctuation">,</span>new_time<span class="token punctuation">)</span>
<span class="token comment"># 为保证出生日期的一致性，这里统一使用只保留到年份的日期，lambda是一个特殊函数，x[:5]意为取前5个字符，即XXXX年</span>
basketball_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'出生日期'</span><span class="token punctuation">]</span><span class="token operator">=</span>basketball_data<span class="token punctuation">[</span><span class="token string">'出生日期'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 展示前10条出生日期数据</span>
basketball_data<span class="token punctuation">[</span><span class="token string">'出生日期'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre> 
<p>检验出生日期格式转换结果，运行如下：<br> <img src="https://images2.imgbox.com/a6/f6/SX7pW5bK_o.png" alt="在这里插入图片描述"><br> 到此出生日期转换完毕。</p> 
<p>②处理“身高”列的缺失值<br> “身高”一列存在多个缺失值，建议用填充缺失值——统计方法填充。由于男篮和女篮运动员体质不同，所以这里需要先以“性别”做区分，男性缺失值用男性的平均值填充，女性缺失值用女性的平均值填充。<br> 此处要素过多，待研究。</p> 
<pre><code class="prism language-python"><span class="token comment"># 筛选男篮运动员数据</span>
<span class="token comment"># male_data=basketball_data[basketball_data['性别']=='男']</span>
<span class="token comment"># 疑问1：为何要用lambda？</span>
male_data<span class="token operator">=</span>basketball_data<span class="token punctuation">[</span>basketball_data<span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token operator">==</span><span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment"># 疑问2：为什么要拷贝一下这个对象？用它本身不可以吗？</span>
male_data<span class="token operator">=</span>male_data<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 计算身高平均值（四舍五入取整）</span>
<span class="token comment"># 小白解读：计算平均身高前，要先删掉空值数</span>
male_height<span class="token operator">=</span>male_data<span class="token punctuation">[</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 小白解读：round方法是四舍五入，astype(int)是类型转换，mean()是求平均数</span>
fill_male_height<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>male_height<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 小白解读：上一步求出来的是小数，先强制转化成int整数，再转换成字符串型，才能在最后加上同为字符串类型的“厘米”单位</span>
fill_male_height <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>fill_male_height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'厘米'</span>
<span class="token comment"># 填充缺失值</span>
<span class="token comment"># 小白解读：将“身高”一列中，所有的缺失值都填充为男性身高平均值</span>
male_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token operator">=</span>male_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>fill_male_height<span class="token punctuation">)</span>
<span class="token comment"># 为方便后期使用，这里将身高数据转换为整数</span>
male_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token operator">=</span>male_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token comment"># 重命名列标签引用</span>
male_data<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'身高'</span><span class="token punctuation">:</span><span class="token string">'身高/cm'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
male_data
</code></pre> 
<p>接下来处理女篮数据</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy
<span class="token comment"># 筛选女篮运动员数据</span>
female_data<span class="token operator">=</span>basketball_data<span class="token punctuation">[</span>basketball_data<span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token operator">==</span><span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
female_data<span class="token operator">=</span>female_data<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 由于身高数据格式差异大，也没有现成工具，所以只能用字典手动处理</span>
data<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'191cm'</span><span class="token punctuation">:</span><span class="token string">'191厘米'</span><span class="token punctuation">,</span> <span class="token string">'1米89公分'</span><span class="token punctuation">:</span><span class="token string">'189厘米'</span><span class="token punctuation">,</span><span class="token string">'2.01米'</span><span class="token punctuation">:</span><span class="token string">'201厘米'</span><span class="token punctuation">,</span><span class="token string">'187公分'</span><span class="token punctuation">:</span><span class="token string">'187厘米'</span><span class="token punctuation">,</span><span class="token string">'1.97M'</span><span class="token punctuation">:</span><span class="token string">'197厘米'</span><span class="token punctuation">,</span><span class="token string">'1.98米'</span><span class="token punctuation">:</span><span class="token string">'198厘米'</span><span class="token punctuation">,</span><span class="token string">'192cm'</span><span class="token punctuation">:</span><span class="token string">'192厘米'</span><span class="token punctuation">}</span>
female_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token operator">=</span>female_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 计算女篮运动员平均身高</span>
female_height<span class="token operator">=</span>female_data<span class="token punctuation">[</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
fill_female_height<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>female_height<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 强制转换成整数，再转换成字符串，最后加上单位“厘米”</span>
fill_female_height<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>fill_female_height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'厘米'</span>
<span class="token comment"># 填充缺失值</span>
female_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token operator">=</span>female_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>fill_female_height<span class="token punctuation">)</span>
<span class="token comment"># 为方便后期使用，这里将身高数据转换为整数</span>
female_data<span class="token punctuation">[</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token operator">=</span>female_data<span class="token punctuation">[</span><span class="token string">'身高'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token comment"># 重命名列标签索引</span>
female_data<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'身高'</span><span class="token punctuation">:</span><span class="token string">'身高/cm'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
female_data
</code></pre> 
<p><img src="https://images2.imgbox.com/91/ce/TFM3EF0v_o.png" alt="在这里插入图片描述"></p> 
<p>③处理“体重”列的缺失值<br> 观察前面两次的输出结果，发现女篮运动员数据中“体重”一列存在缺失值，且该列中行索引为253的数据与其他行数据的单位不统一。</p> 
<ul><li>因此，这里先替换行索引为253的数据使之与其他数据具有相同的单位，代码如下：</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 先统一数据单位</span>
female_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'体重'</span><span class="token punctuation">]</span><span class="token operator">=</span>female_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'体重'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'88千克'</span><span class="token punctuation">:</span><span class="token string">'88kg'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
female_data
</code></pre> 
<p><img src="https://images2.imgbox.com/52/e8/LIfNWaqH_o.png" alt="在这里插入图片描述"></p> 
<ul><li>从数据可以看到，体重列存在NaN缺失值，252行还存在一个8kg的值明显也不符合实际，因此，直接用向前填充的方式替换，使之拥有与上一行相同的数值。</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 采用向前填充的方式，替换体重为8kg的值</span>
female_data<span class="token punctuation">[</span><span class="token string">'体重'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>to_replace<span class="token operator">=</span><span class="token string">'8kg'</span><span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">'pad'</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
female_data
</code></pre> 
<p><img src="https://images2.imgbox.com/69/d6/KaKzEfV8_o.png" alt="在这里插入图片描述"></p> 
<ul><li>接下来就可以处理缺失值NaN了。这里用正常体重数据的“平均值”来填充。<br> 还是熟悉的流程，先清除所有缺失值，再将数据类型转换为int型后计算平均体重，然后通过得到的平均体重填充缺失值，代码如下：</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 计算女篮运动员的平均体重——先清除缺失值，再转换数据类型，最后计算平均值</span>
female_weight<span class="token operator">=</span>female_data<span class="token punctuation">[</span><span class="token string">'体重'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># lambda x:x[0,-2]意为删掉最后两个字符，即去除单位，astype(int)意为将去除kg这个单位后的体重数据转换为整数类型</span>
female_weight<span class="token operator">=</span>female_weight<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token comment"># mean()意为求平均数，round代表四舍五入</span>
fill_female_weight<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>female_weight<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 将平均体重的小数点舍弃，只保留整数，转换为str字符串类型之后就可以把kg这个单位拼接回来了</span>
fill_female_weight<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>fill_female_weight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'kg'</span>
<span class="token comment"># 填充缺失值，inplace=True这句待消化。。。</span>
female_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token string">'体重'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>fill_female_weight<span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
female_data
</code></pre> 
<p>对比可知，248和250行的缺失数据已填充成功。<br> <img src="https://images2.imgbox.com/0c/0c/700d2HOI_o.png" alt="在这里插入图片描述"></p> 
<ul><li>最后合并男篮运动员和女篮运动员的数据，转换体重一列为int类型，并将该列的索引重命名为“体重/kg”</li></ul> 
<pre><code class="prism language-python">basketball_data<span class="token operator">=</span>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>male_data<span class="token punctuation">,</span>female_data<span class="token punctuation">]</span><span class="token punctuation">)</span>
basketball_data<span class="token punctuation">[</span><span class="token string">'体重'</span><span class="token punctuation">]</span><span class="token operator">=</span>basketball_data<span class="token punctuation">[</span><span class="token string">'体重'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
basketball_data<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'体重'</span><span class="token punctuation">:</span><span class="token string">'体重/kg'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
basketball_data
</code></pre> 
<p>体重列缺失值处理完后的完整数据如下图所示：<br> <img src="https://images2.imgbox.com/c5/72/hbb4slxo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/36/37/Q8jQjlns_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="33_269"></a>（3）检测与处理异常值——3σ和箱型图</h4> 
<p>为提高后期计算的准确性，需要对整租数据做异常值检测，这里通过箱型图和3σ原则两种方式分别检测“身高/cm”和“体重/kg”两列数据。</p> 
<ul><li>使用箱型图检测男篮运动员的身高数据</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token comment"># 设置中文显示</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>
<span class="token comment"># 使用箱型图检测男篮运动员“身高/cm”一列是否有异常值</span>
male_data<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'身高/cm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f1/99/z0RSkwV5_o.png" alt="在这里插入图片描述"></p> 
<ul><li>使用箱型图检测女篮运动员的身高数据</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 使用箱型图检测女篮运动员“身高/cm”一列是否有异常值</span>
female_data<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'身高/cm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/35/37/QGmhh1TV_o.png" alt="在这里插入图片描述"><br> 观察以上两个箱型图可知，女篮运动员的身高数据中存在一个小于170的值，经核实后确认该值为非异常值，可直接忽略。</p> 
<ul><li>使用3σ原则分别检测女篮和男篮运动员的体重数据</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment"># 定义基于3σ原则检测的函数</span>
<span class="token keyword">def</span> <span class="token function">three_sigma</span><span class="token punctuation">(</span>ser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 计算平均值</span>
    mean_data<span class="token operator">=</span>ser<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 计算标准差</span>
    std_data<span class="token operator">=</span>ser<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 数值小于μ-3σ或大于μ+3σ均为异常值</span>
    rule<span class="token operator">=</span><span class="token punctuation">(</span>mean_data<span class="token operator">-</span><span class="token number">3</span><span class="token operator">*</span>std_data<span class="token operator">&gt;</span>ser<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>mean_data<span class="token operator">+</span><span class="token number">3</span><span class="token operator">*</span>std_data<span class="token operator">&lt;</span>ser<span class="token punctuation">)</span>
    <span class="token comment"># 返回异常值的位置索引</span>
    <span class="token comment"># 这一句待研究，又忘了</span>
    index<span class="token operator">=</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>ser<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span>rule<span class="token punctuation">]</span>
    <span class="token comment"># 获取异常值</span>
    outliers<span class="token operator">=</span>ser<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">return</span> outliers

<span class="token comment"># 使用3σ原则检测女篮运动员的体重数据</span>
female_weight<span class="token operator">=</span>basketball_data<span class="token punctuation">[</span>basketball_data<span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'女'</span><span class="token punctuation">]</span>
three_sigma<span class="token punctuation">(</span>female_weight<span class="token punctuation">[</span><span class="token string">'体重/kg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9a/4c/FBBGT8C2_o.png" alt="在这里插入图片描述"><br> 再使用3σ原则检测男篮运动员的体重数据</p> 
<pre><code class="prism language-python"><span class="token comment"># 使用3σ原则检测男篮运动员的体重数据</span>
male_weight<span class="token operator">=</span>basketball_data<span class="token punctuation">[</span>basketball_data<span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'男'</span><span class="token punctuation">]</span>
three_sigma<span class="token punctuation">(</span>male_weight<span class="token punctuation">[</span><span class="token string">'体重/kg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fd/ad/69RLAjAR_o.png" alt="在这里插入图片描述"></p> 
<p>从两次输出结果可知，女篮运动员的体重数据中存在一个离群值，即行索引为249对应的值103，经核实后确认该离群值为非异常值，可直接忽略。</p> 
<blockquote> 
 <p>特别注意：缺失值是否要删除或填充，异常值是否要处理，都要视情况灵活而定</p> 
</blockquote> 
<h2><a id="__333"></a>三、 任务执行：分析运动员数据</h2> 
<h3><a id="1__334"></a>1. 计算中国男篮、女篮运动员的平均身高与平均体重，保留一位小数</h3> 
<p>方法提示：求平均mean()，分组groupby()，保留小数round()</p> 
<pre><code class="prism language-python"><span class="token comment"># 以“性别”一列分组，对各分组执行求平均值操作，并要求平均值保留一位小数</span>
basketball_data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'性别'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3c/0f/sCXwlsUO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2__343"></a>2. 分析中国篮球运动员的年龄分布</h3> 
<p>方法提示：</p> 
<ul><li>apply()和lambda根据出生年份计算年龄</li><li>plot()绘制直方图，及坐标轴标签和刻度的设置</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token comment"># 设置图中文字的字体为黑体</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>
<span class="token comment"># 根据出生日期计算年龄</span>
ages<span class="token operator">=</span><span class="token number">2022</span><span class="token operator">-</span>basketball_data<span class="token punctuation">[</span><span class="token string">'出生日期'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token comment"># 根据计算的年龄值绘制直方图</span>
ax<span class="token operator">=</span>ages<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'hist'</span><span class="token punctuation">)</span>
<span class="token comment"># 设置直方图中x轴、y轴的标签为“年龄（岁）”和“频数”</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'年龄(岁)'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'频数'</span><span class="token punctuation">)</span>
<span class="token comment"># 设置x轴的刻度为ages的最小值，ages的最小值+2，...，ages的最大值+1</span>
ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>ages<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ages<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e4/1b/vzoiQErO_o.png" alt="在这里插入图片描述"><br> 从图中可以看出，篮球运动员的年龄主要分布在21-37岁，其中年龄分布在26-29岁的运动员居多。</p> 
<h3><a id="3__364"></a>3. 计算中国篮球运动员的体质指数</h3> 
<p>体质指数（Body Mass Index，BMI）是国际上常用的度量体重与身高比例的工具，它利用体重与身高之间的比例来衡量一个人是否过瘦或过胖。体质指数的计算公式如下：<br> 体质指数（BMI）=体重（kg）÷ 身高²<br> 由于亚洲人和欧美人的体质存在一些差异，世界卫生组织制订了符合亚洲人的体质指数参考标准，具体如下表所示：</p> 
<table><thead><tr><th>体质指数</th><th>男性</th><th>女性</th></tr></thead><tbody><tr><td>过轻</td><td>低于20</td><td>低于19</td></tr><tr><td>正常</td><td>20~25</td><td>19~24</td></tr><tr><td>过重</td><td>25~30</td><td>24~29</td></tr><tr><td>肥胖</td><td>30~35</td><td>29~34</td></tr><tr><td>极度肥胖</td><td>高于35</td><td>高于34</td></tr></tbody></table> 
<p>接下来，根据篮球运动员的信息及体质指数公式，统计所有篮球运动员的体质指数。</p> 
<ul><li>首先，在basketball_data基础上增加“体质指数”一列，暂时设置该列的初始值为0。代码如下：</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 增加“体质指数”一列</span>
basketball_data<span class="token punctuation">[</span><span class="token string">'体质指数'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>
basketball_data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>然后，定义一个计算体质指数的函数，代码如下：</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 计算体质指数</span>
<span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">ath_bmi</span><span class="token punctuation">(</span>sum_bmi<span class="token punctuation">)</span><span class="token punctuation">:</span>
        weight<span class="token operator">=</span>basketball_data<span class="token punctuation">[</span><span class="token string">'体重/kg'</span><span class="token punctuation">]</span>
        height<span class="token operator">=</span>basketball_data<span class="token punctuation">[</span><span class="token string">'身高/cm'</span><span class="token punctuation">]</span>
        sum_bmi<span class="token operator">=</span>weight<span class="token operator">/</span><span class="token punctuation">(</span>height<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>
        <span class="token keyword">return</span> num<span class="token operator">+</span>sum_bmi
    <span class="token keyword">return</span> ath_bmi
</code></pre> 
<ul><li>最后，根据身高与体重数据计算每个篮球运动员的体质数据，并将所得的结果赋值给“体质指数”一列，代码如下：</li></ul> 
<pre><code class="prism language-python">basketball_data<span class="token punctuation">[</span><span class="token string">'体质指数'</span><span class="token punctuation">]</span><span class="token operator">=</span>basketball_data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'体质指数'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>outer<span class="token punctuation">(</span>basketball_data<span class="token punctuation">[</span><span class="token string">'体质指数'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
basketball_data
</code></pre> 
<p>部分数据如下：<br> <img src="https://images2.imgbox.com/72/f7/Ozk1dWdv_o.png" alt="在这里插入图片描述"></p> 
<ul><li>由于“体质指数”一列数据量比较大，无法直接看出哪些运动员的体质指数超过标准范围，因此这里分别将女篮和男篮运动员的体质指数与正常体质指数范围进行比较，凡是体质指数超出正常体质指数范围的篮球运动员均被视为体质指数为非正常的篮球运动员。代码如下：</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#首先按性别分组</span>
groupby_obj<span class="token operator">=</span>basketball_data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'性别'</span><span class="token punctuation">)</span>

<span class="token comment"># 以下为女篮运动员体质指数的统计，不在19~24范围内的都视为非正常</span>
<span class="token comment"># dict是字典，有key和value两个属性，此句用法尚待研究</span>
females<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> groupby_obj<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'女'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'体质指数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values
<span class="token comment"># 统计体质指数为非正常的女篮运动员的数量</span>
count<span class="token operator">=</span>females<span class="token punctuation">[</span>females<span class="token operator">&lt;</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token operator">+</span>females<span class="token punctuation">[</span>females<span class="token operator">&gt;</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">.</span>size
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'体质指数小于19：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>females<span class="token punctuation">[</span>females<span class="token operator">&lt;</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'体质指数大于24：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>females<span class="token punctuation">[</span>females<span class="token operator">&gt;</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'非正常体质指数范围的总人数：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>count<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token comment"># 以下为男篮运动员体质指数的统计，不在20~25范围内的都视为非正常</span>
males<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> groupby_obj<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'男'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'体质指数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values
<span class="token comment"># 统计体质指数为非正常的男篮运动员的数量</span>
count<span class="token operator">=</span>males<span class="token punctuation">[</span>males<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token operator">+</span>males<span class="token punctuation">[</span>males<span class="token operator">&gt;</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">.</span>size
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'体质指数小于20：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>males<span class="token punctuation">[</span>males<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'体质指数大于25：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>males<span class="token punctuation">[</span>males<span class="token operator">&gt;</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'非正常体质指数范围的总人数：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>count<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果如下：<br> <img src="https://images2.imgbox.com/ef/8b/DkhBlRz9_o.png" alt="在这里插入图片描述"><br> 从两次输出结果可以看出，个别篮球运动员的体质指数过高，其余大果树篮球运动员的体质指数正常。</p> 
<hr color="#000000" size='1"'> 
<h2><a id="_439"></a>总结</h2> 
<p>经过本案例练习，我发现数据分析思路不难，但数据切片、嵌套函数、格式化输出、apply和lambda的用法还非常生疏，阻挡我的不是pandas，而是Python基础。。。<br> 啥也不说了，慢慢学吧。。。</p> 
<p>参考资料：<br> 黑马程序员的《Python数据预处理》</p> 
<p>后记：本系列的所有案例基本都出自于这本书，教学案例经典接地气，顺利带我入了门，强推！<br> 而且还是系列化的教程，还有《Python数据可视化》等，针对性和系统性都比较强。不过学下来发现，Python基础的教材还是要买一本的，再配合B站上黑马程序员美女老师的教学视频，够学好几年啦！<br> 由于工作繁忙，专栏停更一年了，后续有时间还会更新的，祝各位友友心想事成，学啥会啥！与君共勉</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6acd3be9d8e6001e3333460859e0768/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JAVA Date 类型的对象，只想保留 “yyyy-MM-dd“ 格式的部分</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fbf32fa6646abc367def1418e5f26531/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">华为OD机试真题2022Q4 A &#43; 2023 B卷（Java）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>