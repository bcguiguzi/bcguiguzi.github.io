<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AndroidStudio 3.4.2配置 Opencv 3.7 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="AndroidStudio 3.4.2配置 Opencv 3.7" />
<meta property="og:description" content="文章目录 前言：1、前期准备2、 新建AS项目3、配置NDK4、复制opencv的相关文件5、配置build-gradle6、配置Cmake7、测试8 参考链接 前言： 前段时间做项目，需要给AS配置Opencv环境，查了很多博客，遇到了很多坑，为了避免遗忘，在此记录，如有错误，请指教。
1、前期准备 下载opencv androidSdk：https://opencv.org/releases/
这里网速太慢，我截个图示意一下，我之前下载的是3.7版本 2、 新建AS项目 这一步要注意，AS3.2版本的时候可以勾选include C&#43;&#43; Surpport,而AS3.4.2把 NativeC&#43;&#43;单独拿了出来，需要下拉右侧滑动条选择 Native C&#43;&#43;,我之前找这个找了半天?
3、配置NDK NDK需要手动配置，在刚刚新建好的项目中，选择 file —&gt;setting—&gt;Android SDK —&gt; SDK tools 勾选NDK和cmake
4、复制opencv的相关文件 include文件
将下载好的opencv安装包解压后在路径*\OpenCV-android-sdk\sdk\native\jni下有一个include文件夹，复制该文件夹到我们项目中的src/main/cpp下jni 文件
在项目的main文件夹下新建一个名为jniLibs的文件夹，然后在路径*\OpenCV-android-sdk\sdk\native下有一个libs文件夹，将此文件夹复制到刚刚新建的jniLibs文件夹下。项目结构如下图所示 5、配置build-gradle 在 app下的build-gradle中的android节点下添加以下代码
sourceSets { main { jniLibs.srcDirs = [&#39;src/main/jniLibs/libs&#39;] } } 此代码的作用就是设置动态链接库的地址,android节点是下图圈出的部分
然后在Android.defaultConfig.externalNativeBuild 的节点内增加过滤器，如下：
abiFilters &#39;x86&#39;, &#39;x86_64&#39;, &#39;armeabi&#39;, &#39;armeabi-v7a&#39;, &#39;arm64-v8a&#39;, &#39;mips&#39;, &#39;mips64&#39; 其中&#39;x86&#39;, &#39;x86_64&#39;, &#39;armeabi&#39;, &#39;armeabi-v7a&#39;, &#39;arm64-v8a&#39;, &#39;mips&#39;, &#39;mips64&#39;，选择一个就行，如果是在模拟器上开发就选择X86，如果在手机上选择armeabi-v7a，这一步要注意的是过滤器添加的位置不要弄错了，是添加在下图中上第一个圈出来的节点。
完整的build-gradle文件，如下
apply plugin: &#39;com.android.application&#39; android { compileSdkVersion 29 buildToolsVersion &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/b419e411382e384dbbc60fb3c4f0f81b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-30T21:30:47+08:00" />
<meta property="article:modified_time" content="2019-10-30T21:30:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AndroidStudio 3.4.2配置 Opencv 3.7</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言：</a></li><li><a href="#1_3" rel="nofollow">1、前期准备</a></li><li><a href="#2_AS_7" rel="nofollow">2、 新建AS项目</a></li><li><a href="#3NDK_12" rel="nofollow">3、配置NDK</a></li><li><a href="#4opencv_15" rel="nofollow">4、复制opencv的相关文件</a></li><li><a href="#5buildgradle_20" rel="nofollow">5、配置build-gradle</a></li><li><a href="#6Cmake_92" rel="nofollow">6、配置Cmake</a></li><li><a href="#7_121" rel="nofollow">7、测试</a></li><li><a href="#8__280" rel="nofollow">8 参考链接</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言：</h2> 
<p>前段时间做项目，需要给AS配置Opencv环境，查了很多博客，遇到了很多坑，为了避免遗忘，在此记录，如有错误，请指教。</p> 
<h2><a id="1_3"></a>1、前期准备</h2> 
<ul><li>下载opencv androidSdk：https://opencv.org/releases/<br> <img src="https://images2.imgbox.com/3d/9c/NvlD5jqr_o.png" alt="在这里插入图片描述"><br> 这里网速太慢，我截个图示意一下，我之前下载的是3.7版本</li></ul> 
<h2><a id="2_AS_7"></a>2、 新建AS项目</h2> 
<p>这一步要注意，AS3.2版本的时候可以勾选<em>include C++ Surpport</em>,而AS3.4.2把 NativeC++单独拿了出来，需要下拉右侧滑动条选择 <em>Native C++</em>,我之前找这个找了半天?<br> <img src="https://images2.imgbox.com/04/30/1mMF3VK8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/68/90/HWK9h4Nn_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/34/61/ktlOeuS0_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3NDK_12"></a>3、配置NDK</h2> 
<p>NDK需要手动配置，在刚刚新建好的项目中，选择 file —&gt;setting—&gt;Android SDK —&gt; SDK tools 勾选NDK和cmake<br> <img src="https://images2.imgbox.com/43/df/1wZqL03d_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4opencv_15"></a>4、复制opencv的相关文件</h2> 
<ul><li>include文件<br> 将下载好的opencv安装包解压后在路径<code>*\OpenCV-android-sdk\sdk\native\jni</code>下有一个<strong>include</strong>文件夹，复制该文件夹到我们项目中的<code>src/main/cpp</code>下</li><li>jni 文件<br> 在项目的main文件夹下新建一个名为<code>jniLibs</code>的文件夹，然后在路径<code>*\OpenCV-android-sdk\sdk\native</code>下有一个libs文件夹，将此文件夹复制到刚刚新建的<code>jniLibs</code>文件夹下。项目结构如下图所示<img src="https://images2.imgbox.com/33/9c/XPzOVYMC_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="5buildgradle_20"></a>5、配置build-gradle</h2> 
<p>在 <strong>app</strong>下的build-gradle中的<code>android</code>节点下添加以下代码</p> 
<pre><code class="prism language-java">sourceSets <span class="token punctuation">{<!-- --></span>
        main <span class="token punctuation">{<!-- --></span>
            jniLibs<span class="token punctuation">.</span>srcDirs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'src/main/jniLibs/libs'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>此代码的作用就是设置动态链接库的地址,<code>android</code>节点是下图圈出的部分<br> <img src="https://images2.imgbox.com/d6/67/AIYqvMoB_o.png" alt="在这里插入图片描述"><br> 然后在<code>Android.defaultConfig.externalNativeBuild</code> 的节点内增加过滤器，如下：</p> 
<pre><code class="prism language-java">abiFilters <span class="token string">'x86'</span><span class="token punctuation">,</span> <span class="token string">'x86_64'</span><span class="token punctuation">,</span> <span class="token string">'armeabi'</span><span class="token punctuation">,</span> <span class="token string">'armeabi-v7a'</span><span class="token punctuation">,</span> <span class="token string">'arm64-v8a'</span><span class="token punctuation">,</span> <span class="token string">'mips'</span><span class="token punctuation">,</span> <span class="token string">'mips64'</span>
</code></pre> 
<p>其中<code>'x86', 'x86_64', 'armeabi', 'armeabi-v7a', 'arm64-v8a', 'mips', 'mips64'</code>，选择一个就行，如果是在模拟器上开发就选择<code>X86</code>，如果在手机上选择<code>armeabi-v7a</code>，这一步要注意的是过滤器添加的位置不要弄错了，是添加在下图中上第一个圈出来的节点。<img src="https://images2.imgbox.com/21/23/fnwXRooU_o.png" alt="在这里插入图片描述"><br> 完整的build-gradle文件，如下</p> 
<pre><code class="prism language-java">apply plugin<span class="token operator">:</span> <span class="token string">'com.android.application'</span>

android <span class="token punctuation">{<!-- --></span>
    compileSdkVersion <span class="token number">29</span>
    buildToolsVersion <span class="token string">"29.0.1"</span>
    defaultConfig <span class="token punctuation">{<!-- --></span>
        applicationId <span class="token string">"com.example.opencvdemo"</span>
        minSdkVersion <span class="token number">23</span>
        targetSdkVersion <span class="token number">29</span>
        versionCode <span class="token number">1</span>
        versionName <span class="token string">"1.0"</span>
        testInstrumentationRunner <span class="token string">"androidx.test.runner.AndroidJUnitRunner"</span>
        externalNativeBuild <span class="token punctuation">{<!-- --></span>
            cmake <span class="token punctuation">{<!-- --></span>
                cppFlags <span class="token string">"-std=c++11"</span>
                abiFilters <span class="token string">'armeabi-v7a'</span>
            <span class="token punctuation">}</span>
            ndk <span class="token punctuation">{<!-- --></span>
                abiFilters <span class="token string">'armeabi-v7a'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    buildTypes <span class="token punctuation">{<!-- --></span>
        release <span class="token punctuation">{<!-- --></span>
            minifyEnabled <span class="token boolean">false</span>
            proguardFiles <span class="token function">getDefaultProguardFile</span><span class="token punctuation">(</span><span class="token string">'proguard-android-optimize.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'proguard-rules.pro'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    externalNativeBuild <span class="token punctuation">{<!-- --></span>
        cmake <span class="token punctuation">{<!-- --></span>
            path <span class="token string">"src/main/cpp/CMakeLists.txt"</span>
            version <span class="token string">"3.10.2"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    sourceSets <span class="token punctuation">{<!-- --></span>
        main <span class="token punctuation">{<!-- --></span>
            jniLibs<span class="token punctuation">.</span>srcDirs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'src/main/jniLibs/libs'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{<!-- --></span>
    implementation <span class="token function">fileTree</span><span class="token punctuation">(</span>dir<span class="token operator">:</span> <span class="token string">'libs'</span><span class="token punctuation">,</span> include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'*.jar'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    implementation <span class="token string">'androidx.appcompat:appcompat:1.1.0'</span>
    implementation <span class="token string">'androidx.constraintlayout:constraintlayout:1.1.3'</span>
    testImplementation <span class="token string">'junit:junit:4.12'</span>
    androidTestImplementation <span class="token string">'androidx.test:runner:1.2.0'</span>
    androidTestImplementation <span class="token string">'androidx.test.espresso:espresso-core:3.2.0'</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>配置完后，<code>Sysn Now</code>一下</p> 
<h2><a id="6Cmake_92"></a>6、配置Cmake</h2> 
<p>还记得之前项目结构中的<code>CMakeList.txt</code>文件吗？这里我们需要先把该文件移动到<code>app</code>文件夹下，这样方便之后配置<code>include文件夹</code>路径和动态链接库的路径，与此同时需要将<code>app</code>下build-gradle文件中<code>android.externalNativeBuild</code>节点下cmake的路径修改为<code>"CMakeLists.txt"</code>，即第二张图中 的<code>path</code>改为<code>path "CMakeLists.txt"</code><br> <img src="https://images2.imgbox.com/40/0b/e41053Ya_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fb/64/XwazyTjz_o.png" alt="在这里插入图片描述"><br> 在<code>CMakeLists.txt</code>文件中添加如下代码。</p> 
<pre><code class="prism language-java"># 设置include文件夹的地址
<span class="token function">include_directories</span><span class="token punctuation">(</span>$<span class="token punctuation">{<!-- --></span>CMAKE_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>src<span class="token operator">/</span>main<span class="token operator">/</span>cpp<span class="token operator">/</span>include<span class="token punctuation">)</span>

# 设置opencv的动态库
<span class="token function">add_library</span><span class="token punctuation">(</span>libopencv_java3 SHARED IMPORTED<span class="token punctuation">)</span>
<span class="token function">set_target_properties</span><span class="token punctuation">(</span>libopencv_java3 PROPERTIES IMPORTED_LOCATION
        $<span class="token punctuation">{<!-- --></span>CMAKE_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>src<span class="token operator">/</span>main<span class="token operator">/</span>jniLibs<span class="token operator">/</span>libs<span class="token operator">/</span>$<span class="token punctuation">{<!-- --></span>ANDROID_ABI<span class="token punctuation">}</span><span class="token operator">/</span>libopencv_java3<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token function">target_link_libraries</span><span class="token punctuation">(</span> # Specifies the target library<span class="token punctuation">.</span>
                       <span class="token keyword">native</span><span class="token operator">-</span>lib libopencv_java3

                       # Links the target library to the log library
                       # included in the NDK<span class="token punctuation">.</span>
                       $<span class="token punctuation">{<!-- --></span>log<span class="token operator">-</span>lib<span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre> 
<p><code>include_directories</code> 函数设置了include文件夹的路径<br> <code>add_library</code> 函数设置库名和类型，其中<code>libopencv_java3</code> 是用户自定义的变量名，前后保持一致即可，<code>SHARE</code> 表示引入的库是动态链接库<br> <code>set_target_properties</code> 设置了OpenCV的动态链接库的路径<br> <code>target_link_libraries</code> 具有依赖关系的动态库链接到指定目标上，链接顺序需符合gcc链接规则，这里我们把<code>libopencv_java3</code>和<code>log</code>链接到了native-lib上。</p> 
<h2><a id="7_121"></a>7、测试</h2> 
<p>经过上面一些列配置，opencv环境已经配置完成，可以编写代码进行测试.</p> 
<ul><li>native-lib</li></ul> 
<pre><code class="prism language-java">#include <span class="token generics function"><span class="token punctuation">&lt;</span>jni<span class="token punctuation">.</span>h<span class="token punctuation">&gt;</span></span>
#include<span class="token operator">&lt;</span>opencv2<span class="token operator">/</span>opencv<span class="token punctuation">.</span>hpp<span class="token operator">&gt;</span>
#include<span class="token generics function"><span class="token punctuation">&lt;</span>iostream<span class="token punctuation">&gt;</span></span>
using namespace cv<span class="token punctuation">;</span>
using namespace std<span class="token punctuation">;</span>

extern <span class="token string">"C"</span> JNIEXPORT jintArray

JNICALL
<span class="token function">Java_com_example_opencvdemo_MainActivity_Bitmap2Grey</span><span class="token punctuation">(</span>
        JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span>
        jobject <span class="token comment">/* this */</span><span class="token punctuation">,</span>jintArray buf<span class="token punctuation">,</span>jint w<span class="token punctuation">,</span>jint h<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    jint <span class="token operator">*</span>cbuf<span class="token punctuation">;</span>
    jboolean ptfalse <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    cbuf <span class="token operator">=</span> env<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">GetIntArrayElements</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ptfalse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>cbuf <span class="token operator">==</span> NULL<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Mat <span class="token function">imgData</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> CV_8UC4<span class="token punctuation">,</span> <span class="token punctuation">(</span>unsigned <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>cbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注意，Android的Bitmap是ARGB四通道,而不是RGB三通道</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>imgData<span class="token punctuation">,</span>imgData<span class="token punctuation">,</span>CV_BGRA2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>imgData<span class="token punctuation">,</span>imgData<span class="token punctuation">,</span>CV_GRAY2BGRA<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> size<span class="token operator">=</span>w <span class="token operator">*</span> h<span class="token punctuation">;</span>
    jintArray result <span class="token operator">=</span> env<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">NewIntArray</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    env<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetIntArrayRegion</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token punctuation">(</span>jint<span class="token operator">*</span><span class="token punctuation">)</span>imgData<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    env<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">ReleaseIntArrayElements</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> cbuf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>MainActivity</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>opencvdemo<span class="token punctuation">;</span>

<span class="token keyword">import</span> android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>Bitmap<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>BitmapFactory<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Bundle<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>View<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Button<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>ImageView<span class="token punctuation">;</span>

<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AppCompatActivity<span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">{<!-- --></span>

    <span class="token comment">// Used to load the 'native-lib' library on application startup.</span>
    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token string">"native-lib"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> Button btn_1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Button btn_2<span class="token punctuation">;</span>
    <span class="token keyword">private</span> ImageView imageView<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Bitmap bitmap<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>Bundle savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        btn_1 <span class="token operator">=</span> <span class="token punctuation">(</span>Button<span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        imageView <span class="token operator">=</span> <span class="token punctuation">(</span>ImageView<span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bitmap <span class="token operator">=</span> BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>flower<span class="token punctuation">)</span><span class="token punctuation">;</span>
        imageView<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        btn_1<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        btn_2 <span class="token operator">=</span> <span class="token punctuation">(</span>Button<span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        btn_2<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        bitmap <span class="token operator">=</span> BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>flower<span class="token punctuation">)</span><span class="token punctuation">;</span>
        imageView<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> w <span class="token operator">=</span> bitmap<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> h <span class="token operator">=</span> bitmap<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> piexls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span>w<span class="token operator">*</span>h<span class="token punctuation">]</span><span class="token punctuation">;</span>
        bitmap<span class="token punctuation">.</span><span class="token function">getPixels</span><span class="token punctuation">(</span>piexls<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> resultData <span class="token operator">=</span><span class="token function">Bitmap2Grey</span><span class="token punctuation">(</span>piexls<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Bitmap resultImage <span class="token operator">=</span> Bitmap<span class="token punctuation">.</span><span class="token function">createBitmap</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span>h<span class="token punctuation">,</span> Bitmap<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>ARGB_8888<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultImage<span class="token punctuation">.</span><span class="token function">setPixels</span><span class="token punctuation">(</span>resultData<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        imageView<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>resultImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span>View view<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_1<span class="token operator">:</span><span class="token function">showImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_2<span class="token operator">:</span><span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * A native method that is implemented by the 'native-lib' native library,
     * which is packaged with this application.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">Bitmap2Grey</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pixels<span class="token punctuation">,</span><span class="token keyword">int</span> w<span class="token punctuation">,</span><span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>activity_main.xml</li></ul> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>LinearLayout xmlns<span class="token operator">:</span>android<span class="token operator">=</span><span class="token string">"http://schemas.android.com/apk/res/android"</span>
    android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
    android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span>
    android<span class="token operator">:</span>orientation<span class="token operator">=</span><span class="token string">"vertical"</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>LinearLayout
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_weight<span class="token operator">=</span><span class="token string">"1"</span>
        android<span class="token operator">:</span>orientation<span class="token operator">=</span><span class="token string">"vertical"</span><span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>ImageView
            android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/image"</span>
            android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
            android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span>
            android<span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"@drawable/flower"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>LinearLayout<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>LinearLayout
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>orientation<span class="token operator">=</span><span class="token string">"horizontal"</span><span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>Button
            android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/button_2"</span>
            android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"0dp"</span>
            android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
            android<span class="token operator">:</span>layout_weight<span class="token operator">=</span><span class="token string">"1"</span>
            android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"灰度图"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>Button
            android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/button_1"</span>
            android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"0dp"</span>
            android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
            android<span class="token operator">:</span>layout_weight<span class="token operator">=</span><span class="token string">"1"</span>
            android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"色图"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>LinearLayout<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>LinearLayout<span class="token operator">&gt;</span>
</code></pre> 
<ul><li>效果<br> <img src="https://images2.imgbox.com/9c/7b/lhAy3mzv_o.gif" alt="在这里插入图片描述"></li></ul> 
<h2><a id="8__280"></a>8 参考链接</h2> 
<p>[1].<a href="https://blog.csdn.net/CV_Jason/article/details/79758823#21-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">Android NDK学习笔记：Android Studio3.1+CMAKE+OpenCV3.4配置</a><br> [2].<a href="https://www.jianshu.com/p/f789d535fbbf" rel="nofollow">AndroidStudio NDK之使用OpenCV</a><br> [3].<a href="https://blog.csdn.net/u011511601/article/details/80538356">Android Studio配置及使用OpenCV</a><br> [4].<a href="https://blog.csdn.net/u012328159/article/details/81094436">Android Studio中配置OpenCV</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c8bdab572a7809955c88a6b76a5e597e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决无法访问服务器IPV6地址的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d23dee3b746479ab0066543558b5b663/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ubuntu1804安装的自定义分区</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>