<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2021icpc上海m - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2021icpc上海m" />
<meta property="og:description" content="kruskal重构树套st表
#include&lt;cstdio&gt; #include&lt;algorithm&gt; #include&lt;cmath&gt; using namespace std; int st[200005][20],mx[200005][20],t; int val[200005]; int fa[200005]; int n,m,q; struct edge{ int u,v,w; bool operator &lt; (const edge &amp;A) const{return w &lt; A.w;} }e[100005]; const bool cmp (const edge &amp;a,const edge &amp;b) { return a.w&lt;b.w; } int get_f (int u) { if (fa[u]!=u) fa[u]=get_f(fa[u]); return fa[u]; } int qry (int ci,int cv) { for (int i=19;i&gt;=0;i--) if (st[ci][i] &amp;&amp; cv&gt;=mx[ci][i]) ci=st[ci][i]; return cv&#43;val[ci]; } void ins (int u,int v,int w) { if (u==v) return; t&#43;&#43;; fa[u]=fa[v]=t; val[t]=val[u]&#43;val[v]; mx[u][0]=w-val[u]; mx[v][0]=w-val[v]; st[u][0]=st[v][0]=t; } void build_st() { for (int i=1;i&lt;20;i&#43;&#43;) for (int j=1;j&lt;t;j&#43;&#43;) if (st[j][i-1]) { st[j][i]=st[st[j][i-1]][i-1]; mx[j][i]=max(mx[j][i-1],mx[st[j][i-1]][i-1]); } } int main() { scanf(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/1dc0676f3c33d8aa156bde34948aef23/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-03T18:45:35+08:00" />
<meta property="article:modified_time" content="2023-01-03T18:45:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2021icpc上海m</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="">kruskal重构树套st表</p> 
 <pre class="kdocs-c-like"><code class="language-c-like">#include&lt;cstdio&gt;
#include&lt;algorithm&gt;
#include&lt;cmath&gt;
using namespace std;
int st[200005][20],mx[200005][20],t;
int val[200005];
int fa[200005];
int n,m,q;
struct edge{
    int u,v,w;
    bool operator &lt; (const edge &amp;A) const{return w &lt; A.w;}    
}e[100005];
const bool cmp (const edge &amp;a,const edge &amp;b)
{
    return a.w&lt;b.w;
}
int get_f (int u)
{
    if (fa[u]!=u) fa[u]=get_f(fa[u]);
    return fa[u];
}
int qry (int ci,int cv)
{
    for (int i=19;i&gt;=0;i--)
        if (st[ci][i] &amp;&amp; cv&gt;=mx[ci][i])
            ci=st[ci][i];        
    return cv+val[ci];
}
void ins (int u,int v,int w)
{
    if (u==v) return;
    t++;
    fa[u]=fa[v]=t;
    val[t]=val[u]+val[v];
    mx[u][0]=w-val[u];
    mx[v][0]=w-val[v];
    st[u][0]=st[v][0]=t;
}
void build_st()
{
    for (int i=1;i&lt;20;i++)
        for (int j=1;j&lt;t;j++)
            if (st[j][i-1])
            {
                st[j][i]=st[st[j][i-1]][i-1];
                mx[j][i]=max(mx[j][i-1],mx[st[j][i-1]][i-1]);                
            }        
}
int main()
{
    scanf("%d %d %d",&amp;n,&amp;m,&amp;q);
    for (int i=1;i&lt;=n;i++) scanf("%d",&amp;val[i]);
    for (int i=1;i&lt;=(n&lt;&lt;1);i++) fa[i]=i;
    for (int i=1;i&lt;=m;i++) scanf("%d %d %d",&amp;e[i].u,&amp;e[i].v,&amp;e[i].w);
    sort(e+1,e+m+1);
    t=n;
    for (int i=1;i&lt;=m &amp;&amp; t&lt;(n&lt;&lt;1)-1;i++)
        ins(get_f(e[i].u),get_f(e[i].v),e[i].w);    
        
    build_st();
    
    while (q--)
    {
        int x,k;
        scanf("%d %d",&amp;x,&amp;k);
        printf("%d\n",qry(x,k));
    }
    return 0;
}</code></pre> 
 <p style="">一开始还MLE了</p> 
 <p style="">研究半天发现</p> 
 <pre class="kdocs-c-like"><code class="language-c-like">fa[++t]=t;</code></pre> 
 <p style="">这种写法不是很合法</p> 
 <p style="">C/C++语言标准没有规定运算符的操作数的计算顺序，编译器可以按任意顺序来计算操作数的值，因此如果一个变量在同一个运算符的两个操作数分别被修改或一个修改一个读取，其结果在不同的编译器上可能不一样的。以后不要写这种代码，讨论也没有意义。</p> 
 <p style="">From <a class="kdocs-link" style="color:#0A6CFF;" href="https://en.cppreference.com/w/c/language/eval_order" rel="nofollow noopener noreferrer" target="_blank">https://en.cppreference.com/w/c/language/eval_order</a></p> 
 <p style="">下次不乱玩++了</p> 
 <p style=""></p> 
 <p style="">错误示范：</p> 
 <pre class="kdocs-c-like"><code class="language-c-like">#include&lt;cstdio&gt;
#include&lt;algorithm&gt;
using namespace std;
int st[200005][20],mx[200005][20],t;
int val[200005];
int fa[200005];
int n,m,q;
struct edge{
    int u,v,w;
}e[100005];
bool cmp (const edge &amp;a,const edge &amp;b)
{
    return a.w&lt;b.w;
}
int get_f (int u)
{
    if (fa[u]!=u) fa[u]=get_f(fa[u]);
    return fa[u];
}
int qry (int ci,int cv)
{
    for (int i=19;i&gt;=0;i--)
        if (st[ci][i] &amp;&amp; cv&gt;=mx[ci][i])
            ci=st[ci][i];        
    return cv+val[ci];
}
void ins (int u,int v,int w)
{
    if (u==v) return;
    fa[++t]=t;
    fa[u]=fa[v]=t;
    val[t]=val[u]+val[v];
    mx[u][0]=w-val[u];
    mx[v][0]=w-val[v];
    st[u][0]=st[v][0]=t;
}
void build_st()
{
    for (int i=1;i&lt;20;i++)
        for (int j=1;j&lt;t;j++)
            if (st[j][i-1])
            {
                st[j][i]=st[st[j][i-1]][i-1];
                mx[j][i]=max(mx[j][i-1],mx[st[j][i-1]][i-1]);                
            }
}
int main()
{
    scanf("%d %d %d",&amp;n,&amp;m,&amp;q);
    for (int i=1;i&lt;=n;i++) scanf("%d",&amp;val[i]),fa[i]=i;
    for (int i=1;i&lt;=m;i++) scanf("%d %d %d",&amp;e[i].u,&amp;e[i].v,&amp;e[i].w);
    sort(e+1,e+n,cmp);
    t=n;
    for (int i=1;i&lt;=m;i++)
        ins(get_f(e[i].u),get_f(e[i].v),e[i].w);
    build_st();    
    while (q--)
    {
        int x,k;
        scanf("%d %d",&amp;x,&amp;k);
        printf("%d\n",qry(x,k));
    }
    return 0;
}</code></pre> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6ee8e22a08903aeebc1d29d70a32bd1e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">qt实现服务端连接多个客户端</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1f286fd58b9f8b04a67e66547bd230d8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">BGP在数据中心的应用4——BGP配置再优化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>