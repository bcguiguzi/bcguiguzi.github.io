<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Maven项目增量打包部署 基于Git Bash （前后端一体化项目） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Maven项目增量打包部署 基于Git Bash （前后端一体化项目）" />
<meta property="og:description" content="1.在Git项目的根目录，鼠标右键 Git Bash Here，打开Git Bash窗口 2.执行 ./git-package_.sh “2020-11-20 08:00:00” ， 日期为上次打包文件的日期 3. git-package_.sh 脚本如下（需要根据自身的 Tomcat 项目部署路径修改变量 web_dir 注意路径最后不要有 “/” ）： #!/bin/bash #首先获取待打包文件 git log --pretty=format:&#34;&#34; -$1 --name-only git_files=(`git log --pretty=format:&#34;&#34; --name-only --since=&#34;$1&#34; `); res_files=&#34;&#34;; repeat_files=(); ignore_files=( shopxx.xml shopxx.properties pom.xml ); # tomcat部署的项目路径 web_dir=&#34;/c/workspace/.metadata/.plugins/org.eclipse.wst.server.core/tmp0/wtpwebapps/shopxx-b2b2c&#34; work_dir=$PWD cd $web_dir #处理文件，找到需要打包的文件 for ss in ${git_files[@]}; do #去掉重复的文件: 采取如下遍历方案 for ss_repeat in ${repeat_files[@]}; do if [[ $ss_repeat == $ss ]] ; then echo &#34;重复:&#34;$ss; ss=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/28b58fd0f45d14d65ac3c437c4b124e3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-20T14:21:34+08:00" />
<meta property="article:modified_time" content="2020-11-20T14:21:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Maven项目增量打包部署 基于Git Bash （前后端一体化项目）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1Git_Git_Bash_HereGit_Bash_0"></a><strong>1.在Git项目的根目录，鼠标右键 Git Bash Here，打开Git Bash窗口</strong></h3> 
<p><img src="https://images2.imgbox.com/d5/c1/eJAk4HnH_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_gitpackage_sh_20201120_080000___4"></a><strong>2.执行 ./git-package_.sh “2020-11-20 08:00:00” ， 日期为上次打包文件的日期</strong></h3> 
<p><img src="https://images2.imgbox.com/76/61/megiK5gN_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_gitpackage_sh__Tomcat__web_dir____8"></a><strong>3. git-package_.sh 脚本如下（需要根据自身的 Tomcat 项目部署路径修改变量 <mark>web_dir</mark> 注意路径最后不要有 “/” ）：</strong></h3> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment">#首先获取待打包文件  git log --pretty=format:"" -$1 --name-only</span>
git_files<span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span><span class="token function">git</span> log --pretty<span class="token operator">=</span>format:<span class="token string">""</span> --name-only --since<span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span> <span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res_files<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
repeat_files<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ignore_files<span class="token operator">=</span><span class="token punctuation">(</span> shopxx.xml shopxx.properties pom.xml <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># tomcat部署的项目路径</span>
web_dir<span class="token operator">=</span><span class="token string">"/c/workspace/.metadata/.plugins/org.eclipse.wst.server.core/tmp0/wtpwebapps/shopxx-b2b2c"</span>
work_dir<span class="token operator">=</span><span class="token variable">$PWD</span>
<span class="token function">cd</span> <span class="token variable">$web_dir</span>

<span class="token comment">#处理文件，找到需要打包的文件</span>
<span class="token keyword">for</span> ss <span class="token keyword">in</span> <span class="token variable">${git_files[@]}</span><span class="token punctuation">;</span>
<span class="token keyword">do</span>

	<span class="token comment">#去掉重复的文件: 采取如下遍历方案</span>
	<span class="token keyword">for</span> ss_repeat <span class="token keyword">in</span> <span class="token variable">${repeat_files[@]}</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$ss_repeat</span> <span class="token operator">==</span> <span class="token variable">$ss</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token keyword">echo</span> <span class="token string">"重复:"</span><span class="token variable">$ss</span><span class="token punctuation">;</span> 
			ss<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">fi</span>
	<span class="token keyword">done</span><span class="token punctuation">;</span>
	repeat_files<span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">${repeat_files[@]}</span> <span class="token variable">$ss</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">#过滤掉不想打包的文件</span>
	<span class="token comment">#elif [[ $ss == */hibernate.properties ]] ;then ss="";</span>
	<span class="token comment">#过滤掉不想打包的文件</span>
    <span class="token keyword">for</span> ss_ignore <span class="token keyword">in</span> <span class="token variable">${ignore_files[@]}</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$ss</span> <span class="token operator">==</span> */<span class="token variable">$ss_ignore</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token comment">#echo "排除:"$ss; </span>
			ss<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">fi</span>
	<span class="token keyword">done</span><span class="token punctuation">;</span>
	
	<span class="token comment">#开始处理文件路径</span>
	<span class="token comment"># 页面文件（jsp、ftl、js、css、图片等等）</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$ss</span> <span class="token operator">==</span> src/main/webapp/* <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>
		ss<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token keyword">echo</span> $ss <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/^src\/main\/webapp\///g'</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
	<span class="token comment"># 系统配置文件</span>
	<span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$ss</span> <span class="token operator">==</span> src/main/resources/* <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>
		ss<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token keyword">echo</span> $ss <span class="token operator">|</span> <span class="token function">sed</span>  <span class="token string">'s/^src\/main\/resources/WEB-INF\/classes/g'</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
	<span class="token comment"># 后端Java文件</span>
	<span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$ss</span> <span class="token operator">==</span> src/main/java/* <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">;</span><span class="token keyword">then</span>
		ss_temp<span class="token operator">=</span>$<span class="token punctuation">{<!-- --></span>ss<span class="token comment">##*/};</span>
		ss_temp<span class="token operator">=</span>$<span class="token punctuation">{<!-- --></span>ss_temp/<span class="token string">".java"</span>/<span class="token string">"*.class"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
		ss_dir<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token keyword">echo</span> $ss <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/^src\/main\/java\///g'</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
		ss_dir<span class="token operator">=</span><span class="token variable">${ss_dir%/*}</span>
		ss<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
		<span class="token function">find</span> WEB-INF/classes/<span class="token variable">$ss_dir</span> -name <span class="token variable">$ss_temp</span> <span class="token operator">&gt;</span> git-package_.tmp<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token function">read</span> line<span class="token punctuation">;</span>
		<span class="token keyword">do</span>
			ss<span class="token operator">=</span><span class="token variable">$ss</span><span class="token string">" "</span><span class="token variable">$line</span><span class="token punctuation">;</span>
		<span class="token keyword">done</span> <span class="token operator">&lt;</span> git-package_.tmp<span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		ss<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
	<span class="token keyword">fi</span>

	res_files<span class="token operator">=</span><span class="token variable">$res_files</span><span class="token string">" "</span><span class="token variable">$ss</span><span class="token punctuation">;</span>
<span class="token keyword">done</span><span class="token punctuation">;</span>

<span class="token comment">#文件打包</span>
package_name<span class="token operator">=</span><span class="token string">"update_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%Y%m%d_%H%M%S<span class="token variable">`</span></span>.tar.gz"</span><span class="token punctuation">;</span>
<span class="token function">tar</span> -zcvf <span class="token variable">$package_name</span> <span class="token variable">$res_files</span><span class="token punctuation">;</span>
<span class="token comment"># zip $package_name $res_files;</span>

<span class="token function">mv</span> <span class="token variable">$web_dir</span><span class="token string">"/"</span><span class="token variable">$package_name</span> <span class="token variable">$work_dir</span>/<span class="token variable">$package_name</span>
<span class="token function">cd</span> <span class="token variable">$work_dir</span>

<span class="token keyword">echo</span> <span class="token variable">$package_name</span><span class="token punctuation">;</span>

</code></pre> 
<h3><a id="4Tomcat_89"></a><strong>4.Tomcat项目部署路径：</strong></h3> 
<p><img src="https://images2.imgbox.com/4b/26/udaZvJCH_o.png" alt="**在这里插入图片描述**"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/869c6604bd89411b31816837296db178/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java注意点</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/30b25d4ec9fcca1d003110459b6636f6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">NP管理器和MT哪个强_NP管理器2.7.6多功能文件管理器 媲美MT/功能更强大</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>