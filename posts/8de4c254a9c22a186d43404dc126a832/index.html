<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>NetPresenter一款基于retrofit2的轻量级无侵入的快速网络请求开发工具 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="NetPresenter一款基于retrofit2的轻量级无侵入的快速网络请求开发工具" />
<meta property="og:description" content="前言 ​ 最近项目不太忙,想着学点新东西,之前看Butterknife源码时接触了APT(Annotation Processing Tool 注解处理器 ),当时没深入研究,所以刚好学一学,看看能不能自己写一个实用的工具.
​ 其实对于Android日常开发项目来说,除了页面显示部分,剩下应该就是网络请求这块内容用的比较多了,当然提到网络请求,okhttp3.x &#43; retrofit2.x的网络请求框架基本就是标配了(还可以结合Rxjava处理异步操作).我的项目都是MVP架构,每次写一个网络请求都需要创建一套M,V,P,通过接口回调交换数据,相似代码和逻辑很多,但又不能省略,所以写了一个自动生成代理类的工具-NetPresenter. 简介 ​ NetPresenter是一款基于retrofit2的轻量级无侵入的快速网络请求开发工具,使用 apt技术自动生成网络代理层代码,减轻编码负担,加快编码速度.
使用方法: 第一步: 添加依赖
1.项目根目录中添加jitpack
allprojects { repositories { ... maven { url &#39;https://jitpack.io&#39; } } } 2.开发项目中添加
android { ... // java 1.8 compileOptions { sourceCompatibility JavaVersion.VERSION_1_8 targetCompatibility JavaVersion.VERSION_1_8 } } dependencies { implementation &#39;com.github.Dearyu:NetPresenter:1.2.0&#39; annotationProcessor &#39;com.github.Dearyu:NetPresenter:1.2.0&#39; } 第二步: 配置相关内容:
@NetBuilder:网络构建类,需实现INetBuilder接口,提供Retrofit实例,用于构建网络请求.
@NetUnit:网络单元类,需实现INetUnit接口,用于创建一个网络单元进行网络请求的相关操作.
@NetListener:网络回调类,需实现INetListener接口,用于处理网络响应的回调类.
在Github项目中的netpresenter-demo中提供了RxJava和retrofit2 Call的两种实现方式的例子
这里演示用RxJava配置的例子
1.NetBuilder:
@NetBuilder public class NetManager implements INetBuilder { public static final String BaseUrl = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/8de4c254a9c22a186d43404dc126a832/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-25T17:39:43+08:00" />
<meta property="article:modified_time" content="2021-03-25T17:39:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">NetPresenter一款基于retrofit2的轻量级无侵入的快速网络请求开发工具</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>前言</h3> 
<p>​ 最近项目不太忙,想着学点新东西,之前看Butterknife源码时接触了<strong>APT(Annotation Processing Tool 注解处理器 )</strong>,当时没深入研究,所以刚好学一学,看看能不能自己写一个实用的工具.</p> 
<p>​ 其实对于Android日常开发项目来说,除了页面显示部分,剩下应该就是网络请求这块内容用的比较多了,当然提到网络请求,okhttp3.x + retrofit2.x的网络请求框架基本就是标配了(还可以结合Rxjava处理异步操作).<strong><font color="red">我的项目都是MVP架构,每次写一个网络请求都需要创建一套M,V,P,通过接口回调交换数据,相似代码和逻辑很多,但又不能省略,所以写了一个自动生成代理类的工具-NetPresenter. </font></strong></p> 
<h3><a id="_6"></a>简介</h3> 
<p>​ NetPresenter是一款基于retrofit2的轻量级无侵入的快速网络请求开发工具,使用 apt技术自动生成网络代理层代码,减轻编码负担,加快编码速度.</p> 
<h3><a id="_10"></a>使用方法:</h3> 
<h5><a id="_12"></a>第一步:</h5> 
<p>添加依赖</p> 
<p>1.项目根目录中添加jitpack</p> 
<pre><code class="prism language-groovy">allprojects <span class="token punctuation">{<!-- --></span>
  repositories <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">...</span>
    maven <span class="token punctuation">{<!-- --></span> url <span class="token string">'https://jitpack.io'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>2.开发项目中添加</p> 
<pre><code class="prism language-groovy">android <span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">...</span>
  <span class="token comment">// java 1.8</span>
  compileOptions <span class="token punctuation">{<!-- --></span>
    sourceCompatibility JavaVersion<span class="token operator">.</span>VERSION_1_8
    targetCompatibility JavaVersion<span class="token operator">.</span>VERSION_1_8
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{<!-- --></span>
   implementation <span class="token string">'com.github.Dearyu:NetPresenter:1.2.0'</span>
   annotationProcessor <span class="token string">'com.github.Dearyu:NetPresenter:1.2.0'</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_45"></a>第二步:</h5> 
<p>配置相关内容:</p> 
<ul><li> <p><font color="red">@NetBuilder:网络构建类,需实现INetBuilder接口,提供Retrofit实例,用于构建网络请求.</font></p> </li><li> <p><font color="red">@NetUnit:网络单元类,需实现INetUnit接口,用于创建一个网络单元进行网络请求的相关操作.</font></p> </li><li> <p><font color="red">@NetListener:网络回调类,需实现INetListener接口,用于处理网络响应的回调类.</font></p> </li></ul> 
<p><strong>在<a href="https://github.com/Dearyu/NetPresenter">Github项目</a>中的netpresenter-demo中提供了RxJava和retrofit2 Call的两种实现方式的例子</strong></p> 
<p>这里演示用RxJava配置的例子</p> 
<p>1.NetBuilder:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@NetBuilder</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NetManager</span> <span class="token keyword">implements</span> <span class="token class-name">INetBuilder</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String BaseUrl <span class="token operator">=</span> <span class="token string">"http://0.0.0.0/"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Retrofit mRetrofit<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Retrofit <span class="token function">getBaseRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">==</span> mRetrofit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mRetrofit <span class="token operator">=</span> <span class="token function">getRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> mRetrofit<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Retrofit  Rxjava
     *
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Retrofit <span class="token function">getRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        OkHttpClient<span class="token punctuation">.</span>Builder builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OkHttpClient<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        HttpLoggingInterceptor httpLoggingInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpLoggingInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpLoggingInterceptor<span class="token punctuation">.</span><span class="token function">setLevel</span><span class="token punctuation">(</span>HttpLoggingInterceptor<span class="token punctuation">.</span>Level<span class="token punctuation">.</span>BODY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>httpLoggingInterceptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">connectTimeout</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Retrofit<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">client</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span>GsonConverterFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addCallAdapterFactory</span><span class="token punctuation">(</span>RxJava2CallAdapterFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> T <span class="token function">create</span><span class="token punctuation">(</span>Class<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">getBaseRetrofit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>2.NetUnit:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@NetUnit</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RxJavaNetUnit</span> <span class="token keyword">implements</span> <span class="token class-name">INetUnit</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Observable</span>
    <span class="token keyword">protected</span> Observable mObservable<span class="token punctuation">;</span>
    <span class="token comment">// Observer</span>
    <span class="token keyword">protected</span> BaseObserver mObserver<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> INetUnit <span class="token function">setObservable</span><span class="token punctuation">(</span>Object observable<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mObservable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Observable<span class="token punctuation">)</span> observable<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span>Schedulers<span class="token punctuation">.</span><span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span>AndroidSchedulers<span class="token punctuation">.</span><span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> INetUnit <span class="token function">request</span><span class="token punctuation">(</span>INetListener observer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">==</span> mObservable<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Not Fund INetUnit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mObserver <span class="token operator">=</span> <span class="token punctuation">(</span>BaseObserver<span class="token punctuation">)</span> observer<span class="token punctuation">;</span>
        mObservable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>mObserver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancelRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">!=</span> mObserver<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mObserver<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>3.NetListener:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@NetListener</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseObserver</span><span class="token operator">&lt;</span>T <span class="token keyword">extends</span> <span class="token class-name">BaseResponseBean</span><span class="token operator">&gt;</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span><span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> INetListener<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// error</span>
    <span class="token keyword">protected</span> String errMsg <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token comment">// Disposable</span>
    <span class="token keyword">protected</span> Disposable mDisponable<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span>Disposable d<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mDisponable <span class="token operator">=</span> d<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">onFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">!=</span> t <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token string">"200"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">onSuc</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">onFail</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span>Throwable e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">onFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">ConnectTimeoutException</span>
                <span class="token operator">||</span> e <span class="token keyword">instanceof</span> <span class="token class-name">SocketTimeoutException</span>
                <span class="token operator">||</span> e <span class="token keyword">instanceof</span> <span class="token class-name">SocketException</span>
                <span class="token operator">||</span> e <span class="token keyword">instanceof</span> <span class="token class-name">UnknownHostException</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            errMsg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">HttpException</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            errMsg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            errMsg <span class="token operator">=</span> <span class="token string">"SystemException"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">onFail</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">!=</span> mDisponable <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mDisponable<span class="token punctuation">.</span><span class="token function">isDisposed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mDisponable<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_202"></a>第三步:</h5> 
<p>使用NetPresenter</p> 
<p>1.retrofit service:</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DemoRxJavaService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@GET</span><span class="token punctuation">(</span><span class="token string">"demo/test"</span><span class="token punctuation">)</span>
    Observable<span class="token operator">&lt;</span>BaseData<span class="token generics function"><span class="token punctuation">&lt;</span>Object<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token function">getTestMsg</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span> String key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong><font color="red">2.在使用DemoRxJavaService的地方添加@NetService注解,在调用DemoRxJavaService的方法前,需先调用NetPresenter.bind方法绑定Service,当然在需要关闭请求时,需使用NetPresenter.unBind方法进行关闭操作,之后可添加相应响应的回调方法(@NetCallBack)进行处理,NetPresenter规定了四种响应(CallBackType):SUC(请求成功),FAIL(失败),START(开始),FINISH(完成),这里用activity举例:</font></strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@NetService</span>
    DemoRxJavaService mDemoRxJavaService<span class="token punctuation">;</span>
    <span class="token comment">// bind</span>
    <span class="token keyword">private</span> NetBinder mBind<span class="token punctuation">;</span>
  
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>Bundle savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mBind <span class="token operator">=</span> NetPresenter<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mDemoRxJavaService<span class="token punctuation">.</span><span class="token function">getTestMsg</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     
    <span class="token comment">// DemoRxJavaService</span>
    <span class="token annotation punctuation">@NetCallBack</span><span class="token punctuation">(</span>type <span class="token operator">=</span> CallBackType<span class="token punctuation">.</span>SUC<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getDemoServiceMsgSuc</span><span class="token punctuation">(</span>String tag<span class="token punctuation">,</span> Object bean<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token string">"getTestMsg"</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NetCallBack</span><span class="token punctuation">(</span>type <span class="token operator">=</span> CallBackType<span class="token punctuation">.</span>FAIL<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getDemoServiceMsgFail</span><span class="token punctuation">(</span>String tag<span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> msgs<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      
    <span class="token punctuation">}</span>
  
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">!=</span> mBind<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            NetPresenter<span class="token punctuation">.</span><span class="token function">unBind</span><span class="token punctuation">(</span>mBind<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>​ <strong><font color="red">回调方法参数格式固定,其中tag为请求方法的方法名,SUC中bean为成功响应的请求结果,Fail中msgs为响应的错误信息,可根据需求自行配置,参考示例NetListener. BaseResponseBean,BaseData为响应结果的公共格式类型,根据需求自行配置.</font></strong><br> ​<br> <strong>更多用法和示例参考Github,欢迎star和fork</strong></p> 
<h3><a id="_261"></a>项目地址</h3> 
<p><a href="https://github.com/Dearyu/NetPresenter">NetPresenter</a></p> 
<p><a href="https://github.com/Dearyu/NetPresenter-Helper">NetPresenter插件</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1d55b6e7786bf4838390dbef035d8f05/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android 上拉更多，下拉刷新</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/81ab959492abde7cce158a92b6efbc32/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">指针仪表检测算法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>