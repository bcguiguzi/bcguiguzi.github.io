<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ansible免密管理主机 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ansible免密管理主机" />
<meta property="og:description" content="第一种方法：利用ansible自带的密码认证参数 可以在/etc/ansible/hosts文件中，定义好密码即可，即可实现快速的认证，远程管理主机
参数
ansible_host 主机地址
ansible_port 端口，默认是22端口
ansible_user 认证的用户
ansible_ssh_pass 用户认证的密码
使用hosts文件的参数形式，来实现ssh认证
1.修改hosts文件，在文件最底部加入你要管理的主机，并配置参数 [change] 192.168.200.5 ansible_user=root ansible_ssh_pass=123456 192.168.200.6 ansible_user=root ansible_ssh_pass=123456 2.此时可以不需要输入密码，即可自动ssh验证通过了 [root@m01 ~]# ansible change -m command -a &#34;hostname&#34; 192.168.200.5 | CHANGED | rc=0 &gt;&gt; rsnc01 192.168.200.6 | CHANGED | rc=0 &gt;&gt; nfs01 第二种方法:ssh密钥方式批量管理主机 编写公钥分发脚本
[root@m01 ~]# cat ssh_key_send.sh #!/bin/bash rm -rf ~/.ssh/id_rsa* ssh-keygen -f ~/.ssh/id_rsa -P &#34;&#34; &gt;/dev/null 2&gt;&amp;1 #管理主机的密码 SSH_Pass=123456 #公钥的位置 Key_Path=~/.ssh/id_rsa.pub #5,6为ip地址第三个小数点之后的数字 #192.168.200.$ip为被管理主机所在的网段 for ip in 5 6 do sshpass -p$SSH_Pass ssh-copy-id -i $Key_Path &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/27f9481b12c80200891d6c9c54bd5406/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-26T09:38:31+08:00" />
<meta property="article:modified_time" content="2023-06-26T09:38:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ansible免密管理主机</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h5>第一种方法：利用ansible自带的密码认证参数</h5> 
<blockquote> 
 <p>可以在/etc/ansible/hosts文件中，定义好密码即可，即可实现快速的认证，远程管理主机</p> 
 <p>参数</p> 
 <p>ansible_host 主机地址</p> 
 <p>ansible_port 端口，默认是22端口</p> 
 <p>ansible_user 认证的用户</p> 
 <p>ansible_ssh_pass 用户认证的密码</p> 
</blockquote> 
<p> 使用hosts文件的参数形式，来实现ssh认证</p> 
<pre><code class="language-bash">1.修改hosts文件，在文件最底部加入你要管理的主机，并配置参数
[change]
192.168.200.5 ansible_user=root ansible_ssh_pass=123456
192.168.200.6 ansible_user=root ansible_ssh_pass=123456
2.此时可以不需要输入密码，即可自动ssh验证通过了
[root@m01 ~]# ansible change -m command -a "hostname"
192.168.200.5 | CHANGED | rc=0 &gt;&gt;
rsnc01
192.168.200.6 | CHANGED | rc=0 &gt;&gt;
nfs01

</code></pre> 
<h5>第二种方法:ssh密钥方式批量管理主机</h5> 
<p>编写公钥分发脚本</p> 
<pre><code class="language-bash">[root@m01 ~]# cat ssh_key_send.sh 
#!/bin/bash
rm -rf ~/.ssh/id_rsa*
ssh-keygen -f ~/.ssh/id_rsa -P "" &gt;/dev/null 2&gt;&amp;1
#管理主机的密码
SSH_Pass=123456 
#公钥的位置
Key_Path=~/.ssh/id_rsa.pub
#5,6为ip地址第三个小数点之后的数字 
#192.168.200.$ip为被管理主机所在的网段
for ip in 5 6
do
     sshpass -p$SSH_Pass ssh-copy-id -i $Key_Path "-o StrictHostKeyChecking=no" 192.168.200.$ip
done
</code></pre> 
<p>运行脚本</p> 
<pre><code class="language-bash">[root@m01 ~]# sh ssh_key_send.sh 
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh -o ' StrictHostKeyChecking=no' '192.168.200.5'"
and check to make sure that only the key(s) you wanted were added.

/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh -o ' StrictHostKeyChecking=no' '192.168.200.6'"
and check to make sure that only the key(s) you wanted were added.</code></pre> 
<p>现在即可直接连接</p> 
<pre><code class="language-bash">[root@m01 ~]# ssh -o ' StrictHostKeyChecking=no' '192.168.200.5'
Last login: Mon Jun 26 09:07:28 2023 from 192.168.200.4
[root@rsnc01 ~]# exit
登出
Connection to 192.168.200.5 closed.
[root@m01 ~]# ssh -o ' StrictHostKeyChecking=no' '192.168.200.6'
Last login: Mon Jun 26 09:08:13 2023 from 192.168.200.4
[root@nfs01 ~]# exit
登出
Connection to 192.168.200.6 closed.</code></pre> 
<p> 现在修改ansible的hosts文件</p> 
<pre><code class="language-bash">[root@m01 ~]# tail -5 /etc/ansible/hosts
[change]
#192.168.200.5 ansible_user=root ansible_ssh_pass=123456
#192.168.200.6 ansible_user=root ansible_ssh_pass=123456
192.168.200.5
192.168.200.6</code></pre> 
<p> 尝试ansible执行命令，看是否免密执行</p> 
<pre><code class="language-bash">[root@m01 ~]# ansible change -m "command" -a "hostname"
192.168.200.6 | CHANGED | rc=0 &gt;&gt;
nfs01
192.168.200.5 | CHANGED | rc=0 &gt;&gt;
rsnc01
</code></pre> 
<p>发现执行成功。 </p> 
<p>总结:1.第二种比第一种安全性更高，万一ansible主机被攻破泄露，直接暴漏了被管理的主机root密码</p> 
<p>2.第二种更适合多台主机时，只需要在脚本修改ip即可</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/71398cf9892b142a3d180f3fccda1e73/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python sql 操作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6a85da5ae6ec8c4ac63a9736b3583855/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C语言函数的定义、声明、分类以及调用（一）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>