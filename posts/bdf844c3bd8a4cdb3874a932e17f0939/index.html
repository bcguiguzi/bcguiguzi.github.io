<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>卷积神经网络的猫狗识别——基于Tensorflow和Keras - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="卷积神经网络的猫狗识别——基于Tensorflow和Keras" />
<meta property="og:description" content="目录 一、环境配置二、数据集的准备三、猫狗分类的实例——基准模型四、根据基准模型进行调整五、使用VGG19实现猫狗分类六、参考链接 一、环境配置 安装Anaconda3
详细安装配置:
https://blog.csdn.net/cungudafa/article/details/104573389配置TensorFlow、Keras
①创建虚拟环境
输入下面命令 conda create -n tf1 python=3.6 #tf1是自己为创建虚拟环境取的名字，后面python的版本可以根据自己需求进行选择 ②安装tensorflow和keras
pip install 包名 #直接这样安装可以由于网络的原因，安装失败或者安装很慢 #解决方式： pip install -i https://pypi.tuna.tsinghua.edu.cn/simple 包名 #此次安装命令如下： pip install -i https://pypi.tuna.tsinghua.edu.cn/simple tensorflow==1.14.0 pip install -i https://pypi.tuna.tsinghua.edu.cn/simple keras==2.2.5 二、数据集的准备 数据集的下载
kaggle网站的数据集下载地址：
https://www.kaggle.com/lizhensheng/-2000数据集的分类
将下载的数据集进行解压操作
按照命名进行分类
分类前
分类后
分类代码如下 import tensorflow as tf import keras import os, shutil # 原始目录所在的路径 original_dataset_dir = &#39;G:\\Cat_And_Dog\\kaggle\\train\\&#39; # 数据集分类后的目录 base_dir = &#39;G:\\Cat_And_Dog\\kaggle\\cats_and_dogs_small&#39; os.mkdir(base_dir) # # 训练、验证、测试数据集的目录 train_dir = os." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/bdf844c3bd8a4cdb3874a932e17f0939/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-17T19:43:59+08:00" />
<meta property="article:modified_time" content="2021-06-17T19:43:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">卷积神经网络的猫狗识别——基于Tensorflow和Keras</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_1" rel="nofollow">一、环境配置</a></li><li><a href="#_22" rel="nofollow">二、数据集的准备</a></li><li><a href="#_132" rel="nofollow">三、猫狗分类的实例——基准模型</a></li><li><a href="#_273" rel="nofollow">四、根据基准模型进行调整</a></li><li><a href="#VGG19_440" rel="nofollow">五、使用VGG19实现猫狗分类</a></li><li><a href="#_535" rel="nofollow">六、参考链接</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_1"></a>一、环境配置</h4> 
<ol><li>安装Anaconda3<br> 详细安装配置:<br> <a href="https://blog.csdn.net/cungudafa/article/details/104573389">https://blog.csdn.net/cungudafa/article/details/104573389</a></li><li>配置TensorFlow、Keras<br> ①创建虚拟环境<br> 输入下面命令</li></ol> 
<pre><code class="prism language-cpp">conda create <span class="token operator">-</span>n tf1 python<span class="token operator">=</span><span class="token number">3.6</span>
<span class="token macro property">#tf1是自己为创建虚拟环境取的名字，后面python的版本可以根据自己需求进行选择</span>
</code></pre> 
<p>②安装tensorflow和keras</p> 
<pre><code class="prism language-cpp">pip install 包名
#直接这样安装可以由于网络的原因，安装失败或者安装很慢
#解决方式：
pip install <span class="token operator">-</span>i https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple 包名
#此次安装命令如下：
pip install <span class="token operator">-</span>i https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple tensorflow<span class="token operator">==</span><span class="token number">1.14</span><span class="token number">.0</span>
pip install <span class="token operator">-</span>i https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple keras<span class="token operator">==</span><span class="token number">2.2</span><span class="token number">.5</span>
</code></pre> 
<h4><a id="_22"></a>二、数据集的准备</h4> 
<ol><li>数据集的下载<br> kaggle网站的数据集下载地址：<br> <a href="https://www.kaggle.com/lizhensheng/-2000" rel="nofollow">https://www.kaggle.com/lizhensheng/-2000</a></li><li>数据集的分类<br> 将下载的数据集进行解压操作<br> <img src="https://images2.imgbox.com/8d/1e/N6kaIQTL_o.png" alt="在这里插入图片描述"><br> 按照命名进行分类<br> 分类前<br> <img src="https://images2.imgbox.com/ec/9b/NJA3RfeR_o.png" alt="在这里插入图片描述"><br> 分类后<br> <img src="https://images2.imgbox.com/93/7c/dykvfBbI_o.png" alt="在这里插入图片描述"></li><li>分类代码如下</li></ol> 
<pre><code class="prism language-cpp">import tensorflow as tf
import keras
import os<span class="token punctuation">,</span> shutil 
# 原始目录所在的路径
original_dataset_dir <span class="token operator">=</span> <span class="token string">'G:\\Cat_And_Dog\\kaggle\\train\\'</span>

# 数据集分类后的目录
base_dir <span class="token operator">=</span> <span class="token string">'G:\\Cat_And_Dog\\kaggle\\cats_and_dogs_small'</span>
os<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>base_dir<span class="token punctuation">)</span>

# # 训练、验证、测试数据集的目录
train_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>base_dir<span class="token punctuation">,</span> <span class="token string">'train'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>train_dir<span class="token punctuation">)</span>
validation_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>base_dir<span class="token punctuation">,</span> <span class="token string">'validation'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>validation_dir<span class="token punctuation">)</span>
test_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>base_dir<span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>test_dir<span class="token punctuation">)</span>

# 猫训练图片所在目录
train_cats_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>train_dir<span class="token punctuation">,</span> <span class="token string">'cats'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>train_cats_dir<span class="token punctuation">)</span>

# 狗训练图片所在目录
train_dogs_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>train_dir<span class="token punctuation">,</span> <span class="token string">'dogs'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>train_dogs_dir<span class="token punctuation">)</span>

# 猫验证图片所在目录
validation_cats_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>validation_dir<span class="token punctuation">,</span> <span class="token string">'cats'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>validation_cats_dir<span class="token punctuation">)</span>

# 狗验证数据集所在目录
validation_dogs_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>validation_dir<span class="token punctuation">,</span> <span class="token string">'dogs'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>validation_dogs_dir<span class="token punctuation">)</span>

# 猫测试数据集所在目录
test_cats_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>test_dir<span class="token punctuation">,</span> <span class="token string">'cats'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>test_cats_dir<span class="token punctuation">)</span>

# 狗测试数据集所在目录
test_dogs_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>test_dir<span class="token punctuation">,</span> <span class="token string">'dogs'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>test_dogs_dir<span class="token punctuation">)</span>

# 将前<span class="token number">1000</span>张猫图像复制到train_cats_dir
fnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'cat.{}.jpg'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> fname in fnames<span class="token operator">:</span>
    src <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>original_dataset_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    dst <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>train_cats_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span><span class="token function">copyfile</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>

# 将下<span class="token number">500</span>张猫图像复制到validation_cats_dir
fnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'cat.{}.jpg'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> fname in fnames<span class="token operator">:</span>
    src <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>original_dataset_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    dst <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>validation_cats_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span><span class="token function">copyfile</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
    
# 将下<span class="token number">500</span>张猫图像复制到test_cats_dir
fnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'cat.{}.jpg'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> fname in fnames<span class="token operator">:</span>
    src <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>original_dataset_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    dst <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>test_cats_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span><span class="token function">copyfile</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
    
# 将前<span class="token number">1000</span>张狗图像复制到train_dogs_dir
fnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'dog.{}.jpg'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> fname in fnames<span class="token operator">:</span>
    src <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>original_dataset_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    dst <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>train_dogs_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span><span class="token function">copyfile</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
    
# 将下<span class="token number">500</span>张狗图像复制到validation_dogs_dir
fnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'dog.{}.jpg'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> fname in fnames<span class="token operator">:</span>
    src <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>original_dataset_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    dst <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>validation_dogs_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span><span class="token function">copyfile</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
    
# 将下<span class="token number">500</span>张狗图像复制到test_dogs_dir
fnames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'dog.{}.jpg'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> fname in fnames<span class="token operator">:</span>
    src <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>original_dataset_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    dst <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>test_dogs_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span><span class="token function">copyfile</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>查看分类后，统计对应目录下图片数量</li></ol> 
<pre><code class="prism language-cpp">#输出数据集对应目录下图片数量
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'total training cat images:'</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>train_cats_dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'total training dog images:'</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>train_dogs_dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'total validation cat images:'</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>validation_cats_dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'total validation dog images:'</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>validation_dogs_dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'total test cat images:'</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>test_cats_dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'total test dog images:'</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>test_dogs_dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0c/15/BX6m5KtP_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_132"></a>三、猫狗分类的实例——基准模型</h4> 
<ol><li>构建网络模型</li></ol> 
<pre><code class="prism language-cpp">#网络模型构建
from keras import layers
from keras import models
<span class="token macro property">#keras的序贯模型</span>
model <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">Sequential</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
#卷积层，卷积核是<span class="token number">3</span><span class="token operator">*</span><span class="token number">3</span>，激活函数relu
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Conv2D</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span>
                        input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#最大池化层
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">MaxPooling2D</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#卷积层，卷积核<span class="token number">2</span><span class="token operator">*</span><span class="token number">2</span>，激活函数relu
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Conv2D</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#最大池化层
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">MaxPooling2D</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#卷积层，卷积核是<span class="token number">3</span><span class="token operator">*</span><span class="token number">3</span>，激活函数relu
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Conv2D</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#最大池化层
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">MaxPooling2D</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#卷积层，卷积核是<span class="token number">3</span><span class="token operator">*</span><span class="token number">3</span>，激活函数relu
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Conv2D</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#最大池化层
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">MaxPooling2D</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token macro property">#flatten层，用于将多维的输入一维化，用于卷积层和全连接层的过渡</span>
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#全连接，激活函数relu
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Dense</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#全连接，激活函数sigmoid
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Dense</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'sigmoid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>查看模型各层的参数状况</p> 
<pre><code class="prism language-cpp">#输出模型各层的参数状况
model<span class="token punctuation">.</span><span class="token function">summary</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/96/70/YcqUFDiF_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>配置训练方法</li></ol> 
<pre><code class="prism language-cpp">model<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>optimizer <span class="token operator">=</span> 优化器，
              loss <span class="token operator">=</span> 损失函数，
              metrics <span class="token operator">=</span> <span class="token punctuation">[</span>"准确率”<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>其中，优化器和损失函数可以是字符串形式的名字，也可以是函数形式。</p> 
<pre><code class="prism language-cpp">from keras import optimizers

model<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span><span class="token string">'binary_crossentropy'</span><span class="token punctuation">,</span>
              optimizer<span class="token operator">=</span>optimizers<span class="token punctuation">.</span><span class="token function">RMSprop</span><span class="token punctuation">(</span>lr<span class="token operator">=</span><span class="token number">1e-4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'acc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>文件中图像转换成所需格式<br> 将训练和验证的图片，调整为150*150</li></ol> 
<pre><code class="prism language-cpp">from keras<span class="token punctuation">.</span>preprocessing<span class="token punctuation">.</span>image import ImageDataGenerator

# 所有图像将按<span class="token number">1</span><span class="token operator">/</span><span class="token number">255</span>重新缩放
train_datagen <span class="token operator">=</span> <span class="token function">ImageDataGenerator</span><span class="token punctuation">(</span>rescale<span class="token operator">=</span><span class="token number">1.</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">)</span>
test_datagen <span class="token operator">=</span> <span class="token function">ImageDataGenerator</span><span class="token punctuation">(</span>rescale<span class="token operator">=</span><span class="token number">1.</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">)</span>

train_generator <span class="token operator">=</span> train_datagen<span class="token punctuation">.</span><span class="token function">flow_from_directory</span><span class="token punctuation">(</span>
        # 这是目标目录
        train_dir<span class="token punctuation">,</span>
        # 所有图像将调整为<span class="token number">150</span>x150
        target_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
        # 因为我们使用二元交叉熵损失，我们需要二元标签
        class_mode<span class="token operator">=</span><span class="token string">'binary'</span><span class="token punctuation">)</span>

validation_generator <span class="token operator">=</span> test_datagen<span class="token punctuation">.</span><span class="token function">flow_from_directory</span><span class="token punctuation">(</span>
        validation_dir<span class="token punctuation">,</span>
        target_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
        class_mode<span class="token operator">=</span><span class="token string">'binary'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a1/01/7kSnfEWh_o.png" alt="在这里插入图片描述"><br> 查看处理结果</p> 
<pre><code class="prism language-cpp">#查看上面对于图片预处理的处理结果
<span class="token keyword">for</span> data_batch<span class="token punctuation">,</span> labels_batch in train_generator<span class="token operator">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'data batch shape:'</span><span class="token punctuation">,</span> data_batch<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'labels batch shape:'</span><span class="token punctuation">,</span> labels_batch<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    <span class="token keyword">break</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d7/a2/Bjkz8b35_o.png" alt="在这里插入图片描述"></p> 
<ol start="4"><li>模型训练并保存生成的模型</li></ol> 
<pre><code class="prism language-cpp">#模型训练过程
history <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">fit_generator</span><span class="token punctuation">(</span>
      train_generator<span class="token punctuation">,</span>
      steps_per_epoch<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
      epochs<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>
      validation_data<span class="token operator">=</span>validation_generator<span class="token punctuation">,</span>
      validation_steps<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
#保存训练得到的的模型
model<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">'G:\\Cat_And_Dog\\kaggle\\cats_and_dogs_small_1.h5'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/56/67/jgmPPZta_o.png" alt="在这里插入图片描述"></p> 
<ol start="5"><li>结果可视化</li></ol> 
<pre><code class="prism language-cpp">#对于模型进行评估，查看预测的准确性
import matplotlib<span class="token punctuation">.</span>pyplot as plt

acc <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'acc'</span><span class="token punctuation">]</span>
val_acc <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'val_acc'</span><span class="token punctuation">]</span>
loss <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'loss'</span><span class="token punctuation">]</span>
val_loss <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'val_loss'</span><span class="token punctuation">]</span>

epochs <span class="token operator">=</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> acc<span class="token punctuation">,</span> <span class="token string">'bo'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Training acc'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> val_acc<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Validation acc'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'Training and validation accuracy'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span><span class="token function">figure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> loss<span class="token punctuation">,</span> <span class="token string">'bo'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Training loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> val_loss<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Validation loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'Training and validation loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1d/28/j4bjCkPu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4b/57/PDvh2JCH_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>由可视化结果，可以发现训练的loss是成上升趋势。所以，训练获得的模型存在一些问题，导致模型过拟合。过拟合是为了得到一致假设而使假设变得过度严格，实际训练得到的模型的分类效果不佳。</p> 
</blockquote> 
<h4><a id="_273"></a>四、根据基准模型进行调整</h4> 
<blockquote> 
 <p>为了解决过拟合问题，可以减小模型复杂度，也可以用一系列手段去对冲，比如增加数据（图像增强、人工合成或者多搜集真实数据）、L1/L2正则化、dropout正则化等。这里主要介绍CV中最常用的图像增强。</p> 
</blockquote> 
<ol><li>图像增强<br> 利用图像生成器定义一些常见的图像变换，图像增强就是通过对于图像进行变换，从而，增强图像中的有用信息。</li></ol> 
<pre><code class="prism language-cpp">#该部分代码及以后的代码，用于替代基准模型中分类后面的代码（执行代码前，需要先将之前分类的目录删掉，重写生成分类，否则，会发生错误）
from keras<span class="token punctuation">.</span>preprocessing<span class="token punctuation">.</span>image import ImageDataGenerator
datagen <span class="token operator">=</span> <span class="token function">ImageDataGenerator</span><span class="token punctuation">(</span>
      rotation_range<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>
      width_shift_range<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
      height_shift_range<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
      shear_range<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
      zoom_range<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
      horizontal_flip<span class="token operator">=</span>True<span class="token punctuation">,</span>
      fill_mode<span class="token operator">=</span><span class="token string">'nearest'</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>①rotation_range<br> 一个角度值(0-180)，在这个范围内可以随机旋转图片<br> ②width_shift和height_shift<br> 范围(作为总宽度或高度的一部分)，在其中可以随机地垂直或水平地转换图片<br> ③shear_range<br> 用于随机应用剪切转换<br> ④zoom_range<br> 用于在图片内部随机缩放<br> ⑤horizontal_flip<br> 用于水平随机翻转一半的图像——当没有假设水平不对称时(例如真实世界的图片)<br> ⑥fill_mode<br> 用于填充新创建像素的策略，它可以在旋转或宽度/高度移动之后出现</p> 
</blockquote> 
<ol start="2"><li>查看增强后的图像</li></ol> 
<pre><code class="prism language-cpp">import matplotlib<span class="token punctuation">.</span>pyplot as plt
<span class="token macro property"># This is module with image preprocessing utilities</span>
from keras<span class="token punctuation">.</span>preprocessing import image
fnames <span class="token operator">=</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>train_cats_dir<span class="token punctuation">,</span> fname<span class="token punctuation">)</span> <span class="token keyword">for</span> fname in os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>train_cats_dir<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token macro property"># We pick one image to "augment"</span>
img_path <span class="token operator">=</span> fnames<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token macro property"># Read the image and resize it</span>
img <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">load_img</span><span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> target_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token macro property"># Convert it to a Numpy array with shape (150, 150, 3)</span>
x <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">img_to_array</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token macro property"># Reshape it to (1, 150, 150, 3)</span>
x <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">reshape</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">+</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token macro property"># The .flow() command below generates batches of randomly transformed images.</span>
<span class="token macro property"># It will loop indefinitely, so we need to `break` the loop at some point!</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> batch in datagen<span class="token punctuation">.</span><span class="token function">flow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>
    plt<span class="token punctuation">.</span><span class="token function">figure</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    imgplot <span class="token operator">=</span> plt<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">array_to_img</span><span class="token punctuation">(</span>batch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    i <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
        <span class="token keyword">break</span>
plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/17/71/pEG0fdmG_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>网络模型增加一层dropout</li></ol> 
<pre><code class="prism language-cpp">#网络模型构建
from keras import layers
from keras import models
<span class="token macro property">#keras的序贯模型</span>
model <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">Sequential</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
#卷积层，卷积核是<span class="token number">3</span><span class="token operator">*</span><span class="token number">3</span>，激活函数relu
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Conv2D</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span>
                        input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#最大池化层
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">MaxPooling2D</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#卷积层，卷积核<span class="token number">2</span><span class="token operator">*</span><span class="token number">2</span>，激活函数relu
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Conv2D</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#最大池化层
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">MaxPooling2D</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#卷积层，卷积核是<span class="token number">3</span><span class="token operator">*</span><span class="token number">3</span>，激活函数relu
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Conv2D</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#最大池化层
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">MaxPooling2D</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#卷积层，卷积核是<span class="token number">3</span><span class="token operator">*</span><span class="token number">3</span>，激活函数relu
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Conv2D</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#最大池化层
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">MaxPooling2D</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token macro property">#flatten层，用于将多维的输入一维化，用于卷积层和全连接层的过渡</span>
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#退出层
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Dropout</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#全连接，激活函数relu
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Dense</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#全连接，激活函数sigmoid
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Dense</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'sigmoid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
#输出模型各层的参数状况
model<span class="token punctuation">.</span><span class="token function">summary</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
from keras import optimizers

model<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span><span class="token string">'binary_crossentropy'</span><span class="token punctuation">,</span>
              optimizer<span class="token operator">=</span>optimizers<span class="token punctuation">.</span><span class="token function">RMSprop</span><span class="token punctuation">(</span>lr<span class="token operator">=</span><span class="token number">1e-4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'acc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>训练模型</li></ol> 
<pre><code class="prism language-cpp">train_datagen <span class="token operator">=</span> <span class="token function">ImageDataGenerator</span><span class="token punctuation">(</span>
    rescale<span class="token operator">=</span><span class="token number">1.</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">,</span>
    rotation_range<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>
    width_shift_range<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
    height_shift_range<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
    shear_range<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
    zoom_range<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>
    horizontal_flip<span class="token operator">=</span>True<span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token macro property"># Note that the validation data should not be augmented!</span>
test_datagen <span class="token operator">=</span> <span class="token function">ImageDataGenerator</span><span class="token punctuation">(</span>rescale<span class="token operator">=</span><span class="token number">1.</span><span class="token operator">/</span><span class="token number">255</span><span class="token punctuation">)</span>
train_generator <span class="token operator">=</span> train_datagen<span class="token punctuation">.</span><span class="token function">flow_from_directory</span><span class="token punctuation">(</span>
        <span class="token macro property"># This is the target directory</span>
        train_dir<span class="token punctuation">,</span>
        <span class="token macro property"># All images will be resized to 150x150</span>
        target_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>
        <span class="token macro property"># Since we use binary_crossentropy loss, we need binary labels</span>
        class_mode<span class="token operator">=</span><span class="token string">'binary'</span><span class="token punctuation">)</span>
validation_generator <span class="token operator">=</span> test_datagen<span class="token punctuation">.</span><span class="token function">flow_from_directory</span><span class="token punctuation">(</span>
        validation_dir<span class="token punctuation">,</span>
        target_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>
        class_mode<span class="token operator">=</span><span class="token string">'binary'</span><span class="token punctuation">)</span>
history <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">fit_generator</span><span class="token punctuation">(</span>
      train_generator<span class="token punctuation">,</span>
      steps_per_epoch<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
      epochs<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
      validation_data<span class="token operator">=</span>validation_generator<span class="token punctuation">,</span>
      validation_steps<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">'G:\\Cat_And_Dog\\kaggle\\cats_and_dogs_small_2.h5'</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li>结果可视化</li></ol> 
<pre><code class="prism language-cpp">acc <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'acc'</span><span class="token punctuation">]</span>
val_acc <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'val_acc'</span><span class="token punctuation">]</span>
loss <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'loss'</span><span class="token punctuation">]</span>
val_loss <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'val_loss'</span><span class="token punctuation">]</span>
epochs <span class="token operator">=</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> acc<span class="token punctuation">,</span> <span class="token string">'bo'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Training acc'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> val_acc<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Validation acc'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'Training and validation accuracy'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">figure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> loss<span class="token punctuation">,</span> <span class="token string">'bo'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Training loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> val_loss<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Validation loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'Training and validation loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>只进行数据增强的可视化结果<br> <img src="https://images2.imgbox.com/bd/ed/Np4LzmT9_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/03/23/DTDbWowY_o.png" alt="在这里插入图片描述"><br> 数据增强和dropout层增加的可视化结果<br> <img src="https://images2.imgbox.com/7d/b1/K9Dg1Jj7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/38/41/t7W6Jzzn_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>对比基准模型来看，可以很清楚的发现loss的整体趋势是变小的。对比，只进行图像增强获得的模型和进行图像增强与添加dropout层获得的模型，可以发现前者在训练过程中波动会更大，后者在准确上小于前者。两者虽然在准确率有所变小，但是都避免了过拟合</p> 
</blockquote> 
<h4><a id="VGG19_440"></a>五、使用VGG19实现猫狗分类</h4> 
<ol><li>初始化一个VGG19网络实例</li></ol> 
<pre><code class="prism language-cpp">from keras<span class="token punctuation">.</span>applications import VGG19
conv_base <span class="token operator">=</span> <span class="token function">VGG19</span><span class="token punctuation">(</span>weights <span class="token operator">=</span> <span class="token string">'imagenet'</span><span class="token punctuation">,</span>include_top <span class="token operator">=</span> False<span class="token punctuation">,</span>input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
conv_base<span class="token punctuation">.</span><span class="token function">summary</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>首次运行时候，会自动从对应网站下载h5格式文件<br> <img src="https://images2.imgbox.com/15/32/gAx6k2Rw_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>上面下载很慢，而且还有可能在中途挂掉，因此建议将网址复制到浏览器上，直接下载。然后，将下载的文件，放到对应的目录下<br> 我下载存放的位置</p> 
</blockquote> 
<p>其模型网络结构<br> <img src="https://images2.imgbox.com/45/cb/2YPHhADU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1c/20/BzFIlAbH_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>将猫狗数据集传递给神经网络<br> 将分类后的猫狗数据集传递给神经网络，让它把图片的隐含信息给抽取出来</li></ol> 
<pre><code class="prism language-cpp">import os 
import numpy as np
from keras<span class="token punctuation">.</span>preprocessing<span class="token punctuation">.</span>image import ImageDataGenerator
# 数据集分类后的目录
base_dir <span class="token operator">=</span> <span class="token string">'E:\\Cat_And_Dog\\kaggle\\cats_and_dogs_small'</span>
train_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>base_dir<span class="token punctuation">,</span> <span class="token string">'train'</span><span class="token punctuation">)</span>
validation_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>base_dir<span class="token punctuation">,</span> <span class="token string">'validation'</span><span class="token punctuation">)</span>
test_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>base_dir<span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span>
datagen <span class="token operator">=</span> <span class="token function">ImageDataGenerator</span><span class="token punctuation">(</span>rescale <span class="token operator">=</span> <span class="token number">1.</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">)</span>
batch_size <span class="token operator">=</span> <span class="token number">20</span>
def <span class="token function">extract_features</span><span class="token punctuation">(</span>directory<span class="token punctuation">,</span> sample_count<span class="token punctuation">)</span><span class="token operator">:</span>
    features <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">zeros</span><span class="token punctuation">(</span>shape <span class="token operator">=</span> <span class="token punctuation">(</span>sample_count<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    labels <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">zeros</span><span class="token punctuation">(</span>shape <span class="token operator">=</span> <span class="token punctuation">(</span>sample_count<span class="token punctuation">)</span><span class="token punctuation">)</span>
    generator <span class="token operator">=</span> datagen<span class="token punctuation">.</span><span class="token function">flow_from_directory</span><span class="token punctuation">(</span>directory<span class="token punctuation">,</span> target_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                            batch_size <span class="token operator">=</span> batch_size<span class="token punctuation">,</span>
                                            class_mode <span class="token operator">=</span> <span class="token string">'binary'</span><span class="token punctuation">)</span>
    i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> inputs_batch<span class="token punctuation">,</span> labels_batch in generator<span class="token operator">:</span>
        #把图片输入VGG16卷积层，让它把图片信息抽取出来
        features_batch <span class="token operator">=</span> conv_base<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>inputs_batch<span class="token punctuation">)</span>
        <span class="token macro property">#feature_batch 是 4*4*512结构</span>
        features<span class="token punctuation">[</span>i <span class="token operator">*</span> batch_size <span class="token operator">:</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>batch_size<span class="token punctuation">]</span> <span class="token operator">=</span> features_batch
        labels<span class="token punctuation">[</span>i <span class="token operator">*</span> batch_size <span class="token operator">:</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>batch_size<span class="token punctuation">]</span> <span class="token operator">=</span> labels_batch
        i <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> i <span class="token operator">*</span> batch_size <span class="token operator">&gt;=</span> sample_count <span class="token operator">:</span>
            <span class="token macro property">#for in 在generator上的循环是无止境的，因此我们必须主动break掉</span>
            <span class="token keyword">break</span>
        <span class="token keyword">return</span> features <span class="token punctuation">,</span> labels
<span class="token macro property">#extract_features 返回数据格式为(samples, 4, 4, 512)</span>
train_features<span class="token punctuation">,</span> train_labels <span class="token operator">=</span> <span class="token function">extract_features</span><span class="token punctuation">(</span>train_dir<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
validation_features<span class="token punctuation">,</span> validation_labels <span class="token operator">=</span> <span class="token function">extract_features</span><span class="token punctuation">(</span>validation_dir<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
test_features<span class="token punctuation">,</span> test_labels <span class="token operator">=</span> <span class="token function">extract_features</span><span class="token punctuation">(</span>test_dir<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>	
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/cb/wspfNT72_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>将抽取的特征输入到我们自己的神经层中进行分类训练</li></ol> 
<pre><code class="prism language-cpp">from keras import models
from keras import layers
from keras import optimizers
#构造我们自己的网络层对输出数据进行分类
model <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">Sequential</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Dense</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span> input_dim <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Dropout</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>layers<span class="token punctuation">.</span><span class="token function">Dense</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> activation <span class="token operator">=</span> <span class="token string">'sigmoid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span>optimizers<span class="token punctuation">.</span><span class="token function">RMSprop</span><span class="token punctuation">(</span>lr <span class="token operator">=</span> <span class="token number">2e-5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loss <span class="token operator">=</span> <span class="token string">'binary_crossentropy'</span><span class="token punctuation">,</span> metrics <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'acc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
history <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>train_features<span class="token punctuation">,</span> train_labels<span class="token punctuation">,</span> epochs <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> batch_size <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> 
                    validation_data <span class="token operator">=</span> <span class="token punctuation">(</span>validation_features<span class="token punctuation">,</span> validation_labels<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>训练结果和校验结果的可视化</li></ol> 
<pre><code class="prism language-cpp">import matplotlib<span class="token punctuation">.</span>pyplot as plt
acc <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'acc'</span><span class="token punctuation">]</span>
val_acc <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'val_acc'</span><span class="token punctuation">]</span>
loss <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'loss'</span><span class="token punctuation">]</span>
val_loss <span class="token operator">=</span> history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'val_loss'</span><span class="token punctuation">]</span>
epochs <span class="token operator">=</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> acc<span class="token punctuation">,</span> <span class="token string">'bo'</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'Train_acc'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> val_acc<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'Validation acc'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'Trainning and validation accuracy'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">figure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> loss<span class="token punctuation">,</span> <span class="token string">'bo'</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'Training loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>epochs<span class="token punctuation">,</span> val_loss<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'Validation loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'Training and validation loss'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/06/cd/ttCZJabS_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7f/5c/gKEpMhLy_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_535"></a>六、参考链接</h4> 
<p>1.<a href="https://blog.csdn.net/cungudafa/article/details/104573389">【TensorFlow&amp;Keras】入门猫狗数据集实验–理解卷积神经网络CNN</a><br> 2.<a href="https://blog.csdn.net/qq_43279579/article/details/117298169?spm=1001.2014.3001.5501">基于Tensorflow和Keras实现卷积神经网络CNN</a><br> 3.<a href="https://blog.csdn.net/qq_42451251/article/details/106657643?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-8.control&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-8.control">基于jupyter notebook的python编程-----猫狗数据集的阶段分类得到模型精度并进行数据集优化</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1e7c93a7e836b04ac8a3225ab41877f2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">30行代码解析滑块验证码图片缺口的位置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1abf1b3c225565e9013c45ee99c75a9d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">html标签的多级列表,Word小技巧&lt;1&gt;：利用多级列表功能实现章节标题自动编号</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>