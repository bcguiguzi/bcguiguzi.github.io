<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>flutter 问题记录 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="flutter 问题记录" />
<meta property="og:description" content="1、listview 上下有空白间隔：MediaQuery.removePadding包裹
MediaQuery.removePadding(context: context, removeBottom: true, removeTop: true, child: ListView.builder( shrinkWrap: true, physics: NeverScrollableScrollPhysics(), itemCount: 5, itemBuilder: (context, index){ return AssetsImage(&#39;home-bg-top.png&#39;, fit: BoxFit.fitWidth,); }, ) ) 2、flutter 打包Android debug和release包如果出现部分功能不一致，可能为 Flutter1.17以后增加了自带混淆功能。（在开发阿里百川功能时遇到的问题总结）
解决两种方式：
1）增加flutter plugins在Android中proguard-rules.pro中的混淆配置
2）关闭混淆
minifyEnabled false //删除无用代码 useProguard false //代码压缩设置 shrinkResources false //删除无用资源 signingConfig signingConfigs.config proguardFiles getDefaultProguardFile(&#39;proguard-android-optimize.txt&#39;), &#39;proguard-rules.pro&#39; 3、ios pod install 慢，导致部分库导入不成功。
在podfile中增加：source &#39;https://mirrors.tuna.tsinghua.edu.cn/git/CocoaPods/Specs.git&#39;
pod库版本低会导致部分flutter库导入不成功(jpush_flutter),解决(更新最新库)
pod repo update master ios运行或打包错误，一部分原因需要在android studio devices运行一遍，再在xcode中运行解决 4、微信相关，fluwx 3.4.2
1）微信5.4.3开始jcenter关停。需要在根目录build.gradle增加mavenCentral()
2) Android端由于kotlin版本问题导致：org.jetbrains.kotlin.codegen.CompilationException: Back-end (JVM) Internal error: wrong bytecode错误。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/b6591aedb2ede9db9596e22487e6f21e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-03T10:27:14+08:00" />
<meta property="article:modified_time" content="2022-09-03T10:27:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">flutter 问题记录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1、listview 上下有空白间隔：MediaQuery.removePadding包裹</p> 
<pre><code class="language-html">MediaQuery.removePadding(context: context,
    removeBottom: true,
    removeTop: true,
    child: ListView.builder(
      shrinkWrap: true,
      physics: NeverScrollableScrollPhysics(),
      itemCount: 5,
      itemBuilder: (context, index){
        return AssetsImage('home-bg-top.png', fit: BoxFit.fitWidth,);
      },
    )
)</code></pre> 
<p>2、flutter 打包Android debug和release包如果出现部分功能不一致，可能为 Flutter1.17以后增加了自带混淆功能。（在开发阿里百川功能时遇到的问题总结）</p> 
<p>     解决两种方式：<br>                           1）增加flutter plugins在Android中proguard-rules.pro中的混淆配置</p> 
<p>                          2）关闭混淆</p> 
<pre><code>minifyEnabled false //删除无用代码
useProguard false    //代码压缩设置
shrinkResources false //删除无用资源

signingConfig signingConfigs.config
proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'</code></pre> 
<p>3、ios pod install 慢，导致部分库导入不成功。<br>     在podfile中增加：source 'https://mirrors.tuna.tsinghua.edu.cn/git/CocoaPods/Specs.git'</p> 
<p>    pod库版本低会导致部分flutter库导入不成功(jpush_flutter),解决(更新最新库)</p> 
<pre><code>pod repo update master</code></pre> 
<p>     ios运行或打包错误，一部分原因需要在android studio devices运行一遍，再在xcode中运行解决                         </p> 
<p>4、微信相关，fluwx 3.4.2</p> 
<p>     1）微信5.4.3开始jcenter关停。需要在根目录build.gradle增加mavenCentral()</p> 
<p>     2) Android端由于kotlin版本问题导致：org.jetbrains.kotlin.codegen.CompilationException: Back-end (JVM) Internal error: wrong bytecode错误。</p> 
<p>    解决：修改根目录build.gradle，kotlin版本为1.3.72</p> 
<p>5、系统分享，引用库：share_plus: ^2.1.4</p> 
<p>    问题：安卓分享朋友多图在部分机型出现：分享失败，多文件分享仅支持照片格式。</p> 
<p>    解决：需要下载库手动引入到plugins中，修改安卓Share.java文件中getUrisForPaths方法如下：</p> 
<pre><code class="language-java">file = copyToShareCacheFolder(file);

//uris.add(FileProvider.getUriForFile(getContext(), providerAuthority, file));

ApplicationInfo applicationInfo = getContext().getApplicationInfo();
int targetSDK = applicationInfo.targetSdkVersion;
if (targetSDK &gt;= Build.VERSION_CODES.N &amp;&amp; Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) {
           
uris.add(Uri.parse(MediaStore.Images.Media.insertImage(getContext().getContentResolver(), file.getAbsolutePath(), file.getName(), null)));
} else {
  uris.add(Uri.fromFile(file));
}</code></pre> 
<p>6、webview_cookie_manager：1.0.3 库ios最低版本是11.0</p> 
<p>        设备运行可以，但是hoc打包会出现module not found错误</p> 
<p>        解决：</p> 
<p>       需要在xcode-info中iOS Deployment Target中设置对应11</p> 
<p>7、部分安卓机型(oppo r9s):<br> :DioError [DioErrorType.DEFAULT]: HandshakeException: Handshake error in client (OS Error:<br> CERTIFICATE_VERIFY_FAILED: unable to get local issuer certificate(handshake.cc:354)) 无法获取本地证书</p> 
<p>解决：<br> 添加如下代码 强行信任</p> 
<pre><code>Dio dio = Dio();
(dio.httpClientAdapter as DefaultHttpClientAdapter).onHttpClientCreate = (client){
    client.badCertificateCallback=(cert, host, port){
        return true;
    };
};</code></pre> 
<p> CachedNetworkImage:https证书导致的问题解决：</p> 
<pre><code>CachedNetworkImage(
    width: width,
    height: height,
    fit: fit,
    imageUrl: imageUrl,
    cacheManager: EsoImageCacheManager(),
  );</code></pre> 
<pre><code>import 'dart:async';

import 'package:flutter_cache_manager/flutter_cache_manager.dart';
import 'package:http/http.dart' as http;
import 'dart:io';

/// 缓存管理
class EsoImageCacheManager extends CacheManager {
  static const key = 'libEsoCachedImageData';

  static EsoImageCacheManager _instance;
  factory EsoImageCacheManager() {
    _instance ??= EsoImageCacheManager._();
    return _instance;
  }

  EsoImageCacheManager._() : super(Config(key, fileService: EsoHttpFileService()));
}

class EsoHttpFileService extends FileService {
  HttpClient _httpClient;
  EsoHttpFileService({HttpClient httpClient}) {
    _httpClient = httpClient ?? HttpClient();
    _httpClient.badCertificateCallback = (cert, host, port) =&gt; true;
  }

  @override
  Future&lt;FileServiceResponse&gt; get(String url,
      {Map&lt;String, String&gt; headers = const {}}) async {
    final Uri resolved = Uri.base.resolve(url);
    final HttpClientRequest req = await _httpClient.getUrl(resolved);
    headers?.forEach((key, value) {
      req.headers.add(key, value);
    });
    final HttpClientResponse httpResponse = await req.close();
    final http.StreamedResponse _response = http.StreamedResponse(
      httpResponse.timeout(Duration(seconds: 60)), httpResponse.statusCode,
      contentLength: httpResponse.contentLength,
      reasonPhrase: httpResponse.reasonPhrase,
      isRedirect: httpResponse.isRedirect,
    );
    return HttpGetResponse(_response);
  }
}</code></pre> 
<p>8、webview_flutter:2.0.10版本<br> 不显示网页：I/X509Util: Failed to validate the certificate chain, error: java.security.cert.CertPathValidatorException: Trust anchor for certification path not found.</p> 
<p>解决：下载源码，导入plugins。修改FlutterWebViewClient.java文件中internalCreateWebViewClient和internalCreateWebViewClientCompat方法，增加：</p> 
<pre><code>@Override
public void onReceivedSslError(WebView view, SslErrorHandler handler,         
         SslError error) {
  handler.proceed();
}</code></pre> 
<p>网页字体不随系统字体大小变化：</p> 
<p>Android:WebSettings settings = webView.getSettings(); settings.setTextZoom(100);</p> 
<p>iOS:body { -webkit-text-size-adjust: none !important; }</p> 
<p>9、集成支付宝支付Tobias库时与flutter_alibc冲突。主要为UTDID冲突</p> 
<p>解决：去阿里文档中心 https://docs.open.alipay.com/54/104509 重新下载没有UTDID冲突的库</p> 
<p><img alt="" height="582" src="https://images2.imgbox.com/e8/6f/3CBWiR6d_o.png" width="1119"></p> 
<p>下载-解压，替换如下图（删除原来的）：</p> 
<p><img alt="" height="241" src="https://images2.imgbox.com/49/ee/Ve9CmTfT_o.png" width="664"></p> 
<p>10、Android 11 存储权限问题（targetSdkVersion 30）</p> 
<p>①AndroidManifest.xml  增加   </p> 
<p>&lt;uses-permission android:name="android.permission.MANAGE_EXTERNAL_STORAGE" /&gt;</p> 
<p>② flutter权限判断 </p> 
<p> if (await Permission.storage.request().isGranted &amp;&amp; await Permission.manageExternalStorage.request().isGranted) {}</p> 
<p>11、webview 微信支付，商家参数错误其中一个问题解决(android端referer丢失问题)<br> 针对：webview_flutter:2.0.10</p> 
<pre><code>39行增加：
String mReffer = "";

91行修改：
@TargetApi(Build.VERSION_CODES.LOLLIPOP)
                        boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) {
        if (!hasNavigationDelegate) {
             return false;
        }
        Map&lt;String, String&gt; header = new HashMap&lt;&gt;();
        if (request != null&amp;&amp;request.getRequestHeaders()!=null) {
            header = request.getRequestHeaders();
        }
        header.put("Referer", mReffer);

        notifyOnNavigationRequest(request.getUrl().toString(), header, view, request.isForMainFrame());
        return request.isForMainFrame();
}

125行修改：
boolean shouldOverrideUrlLoading(WebView view, String url) {
     if (!hasNavigationDelegate) {
         return false;
     }
     Map&lt;String, String&gt; header = new HashMap&lt;&gt;();
     header.put("Referer", mReffer);
     notifyOnNavigationRequest(url, header, view, true);
     return true;
}

194行增加：
@TargetApi(Build.VERSION_CODES.LOLLIPOP)
                             @Nullable
                             @Override
                             public WebResourceResponse shouldInterceptRequest(WebView view, WebResourceRequest request) {
        Map&lt;String, String&gt; lRequestHeaders = request.getRequestHeaders();
        if (lRequestHeaders.containsKey("Referer")) {
            mReffer = lRequestHeaders.get("Referer");
        }
        return super.shouldInterceptRequest(view, request);
}

251行增加：
@TargetApi(Build.VERSION_CODES.LOLLIPOP)
                             @Nullable
                             @Override
                             public WebResourceResponse shouldInterceptRequest(WebView view, WebResourceRequest request) {
      Map&lt;String, String&gt; lRequestHeaders = request.getRequestHeaders();
      if (lRequestHeaders.containsKey("Referer")) {
           mReffer = lRequestHeaders.get("Referer");
      }
      return super.shouldInterceptRequest(view, request);
}</code></pre> 
<p>12、Hero动画，当包含子组件有TextField是报错如下：</p> 
<h2></h2> 
<p>No Material widget found. Hero Animation is not working with TextField</p> 
<p>解决：Hero子组件用Material包含。</p> 
<pre><code>Hero(
  tag: "search",
  child: Material(
    type: MaterialType.transparency,
    child: Row(
      children: [
        //TextField(),
        //GestureDetector(),
      ],
    ),
  ),
);</code></pre> 
<p>13、安卓任务栏文件名称不显示，在老版flutter会出现问题。(华为提版：您的应用存在隐藏最近任务列表名称的行为，不符合华为应用市场审核标准)，解决：</p> 
<p>在MainActivity文件中重写 setTaskDescription：</p> 
<pre><code class="language-java">//因flutter里会重置setTaskDescription，会导致最近任务标题消失，所以这里需要把标题重新设置
@RequiresApi(Build.VERSION_CODES.LOLLIPOP)
  override fun setTaskDescription(taskDescription: ActivityManager.TaskDescription?) {
    val description: ActivityManager.TaskDescription
    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) {
      description = ActivityManager.TaskDescription("名称", R.mipmap.ic_launcher)
    } else {
      description = ActivityManager.TaskDescription("名称", BitmapFactory.decodeResource(resources, R.mipmap.ic_launcher))
    }
    super.setTaskDescription(description)
  }</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/452fb00571e2ddaa9cf59c97bb7a18cf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">springboot配置读取顺序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2ed7bd4089fab283d5a47202aecf6cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">三、仪表读数识别算法的开发——2.实现方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>