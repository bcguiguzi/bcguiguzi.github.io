<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于Apache - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="关于Apache" />
<meta property="og:description" content="文章目录 一、httpd 安装组成1、常见http 服务器程序2、apache 介绍和特点2.1 关于apache2.1.1 apache 功能2.1.2 apache特性 2.2 MPM multi-processing module 工作模式2.2.1 prefork2.2.2 worker2.2.3 event 3、Httpd 安装和相关文件3.1 包安装httpd并启动httpd服务3.1.1 版本说明3.1.2 安装方式 3.2 httpd-2.4 相关文件3.2.1 配置文件3.2.2 检查配置语法3.2.3 服务单元文件3.2.4 服务控制和启动3.2.5 站点网页文档根目录3.2.6 模块文件路径3.2.7 主服务器程序文件 二、httpd常见配置1、指定服务器名2、包含其它配置文件2.1 include 子配置文件2.2 总目录 3、监听地址4、隐藏服务器版本信息5、持久连接6、DSO (Dynamic Shared Object)7、MPM (Multi-Processing Module)多路处理模块8、prefork模式相关的配置9、worker 和 event 模式相关的配置10、定义Main server的文档页面路径11、定义站点默认主页面文件12、虚拟主机12.1 基于ip地址12.2 基于端口地址12.3 基于域名 三、Cookie和session1、Cookie2、Session2.1 cookie和session的相同和不同2.2 cookie缺点2.3 session 缺点 四、Web相关工具1、Weget相关工具2、curl3、压力测试工具 一、httpd 安装组成 http 服务基于 C/S 结构 1、常见http 服务器程序 httpd apache，存在C10K（10K connections）问题nginx 解决C10K问题lighttpdtomcat .jsp 应用程序服务器IIS ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/7f8e0c2dde19e2a999c619f37de0b8e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-16T10:44:52+08:00" />
<meta property="article:modified_time" content="2024-03-16T10:44:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于Apache</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#httpd__1" rel="nofollow">一、httpd 安装组成</a></li><li><ul><li><a href="#1http__6" rel="nofollow">1、常见http 服务器程序</a></li><li><a href="#2apache__19" rel="nofollow">2、apache 介绍和特点</a></li><li><ul><li><a href="#21_apache_21" rel="nofollow">2.1 关于apache</a></li><li><ul><li><a href="#211_apache__36" rel="nofollow">2.1.1 apache 功能</a></li><li><a href="#212_apache_47" rel="nofollow">2.1.2 apache特性</a></li></ul> 
     </li><li><a href="#22_MPM_multiprocessing_module__57" rel="nofollow">2.2 MPM multi-processing module 工作模式</a></li><li><ul><li><a href="#221_prefork_59" rel="nofollow">2.2.1 prefork</a></li><li><a href="#222_worker_74" rel="nofollow">2.2.2 worker</a></li><li><a href="#223_event_87" rel="nofollow">2.2.3 event</a></li></ul> 
    </li></ul> 
    </li><li><a href="#3Httpd__108" rel="nofollow">3、Httpd 安装和相关文件</a></li><li><ul><li><a href="#31_httpdhttpd_110" rel="nofollow">3.1 包安装httpd并启动httpd服务</a></li><li><ul><li><a href="#311__112" rel="nofollow">3.1.1 版本说明</a></li><li><a href="#312__118" rel="nofollow">3.1.2 安装方式</a></li></ul> 
     </li><li><a href="#32_httpd24__128" rel="nofollow">3.2 httpd-2.4 相关文件</a></li><li><ul><li><a href="#321__130" rel="nofollow">3.2.1 配置文件</a></li><li><a href="#322__138" rel="nofollow">3.2.2 检查配置语法</a></li><li><a href="#323__144" rel="nofollow">3.2.3 服务单元文件</a></li><li><a href="#324__149" rel="nofollow">3.2.4 服务控制和启动</a></li><li><a href="#325__156" rel="nofollow">3.2.5 站点网页文档根目录</a></li><li><a href="#326__160" rel="nofollow">3.2.6 模块文件路径</a></li><li><a href="#327__165" rel="nofollow">3.2.7 主服务器程序文件</a></li></ul> 
    </li></ul> 
   </li></ul> 
   </li><li><a href="#httpd_169" rel="nofollow">二、httpd常见配置</a></li><li><ul><li><a href="#1_171" rel="nofollow">1、指定服务器名</a></li><li><a href="#2_190" rel="nofollow">2、包含其它配置文件</a></li><li><ul><li><a href="#21_include__202" rel="nofollow">2.1 include 子配置文件</a></li><li><a href="#22__218" rel="nofollow">2.2 总目录</a></li></ul> 
    </li><li><a href="#3_232" rel="nofollow">3、监听地址</a></li><li><a href="#4_253" rel="nofollow">4、隐藏服务器版本信息</a></li><li><a href="#5_292" rel="nofollow">5、持久连接</a></li><li><a href="#6DSO_Dynamic_Shared_Object_353" rel="nofollow">6、DSO (Dynamic Shared Object)</a></li><li><a href="#7MPM_MultiProcessing_Module_392" rel="nofollow">7、MPM (Multi-Processing Module)多路处理模块</a></li><li><a href="#8prefork_410" rel="nofollow">8、prefork模式相关的配置</a></li><li><a href="#9worker__event__456" rel="nofollow">9、worker 和 event 模式相关的配置</a></li><li><a href="#10Main_server_469" rel="nofollow">10、定义Main server的文档页面路径</a></li><li><a href="#11_516" rel="nofollow">11、定义站点默认主页面文件</a></li><li><a href="#12_536" rel="nofollow">12、虚拟主机</a></li><li><ul><li><a href="#121_ip_553" rel="nofollow">12.1 基于ip地址</a></li><li><a href="#122__615" rel="nofollow">12.2 基于端口地址</a></li><li><a href="#123__663" rel="nofollow">12.3 基于域名</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Cookiesession_712" rel="nofollow">三、Cookie和session</a></li><li><ul><li><a href="#1Cookie_742" rel="nofollow">1、Cookie</a></li><li><a href="#2Session_773" rel="nofollow">2、Session</a></li><li><ul><li><a href="#21_cookiesession_775" rel="nofollow">2.1 cookie和session的相同和不同</a></li><li><a href="#22_cookie_784" rel="nofollow">2.2 cookie缺点</a></li><li><a href="#23_session__790" rel="nofollow">2.3 session 缺点</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Web_797" rel="nofollow">四、Web相关工具</a></li><li><ul><li><a href="#1Weget_799" rel="nofollow">1、Weget相关工具</a></li><li><a href="#2curl_817" rel="nofollow">2、curl</a></li><li><a href="#3_860" rel="nofollow">3、压力测试工具</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="httpd__1"></a>一、httpd 安装组成</h3> 
<ul><li>http 服务基于 C/S 结构</li></ul> 
<h4><a id="1http__6"></a>1、常见http 服务器程序</h4> 
<ul><li><strong>httpd apache</strong>，存在C10K（10K connections）问题</li><li><strong>nginx</strong> 解决C10K问题lighttpd</li><li><strong>tomcat</strong> .jsp 应用程序服务器</li><li>IIS .asp 应用程序服务器</li><li>jetty 开源的servlet容器，基于Java的web容器</li><li>Resin CAUCHO公司，支持servlets和jsp的引擎</li><li>webshpere：IBM公司</li><li>weblogic：BEA，Oracle</li><li>jboss：RedHat，IBM</li><li>oc4j：Oracle</li></ul> 
<h4><a id="2apache__19"></a>2、apache 介绍和特点</h4> 
<h5><a id="21_apache_21"></a>2.1 关于apache</h5> 
<p>apache 名字来源，流传最广的解释是（也是最显而易见的）：这个名字来自于一个事实，当Apache在1995年初开发的时候，它是由当时最流行的HTTP服务器NCSA HTTPd 1.3的代码修改而成的，因此是"一个修补的（a patchy）”服务器。然而，在Apache服务器官方网站的FAQ中是这么解释的："Apache这个名字是为了纪念名为Apache的美洲原住民印第安人的一支，众所周知他们拥有高超的作战策略和无穷的耐性。”贝伦多夫说："我选择阿帕奇这个名字是取其积极含义。阿帕奇族是最后一个屈服于美国政府的民族。当时我们担心大公司迟早会参与竞争并‘教化’这块最早的网络之地，所以在我看来，阿帕奇是个很好的名称，也有人说这个词一语双关-因为正如Apache（与"a patchy"谐音）的名字所表明的那样，他们确实是在给服务器打补丁。”</p> 
<p><strong>apache官网:</strong></p> 
<pre><code class="prism language-bash"> www.apache.org
</code></pre> 
<p><strong>软件基金会</strong></p> 
<ul><li>ASF：apache software foundation</li><li>FSF：Free Software Foundation</li></ul> 
<h6><a id="211_apache__36"></a>2.1.1 apache 功能</h6> 
<ul><li>提供http协议服务（提供web网页）</li><li>多个虚拟主机：IP、Port、FQDN</li><li>CGI：Common Gateway Interface，通用网关接口,支持动态程序</li><li>反向代理</li><li>负载均衡</li><li>路径别名</li><li>丰富的用户认证机制：basic，digest</li><li>支持第三方模块</li></ul> 
<h6><a id="212_apache_47"></a>2.1.2 apache特性</h6> 
<ul><li>高度模块化：core + modules</li><li>DSO：Dynamic Shared Object 动态加载/卸载</li><li>MPM：multi-processing module 多路处理模块</li></ul> 
<p>**总结：**apache 功能多，稳定，善于处理静态资源</p> 
<p>**HTTP 和 Apache 之间的关系是：**HTTP定义了客户端和服务器之间的通信规则，而 Apache 是一种能够处理这些 HTTP 请求并提供网页内容的 Web 服务器软件。</p> 
<h5><a id="22_MPM_multiprocessing_module__57"></a>2.2 MPM multi-processing module 工作模式</h5> 
<h6><a id="221_prefork_59"></a>2.2.1 prefork</h6> 
<p><strong>yum安装默认的是prefork工作模式</strong></p> 
<p>多进程I/O模型，每个进程响应一个请求，CentOS 7 httpd默认模型一个主进程：生成和回收n个子进程，创建套接字，不响应请求多个子进程，工作 work进程，每个子进程处理一个请求；系统初始时，预先生成多个空闲进程，等待请求</p> 
<p>Prefork MPM预派生模式，有一个主控制进程，然后生成多个子进程，每个子进程有一个独立的线程响应用户请求，相对比较占用内存，但是比较稳定，可以设置最大和最小进程数，是最古老的一种模式，也是最稳定的模式，适用于访问量不是很大的场景</p> 
<p><img src="https://images2.imgbox.com/29/8a/aIZnAYvf_o.png" alt="image-20240314181945837"></p> 
<ul><li> <p>优点：稳定</p> </li><li> <p>缺点：慢，占用资源，不适用于高并发场景</p> </li></ul> 
<h6><a id="222_worker_74"></a>2.2.2 worker</h6> 
<ul><li>复用的多进程I/O模型，多进程多线程，IIS使用此模型</li></ul> 
<p>一个主进程：生成m个子进程，每个子进程负责生个n个线程，每个线程响应一个请求，并发响应请求：m*n</p> 
<p>worker MPM是一种多进程和多线程混合的模型，有一个控制进程，启动多个子进程，每个子进程里面包含固定的线程，使用线程程来处理请求，当线程不够使用的时候会再启动一个新的子进程，然后在进程里面再启动线程处理请求，由于其使用了线程处理请求，因此可以承受更高的并发。</p> 
<ul><li> <p>优点：相比prefork 占用的内存较少，可以同时处理更多的请求</p> </li><li> <p>缺点：使用keep-alive的长连接方式，某个线程会一直被占据，即使没有传输数据，也需要一直等待到超时才会被释放。如果过多的线程，被这样占据，也会导致在高并发场景下的无服务线程可用。（该问题在prefork模式下，同样会发生）</p> </li></ul> 
<h6><a id="223_event_87"></a>2.2.3 event</h6> 
<ul><li>事件驱动模型（worker模型的变种），CentOS8 默认模型</li></ul> 
<p>一个主进程：生成m个子进程，每个子进程负责生个n个线程，每个线程响应一个请求，并发响应请求：m*n，有专门的监控线程来管理这些keep-alive类型的线程，当有真实请求时，将请求传递给服务线程，执行完毕后，又允许释放。这样增强了高并发场景下的请求处理能力。</p> 
<p>event MPM是Apache中最新的模式，2012年发布的apache 2.4.X系列正式支持event 模型. 属于事件驱动模型(epoll)，每个进程响应多个请求，在现在版本里的已经是稳定可用的模式。它和worker模式很像，最大的区别在于，它解决了keep-alive场景下，长期被占用的线程的资源浪费问题（某些线程因为被keep-alive，空挂在哪里等待，中间几乎没有请求过来，甚至等到超时）。event MPM中，会有一个专门的线程来管理这些keep-alive类型的线程，当有真实请求过来的时候，将请求传递给服务线程，执行完毕后，又允许它释放。这样增强了高并发场景下的请求处理能力event只在有数据发送的时候才开始建立连接，连接请求才会触发工作线程，即使用了TCP的一个选项，叫做延迟接受连接TCP_DEFER_ACCEPT，加了这个选项后，若客户端只进行TCP连接，不发送请求，则不会触发Accept操作，也就不会触发工作线程去干活，进行了简单的防攻击（TCP连接）</p> 
<p><img src="https://images2.imgbox.com/60/50/1H0JubxW_o.png" alt="image-20240314182840638"></p> 
<p><img src="https://images2.imgbox.com/9b/c0/c4QuLebC_o.png" alt="image-20240314182950361"></p> 
<ul><li> <p>优点：单线程响应多请求，占据更少的内存，高并发下表现更优秀，会有一个专门的线程来管理keep-alive类型的线程，当有真实请求过来的时候，将请求传递给服务线程，执行完毕后，又允许它释放</p> </li><li> <p>缺点：没有线程安全控制</p> </li></ul> 
<p>httpd-2.4：event 稳定版，centos7 以后默认</p> 
<p>httpd-2.2：event 测试版，centos6 默认</p> 
<h4><a id="3Httpd__108"></a>3、Httpd 安装和相关文件</h4> 
<h5><a id="31_httpdhttpd_110"></a>3.1 包安装httpd并启动httpd服务</h5> 
<h6><a id="311__112"></a>3.1.1 版本说明</h6> 
<p>CentOS 7 以上，默认系统是httpd 2.4，CentOS 6 版默认为httpd 2.2</p> 
<p>Ubuntu 18.04 默认 Apache/2.4.29</p> 
<h6><a id="312__118"></a>3.1.2 安装方式</h6> 
<ul><li>包安装: centos发行版，稳定，建议使用</li><li>编译：定制或特殊需求</li></ul> 
<pre><code class="prism language-bash">yum  <span class="token function">install</span>   httpd <span class="token parameter variable">-y</span>
<span class="token comment">#安装httpd 2.4</span>
</code></pre> 
<h5><a id="32_httpd24__128"></a>3.2 httpd-2.4 相关文件</h5> 
<h6><a id="321__130"></a>3.2.1 配置文件</h6> 
<ul><li>/etc/httpd/conf/httpd.conf 主配置文件</li><li>/etc/httpd/conf.d/*.conf 子配置文件</li><li>/etc/httpd/conf.d/conf.modules.d/ 模块加载的配置文件</li></ul> 
<p><img src="https://images2.imgbox.com/84/09/YVHzFWf7_o.png" alt="image-20240314185418293"></p> 
<h6><a id="322__138"></a>3.2.2 检查配置语法</h6> 
<ul><li>httpd -t 或 apache2 -t</li></ul> 
<p><img src="https://images2.imgbox.com/2c/4e/UPUBZxa9_o.png" alt="image-20240314185645130"></p> 
<h6><a id="323__144"></a>3.2.3 服务单元文件</h6> 
<ul><li>/usr/lib/systemd/system/httpd.service</li><li>配置文件：/etc/sysconfig/httpd</li></ul> 
<h6><a id="324__149"></a>3.2.4 服务控制和启动</h6> 
<ul><li>systemctl enable|disable httpd.service</li><li>systemctl {start|stop|restart|status|reload} httpd.service</li><li>apachectl start|stop|restart|configtest</li><li>service httpd start|stop|restart|configtest</li></ul> 
<h6><a id="325__156"></a>3.2.5 站点网页文档根目录</h6> 
<p>httpd主页面位置：/var/www/html/index.html</p> 
<h6><a id="326__160"></a>3.2.6 模块文件路径</h6> 
<ul><li>/etc/httpd/modules</li><li>/usr/lib64/httpd/modules</li></ul> 
<h6><a id="327__165"></a>3.2.7 主服务器程序文件</h6> 
<ul><li>/usr/sbin/httpd</li></ul> 
<h3><a id="httpd_169"></a>二、httpd常见配置</h3> 
<h4><a id="1_171"></a>1、指定服务器名</h4> 
<pre><code class="prism language-bash">httpd <span class="token parameter variable">-t</span>
<span class="token comment">#检查语法</span>

<span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> /etc/httpd/conf/httpd.conf
 <span class="token number">95</span> ServerName www.example.com:80
<span class="token comment">#取消95行注释</span>

httpd <span class="token parameter variable">-t</span>
<span class="token comment">#再次查看语法问题</span>

<span class="token comment">##注意：修改配置文件之前最好先备份，以防修改错误</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f5/3a/cTBpX17X_o.png" alt="image-20240314192754039"></p> 
<h4><a id="2_190"></a>2、包含其它配置文件</h4> 
<pre><code class="prism language-bash">Include file-path<span class="token operator">|</span>directory-path<span class="token operator">|</span>wildcard
IncludeOptional file-path<span class="token operator">|</span>directory-path<span class="token operator">|</span>wildcard
</code></pre> 
<p><strong>说明：</strong></p> 
<ul><li>Include和IncludeOptional功能相同，都可以包括其它配置文件</li><li>但是当无匹配文件时，include会报错，IncludeOptional会忽略错误</li></ul> 
<h5><a id="21_include__202"></a>2.1 include 子配置文件</h5> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost conf<span class="token punctuation">]</span><span class="token comment">#grep -i include /etc/httpd/conf/httpd.conf</span>
Include conf.modules.d/*.conf
    <span class="token comment">#   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews</span>
<span class="token comment"># Possible values include: debug, info, notice, warn, error, crit,</span>
    <span class="token comment"># If you include a trailing / on /webpath then the server will</span>
    <span class="token comment"># To parse .shtml files for server-side includes (SSI):</span>
    <span class="token comment"># (You will also need to add "Includes" to the "Options" directive.)</span>
    AddOutputFilter INCLUDES .shtml
IncludeOptional conf.d/*.conf
</code></pre> 
<p><img src="https://images2.imgbox.com/bb/5a/3xlmf4b5_o.png" alt="image-20240314193239041"></p> 
<h5><a id="22__218"></a>2.2 总目录</h5> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost conf<span class="token punctuation">]</span><span class="token comment">#grep -i serverroot /etc/httpd/conf/httpd.conf</span>
<span class="token comment"># with "/", the value of ServerRoot is prepended -- so 'log/access_log'</span>
<span class="token comment"># with ServerRoot set to '/www' will be interpreted by the</span>
<span class="token comment"># ServerRoot: The top of the directory tree under which the server's</span>
<span class="token comment"># ServerRoot at a non-local disk, be sure to specify a local disk on the</span>
<span class="token comment"># same ServerRoot for multiple httpd daemons, you will need to change at</span>
ServerRoot <span class="token string">"/etc/httpd"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9c/9e/cLXJ4e6g_o.png" alt="image-20240314193340762"></p> 
<h4><a id="3_232"></a>3、监听地址</h4> 
<pre><code class="prism language-bash">Listen <span class="token punctuation">[</span>IP:<span class="token punctuation">]</span>PORT
</code></pre> 
<p><strong>说明：</strong></p> 
<ul><li> <p>省略IP表示为本机所有IP</p> </li><li> <p>Listen指令至少一个，可重复出现多次</p> </li></ul> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/httpd/conf/httpd.conf
<span class="token number">42</span> Listen <span class="token number">80</span>
<span class="token comment">#监听本机所有的80端口</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6a/dd/E5k0FN4p_o.png" alt="image-20240314193652433"></p> 
<h4><a id="4_253"></a>4、隐藏服务器版本信息</h4> 
<p><strong>语法：</strong></p> 
<pre><code class="prism language-http">ServerTokens Major|Minor|Min[imal]|Prod[uctOnly]|OS|Full
</code></pre> 
<p><strong>相关指令：</strong></p> 
<pre><code class="prism language-http">ServerTokens Prod[uctOnly] ：Server: Apache
ServerTokens Major: Server: Apache/2
ServerTokens Minor: Server: Apache/2.0
ServerTokens Min[imal]: Server: Apache/2.0.41
ServerTokens OS: Server: Apache/2.0.41 (Unix)
ServerTokens Full (or not specified): Server: Apache/2.0.41 (Unix) PHP/4.2.2 MyMod/1.2 此为默认值
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#curl -I 192.168.10.11</span>
<span class="token comment">#访问192.168.10.11，可以看到版本号</span>

<span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> /etc/httpd/conf/httpd.conf
servertokens prod
<span class="token comment">#在空白地方，添加此行（大小写不敏感）</span>

systemctl restart httpd
<span class="token comment">#重启服务</span>

<span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#curl -I 192.168.10.11</span>
<span class="token comment">#此时查看，版本号隐藏</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fe/d8/q8cfbbOo_o.png" alt="image-20240314221747122"></p> 
<p><img src="https://images2.imgbox.com/1e/ca/BL2o2Zrm_o.png" alt="image-20240314221916801"></p> 
<h4><a id="5_292"></a>5、持久连接</h4> 
<p>Persistent Connection：连接建立，每个资源获取完成后不会断开连接，而是继续等待其它的请求完成，默认开启持久连接</p> 
<p><strong>断开条件：</strong></p> 
<ul><li>时间限制：以秒为单位， 默认5s，httpd-2.4 支持毫秒级</li><li>请求数量：请求数达到指定值，也会断开</li></ul> 
<p>**副作用：**对并发访问量大的服务器，持久连接会使有些请求得不到响应</p> 
<p>**折中：**使用较短的持久连接时间</p> 
<p><strong>相关指令：</strong></p> 
<pre><code class="prism language-http">KeepAlive On|Off
KeepAliveTimeout 15      #连接持续15s,可以以ms为单位,默认值为5s
MaxKeepAliveRequests 500  #持久连接最大接收的请求数,默认值100
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> /etc/httpd/conf/httpd.conf
Listen <span class="token number">80</span>
KeepAlive On            <span class="token comment">#默认开启长连接</span>
KeepAliveTimeout <span class="token number">300</span>    <span class="token comment">#超时时间300s</span>
MaxKeepAliveRequests <span class="token number">2</span>  <span class="token comment">#最大接受请求数为2</span>

<span class="token builtin class-name">cd</span> /var/www/html
<span class="token comment">#切换目录</span>

<span class="token builtin class-name">echo</span> x <span class="token operator">&gt;</span> x
<span class="token builtin class-name">echo</span> x1 <span class="token operator">&gt;</span>x1
<span class="token builtin class-name">echo</span> x2 <span class="token operator">&gt;</span> x2
<span class="token comment">#写入文件</span>

systemctl restart httpd
<span class="token comment">#重启服务</span>

<span class="token comment">#使用telnet命令模拟长连接</span>
<span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#telnet 192.168.10.11 80</span>
GET /x HTTP/1.1
HOST:www.a.com
<span class="token comment">#输入之后，回车，第一次连接</span>

GET /x1 HTTP/1.1
HOST:www.a.com
<span class="token comment">#输入之后，回车，第二次连接</span>

GET /x2 HTTP/1.1
HOST:www.a.com
<span class="token comment">#输入之后，回车，第三次连接，超过两次连接，会自动退出</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c8/b4/ofskmGGV_o.png" alt="image-20240314224859952"></p> 
<p><img src="https://images2.imgbox.com/77/9b/DfLhfv9o_o.png" alt="image-20240314230259724"></p> 
<p><img src="https://images2.imgbox.com/a7/b5/2mRtbrxF_o.png" alt="image-20240314225707834"></p> 
<h4><a id="6DSO_Dynamic_Shared_Object_353"></a>6、DSO (Dynamic Shared Object)</h4> 
<p><strong>Dynamic Shared Object</strong>，加载动态模块配置，不需重启即生效动态模块所在路径： /usr/lib64/httpd/modules/</p> 
<p>主配置 <strong>/etc/httpd/conf/httpd.conf</strong> 文件中指定加载模块配置文件</p> 
<pre><code class="prism language-http">ServerRoot "/etc/httpd"
Include conf.modules.d/*.conf
</code></pre> 
<pre><code class="prism language-bash">httpd <span class="token parameter variable">-l</span>    <span class="token comment">#查看静态编译的模块</span>

httpd <span class="token parameter variable">-M</span>    <span class="token comment">#查看静态编译及动态加载的模块</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e3/2c/ALz3NIfL_o.png" alt="image-20240314231436849"></p> 
<pre><code class="prism language-bash">httpd <span class="token parameter variable">-M</span> <span class="token operator">|</span><span class="token function">grep</span> basic
<span class="token comment">#过滤basic模块</span>

<span class="token builtin class-name">cd</span> /etc/httpd/conf.modules.d
<span class="token comment">#切换目录</span>

<span class="token comment">#编辑模块配置文件</span>
<span class="token function">vim</span> 00-base.conf
 <span class="token number">10</span> <span class="token comment">#LoadModule auth_basic_module modules/mod_auth_basic.so</span>
<span class="token comment">#将basic模块行注释掉</span>

httpd <span class="token parameter variable">-M</span> <span class="token operator">|</span><span class="token function">grep</span> basic
<span class="token comment">#此时过滤basic模块，不会显示basic模块</span>

<span class="token comment">##可以使用此方法，注释掉不需要的模块</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e3/d5/amAWQiXl_o.png" alt="image-20240314232155486"></p> 
<h4><a id="7MPM_MultiProcessing_Module_392"></a>7、MPM (Multi-Processing Module)多路处理模块</h4> 
<p>httpd 支持三种MPM工作模式：prefork, worker, event</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /etc/httpd/conf.modules.d
<span class="token comment">#切换目录</span>

<span class="token comment">#配置文件</span>
<span class="token function">vim</span> 00-mpm.conf
<span class="token comment">#LoadModule mpm_prefork_module modules/mod_mpm_prefork.so</span>
<span class="token comment">#LoadModule mpm_worker_module modules/mod_mpm_worker.so</span>
LoadModule mpm_event_module modules/mod_mpm_event.so
<span class="token comment">#三种工作模式，只能开启一种，不能同时开启</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e9/c9/ZZbgqQje_o.png" alt="image-20240314233231609"></p> 
<h4><a id="8prefork_410"></a>8、prefork模式相关的配置</h4> 
<pre><code class="prism language-bash">StartServers     <span class="token number">100</span>  <span class="token comment">#一开始开启进程100个</span>
MinSpareServers   <span class="token number">50</span>  <span class="token comment">#如果一直空闲，最少预留50个进程</span>
MaxSpareServers   <span class="token number">80</span>  <span class="token comment">#如果空闲，最多预留80个</span>
ServerLimit     <span class="token number">2560</span>  <span class="token comment">#最多进程数,最大值20000</span>
MaxRequestWorkers    <span class="token number">2560</span>  <span class="token comment">#最大的并发连接数，默认256</span>
MaxConnectionsPerChild  <span class="token number">4000</span>  <span class="token comment">#子进程最多能处理的请求数量。在处理MaxRequestsPerChild 个请求之后,子进程将会被父进程终止，这时候子进程占用的内存就会释放(为0时永远不释放）</span>
MaxRequestsPerChild <span class="token number">4000</span>  <span class="token comment">#从httpd.2.3.9开始被MaxConnectionsPerChild代替</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /etc/httpd/conf.modules.d
<span class="token comment">#切换目录</span>

<span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> 00-mpm.conf
LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
<span class="token comment">#开启prefork工作模式</span>

systemctl restart httpd
<span class="token comment">#重启服务</span>

pstree <span class="token parameter variable">-p</span> <span class="token operator">|</span><span class="token function">grep</span> httpd
<span class="token comment">#查看httpd服务进程，此时开启4个</span>

<span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> 00-mpm.conf
startservers <span class="token number">8</span>
<span class="token comment">#设置httpd服务最开始进程数为8个</span>

httpd <span class="token parameter variable">-t</span>
<span class="token comment">#检查语法</span>

systemctl restart httpd
<span class="token comment">#重启服务</span>

pstree <span class="token parameter variable">-p</span> <span class="token operator">|</span><span class="token function">grep</span> httpd
<span class="token comment">#查看httpd服务进程，此时开启8个</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3f/30/LxZ97XPI_o.png" alt="image-20240314234107985"></p> 
<p><img src="https://images2.imgbox.com/9f/0b/7A2ZIl94_o.png" alt="image-20240314234331424"></p> 
<h4><a id="9worker__event__456"></a>9、worker 和 event 模式相关的配置</h4> 
<pre><code class="prism language-bash">ServerLimit         <span class="token number">16</span>  <span class="token comment">#最多进程数,最大值20000</span>
processes               <span class="token comment">#启动时创建的工作进程数量</span>
StartServers        <span class="token number">10</span>  <span class="token comment">#一开始开启进程10个</span>
MaxRequestWorkers  <span class="token number">150</span>  <span class="token comment">#最大的并发连接数，默认256</span>
simultaneously         
MinSpareThreads     <span class="token number">25</span>  
MaxSpareThreads     <span class="token number">75</span>  
ThreadsPerChild     <span class="token number">25</span>  <span class="token comment">#一个进程中，可以开启多少个子线程</span>
</code></pre> 
<h4><a id="10Main_server_469"></a>10、定义Main server的文档页面路径</h4> 
<pre><code class="prism language-http">DocumentRoot   "/path”
&lt;directory /path&gt;
 Require all granted
&lt;/directory&gt;
</code></pre> 
<p><strong>说明：</strong></p> 
<ul><li>DocumentRoot指向的路径为URL路径的起始位置</li><li>/path 必须显式授权后才可以访问</li></ul> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /etc/httpd/conf
<span class="token comment">#切换目录</span>

<span class="token comment">#编辑配置文件</span>
<span class="token function">vim</span> httpd.conf
DocumentRoot <span class="token string">"/data/html"</span>
<span class="token comment">#修改页面路径</span>
<span class="token operator">&lt;</span>Directory <span class="token string">"/data/html"</span><span class="token operator">&gt;</span>
    <span class="token comment"># Allow open access:</span>
    Require all granted
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
<span class="token comment">#为主页面文件授权</span>

<span class="token function">mkdir</span> /data/html <span class="token parameter variable">-p</span>
<span class="token comment">#创建文件夹</span>

<span class="token builtin class-name">cd</span> /data/html
<span class="token comment">#切换目录</span>

<span class="token builtin class-name">echo</span> this is zhuyemian <span class="token operator">&gt;</span> index.html
<span class="token comment">#主页面文件写入内容</span>

<span class="token comment">##验证</span>
<span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#curl 192.168.10.11</span>
this is zhuyemian
<span class="token comment">#显示设置的主页面内容</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ac/49/Go7KvoHq_o.png" alt="image-20240315001303127"></p> 
<p><img src="https://images2.imgbox.com/fe/47/SUqWGm5X_o.png" alt="image-20240315001357407"></p> 
<h4><a id="11_516"></a>11、定义站点默认主页面文件</h4> 
<pre><code class="prism language-http">DirectoryIndex index.php index.html
</code></pre> 
<p><strong>针对目录和URL实现访问控制</strong></p> 
<p>Options指令:</p> 
<ul><li>后跟1个或多个以空白字符分隔的选项列表，在选项前的+，-表示增加或删除指定选项</li></ul> 
<p><strong>常见选项:</strong></p> 
<ul><li>Indexes：指明的URL路径下不存在与定义的主页面资源相符的资源文件时，返回索引列表给用 户</li><li>FollowSymLinks：允许访问符号链接文件所指向的源文件。</li><li>None：全部禁用</li><li>AIl：全部允许<br> <strong>Options 可以写在目录里&lt;&gt; ，也可以写在外面</strong></li></ul> 
<h4><a id="12_536"></a>12、虚拟主机</h4> 
<ul><li>httpd 支持在一台物理主机上实现多个网站，即多虚拟主机</li></ul> 
<p><strong>网站的唯一标识：</strong></p> 
<ul><li>IP相同，但端口不同</li><li>IP不同，但端口均为默认端口</li><li>FQDN（域名）不同, IP和端口都相同</li></ul> 
<p><strong>多虚拟主机有三种实现方案：</strong></p> 
<ul><li>基于ip：为每个虚拟主机准备至少一个ip地址</li><li>基于port（端口）：为每个虚拟主机使用至少一个独立的port</li><li>基于FQDN（域名）：为每个虚拟主机使用至少一个FQDN，请求报文中首部</li></ul> 
<h5><a id="121_ip_553"></a>12.1 基于ip地址</h5> 
<pre><code class="prism language-bash"><span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> /etc/httpd/conf/httpd.conf
<span class="token operator">&lt;</span>VirtualHost <span class="token number">192.168</span>.10.1<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
    ServerAdmin support@jfedu.net
    DocumentRoot <span class="token string">"/data/html/11"</span>
    ServerName www.accp.com
    ErrorLog <span class="token string">"logs/11_error_log"</span>
    CustomLog <span class="token string">"logs/11_access_log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>VirtualHost <span class="token number">192.168</span>.10.2<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
    ServerAdmin support@jfedu.net
    DocumentRoot <span class="token string">"/data/html/22"</span>
    ServerName www.accp.com
    ServerAlias www.dummy-host.example.com
    ErrorLog <span class="token string">"logs/22_error_log"</span>
    CustomLog <span class="token string">"logs/22_access_log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>Directory <span class="token string">"/data/html"</span><span class="token operator">&gt;</span>
    <span class="token comment"># Allow open access:</span>
    Require all granted
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>
<span class="token comment">#授权</span>

<span class="token builtin class-name">cd</span> /data/html/
<span class="token comment">#切换目录</span>

<span class="token function">mkdir</span> <span class="token number">11</span>
<span class="token function">mkdir</span> <span class="token number">22</span>
<span class="token comment">#创建文件夹</span>

<span class="token builtin class-name">echo</span> <span class="token number">11</span> <span class="token operator">&gt;</span> <span class="token number">11</span>/index.html
<span class="token builtin class-name">echo</span> <span class="token number">22</span> <span class="token operator">&gt;</span> <span class="token number">22</span>/index.html
<span class="token comment">#写入页面内容</span>

httpd <span class="token parameter variable">-t</span>
<span class="token comment">#检查语法</span>

systemctl restart httpd
<span class="token comment">#重启服务</span>

<span class="token function">ifconfig</span> ens33:0 <span class="token number">192.168</span>.10.22/24
<span class="token comment">#添加临时网卡</span>

<span class="token comment">##验证</span>
<span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#curl 192.168.10.11</span>
<span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#curl 192.168.10.22</span>
<span class="token comment">#使用另一台设备访问</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3c/c6/RjQMLR07_o.png" alt="image-20240315210425025"></p> 
<p><img src="https://images2.imgbox.com/5a/e2/vmmyyn7G_o.png" alt="image-20240315210527954"></p> 
<ul><li>验证</li></ul> 
<p><img src="https://images2.imgbox.com/7c/ca/shgD8DGE_o.png" alt="image-20240315210643656"></p> 
<h5><a id="122__615"></a>12.2 基于端口地址</h5> 
<pre><code class="prism language-bash"><span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> /etc/httpd/conf/httpd.conf
Listen <span class="token number">80</span>
Listen <span class="token number">1128</span>
<span class="token comment">#加入需要监听的新端口号</span>
KeepAlive On
KeepAliveTimeout <span class="token number">300</span>
MaxKeepAliveRequests <span class="token number">2</span>
<span class="token operator">&lt;</span>VirtualHost <span class="token number">192.168</span>.10.11:8<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>
    ServerAdmin support@jfedu.net
    DocumentRoot <span class="token string">"/data/html/11"</span>
    ServerName www.accp.com
    ErrorLog <span class="token string">"logs/11_error_log"</span>
    CustomLog <span class="token string">"logs/11_access_log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>VirtualHost <span class="token number">192.168</span>.10.11:112<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span>
    ServerAdmin support@jfedu.net
    DocumentRoot <span class="token string">"/data/html/22"</span>
    ServerName www.accp.com
    ServerAlias www.dummy-host.example.com
    ErrorLog <span class="token string">"logs/22_error_log"</span>
    CustomLog <span class="token string">"logs/22_access_log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>Directory <span class="token string">"/data/html"</span><span class="token operator">&gt;</span>
    <span class="token comment"># Allow open access:</span>
    Require all granted
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>

systemctl restart httpd
<span class="token comment">#重启服务</span>

<span class="token comment">##验证</span>
<span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#curl 192.168.10.11</span>
<span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#curl 192.168.10.11:1128</span>
<span class="token comment">#使用另一台设备访问</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d8/86/SxkQfsbQ_o.png" alt="image-20240316103916909"></p> 
<ul><li>验证</li></ul> 
<p><img src="https://images2.imgbox.com/00/9c/1Zo5U1rj_o.png" alt="image-20240316103944676"></p> 
<h5><a id="123__663"></a>12.3 基于域名</h5> 
<pre><code class="prism language-bash"><span class="token comment">#修改配置文件</span>
<span class="token function">vim</span> /etc/httpd/conf/httpd.conf
<span class="token operator">&lt;</span>VirtualHost <span class="token number">192.168</span>.10.1<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
    ServerAdmin support@jfedu.net
    DocumentRoot <span class="token string">"/data/html/11"</span>
    ServerName www.lucky.com
    ErrorLog <span class="token string">"logs/11_error_log"</span>
    CustomLog <span class="token string">"logs/11_access_log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>VirtualHost <span class="token number">192.168</span>.10.1<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
    ServerAdmin support@jfedu.net
    DocumentRoot <span class="token string">"/data/html/22"</span>
    ServerName www.work.com
    ServerAlias www.dummy-host.example.com
    ErrorLog <span class="token string">"logs/22_error_log"</span>
    CustomLog <span class="token string">"logs/22_access_log"</span> common
<span class="token operator">&lt;</span>/VirtualHost<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>Directory <span class="token string">"/data/html"</span><span class="token operator">&gt;</span>
    <span class="token comment"># Allow open access:</span>
    Require all granted
<span class="token operator">&lt;</span>/Directory<span class="token operator">&gt;</span>

systemctl restart httpd
<span class="token comment">#重启服务</span>

<span class="token comment">#访问的设备需要添加域名解析</span>
<span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#vim /etc/hosts</span>
<span class="token number">192.168</span>.10.11  www.lucky.com  www.work.com


<span class="token comment">##验证</span>
<span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#curl www.lucky.com</span>
<span class="token punctuation">[</span>root@liuyanfen12 ~<span class="token punctuation">]</span><span class="token comment">#curl www.work.com</span>
<span class="token comment">#使用另一台设备访问</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c3/1f/tgD0pChu_o.png" alt="image-20240315213514369"></p> 
<ul><li>验证</li></ul> 
<p><img src="https://images2.imgbox.com/e7/76/Yxs40ByX_o.png" alt="image-20240315213548457"></p> 
<p><img src="https://images2.imgbox.com/a7/4b/C3jgago1_o.png" alt="image-20240315213356570"></p> 
<h3><a id="Cookiesession_712"></a>三、Cookie和session</h3> 
<p>无状态协议是指协议对事物处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它应答就很快。</p> 
<p>HTTP是超本文传输协议，顾名思义，这个协议支持超文本的传输。什么是超文本？说白了就是使用HTML编写的页面。通常，我们使用客户端浏览器访问服务器的资源，最常见的URL也是以html为后缀的文件，因此可以说超文本是网络上最主要的资源。</p> 
<p>既然HTTP协议的目的是在于支持超文本的传输，也就是资源的传输，那么客户端浏览器向HTTP服务器发送请求，继而HTTP服务器将相信资源发回给客户端这样一个过程中，无论对于客户端还是服务器，都没有必要记录这个过程，因为每一次请求和响应都是相对独立的，一般而言，一个URL对应着一个唯一的超文本，正是因为这样的唯一性，使得记录用户的行为状态变得毫无意义，所以，HTTP协议被设计为无状态的连接协议符合它本身的需求。</p> 
<p>HTTP协议这种特性有优点也有缺点，优点在于解放了服务器，每一次请求"点到为止"，不会造成不必要的连接占用，缺点在于如果为了保留状态，每次请求都会传输大量的重复信息内容。</p> 
<p>可是随着 Web 的不断发展，很多业务都需要对通信状态进行保存.如果是一次性会话的过程： 打开浏览器 -&gt; 访问一些服务器内容 -&gt; 关闭浏览器但目前有很多WEB访问场景，并不是一次性会话，而是多次相关的会话，比如：</p> 
<ul><li>登录场景：</li></ul> 
<p>打开浏览器 -&gt; 浏览到登陆页面 -&gt; 输入用户名和密码 -&gt; 访问到用户主页(显示用户名) -&gt; 修改密码（输入原密码）-&gt; 修改收货地址…</p> 
<p>问题：在此处登录会话过程中产生的数据（用户会话数据）如何保存下来呢？</p> 
<ul><li>购物场景：</li></ul> 
<p>打开浏览器 -&gt; 浏览商品列表 -&gt; 加入购物车(把商品信息保存下来) -&gt; 关闭浏览器打开浏览器-&gt; 直接进入购物车 -&gt; 查看到上次加入购物车的商品 -&gt; 下订单 -&gt; 支付</p> 
<p>问题： 在购物会话过程中，如何保存商品信息？</p> 
<p>以上场景都需要保留会话数据，需要会话管理机制。</p> 
<p><strong>会话管理： 管理浏览器客户端和服务器端之间会话过程中产生的会话数据。</strong></p> 
<p>为了会话管理，HTTP就需要传输大量重复信息内容的问题，造成大量的网络带宽消耗。于是 Cookie 和Session 技术闪亮登场了，它们可以为用户进行会话管理，实现保存状态。</p> 
<h4><a id="1Cookie_742"></a>1、Cookie</h4> 
<p>Cookie 又称为"小甜饼”。类型为"小型文本文件”，指某些网站为了辨别用户身份而储存在用户本地终端（Client Side）上的数据（通常经过加密）。由网景公司的前雇员卢·蒙特利在1993年3月发明</p> 
<p>因为HTTP协议是无状态的，即服务器不知道用户上一次做了什么，这严重阻碍了交互式Web应用程序的实现。在典型的网上购物场景中，用户浏览了几个页面，买了一盒饼干和两瓶饮料。最后结帐时，由于HTTP的无状态性，不通过额外的手段，服务器并不知道用户到底买了什么，所以Cookie就是用来绕开HTTP的无状态性的"额外手段”之一。服务器可以设置或读取Cookies中包含信息，借此维护用户跟服务器会话中的状态。</p> 
<p>在上面的购物场景中，当用户选购了第一项商品，服务器在向用户发送网页的同时，还发送了一段Cookie，记录着那项商品的信息。当用户访问另一个页面，浏览器会把Cookie发送给服务器，于是服务器知道他之前选购了什么。用户继续选购饮料，服务器就在原来那段Cookie里追加新的商品信息。结帐时，服务器读取发送来的Cookie就行了。</p> 
<p>Cookie基于HTTP协议，也叫Web Cookie或浏览器Cookie，是服务器发送到用户浏览器并保存在客户端本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。通常，它用于告知服务端两个请求是否来自同一浏览器，如保持用户的登录状态。Cookie使基于无状态的HTTP协议记录稳定的状态信息成为了可能。</p> 
<pre><code class="prism language-bash"><span class="token comment">#第一次请求过程</span>
浏览器第一次发送请求时,不会携带任何cookie信息
服务器接收到请求之后，发现请求中没有任何cookie信息
服务器生成和设置一个cookie.并将此cookie设置通过set_cookie的首部字段保存在响应报文中返回给浏览器
浏览器接收到这个响应报文之后,发现里面有cookie信息,浏览器会将cookie信息保存起来

<span class="token comment">#第二次及其之后的过程</span>
当浏览器第二次及其之后的请求报文中自动 cookie的首部字段携带第一次响应报文中获取的cookie信息
服务器再次接收到请求之后,会发现请求中携带的cookie信息,这样的话就认识是谁发的请求了
之后的响应报文中不会再添加set_cookie首部字段
</code></pre> 
<p><strong>Cookie主要用于以下三个方面：</strong></p> 
<ul><li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li><li>个性化设置（如用户自定义设置、主题等）</li><li>浏览器行为跟踪（如跟踪分析用户行为等）</li></ul> 
<p>Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。当服务器收到HTTP请求时，服务器可以在响应头里面添加一个Set-Cookie选项。浏览器收到响应后通常会保存下Cookie，之后对该服务器每一次请求中都通过Cookie请求头部将Cookie信息发送给服务器。服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息.另外，Cookie的过期时间、域、路径、有效期、适用站点都可以根据需要来指定。</p> 
<h4><a id="2Session_773"></a>2、Session</h4> 
<h5><a id="21_cookiesession_775"></a>2.1 cookie和session的相同和不同</h5> 
<ul><li>cookie通常是在服务器生成,但也可以在客户端生成,session是在服务器端生成的</li><li>session 将数据信息保存在服务器端，可以是内存，文件，数据库等多种形式,cookie 将数据保存在客户端的内存或文件中</li><li>单个cookie保存的数据不能超过4K，每个站点cookie个数有限制，比如IE8为50个、Firefox为50个、Opera为30个；session存储在服务器，没有容量限制</li><li>cookie存放在用户本地，可以被轻松访问和修改，安全性不高；session存储于服务器，比较安全</li><li>cookie有会话cookie和持久cookie，生命周期为浏览器会话期的会话cookie保存在缓存，关闭浏览器窗口就消失，持久cookie被保存在硬盘，知道超过设定的过期时间；随着服务端session存储压力增大，会根据需要定期清理session数据</li><li>session中有众多数据，只将sessionID这一项可以通过cookie发送至客户端进行保留，客户端下次访问时，在请求报文中的cookie会自动携带sessionID，从而和服务器上的的session进行关联</li></ul> 
<h5><a id="22_cookie_784"></a>2.2 cookie缺点</h5> 
<ul><li> <p>使用cookie来传递信息，随着cookie个数的增多和访问量的增加，它占用的网络带宽也很大，试想假如cookie占用200字节，如果一天的PV有几个亿，那么它要占用多少带宽？</p> </li><li> <p>cookie并不安全，因为cookie是存放在客户端的，所以这些cookie可以被访问到，设置可以通过插件添加、修改cookie。所以从这个角度来说，我们要使用sesssion，session是将数据保存在服务端的，只是通过cookie传递一个sessionId而已，所以session更适合存储用户隐私和重要的数据</p> </li></ul> 
<h5><a id="23_session__790"></a>2.3 session 缺点</h5> 
<ul><li> <p>不容易在多台服务器之间共享，可以使用session绑定，session复制，session共享解决</p> </li><li> <p>session存放在服务器中，所以session如果太多会非常消耗服务器的性能cookie和session各有优缺点，在大型互联网系统中，单独使用cookie和session都是不可行的</p> </li></ul> 
<h3><a id="Web_797"></a>四、Web相关工具</h3> 
<h4><a id="1Weget_799"></a>1、Weget相关工具</h4> 
<p><strong>格式：</strong></p> 
<pre><code class="prism language-bash"><span class="token function">wget</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token punctuation">[</span>URL<span class="token punctuation">]</span><span class="token punctuation">..</span>.
</code></pre> 
<p><strong>常用选项：</strong></p> 
<pre><code class="prism language-bash"><span class="token parameter variable">-q</span> 静默模式
<span class="token parameter variable">-c</span> 断点续传
<span class="token parameter variable">-P</span> /path 保存在指定目录
<span class="token parameter variable">-O</span> filename 保存为指定文件名，filename 为 - 时，发送至标准输出
--limit-rate<span class="token operator">=</span> 指定传输速率，单位K，M等
</code></pre> 
<h4><a id="2curl_817"></a>2、curl</h4> 
<p>curl是基于URL语法在命令行方式下工作的文件传输工具，它支持FTP, FTPS, HTTP, HTTPS, GOPHER, TELNET, DICT, FILE及LDAP等协议。curl支持HTTPS认证，并且支持HTTP的POST、PUT等方法， FTP上传， kerberos认证，HTTP上传，代理服务器，cookies，用户名/密码认证， 下载文件断点续传，上载文件断点续传, http代理服务器管道（ proxy tunneling），还支持IPv6，socks5代理服务器，通过http代理服务器上传文件到FTP服务器等，功能十分强大</p> 
<p><strong>格式：</strong></p> 
<pre><code class="prism language-bash"><span class="token function">curl</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>URL<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre> 
<p><strong>选项：</strong></p> 
<pre><code class="prism language-bash">-A/--user-agent <span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> 设置用户代理发送给服务器
-e/--referer <span class="token operator">&lt;</span>URL<span class="token operator">&gt;</span> 来源网址
<span class="token parameter variable">--cacert</span> <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span> CA证书 <span class="token punctuation">(</span>SSL<span class="token punctuation">)</span>
-k/--insecure   允许忽略证书进行 SSL 连接
<span class="token parameter variable">--compressed</span> 要求返回是压缩的格式
-H/--header "key:value” 自定义首部字段传递给服务器
<span class="token parameter variable">-i</span> 显示页面内容，包括报文首部信息
-I/--head 只显示响应报文首部信息
-D/--dump-header <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span>将url的header信息存放在指定文件中
<span class="token parameter variable">--basic</span> 使用HTTP基本认证
-u/--user <span class="token operator">&lt;</span>user<span class="token punctuation">[</span>:password<span class="token punctuation">]</span><span class="token operator">&gt;</span>设置服务器的用户和密码
<span class="token parameter variable">-L</span>   如果有3xx响应码，重新发请求到新位置
<span class="token parameter variable">-O</span> 使用URL中默认的文件名保存文件到本地
<span class="token parameter variable">-o</span> <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span> 将网络文件保存为指定的文件中
--limit-rate <span class="token operator">&lt;</span>rate<span class="token operator">&gt;</span> 设置传输速度
-0/--http1.0 数字0，使用HTTP <span class="token number">1.0</span>
-v/--verbose 更详细
<span class="token parameter variable">-C</span> 选项可对文件使用断点续传功能
-c/--cookie-jar <span class="token operator">&lt;</span>file name<span class="token operator">&gt;</span> 将url中cookie存放在指定文件中
-x/--proxy <span class="token operator">&lt;</span>proxyhost<span class="token punctuation">[</span>:port<span class="token punctuation">]</span><span class="token operator">&gt;</span> 指定代理服务器地址
-X/--request <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> 向服务器发送指定请求方法
-U/--proxy-user <span class="token operator">&lt;</span>user:password<span class="token operator">&gt;</span> 代理服务器用户和密码
<span class="token parameter variable">-T</span> 选项可将指定的本地文件上传到FTP服务器上
--data/-d 方式指定使用POST方式传递数据
<span class="token parameter variable">-s</span> <span class="token parameter variable">--silent</span>   Silent mode
<span class="token parameter variable">-b</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>data 从服务器响应set-cookie得到值，返回给服务器
<span class="token parameter variable">-w</span> <span class="token operator">&lt;</span>format<span class="token operator">&gt;</span> 显示相应的指定的报文信息，如：%<span class="token punctuation">{<!-- --></span>http_code<span class="token punctuation">}</span>，%<span class="token punctuation">{<!-- --></span>remote_ip<span class="token punctuation">}</span>等
-m, --max-time <span class="token operator">&lt;</span>time<span class="token operator">&gt;</span> 允许最大传输时间
</code></pre> 
<h4><a id="3_860"></a>3、压力测试工具</h4> 
<p><strong>httpd的压力测试工具：</strong></p> 
<ul><li>ab, webbench, http_load, seige</li><li>Jmeter 开源</li><li>Loadrunner 商业，有相关认证</li><li>tcpcopy：网易，复制生产环境中的真实请求，并将之保存</li></ul> 
<p>ab 来自httpd-tools包</p> 
<p><strong>命令格式：</strong></p> 
<pre><code class="prism language-bash">ab <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> URL
</code></pre> 
<p><strong>选项：</strong></p> 
<pre><code class="prism language-bash">-n：总请求数
-c：模拟的并发数
-k：以持久连接模式测试
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/50649e4d23ee40c44a8a17870aa16742/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">react native 修改 react native element 组件默认样式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ceef09c0317a8e1f2f71bb58dd391f37/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【并查集】模版</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>