<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>一、在树莓派和Ubuntu上配置Qt &#43; OpenCV的交叉编译环境——3. OpenCV的交叉编译（OpenCV4.5.0） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="一、在树莓派和Ubuntu上配置Qt &#43; OpenCV的交叉编译环境——3. OpenCV的交叉编译（OpenCV4.5.0）" />
<meta property="og:description" content="在树莓派和Ubuntu上配置Qt &#43; OpenCV的交叉编译环境——3. OpenCV的交叉编译（OpenCV4.5.0） 本系列导航
1. 对交叉编译的基本理解
2. Qt的交叉编译（带EGLFS支持）
3. OpenCV的交叉编译（OpenCV4.5.0）
文章目录 在树莓派和Ubuntu上配置Qt &#43; OpenCV的交叉编译环境——3. OpenCV的交叉编译（OpenCV4.5.0）前言一、在PC上准备交叉编译器二、在PC上安装依赖库三、在PC上下载OpenCV源码四、在PC上交叉编译OpenCV源码五、在树莓派上配置环境变量六、测试交叉编译总结 前言 完成Qt的交叉编译之后，已经可以把PC端编译好的可执行文件放到树莓派上执行了。这篇博客说的是，如果想要在开发Qt程序的时候调用OpenCV的库，而且仍然需要交叉编译，应该怎么做。
说明：
硬件设备
树莓派 Raspberry Pi 4B，镜像版本为2021-01-11-raspios-buster-armhf-full；
PC端的Ubuntu18.04（在VMware 16.0 Pro虚拟机上运行）。软件版本
Qt 5.14.2
OpenCV4.5.0 一、在PC上准备交叉编译器 因为目标机仍然是树莓派，可以直接用编译Qt的交叉编译器。其下载，环境变量配置详见：2. Qt的交叉编译（带EGLFS支持）中的 二、1. 在PC上下载交叉编译器并配置环境变量。
完成交叉编译器的准备之后，你的PC上应该有一个这样的cross-compile-tool文件夹。
并且，在PC上的terminal输入：
arm-linux-gnueabihf-g&#43;&#43; -v sudo arm-linux-gnueabihf-g&#43;&#43; -v 都应该有正常的版本信息输出。
二、在PC上安装依赖库 因为博主之前在PC上装过OpenCV（非交叉编译），所以已经装过一些依赖库了，这里还是把之前装过的和新安装的都列出：
更新。
sudo apt update sudo apt upgrade 安装cmake及其图形化界面（这个是一定要有的）。
sudo apt install cmake sudo apt install cmake-qt-gui 使64位系统兼容32位系统。
sudo apt install lib32ncurses5 lib32z1 这些是之前装过的（可能并不需要）。
sudo apt install build-essential sudo apt install git libgtk2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/fcd677469dc35b18825c8686652d355a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-31T19:01:12+08:00" />
<meta property="article:modified_time" content="2021-12-31T19:01:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">一、在树莓派和Ubuntu上配置Qt &#43; OpenCV的交叉编译环境——3. OpenCV的交叉编译（OpenCV4.5.0）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="UbuntuQt__OpenCV3_OpenCVOpenCV450_0"></a>在树莓派和Ubuntu上配置Qt + OpenCV的交叉编译环境——3. OpenCV的交叉编译（OpenCV4.5.0）</h2> 
<p><em><strong>本系列导航</strong></em></p> 
<p><em><a href="https://blog.csdn.net/weixin_37789780/article/details/122229354?spm=1001.2014.3001.5501">1. 对交叉编译的基本理解</a></em><br> <em><a href="https://blog.csdn.net/weixin_37789780/article/details/122229806?spm=1001.2014.3001.5501">2. Qt的交叉编译（带EGLFS支持）</a></em><br> <strong>3. OpenCV的交叉编译（OpenCV4.5.0）</strong></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#UbuntuQt__OpenCV3_OpenCVOpenCV450_0" rel="nofollow">在树莓派和Ubuntu上配置Qt + OpenCV的交叉编译环境——3. OpenCV的交叉编译（OpenCV4.5.0）</a></li><li><a href="#_13" rel="nofollow">前言</a></li><li><a href="#PC_24" rel="nofollow">一、在PC上准备交叉编译器</a></li><li><a href="#PC_34" rel="nofollow">二、在PC上安装依赖库</a></li><li><a href="#PCOpenCV_59" rel="nofollow">三、在PC上下载OpenCV源码</a></li><li><a href="#PCOpenCV_63" rel="nofollow">四、在PC上交叉编译OpenCV源码</a></li><li><a href="#_142" rel="nofollow">五、在树莓派上配置环境变量</a></li><li><a href="#_159" rel="nofollow">六、测试交叉编译</a></li><li><a href="#_188" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_13"></a>前言</h2> 
<p>完成Qt的交叉编译之后，已经可以把PC端编译好的可执行文件放到树莓派上执行了。这篇博客说的是，如果想要在开发Qt程序的时候调用OpenCV的库，而且仍然需要交叉编译，应该怎么做。</p> 
<p>说明：</p> 
<ol><li><strong>硬件设备</strong><br> 树莓派 Raspberry Pi 4B，镜像版本为2021-01-11-raspios-buster-armhf-full；<br> PC端的Ubuntu18.04（在VMware 16.0 Pro虚拟机上运行）。</li><li><strong>软件版本</strong><br> Qt 5.14.2<br> OpenCV4.5.0</li></ol> 
<h2><a id="PC_24"></a>一、在PC上准备交叉编译器</h2> 
<p>因为目标机仍然是树莓派，可以直接用编译Qt的交叉编译器。其下载，环境变量配置详见：<a href="https://blog.csdn.net/weixin_37789780/article/details/122229806?spm=1001.2014.3001.5501">2. Qt的交叉编译（带EGLFS支持）</a>中的 <em>二、1. 在PC上下载交叉编译器并配置环境变量</em>。<br> 完成交叉编译器的准备之后，你的PC上应该有一个这样的cross-compile-tool文件夹。<br> <img src="https://images2.imgbox.com/d7/ba/FfUnbkTt_o.png" alt="在这里插入图片描述"><br> 并且，在PC上的terminal输入：</p> 
<pre><code>arm-linux-gnueabihf-g++ -v
sudo arm-linux-gnueabihf-g++ -v
</code></pre> 
<p>都应该有正常的版本信息输出。</p> 
<h2><a id="PC_34"></a>二、在PC上安装依赖库</h2> 
<p>因为博主之前在PC上装过OpenCV（非交叉编译），所以已经装过一些依赖库了，这里还是把之前装过的和新安装的都列出：</p> 
<p>更新。</p> 
<pre><code>sudo apt update
sudo apt upgrade
</code></pre> 
<p>安装cmake及其图形化界面（这个是一定要有的）。</p> 
<pre><code>sudo apt install cmake
sudo apt install cmake-qt-gui
</code></pre> 
<p>使64位系统兼容32位系统。</p> 
<pre><code>sudo apt install lib32ncurses5 lib32z1  
</code></pre> 
<p>这些是之前装过的（可能并不需要）。</p> 
<pre><code>sudo apt install build-essential 
sudo apt install git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev
sudo apt install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev
</code></pre> 
<p>解决 libjasper-dev 无法安装的问题，<a href="https://blog.csdn.net/weixin_41053564/article/details/81254410">Click Me</a>。</p> 
<h2><a id="PCOpenCV_59"></a>三、在PC上下载OpenCV源码</h2> 
<p><a href="https://opencv.org/releases/" rel="nofollow">下载OpenCV 源码，Click Me</a>，选择需要的版本（我的是OpenCV4.5.0），点击“Sources”下载。<br> <a href="https://github.com/opencv/opencv_contrib">下载opencv_contrib，Click Me</a>，选择与OpenCV相同的版本下载。<br> 下载好并解压后，将opencv_contrib-4.5.0放在opencv-4.5.0-for-raspi的文件夹里面（为了与之前安装的OpenCV区分开，我修改文件夹名为opencv-4.5.0-for-raspi）。</p> 
<h2><a id="PCOpenCV_63"></a>四、在PC上交叉编译OpenCV源码</h2> 
<p>我的opencv-4.5.0-for-raspi所在路径：~/Work</p> 
<p>新建build和install-opencv文件夹。</p> 
<pre><code>cd ~/Work/opencv-4.5.0-for-raspi
mkdir build
mkdir install-opencv
</code></pre> 
<p>进入build文件夹，运行cmake-gui。</p> 
<pre><code>cd build
cmake-gui
</code></pre> 
<p>设置源码目录和build目录，点击Configure。<br> <img src="https://images2.imgbox.com/66/de/YpdieU7m_o.png" alt="在这里插入图片描述"><br> 在弹出的窗口中选择specify options for cross-compiling，点击Next。<br> <img src="https://images2.imgbox.com/57/8d/A4RiLmlz_o.png" alt="在这里插入图片描述"><br> 填写如下。3个路径是之前我们交叉编译工具链的所在路径。<br> C 是 arm-linux-gnueabihf-gcc 的路径；<br> C++ 是 arm-linux-gnueabihf-g++ 的路径；<br> Target Root 是 cross-compile-tool 文件夹的路径（告诉cmake从哪里找交叉编译的工具链）。<br> 填好之后点击Finish。<br> <img src="https://images2.imgbox.com/df/53/ZOQMPKbl_o.png" alt="在这里插入图片描述"><br> 在红色区域中：<br> 勾选 BUILD_JPEG、BUILD_PNG；<br> MAKE_BUILD_TYPE 输入Release；<br> MAKE_INSTALL_PREFIX 选择我们刚创建的install-opencv目录；<br> OPENCV_EXTRA_MODULES_PATH 填写opencv_contrib-4.5.0/modules的路径（比如我的是，~/Work/opencv-4.5.0-for-raspi/opencv_contrib-4.5.0/modules）。</p> 
<p>然后点击Configure。<br> 处理报错：<br> <strong>问题1</strong><br> <img src="https://images2.imgbox.com/71/46/2MPlUuu3_o.png" alt="在这里插入图片描述"><br> <strong>解决1</strong><br> 编辑cmake/OpenCVDetectCXXCompiler.cmake文件,写入set(CMAKE_SYSTEM_PROCESSOR arm)</p> 
<p><strong>问题2</strong><br> <img src="https://images2.imgbox.com/fe/50/s0ovgYi6_o.png" alt="在这里插入图片描述"><br> <strong>解决2</strong><br> 这是类似的一串问题，解决方法也类似。<br> 按照提示打开CMakeDownloadLog.txt文件，并做如下操作。<br> <img src="https://images2.imgbox.com/42/3d/TT46PLII_o.png" alt="在这里插入图片描述"><br> 再点击Configure，Generate。出现 Configure Done 和 Generate Done 并没有红色字体的报错，这一步就可以过了。</p> 
<p>修改CmakeCache.txt文件，找到CMAKE_EXE_LINKER_FLAGS:STRING= , 加上-pthread -ldl -lrt，也就是：</p> 
<pre><code>CMAKE_EXE_LINKER_FLAGS:STRING=-pthread -ldl -lrt
</code></pre> 
<p>重新加载。<br> <img src="https://images2.imgbox.com/02/5f/gNtcU0mJ_o.png" alt="在这里插入图片描述"><br> 点击Configure，Generate。<br> 完成之后，在terminal中继续操作：</p> 
<pre><code>cd ~/Work/raspi/opencv-4.5.0-for-raspi/build
make -j4
</code></pre> 
<p>完成后make install</p> 
<pre><code>make install
</code></pre> 
<p>在<strong>树莓派上</strong>准备好文件夹。</p> 
<pre><code>sudo mkdir /usr/local/install-opencv 
sudo chown -R pi:pi /usr/local/install-opencv
</code></pre> 
<p>把交叉编译好的install-opencv放到树莓派上（IP地址要改成自己的）：</p> 
<pre><code>cd ~/Work/raspi/opencv-4.5.0-for-raspi/install-opencv
rsync -avz install-opencv pi@192.168.31.188:/usr/local
</code></pre> 
<h2><a id="_142"></a>五、在树莓派上配置环境变量</h2> 
<pre><code>sudo nano /etc/ld.so.conf.d/opencv.conf
</code></pre> 
<p>在新建的文件中输入opencv库的路径：</p> 
<pre><code>/usr/local/install-opencv/lib
</code></pre> 
<p>ctrl+o保存文件，回车， ctrl+x 退出nano编辑器。</p> 
<p>使得配置立即生效：</p> 
<pre><code>sudo ldconfig
</code></pre> 
<h2><a id="_159"></a>六、测试交叉编译</h2> 
<p>可以用自己的一个调用了opencv库的程序去做交叉编译的测试，在测试之前还需要<strong>在Qt Creator中</strong>做以下操作（为了方便，假设你的工程叫qt_for_test）。</p> 
<p><strong>在qt_for_test.pro中</strong>添加交叉编译后opencv库的路径：</p> 
<pre><code>INCLUDEPATH += /home/yjx/Work/opencv-4.5.0-for-raspi/install-opencv/include/opencv4
LIBS += /home/yjx/Work/opencv-4.5.0-for-raspi/install-opencv/lib/libopencv*.so
</code></pre> 
<p><strong>在qt_for_test.pro中</strong>告诉Qt把生成的可执行文件放在哪里：</p> 
<pre><code>target.path = /home/pi/qt5
INSTALLS += target
</code></pre> 
<p>！！注意！！<br> 这样不知道为什么无法打开opencv window，比如执行：</p> 
<pre><code>cv::namedWindow("image");
</code></pre> 
<p>会报错：</p> 
<blockquote> 
 <p>OpenCV Error: Unspecified error (The function is not implemented. Rebuild the library with Windows, GTK+ 2.x or Carbon support. If you are on Ubuntu or Debian, install libgtk2.0-dev and pkg-config, then re-run cmake or configure script) in cvNamedWindow, file /usr/dev/opencv/modules/highgui/src/window.cpp, line 516 terminate called after throwing an instance of ‘cv::Exception’ what(): /usr/dev/opencv/modules/highgui/src/window.cpp:516: error: (-2) The function is not implemented. Rebuild the library with Windows, GTK+ 2.x or Carbon support. If you are on Ubuntu or Debian, install libgtk2.0-dev and pkg-config, then re-run cmake or configure script in function cvNamedWindow</p> 
</blockquote> 
<p>但是也没关系，毕竟都有Qt了，opencv window用处也不大。</p> 
<p>我测试了一个目标检测的简单例子，在PC上编译，在树莓派上完美运行（人脸就打码了，忽略丑丑的界面，毕竟只是test）：<br> <img src="https://images2.imgbox.com/c1/6b/c7TvtNYo_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_188"></a>总结</h2> 
<p>主要参考：<br> https://blog.csdn.net/tajon1226/article/details/100606316<br> https://stackoverflow.com/questions/33276917/cross-compiling-to-raspberry-pi-using-qt-and-opencv</p> 
<p>撒花✿✿ヽ(°▽°)ノ✿</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ffe646c8d947f6574ed1e72c198c41b5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【全栈开发实战小草看书之Web端（十一）公司管理】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/83afbe331a63a2ed00179ecc6a856cb3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">写在2021最后一天</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>