<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>goquery的使用 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="goquery的使用" />
<meta property="og:description" content="title: goquery的使用
tags: go,goquery,爬虫
author: Clown95
本文参考 飞雪无痕 的 《golang goquery selector(选择器) 示例大全》
概述 相信很多小伙伴对爬虫有着很大的兴趣,今天我们就来说下go语言的爬虫利器goquery，有使用过jquery的小伙伴是不是看着这个很眼熟？goquery类似jquery，它是jquery的go版本实现，使用它，可以很方便的对HTML进行处理。
goquery是基于 Go net/htm包和css选择器库 cascadia。由于net/htm解析器返回的是DOM节点,而不是完整的DOM树,因此, jQuery的状态操作函数没有实现(像height(), css(), detach)
注意：goquery只支持utf-8编码，其他编码需要转换。
安装 在终端输入命令安装goquery。
go get github.com/PuerkitoBio/goquery
简单使用 我们首先通过一个小例子来介绍goqery。
func main() { html := `&lt;html&gt; &lt;body&gt; &lt;h1 id=&#34;title&#34;&gt;春晓&lt;/h1&gt; &lt;p class=&#34;content1&#34;&gt; 春眠不觉晓， 处处闻啼鸟。 夜来风雨声， 花落知多少。 &lt;/p&gt; &lt;/body&gt; &lt;/html&gt; ` dom,err:=goquery.NewDocumentFromReader(strings.NewReader(html)) if err!=nil{ log.Fatalln(err) } dom.Find(&#34;p&#34;).Each(func(i int, selection *goquery.Selection) { fmt.Println(selection.Text()) }) } 得到结果：
春眠不觉晓， 处处闻啼鸟。 夜来风雨声， 花落知多少。 NewDocumentFromReader() 返回了一个*Document和error。Document代表一个将要被操作的HTML文档。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/2ed7578f46fe0e291f920da76718a12e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-16T18:06:42+08:00" />
<meta property="article:modified_time" content="2019-04-16T18:06:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">goquery的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr> 
<p>title: goquery的使用<br> tags: go,goquery,爬虫<br> author: Clown95</p> 
<hr> 
<blockquote> 
 <p>本文参考 飞雪无痕 的 《golang goquery selector(选择器) 示例大全》</p> 
</blockquote> 
<h2><a id="_9"></a>概述</h2> 
<p>相信很多小伙伴对爬虫有着很大的兴趣,今天我们就来说下go语言的爬虫利器<code>goquery</code>，有使用过<code>jquery</code>的小伙伴是不是看着这个很眼熟？goquery类似jquery，它是jquery的go版本实现，使用它，可以很方便的对HTML进行处理。</p> 
<p>goquery是基于 Go net/htm包和css选择器库 cascadia。由于net/htm解析器返回的是DOM节点,而不是完整的DOM树,因此, jQuery的状态操作函数没有实现(像height(), css(), detach)</p> 
<blockquote> 
 <p>注意：goquery只支持utf-8编码，其他编码需要转换。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/35/c1/YSoYcZDh_o.png" alt="image"></p> 
<h2><a id="_17"></a>安装</h2> 
<p>在终端输入命令安装goquery。</p> 
<blockquote> 
 <p>go get github.com/PuerkitoBio/goquery</p> 
</blockquote> 
<h2><a id="_21"></a>简单使用</h2> 
<p>我们首先通过一个小例子来介绍goqery。</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	html <span class="token operator">:=</span> <span class="token string">`&lt;html&gt;
			&lt;body&gt;
				&lt;h1 id="title"&gt;春晓&lt;/h1&gt;
				&lt;p class="content1"&gt;
    			春眠不觉晓，
				处处闻啼鸟。
        		夜来风雨声，
				花落知多少。
				&lt;/p&gt;
			&lt;/body&gt;
			&lt;/html&gt;
			`</span>
dom<span class="token punctuation">,</span>err<span class="token operator">:=</span>goquery<span class="token punctuation">.</span><span class="token function">NewDocumentFromReader</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	dom<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Each</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">,</span> selection <span class="token operator">*</span>goquery<span class="token punctuation">.</span>Selection<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>selection<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>得到结果：</p> 
<pre><code>    			春眠不觉晓，
				处处闻啼鸟。
        		夜来风雨声，
				花落知多少。
</code></pre> 
<p><code>NewDocumentFromReader()</code> 返回了一个*Document和error。Document代表一个将要被操作的HTML文档。</p> 
<p><code>Find()</code>是获取当前匹配元素集中每个元素的子代，参数是<code>x选择器</code> ，它返回一个包含这些匹配元素的新选择对象。在例子中我们使用的是元素选择器<code>P</code>，它会帮我们匹配出所有的<code>p标签</code> 。</p> 
<p><code>Each()</code> 是迭代器，它会循环遍历选择的节点，它的参数是一个匿名函数，匿名函数拥有2个参数，一个是元素的<code>索引位置</code>，还有一个就是<code>选择的结果集</code>匹配到的内容都在它的里面。</p> 
<p><code>Text()</code> 则是获取匹配元素集中的文本内容。</p> 
<h2><a id="_65"></a>选择器</h2> 
<p>上面的例子中，我们使用了<code>元素选择器</code>,goquery跟jquery一样都支持很多选择器，我们简单的介绍下常用的选择器：</p> 
<ol><li>基于HTML Element 元素的选择器<br> 就是基于a,p等这些HTML的基本元素进行选择。</li></ol> 
<p>使用方法 ：使用语法为 <code>dom.Find("p")</code>，匹配文档中所有的p标签。</p> 
<ol start="2"><li>ID 选择器<br> ID选择器是我们使用最频繁的，假如我们有2个p元素，其实我们只需要其中的一个，那么我们只需要给这个标记一个唯一的id即可，这样我们就可以使用id选择器，精确定位了。</li></ol> 
<p>使用方法 ：id选择器以<code>#</code>开头，紧跟着元素id的值，使用语法为<br> <code>dom.Find("#title")</code> ，匹配文档中所有的 id=title的内容</p> 
<p>如果多个标签的ID都是title，我们可以指定某一个标签,如<code>dom.Find("p#title")</code></p> 
<ol start="3"><li>Class选择器</li></ol> 
<p>类选择跟ID选择器一样都是使用很频繁的，我们可以通过类选择器快速筛选到需要的内容。</p> 
<p>使用方法 ： id选择器以<code>.</code>开头，紧跟着元素class的值，使用语法为<code>dom.Find(".content1")</code>，匹配文档中所有的 id=title的元素。</p> 
<p>类选择权器跟ID选择器一样,也可以指定某一个标签<code>dom.Find("div.content1")</code></p> 
<ol start="4"><li>属性选择器</li></ol> 
<p>一个HTML元素都有自己的属性以及属性值，所以我们也可以通过属性和值筛选元素。</p> 
<p>使用方法 ：我们可以通过元素的属性和属性值来筛选数据，使用语法为<code>dom.Find("p[class=content1]</code>，匹配文档中所有的 p标签的class属性是content1的元素。</p> 
<p>当然我们这里以class属性为例，还可以用其他属性，比如href等很多，自定义属性也是可以的。</p> 
<p>刚刚我们使用的是<code>完全相等</code>的匹配方式，属性选择器还要很多匹配方式。</p> 
<table><thead><tr><th>选择器</th><th>说明</th></tr></thead><tbody><tr><td>Find(“div[my]“)</td><td>筛选含有my属性的div元素</td></tr><tr><td>Find(“div[my=zh]“)</td><td>筛选my属性为zh的div元素</td></tr><tr><td>Find(“div[my!=zh]“)</td><td>筛选my属性不等于zh的div元素</td></tr><tr><td>Find(“div[my¦=zh]“)</td><td>筛选my属性为zh或者zh-开头的div元素</td></tr><tr><td>Find(“div[my*=zh]“)</td><td>筛选my属性包含zh这个字符串的div元素</td></tr><tr><td>Find(“div[my~=zh]“)</td><td>筛选my属性包含zh这个单词的div元素，单词以空格分开的</td></tr><tr><td>Find(“div[my$=zh]“)</td><td>筛选my属性以zh结尾的div元素，区分大小写</td></tr><tr><td>Find(“div[my^=zh]“)</td><td>筛选my属性以zh开头的div元素，区分大小写</td></tr></tbody></table> 
<ol start="5"><li>parent &gt; child选择器</li></ol> 
<p>筛选出某个元素下的子元素。</p> 
<p>使用方法：使用<code>&gt;</code>符号连接，使用语法 <code>dom.Find("div&gt;p")</code> ， 筛选div标签下的p标签</p> 
<ol start="6"><li>element + next 相邻选择器</li></ol> 
<p>如果要筛选的元素没有规律，但是该元素的上一个元素有规律，我们就可以使用这种下一个相邻选择器来进行选择。</p> 
<p>如：</p> 
<pre><code>&lt;div&gt;
&lt;p my="a"&gt;a&lt;/p&gt;
&lt;p&gt;b&lt;/p&gt;
&lt;p&gt;c&lt;/p&gt;
&lt;div&gt;
</code></pre> 
<p>我想筛选出<code>b</code>所在的标签</p> 
<p>使用方法：<code>dom.Find("p[my=a]+p")</code>筛选出p标签属性my的值为a的相邻p标签。</p> 
<ol start="7"><li>element~next 兄弟选择器</li></ol> 
<p>有时候我们需要筛选同一父元素下，不相邻的标签，可以使用兄弟选择器</p> 
<p>比如我想筛选出 b 和c 所在标签<br> 使用方法：<code>dom.Find("p[my=a]~p")</code>，筛选出p标签属性my的值为a的兄弟p标签。</p> 
<h2><a id="_142"></a>过滤器</h2> 
<p>有时候我们选择出来的结果，并不是我们心目中的最优结果，我们希望对其进行过滤。</p> 
<ol><li>:contains过滤器</li></ol> 
<p>筛选出的元素要包含指定的文本，比如我想筛选出包含a的p标签</p> 
<p>使用方法：<code>dom.Find("p:contains(a)")</code>，筛选出内容包含a的p标签</p> 
<p>Find(":has(selector)")和contains差不多，只不过这个是包含的是元素节点。</p> 
<p>此外还有Find(":empty")表示筛选出的元素都不能有子元素（包括文本元素），只筛选那些不包含任何子元素的元素。</p> 
<ol start="2"><li>:first-child过滤器 和:first-of-type过滤器<br> 筛选出的元素要是他们的父元素的第一个子元素，如果不是，则不会被筛选出来。</li></ol> 
<p>使用方法：语法为Find(“p:first-child”)，筛选出第一个p标签</p> 
<p>:first-child选择器限制的比较死，必须得是第一个子元素，如果该元素前有其他在前面，就不能用:first-child了，这时候:first-of-type就派上用场了，它要求只要是这个类型的第一个就可以。</p> 
<ol start="3"><li> <p>:last-child 和:last-of-type过滤器<br> 这两个正好和上面的:first-child、:first-of-type相反</p> </li><li> <p>:nth-child(n) 过滤器</p> </li></ol> 
<p>筛选出的元素是其父元素的第n个元素，n以1开始。所以我们可以知道:first-child和:nth-child(1)是相等的。通过指定n，我们就很灵活的筛选出我们需要的元素。</p> 
<ol start="5"><li>:nth-of-type(n) 过滤器</li></ol> 
<p>:nth-of-type(n)和 :nth-child(n) 类似，只不过它表示的是同类型元素的第n个,所以:nth-of-type(1) 和 :first-of-type是相等的。</p> 
<ol start="6"><li>:nth-last-child(n) 和:nth-last-of-type(n) 过滤器</li></ol> 
<p>这两个和上面的类似，只不过是倒序开始计算的，最后一个元素被当成了第一个</p> 
<ol start="7"><li>:only-child 过滤器 和 :only-of-type 过滤器</li></ol> 
<p>筛选出父元素中，只有它自己的一个的元素。</p> 
<h2><a id="_184"></a>常用方法</h2> 
<ol><li>类似函数的位置操作</li></ol> 
<ul><li>Find(selection) *Selection //根据选择器查找节点集</li><li>Eq(index int) *Selection //根据索引获取某个节点集</li><li>First() *Selection //获取第一个子节点集</li><li>Last() *Selection //获取最后一个子节点集</li><li>Next() *Selection //获取下一个兄弟节点集</li><li>NextAll() *Selection //获取后面所有兄弟节点集</li><li>Prev() *Selection //前一个兄弟节点集</li><li>Get(index int) *html.Node //根据索引获取一个节点</li><li>Index() int //返回选择对象中第一个元素的位置</li><li>Slice(start, end int) *Selection //根据起始位置获取子节点集</li></ul> 
<ol start="2"><li>循环遍历选择的节点</li></ol> 
<ul><li> <p>Each(f func(int, *Selection)) *Selection //遍历</p> </li><li> <p>EachWithBreak(f func(int, *Selection) bool) *Selection //可中断遍历</p> </li><li> <p>Map(f func(int, *Selection) string) (result []string) //返回字符串数组</p> </li></ul> 
<ol start="3"><li>检测或获取节点属性值</li></ol> 
<ul><li> <p>Attr(), RemoveAttr(), SetAttr() //获取，移除，设置属性的值</p> </li><li> <p>AddClass(), HasClass(), RemoveClass(), ToggleClass()</p> </li><li> <p>Html() //获取该节点的html</p> </li><li> <p>Length() //返回该Selection的元素个数</p> </li><li> <p>Text() //获取该节点的文本值</p> </li></ul> 
<ol start="4"><li>在文档树之间来回跳转（常用的查找节点方法）</li></ol> 
<ul><li> <p>Children() //返回selection中各个节点下的孩子节点</p> </li><li> <p>Contents() //获取当前节点下的所有节点</p> </li><li> <p>Find() //查找获取当前匹配的元素</p> </li><li> <p>Next() //下一个元素</p> </li><li> <p>Prev() //上一个元素</p> </li></ul> 
<h2><a id="_235"></a>总结</h2> 
<p>goquery 是解析HTML网页必备的利器，在爬虫抓取网页的过程中，灵活的使用goquery不同的选择器，可以让我们的抓取工作事半功倍，大大提升爬虫的效率。</p> 
<p><img src="https://images2.imgbox.com/38/bc/iXAs3Pib_o.png" alt="image"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4b29ae7a8654f99700e8d48ab5fe5074/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Qt 笔记4--Qt 读写CSV</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62b484ff2a703f1f252f121c19c60660/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">两数相乘溢出的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>