<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于RK3399 Android11适配OV13850 MIPI摄像头 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于RK3399 Android11适配OV13850 MIPI摄像头" />
<meta property="og:description" content="目录 1、原理图分析2、编写和配置设备树3、调试方法4、遇到的问题与解决5、补丁 1、原理图分析 从上图可看出，我们需要关心的，①MIPI数据和时钟接口使用的是MIPI_TX1/RX1 ②I2C使用的是I2C4总线 ③RST复位引脚使用的是GPIO2_D2 ④PWDN使用的是GPIO1_C7 ⑤MCLK使用的是GPIO3_B7 ⑥需要保证红色框框的供电电源正常。
结合RK提供的文档，如下摄像头数据采集拓扑图所示，我们就可以开始编写配置设备树了，其实官方提供了很多类似的设备树配置给我们参考的。
2、编写和配置设备树 ①配置OV13850设备树节点Ⅰ
②配置OV13850设备树节点Ⅱ 提示：下图复用功能是&lt;. RK_PB7 3 &amp;pcfg_pull_one&gt;;
③配置dphy
④配置isp
3、调试方法 ①移植成功后，使用dmesg指令查看对应驱动的log
②驱动加载成功后，会有生成以下的摄像头设备节点
③RKISP 驱动如果加载成功,会有 video 及 media 设备存在于/dev/目录下。系统中可能存在 多个/dev/video 设备,通过/sys 可以查询到 RKISP 注册的 video 节点
④查看拓扑结构
Ⅰ、通过media-ctl -p 查看rkisp1_selfpath 信息，可以知道打开哪些media设备
Ⅱ、再通过media-ctl -p /dev/media0 查看已打开的media设备的拓扑，下图是截取了一部分信息
⑤查看摄像头支持哪几种图像流格式，截图省略
指令：v4l2-ctl -d /dev/video0 --list-formats
⑥查看调试上层相关信息，截图省略
指令：dumpsys media.camera
⑦抓图
指令：v4l2-ctl -d /dev/video0 --set-fmt-video=width=800,height=600,pixelformat=NV12 --stream-mmap=3 --stream-to=/sdcard/out.yuv --stream-skip=9 --stream-count=1
查看YUV图片可以使用该网站：在线查看 YUV 文件的免费在线工具 - ImageToStl
4、遇到的问题与解决 ①问题1：相机权限问题:解决问题的链接
②问题2：没有获取到对应IQ文件，后面查看编译生成的文件，并没有将IQ文件拷贝过去，报错如下图所示" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/040c4a0d792193bc043a917f70b7a127/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-23T22:39:28+08:00" />
<meta property="article:modified_time" content="2024-02-23T22:39:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于RK3399 Android11适配OV13850 MIPI摄像头</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1_1" rel="nofollow">1、原理图分析</a></li><li><a href="#2_6" rel="nofollow">2、编写和配置设备树</a></li><li><a href="#3_15" rel="nofollow">3、调试方法</a></li><li><a href="#4_37" rel="nofollow">4、遇到的问题与解决</a></li><li><a href="#5_53" rel="nofollow">5、补丁</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_1"></a>1、原理图分析</h2> 
<p><img src="https://images2.imgbox.com/13/6a/qmaL6KoM_o.png" alt="在这里插入图片描述"><br>   从上图可看出，我们需要关心的，①MIPI数据和时钟接口使用的是MIPI_TX1/RX1 ②I2C使用的是I2C4总线 ③RST复位引脚使用的是GPIO2_D2 ④PWDN使用的是GPIO1_C7 ⑤MCLK使用的是GPIO3_B7 ⑥需要保证红色框框的供电电源正常。<br>   结合RK提供的文档，如下摄像头数据采集拓扑图所示，我们就可以开始编写配置设备树了，其实官方提供了很多类似的设备树配置给我们参考的。<br> <img src="https://images2.imgbox.com/ae/42/r6VEYZbA_o.png" alt="摄像头数据采集拓扑"></p> 
<h2><a id="2_6"></a>2、编写和配置设备树</h2> 
<p>①配置OV13850设备树节点Ⅰ<br> <img src="https://images2.imgbox.com/b8/ec/rnGGJwa3_o.png" alt="在这里插入图片描述"><br> ②配置OV13850设备树节点Ⅱ <code>提示：下图复用功能是&lt;. RK_PB7 3 &amp;pcfg_pull_one&gt;;</code><br> <img src="https://images2.imgbox.com/85/6e/GYTEddya_o.png" alt="在这里插入图片描述"><br> ③配置dphy<br> <img src="https://images2.imgbox.com/98/8e/aV72x93b_o.png" alt="在这里插入图片描述"><br> ④配置isp<br> <img src="https://images2.imgbox.com/cc/21/lmOY0ofR_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3_15"></a>3、调试方法</h2> 
<p>①移植成功后，使用dmesg指令查看对应驱动的log<br> <img src="https://images2.imgbox.com/56/07/b8YBKLXk_o.png" alt="在这里插入图片描述"><br> ②驱动加载成功后，会有生成以下的摄像头设备节点<br> <img src="https://images2.imgbox.com/42/9d/rWFday4G_o.png" alt="在这里插入图片描述"><br> ③RKISP 驱动如果加载成功,会有 video 及 media 设备存在于/dev/目录下。系统中可能存在 多个/dev/video 设备,通过/sys 可以查询到 RKISP 注册的 video 节点<br> <img src="https://images2.imgbox.com/0d/c7/dlKFsf1W_o.png" alt="在这里插入图片描述"><br> ④查看拓扑结构<br>  Ⅰ、通过media-ctl -p 查看rkisp1_selfpath 信息，可以知道打开哪些media设备<br> <img src="https://images2.imgbox.com/f6/81/NacJkysc_o.png" alt="在这里插入图片描述"><br>  Ⅱ、再通过media-ctl -p /dev/media0 查看已打开的media设备的拓扑，下图是截取了一部分信息<br> <img src="https://images2.imgbox.com/51/4c/oybWTnUC_o.png" alt="在这里插入图片描述"><br> ⑤查看摄像头支持哪几种图像流格式，截图省略<br>   指令：v4l2-ctl -d /dev/video0 --list-formats<br> ⑥查看调试上层相关信息，截图省略<br>   指令：dumpsys media.camera<br> ⑦抓图<br>   指令：<code>v4l2-ctl -d /dev/video0 --set-fmt-video=width=800,height=600,pixelformat=NV12 --stream-mmap=3 --stream-to=/sdcard/out.yuv --stream-skip=9 --stream-count=1</code><br> <img src="https://images2.imgbox.com/be/5d/i7rOYmvo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/11/81/zav1m8Vj_o.png" alt="在这里插入图片描述"><br>   查看YUV图片可以使用该网站：<a href="https://imagetostl.com/cn/view-yuv-online" rel="nofollow">在线查看 YUV 文件的免费在线工具 - ImageToStl</a><br> <img src="https://images2.imgbox.com/38/d5/rK38TthQ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4_37"></a>4、遇到的问题与解决</h2> 
<p> ①问题1：相机权限问题:<a href="https://blog.csdn.net/KLYAZWS/article/details/119376225">解决问题的链接</a><br>  ②问题2：没有获取到对应IQ文件，后面查看编译生成的文件，并没有将IQ文件拷贝过去，报错如下图所示<br> <img src="https://images2.imgbox.com/1c/71/D2ijOsXd_o.png" alt="在这里插入图片描述"><br>   解决方法：找到对应IQ目录上的.mk文件，在.mk文件中的PRODUCT_COPY_FILES节点下添加</p> 
<pre><code class="prism language-c">$<span class="token punctuation">(</span>call find<span class="token operator">-</span>copy<span class="token operator">-</span>subdir<span class="token operator">-</span>files<span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>CUR_PATH<span class="token punctuation">)</span><span class="token operator">/</span>camera<span class="token operator">/</span>rkisp1<span class="token operator">/</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>TARGET_COPY_OUT_VENDOR<span class="token punctuation">)</span><span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token operator">/</span>rkisp1<span class="token operator">/</span><span class="token punctuation">)</span> \
</code></pre> 
<p>这条语句，这条语句作用是拷贝所有的IQ文件到/vendor/etc/camera/rkisp1/目录下。<br>  ③问题3：屏幕显示UI为0度横屏，而默认\hardware\rockchip\camera\etc\camera\camera3_profiles_rk3399.xml文件中配置的是传感器成像方向是90度，导致相机成像出现拉伸现象。<br>   解决方法：如下图所示。<br> <img src="https://images2.imgbox.com/3b/f4/XZ0udeFZ_o.png" alt="在这里插入图片描述"><br>  ④问题4：图像上下或者左右相反，可以通过修改OV13850寄存器完成上下或左右的翻转。<br>   解决方法：如下图介绍。<br> <img src="https://images2.imgbox.com/43/e7/Ud3fVTUE_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9a/17/vlB6l8J1_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="5_53"></a>5、补丁</h2> 
<pre><code class="prism language-cpp">commit ea5601611a8fdff4b5efaf6db0f947bab7d0447d
Author<span class="token operator">:</span> dengjiawen <span class="token operator">&lt;</span><span class="token number">1411471554</span>@qq<span class="token punctuation">.</span>com<span class="token operator">&gt;</span>
Date<span class="token operator">:</span>   Thu Feb <span class="token number">22</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">28</span> <span class="token number">2024</span> <span class="token operator">+</span><span class="token number">0800</span>

    适配MIPI摄像头OV13850

diff <span class="token operator">--</span>git a<span class="token operator">/</span>frameworks<span class="token operator">/</span>base<span class="token operator">/</span>data<span class="token operator">/</span>etc<span class="token operator">/</span>privapp<span class="token operator">-</span>permissions<span class="token operator">-</span>platform<span class="token punctuation">.</span>xml b<span class="token operator">/</span>frameworks<span class="token operator">/</span>base<span class="token operator">/</span>data<span class="token operator">/</span>etc<span class="token operator">/</span>privapp<span class="token operator">-</span>permissions<span class="token operator">-</span>platform<span class="token punctuation">.</span>xml
index <span class="token number">3</span>b6abd50ee<span class="token punctuation">.</span><span class="token number">.0912e0</span>ec6f <span class="token number">100644</span>
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>frameworks<span class="token operator">/</span>base<span class="token operator">/</span>data<span class="token operator">/</span>etc<span class="token operator">/</span>privapp<span class="token operator">-</span>permissions<span class="token operator">-</span>platform<span class="token punctuation">.</span>xml
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>frameworks<span class="token operator">/</span>base<span class="token operator">/</span>data<span class="token operator">/</span>etc<span class="token operator">/</span>privapp<span class="token operator">-</span>permissions<span class="token operator">-</span>platform<span class="token punctuation">.</span>xml
@@ <span class="token operator">-</span><span class="token number">469</span><span class="token punctuation">,</span><span class="token number">4</span> <span class="token operator">+</span><span class="token number">469</span><span class="token punctuation">,</span><span class="token number">8</span> @@ applications that come with the platform
     <span class="token operator">&lt;</span>privapp<span class="token operator">-</span>permissions package<span class="token operator">=</span><span class="token string">"com.android.bips"</span><span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>permission name<span class="token operator">=</span><span class="token string">"android.permission.SUBSTITUTE_SHARE_TARGET_APP_NAME_AND_ICON"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>privapp<span class="token operator">-</span>permissions<span class="token operator">&gt;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>    <span class="token operator">&lt;</span>privapp<span class="token operator">-</span>permissions package<span class="token operator">=</span><span class="token string">"com.android.camera2"</span><span class="token operator">&gt;</span>
<span class="token operator">+</span>               <span class="token operator">&lt;</span>permission name<span class="token operator">=</span><span class="token string">"android.permission.SYSTEM_CAMERA"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">+</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>privapp<span class="token operator">-</span>permissions<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>permissions<span class="token operator">&gt;</span>
diff <span class="token operator">--</span>git a<span class="token operator">/</span>hardware<span class="token operator">/</span>rockchip<span class="token operator">/</span>camera<span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token operator">/</span>camera3_profiles_rk3399<span class="token punctuation">.</span>xml b<span class="token operator">/</span>hardware<span class="token operator">/</span>rockchip<span class="token operator">/</span>camera<span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token operator">/</span>camera3_profiles_rk3399<span class="token punctuation">.</span>xml
index <span class="token number">84</span>dd8b5ed5<span class="token punctuation">.</span><span class="token number">.61</span>ac244250 <span class="token number">100755</span>
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>hardware<span class="token operator">/</span>rockchip<span class="token operator">/</span>camera<span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token operator">/</span>camera3_profiles_rk3399<span class="token punctuation">.</span>xml
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>hardware<span class="token operator">/</span>rockchip<span class="token operator">/</span>camera<span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token operator">/</span>camera3_profiles_rk3399<span class="token punctuation">.</span>xml
@@ <span class="token operator">-</span><span class="token number">251</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">251</span><span class="token punctuation">,</span><span class="token number">7</span> @@
 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>PSL specific section end <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">--</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>Profiles<span class="token operator">&gt;</span>
<span class="token operator">-</span>  <span class="token operator">&lt;</span>Profiles cameraId<span class="token operator">=</span><span class="token string">"0"</span> name<span class="token operator">=</span><span class="token string">"ov13850"</span> moduleId<span class="token operator">=</span><span class="token string">"m00"</span><span class="token operator">&gt;</span>
<span class="token operator">+</span>  <span class="token operator">&lt;</span>Profiles cameraId<span class="token operator">=</span><span class="token string">"0"</span> name<span class="token operator">=</span><span class="token string">"ov13850"</span> moduleId<span class="token operator">=</span><span class="token string">"m01"</span><span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>Supported_hardware<span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>hwType value<span class="token operator">=</span><span class="token string">"SUPPORTED_HW_RKISP1"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>Supported_hardware<span class="token operator">&gt;</span>
@@ <span class="token operator">-</span><span class="token number">291</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">291</span><span class="token punctuation">,</span><span class="token number">7</span> @@
             <span class="token operator">&lt;</span>lens<span class="token punctuation">.</span>info<span class="token punctuation">.</span>hyperfocalDistance value<span class="token operator">=</span><span class="token string">"0.0"</span><span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> HAL may <span class="token keyword">override</span> <span class="token keyword">this</span> value from CMC <span class="token keyword">for</span> RAW sensors <span class="token operator">--</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>lens<span class="token punctuation">.</span>info<span class="token punctuation">.</span>minimumFocusDistance value<span class="token operator">=</span><span class="token string">"0.1"</span><span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> HAL may <span class="token keyword">override</span> <span class="token keyword">this</span> value from CMC <span class="token keyword">for</span> RAW sensors <span class="token operator">--</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Lens <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">-</span>            <span class="token operator">&lt;</span>lens<span class="token punctuation">.</span>facing value<span class="token operator">=</span><span class="token string">"BACK"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">+</span>            <span class="token operator">&lt;</span>lens<span class="token punctuation">.</span>facing value<span class="token operator">=</span><span class="token string">"FRONT"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Request <span class="token operator">--</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>request<span class="token punctuation">.</span>maxNumOutputStreams value<span class="token operator">=</span><span class="token string">"1,2,1"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>request<span class="token punctuation">.</span>pipelineMaxDepth value<span class="token operator">=</span><span class="token string">"4"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
@@ <span class="token operator">-</span><span class="token number">463</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">463</span><span class="token punctuation">,</span><span class="token number">7</span> @@
             <span class="token operator">&lt;</span>sensor<span class="token punctuation">.</span>baseGainFactor value<span class="token operator">=</span><span class="token string">"0,1"</span><span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> HAL may <span class="token keyword">override</span> <span class="token keyword">this</span> value from CMC <span class="token keyword">for</span> RAW sensors <span class="token operator">--</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>sensor<span class="token punctuation">.</span>blackLevelPattern value<span class="token operator">=</span><span class="token string">"0,0,0,0"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>sensor<span class="token punctuation">.</span>maxAnalogSensitivity value<span class="token operator">=</span><span class="token string">"2400"</span><span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> HAL may <span class="token keyword">override</span> <span class="token keyword">this</span> value from CMC <span class="token keyword">for</span> RAW sensors <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">-</span>            <span class="token operator">&lt;</span>sensor<span class="token punctuation">.</span>orientation value<span class="token operator">=</span><span class="token string">"90"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">+</span>            <span class="token operator">&lt;</span>sensor<span class="token punctuation">.</span>orientation value<span class="token operator">=</span><span class="token string">"0"</span><span class="token operator">/</span><span class="token operator">&gt;</span>	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 摄像头默认成像方向改为<span class="token number">0</span><span class="token punctuation">,</span> 这样和默认横屏<span class="token number">0</span>°才一致，成像才不会拉伸 <span class="token operator">--</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>sensor<span class="token punctuation">.</span>profileHueSatMapDimensions value<span class="token operator">=</span><span class="token string">"0,0,0"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>sensor<span class="token punctuation">.</span>availableTestPatternModes value<span class="token operator">=</span><span class="token string">"OFF,COLOR_BARS"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Info <span class="token operator">--</span><span class="token operator">&gt;</span>
diff <span class="token operator">--</span>git a<span class="token operator">/</span>hardware<span class="token operator">/</span>rockchip<span class="token operator">/</span>camera<span class="token operator">/</span>etc<span class="token operator">/</span>camera_etc<span class="token punctuation">.</span>mk b<span class="token operator">/</span>hardware<span class="token operator">/</span>rockchip<span class="token operator">/</span>camera<span class="token operator">/</span>etc<span class="token operator">/</span>camera_etc<span class="token punctuation">.</span>mk
index ee01d12646<span class="token punctuation">.</span><span class="token number">.30328325</span>bd <span class="token number">100755</span>
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>hardware<span class="token operator">/</span>rockchip<span class="token operator">/</span>camera<span class="token operator">/</span>etc<span class="token operator">/</span>camera_etc<span class="token punctuation">.</span>mk
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>hardware<span class="token operator">/</span>rockchip<span class="token operator">/</span>camera<span class="token operator">/</span>etc<span class="token operator">/</span>camera_etc<span class="token punctuation">.</span>mk
@@ <span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">11</span> <span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span> @@ <span class="token function">ifeq</span> <span class="token punctuation">(</span>$<span class="token punctuation">(</span>filter box atv vr stbvr<span class="token punctuation">,</span> $<span class="token punctuation">(</span>strip $<span class="token punctuation">(</span>TARGET_BOARD_PLATFORM_PRODUCT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
 <span class="token function">ifeq</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>strip $<span class="token punctuation">(</span>shell expr $<span class="token punctuation">(</span>PLATFORM_SDK_VERSION<span class="token punctuation">)</span> \<span class="token operator">&gt;=</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 PRODUCT_COPY_FILES <span class="token operator">+=</span> \
 	$<span class="token punctuation">(</span>CUR_PATH<span class="token punctuation">)</span><span class="token operator">/</span>camera<span class="token operator">/</span>camera3_profiles_$<span class="token punctuation">(</span>TARGET_BOARD_PLATFORM<span class="token punctuation">)</span><span class="token punctuation">.</span>xml<span class="token operator">:</span>$<span class="token punctuation">(</span>TARGET_COPY_OUT_VENDOR<span class="token punctuation">)</span><span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token operator">/</span>camera3_profiles<span class="token punctuation">.</span>xml \
<span class="token operator">+</span>	$<span class="token punctuation">(</span>call find<span class="token operator">-</span>copy<span class="token operator">-</span>subdir<span class="token operator">-</span>files<span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>CUR_PATH<span class="token punctuation">)</span><span class="token operator">/</span>camera<span class="token operator">/</span>rkisp1<span class="token operator">/</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>TARGET_COPY_OUT_VENDOR<span class="token punctuation">)</span><span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token operator">/</span>rkisp1<span class="token operator">/</span><span class="token punctuation">)</span> \
 	#$<span class="token punctuation">(</span>call find<span class="token operator">-</span>copy<span class="token operator">-</span>subdir<span class="token operator">-</span>files<span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>CUR_PATH<span class="token punctuation">)</span><span class="token operator">/</span>firmware<span class="token punctuation">,</span>$<span class="token punctuation">(</span>TARGET_COPY_OUT_VENDOR<span class="token punctuation">)</span><span class="token operator">/</span>firmware<span class="token punctuation">)</span> \
 	#$<span class="token punctuation">(</span>call find<span class="token operator">-</span>copy<span class="token operator">-</span>subdir<span class="token operator">-</span>files<span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>CUR_PATH<span class="token punctuation">)</span><span class="token operator">/</span>camera<span class="token punctuation">,</span>$<span class="token punctuation">(</span>TARGET_COPY_OUT_VENDOR<span class="token punctuation">)</span><span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token punctuation">)</span> 
 <span class="token keyword">else</span>
 PRODUCT_COPY_FILES <span class="token operator">+=</span> \
 	$<span class="token punctuation">(</span>CUR_PATH<span class="token punctuation">)</span><span class="token operator">/</span>camera<span class="token operator">/</span>camera3_profiles_$<span class="token punctuation">(</span>TARGET_BOARD_PLATFORM<span class="token punctuation">)</span><span class="token punctuation">.</span>xml<span class="token operator">:</span>$<span class="token punctuation">(</span>TARGET_COPY_OUT_SYSTEM<span class="token punctuation">)</span><span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token operator">/</span>camera3_profiles<span class="token punctuation">.</span>xml \
<span class="token operator">+</span>	$<span class="token punctuation">(</span>call find<span class="token operator">-</span>copy<span class="token operator">-</span>subdir<span class="token operator">-</span>files<span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>CUR_PATH<span class="token punctuation">)</span><span class="token operator">/</span>camera<span class="token operator">/</span>rkisp1<span class="token operator">/</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>TARGET_COPY_OUT_VENDOR<span class="token punctuation">)</span><span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token operator">/</span>rkisp1<span class="token operator">/</span><span class="token punctuation">)</span> \
 	$<span class="token punctuation">(</span>call find<span class="token operator">-</span>copy<span class="token operator">-</span>subdir<span class="token operator">-</span>files<span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>CUR_PATH<span class="token punctuation">)</span><span class="token operator">/</span>firmware<span class="token punctuation">,</span>$<span class="token punctuation">(</span>TARGET_COPY_OUT_SYSTEM<span class="token punctuation">)</span><span class="token operator">/</span>etc<span class="token operator">/</span>firmware<span class="token punctuation">)</span> \
 	$<span class="token punctuation">(</span>call find<span class="token operator">-</span>copy<span class="token operator">-</span>subdir<span class="token operator">-</span>files<span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>CUR_PATH<span class="token punctuation">)</span><span class="token operator">/</span>camera<span class="token punctuation">,</span>$<span class="token punctuation">(</span>TARGET_COPY_OUT_SYSTEM<span class="token punctuation">)</span><span class="token operator">/</span>etc<span class="token operator">/</span>camera<span class="token punctuation">)</span> \
 	$<span class="token punctuation">(</span>call find<span class="token operator">-</span>copy<span class="token operator">-</span>subdir<span class="token operator">-</span>files<span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">,</span>$<span class="token punctuation">(</span>CUR_PATH<span class="token punctuation">)</span><span class="token operator">/</span>tools<span class="token punctuation">,</span>$<span class="token punctuation">(</span>TARGET_COPY_OUT_SYSTEM<span class="token punctuation">)</span><span class="token operator">/</span>bin<span class="token punctuation">)</span>
diff <span class="token operator">--</span>git a<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>android<span class="token punctuation">.</span>dtsi b<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>android<span class="token punctuation">.</span>dtsi
index <span class="token number">450</span>c677864<span class="token punctuation">.</span><span class="token number">.9062188</span>ed2 <span class="token number">100644</span>
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>android<span class="token punctuation">.</span>dtsi
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>android<span class="token punctuation">.</span>dtsi
@@ <span class="token operator">-</span><span class="token number">335</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">335</span><span class="token punctuation">,</span><span class="token number">7</span> @@
 		cif_clkout<span class="token operator">:</span> cif<span class="token operator">-</span>clkout <span class="token punctuation">{<!-- --></span>
 			rockchip<span class="token punctuation">,</span>pins <span class="token operator">=</span>
 				<span class="token comment">/*cif_clkout*/</span>
<span class="token operator">-</span>				<span class="token operator">&lt;</span><span class="token number">2</span> RK_PB3 <span class="token number">3</span> <span class="token operator">&amp;</span>pcfg_pull_none<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>				<span class="token operator">&lt;</span><span class="token number">3</span> RK_PB7 <span class="token number">3</span> <span class="token operator">&amp;</span>pcfg_pull_none<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 		<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 		isp_dvp_d0d7<span class="token operator">:</span> isp<span class="token operator">-</span>dvp<span class="token operator">-</span>d0d7 <span class="token punctuation">{<!-- --></span>
diff <span class="token operator">--</span>git a<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>excavator<span class="token operator">-</span>sapphire<span class="token punctuation">.</span>dtsi b<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>excavator<span class="token operator">-</span>sapphire<span class="token punctuation">.</span>dtsi
index dd7d5f8952<span class="token punctuation">.</span><span class="token punctuation">.</span>d697023024 <span class="token number">100644</span>
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>excavator<span class="token operator">-</span>sapphire<span class="token punctuation">.</span>dtsi
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>excavator<span class="token operator">-</span>sapphire<span class="token punctuation">.</span>dtsi
@@ <span class="token operator">-</span><span class="token number">303</span><span class="token punctuation">,</span><span class="token number">26</span> <span class="token operator">+</span><span class="token number">303</span><span class="token punctuation">,</span><span class="token number">6</span> @@
 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token operator">-</span><span class="token operator">&amp;</span>i2c4 <span class="token punctuation">{<!-- --></span>
<span class="token operator">-</span>	status <span class="token operator">=</span> <span class="token string">"disabled"</span><span class="token punctuation">;</span>
<span class="token operator">-</span>	i2c<span class="token operator">-</span>scl<span class="token operator">-</span>rising<span class="token operator">-</span>time<span class="token operator">-</span>ns <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">600</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>	i2c<span class="token operator">-</span>scl<span class="token operator">-</span>falling<span class="token operator">-</span>time<span class="token operator">-</span>ns <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">20</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>
<span class="token operator">-</span>	mpu6500@<span class="token number">68</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">-</span>		status <span class="token operator">=</span> <span class="token string">"disabled"</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		compatible <span class="token operator">=</span> <span class="token string">"invensense,mpu6500"</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x68</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		irq<span class="token operator">-</span>gpio <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio1 <span class="token number">22</span> IRQ_TYPE_EDGE_RISING<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		mpu<span class="token operator">-</span>int_config <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x10</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		mpu<span class="token operator">-</span>level_shifter <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		mpu<span class="token operator">-</span>orientation <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		orientation<span class="token operator">-</span>x<span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		orientation<span class="token operator">-</span>y<span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		orientation<span class="token operator">-</span>z<span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		mpu<span class="token operator">-</span>debug <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">-</span>	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">-</span>
 <span class="token operator">&amp;</span>i2c7 <span class="token punctuation">{<!-- --></span>
 	status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
 	rtc@<span class="token number">51</span> <span class="token punctuation">{<!-- --></span>
diff <span class="token operator">--</span>git a<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>sapphire<span class="token operator">-</span>excavator<span class="token operator">-</span>edp<span class="token punctuation">.</span>dtsi b<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>sapphire<span class="token operator">-</span>excavator<span class="token operator">-</span>edp<span class="token punctuation">.</span>dtsi
index <span class="token number">83</span>b7560801<span class="token punctuation">.</span><span class="token punctuation">.</span>da84220e47 <span class="token number">100644</span>
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>sapphire<span class="token operator">-</span>excavator<span class="token operator">-</span>edp<span class="token punctuation">.</span>dtsi
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>sapphire<span class="token operator">-</span>excavator<span class="token operator">-</span>edp<span class="token punctuation">.</span>dtsi
@@ <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">7</span> @@
 	vcc_lcd<span class="token operator">:</span> vcc<span class="token operator">-</span>lcd <span class="token punctuation">{<!-- --></span>
 		compatible <span class="token operator">=</span> <span class="token string">"regulator-fixed"</span><span class="token punctuation">;</span>
 		regulator<span class="token operator">-</span>name <span class="token operator">=</span> <span class="token string">"vcc_lcd"</span><span class="token punctuation">;</span>
<span class="token operator">-</span>		gpio <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio2 <span class="token number">26</span> GPIO_ACTIVE_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token comment">//gpio = &lt;&amp;gpio2 26 GPIO_ACTIVE_HIGH&gt;;</span>
 		startup<span class="token operator">-</span>delay<span class="token operator">-</span>us <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">20000</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
 		enable<span class="token operator">-</span>active<span class="token operator">-</span>high<span class="token punctuation">;</span>
 		regulator<span class="token operator">-</span>min<span class="token operator">-</span>microvolt <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">3300000</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
@@ <span class="token operator">-</span><span class="token number">423</span><span class="token punctuation">,</span><span class="token number">15</span> <span class="token operator">+</span><span class="token number">423</span><span class="token punctuation">,</span><span class="token number">15</span> @@
 <span class="token operator">&amp;</span>isp1_mmu <span class="token punctuation">{<!-- --></span>
<span class="token operator">-</span>	status <span class="token operator">=</span> <span class="token string">"disabled"</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>    <span class="token comment">// isp 驱动使用了 iommu，所以 isp iommu 也需要打开</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
@@ <span class="token operator">-</span><span class="token number">451</span><span class="token punctuation">,</span><span class="token number">16</span> <span class="token operator">+</span><span class="token number">451</span><span class="token punctuation">,</span><span class="token number">45</span> @@
 <span class="token operator">&amp;</span>mipi_dphy_tx1rx1 <span class="token punctuation">{<!-- --></span>
<span class="token operator">-</span>	status <span class="token operator">=</span> <span class="token string">"disabled"</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	ports <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		#address<span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		#size<span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>		port@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			#address<span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			#size<span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>			mipi_in_ucam0<span class="token operator">:</span> endpoint@<span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>				reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>				remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>ucam_out0<span class="token operator">&gt;</span><span class="token punctuation">;</span>	<span class="token comment">// sensor 端的 port 名</span>
<span class="token operator">+</span>				data<span class="token operator">-</span>lanes <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>		port@<span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			#address<span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			#size<span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>			dphy_tx1rx1_out<span class="token operator">:</span> endpoint@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>				reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>				remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>isp1_mipi_in<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 <span class="token operator">&amp;</span>vopb <span class="token punctuation">{<!-- --></span>
@@ <span class="token operator">-</span><span class="token number">484</span><span class="token punctuation">,</span><span class="token number">19</span> <span class="token operator">+</span><span class="token number">513</span><span class="token punctuation">,</span><span class="token number">31</span> @@
 <span class="token operator">&amp;</span>rkisp1_1 <span class="token punctuation">{<!-- --></span>
<span class="token operator">-</span>	status <span class="token operator">=</span> <span class="token string">"disabled"</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	port <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		#address<span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		#size<span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>		isp1_mipi_in<span class="token operator">:</span> endpoint@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>dphy_tx1rx1_out<span class="token operator">&gt;</span><span class="token punctuation">;</span>   <span class="token comment">// mipi dphy 端的 port 名</span>
<span class="token operator">+</span>		<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 <span class="token operator">&amp;</span>pinctrl <span class="token punctuation">{<!-- --></span>
diff <span class="token operator">--</span>git a<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>sapphire<span class="token punctuation">.</span>dtsi b<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>sapphire<span class="token punctuation">.</span>dtsi
index <span class="token number">5</span>b36e3c56d<span class="token punctuation">.</span><span class="token punctuation">.</span>ee56830ab5 <span class="token number">100644</span>
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>sapphire<span class="token punctuation">.</span>dtsi
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>kernel<span class="token operator">/</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>boot<span class="token operator">/</span>dts<span class="token operator">/</span>rockchip<span class="token operator">/</span>rk3399<span class="token operator">-</span>sapphire<span class="token punctuation">.</span>dtsi
@@ <span class="token operator">-</span><span class="token number">555</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">555</span><span class="token punctuation">,</span><span class="token number">7</span> @@
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 <span class="token operator">&amp;</span>i2c4 <span class="token punctuation">{<!-- --></span>
<span class="token operator">-</span>	status <span class="token operator">=</span> <span class="token string">"disabled"</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
 	i2c<span class="token operator">-</span>scl<span class="token operator">-</span>rising<span class="token operator">-</span>time<span class="token operator">-</span>ns <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">475</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
 	i2c<span class="token operator">-</span>scl<span class="token operator">-</span>falling<span class="token operator">-</span>time<span class="token operator">-</span>ns <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">26</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
 
@@ <span class="token operator">-</span><span class="token number">568</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">568</span><span class="token punctuation">,</span><span class="token number">33</span> @@
 		vbus<span class="token operator">-</span><span class="token number">5</span>v<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio1 <span class="token number">3</span> GPIO_ACTIVE_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 		status <span class="token operator">=</span> <span class="token string">"disabled"</span><span class="token punctuation">;</span>
 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	ov13850<span class="token operator">:</span> ov13850@<span class="token number">10</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		compatible <span class="token operator">=</span> <span class="token string">"ovti,ov13850"</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x10</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		clocks <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>cru SCLK_CIF_OUT<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		clock<span class="token operator">-</span>names <span class="token operator">=</span> <span class="token string">"xvclk"</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>		<span class="token comment">/* conflict with csi-ctl-gpios */</span>
<span class="token operator">+</span>		reset<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio2 RK_PD2 GPIO_ACTIVE_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		pwdn<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio1 RK_PC7 GPIO_ACTIVE_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		pinctrl<span class="token operator">-</span>names <span class="token operator">=</span> <span class="token string">"rockchip,camera_default"</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		pinctrl<span class="token operator">-</span><span class="token number">0</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>cif_clkout<span class="token operator">&gt;</span><span class="token punctuation">;</span>	<span class="token comment">// pinctl 设置</span>
<span class="token operator">+</span>
<span class="token operator">+</span>		rockchip<span class="token punctuation">,</span>camera<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">-</span>index <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>	<span class="token comment">// 模组编号，该编号不要重复，因为xml文件中的moduleId="m01"，所有设置1</span>
<span class="token operator">+</span>		rockchip<span class="token punctuation">,</span>camera<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">-</span>facing <span class="token operator">=</span> <span class="token string">"front"</span><span class="token punctuation">;</span>	<span class="token comment">// 模组朝向，有"back"和"front"</span>
<span class="token operator">+</span>		rockchip<span class="token punctuation">,</span>camera<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">-</span>name <span class="token operator">=</span> <span class="token string">"CMK-CT0116"</span><span class="token punctuation">;</span>	<span class="token comment">// 模组名</span>
<span class="token operator">+</span>		rockchip<span class="token punctuation">,</span>camera<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">-</span>lens<span class="token operator">-</span>name <span class="token operator">=</span> <span class="token string">"Largan-50013A1"</span><span class="token punctuation">;</span>	<span class="token comment">// lens 名</span>
<span class="token operator">+</span>		<span class="token comment">// 模组名和 lens 名被用来和 IQ xml 文件做匹配，使用的是hardware\rockchip\camera\etc\camera\rkisp1\ov13850_CMK-CT0116_Largan-50013A1.xml文件</span>
<span class="token operator">+</span>		<span class="token comment">//lens-focus = &lt;&amp;vm149c&gt;; // vcm 驱动设置，支持 AF 时需要有这个设置</span>
<span class="token operator">+</span>		port <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			ucam_out0<span class="token operator">:</span> endpoint <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>				remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>mipi_in_ucam0<span class="token operator">&gt;</span><span class="token punctuation">;</span>	<span class="token comment">// mipi dphy 端的 port 名</span>
<span class="token operator">+</span>				data<span class="token operator">-</span>lanes <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>	<span class="token comment">// mipi lane 数</span>
<span class="token operator">+</span>			<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/39aa88f48eea0299445e51e644882a6d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【2024软件测试面试必会技能】Appium自动化(6)：原生app元素定位方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f3fbfc0f3fb7b69852d04f3a6121f405/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">nodejs&#43;vue&#43;ElementUi旅游景区门票预约系统停车系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>