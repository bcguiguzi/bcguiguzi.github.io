<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MVC简单的增删改查 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MVC简单的增删改查" />
<meta property="og:description" content="MVC简单的增删改查 最近的学习了一下mvc，现在做一个mvc的CRUD例子。
1、创建实体模型
2、创建一个UserInfo的控制器
3、查询数据 public IList&lt;UserInfo&gt; userInfoList { get; set; } DemoEntities demoEntities = new DemoEntities();//创建EF上下文 public ActionResult Index() { userInfoList = demoEntities.Set&lt;UserInfo&gt;().ToList(); ViewBag.userInfoList = userInfoList; return View(); } view @{ Layout = null; } @using MVCCRUDAPI.Models; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width&#34; /&gt; &lt;title&gt;Index&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;table&gt; &lt;tr&gt;&lt;td&gt;用户名&lt;/td&gt;&lt;td&gt;密码&lt;/td&gt;&lt;td&gt;年龄&lt;/td&gt;&lt;td&gt;邮箱&lt;/td&gt;&lt;td&gt;备注&lt;/td&gt;&lt;td&gt;添加时间&lt;/td&gt;&lt;td&gt;操作&lt;/td&gt;&lt;/tr&gt; @foreach (UserInfo userInfo in ViewBag.userInfoList) { &lt;tr&gt;&lt;td&gt;@userInfo.UserName&lt;/td&gt;&lt;td&gt;@userInfo.UserPwd&lt;/td&gt;&lt;td&gt;@userInfo.Age&lt;td&gt;@userInfo.Email&lt;/td&gt;&lt;td&gt;@userInfo.Remark&lt;/td&gt;&lt;td&gt;@userInfo.RegTime&lt;/td&gt;&lt;td&gt;&lt;a href=&#34;/UserInfo/Edit/@userInfo.Id&#34;&gt;编辑&lt;/a&gt; &lt;a href=&#34;javascript:void(0)&#34; onclick=&#34;del(@userInfo.Id)&#34;&gt;删除&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt; } &lt;/table&gt; &lt;/body&gt; &lt;/html&gt; 数据显示
3、添加数据 code public ActionResult Add() { return View(); } [HttpPost] public ActionResult Add(UserInfo userInfo) { if (!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/013733930a2ccb5fc83c3ee0a64e6936/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-02T10:53:16+08:00" />
<meta property="article:modified_time" content="2019-06-02T10:53:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MVC简单的增删改查</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><a href="https://www.cnblogs.com/dx5800/p/5575528.html" rel="nofollow" id="cb_post_title_url">MVC简单的增删改查</a></h2> 
<p>最近的学习了一下mvc，现在做一个mvc的CRUD例子。</p> 
<p>1、创建实体模型</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/7d/2f/8fMS88wn_o.png"></p> 
<p>2、创建一个UserInfo的控制器</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/1f/6c/X3P8nGTg_o.png"></p> 
<p> <img alt="" class="has" src="https://images2.imgbox.com/03/3f/aSjAwGVC_o.png"></p> 
<h3>3、查询数据</h3> 
<pre class="has"><code class="language-html"> public IList&lt;UserInfo&gt; userInfoList { get; set; }
         DemoEntities demoEntities = new DemoEntities();//创建EF上下文
         public ActionResult Index()
         {
             userInfoList = demoEntities.Set&lt;UserInfo&gt;().ToList();
             ViewBag.userInfoList = userInfoList;
             return View();
         }</code>
</pre> 
<h4>view</h4> 
<pre class="has"><code class="language-html">  @{
      Layout = null;
  }
  @using MVCCRUDAPI.Models;
  &lt;!DOCTYPE html&gt;
  
  &lt;html&gt;
  &lt;head&gt;
     &lt;meta name="viewport" content="width=device-width" /&gt;
     &lt;title&gt;Index&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
     &lt;table&gt;
         &lt;tr&gt;&lt;td&gt;用户名&lt;/td&gt;&lt;td&gt;密码&lt;/td&gt;&lt;td&gt;年龄&lt;/td&gt;&lt;td&gt;邮箱&lt;/td&gt;&lt;td&gt;备注&lt;/td&gt;&lt;td&gt;添加时间&lt;/td&gt;&lt;td&gt;操作&lt;/td&gt;&lt;/tr&gt;
         @foreach (UserInfo userInfo in ViewBag.userInfoList)
         {
             &lt;tr&gt;&lt;td&gt;@userInfo.UserName&lt;/td&gt;&lt;td&gt;@userInfo.UserPwd&lt;/td&gt;&lt;td&gt;@userInfo.Age&lt;td&gt;@userInfo.Email&lt;/td&gt;&lt;td&gt;@userInfo.Remark&lt;/td&gt;&lt;td&gt;@userInfo.RegTime&lt;/td&gt;&lt;td&gt;&lt;a href="/UserInfo/Edit/@userInfo.Id"&gt;编辑&lt;/a&gt; &lt;a href="javascript:void(0)" onclick="del(@userInfo.Id)"&gt;删除&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
         }
     &lt;/table&gt;
 &lt;/body&gt;
 &lt;/html&gt;</code></pre> 
<p>数据显示</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/0a/c4/ZABZr0WV_o.png"></p> 
<h3>3、添加数据</h3> 
<h4>code</h4> 
<pre class="has"><code class="language-html">  public ActionResult Add()
         {
             return View();
         }
         [HttpPost]
         public ActionResult Add(UserInfo userInfo)
         {
             if (!ModelState.IsValid)
             {
                 return Content("error");
             }
             userInfo.RegTime = DateTime.Now;
             demoEntities.UserInfo.Add(userInfo);
             demoEntities.SaveChanges();
             return Content("ok");
        }</code></pre> 
<h4>view</h4> 
<p> </p> 
<pre class="has"><code class="language-html"> @{
     Layout = null;
 }
 @model MVCCRUDAPI.Models.UserInfo
 &lt;!DOCTYPE html&gt;
 
 &lt;html&gt;
 &lt;head&gt;
     &lt;meta name="viewport" content="width=device-width" /&gt;
     &lt;title&gt;添加&lt;/title&gt;
     &lt;script src="~/Scripts/jquery-1.8.2.js"&gt;&lt;/script&gt;
     &lt;script src="~/Scripts/jquery.unobtrusive-ajax.min.js"&gt;&lt;/script&gt;
     &lt;script src="~/Scripts/jquery.validate.min.js"&gt;&lt;/script&gt;
     &lt;script src="~/Scripts/jquery.validate.unobtrusive.min.js"&gt;&lt;/script&gt;
     &lt;script&gt;
         function success(data) {
             if (data == "ok") {
                 alert("添加成功");
                 window.location.href = "/UserInfo/Index";
             }
             else if (data == "error") {
                 alert("参数提交失败");
             }
         }
     &lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
     &lt;div&gt;
         @using (Ajax.BeginForm("add", "UserInfo", new AjaxOptions { HttpMethod = "post", OnSuccess = "success" }))
         {
             &lt;div&gt;
                 @Html.LabelFor(u =&gt; u.UserName)
             &lt;/div&gt;
             &lt;div&gt;
                 @Html.TextBoxFor(u =&gt; u.UserName)
                 
             &lt;/div&gt;
             &lt;div&gt;
                 @Html.LabelFor(u =&gt; u.UserPwd)
             &lt;/div&gt;
             &lt;div&gt;
                 @Html.PasswordFor(u =&gt; u.UserPwd)
                 
             &lt;/div&gt;
             &lt;div&gt;
                 @Html.LabelFor(u =&gt; u.Email)
             &lt;/div&gt;
             &lt;div&gt;
                 @Html.TextBoxFor(u =&gt; u.Email)
                 
             &lt;/div&gt;
             &lt;div&gt;
                 @Html.LabelFor(u =&gt; u.Age)
             &lt;/div&gt;
             &lt;div&gt;
                 @Html.TextBoxFor(u =&gt; u.Age)
                 
            &lt;/div&gt;
             &lt;div&gt;
                 @Html.LabelFor(u =&gt; u.Remark)
             &lt;/div&gt;
             &lt;div&gt;
                 @Html.TextAreaFor(u =&gt; u.Remark)
                 
             &lt;/div&gt;
             &lt;br /&gt;
             &lt;input type="submit" value="添加" /&gt;  &lt;a href="/UserInfo/Index"&gt;返回&lt;/a&gt;
         }
     &lt;/div&gt;
 &lt;/body&gt;
 &lt;/html&gt;</code></pre> 
<p> </p> 
<p>4、更新数据</p> 
<p>code</p> 
<pre class="has"><code class="language-html"> 1 UserInfo userInfo = new UserInfo();
 2 public ActionResult Edit(int id)
 3         {
 4             userInfo = demoEntities.Set&lt;UserInfo&gt;().Where(u =&gt; u.Id == id).FirstOrDefault();
 5             return View(userInfo);
 6         }
 7         [HttpPost]
 8         public ActionResult Edit(UserInfo userInfo)
 9         {
10             if (!ModelState.IsValid)
11             {
12                 return Content("error");
13             }
14             demoEntities.UserInfo.Attach(userInfo);//对象添加到EF管理容器中
15             demoEntities.Entry(userInfo).State = EntityState.Modified;
16             demoEntities.SaveChanges();
17             return Content("ok");
18         }</code></pre> 
<p> </p> 
<p>veiw</p> 
<pre class="has"><code class="language-html"> 1 @model MVCCRUDAPI.Models.UserInfo
 2 
 3 @{
 4     Layout = null;
 5 }
 6 
 7 &lt;!DOCTYPE html&gt;
 8 
 9 &lt;html&gt;
10 &lt;head&gt;
11     &lt;meta name="viewport" content="width=device-width" /&gt;
12     &lt;title&gt;编辑&lt;/title&gt;
13 &lt;/head&gt;
14 &lt;body&gt;
15     &lt;script src="~/Scripts/jquery-1.8.2.js"&gt;&lt;/script&gt;
16     &lt;script src="~/Scripts/jquery.unobtrusive-ajax.min.js"&gt;&lt;/script&gt;
17     &lt;script src="~/Scripts/jquery.validate.min.js"&gt;&lt;/script&gt;
18     &lt;script src="~/Scripts/jquery.validate.unobtrusive.min.js"&gt;&lt;/script&gt;
19     &lt;script&gt;
20         function success(data) {
21             if (data == "ok") {
22                 alert("编辑成功");
23                 window.location.href = "/UserInfo/Index";
24             }
25             else if (data == "error") {
26                 alert("参数提交失败");
27             }
28         }
29     &lt;/script&gt;
30     @using (Ajax.BeginForm("Edit", "UserInfo", new AjaxOptions { OnSuccess = "success", HttpMethod = "post" }))
31     {
32         @Html.HiddenFor(model =&gt; model.Id)
33 
34         &lt;div&gt;
35             @Html.LabelFor(model =&gt; model.UserName)
36         &lt;/div&gt;
37         &lt;div&gt;
38             @Html.EditorFor(model =&gt; model.UserName)
39             
40         &lt;/div&gt;
41         &lt;div&gt;
42             @Html.LabelFor(model =&gt; model.UserPwd)
43         &lt;/div&gt;
44         &lt;div&gt;
45             @Html.EditorFor(model =&gt; model.UserPwd)
46             
47         &lt;/div&gt;
48         &lt;div&gt;
49             @Html.LabelFor(model =&gt; model.Age)
50         &lt;/div&gt;
51         &lt;div&gt;
52             @Html.EditorFor(model =&gt; model.Age)
53            
54         &lt;/div&gt;
55         &lt;div&gt;
56             @Html.LabelFor(model =&gt; model.Email)
57         &lt;/div&gt;
58         &lt;div&gt;
59             @Html.EditorFor(model =&gt; model.Email)
60             
61         &lt;/div&gt;
62         &lt;div&gt;
63             @Html.LabelFor(model =&gt; model.Remark)
64         &lt;/div&gt;
65         &lt;div&gt;
66             @Html.TextAreaFor(u =&gt; u.Remark)
67             
68         &lt;/div&gt;
69         @Html.HiddenFor(model =&gt; model.RegTime)
70         &lt;p&gt;
71             &lt;input type="submit" value="保存" /&gt; &lt;a href="/UserInfo/Index"&gt;返回&lt;/a&gt;
72         &lt;/p&gt;
73     }
74 &lt;/body&gt;
75 &lt;/html&gt;</code></pre> 
<p> </p> 
<p>5、删除数据</p> 
<p>code</p> 
<pre class="has"><code class="language-html">1 public ActionResult Delete(int id)
2         {
3             userInfo.Id = id;
4             demoEntities.UserInfo.Attach(userInfo);//对象添加到EF管理容器中
5             demoEntities.Entry(userInfo).State = EntityState.Deleted;
6             demoEntities.SaveChanges();
7             return Content("ok");
8         }</code></pre> 
<p>view 在index页面加入下面的js代码即可</p> 
<pre class="has"><code class="language-html"> 1 &lt;script&gt;
 2         function del(id) {
 3             if (confirm("确定删除吗?")) {
 4                 $.post("/UserInfo/Delete/" + id, null,
 5                     function success(data) {
 6                         if (data == "ok") {
 7                             alert("删除成功");
 8                             window.location.href = "/UserInfo/Index";
 9                         }
10                         else {
11                             alert("参数错误");
12                         }
13                     })
14             }
15         }
16     &lt;/script&gt;</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bd1f4bb6578ffd4e0551f0fd4ebd8ca0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言实现雅可比迭代（计算方法）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/177c443a14e90e943add56d772e1f5d0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JS处理json数据的方法总结，包括增、删、改、查、合并、去重的处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>