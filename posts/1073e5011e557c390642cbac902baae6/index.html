<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Keras---序贯模型 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Keras---序贯模型" />
<meta property="og:description" content="快速开始序贯（Sequential）模型 序贯模型是多个网络层的线性堆叠，也就是“一条路走到黑”。
可以通过向Sequential模型传递一个layer的list来构造该模型：
from keras.models import Sequential from keras.layers import Dense, Activation model = Sequential([ Dense(32, units=784), # 代码感觉有误，应该是input_shape=(784,) Activation(&#39;relu&#39;), Dense(10), Activation(&#39;softmax&#39;), ]) 也可以通过.add()方法一个个的将layer加入模型中：
model = Sequential() model.add(Dense(32, input_shape=(784,))) model.add(Activation(&#39;relu&#39;)) 指定输入数据的shape 模型需要知道输入数据的shape，因此，Sequential的第一层需要接受一个关于输入数据shape的参数，后面的各个层则可以自动的推导出中间数据的shape，因此不需要为每个层都指定这个参数。有几种方法来为第一层指定输入数据的shape
传递一个input_shape的关键字参数给第一层，input_shape是一个tuple类型的数据，其中也可以填入None，如果填入None则表示此位置可能是任何正整数。数据的batch大小不应包含在其中。
有些2D层，如Dense，支持通过指定其输入维度input_dim来隐含的指定输入数据shape。一些3D的时域层支持通过参数input_dim和input_length来指定输入shape。
如果你需要为输入指定一个固定大小的batch_size（常用于stateful RNN网络），可以传递batch_size参数到一个层中，例如你想指定输入张量的batch大小是32，数据shape是（6，8），则你需要传递batch_size=32和input_shape=(6,8)。
model = Sequential() model.add(Dense(32, input_dim=784)) model = Sequential() model.add(Dense(32, input_shape=784)) 编译 在训练模型之前，我们需要通过compile来对学习过程进行配置。compile接收三个参数：
优化器optimizer：该参数可指定为已预定义的优化器名，如rmsprop、adagrad，或一个Optimizer类的对象，详情见optimizers
损失函数loss：该参数为模型试图最小化的目标函数，它可为预定义的损失函数名，如categorical_crossentropy、mse，也可以为一个损失函数。详情见losses
指标列表metrics：对分类问题，我们一般将该列表设置为metrics=[&#39;accuracy&#39;]。指标可以是一个预定义指标的名字,也可以是一个用户定制的函数.指标函数应该返回单个张量,或一个完成metric_name - &gt; metric_value映射的字典.请参考性能评估
# For a multi-class classification problem model.compile(optimizer=&#39;rmsprop&#39;, loss=&#39;categorical_crossentropy&#39;, metrics=[&#39;accuracy&#39;]) # For a binary classification problem model." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/1073e5011e557c390642cbac902baae6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-09-28T23:55:37+08:00" />
<meta property="article:modified_time" content="2017-09-28T23:55:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Keras---序贯模型</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="sequential" style='margin-top:0px; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:25.2px; color:rgb(64,64,64); background-color:rgb(252,252,252)'> 快速开始序贯（Sequential）模型</h2> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> <span style="color:rgb(64,64,64)">序贯模型是多个网络层的</span><span style="color:#000099"><strong>线性堆叠</strong></span><span style="color:#404040">，也就是“一条路走到黑”。</span></p> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> 可以通过向<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>Sequential</code>模型传递一个layer的list来构造该模型：</p> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-keyword" style="font-weight:bold">from</span> keras.models <span class="hljs-keyword" style="font-weight:bold">import</span> Sequential
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> Dense, Activation

model = Sequential([
Dense(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, units=<span class="hljs-number" style="color:rgb(0,128,128)">784</span>), # 代码感觉有误，应该是input_shape=(784,)
Activation(<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>),
Dense(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>),
Activation(<span class="hljs-string" style="color:rgb(221,17,68)">'softmax'</span>),
])
</code></pre> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> 也可以通过<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>.add()</code>方法一个个的将layer加入模型中：</p> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'>model = Sequential()
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, input_shape=(<span class="hljs-number" style="color:rgb(0,128,128)">784</span>,)))
model.add(Activation(<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
</code></pre> 
<hr style='height:1px; border-right:0px; border-bottom:0px; border-left:0px; border-top-style:solid; border-top-color:rgb(225,228,229); margin:24px 0px; padding:0px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; font-size:14.4px; background-color:rgb(252,252,252)'> 
<h3 id="shape" style='margin-top:0px; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:21.6px; color:rgb(64,64,64); background-color:rgb(252,252,252)'> 指定输入数据的shape</h3> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> <span style="color:#404040">模型需要知道输入数据的shape，因此，</span><code style='color:rgb(231,76,60); font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; overflow-x:auto; word-wrap:break-word'>Sequential</code><span style="color:#404040">的第一层需要接受一个关于输入数据shape的参数，后面的各个层则可以自动的推导出中间数据的shape，因此</span><strong style=""><span style="color:#000099">不需要为每个层都指定这个参数</span></strong><span style="color:#404040">。有几种方法来为第一层指定输入数据的shape</span></p> 
<ul style='margin:0px 0px 24px; padding:0px; list-style-position:initial; line-height:24px; font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; font-size:14.4px; background-color:rgb(252,252,252)'><li style="list-style:disc; margin-left:24px"> <p style="line-height:24px; margin-top:0px; margin-bottom:0px; font-size:16px"><span style="color:#404040">传递一个</span><code style='color:rgb(231,76,60); font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; overflow-x:auto; word-wrap:break-word'>input_shape</code><span style="color:#404040">的关键字参数给第一层，</span><code style='color:rgb(231,76,60); font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; overflow-x:auto; word-wrap:break-word'>input_shape</code><span style="color:#404040">是一个tuple类型的数据，其中也可以填入</span><code style='color:rgb(231,76,60); font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; overflow-x:auto; word-wrap:break-word'>None</code><span style="color:#404040">，</span><span style="color:#000099"><strong>如果填入<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; overflow-x:auto; word-wrap:break-word'>None</code>则表示此位置可能是任何正整数</strong></span><span style="color:#404040">。</span><span style="color:#000099"><strong>数据的batch大小不应包含在其中</strong></span><span style="color:#404040">。</span></p> </li><li style="color:rgb(64,64,64); list-style:disc; margin-left:24px"> <p style="line-height:24px; margin-top:0px; margin-bottom:0px; font-size:16px">有些2D层，如<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>Dense</code>，支持通过指定其输入维度<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>input_dim</code>来隐含的指定输入数据shape。一些3D的时域层支持通过参数<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>input_dim</code>和<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>input_length</code>来指定输入shape。</p> </li><li style="list-style:disc; margin-left:24px"> <p style="line-height:24px; margin-top:0px; margin-bottom:0px; font-size:16px"><span style="color:#404040">如果你需要为输入指定一个固定大小的batch_size（常用于stateful RNN网络），可以传递</span><code style='color:rgb(231,76,60); font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; overflow-x:auto; word-wrap:break-word'>batch_size</code><span style="color:#404040">参数到一个层中，例如你想指定输入张量的batch大小是32，数据shape是（6，8），则你需要传递</span><span style="color:#000099"><code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; overflow-x:auto; word-wrap:break-word'>batch_size=32</code>和<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; overflow-x:auto; word-wrap:break-word'>input_shape=(6,8)</code></span><span style="color:#404040">。</span></p> </li></ul> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'>model = Sequential()
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, input_dim=<span class="hljs-number" style="color:rgb(0,128,128)">784</span>))
</code></pre> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'>model = Sequential()
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, input_shape=<span class="hljs-number" style="color:rgb(0,128,128)">784</span>))
</code></pre> 
<hr style='height:1px; border-right:0px; border-bottom:0px; border-left:0px; border-top-style:solid; border-top-color:rgb(225,228,229); margin:24px 0px; padding:0px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; font-size:14.4px; background-color:rgb(252,252,252)'> 
<h3 id="_1" style='margin-top:0px; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:21.6px; color:rgb(64,64,64); background-color:rgb(252,252,252)'> 编译</h3> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> 在训练模型之前，我们需要通过<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>compile</code>来对学习过程进行配置。<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>compile</code>接收三个参数：</p> 
<ul style='margin:0px 0px 24px; padding:0px; list-style-position:initial; line-height:24px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; font-size:14.4px; background-color:rgb(252,252,252)'><li style="list-style:disc; margin-left:24px"> <p style="line-height:24px; margin-top:0px; margin-bottom:0px; font-size:16px">优化器optimizer：该参数可指定为已预定义的优化器名，如<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>rmsprop</code>、<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>adagrad</code>，或一个<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>Optimizer</code>类的对象，详情见<a target="_blank" href="http://keras-cn.readthedocs.io/en/latest/other/optimizers/" rel="nofollow noopener noreferrer" style="color:rgb(155,89,182)">optimizers</a></p> </li><li style="list-style:disc; margin-left:24px"> <p style="line-height:24px; margin-top:0px; margin-bottom:0px; font-size:16px">损失函数loss：该参数为模型试图最小化的目标函数，它可为预定义的损失函数名，如<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>categorical_crossentropy</code>、<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>mse</code>，也可以为一个损失函数。详情见<a target="_blank" href="http://keras-cn.readthedocs.io/en/latest/other/objectives/" rel="nofollow noopener noreferrer" style="color:rgb(155,89,182)">losses</a></p> </li><li style="list-style:disc; margin-left:24px"> <p style="line-height:24px; margin-top:0px; margin-bottom:0px; font-size:16px">指标列表metrics：对分类问题，我们一般将该列表设置为<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>metrics=['accuracy']</code>。指标可以是一个预定义指标的名字,也可以是一个用户定制的函数.指标函数应该返回单个张量,或一个完成<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>metric_name - &gt; metric_value</code>映射的字典.请参考<a target="_blank" href="http://keras-cn.readthedocs.io/en/latest/getting_started/other/metrices.md" rel="nofollow noopener noreferrer" style="color:rgb(155,89,182)">性能评估</a></p> </li></ul> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># For a multi-class classification problem</span>
model.compile(optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              loss=<span class="hljs-string" style="color:rgb(221,17,68)">'categorical_crossentropy'</span>,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>])

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># For a binary classification problem</span>
model.compile(optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              loss=<span class="hljs-string" style="color:rgb(221,17,68)">'binary_crossentropy'</span>,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>])

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># For a mean squared error regression problem</span>
model.compile(optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              loss=<span class="hljs-string" style="color:rgb(221,17,68)">'mse'</span>)

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># For custom metrics</span>
<span class="hljs-keyword" style="font-weight:bold">import</span> keras.backend <span class="hljs-keyword" style="font-weight:bold">as</span> K

<span class="hljs-function" style=""><span class="hljs-keyword" style="font-weight:bold">def</span> <span class="hljs-title" style="color:rgb(153,0,0); font-weight:bold">mean_pred</span><span class="hljs-params" style="">(y_true, y_pred)</span>:</span>
    <span class="hljs-keyword" style="font-weight:bold">return</span> K.mean(y_pred)

model.compile(optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              loss=<span class="hljs-string" style="color:rgb(221,17,68)">'binary_crossentropy'</span>,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>, mean_pred])
</code></pre> 
<hr style='height:1px; border-right:0px; border-bottom:0px; border-left:0px; border-top-style:solid; border-top-color:rgb(225,228,229); margin:24px 0px; padding:0px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; font-size:14.4px; background-color:rgb(252,252,252)'> 
<h3 id="_2" style='margin-top:0px; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:21.6px; color:rgb(64,64,64); background-color:rgb(252,252,252)'> 训练</h3> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> Keras以Numpy数组作为输入数据和标签的数据类型。训练模型一般使用<code style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; white-space:pre; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0px 5px; color:rgb(231,76,60); overflow-x:auto; word-wrap:break-word'>fit</code>函数，该函数的详情见<a target="_blank" href="http://keras-cn.readthedocs.io/en/latest/models/sequential/" rel="nofollow noopener noreferrer" style="color:rgb(155,89,182)">这里</a>。下面是一些例子。</p> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># For a single-input model with 2 classes (binary classification):</span>

model = Sequential()
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>, input_dim=<span class="hljs-number" style="color:rgb(0,128,128)">100</span>))
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'sigmoid'</span>))
model.compile(optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              loss=<span class="hljs-string" style="color:rgb(221,17,68)">'binary_crossentropy'</span>,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>])

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Generate dummy data</span>
<span class="hljs-keyword" style="font-weight:bold">import</span> numpy <span class="hljs-keyword" style="font-weight:bold">as</span> np
data = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">1000</span>, <span class="hljs-number" style="color:rgb(0,128,128)">100</span>))
labels = np.random.randint(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, size=(<span class="hljs-number" style="color:rgb(0,128,128)">1000</span>, <span class="hljs-number" style="color:rgb(0,128,128)">1</span>))

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Train the model, iterating on the data in batches of 32 samples</span>
model.fit(data, labels, epochs=<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">32</span>)
</code></pre> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># For a single-input model with 10 classes (categorical classification):</span>

model = Sequential()
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>, input_dim=<span class="hljs-number" style="color:rgb(0,128,128)">100</span>))
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'softmax'</span>))
model.compile(optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              loss=<span class="hljs-string" style="color:rgb(221,17,68)">'categorical_crossentropy'</span>,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>])

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Generate dummy data</span>
<span class="hljs-keyword" style="font-weight:bold">import</span> numpy <span class="hljs-keyword" style="font-weight:bold">as</span> np
data = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">1000</span>, <span class="hljs-number" style="color:rgb(0,128,128)">100</span>))
labels = np.random.randint(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, size=(<span class="hljs-number" style="color:rgb(0,128,128)">1000</span>, <span class="hljs-number" style="color:rgb(0,128,128)">1</span>))

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Convert labels to categorical one-hot encoding</span>
one_hot_labels = keras.utils.to_categorical(labels, num_classes=<span class="hljs-number" style="color:rgb(0,128,128)">10</span>)

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Train the model, iterating on the data in batches of 32 samples</span>
model.fit(data, one_hot_labels, epochs=<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">32</span>)
</code></pre> 
<hr style='height:1px; border-right:0px; border-bottom:0px; border-left:0px; border-top-style:solid; border-top-color:rgb(225,228,229); margin:24px 0px; padding:0px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; font-size:14.4px; background-color:rgb(252,252,252)'> 
<h3 id="_3" style='margin-top:0px; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:21.6px; color:rgb(64,64,64); background-color:rgb(252,252,252)'> 例子</h3> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> 这里是一些帮助你开始的例子</p> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> 在Keras代码包的examples文件夹中，你将找到使用真实数据的示例模型：</p> 
<ul style='margin:0px 0px 24px; padding:0px; list-style-position:initial; line-height:24px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; font-size:14.4px; background-color:rgb(252,252,252)'><li style="list-style:disc; margin-left:24px">CIFAR10 小图片分类：使用CNN和实时数据提升</li><li style="list-style:disc; margin-left:24px">IMDB 电影评论观点分类：使用LSTM处理成序列的词语</li><li style="list-style:disc; margin-left:24px">Reuters（路透社）新闻主题分类：使用多层感知器（MLP）</li><li style="list-style:disc; margin-left:24px">MNIST手写数字识别：使用多层感知器和CNN</li><li style="list-style:disc; margin-left:24px">字符级文本生成：使用LSTM ...</li></ul> 
<h4 id="softmax" style='margin-top:0px; font-weight:300; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:18px; color:rgb(41,128,185); background-color:rgb(252,252,252)'> 基于多层感知器的softmax多分类：</h4> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-keyword" style="font-weight:bold">from</span> keras.models <span class="hljs-keyword" style="font-weight:bold">import</span> Sequential
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> Dense, Dropout, Activation
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.optimizers <span class="hljs-keyword" style="font-weight:bold">import</span> SGD

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Generate dummy data</span>
<span class="hljs-keyword" style="font-weight:bold">import</span> numpy <span class="hljs-keyword" style="font-weight:bold">as</span> np
x_train = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">1000</span>, <span class="hljs-number" style="color:rgb(0,128,128)">20</span>))
y_train = keras.utils.to_categorical(np.random.randint(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, size=(<span class="hljs-number" style="color:rgb(0,128,128)">1000</span>, <span class="hljs-number" style="color:rgb(0,128,128)">1</span>)), num_classes=<span class="hljs-number" style="color:rgb(0,128,128)">10</span>)
x_test = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">20</span>))
y_test = keras.utils.to_categorical(np.random.randint(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, size=(<span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">1</span>)), num_classes=<span class="hljs-number" style="color:rgb(0,128,128)">10</span>)

model = Sequential()
<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Dense(64) is a fully-connected layer with 64 hidden units.</span>
<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># in the first layer, you must specify the expected input data shape:</span>
<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># here, 20-dimensional vectors.</span>
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>, input_dim=<span class="hljs-number" style="color:rgb(0,128,128)">20</span>))
model.add(Dropout(<span class="hljs-number" style="color:rgb(0,128,128)">0.5</span>))
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
model.add(Dropout(<span class="hljs-number" style="color:rgb(0,128,128)">0.5</span>))
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'softmax'</span>))

sgd = SGD(lr=<span class="hljs-number" style="color:rgb(0,128,128)">0.01</span>, decay=<span class="hljs-number" style="color:rgb(0,128,128)">1e-6</span>, momentum=<span class="hljs-number" style="color:rgb(0,128,128)">0.9</span>, nesterov=<span class="hljs-keyword" style="font-weight:bold">True</span>)
model.compile(loss=<span class="hljs-string" style="color:rgb(221,17,68)">'categorical_crossentropy'</span>,
              optimizer=sgd,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>])

model.fit(x_train, y_train,
          epochs=<span class="hljs-number" style="color:rgb(0,128,128)">20</span>,
          batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">128</span>)
score = model.evaluate(x_test, y_test, batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">128</span>)
</code></pre> 
<h4 id="mlp" style='margin-top:0px; font-weight:300; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:18px; color:rgb(41,128,185); background-color:rgb(252,252,252)'> MLP的二分类：</h4> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-keyword" style="font-weight:bold">import</span> numpy <span class="hljs-keyword" style="font-weight:bold">as</span> np
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.models <span class="hljs-keyword" style="font-weight:bold">import</span> Sequential
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> Dense, Dropout

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Generate dummy data</span>
x_train = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">1000</span>, <span class="hljs-number" style="color:rgb(0,128,128)">20</span>))
y_train = np.random.randint(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, size=(<span class="hljs-number" style="color:rgb(0,128,128)">1000</span>, <span class="hljs-number" style="color:rgb(0,128,128)">1</span>))
x_test = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">20</span>))
y_test = np.random.randint(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, size=(<span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">1</span>))

model = Sequential()
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>, input_dim=<span class="hljs-number" style="color:rgb(0,128,128)">20</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
model.add(Dropout(<span class="hljs-number" style="color:rgb(0,128,128)">0.5</span>))
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
model.add(Dropout(<span class="hljs-number" style="color:rgb(0,128,128)">0.5</span>))
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'sigmoid'</span>))

model.compile(loss=<span class="hljs-string" style="color:rgb(221,17,68)">'binary_crossentropy'</span>,
              optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>])
model.fit(x_train, y_train,
          epochs=<span class="hljs-number" style="color:rgb(0,128,128)">20</span>,
          batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">128</span>)
score = model.evaluate(x_test, y_test, batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">128</span>)
</code></pre> 
<h4 id="vgg" style='margin-top:0px; font-weight:300; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:18px; color:rgb(41,128,185); background-color:rgb(252,252,252)'> 类似VGG的卷积神经网络：</h4> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-keyword" style="font-weight:bold">import</span> numpy <span class="hljs-keyword" style="font-weight:bold">as</span> np
<span class="hljs-keyword" style="font-weight:bold">import</span> keras
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.models <span class="hljs-keyword" style="font-weight:bold">import</span> Sequential
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> Dense, Dropout, Flatten
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> Conv2D, MaxPooling2D
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.optimizers <span class="hljs-keyword" style="font-weight:bold">import</span> SGD

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Generate dummy data</span>
x_train = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>))
y_train = keras.utils.to_categorical(np.random.randint(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, size=(<span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">1</span>)), num_classes=<span class="hljs-number" style="color:rgb(0,128,128)">10</span>)
x_test = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">20</span>, <span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>))
y_test = keras.utils.to_categorical(np.random.randint(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, size=(<span class="hljs-number" style="color:rgb(0,128,128)">20</span>, <span class="hljs-number" style="color:rgb(0,128,128)">1</span>)), num_classes=<span class="hljs-number" style="color:rgb(0,128,128)">10</span>)

model = Sequential()
<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># input: 100x100 images with 3 channels -&gt; (100, 100, 3) tensors.</span>
<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># this applies 32 convolution filters of size 3x3 each.</span>
model.add(Conv2D(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>), activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>, input_shape=(<span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">100</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>)))
model.add(Conv2D(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>), activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
model.add(MaxPooling2D(pool_size=(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>)))
model.add(Dropout(<span class="hljs-number" style="color:rgb(0,128,128)">0.25</span>))

model.add(Conv2D(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>, (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>), activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
model.add(Conv2D(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>, (<span class="hljs-number" style="color:rgb(0,128,128)">3</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>), activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
model.add(MaxPooling2D(pool_size=(<span class="hljs-number" style="color:rgb(0,128,128)">2</span>, <span class="hljs-number" style="color:rgb(0,128,128)">2</span>)))
model.add(Dropout(<span class="hljs-number" style="color:rgb(0,128,128)">0.25</span>))

model.add(Flatten())
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">256</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
model.add(Dropout(<span class="hljs-number" style="color:rgb(0,128,128)">0.5</span>))
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'softmax'</span>))

sgd = SGD(lr=<span class="hljs-number" style="color:rgb(0,128,128)">0.01</span>, decay=<span class="hljs-number" style="color:rgb(0,128,128)">1e-6</span>, momentum=<span class="hljs-number" style="color:rgb(0,128,128)">0.9</span>, nesterov=<span class="hljs-keyword" style="font-weight:bold">True</span>)
model.compile(loss=<span class="hljs-string" style="color:rgb(221,17,68)">'categorical_crossentropy'</span>, optimizer=sgd)

model.fit(x_train, y_train, batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, epochs=<span class="hljs-number" style="color:rgb(0,128,128)">10</span>)
score = model.evaluate(x_test, y_test, batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">32</span>)
</code></pre> 
<h4 id="lstm" style='margin-top:0px; font-weight:300; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:18px; color:rgb(41,128,185); background-color:rgb(252,252,252)'> 使用LSTM的序列分类</h4> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-keyword" style="font-weight:bold">from</span> keras.models <span class="hljs-keyword" style="font-weight:bold">import</span> Sequential
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> Dense, Dropout
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> Embedding
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> LSTM

model = Sequential()
model.add(Embedding(max_features, output_dim=<span class="hljs-number" style="color:rgb(0,128,128)">256</span>))
model.add(LSTM(<span class="hljs-number" style="color:rgb(0,128,128)">128</span>))
model.add(Dropout(<span class="hljs-number" style="color:rgb(0,128,128)">0.5</span>))
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'sigmoid'</span>))

model.compile(loss=<span class="hljs-string" style="color:rgb(221,17,68)">'binary_crossentropy'</span>,
              optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>])

model.fit(x_train, y_train, batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">16</span>, epochs=<span class="hljs-number" style="color:rgb(0,128,128)">10</span>)
score = model.evaluate(x_test, y_test, batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">16</span>)
</code></pre> 
<h4 id="1d" style='margin-top:0px; font-weight:300; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:18px; color:rgb(41,128,185); background-color:rgb(252,252,252)'> 使用1D卷积的序列分类</h4> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-keyword" style="font-weight:bold">from</span> keras.models <span class="hljs-keyword" style="font-weight:bold">import</span> Sequential
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> Dense, Dropout
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> Embedding
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> Conv1D, GlobalAveragePooling1D, MaxPooling1D

model = Sequential()
model.add(Conv1D(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>, input_shape=(seq_length, <span class="hljs-number" style="color:rgb(0,128,128)">100</span>)))
model.add(Conv1D(<span class="hljs-number" style="color:rgb(0,128,128)">64</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
model.add(MaxPooling1D(<span class="hljs-number" style="color:rgb(0,128,128)">3</span>))
model.add(Conv1D(<span class="hljs-number" style="color:rgb(0,128,128)">128</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
model.add(Conv1D(<span class="hljs-number" style="color:rgb(0,128,128)">128</span>, <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'relu'</span>))
model.add(GlobalAveragePooling1D())
model.add(Dropout(<span class="hljs-number" style="color:rgb(0,128,128)">0.5</span>))
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">1</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'sigmoid'</span>))

model.compile(loss=<span class="hljs-string" style="color:rgb(221,17,68)">'binary_crossentropy'</span>,
              optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>])

model.fit(x_train, y_train, batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">16</span>, epochs=<span class="hljs-number" style="color:rgb(0,128,128)">10</span>)
score = model.evaluate(x_test, y_test, batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">16</span>)
</code></pre> 
<h4 id="lstm_1" style='margin-top:0px; font-weight:300; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:18px; color:rgb(41,128,185); background-color:rgb(252,252,252)'> 用于序列分类的栈式LSTM</h4> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> 在该模型中，我们将三个LSTM堆叠在一起，是该模型能够学习更高层次的时域特征表示。</p> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> 开始的两层LSTM返回其全部输出序列，而第三层LSTM只返回其输出序列的最后一步结果，从而其时域维度降低（即将输入序列转换为单个向量）</p> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> <img alt="regular_stacked_lstm" src="https://images2.imgbox.com/a0/0c/Zw0e3fG2_o.png" style="border:0px; vertical-align:middle; max-width:100%; height:auto!important"></p> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-keyword" style="font-weight:bold">from</span> keras.models <span class="hljs-keyword" style="font-weight:bold">import</span> Sequential
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> LSTM, Dense
<span class="hljs-keyword" style="font-weight:bold">import</span> numpy <span class="hljs-keyword" style="font-weight:bold">as</span> np

data_dim = <span class="hljs-number" style="color:rgb(0,128,128)">16</span>
timesteps = <span class="hljs-number" style="color:rgb(0,128,128)">8</span>
num_classes = <span class="hljs-number" style="color:rgb(0,128,128)">10</span>

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># expected input data shape: (batch_size, timesteps, data_dim)</span>
model = Sequential()
model.add(LSTM(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, return_sequences=<span class="hljs-keyword" style="font-weight:bold">True</span>,
               input_shape=(timesteps, data_dim)))  <span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># returns a sequence of vectors of dimension 32</span>
model.add(LSTM(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, return_sequences=<span class="hljs-keyword" style="font-weight:bold">True</span>))  <span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># returns a sequence of vectors of dimension 32</span>
model.add(LSTM(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>))  <span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># return a single vector of dimension 32</span>
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'softmax'</span>))

model.compile(loss=<span class="hljs-string" style="color:rgb(221,17,68)">'categorical_crossentropy'</span>,
              optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>])

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Generate dummy training data</span>
x_train = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">1000</span>, timesteps, data_dim))
y_train = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">1000</span>, num_classes))

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Generate dummy validation data</span>
x_val = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">100</span>, timesteps, data_dim))
y_val = np.random.random((<span class="hljs-number" style="color:rgb(0,128,128)">100</span>, num_classes))

model.fit(x_train, y_train,
          batch_size=<span class="hljs-number" style="color:rgb(0,128,128)">64</span>, epochs=<span class="hljs-number" style="color:rgb(0,128,128)">5</span>,
          validation_data=(x_val, y_val))
</code></pre> 
<h4 id="stateful-lstm" style='margin-top:0px; font-weight:300; font-family:"Roboto Slab",ff-tisa-web-pro,Georgia,Arial,sans-serif; font-size:18px; color:rgb(41,128,185); background-color:rgb(252,252,252)'> 采用stateful LSTM的相同模型</h4> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> stateful LSTM的特点是，在处理过一个batch的训练数据后，其内部状态（记忆）会被作为下一个batch的训练数据的初始状态。状态LSTM使得我们可以在合理的计算复杂度内处理较长序列</p> 
<p style='line-height:24px; margin-top:0px; margin-bottom:24px; font-size:16px; color:rgb(64,64,64); font-family:Lato,proxima-nova,"Helvetica Neue",Arial,sans-serif; background-color:rgb(252,252,252)'> 请FAQ中关于<a target="_blank" href="http://keras-cn.readthedocs.io/en/latest/for_beginners/FAQ/" rel="nofollow noopener noreferrer" style="color:rgb(155,89,182)">stateful LSTM</a>的部分获取更多信息</p> 
<pre style="font-family:monospace,serif; font-size:14.4px; color:rgb(64,64,64); background-color:rgb(252,252,252)"><code class="python hljs" style='font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace; font-size:12px; max-width:100%; background:rgb(255,255,255); border:1px solid rgb(225,228,229); padding:0.5em; color:rgb(51,51,51); overflow-x:auto; display:block'><span class="hljs-keyword" style="font-weight:bold">from</span> keras.models <span class="hljs-keyword" style="font-weight:bold">import</span> Sequential
<span class="hljs-keyword" style="font-weight:bold">from</span> keras.layers <span class="hljs-keyword" style="font-weight:bold">import</span> LSTM, Dense
<span class="hljs-keyword" style="font-weight:bold">import</span> numpy <span class="hljs-keyword" style="font-weight:bold">as</span> np

data_dim = <span class="hljs-number" style="color:rgb(0,128,128)">16</span>
timesteps = <span class="hljs-number" style="color:rgb(0,128,128)">8</span>
num_classes = <span class="hljs-number" style="color:rgb(0,128,128)">10</span>
batch_size = <span class="hljs-number" style="color:rgb(0,128,128)">32</span>

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Expected input batch shape: (batch_size, timesteps, data_dim)</span>
<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Note that we have to provide the full batch_input_shape since the network is stateful.</span>
<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># the sample of index i in batch k is the follow-up for the sample i in batch k-1.</span>
model = Sequential()
model.add(LSTM(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, return_sequences=<span class="hljs-keyword" style="font-weight:bold">True</span>, stateful=<span class="hljs-keyword" style="font-weight:bold">True</span>,
               batch_input_shape=(batch_size, timesteps, data_dim)))
model.add(LSTM(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, return_sequences=<span class="hljs-keyword" style="font-weight:bold">True</span>, stateful=<span class="hljs-keyword" style="font-weight:bold">True</span>))
model.add(LSTM(<span class="hljs-number" style="color:rgb(0,128,128)">32</span>, stateful=<span class="hljs-keyword" style="font-weight:bold">True</span>))
model.add(Dense(<span class="hljs-number" style="color:rgb(0,128,128)">10</span>, activation=<span class="hljs-string" style="color:rgb(221,17,68)">'softmax'</span>))

model.compile(loss=<span class="hljs-string" style="color:rgb(221,17,68)">'categorical_crossentropy'</span>,
              optimizer=<span class="hljs-string" style="color:rgb(221,17,68)">'rmsprop'</span>,
              metrics=[<span class="hljs-string" style="color:rgb(221,17,68)">'accuracy'</span>])

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Generate dummy training data</span>
x_train = np.random.random((batch_size * <span class="hljs-number" style="color:rgb(0,128,128)">10</span>, timesteps, data_dim))
y_train = np.random.random((batch_size * <span class="hljs-number" style="color:rgb(0,128,128)">10</span>, num_classes))

<span class="hljs-comment" style="color:rgb(153,153,136); font-style:italic"># Generate dummy validation data</span>
x_val = np.random.random((batch_size * <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, timesteps, data_dim))
y_val = np.random.random((batch_size * <span class="hljs-number" style="color:rgb(0,128,128)">3</span>, num_classes))

model.fit(x_train, y_train,
          batch_size=batch_size, epochs=<span class="hljs-number" style="color:rgb(0,128,128)">5</span>, shuffle=<span class="hljs-keyword" style="font-weight:bold">False</span>,
          validation_data=(x_val, y_val))</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/282a754b729c504e4474009b5eff80b2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">编写代码模拟手机与SIM卡的组合关系。</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ee04920dfec038e828a6121804e1a73/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">InstallShield 2015 Limited Edition 打包程序详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>