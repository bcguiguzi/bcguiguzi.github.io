<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Zabbix监控vcenter集群 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Zabbix监控vcenter集群" />
<meta property="og:description" content="目录 一.部署zabbix安装zabbix-server替换阿里云Zabbix源安装Zabbix server 和 agent安装Zabbix frontend安装 Zabbix frontend packages安装Mysql数据库创建初始数据库为Zabbix server配置数据库为Zabbix前端配置PHP启动Zabbix server和agent进程 二.监控vcenter修改配置文件创建Vcenter主机链接Template VM VMware模板定义宏信息 结果展示 一.部署zabbix 安装zabbix-server 首先在虚拟机上把Centos7安装完毕并关闭防火墙与SElinux。
打开Zabbix官网选择Zabbix版本-OS系统-OS版本-数据库-WebServer
替换阿里云Zabbix源 编写shell脚本zabbix_aliyun.s
#!/bin/bash echo -e &#34;请给出要安装的zabbix版本号，建议使用4.x的版本 \033[31musage：./zabbix_aliyun.sh 4.0|4.4|4.5|5.0 \033[0m&#34; echo &#34;例如要安装4.4版本，在命令行写上 ./zabbix_aliyun.sh 4.4&#34; if [ -z $1 ];then exit fi VERSION=$1 if [ -f /etc/yum.repos.d/zabbix.repo ];then rm -rf /etc/repos.d/zabbix.repo fi rpm -qa | grep zabbix-release &amp;&amp; rpm -e zabbix-release rpm -Uvh https://mirrors.aliyun.com/zabbix/zabbix/$VERSION/rhel/7/x86_64/zabbix-release-$VERSION-1.el7.noarch.rpm sed -i &#34;s@zabbix/.*/rhel@zabbix/$VERSION/rhel@g&#34; /etc/yum.repos.d/zabbix.repo sed -i &#39;s@repo.zabbix.com@mirrors.aliyun.com/zabbix@g&#39; /etc/yum.repos.d/zabbix.repo [ $?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/0819ebf54dfbdd709a0d34218745b70c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-31T16:47:30+08:00" />
<meta property="article:modified_time" content="2022-05-31T16:47:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Zabbix监控vcenter集群</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#zabbix_3" rel="nofollow">一.部署zabbix</a></li><li><ul><li><a href="#zabbixserver_5" rel="nofollow">安装zabbix-server</a></li><li><a href="#Zabbix_10" rel="nofollow">替换阿里云Zabbix源</a></li><li><a href="#Zabbix_server__agent_45" rel="nofollow">安装Zabbix server 和 agent</a></li><li><a href="#Zabbix_frontend_49" rel="nofollow">安装Zabbix frontend</a></li><li><a href="#_Zabbix_frontend_packages_63" rel="nofollow">安装 Zabbix frontend packages</a></li><li><a href="#Mysql_67" rel="nofollow">安装Mysql数据库</a></li><li><a href="#_93" rel="nofollow">创建初始数据库</a></li><li><a href="#Zabbix_server_106" rel="nofollow">为Zabbix server配置数据库</a></li><li><a href="#ZabbixPHP_114" rel="nofollow">为Zabbix前端配置PHP</a></li><li><a href="#Zabbix_serveragent_122" rel="nofollow">启动Zabbix server和agent进程</a></li></ul> 
  </li><li><a href="#vcenter_142" rel="nofollow">二.监控vcenter</a></li><li><ul><li><a href="#_143" rel="nofollow">修改配置文件</a></li><li><a href="#Vcenter_158" rel="nofollow">创建Vcenter主机</a></li><li><a href="#Template_VM_VMware_165" rel="nofollow">链接Template VM VMware模板</a></li><li><a href="#_167" rel="nofollow">定义宏信息</a></li></ul> 
  </li><li><a href="#_170" rel="nofollow">结果展示</a></li></ul> 
</div> 
<p></p> 
<h2><a id="zabbix_3"></a>一.部署zabbix</h2> 
<h3><a id="zabbixserver_5"></a>安装zabbix-server</h3> 
<p>首先在虚拟机上把Centos7安装完毕并关闭防火墙与SElinux。</p> 
<p>打开Zabbix官网选择Zabbix版本-OS系统-OS版本-数据库-WebServer<img src="https://images2.imgbox.com/c4/45/BoiN99c1_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Zabbix_10"></a>替换阿里云Zabbix源</h3> 
<p>编写shell脚本zabbix_aliyun.s</p> 
<pre><code>#!/bin/bash

echo -e "请给出要安装的zabbix版本号，建议使用4.x的版本  \033[31musage：./zabbix_aliyun.sh 4.0|4.4|4.5|5.0 \033[0m"
echo "例如要安装4.4版本，在命令行写上 ./zabbix_aliyun.sh 4.4"
if [ -z $1 ];then
    exit
fi
VERSION=$1
if [ -f /etc/yum.repos.d/zabbix.repo ];then
    rm -rf /etc/repos.d/zabbix.repo
fi
rpm -qa | grep zabbix-release &amp;&amp; rpm -e zabbix-release
rpm -Uvh https://mirrors.aliyun.com/zabbix/zabbix/$VERSION/rhel/7/x86_64/zabbix-release-$VERSION-1.el7.noarch.rpm
sed -i "s@zabbix/.*/rhel@zabbix/$VERSION/rhel@g" /etc/yum.repos.d/zabbix.repo
sed -i 's@repo.zabbix.com@mirrors.aliyun.com/zabbix@g' /etc/yum.repos.d/zabbix.repo
[ $? -eq 0 ] &amp;&amp; echo "阿里云的zabbix源替换成功" || exit 1
yum clean all
yum makecache fast
</code></pre> 
<p>然后执行命令</p> 
<pre><code>chmod +x zabbix_aliyun.sh    //添加执行权限
bash zabbix_aliyun.sh 5.0
</code></pre> 
<p>前期准备</p> 
<pre><code>rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm
yum clean all
</code></pre> 
<h3><a id="Zabbix_server__agent_45"></a>安装Zabbix server 和 agent</h3> 
<pre><code>yum install zabbix-server-mysql zabbix-agent
</code></pre> 
<h3><a id="Zabbix_frontend_49"></a>安装Zabbix frontend</h3> 
<pre><code>yum install centos-release-scl
</code></pre> 
<p>编辑配置文件 /etc/yum.repos.d/zabbix.repo</p> 
<pre><code>vim /etc/yum.repos.d/zabbix.repo

[zabbix-frontend]
...
enabled=1     //把enabled的值改成1
...
</code></pre> 
<h3><a id="_Zabbix_frontend_packages_63"></a>安装 Zabbix frontend packages</h3> 
<pre><code>yum install zabbix-web-mysql-scl zabbix-apache-conf-scl
</code></pre> 
<h3><a id="Mysql_67"></a>安装Mysql数据库</h3> 
<pre><code>cd /usr/local/src/
wget http://repo.mysql.com/mysql57-community-release-el7-8.noarch.rpm

rpm -ivh mysql57-community-release-el7-8.noarch.rpm

yum -y install mysql-server
</code></pre> 
<p>启动Mysql</p> 
<pre><code>systemctl start mysqld
</code></pre> 
<p>获取安装时的临时密码</p> 
<pre><code>grep 'temporary password' /var/log/mysqld.log
</code></pre> 
<p>,LW:N3)&amp;hQ8h’ 临时密码 用这个密码登录并修改密码</p> 
<pre><code>mysql -uroot -p,LW:N3)&amp;hQ8h

mysql&gt; set password for root@localhost = password('VMware1！');
</code></pre> 
<h3><a id="_93"></a>创建初始数据库</h3> 
<pre><code>mysql&gt; create database zabbix character set utf8 collate utf8_bin;

mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by 'VMware1！';

mysql&gt; quit;
</code></pre> 
<p>导入初始架构和数据，系统将提示您输入新创建的密码</p> 
<pre><code>zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix
：然后在弹出输入数据库设置的密码，这里设置的是VMware1！
</code></pre> 
<h3><a id="Zabbix_server_106"></a>为Zabbix server配置数据库</h3> 
<p>编辑配置文件 /etc/zabbix/zabbix_server.conf</p> 
<pre><code>vim /etc/zabbix/zabbix_server.conf

DBPassword=VMware1！
</code></pre> 
<h3><a id="ZabbixPHP_114"></a>为Zabbix前端配置PHP</h3> 
<p>编辑配置文件 /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf</p> 
<pre><code>vim /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf

php_value[date.timezone] = Asia/Shanghai
</code></pre> 
<h3><a id="Zabbix_serveragent_122"></a>启动Zabbix server和agent进程</h3> 
<p>启动Zabbix server和agent进程，并为它们设置开机自启</p> 
<pre><code>systemctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm

systemctl enable zabbix-server zabbix-agent httpd rh-php72-php-fpm

</code></pre> 
<p>打开http:IP/zabbix<br> <img src="https://images2.imgbox.com/cc/43/zmZRgxOr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c8/1c/MGbuXesv_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/da/32/bBWQu0Cm_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b8/14/0Z7gVaSR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2b/6f/V2uWdTeY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8d/e7/cBMztieC_o.png" alt="在这里插入图片描述"><br> 看到上述提示，说明安装成功。点"Finish"<br> <img src="https://images2.imgbox.com/4e/c9/Ym4rY9Ys_o.png" alt="在这里插入图片描述"><br> 默认 用户名：Admin，密码：zabbix<br> <img src="https://images2.imgbox.com/45/50/2LV6K6ZJ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="vcenter_142"></a>二.监控vcenter</h2> 
<h3><a id="_143"></a>修改配置文件</h3> 
<p>启用VMware的collectors实例</p> 
<pre><code>vim /etc/zabbix/zabbix_server.conf

StartVMwareCollectors=5
VMwareCacheSize=160M
VMwareFrequency=60
VMwareTimeout=20
</code></pre> 
<p>修改之后重启zabbix-server</p> 
<pre><code>systemctl restart zabbix-serve
</code></pre> 
<h3><a id="Vcenter_158"></a>创建Vcenter主机</h3> 
<p>zabbix提供了监控vcenter集群的模板，Template VM VMware（用于监控vcenter集群的状态），Template VM VMware Guest（用于监控esxi下的虚拟机状态），Template VM VMware Hypervisor（用于监控esxi主机状态）<br> 我们只要在vcenter主机上链接Template VM VMware模板就可以实现对整个vcenter集群的监控，Template VM VMware模板会自动关联其他两个模板，实现自动发现集群内的esxi主机和虚拟机</p> 
<p>配置主机信息<br> <img src="https://images2.imgbox.com/f0/c6/iJgbsdAl_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Template_VM_VMware_165"></a>链接Template VM VMware模板</h3> 
<p><img src="https://images2.imgbox.com/3a/71/Z6jIEx5I_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_167"></a>定义宏信息</h3> 
<p>为安全起见，最好是新建一个vcenter的只读用户用于监控<br> <img src="https://images2.imgbox.com/5b/51/HzquMNd1_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_170"></a>结果展示</h2> 
<p><img src="https://images2.imgbox.com/a4/d9/rW4BT56v_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/082bb03b3ee871a9966305ddb9ea8695/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HTML5口红西瓜见缝插针小游戏代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5244b44a4e2b42a4a7c0bcc8252fe96c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">阿里云负载均衡SLB简介</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>