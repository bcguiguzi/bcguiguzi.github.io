<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ubuntu16.04编译CEF的arm版 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ubuntu16.04编译CEF的arm版" />
<meta property="og:description" content="CEF介绍 Chromium Embedded Framework (CEF)是个基于Google Chromium项目的开源Web browser控件，支持Windows, Linux, Mac平台。除了提供C/C&#43;&#43;接口外，也有其他语言的移植版。来自百度百科。
各代码官网源码URL(需要梯子):
cef: https://bitbucket.org/chromiumembedded/cef/src/master/
chromium: https://chromium.googlesource.com/chromium/src
https://github.com/otcshare/chromium-src(与官网不完全相同，patch有些打不上)
depot_tools: https://chromium.googlesource.com/chromium/tools/depot_tools.git
install-build-deps.sh: https://chromium.googlesource.com/chromium/src/&#43;/master/build/install-build-deps.sh
automate-git.py: https://bitbucket.org/chromiumembedded/cef/raw/master/tools/automate/automate-git.py
整体步骤： 下载源码depot_tools cef chromium
#1
mkdir ~/cef/automate
mkdir ~/cef/chromium_git下载安装依赖
#2
cd ~/cef
curl ‘https://chromium.googlesource.com/chromium/src/&#43;/master/build/install-build-deps.sh?format=TEXT’ | base64 -d &gt; install-build-deps.sh
chmod 755 install-build-deps.sh
sudo ./install-build-deps.sh --arm
#3
sudo apt-get install libgtkglext1-dev
#4
cd ~/cef
git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
export PATH=~/cef/depot_tools:$PATH
#6
cd ~/cef/automate
wget https://bitbucket.org/chromiumembedded/cef/raw/master/tools/automate/automate-git.py配置环境变量执行 automate.py
#7.1
#创建~/cef/chromium_git/update.sh脚本，将下面的内容写入update.sh脚本中
#!/bin/bash
export CEF_USE_GN=1" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/9f1e46b98b549bf42b41d83ee6e293fd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-08-14T15:35:22+08:00" />
<meta property="article:modified_time" content="2019-08-14T15:35:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ubuntu16.04编译CEF的arm版</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="CEF_0"></a>CEF介绍</h3> 
<p>Chromium Embedded Framework (CEF)是个基于Google Chromium项目的开源Web browser控件，支持Windows, Linux, Mac平台。除了提供C/C++接口外，也有其他语言的移植版。来自<a href="https://baike.baidu.com/item/CEF/20837917" rel="nofollow">百度百科</a>。</p> 
<p>各代码官网源码URL(需要梯子):<br> cef: <a href="https://bitbucket.org/chromiumembedded/cef/src/master/" rel="nofollow">https://bitbucket.org/chromiumembedded/cef/src/master/</a><br> chromium: <a href="https://chromium.googlesource.com/chromium/src" rel="nofollow">https://chromium.googlesource.com/chromium/src</a><br> <a href="https://github.com/otcshare/chromium-src%28%E4%B8%8E%E5%AE%98%E7%BD%91%E4%B8%8D%E5%AE%8C%E5%85%A8%E7%9B%B8%E5%90%8C%EF%BC%8Cpatch%E6%9C%89%E4%BA%9B%E6%89%93%E4%B8%8D%E4%B8%8A%29">https://github.com/otcshare/chromium-src(与官网不完全相同，patch有些打不上)</a><br> depot_tools: <a href="https://chromium.googlesource.com/chromium/tools/depot_tools.git" rel="nofollow">https://chromium.googlesource.com/chromium/tools/depot_tools.git</a><br> <a href="http://install-build-deps.sh" rel="nofollow">install-build-deps.sh</a>: <a href="https://chromium.googlesource.com/chromium/src/+/master/build/install-build-deps.sh" rel="nofollow">https://chromium.googlesource.com/chromium/src/+/master/build/install-build-deps.sh</a><br> <a href="http://automate-git.py" rel="nofollow">automate-git.py</a>: <a href="https://bitbucket.org/chromiumembedded/cef/raw/master/tools/automate/automate-git.py" rel="nofollow">https://bitbucket.org/chromiumembedded/cef/raw/master/tools/automate/automate-git.py</a></p> 
<h3><a id="_11"></a>整体步骤：</h3> 
<ol><li>下载源码depot_tools cef chromium<br> #1<br> mkdir ~/cef/automate<br> mkdir ~/cef/chromium_git</li><li>下载安装依赖<br> #2<br> cd ~/cef<br> curl ‘<a href="https://chromium.googlesource.com/chromium/src/+/master/build/install-build-deps.sh?format=TEXT" rel="nofollow">https://chromium.googlesource.com/chromium/src/+/master/build/install-build-deps.sh?format=TEXT</a>’ | base64 -d &gt; <a href="http://install-build-deps.sh" rel="nofollow">install-build-deps.sh</a><br> chmod 755 <a href="http://install-build-deps.sh" rel="nofollow">install-build-deps.sh</a><br> sudo ./install-build-deps.sh --arm<br> #3<br> sudo apt-get install libgtkglext1-dev<br> #4<br> cd ~/cef<br> git clone <a href="https://chromium.googlesource.com/chromium/tools/depot_tools.git" rel="nofollow">https://chromium.googlesource.com/chromium/tools/depot_tools.git</a><br> export PATH=~/cef/depot_tools:$PATH<br> #6<br> cd ~/cef/automate<br> wget <a href="https://bitbucket.org/chromiumembedded/cef/raw/master/tools/automate/automate-git.py" rel="nofollow">https://bitbucket.org/chromiumembedded/cef/raw/master/tools/automate/automate-git.py</a></li><li>配置环境变量</li><li>执行 <a href="http://automate.py" rel="nofollow">automate.py</a><br> #7.1<br> #创建~/cef/chromium_git/update.sh脚本，将下面的内容写入update.sh脚本中<br> #!/bin/bash<br> export CEF_USE_GN=1<br> export GYP_DEFINES=target_arch=arm<br> export GN_DEFINES=“is_official_build=true use_sysroot=true use_allocator=none symbol_level=0 arm_float_abi=hard enable_vr=false”<br> python …/automate/automate-git.py --download-dir=~/cef/chromium_git --depot-tools-dir=~/cef/depot_tools --arm-build --no-distrib<br> #7.2<br> chmod +x <a href="http://update.sh" rel="nofollow">update.sh</a><br> sudo ./update.sh</li></ol> 
<p>关于编译步骤：<br> 以上步骤来源于 <a href="https://blog.csdn.net/u011803182/article/details/80283163">https://blog.csdn.net/u011803182/article/details/80283163</a><br> 官网 <a href="https://bitbucket.org/chromiumembedded/cef/issues/1990/linux-add-arm-build-support" rel="nofollow">https://bitbucket.org/chromiumembedded/cef/issues/1990/linux-add-arm-build-support</a></p> 
<p>新的automate集成了整体编译，安装依赖后，配置opts，直接执行automate.py可以直接生成libcef.so在对应的out路径下。</p> 
<p>tips:<br> <a href="http://update.sh" rel="nofollow">update.sh</a><br> #!/bin/bash<br> export CEF_USE_GN=1<br> export GYP_DEFINES=target_arch=arm<br> export GN_DEFINES=“is_official_build=true use_sysroot=true use_allocator=none symbol_level=1 arm_float_abi=hard”<br> python …/automate/automate-git.py --chromium-url=https://github.com/otcshare/chromium-src.git --download-dir=/home/xxx/cef/chromium_git --depot-tools-dir=/home/xxx/cef/depot_tools --arm-build --no-distrib --no-update --build-target=cefsimple --no-release-build --build-failure-limit=3<br> 上述opts配置省去cef及chromium的源码更新，另外配置chromium源码url为https://github.com/otcshare/chromium-src.git，此代码库源码有问题，建议使用官网地址(fanqiang): <a href="https://chromium.googlesource.com/chromium/src" rel="nofollow">https://chromium.googlesource.com/chromium/src</a></p> 
<p>automate.py中集成了编译ninja</p> 
<p>如果编译半截出现问题，重新执行automate.py会需要rm -r /home/xxx/cef/chromium_git/chromium/src/out重新编译。<br> 如果不想重新编译，可以：<br> cd /home/xxx/cef/chromium_git/chromium/src<br> ./third_party/depot_tools/ninja -C out/Debug_GN_arm cefsimple chrome_sandbox<br> 继续编译，即断点编译，不是重新执行编译。<br> 完整编译大约需要7~8个小时以上。</p> 
<h3><a id="_68"></a>编译中遇到的问题：</h3> 
<p><strong>./install-build-deps.sh --arm遇到的问题如下：</strong><br> Q:<br> 已下载 323 kB，耗时 2分 8秒 (2 519 B/s)<br> 正在读取软件包列表… 完成<br> W: 仓库 “<a href="http://ppa.launchpad.net/u-szeged/sedkit/ubuntu" rel="nofollow">http://ppa.launchpad.net/u-szeged/sedkit/ubuntu</a> xenial Release” 没有 Release 文件。<br> N: 无法认证来自该源的数据，所以使用它会带来潜在风险。<br> N: 参见 apt-secure(8) 手册以了解仓库创建和用户配置方面的细节。<br> W: 无法下载 <a href="http://ppa.launchpad.net/u-szeged/sedkit/ubuntu/dists/xenial/main/binary-amd64/Packages" rel="nofollow">http://ppa.launchpad.net/u-szeged/sedkit/ubuntu/dists/xenial/main/binary-amd64/Packages</a> 404 Not Found<br> W: 无法下载 <a href="http://ppa.launchpad.net/u-szeged/sedkit/ubuntu/dists/xenial/main/binary-i386/Packages" rel="nofollow">http://ppa.launchpad.net/u-szeged/sedkit/ubuntu/dists/xenial/main/binary-i386/Packages</a> 404 Not Found<br> W: 无法下载 <a href="http://ppa.launchpad.net/u-szeged/sedkit/ubuntu/dists/xenial/main/i18n/Translation-en" rel="nofollow">http://ppa.launchpad.net/u-szeged/sedkit/ubuntu/dists/xenial/main/i18n/Translation-en</a> 404 Not Found<br> W: 无法下载 <a href="http://ppa.launchpad.net/u-szeged/sedkit/ubuntu/dists/xenial/main/dep11/Components-amd64.yml" rel="nofollow">http://ppa.launchpad.net/u-szeged/sedkit/ubuntu/dists/xenial/main/dep11/Components-amd64.yml</a> 404 Not Found<br> W: 无法下载 <a href="http://ppa.launchpad.net/u-szeged/sedkit/ubuntu/dists/xenial/main/dep11/icons-64x64.tar" rel="nofollow">http://ppa.launchpad.net/u-szeged/sedkit/ubuntu/dists/xenial/main/dep11/icons-64x64.tar</a> 404 Not Found<br> W: 部分索引文件下载失败。如果忽略它们，那将转而使用旧的索引文件。<br> E：。。。。。。（这个地方没记录下来，出现Error之后就不会再往下面继续执行了）。<br> R:<br> 后来按照网上的方法，更改了下载源/etc/apt/sources.list之后，过一段时间之后执行./install-build-deps.sh --arm，就出现了后续的下载依赖软件包的过程，然后再往下执行，基本没什么问题了。<br> 将报错的/etc/apt/sources.list源及ppa在/etc/apt/sources.list.d对应源文件删除。</p> 
<p><strong>执行automate.py遇到的问题</strong><br> Q1: <a href="http://xn--automate-1e8ps541a.py" rel="nofollow">执行automate.py</a> 下拉不下chromium的代码，<br> R(1): 可在http://opensource.spotify.com/cefbuilds/index.html, 下在chromium包，解压到对应的位置，在<br> automate.py的opts中加入–no-update<br> R(2): 在github上找到chromium的源码库，在automate.py的opts加上–chromium-url=https://github.com/otcshare/chromium-src.git (此源代码与官网最新版本不一致，不建议使用)。</p> 
<p>Q2:<br> AttributeError: ‘module’ object has no attribute ‘CheckCallAndFilterAndHeader’<br> R2:<br> cd depot_tools<br> git reset --hard 447b45d42307</p> 
<p>Q3:<br> Apply pdfium_print_549365.patch in /…/chromium/src/third_party/pdfium<br> … patch directory is not a repository root.<br> -------------------------------------------------------------------------------<br> !!! ERROR: This patch failed to apply. Your build will not be correct.<br> R3:<br> cd /…/chromium/src/third_party/pdfium<br> git init</p> 
<p>Q4:<br> Generating CEF project files…<br> NOTE: Not generating x86 configuration due to missing sysroot directory<br> NOTE: Not generating x64 configuration due to missing sysroot directory<br> NOTE: Not generating arm configuration due to missing sysroot directory<br> NOTE: Not generating arm64 configuration due to missing sysroot directory<br> R4:<br> #~/cef/chromium_git/chromium/src<br> export CEF_USE_GN=1<br> export GYP_DEFINES=target_arch=arm<br> export GN_DEFINES=“is_official_build=true use_sysroot=true use_allocator=none symbol_level=1 arm_float_abi=hard enable_vr=false”<br> ./build/linux/sysroot_scripts/install-sysroot.py --arch=arm<br> ./build/linux/sysroot_scripts/install-sysroot.py --arch=amd64<br> ./build/linux/sysroot_scripts/install-sysroot.py --arch=i386<br> ./build/linux/sysroot_scripts/install-sysroot.py --arch=arm<br> 安装不同架构的sysroot<br> 然后在重新执行 <a href="http://automate.py" rel="nofollow">automate.py</a> [opts]</p> 
<p>如果遇到下载不下来的问题，就复制log中的网址链接到浏览器，手动下载到对应的位置，然后解压缩。就手动注释掉install-sysroot.py中的下载部分在重新执行。</p> 
<p>Q5:<br> /bin/sh: 1: …/…/third_party/llvm-build/Release+Asserts/bin/clang++: not found<br> R5:<br> cd /home/xxx/cef/chromium_git/chromium/src/tools/clang/scripts<br> ./update.py<br> 如遇下载不下的问题，同上解决方法。</p> 
<p>Q6:<br> /bin/sh: 1: …/…/third_party/node/linux/node-linux-x64/bin/node: not found<br> R6:<br> cd /home/xxx/cef/chromium_git/chromium/src/third_party/node<br> ./update_node_binaries</p> 
<p>Q7:<br> SOLINK ./libVkICD_mock_icd.so<br> FAILED: libVkICD_mock_icd.so libVkICD_mock_icd.so.TOC<br> python “…/…/build/toolchain/gcc_solink_wrapper.py” --readelf=“arm-linux-gnueabihf-readelf” --nm=“arm-linux-gnueabihf-nm” --sofile="./libVkICD_mock_icd.so" --tocfile="./libVkICD_mock_icd.so.TOC" --output="./libVkICD_mock_icd.so" – …/…/third_party/llvm-build/Release+Asserts/bin/clang++ -shared -Wl,-soname=“libVkICD_mock_icd.so” -Wl,–build-id=sha1 -fPIC -Wl,-z,noexecstack -Wl,-z,relro -Wl,-z,now -Wl,-z,defs -Wl,–as-needed -fuse-ld=lld -Wl,–icf=all -Wl,–color-diagnostics --target=arm-linux-gnueabihf -Wl,-O2 -Wl,–gc-sections -rdynamic -nostdlib++ --sysroot=…/…/build/linux/debian_sid_arm-sysroot -L…/…/build/linux/debian_sid_arm-sysroot/usr/local/lib/arm-linux-gnueabihf -L…/…/build/linux/debian_sid_arm-sysroot/lib/arm-linux-gnueabihf -L…/…/build/linux/debian_sid_arm-sysroot/usr/lib/arm-linux-gnueabihf -Werror -o “./libVkICD_mock_icd.so” @"./libVkICD_mock_icd.so.rsp"<br> OSError: [Errno 2] No such file or directory<br> R7:<br> sudo apt install gcc-arm-linux-gnueabihf</p> 
<p>Q8:<br> ACTION //tools/v8_context_snapshot:generate_v8_context_snapshot(//build/toolchain/linux:clang_arm)<br> FAILED: v8_context_snapshot.bin<br> python …/…/build/gn_run_binary.py ./clang_x86_v8_arm/v8_context_snapshot_generator --output_file=v8_context_snapshot.bin<br> ././clang_x86_v8_arm/v8_context_snapshot_generator: error while loading shared libraries: libglib-2.0.so.0: cannot open shared object file: No such file or directory<br> ./clang_x86_v8_arm/v8_context_snapshot_generator failed with exit code 127<br> ninja: build stopped: subcommand failed.<br> R8:<br> #INFO ./third_party/depot_tools/ninja -d stats 可以列出debug模式，可以使用查看更多的信息<br> find -name libglib-2.0.so.0<br> export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/xxx/cef/chromium_git/chromium/src/build/linux/debian_sid_i386-sysroot/usr/lib/i386-linux-gnu/</p> 
<p>Q9:[1/378] ACTION //tools/v8_context_snapshot:generate_v8_context_snapshot(//build/toolchain/linux:clang_arm)<br> FAILED: v8_context_snapshot.bin<br> python …/…/build/gn_run_binary.py ./clang_x86_v8_arm/v8_context_snapshot_generator --output_file=v8_context_snapshot.bin<br> ././clang_x86_v8_arm/v8_context_snapshot_generator: error while loading shared libraries: libpcre.so.3: cannot open shared object file: No such file or directory<br> ./clang_x86_v8_arm/v8_context_snapshot_generator failed with exit code 127<br> ninja: build stopped: subcommand failed.<br> R9:<br> find -name libpcre.so.3<br> export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/xxx/cef/chromium_git/chromium/src/build/linux/debian_sid_i386-sysroot/lib/i386-linux-gnu/<br> Q10:<br> 在出现Q8Q9的问题手动添加$LD_LIBRARY_PATH的环境变量后，报:<br> ACTION //tools/v8_context_snapshot:generate_v8_context_snapshot(//build/toolchain/linux:clang_arm)<br> FAILED: v8_context_snapshot.bin<br> ./clang_x86_v8_arm/v8_context_snapshot_generator failed with exit code 11(SIGSEGV)段错误的问题。<br> 是因为R8R9加载的库不匹配导致重新安装对应的依赖包。见下：<br> R8R9R10:重新执行install-build-deps.sh --arm 安装交叉编译依赖包</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6ea78165001811560a20fc9f041100e0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Oracle中to_char()函数的用法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1211ef439cdc41915714a7db4d30e0ab/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue2 上传图片，使用axios发送FormData 格式数据，参数为空</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>