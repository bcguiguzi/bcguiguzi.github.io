<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于Apache Common-pool2理解连接池 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于Apache Common-pool2理解连接池" />
<meta property="og:description" content="基于Apache Common-pool2理解连接池 基于Apache Common-pool2理解连接池目的文档介绍PooledObjectStatejava代码实现代码实现输出 接口PooledObjectFactor作用代码 PooledObject作用代码 ObjectPool作用代码 实现类分析DefaultPooledObject 文档地址 基于Apache Common-pool2理解连接池 目的 理解连接池的参数设置 文档介绍 PooledObjectState 事件说明IDLE在队列中，但是为使用ALLOCATED正在使用EVICTION在队列中，但是正在被测试，可能清除EVICTION_RETURN_TO_HEAD不在队列中，目前正在测试可能的驱逐。在测试时试图借用该对象，该对象被删除从队列中。它应该返回到队列的头部一次，驱逐测试完成。VALIDATION在队列中，当前正在被校验VALIDATION_PREALLOCATED不在队列中，当前正在验证。这东西是借的正在进行验证，由于配置了testOnBorrow，所以删除了它，从队列中预先分配。应该在验证之后分配它VALIDATION_RETURN_TO_HEAD不在队列中，当前正在验证。试图借用对象是在之前进行驱逐测试时制作的，该测试将其移除队列。验证之后，它应该返回到队列的头部完成INVALID无效的，维护失败和将要被摧毁的对象ABANDONED废弃的RETURNING返回到池子中 java代码实现 代码实现 StringPoolObject.java package com; import org.apache.commons.pool2.BasePooledObjectFactory; import org.apache.commons.pool2.PooledObject; import org.apache.commons.pool2.impl.DefaultPooledObject; public class StringPoolObject extends BasePooledObjectFactory&lt;StringBuffer&gt; { @Override public StringBuffer create() { System.out.println(&#34;创造了一个object&#34;); return new StringBuffer(); } @Override public PooledObject&lt;StringBuffer&gt; wrap(StringBuffer obj) { DefaultPooledObject&lt;StringBuffer&gt; stringBufferDefaultPooledObject = new DefaultPooledObject&lt;&gt;(obj); System.out.println(&#34;wrap状态为--&gt;&#34;&#43;stringBufferDefaultPooledObject.getState()); return stringBufferDefaultPooledObject; } @Override public void passivateObject(PooledObject&lt;StringBuffer&gt; p) throws Exception { System.out.println(&#34;passivateObject状态为--&gt;&#34;&#43;p.getState()); super.passivateObject(p); } } MyStringUtils." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/948c6179a2547813ddba0d30163ecf94/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-16T16:53:27+08:00" />
<meta property="article:modified_time" content="2020-11-16T16:53:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于Apache Common-pool2理解连接池</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>基于Apache Common-pool2理解连接池</h4> 
 <ul><li><ul><li><a href="#Apache_Commonpool2_2" rel="nofollow">基于Apache Common-pool2理解连接池</a></li><li><ul><li><a href="#_3" rel="nofollow">目的</a></li><li><a href="#_6" rel="nofollow">文档介绍</a></li><li><ul><li><a href="#PooledObjectState_7" rel="nofollow">PooledObjectState</a></li><li><a href="#java_20" rel="nofollow">java代码实现</a></li><li><ul><li><a href="#_21" rel="nofollow">代码实现</a></li><li><a href="#_101" rel="nofollow">输出</a></li></ul> 
     </li><li><a href="#_109" rel="nofollow">接口</a></li><li><ul><li><a href="#PooledObjectFactor_111" rel="nofollow">PooledObjectFactor</a></li><li><ul><li><a href="#_113" rel="nofollow">作用</a></li><li><a href="#_116" rel="nofollow">代码</a></li></ul> 
      </li><li><a href="#PooledObject_133" rel="nofollow">PooledObject</a></li><li><ul><li><a href="#_134" rel="nofollow">作用</a></li><li><a href="#_137" rel="nofollow">代码</a></li></ul> 
      </li><li><a href="#ObjectPool_199" rel="nofollow">ObjectPool</a></li><li><ul><li><a href="#_200" rel="nofollow">作用</a></li><li><a href="#_203" rel="nofollow">代码</a></li></ul> 
     </li></ul> 
     </li><li><a href="#_228" rel="nofollow">实现类分析</a></li><li><ul><li><a href="#DefaultPooledObject_229" rel="nofollow">DefaultPooledObject</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_241" rel="nofollow">文档地址</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="Apache_Commonpool2_2"></a>基于Apache Common-pool2理解连接池</h3> 
<h4><a id="_3"></a>目的</h4> 
<ul><li>理解连接池的参数设置</li></ul> 
<h4><a id="_6"></a>文档介绍</h4> 
<h5><a id="PooledObjectState_7"></a>PooledObjectState</h5> 
<table><thead><tr><th>事件</th><th>说明</th></tr></thead><tbody><tr><td>IDLE</td><td>在队列中，但是为使用</td></tr><tr><td>ALLOCATED</td><td>正在使用</td></tr><tr><td>EVICTION</td><td>在队列中，但是正在被测试，可能清除</td></tr><tr><td>EVICTION_RETURN_TO_HEAD</td><td>不在队列中，目前正在测试可能的驱逐。在测试时试图借用该对象，该对象被删除从队列中。它应该返回到队列的头部一次，驱逐测试完成。</td></tr><tr><td>VALIDATION</td><td>在队列中，当前正在被校验</td></tr><tr><td>VALIDATION_PREALLOCATED</td><td>不在队列中，当前正在验证。这东西是借的正在进行验证，由于配置了testOnBorrow，所以删除了它，从队列中预先分配。应该在验证之后分配它</td></tr><tr><td>VALIDATION_RETURN_TO_HEAD</td><td>不在队列中，当前正在验证。试图借用对象是在之前进行驱逐测试时制作的，该测试将其移除队列。验证之后，它应该返回到队列的头部完成</td></tr><tr><td>INVALID</td><td>无效的，维护失败和将要被摧毁的对象</td></tr><tr><td>ABANDONED</td><td>废弃的</td></tr><tr><td>RETURNING</td><td>返回到池子中</td></tr></tbody></table> 
<h5><a id="java_20"></a>java代码实现</h5> 
<h6><a id="_21"></a>代码实现</h6> 
<ul><li>StringPoolObject.java</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>pool2<span class="token punctuation">.</span>BasePooledObjectFactory<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>pool2<span class="token punctuation">.</span>PooledObject<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>pool2<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>DefaultPooledObject<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringPoolObject</span> <span class="token keyword">extends</span> <span class="token class-name">BasePooledObjectFactory</span><span class="token generics function"><span class="token punctuation">&lt;</span>StringBuffer<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> StringBuffer <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"创造了一个object"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> PooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>StringBuffer<span class="token punctuation">&gt;</span></span> <span class="token function">wrap</span><span class="token punctuation">(</span>StringBuffer obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        DefaultPooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>StringBuffer<span class="token punctuation">&gt;</span></span> stringBufferDefaultPooledObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPooledObject</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"wrap状态为--&gt;"</span><span class="token operator">+</span>stringBufferDefaultPooledObject<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> stringBufferDefaultPooledObject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">passivateObject</span><span class="token punctuation">(</span>PooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>StringBuffer<span class="token punctuation">&gt;</span></span> p<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"passivateObject状态为--&gt;"</span><span class="token operator">+</span>p<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">passivateObject</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>MyStringUtils.java</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>pool2<span class="token punctuation">.</span>ObjectPool<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>pool2<span class="token punctuation">.</span>PooledObjectFactory<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>pool2<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>GenericObjectPool<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span>AtomicInteger<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyStringUtils</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> ObjectPool<span class="token generics function"><span class="token punctuation">&lt;</span>StringBuffer<span class="token punctuation">&gt;</span></span> objectPool<span class="token punctuation">;</span>
    <span class="token keyword">private</span> AtomicInteger count<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">MyStringUtils</span><span class="token punctuation">(</span>ObjectPool<span class="token generics function"><span class="token punctuation">&lt;</span>StringBuffer<span class="token punctuation">&gt;</span></span> objectPool<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>objectPool <span class="token operator">=</span> objectPool<span class="token punctuation">;</span>
        count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> StringBuffer <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> objectPool<span class="token punctuation">.</span><span class="token function">borrowObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">write</span><span class="token punctuation">(</span>StringBuffer write<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
        Random random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> randomValue <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> order <span class="token operator">=</span> count<span class="token punctuation">.</span><span class="token function">addAndGet</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        StringBuffer append <span class="token operator">=</span> write<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"第几个写的:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"--&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"写了什么:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>randomValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectPool<span class="token punctuation">.</span><span class="token function">returnObject</span><span class="token punctuation">(</span>write<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> append<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
        PooledObjectFactory pooledObjectFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringPoolObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ObjectPool objectPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericObjectPool</span><span class="token punctuation">(</span>pooledObjectFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        MyStringUtils myStringUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyStringUtils</span><span class="token punctuation">(</span>objectPool<span class="token punctuation">)</span><span class="token punctuation">;</span>

        StringBuffer read <span class="token operator">=</span> myStringUtils<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        myStringUtils<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>read<span class="token punctuation">)</span><span class="token punctuation">;</span>
        StringBuffer data <span class="token operator">=</span> myStringUtils<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"数据是--&gt;"</span> <span class="token operator">+</span> data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h6><a id="_101"></a>输出</h6> 
<pre><code class="prism language-java">创造了一个Object
wrap状态为<span class="token operator">--</span><span class="token operator">&gt;</span>IDLE
passivateObject状态为<span class="token operator">--</span><span class="token operator">&gt;</span>RETURNING
数据是<span class="token operator">--</span><span class="token operator">&gt;</span>第几个写的<span class="token operator">:</span><span class="token number">1</span><span class="token operator">--</span><span class="token operator">&gt;</span>写了什么<span class="token operator">:</span><span class="token number">240</span>
</code></pre> 
<h5><a id="_109"></a>接口</h5> 
<h6><a id="PooledObjectFactor_111"></a>PooledObjectFactor</h6> 
<h6><a id="_113"></a>作用</h6> 
<ul><li>提供poolObject的工厂,顶层的抽象类是BasePooledObjectFactory，复写create和wrap方法</li></ul> 
<h6><a id="_116"></a>代码</h6> 
<pre><code class="prism language-java"><span class="token comment">//连接池的工厂，通过makeObject返回连接池的包装类</span>
<span class="token comment">//activateObject激活连接对象</span>
<span class="token comment">//passivateObject钝化连接对象</span>
<span class="token comment">//validateObject校验对象</span>
<span class="token comment">//destroyObject摧毁对象</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PooledObjectFactory</span><span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//返回连接池对象的包装器</span>
    PooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token function">makeObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">activateObject</span><span class="token punctuation">(</span>PooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">passivateObject</span><span class="token punctuation">(</span>PooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">validateObject</span><span class="token punctuation">(</span>PooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">destroyObject</span><span class="token punctuation">(</span>PooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="PooledObject_133"></a>PooledObject</h6> 
<h6><a id="_134"></a>作用</h6> 
<ul><li>提供对象的包装类，封装了状态变更的方法，默认实现类是DefaultPooledObject</li></ul> 
<h6><a id="_137"></a>代码</h6> 
<pre><code class="prism language-java"><span class="token comment">//这个接口是连接池的包装类接口，用于管理连接池的状态</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PooledObject</span><span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token operator">&lt;</span>PooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//返回连接池对象</span>
    T <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//返回连接池创建时间。</span>
    <span class="token keyword">long</span> <span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//返回连接的上次活动时间</span>
    <span class="token keyword">long</span> <span class="token function">getActiveTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//该对象被调用的次数</span>
    <span class="token keyword">default</span> <span class="token keyword">long</span> <span class="token function">getBorrowedCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//该对象空闲多少时间</span>
    <span class="token keyword">long</span> <span class="token function">getIdleTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//最后一次被包装对象的时间</span>
    <span class="token keyword">long</span> <span class="token function">getLastBorrowTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//上一次包装对象返回的时间</span>
    <span class="token keyword">long</span> <span class="token function">getLastReturnTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//最新的使用时间</span>
    <span class="token keyword">long</span> <span class="token function">getLastUsedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//尝试将池对象置于PooledObjectState.EVICTION状态</span>
    <span class="token keyword">boolean</span> <span class="token function">startEvictionTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//被叫通知对象驱逐测试已经结束 目前没有使用，参数： 空闲队列</span>
    <span class="token keyword">boolean</span> <span class="token function">endEvictionTest</span><span class="token punctuation">(</span>Deque<span class="token operator">&lt;</span>PooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> idleQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//分配该对象,如果源状态为PooledObjectState.IDLE空闲状态则返回true，</span>
    <span class="token comment">//同时将状态改为PooledObjectState.ALLOCATED，该状态表明对象正在被使用</span>
    <span class="token keyword">boolean</span> <span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//取消分配对象并空闲 在当前设置它ALLOCATED。</span>
    <span class="token keyword">boolean</span> <span class="token function">deallocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置是否记录对象使用的堆栈信息,可用于池泄漏时问题追溯</span>
    <span class="token keyword">void</span> <span class="token function">setLogAbandoned</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> logAbandoned<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/** 根据是否需要完全详细的堆栈跟踪配置堆栈跟踪生成策略。
    	当设置为false时，被放弃的日志可能只包含调用者类信息，而不包含方法名、行
    	数字，以及完整堆栈跟踪中可用的其他正常元数据。*/</span>
    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">setRequireFullStackTrace</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> requireFullStackTrace<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// noop</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//将当前堆栈跟踪记录为上次使用对象的时间。</span>
    <span class="token keyword">void</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//打印借用此池对象的代码的堆栈跟踪以及最后一个代码的堆栈跟踪，以将此对象（如果可用）用于提供的编写器。</span>
    <span class="token keyword">void</span> <span class="token function">printStackTrace</span><span class="token punctuation">(</span>PrintWriter writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//返回此对象的状态。</span>
    PooledObjectState <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将池化对象标记为已放弃。</span>
    <span class="token keyword">void</span> <span class="token function">markAbandoned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将对象标记为返回池。</span>
    <span class="token keyword">void</span> <span class="token function">markReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span>PooledObject<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> other<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span>Object obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="ObjectPool_199"></a>ObjectPool</h6> 
<h6><a id="_200"></a>作用</h6> 
<ul><li>提供类使从池对象中使用方法，实现类是GenericObjectPool</li></ul> 
<h6><a id="_203"></a>代码</h6> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ObjectPool</span><span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Closeable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//借用对象idle -&gt; </span>
    T <span class="token function">borrowObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">,</span> NoSuchElementException<span class="token punctuation">,</span>
            IllegalStateException<span class="token punctuation">;</span>
    <span class="token comment">//返回对象</span>
    <span class="token keyword">void</span> <span class="token function">returnObject</span><span class="token punctuation">(</span>T obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">;</span>
    <span class="token comment">//使对象无效</span>
    <span class="token keyword">void</span> <span class="token function">invalidateObject</span><span class="token punctuation">(</span>T obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">;</span>
    <span class="token comment">//添加对象</span>
    <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">,</span> IllegalStateException<span class="token punctuation">,</span>
            UnsupportedOperationException<span class="token punctuation">;</span>
    <span class="token comment">//获得空闲数量</span>
    <span class="token keyword">int</span> <span class="token function">getNumIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获得活动数量</span>
    <span class="token keyword">int</span> <span class="token function">getNumActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//清除</span>
    <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">,</span> UnsupportedOperationException<span class="token punctuation">;</span>
    <span class="token comment">//关闭</span>
    <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h5><a id="_228"></a>实现类分析</h5> 
<h6><a id="DefaultPooledObject_229"></a>DefaultPooledObject</h6> 
<table><thead><tr><th>方法</th><th>功能</th><th>状态变更</th></tr></thead><tbody><tr><td>allocate</td><td>分配对象</td><td>IDLE -&gt; ALLOCATED</td></tr><tr><td>deallocate</td><td>释放这对象</td><td>ALLOCATED -&gt; IDLE</td></tr><tr><td>invalidate</td><td>无效对象</td><td>* -&gt; INVALID</td></tr><tr><td>startEvictionTest</td><td>无效对象</td><td>IDLE -&gt; EVICTION</td></tr><tr><td>endEvictionTest</td><td>无效对象</td><td>EVICTION/EVICTION_RETURN_TO_HEAD -&gt; IDLE</td></tr><tr><td>startEvictionTest</td><td>无效对象</td><td>IDLE -&gt; EVICTION</td></tr></tbody></table> 
<h4><a id="_241"></a>文档地址</h4> 
<p><a href="http://commons.apache.org/proper/commons-pool/" rel="nofollow">Common-pool2 文档地址</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fed81af58fe93d9ef750ea3fa21e186e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">clickhouse跟hive的不同</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/746db3734e6b5646eb4d3427e0783ce0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">该连接被站点断开怎么办_中山白色船形开关价格,电子锁连接器厂家</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>