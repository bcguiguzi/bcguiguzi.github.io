<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt 笔记4--Qt 读写CSV - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qt 笔记4--Qt 读写CSV" />
<meta property="og:description" content="Qt 笔记4--Qt 读写CSV CSV（Comma-Separated Values），即逗号分隔值，有时也称为字符分隔值，因为分隔字符也可以不是逗号，其文件以纯文本形式存储表格数据；CSV是一种通用的、相对简单的文件格式，被用户、商业和科学广泛应用。Qt中似乎没有直接处理CSV的类，因此需要按照CSV的格式进行解析和生成，以下为笔者根据需要写的一个CSV读写案例，后续有相关功能函数也会在此处加以补充。
1、源代码 CSV不同行之间使用 \n 符隔开，行内各列之间使用 , 隔开，根据该原则：读取的时候，只需读取所有文本，逐行读出，每一行去除 \n 和 , 即可；生成的时候，将各字段依次放到字符串中，并用 , 隔开，然后在末尾添加 \n 换行符，最后将字符串依次以附加的形式写到文本中即可。
该案例源代码包括三个主要文件：csvclass.h、csvclass.cpp、main.cpp，源码如下：
csvclass.h
#ifndef CSVCLASS_H #define CSVCLASS_H #include &lt;QDebug&gt; #include &lt;QFile&gt; class CsvClass { public: CsvClass(); QList&lt;QStringList&gt; ReadFromCSV(QString PathName); void SaveToCSV(QList&lt;QStringList&gt; CsvList,QString PathName); }; #endif // CSVCLASS_H csvclass.cpp
#include &#34;csvclass.h&#34; CsvClass::CsvClass() { qDebug()&lt;&lt;&#34;This is CSV exapmle!\n&#34;; } QList&lt;QStringList&gt; CsvClass::ReadFromCSV(QString PathName) { QList&lt;QStringList&gt; retList; qDebug().noquote()&lt;&lt;&#34;Original CSV name:&#34;&lt;&lt;PathName; QFile file(PathName); if (!file.open(QIODevice::ReadOnly | QIODevice::Text)) return retList; while (!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/4b29ae7a8654f99700e8d48ab5fe5074/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-16T16:23:02+08:00" />
<meta property="article:modified_time" content="2019-04-16T16:23:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt 笔记4--Qt 读写CSV</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>Qt 笔记4--Qt 读写CSV</h2> 
<p> </p> 
<p>CSV（Comma-Separated Values），即逗号分隔值，有时也称为字符分隔值，因为分隔字符也可以不是逗号，其文件以纯文本形式存储表格数据；CSV是一种通用的、相对简单的文件格式，被用户、商业和科学广泛应用。Qt中似乎没有直接处理CSV的类，因此需要按照CSV的格式进行解析和生成，以下为笔者根据需要写的一个CSV读写案例，后续有相关功能函数也会在此处加以补充。</p> 
<p> </p> 
<h3>1、源代码</h3> 
<p>CSV不同行之间使用 \n 符隔开，行内各列之间使用 , 隔开，根据该原则：读取的时候，只需读取所有文本，逐行读出，每一行去除  \n 和 , 即可；生成的时候，将各字段依次放到字符串中，并用 , 隔开，然后在末尾添加 \n 换行符，最后将字符串依次以附加的形式写到文本中即可。<br> 该案例源代码包括三个主要文件：csvclass.h、csvclass.cpp、main.cpp，源码如下：</p> 
<p>csvclass.h</p> 
<pre class="has"><code class="language-cpp">#ifndef CSVCLASS_H
#define CSVCLASS_H

#include &lt;QDebug&gt;
#include &lt;QFile&gt;
class CsvClass
{
public:
    CsvClass();
    QList&lt;QStringList&gt; ReadFromCSV(QString PathName);
    void SaveToCSV(QList&lt;QStringList&gt; CsvList,QString PathName);
};

#endif // CSVCLASS_H</code></pre> 
<p>csvclass.cpp</p> 
<pre class="has"><code class="language-cpp">#include "csvclass.h"

CsvClass::CsvClass()
{
    qDebug()&lt;&lt;"This is CSV exapmle!\n";
}

QList&lt;QStringList&gt;  CsvClass::ReadFromCSV(QString PathName)
{
    QList&lt;QStringList&gt; retList;
    qDebug().noquote()&lt;&lt;"Original CSV name:"&lt;&lt;PathName;
    QFile file(PathName);
    if (!file.open(QIODevice::ReadOnly | QIODevice::Text))
        return retList;
    while (!file.atEnd()) {
        //QByteArray line = file.readLine();
        QString line = file.readLine();
        line.replace('\n',"");//delete \n symbol
        QStringList lineList = line.split(',');
        retList.append(lineList);
        qDebug().noquote()&lt;&lt;lineList;
    }
    file.close();
    return retList;
}

void CsvClass::SaveToCSV(QList&lt;QStringList&gt; CsvList,QString PathName)
{
    qDebug().noquote()&lt;&lt;"\nDestination CSV name:"&lt;&lt;PathName;
    for(int i=0;i&lt;CsvList.size();i++)
    {
        QString tmpStr;
        QStringList strList = CsvList.at(i);
        for(int j=0;j&lt;strList.size();j++){
            tmpStr.append(strList.at(j));
            if(j&lt;(strList.size()-1)){
                tmpStr.append(',');
            }else{
                tmpStr.append('\n');
            }
        }
        qDebug().noquote()&lt;&lt;i&lt;&lt;'\t'&lt;&lt;tmpStr;
        QFile file(PathName);
        if(!file.open(QIODevice::WriteOnly| QIODevice::Text | QIODevice::Append)){
            qDebug()&lt;&lt;"Open "&lt;&lt;PathName&lt;&lt;" Error!";
            return;
        }else{
            QTextStream in(&amp;file);
            in&lt;&lt;tmpStr;
            file.close();
        }
    }
}</code></pre> 
<p>main.cpp</p> 
<pre class="has"><code class="language-cpp">#include &lt;QCoreApplication&gt;
#include &lt;csvclass.h&gt;

int main(int argc, char *argv[])
{
    QCoreApplication a(argc, argv);

    CsvClass *CsvObj = new CsvClass();
    QList&lt;QStringList&gt; retList = CsvObj-&gt;ReadFromCSV("Data.csv");
    CsvObj-&gt;SaveToCSV(retList,"Data_w.csv");
    delete CsvObj;
    return a.exec();
}</code></pre> 
<h3>2、测试结果</h3> 
<p>以下为此时CSV原始内容：</p> 
<pre class="has"><code class="language-bash">ymd,power,irradiation,bWendu,yWendu,bTianqi,yTianqi,fengli,aqi,aqiInfo,aqiLevel,sunny_percent,rain_percent,rain_full,pressure_avg,hum_avg,tem_max,tem_min,tem_avg,wspd_avg
20160401,-1,,27,19,阴,多云,3,77,良,,65,0,0,1006.91,78.91,26.9,20.6,22.87,1.08
20160402,-1,,26,20,阴,,3,66,良,,25,29,0,1007.96,83.79,25.8,20.4,22.42,1.34
20160403,-1,,26,19,雷阵雨,,3,51,良,,0,83,0,1007,81.92,27.8,20.7,23.59,1.39
20160404,-1,,25,21,阵雨,,3,38,优,,33,66,22.8,1004.96,85.92,28,20.2,23.44,1.35
20160405,-1,,27,20,多云,,3,34,优,,100,0,0,1005.79,87.42,26,20,22.95,1.4
20160406,-1,,27,20,阴,,3,29,优,,50,33,0,1005.62,79.29,29.8,21.4,24.68,1.56
20160407,-1,,29,22,多云,,3,34,优,,58,41,0,1005.62,82.58,28.8,22.6,25.18,1.49
20160408,-1,,27,21,小雨,,3,39,优,,83,16,0,1005.75,83,29.3,22.8,25.57,1.73
20160409,-1,,28,21,小雨,,3,37,优,,25,75,0.1,1004.12,87.79,27.1,23.5,25.08,1.82
20160410,-1,,26,21,中雨,小到中雨,4,35,优,,0,100,11,1001.75,91.58,24.6,21.2,22.96,1.41</code></pre> 
<p>测试输出结果如下：</p> 
<pre class="has"><code class="language-bash">This is CSV exapmle!

Original CSV name: Data.csv
(ymd, power, irradiation, bWendu, yWendu, bTianqi, yTianqi, fengli, aqi, aqiInfo, aqiLevel, sunny_percent, rain_percent, rain_full, pressure_avg, hum_avg, tem_max, tem_min, tem_avg, wspd_avg)
(20160401, -1, , 27, 19, 阴, 多云, 3, 77, 良, , 65, 0, 0, 1006.91, 78.91, 26.9, 20.6, 22.87, 1.08)
(20160402, -1, , 26, 20, 阴, , 3, 66, 良, , 25, 29, 0, 1007.96, 83.79, 25.8, 20.4, 22.42, 1.34)
(20160403, -1, , 26, 19, 雷阵雨, , 3, 51, 良, , 0, 83, 0, 1007, 81.92, 27.8, 20.7, 23.59, 1.39)
(20160404, -1, , 25, 21, 阵雨, , 3, 38, 优, , 33, 66, 22.8, 1004.96, 85.92, 28, 20.2, 23.44, 1.35)
(20160405, -1, , 27, 20, 多云, , 3, 34, 优, , 100, 0, 0, 1005.79, 87.42, 26, 20, 22.95, 1.4)
(20160406, -1, , 27, 20, 阴, , 3, 29, 优, , 50, 33, 0, 1005.62, 79.29, 29.8, 21.4, 24.68, 1.56)
(20160407, -1, , 29, 22, 多云, , 3, 34, 优, , 58, 41, 0, 1005.62, 82.58, 28.8, 22.6, 25.18, 1.49)
(20160408, -1, , 27, 21, 小雨, , 3, 39, 优, , 83, 16, 0, 1005.75, 83, 29.3, 22.8, 25.57, 1.73)
(20160409, -1, , 28, 21, 小雨, , 3, 37, 优, , 25, 75, 0.1, 1004.12, 87.79, 27.1, 23.5, 25.08, 1.82)
(20160410, -1, , 26, 21, 中雨, 小到中雨, 4, 35, 优, , 0, 100, 11, 1001.75, 91.58, 24.6, 21.2, 22.96, 1.41)

Destination CSV name: Data_w.csv
0        ymd,power,irradiation,bWendu,yWendu,bTianqi,yTianqi,fengli,aqi,aqiInfo,aqiLevel,sunny_percent,rain_percent,rain_full,pressure_avg,hum_avg,tem_max,tem_min,tem_avg,wspd_avg

1        20160401,-1,,27,19,阴,多云,3,77,良,,65,0,0,1006.91,78.91,26.9,20.6,22.87,1.08

2        20160402,-1,,26,20,阴,,3,66,良,,25,29,0,1007.96,83.79,25.8,20.4,22.42,1.34

3        20160403,-1,,26,19,雷阵雨,,3,51,良,,0,83,0,1007,81.92,27.8,20.7,23.59,1.39

4        20160404,-1,,25,21,阵雨,,3,38,优,,33,66,22.8,1004.96,85.92,28,20.2,23.44,1.35

5        20160405,-1,,27,20,多云,,3,34,优,,100,0,0,1005.79,87.42,26,20,22.95,1.4

6        20160406,-1,,27,20,阴,,3,29,优,,50,33,0,1005.62,79.29,29.8,21.4,24.68,1.56

7        20160407,-1,,29,22,多云,,3,34,优,,58,41,0,1005.62,82.58,28.8,22.6,25.18,1.49

8        20160408,-1,,27,21,小雨,,3,39,优,,83,16,0,1005.75,83,29.3,22.8,25.57,1.73

9        20160409,-1,,28,21,小雨,,3,37,优,,25,75,0.1,1004.12,87.79,27.1,23.5,25.08,1.82

10       20160410,-1,,26,21,中雨,小到中雨,4,35,优,,0,100,11,1001.75,91.58,24.6,21.2,22.96,1.41</code></pre> 
<h3>3、说明</h3> 
<p>以上代码默认测试环境为Qt 5.7，测试系统为Windows7 x64</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f50508953485faed9a63786899620a29/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java基础知识总结-Java中的this关键字的几种用法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2ed7578f46fe0e291f920da76718a12e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">goquery的使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>