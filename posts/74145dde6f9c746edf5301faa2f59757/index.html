<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nvidia-docker ä½¿ç”¨ - ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nvidia-docker ä½¿ç”¨" />
<meta property="og:description" content="docker 17.03.2-ce ä½¿ç”¨GPU docker å®˜æ–¹æ˜¯ 19.0.2 å¼€å§‹æ”¯æŒè‹±ä¼Ÿè¾¾GPU åœ¨æ­¤ä¹‹å‰ç‰ˆæœ¬å¯ä»¥é€šè¿‡è‹±ä¼Ÿè¾¾é­”æ”¹dockerçš„å·¥å…· å®ç°æ­¤éœ€æ±‚
ğŸ“¦ nvidia-docker &#43; nvidia-container-runtime è¿™ä¸ªæ–¹æ¡ˆæœ€ä½docker è¦æ±‚æ˜¯åœ¨docker 12 å¹¶ä¸” ç”±äºdocker å®˜æ–¹åœ¨docker 19 å¼€å§‹æ”¯æŒè‹±ä¼Ÿè¾¾GPUç›®å‰è¿™ä¸ª æ–¹æ¡ˆæ˜¯å·²ç»åœæ­¢ç»´æŠ¤äº†ã€‚é«˜äº19 ç›´æ¥å®‰è£… nvidia-container-toolkit
0 ä½¿ç”¨åŸç† nvidia-docker2.0 æ˜¯ä¸€ä¸ªç®€å•çš„åŒ…ï¼Œå®ƒä¸»è¦é€šè¿‡ä¿®æ”¹dockerçš„é…ç½®æ–‡ä»¶/etc/docker/daemon.jsonæ¥è®©dockerä½¿ç”¨NVIDIA Container runtimeã€‚
nvidia-container-runtime æ‰æ˜¯çœŸæ­£çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒåœ¨åŸæœ‰çš„dockerå®¹å™¨è¿è¡Œæ—¶runcçš„åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªprestart hook,ç”¨äºè°ƒç”¨libnvidia-containeråº“ã€‚
ğŸ“¦nvidia-docker2.0 æ˜¯ nvidia-docker å‡çº§ç‰ˆ
1 docker å®‰è£… sudo apt update å¸è½½ docker æœåŠ¡å™¨ä¸Šæœ‰å…¶ä»–ç‰ˆæœ¬docker æ‰éœ€è¦
sudo apt-get purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras # ä¸Šé¢æ— æ•ˆä½¿ç”¨ä¸‹é¢çš„ find / -name docker # æ‰¾åˆ°æ‰€æœ‰dockeræœ‰å…³çš„æ–‡ä»¶ rm -rf /etc/systemd/system/docker.service.d rm -rf /var/lib/docker rm /usr/bin/dockerd rm /run/containerd/containerd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/74145dde6f9c746edf5301faa2f59757/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-04T12:58:09+08:00" />
<meta property="article:modified_time" content="2023-11-04T12:58:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nvidia-docker ä½¿ç”¨</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="docker_17032ce_GPU_0"></a>docker 17.03.2-ce ä½¿ç”¨GPU</h2> 
<p>docker å®˜æ–¹æ˜¯ 19.0.2 å¼€å§‹æ”¯æŒè‹±ä¼Ÿè¾¾GPU åœ¨æ­¤ä¹‹å‰ç‰ˆæœ¬å¯ä»¥é€šè¿‡è‹±ä¼Ÿè¾¾é­”æ”¹dockerçš„å·¥å…· å®ç°æ­¤éœ€æ±‚</p> 
<p>ğŸ“¦ nvidia-docker + nvidia-container-runtime è¿™ä¸ªæ–¹æ¡ˆæœ€ä½docker è¦æ±‚æ˜¯åœ¨docker 12 å¹¶ä¸” ç”±äºdocker å®˜æ–¹åœ¨docker 19 å¼€å§‹æ”¯æŒè‹±ä¼Ÿè¾¾GPUç›®å‰è¿™ä¸ª æ–¹æ¡ˆæ˜¯å·²ç»åœæ­¢ç»´æŠ¤äº†ã€‚é«˜äº19 ç›´æ¥å®‰è£… nvidia-container-toolkit</p> 
<h4><a id="0__8"></a>0 ä½¿ç”¨åŸç†</h4> 
<ul><li> <p><a href="https://github.com/NVIDIA/nvidia-docker">nvidia-docker2.0</a> æ˜¯ä¸€ä¸ªç®€å•çš„åŒ…ï¼Œå®ƒä¸»è¦é€šè¿‡ä¿®æ”¹dockerçš„é…ç½®æ–‡ä»¶<code>/etc/docker/daemon.json</code>æ¥è®©dockerä½¿ç”¨<code>NVIDIA Container runtime</code>ã€‚</p> </li><li> <p><a href="https://github.com/NVIDIA/nvidia-container-runtime">nvidia-container-runtime</a> æ‰æ˜¯çœŸæ­£çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒåœ¨åŸæœ‰çš„<code>docker</code>å®¹å™¨è¿è¡Œæ—¶<code>runc</code>çš„åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ª<a href="https://github.com/opencontainers/runtime-spec/blob/master/config.md#prestart">prestart hook</a>,ç”¨äºè°ƒç”¨<code>libnvidia-container</code>åº“ã€‚</p> <p>ğŸ“¦nvidia-docker2.0 æ˜¯ nvidia-docker å‡çº§ç‰ˆ</p> </li></ul> 
<h4><a id="1_docker__20"></a>1 docker å®‰è£…</h4> 
<pre><code>sudo apt update
</code></pre> 
<h5><a id="_docker_28"></a>å¸è½½ docker</h5> 
<p>æœåŠ¡å™¨ä¸Šæœ‰å…¶ä»–ç‰ˆæœ¬docker æ‰éœ€è¦</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras

<span class="token comment"># ä¸Šé¢æ— æ•ˆä½¿ç”¨ä¸‹é¢çš„</span>

<span class="token function">find</span> / <span class="token parameter variable">-name</span> <span class="token function">docker</span> <span class="token comment"># æ‰¾åˆ°æ‰€æœ‰dockeræœ‰å…³çš„æ–‡ä»¶</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/systemd/system/docker.service.d

<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/docker
<span class="token function">rm</span> /usr/bin/dockerd
<span class="token function">rm</span> /run/containerd/containerd.sock
<span class="token function">rm</span> /usr/bin/docker
<span class="token function">rm</span> /usr/share/bash-completion/completions/docker
<span class="token function">rm</span> /etc/docker
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /run/docker
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /root/server/docker
</code></pre> 
<h5><a id="docker_52"></a>å®‰è£…æŒ‡å®šç‰ˆæœ¬docker</h5> 
<h5><a id="_54"></a>ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…</h5> 
<p>å› ä¸º17.03.2-ce ç‰ˆæœ¬æ¯”è¾ƒè€ ç½‘ç»œå®‰è£…å¯èƒ½ä¼šé‡åˆ°æ£€ç´¢ä¸åˆ°è¿™ä¸ªç‰ˆæœ¬çš„é—®é¢˜æ‰€ä»¥é‡‡ç”¨ç¦»çº¿å®‰è£…åŒ…å®‰è£…ã€‚</p> 
<p><a href="https://download.docker.com/linux/static/stable/x86_64/" rel="nofollow">å®‰è£…åŒ…ä¸‹è½½è·¯å¾„</a></p> 
<p>æ‰¾åˆ°éœ€è¦ç‰ˆæœ¬ä¸‹è½½å³å¯</p> 
<h5><a id="_64"></a>åˆ›å»ºå®‰è£…è„šæœ¬</h5> 
<p><a href="https://www.cnblogs.com/nhdlb/p/11010627.html" rel="nofollow">å‚è€ƒé“¾æ¥</a></p> 
<p><strong>å‡†å¤‡docker.service ç³»ç»Ÿé…ç½®æ–‡ä»¶</strong></p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> docker.service
</code></pre> 
<p>å†…å®¹å¦‚ä¸‹</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>

<span class="token assign-left variable">Description</span><span class="token operator">=</span>Docker Application Container Engine

<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://docs.docker.com

<span class="token assign-left variable">After</span><span class="token operator">=</span>network-online.target firewalld.service

<span class="token assign-left variable">Wants</span><span class="token operator">=</span>network-online.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>

<span class="token assign-left variable">Type</span><span class="token operator">=</span>notify

<span class="token comment"># the default is not to use systemd for cgroups because the delegate issues still</span>

<span class="token comment"># exists and systemd currently does not support the cgroup feature set required</span>

<span class="token comment"># for containers run by docker</span>

<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/dockerd

<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-s</span> HUP <span class="token variable">$MAINPID</span>

<span class="token comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span>

<span class="token comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span>

<span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span>infinity

<span class="token assign-left variable">LimitNPROC</span><span class="token operator">=</span>infinity

<span class="token assign-left variable">LimitCORE</span><span class="token operator">=</span>infinity

<span class="token comment"># Uncomment TasksMax if your systemd version supports it.</span>

<span class="token comment"># Only systemd 226 and above support this version.</span>

<span class="token comment">#TasksMax=infinity</span>

<span class="token assign-left variable">TimeoutStartSec</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token comment"># set delegate yes so that systemd does not reset the cgroups of docker containers</span>

<span class="token assign-left variable">Delegate</span><span class="token operator">=</span>yes

<span class="token comment"># kill only the docker process, not all processes in the cgroup</span>

<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process

<span class="token comment"># restart the docker process if it exits prematurely</span>

<span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure

<span class="token assign-left variable">StartLimitBurst</span><span class="token operator">=</span><span class="token number">3</span>

<span class="token assign-left variable">StartLimitInterval</span><span class="token operator">=</span>60s

 

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre> 
<p><strong>å‡†å¤‡å®‰è£…è„šæœ¬å’Œå¸è½½è„šæœ¬</strong></p> 
<p><strong>åˆ›å»ºå®‰è£…è„šæœ¬ï¼šinstall.sh</strong></p> 
<pre><code>vim install.sh
</code></pre> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token builtin class-name">echo</span> <span class="token string">'è§£å‹taråŒ…...'</span>
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> <span class="token variable">$1</span>
<span class="token builtin class-name">echo</span> <span class="token string">'å°†dockerç›®å½•ç§»åˆ°/usr/binç›®å½•ä¸‹...'</span>
<span class="token function">cp</span> docker/* /usr/bin/
<span class="token builtin class-name">echo</span> <span class="token string">'å°†docker.service ç§»åˆ°/etc/systemd/system/ ç›®å½•...'</span>
<span class="token function">cp</span> docker.service /etc/systemd/system/
<span class="token builtin class-name">echo</span> <span class="token string">'æ·»åŠ æ–‡ä»¶æƒé™...'</span>
<span class="token function">chmod</span> +x /etc/systemd/system/docker.service
<span class="token builtin class-name">echo</span> <span class="token string">'é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶...'</span>
systemctl daemon-reload
<span class="token builtin class-name">echo</span> <span class="token string">'å¯åŠ¨docker...'</span>
systemctl start <span class="token function">docker</span>
<span class="token builtin class-name">echo</span> <span class="token string">'è®¾ç½®å¼€æœºè‡ªå¯...'</span>
systemctl <span class="token builtin class-name">enable</span> docker.service
<span class="token builtin class-name">echo</span> <span class="token string">'dockerå®‰è£…æˆåŠŸ...'</span>
<span class="token function">docker</span> <span class="token parameter variable">-v</span>
</code></pre> 
<p><strong>åˆ›å»ºå¸è½½è„šæœ¬ï¼šdelete.sh</strong></p> 
<pre><code>$ vim delete.sh
</code></pre> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token builtin class-name">echo</span> <span class="token string">'åˆ é™¤docker.service...'</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/systemd/system/docker.service
<span class="token builtin class-name">echo</span> <span class="token string">'åˆ é™¤dockeræ–‡ä»¶...'</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /usr/bin/docker*
<span class="token builtin class-name">echo</span> <span class="token string">'é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶'</span>
systemctl daemon-reload
<span class="token builtin class-name">echo</span> <span class="token string">'å¸è½½æˆåŠŸ...'</span>
</code></pre> 
<h5><a id="_nvidiadocker_nvidiadocker2_194"></a>å®‰è£… nvidia-docker nvidia-docker2</h5> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nvidia-docker2
</code></pre> 
<h5><a id="docker_202"></a>å®‰è£…docker</h5> 
<pre><code class="prism language-bash"><span class="token function">bash</span> install.sh docker-17.03.2-ce.tgz
</code></pre> 
<h5><a id="check_210"></a>check</h5> 
<pre><code class="prism language-bash">//æŸ¥çœ‹dockerç‰ˆæœ¬å‘½ä»¤
$ <span class="token function">docker</span> <span class="token parameter variable">-v</span>

//æŸ¥çœ‹dockeræ‰€æœ‰å‘½ä»¤
$ <span class="token function">docker</span> <span class="token parameter variable">--help</span> 
</code></pre> 
<h4><a id="2__nvidiadocker2__nvidiacontainerruntime_224"></a>2 å®‰è£… nvidia-docker2 &amp; nvidia-container-runtime</h4> 
<h5><a id="_226"></a>æ£€ç´¢å¯ç”¨ç‰ˆæœ¬</h5> 
<pre><code class="prism language-sh"><span class="token function">apt-cache</span> madison nvidia-docker2 

<span class="token function">apt-cache</span> madison nvidia-container-runtime
</code></pre> 
<p>ğŸ“¦ æ²¡æ‰¾åˆ° 17.03.2-ce å¯¹åº”å®‰è£…åŒ… æµ‹è¯•äº†ä¸€ä¸‹17.12.1-1ç‰ˆæœ¬ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„</p> 
<h5><a id="_238"></a>å®‰è£…</h5> 
<pre><code class="prism language-sh"><span class="token function">apt</span> <span class="token function">install</span> nvidia-docker2<span class="token operator">=</span><span class="token number">2.0</span>.3+docker17.12.1-1
<span class="token function">apt</span> <span class="token function">install</span> nvidia-container-runtime<span class="token operator">=</span><span class="token number">2.0</span>.0+docker17.12.1-1 

</code></pre> 
<h5><a id="_248"></a></h5> 
<p>å®‰è£…å¥½ä¹‹åæ›´æ”¹é…ç½®æ–‡ä»¶</p> 
<pre><code class="prism language-sh"><span class="token comment"># vi /etc/docker/daemon.json</span>

<span class="token punctuation">{<!-- --></span>
    <span class="token string">"default-runtime"</span><span class="token builtin class-name">:</span> <span class="token string">"nvidia"</span>, <span class="token comment"># å…¶ä»–çš„å·²ç»æœ‰äº†ï¼ŒåŠ ä¸Šå°†nvidia è®¾ç½®ä¸ºé»˜è®¤ runtime</span>
    <span class="token string">"runtimes"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"nvidia"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"path"</span><span class="token builtin class-name">:</span> <span class="token string">"/usr/bin/nvidia-container-runtime"</span>,
            <span class="token string">"runtimeArgs"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>check</strong></p> 
<pre><code class="prism language-sh"><span class="token comment"># è¾“å…¥ä»¥ä¸‹å‘½åæœ‰æ­£å¸¸è¿”å›è¯´æ˜å®‰è£…å®Œæˆ</span>
nvidia-docker <span class="token parameter variable">-v</span>
nvidia-docker <span class="token parameter variable">--help</span> 
</code></pre> 
<h4><a id="3__281"></a>3 æµ‹è¯•</h4> 
<pre><code class="prism language-sh"><span class="token comment"># è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¯ä»¥æ­£å¸¸æ˜¾ç¤ºå®¿ä¸»æœºæ˜¾å¡ä¿¡æ¯åˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸ</span>
nvidia-docker run <span class="token parameter variable">--rm</span> nvidia/cuda nvidia-smi
<span class="token comment"># ç”±äº docker-17.03.2-ce æ˜¯æ¯”è¾ƒè€æ—§çš„ç‰ˆæœ¬å¾ˆæœ‰å¯èƒ½ä¼šé‡åˆ° æ— æ³•ä»é•œåƒä»“åº“æ‹‰æ–°é•œåƒçš„é—®é¢˜ã€‚è¿™ä¸ªæ—¶å€™åªèƒ½å»é•œåƒä»“åº“ æ‰¾è€çš„å¯ç”¨çš„ç‰ˆæœ¬ï¼ŒåŠ ä¸Šç‰ˆæœ¬å·åæ‹‰å–æˆåŠŸã€‚</span>
nvidia-docker run <span class="token parameter variable">--rm</span> nvidia/cuda:11.1.1-cudnn8-runtime nvidia-smi
</code></pre> 
<p>ğŸ“¦ ç½‘ä¸Šéƒ¨åˆ†æ•™ç¨‹ä¼šæåˆ°éœ€è¦åŠ å…¥â€“runtime*=*nvidia å‚æ•°.ä½†å‰é¢å·²ç»è®¾ç½®è¿‡nvidia ä¸ºé»˜è®¤runtime æ‰€ä»¥ç›´æ¥ä½¿ç”¨nvidia-docker å³å¯</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/13ef908ec77b430c3b1c1d89d0e68fce/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Javaä¼ä¸šçº§è¿›é”€å­˜ç®¡ç†ç³»ç»Ÿé¡¹ç›®å®æˆ˜ã€å®Œæ•´èµ„æ–™ã€‘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6425d14cb7b31dedd3e45bcf64fe8a20/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">unity é€šè¿‡Andriod arr è®¿é—® æ‰‹æœºè‡ªå¸¦çš„æµè§ˆå™¨</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>