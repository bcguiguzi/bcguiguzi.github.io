<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux 定时任务调度(crontab)整理，太实用了！ - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux 定时任务调度(crontab)整理，太实用了！" />
<meta property="og:description" content="crontab命令用于设置周期性被执行的指令。该命令从标准输入设备读取指令，并将其存放于“crontab”文件中，以供之后读取和执行。
可以使用crontab定时处理离线任务，比如每天凌晨2点更新数据等，经常用于系统任务调度。
服务启动和关闭 一般Linux系统中都会装有crontab，如果没有安装可以使用包管理工具安装：
yum -y install vixie-cronyum -y install crontabs crontab服务的启动和关闭命令如下：
service crond start # 启动服务service crond stop # 关闭服务service crond restart # 重启服务service crond reload # 重新载入配置service crond status # 查看crontab服务状态# 可以使用下面的命令加入开机启动chkconfig --level 345 crond on 任务调度全局配置 crontab全局任务调度配置在如下的目录：
cron.d/ cron.daily/ cron.deny cron.hourly/ cron.monthly/ crontab cron.weekly/ cron.daily是每天执行一次的job
cron.weekly是每个星期执行一次的job
cron.monthly是每月执行一次的job
cron.hourly是每个小时执行一次的job
cron.d是系统自动定期需要做的任务
crontab是设定定时任务执行文件
cron.deny文件就是用于控制不让哪些用户使用Crontab的功能
用户配置文件 每个用户都有自己的crontab配置文件，使用crontab -e命令进行编辑。保存后系统会自动存放与/var/spool/cron/目录中，文件以用户名命名。
linux的crontab服务每隔一分钟去读取一次/var/spool/cron,/etc/crontab,/etc/cron.d下面所有的内容。
crontab命令一览：
crontab -e: 编辑当前用户的定时任务列表
crontab -l: 查看当前用户的定时任务列表
crontab -r: 删除当前用户的定时任务列表
crontab定时任务格式 crontab每一条记录为一个定时任务，定时人遵循相应的定义规则。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/6d1ac59ae8109c878e679562cbf6e72f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-16T09:11:15+08:00" />
<meta property="article:modified_time" content="2023-02-16T09:11:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux 定时任务调度(crontab)整理，太实用了！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="text-align:left;">crontab命令用于设置周期性被执行的指令。该命令从标准输入设备读取指令，并将其存放于“crontab”文件中，以供之后读取和执行。</p> 
 <p style="text-align:left;">可以使用crontab定时处理离线任务，比如每天凌晨2点更新数据等，经常用于系统任务调度。</p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">服务启动和关闭</span></h3> 
 <p style="text-align:left;">一般Linux系统中都会装有<span class="kdocs-fontSize" style="font-size:9pt;">crontab</span>，如果没有安装可以使用包管理工具安装：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">yum -y install vixie-cronyum -y install crontabs</code></pre> 
 <p style="text-align:left;"></p> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">crontab</span>服务的启动和关闭命令如下：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">service crond start     # 启动服务service crond stop      # 关闭服务service crond restart   # 重启服务service crond reload    # 重新载入配置service crond status    # 查看crontab服务状态# 可以使用下面的命令加入开机启动chkconfig --level 345 crond on</code></pre> 
 <p style="text-align:left;"></p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">任务调度全局配置</span></h3> 
 <p style="text-align:left;"><span class="kdocs-fontSize" style="font-size:9pt;">crontab</span>全局任务调度配置在如下的目录：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">cron.d/       cron.daily/   cron.deny     cron.hourly/  cron.monthly/ crontab       cron.weekly/</code></pre> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">cron.daily</span>是每天执行一次的job</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">cron.weekly</span>是每个星期执行一次的job</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">cron.monthly</span>是每月执行一次的job</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">cron.hourly</span>是每个小时执行一次的job</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">cron.d</span>是系统自动定期需要做的任务</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">crontab</span>是设定定时任务执行文件</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">cron.deny</span>文件就是用于控制不让哪些用户使用Crontab的功能</p></li></ul> 
 <h3 style="text-align:left;"></h3> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">用户配置文件</span></h3> 
 <p style="text-align:left;">每个用户都有自己的<span class="kdocs-fontSize" style="font-size:9pt;">crontab</span>配置文件，使用<span class="kdocs-fontSize" style="font-size:9pt;">crontab -e</span>命令进行编辑。保存后系统会自动存放与<span class="kdocs-fontSize" style="font-size:9pt;">/var/spool/cron/</span>目录中，文件以用户名命名。</p> 
 <p style="text-align:left;">linux的<span class="kdocs-fontSize" style="font-size:9pt;">crontab</span>服务每隔一分钟去读取一次<span class="kdocs-fontSize" style="font-size:9pt;">/var/spool/cron</span>,<span class="kdocs-fontSize" style="font-size:9pt;">/etc/crontab</span>,<span class="kdocs-fontSize" style="font-size:9pt;">/etc/cron.d</span>下面所有的内容。</p> 
 <p style="text-align:left;">crontab命令一览：</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">crontab -e</span>: 编辑当前用户的定时任务列表</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">crontab -l</span>: 查看当前用户的定时任务列表</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">crontab -r</span>: 删除当前用户的定时任务列表</p></li></ul> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">crontab定时任务格式</span></h3> 
 <p style="text-align:left;">crontab每一条记录为一个定时任务，定时人遵循相应的定义规则。</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:740px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:45.135136%;height:0;"> 
    <img src="https://images2.imgbox.com/03/5d/T36ukKWX_o.png" style="margin-left:;display:block;width:740px;margin-top:-45.135136%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">其中前面的6个星号表示的含义如下：</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">minute</span>：表示分钟，可以是从0到59之间的任何整数。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">hour</span>：表示小时，可以是从0到23之间的任何整数。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">day</span>：表示日期，可以是从1到31之间的任何整数。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">month</span>：表示月份，可以是从1到12之间的任何整数。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">week</span>：表示星期几，可以是从0到7之间的任何整数，这里的0或7代表星期日。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;">command</span>：要执行的命令，可以是系统命令，也可以是自己编写的脚本文件。</p></li></ul> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">每一个星号部分可用下面的特殊符号：</span></p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>星号（*）：通配符匹配，代表所有可能的值。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>逗号（,）：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>中杠（-）：可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6”。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>正斜线（/）：可以用正斜线指定时间的间隔频率，例如“0-23/2”表示每两小时执行一次。同时正斜线可以和星号一起使用，例如*/10，如果用在minute字段，表示每十分钟执行一次。</p></li></ul> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">crontab定时任务实例</span></h3> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">时间频次示例</span></h4> 
 <p style="text-align:left;">下面列举常用的时间频次示例。</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>00 05 * * * : 每天凌晨5点执行</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>20 12 1,10,20 * * : 每个月的1号，10号，20号的12:30执行</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>10 1 * * 6,0 : 表示每周六、周日的1:10分执行</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>0,30 18-23 * * * : 每天18:00至23:00之间每隔30分钟执行</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>0 23-7/1 * * * : 晚上11点到早上7点之间，每隔一小时执行</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>0 6-12/3 * 10 * : 每年10月的每天早上6点到12点每隔3个小时执行一次</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>30 17 * * 1-5 : 周一到周五下午5点30分执行一次</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>0 */2 * * * ：每两个小时执行一次</p></li></ul> 
 <p style="text-align:left;">比如我们需要每天23点58分的时候执行一个更新数据的shell脚本，可以用<span class="kdocs-fontSize" style="font-size:9pt;">crontab -e</span>命令在最后添加一行：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">58 23 * * * sh /home/work/update.sh</code></pre> 
 <p style="text-align:left;"></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">输入输出重定向</span></h4> 
 <p style="text-align:left;">在上面更新数据定时任务的实例中，如果执行update.sh的时候有错误信息输出，会输出到哪儿呢？</p> 
 <p style="text-align:left;">在没有配置输出重定向的时候，定时任务会见错误输出到下面的文件：<span class="kdocs-fontSize" style="font-size:9pt;">/var/log/mail/{$user}</span>，这是很不好的，我们往往需要把不同的脚本输出到不同的日志文件，方便查看脚本的执行情况，这个时候需要使用输出重定向。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">58 23 * * * sh /home/work/update.sh &gt;&gt; /home/work/log/update.log 2&gt;&amp;1</code></pre> 
 <p style="text-align:left;"></p> 
 <p style="text-align:left;">Linux中使用<span class="kdocs-fontSize" style="font-size:9pt;">0-3</span>作为文件描述符来表示标准流。</p> 
 <div style=""> 
  <table class="kdocs-table" border="1" cellpadding="1" cellspacing="1" style=""><tbody><tr class="kdocs-tableRow"><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;"><span class="kdocs-bold" style="font-weight:bold;">名称</span></p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;"><span class="kdocs-bold" style="font-weight:bold;">类型</span></p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;"><span class="kdocs-bold" style="font-weight:bold;">文件描述符</span></p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;"><span class="kdocs-bold" style="font-weight:bold;">操作</span></p></td></tr><tr class="kdocs-tableRow"><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">stdin 标准输入</p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">standard input</p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">0</p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">&lt;,&lt;&lt;</p></td></tr><tr class="kdocs-tableRow"><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">stdout 标准输出</p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">standard output</p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">1</p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">&gt;,&gt;&gt;</p></td></tr><tr class="kdocs-tableRow"><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">stderr 标准错误输出</p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">standard error output</p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">2</p></td><td class="kdocs-tableCell" style="width:184px;vertical-align:top;height:52px;"><p style="text-align:center;">2&gt;,2&gt;&gt;</p></td></tr></tbody></table> 
 </div> 
 <p style="text-align:left;">在上面的定时任务脚本中，<span class="kdocs-fontSize" style="font-size:9pt;">update.sh</span>后面的<span class="kdocs-fontSize" style="font-size:9pt;">&gt;&gt;</span>表示将输出追加到<span class="kdocs-fontSize" style="font-size:9pt;">update.log</span>文件中，<span class="kdocs-fontSize" style="font-size:9pt;">2&gt;&amp;1</span>表示标准错误输出重定向等同于标准输出。</p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">忽略输入nohup</span></h4> 
 <p style="text-align:left;">有时候我们还会看到在定时任务脚本前面有一个<span class="kdocs-fontSize" style="font-size:9pt;">nohup</span>的命令，该命令用于指定后面的脚本忽略输入。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">58 23 * * * nohup sh /home/work/update.sh &gt;&gt; /home/work/log/update.log 2&gt;&amp;1</code></pre> 
 <p style="text-align:left;"></p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">后台执行&amp;</span></h4> 
 <p style="text-align:left;">无论是在控制台直接执行，还是在定时任务脚本中，我们在某一条命令的最后面加上<span class="kdocs-fontSize" style="font-size:9pt;">&amp;</span>符号，表示当前命令在后台运行，不占用控制台。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">58 23 * * * nohup sh /home/work/update.sh &gt;&gt; /home/work/log/update.log 2&gt;&amp;1 &amp;</code></pre> 
 <p style="text-align:left;"></p> 
 <p style="text-align:left;">这里需要注意，如果执行的命令有等待输入的交互，把这个命令使用<span class="kdocs-fontSize" style="font-size:9pt;">&amp;</span>放在后台运行时，它会一直等待输入，但是有没有输入，就卡住不动了。</p> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">时间处理</span></h4> 
 <p style="text-align:left;">再回顾上面的更新任务，它是将每一天的运行结果都重定向到<span class="kdocs-fontSize" style="font-size:9pt;">update.log</span>文件，如果输出比较多，我们就需要每一天输出的不同的文件，可以通过在输出目录中指定日期用来分割。如下：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">58 23 * * * nohup sh /home/work/update.sh &gt;&gt; /home/work/log/`update_"date +\%Y\%m\%d".log` 2&gt;&amp;1 &amp;# 或者下面的形式58 23 * * * nohup sh /home/work/update.sh &gt;&gt; "/home/work/log/update_"date +\%Y\%m\%d".log" 2&gt;&amp;1 &amp;</code></pre> 
 <p style="text-align:left;"></p> 
 <p style="text-align:left;">这里使用<span class="kdocs-fontSize" style="font-size:9pt;">date</span>函数，需要注意的是，crontab里面的脚本命令和直接在命令行运行的脚本可能是不一样的，尤其是<span class="kdocs-fontSize" style="font-size:9pt;">date</span>函数中的<span class="kdocs-fontSize" style="font-size:9pt;">%</span>需要转义。</p> 
 <p style="text-align:left;">可以直接在命令行运行下面命令：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">sh /home/work/update.sh &gt;&gt; /home/work/log/update_`date +"%Y%m%d".log` 2&gt;&amp;1 &amp;</code></pre> 
 <p style="text-align:left;"></p> 
 <p style="text-align:left;">达到和定时任务里面相同的效果，都是输出到<span class="kdocs-fontSize" style="font-size:9pt;">update_20201120.log</span>的文件。</p> 
 <p style="text-align:left;">但是如果直接在crontab中这样配置，则无法识别，不会执行该定时任务。下面的crontab任务是不会执行的，date函数将会报错。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">58 23 * * * nohup sh /home/work/update.sh &gt;&gt; /home/work/log/`update_"date +%Y%m%d".log` 2&gt;&amp;1 &amp;</code></pre> 
 <p style=""></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/36c2b374c388ba09e80b664c35066c10/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vite开启https — 离线和在线生成签名证书</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e0e445585cd1920cf87afca9d83cbcc7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">拖拽式小程序系统源码 公众号小程序二合一版</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>