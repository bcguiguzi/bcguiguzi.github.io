<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>QEMU CAN总线 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="QEMU CAN总线" />
<meta property="og:description" content="QEMU CAN总线 在我的博客《qemu常用参数选项说明》中我介绍的一些常用的qemu参数配置，而对于嵌入式开发往往还会涉及到更多形形色色的系统总线和硬件，本文来讲述下使用qemu can总线的用法。
qemu参数配置 qemu支持can模拟的硬件不多，如果是官网下载的qemu我这里推荐使用xlnx zynqmp这个board，但是本文这里直接选择我的系列博客《基于qemu-riscv从0开始构建嵌入式linux系统》中自制的quard-star板，目前开源在github和gitee上的代码均已支持CAN模拟。
qemu启动参数如下：
-M quard-star,canbus=canbus0 -object can-bus,id=canbus0 -object can-host-socketcan,id=socketcan0,if=vcan0,canbus=canbus0 这里参数设置是将host主机上的can设备与qemu模拟的can设备相连接，如果我们host上没有can设备，则需要创建虚拟的vcan，此处vcan0即为我们需要创建的vcan。
vcan0创建 创建config_vcan.sh脚本，内容如下：
#!/bin/bash set -e MODE=\ &#34;config_vcan | \ release_vcan&#34; USER_NAME=$(whoami) USAGE=&#34;usage $0 [$MODE] [&lt;CAN_NAME&gt;] &#34; if [ $# == 2 ] ; then CAN_NAME=$1 else CAN_NAME=vcan0 fi config_vcan() { modprobe vcan ip link add dev $CAN_NAME type vcan ip link set up $CAN_NAME } release_vcan() { ip link set down $CAN_NAME ip link delete dev $CAN_NAME } case &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/8ee52c000a5b1f96d461221ef049f545/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-24T14:45:55+08:00" />
<meta property="article:modified_time" content="2023-05-24T14:45:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">QEMU CAN总线</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="QEMU_CAN_0"></a>QEMU CAN总线</h2> 
<p>在我的博客《<a href="https://blog.csdn.net/weixin_39871788/article/details/123250595">qemu常用参数选项说明</a>》中我介绍的一些常用的qemu参数配置，而对于嵌入式开发往往还会涉及到更多形形色色的系统总线和硬件，本文来讲述下使用qemu can总线的用法。</p> 
<h3><a id="qemu_4"></a>qemu参数配置</h3> 
<p>qemu支持can模拟的硬件不多，如果是官网下载的qemu我这里推荐使用xlnx zynqmp这个board，但是本文这里直接选择我的系列博客《<a href="https://blog.csdn.net/weixin_39871788/article/details/118469061">基于qemu-riscv从0开始构建嵌入式linux系统</a>》中自制的quard-star板，目前开源在<a href="https://github.com/QQxiaoming/quard_star_tutorial">github</a>和<a href="https://gitee.com/QQxiaoming/quard_star_tutorial" rel="nofollow">gitee</a>上的代码均已支持CAN模拟。</p> 
<p>qemu启动参数如下：</p> 
<pre><code>-M quard-star,canbus=canbus0
-object can-bus,id=canbus0 
-object can-host-socketcan,id=socketcan0,if=vcan0,canbus=canbus0
</code></pre> 
<p>这里参数设置是将host主机上的can设备与qemu模拟的can设备相连接，如果我们host上没有can设备，则需要创建虚拟的vcan，此处vcan0即为我们需要创建的vcan。</p> 
<h3><a id="vcan0_18"></a>vcan0创建</h3> 
<p>创建config_vcan.sh脚本，内容如下：</p> 
<pre><code class="prism language-shell"><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">set</span> -e

<span class="token assign-left variable">MODE</span><span class="token operator">=</span><span class="token punctuation">\</span>
<span class="token string">"config_vcan | \
release_vcan"</span>

<span class="token assign-left variable">USER_NAME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">whoami</span><span class="token variable">)</span></span>
<span class="token assign-left variable">USAGE</span><span class="token operator">=</span><span class="token string">"usage <span class="token variable">$0</span> [<span class="token variable">$MODE</span>] [&lt;CAN_NAME&gt;] "</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token assign-left variable">CAN_NAME</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token keyword">else</span>
    <span class="token assign-left variable">CAN_NAME</span><span class="token operator">=</span>vcan0
<span class="token keyword">fi</span>

<span class="token function-name function">config_vcan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    modprobe vcan
    <span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> dev <span class="token variable">$CAN_NAME</span> <span class="token builtin class-name">type</span> vcan
    <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> up <span class="token variable">$CAN_NAME</span>
<span class="token punctuation">}</span>

<span class="token function-name function">release_vcan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> down <span class="token variable">$CAN_NAME</span>
    <span class="token function">ip</span> <span class="token function">link</span> delete dev <span class="token variable">$CAN_NAME</span>
<span class="token punctuation">}</span>

<span class="token keyword">case</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token keyword">in</span>
config_vcan<span class="token punctuation">)</span>
    config_vcan
	<span class="token punctuation">;</span><span class="token punctuation">;</span>
release_vcan<span class="token punctuation">)</span>
    release_vcan
	<span class="token punctuation">;</span><span class="token punctuation">;</span>
--help<span class="token punctuation">)</span>
	<span class="token builtin class-name">echo</span> <span class="token variable">$USAGE</span>
	<span class="token builtin class-name">exit</span> <span class="token number">0</span>
	<span class="token punctuation">;</span><span class="token punctuation">;</span>
*<span class="token punctuation">)</span>
	<span class="token builtin class-name">echo</span> <span class="token variable">$USAGE</span>
	<span class="token builtin class-name">exit</span> <span class="token number">1</span>	
	<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre> 
<p>执行sudo ./config_vcan.sh config_vcan就可以成功创建vcan0，如果你想删除这个vcan则只需sudo ./config_vcan.sh release_vcan。</p> 
<p>这里稍微解释下，vcan是linux kernel内的一个driver，提供vcan的设备，因此只需要加载该驱动，就可以使用ip link相关命令来配置vcan设备，如同真实物理can设备一样。</p> 
<p>完成vcan配置后，输入ifconfig，一切正常就会显示存在以下设备，此时我们就可以启动qemu了。</p> 
<pre><code class="prism language-shell">vcan0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">19</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,RUNNING,NOARP<span class="token operator">&gt;</span>  mtu <span class="token number">72</span>
        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>未指定<span class="token punctuation">)</span>
        RX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>
</code></pre> 
<h3><a id="qemu_xlnxcan_ip_fix_85"></a>qemu xlnx-can ip fix</h3> 
<p>原本此时我们配置好驱动就可以在qemu内的linux系统上使用can总线了，当然你可以裸机自己手写can驱动进行开发，但是我这里实测时发现直接使用linux kerenl的xlnx-can驱动，设备枚举一切正常，但数据会产生错误，经过debug分析最终确认我使用的qemu 7.0.0（截止发文前目前qemu上游mainline依然存在该问题）版本的xlnx-can ip模拟代码可能存在问题，因此这里需要手动修复（如果你使用quard-star则不需要，因为我已经修复它了）。这里描述问题如下：</p> 
<p>在测试host上使用vcan与guest上的can通信，结果发现数据包字节序似乎不正确，因此对比kernel内的驱动代码以及qemu的代码发现xlnx的can格式和socket can格式是不匹配的，需要转换，这里阅读《ug1085-zynq-ultrascale-trm.pdf》的Table 20‐3: CAN Message Format就能发现这个问题，奇怪的是qemu-7.0.0/hw/net/can/xlnx-zynqmp-can.c内实现的似乎没有转换xlnx CAN Message Format而是把Socket CAN Format直接转发了，因此导致了错误。我这里添加或修改以下函数，问题得到解决（这里我没有向qemu上游发送patch，因为我不确定是否真实的zynq硬件情况）。</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XCAN_IDR_IDE_MASK</span>		<span class="token expression"><span class="token number">0x00080000U</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XCAN_IDR_ID1_MASK</span>		<span class="token expression"><span class="token number">0xFFE00000U</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XCAN_IDR_ID2_MASK</span>		<span class="token expression"><span class="token number">0x0007FFFEU</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XCAN_IDR_RTR_MASK</span>		<span class="token expression"><span class="token number">0x00000001U</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XCAN_IDR_SRR_MASK</span>		<span class="token expression"><span class="token number">0x00100000U</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XCAN_IDR_ID1_SHIFT</span>		<span class="token expression"><span class="token number">21</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XCAN_IDR_ID2_SHIFT</span>		<span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAN_SFF_ID_BITS</span>		    <span class="token expression"><span class="token number">11</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAN_EFF_ID_BITS</span>		    <span class="token expression"><span class="token number">29</span></span></span>

<span class="token keyword">static</span> <span class="token class-name">uint32_t</span> <span class="token function">id_xcan2can</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> id<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">uint32_t</span> ret_id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token comment">/* Change Xilinx CAN ID format to socketCAN ID format */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&amp;</span> XCAN_IDR_IDE_MASK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* The received frame is an Extended format frame */</span>
        ret_id <span class="token operator">=</span> <span class="token punctuation">(</span>id <span class="token operator">&amp;</span> XCAN_IDR_ID1_MASK<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
        ret_id <span class="token operator">|=</span> <span class="token punctuation">(</span>id <span class="token operator">&amp;</span> XCAN_IDR_ID2_MASK<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span>
                XCAN_IDR_ID2_SHIFT<span class="token punctuation">;</span>
        ret_id <span class="token operator">|=</span> QEMU_CAN_EFF_FLAG<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&amp;</span> XCAN_IDR_RTR_MASK<span class="token punctuation">)</span>
            ret_id <span class="token operator">|=</span> QEMU_CAN_RTR_FLAG<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* The received frame is a standard format frame */</span>
        ret_id <span class="token operator">=</span> <span class="token punctuation">(</span>id <span class="token operator">&amp;</span> XCAN_IDR_ID1_MASK<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span>
                XCAN_IDR_ID1_SHIFT<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&amp;</span> XCAN_IDR_SRR_MASK<span class="token punctuation">)</span>
            ret_id <span class="token operator">|=</span> QEMU_CAN_RTR_FLAG<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ret_id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token class-name">uint32_t</span> <span class="token function">id_can2xcan</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> id<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">uint32_t</span> ret_id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&amp;</span> QEMU_CAN_EFF_FLAG<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* Extended CAN ID format */</span>
        ret_id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>id <span class="token operator">&amp;</span> QEMU_CAN_EFF_MASK<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> XCAN_IDR_ID2_SHIFT<span class="token punctuation">)</span> <span class="token operator">&amp;</span>
            XCAN_IDR_ID2_MASK<span class="token punctuation">;</span>
        ret_id <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id <span class="token operator">&amp;</span> QEMU_CAN_EFF_MASK<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span>
            <span class="token punctuation">(</span>CAN_EFF_ID_BITS <span class="token operator">-</span> CAN_SFF_ID_BITS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span>
            XCAN_IDR_ID1_SHIFT<span class="token punctuation">)</span> <span class="token operator">&amp;</span> XCAN_IDR_ID1_MASK<span class="token punctuation">;</span>
        ret_id <span class="token operator">|=</span> XCAN_IDR_IDE_MASK <span class="token operator">|</span> XCAN_IDR_SRR_MASK<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&amp;</span> QEMU_CAN_RTR_FLAG<span class="token punctuation">)</span>
            ret_id <span class="token operator">|=</span> XCAN_IDR_RTR_MASK<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* Standard CAN ID format */</span>
        ret_id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>id <span class="token operator">&amp;</span> QEMU_CAN_SFF_MASK<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> XCAN_IDR_ID1_SHIFT<span class="token punctuation">)</span> <span class="token operator">&amp;</span>
            XCAN_IDR_ID1_MASK<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&amp;</span> QEMU_CAN_RTR_FLAG<span class="token punctuation">)</span>
            ret_id <span class="token operator">|=</span> XCAN_IDR_SRR_MASK<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ret_id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">generate_frame</span><span class="token punctuation">(</span>qemu_can_frame <span class="token operator">*</span>frame<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> <span class="token operator">*</span>data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    frame<span class="token operator">-&gt;</span>can_id <span class="token operator">=</span> <span class="token function">id_xcan2can</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    frame<span class="token operator">-&gt;</span>can_dlc <span class="token operator">=</span> <span class="token function">FIELD_EX32</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TXFIFO_DLC<span class="token punctuation">,</span> DLC<span class="token punctuation">)</span><span class="token punctuation">;</span>

    frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">FIELD_EX32</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TXFIFO_DATA1<span class="token punctuation">,</span> DB0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">FIELD_EX32</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TXFIFO_DATA1<span class="token punctuation">,</span> DB1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">FIELD_EX32</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TXFIFO_DATA1<span class="token punctuation">,</span> DB2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">FIELD_EX32</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TXFIFO_DATA1<span class="token punctuation">,</span> DB3<span class="token punctuation">)</span><span class="token punctuation">;</span>

    frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">FIELD_EX32</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TXFIFO_DATA2<span class="token punctuation">,</span> DB4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">FIELD_EX32</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TXFIFO_DATA2<span class="token punctuation">,</span> DB5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">FIELD_EX32</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TXFIFO_DATA2<span class="token punctuation">,</span> DB6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">FIELD_EX32</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TXFIFO_DATA2<span class="token punctuation">,</span> DB7<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">update_rx_fifo</span><span class="token punctuation">(</span>XlnxZynqMPCANState <span class="token operator">*</span>s<span class="token punctuation">,</span> <span class="token keyword">const</span> qemu_can_frame <span class="token operator">*</span>frame<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    bool filter_pass <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token class-name">uint16_t</span> timestamp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">/* If no filter is enabled. Message will be stored in FIFO. */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">ARRAY_FIELD_EX32</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>regs<span class="token punctuation">,</span> AFR<span class="token punctuation">,</span> UAF1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token punctuation">(</span><span class="token function">ARRAY_FIELD_EX32</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>regs<span class="token punctuation">,</span> AFR<span class="token punctuation">,</span> UAF2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token punctuation">(</span><span class="token function">ARRAY_FIELD_EX32</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>regs<span class="token punctuation">,</span> AFR<span class="token punctuation">,</span> UAF3<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token punctuation">(</span><span class="token function">ARRAY_FIELD_EX32</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>regs<span class="token punctuation">,</span> AFR<span class="token punctuation">,</span> UAF4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        filter_pass <span class="token operator">=</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
    * Messages that pass any of the acceptance filters will be stored in
    * the RX FIFO.
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ARRAY_FIELD_EX32</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>regs<span class="token punctuation">,</span> AFR<span class="token punctuation">,</span> UAF1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">uint32_t</span> id_masked <span class="token operator">=</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFMR1<span class="token punctuation">]</span> <span class="token operator">&amp;</span> frame<span class="token operator">-&gt;</span>can_id<span class="token punctuation">;</span>
        <span class="token class-name">uint32_t</span> filter_id_masked <span class="token operator">=</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFMR1<span class="token punctuation">]</span> <span class="token operator">&amp;</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFIR1<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>filter_id_masked <span class="token operator">==</span> id_masked<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            filter_pass <span class="token operator">=</span> true<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ARRAY_FIELD_EX32</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>regs<span class="token punctuation">,</span> AFR<span class="token punctuation">,</span> UAF2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">uint32_t</span> id_masked <span class="token operator">=</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFMR2<span class="token punctuation">]</span> <span class="token operator">&amp;</span> frame<span class="token operator">-&gt;</span>can_id<span class="token punctuation">;</span>
        <span class="token class-name">uint32_t</span> filter_id_masked <span class="token operator">=</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFMR2<span class="token punctuation">]</span> <span class="token operator">&amp;</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFIR2<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>filter_id_masked <span class="token operator">==</span> id_masked<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            filter_pass <span class="token operator">=</span> true<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ARRAY_FIELD_EX32</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>regs<span class="token punctuation">,</span> AFR<span class="token punctuation">,</span> UAF3<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">uint32_t</span> id_masked <span class="token operator">=</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFMR3<span class="token punctuation">]</span> <span class="token operator">&amp;</span> frame<span class="token operator">-&gt;</span>can_id<span class="token punctuation">;</span>
        <span class="token class-name">uint32_t</span> filter_id_masked <span class="token operator">=</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFMR3<span class="token punctuation">]</span> <span class="token operator">&amp;</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFIR3<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>filter_id_masked <span class="token operator">==</span> id_masked<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            filter_pass <span class="token operator">=</span> true<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ARRAY_FIELD_EX32</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>regs<span class="token punctuation">,</span> AFR<span class="token punctuation">,</span> UAF4<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">uint32_t</span> id_masked <span class="token operator">=</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFMR4<span class="token punctuation">]</span> <span class="token operator">&amp;</span> frame<span class="token operator">-&gt;</span>can_id<span class="token punctuation">;</span>
        <span class="token class-name">uint32_t</span> filter_id_masked <span class="token operator">=</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFMR4<span class="token punctuation">]</span> <span class="token operator">&amp;</span> s<span class="token operator">-&gt;</span>regs<span class="token punctuation">[</span>R_AFIR4<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>filter_id_masked <span class="token operator">==</span> id_masked<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            filter_pass <span class="token operator">=</span> true<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filter_pass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">trace_xlnx_can_rx_fifo_filter_reject</span><span class="token punctuation">(</span>frame<span class="token operator">-&gt;</span>can_id<span class="token punctuation">,</span> frame<span class="token operator">-&gt;</span>can_dlc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* Store the message in fifo if it passed through any of the filters. */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>filter_pass <span class="token operator">&amp;&amp;</span> frame<span class="token operator">-&gt;</span>can_dlc <span class="token operator">&lt;=</span> MAX_DLC<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fifo32_is_full</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-&gt;</span>rx_fifo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">ARRAY_FIELD_DP32</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>regs<span class="token punctuation">,</span> INTERRUPT_STATUS_REGISTER<span class="token punctuation">,</span> RXOFLW<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            timestamp <span class="token operator">=</span> CAN_TIMER_MAX <span class="token operator">-</span> <span class="token function">ptimer_get_count</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>can_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">fifo32_push</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-&gt;</span>rx_fifo<span class="token punctuation">,</span> <span class="token function">id_can2xcan</span><span class="token punctuation">(</span>frame<span class="token operator">-&gt;</span>can_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">fifo32_push</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-&gt;</span>rx_fifo<span class="token punctuation">,</span> <span class="token function">deposit32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> R_RXFIFO_DLC_DLC_SHIFT<span class="token punctuation">,</span>
                                            R_RXFIFO_DLC_DLC_LENGTH<span class="token punctuation">,</span>
                                            frame<span class="token operator">-&gt;</span>can_dlc<span class="token punctuation">)</span> <span class="token operator">|</span>
                                    <span class="token function">deposit32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> R_RXFIFO_DLC_RXT_SHIFT<span class="token punctuation">,</span>
                                            R_RXFIFO_DLC_RXT_LENGTH<span class="token punctuation">,</span>
                                            timestamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">/* First 32 bit of the data. */</span>
            <span class="token function">fifo32_push</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-&gt;</span>rx_fifo<span class="token punctuation">,</span> <span class="token function">deposit32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> R_TXFIFO_DATA1_DB0_SHIFT<span class="token punctuation">,</span>
                                            R_TXFIFO_DATA1_DB0_LENGTH<span class="token punctuation">,</span>
                                            frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                                    <span class="token function">deposit32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> R_TXFIFO_DATA1_DB1_SHIFT<span class="token punctuation">,</span>
                                            R_TXFIFO_DATA1_DB1_LENGTH<span class="token punctuation">,</span>
                                            frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                                    <span class="token function">deposit32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> R_TXFIFO_DATA1_DB2_SHIFT<span class="token punctuation">,</span>
                                            R_TXFIFO_DATA1_DB2_LENGTH<span class="token punctuation">,</span>
                                            frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                                    <span class="token function">deposit32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> R_TXFIFO_DATA1_DB3_SHIFT<span class="token punctuation">,</span>
                                            R_TXFIFO_DATA1_DB3_LENGTH<span class="token punctuation">,</span>
                                            frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/* Last 32 bit of the data. */</span>
            <span class="token function">fifo32_push</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-&gt;</span>rx_fifo<span class="token punctuation">,</span> <span class="token function">deposit32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> R_TXFIFO_DATA2_DB4_SHIFT<span class="token punctuation">,</span>
                                            R_TXFIFO_DATA2_DB4_LENGTH<span class="token punctuation">,</span>
                                            frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                                    <span class="token function">deposit32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> R_TXFIFO_DATA2_DB5_SHIFT<span class="token punctuation">,</span>
                                            R_TXFIFO_DATA2_DB5_LENGTH<span class="token punctuation">,</span>
                                            frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                                    <span class="token function">deposit32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> R_TXFIFO_DATA2_DB6_SHIFT<span class="token punctuation">,</span>
                                            R_TXFIFO_DATA2_DB6_LENGTH<span class="token punctuation">,</span>
                                            frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                                    <span class="token function">deposit32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> R_TXFIFO_DATA2_DB7_SHIFT<span class="token punctuation">,</span>
                                            R_TXFIFO_DATA2_DB7_LENGTH<span class="token punctuation">,</span>
                                            frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">ARRAY_FIELD_DP32</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span>regs<span class="token punctuation">,</span> INTERRUPT_STATUS_REGISTER<span class="token punctuation">,</span> RXOK<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">trace_xlnx_can_rx_data</span><span class="token punctuation">(</span>frame<span class="token operator">-&gt;</span>can_id<span class="token punctuation">,</span> frame<span class="token operator">-&gt;</span>can_dlc<span class="token punctuation">,</span>
                                frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">can_update_irq</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="qemu_278"></a>运行qemu</h3> 
<p>配置即将在qemu内运行的系统设备树</p> 
<pre><code>can: can@1000c000 {
    compatible = "xlnx,zynq-can-1.0";
    status = "disabled";
    clock-names = "can_clk", "pclk";
    clocks = &lt;&amp;can_clk&gt;, &lt;&amp;pclk&gt;;
    reg = &lt;0x0 0x1000c000 0x0 0x1000&gt;;
    interrupt-parent = &lt;&amp;plic&gt;;
    interrupts = &lt;23&gt;;
    tx-fifo-depth = &lt;0x40&gt;;
    rx-fifo-depth = &lt;0x40&gt;;
  };
</code></pre> 
<p>进入系统can初始化成功，然后我们通过终端配置can设备（busybox的ip命令不支持can网络相关设置，需要使用iproute2来交叉编译完整版的ip，在我的项目的target_root_app/build.sh里交叉编译该软件包的脚本，target_root_app/iproute2-5.9.0.tar.gz也在项目内有提供）。</p> 
<pre><code class="prism language-shell">/sbin/ip <span class="token function">link</span> <span class="token builtin class-name">set</span> can0 <span class="token builtin class-name">type</span> can bitrate <span class="token number">1000000</span> sample-point <span class="token number">0.750</span>
/sbin/ifconfig can0 up
</code></pre> 
<p>在qemu内系统输入ifconfig，一切正常则会显示</p> 
<pre><code class="prism language-shell">can0      Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  
          UP RUNNING NOARP  MTU:16  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:10 
          RX bytes:0 <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>  TX bytes:0 <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
          Interrupt:41 
</code></pre> 
<p>现在让我们使用<a href="https://github.com/linux-can/can-utils">can-utils</a>工具包进行调试，我们在host和guest上均安装该工具，guest上自己需要交叉编译,host可以用apt安装。</p> 
<p>此时先在host执行</p> 
<pre><code class="prism language-shell">candump vcan0
</code></pre> 
<p>然后在guest执行</p> 
<pre><code class="prism language-shell">cansend can0 1807EC0B<span class="token comment">#1122334455667788</span>
cansend can0 5A1<span class="token comment">#11.22.33.44.55.66.77.88</span>
</code></pre> 
<p>查看host上输出</p> 
<pre><code class="prism language-shell">  vcan0  1807EC0B  <span class="token punctuation">[</span>08<span class="token punctuation">]</span>  <span class="token number">11</span> <span class="token number">22</span> <span class="token number">33</span> <span class="token number">44</span> <span class="token number">55</span> <span class="token number">66</span> <span class="token number">77</span> <span class="token number">88</span>
  vcan0       5A1  <span class="token punctuation">[</span>08<span class="token punctuation">]</span>  <span class="token number">11</span> <span class="token number">22</span> <span class="token number">33</span> <span class="token number">44</span> <span class="token number">55</span> <span class="token number">66</span> <span class="token number">77</span> <span class="token number">88</span>
</code></pre> 
<p>交换host和guest上的命令，可以得到同样的结果，到这里can设备在qemu上的模拟就完成了，此时你可以使用标准的linux网络框架通过can总线在host和guest上交换数据了。当然嵌入式工程师也可以不使用linux kernel的驱动，通过裸机开发驱动发送数据到host上。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fee3c0eaf68e8c8fbedf95f59b88b860/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">fedavg</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/76c4af77562daa663d480dd0680101be/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基类的指针</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>