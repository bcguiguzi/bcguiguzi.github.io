<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Protobuf NDK以及QNX交叉编译 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Protobuf NDK以及QNX交叉编译" />
<meta property="og:description" content="1. 背景 Protobuf 用处很广，尤其是通讯数据序列化，反序列化。
TODO
2. 下载资源 protobuf镜像地址：github-protobuf
Android ndk下载：Android ndk
QNX tools下载： prebuilt_QNX700
下载完，解压！
TODO
3. 实操 废话不多数，直接上编译脚本
3.1 NDK交叉编译脚本 build_android.sh
#!/bin/sh ################################### #### build script for protobuf #### taget:qnx #### Date: 2022-11-01 #### Author: 村里小码农 ################################### # qnx bsp dir NDKROOT_PATH=/workspace/tools/android-ndk-r23b TOOLCHAIN=$NDKROOT_PATH/toolchains/llvm/prebuilt/linux-x86_64 # current dir CURRENT_PATH=$(pwd) # config Compile param. TARGET_API=28 # TARGET_ANDROID_PLATFORM=android-$TARGET_API #预留 TARGET=aarch64-linux-android #TARGET_ABI=armeabi-v7a TARGET_ABI=arm64-v8a PREFIX=$CURRENT_PATH/build/android/$TARGET_ABI if [ -d $PREFIX ];then rm -rf $PREFIX mkdir -p $PREFIX else mkdir -p $PREFIX fi if [ !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/bf34e399ed5054e441ca31481b7ee221/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-03T14:15:59+08:00" />
<meta property="article:modified_time" content="2022-11-03T14:15:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Protobuf NDK以及QNX交叉编译</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1. 背景</h2> 
<p>Protobuf  用处很广，尤其是通讯数据序列化，反序列化。</p> 
<p>TODO</p> 
<h2>2. 下载资源</h2> 
<p>protobuf镜像地址：<a class="link-info" href="https://hub.yzuu.cf/protocolbuffers/protobuf" rel="nofollow" title="github-protobuf">github-protobuf</a></p> 
<p>Android ndk下载：<a class="link-info" href="https://developer.android.google.cn/ndk/downloads?hl=zh-cn" rel="nofollow" title="Android ndk">Android ndk</a></p> 
<p>QNX tools下载： prebuilt_QNX700</p> 
<p>下载完，解压！</p> 
<p>TODO</p> 
<h2>3.  实操</h2> 
<p>废话不多数，直接上编译脚本</p> 
<h3>3.1  NDK交叉编译脚本</h3> 
<p><strong>build_android.sh</strong></p> 
<pre><code class="language-bash">#!/bin/sh
###################################
#### build script for protobuf
#### taget:qnx
#### Date: 2022-11-01
#### Author: 村里小码农
###################################

# qnx bsp dir
NDKROOT_PATH=/workspace/tools/android-ndk-r23b
TOOLCHAIN=$NDKROOT_PATH/toolchains/llvm/prebuilt/linux-x86_64
# current dir
CURRENT_PATH=$(pwd)
# config Compile param.
TARGET_API=28
#
TARGET_ANDROID_PLATFORM=android-$TARGET_API
#预留
TARGET=aarch64-linux-android
#TARGET_ABI=armeabi-v7a
TARGET_ABI=arm64-v8a

PREFIX=$CURRENT_PATH/build/android/$TARGET_ABI

if [ -d $PREFIX ];then
rm -rf $PREFIX
mkdir -p $PREFIX
else
mkdir -p $PREFIX
fi

if [ ! -f $TOOLCHAIN/bin/$TARGET$TARGET_API-ar ];then
ln -s $TOOLCHAIN/bin/llvm-ar $TOOLCHAIN/bin/$TARGET$TARGET_API-ar
fi

if [ ! -f $TOOLCHAIN/bin/$TARGET$TARGET_API-nm ];then
ln -s $TOOLCHAIN/bin/llvm-nm $TOOLCHAIN/bin/$TARGET$TARGET_API-nm
fi

if [ ! -f $TOOLCHAIN/bin/$TARGET$TARGET_API-ranlib ];then
ln -s $TOOLCHAIN/bin/llvm-ar $TOOLCHAIN/bin/$TARGET$TARGET_API-ranlib
fi

echo "---------------------------"
echo " &gt; start to build ARM64."
echo "---------------------------"

cd $CURRENT_PATH/build/android

cmake -DCMAKE_TOOLCHAIN_FILE=$NDKROOT_PATH/build/cmake/android.toolchain.cmake \
	-DCMAKE_INSTALL_PREFIX=$PREFIX \
	-DANDROID_ABI=$TARGET_ABI \
	-DANDROID_NATIVE_API_LEVEL=$TARGET_API \
	-DCMAKE_BUILD_TYPE=Release\
	-DANDROID_TOOLCHAIN=clang \
	-Dprotobuf_BUILD_TESTS=OFF \
	-Dprotobuf_BUILD_SHARED_LIBS=ON \
	../../cmake/
#-DANDROID_PLATFORM=$TARGET_ANDROID_PLATFORM
#如果编译静态库，则拿掉该项配置
#-Dprotobuf_BUILD_SHARED_LIBS=ON
make
make install

echo "---------------------------"
echo " &gt;   build finished."
echo "---------------------------"
cd $CURRENT_PATH</code></pre> 
<h3>3.2 QNX交叉编译脚本</h3> 
<p><strong>build_qnx.sh</strong></p> 
<pre><code class="language-bash">#!/bin/sh
###################################
#### build script for protobuf
#### taget:qnx
#### Date: 2022-11-01
#### Author: 村里小码农
###################################

# qnx tools dir
QNX_TOOLS_PATH=/workspace/tools/prebuilt_QNX700
# current dir
CURRENT_PATH=$(pwd)
#
TARGET_ABI=aarch64le
#
PREFIX=$CURRENT_PATH/build/qnx/$TARGET_ABI


if [ -d $PREFIX ];then
rm -rf $PREFIX
mkdir -p $PREFIX
else
mkdir -p $PREFIX
fi

export QNX_CONFIGURATION=$QNX_TOOLS_PATH/.qnx
export QNX_TARGET=$QNX_TOOLS_PATH/target/qnx7
export QNX_HOST=$QNX_TOOLS_PATH/host/linux/x86_64
export MAKEFLAGS=-I$QNX_TOOLS_PATH/target/qnx7/usr/include
export MAKELDFLAGS=-L$QNX_TOOLS_PATH/target/qnx7/usr/lib,-L$QNX_TOOLS_PATH/target/qnx7/aarch64le/lib

#QNX_TOOLCHAINS_CC64=$QNX_TOOLS_PATH/host/linux/x86_64/usr/bin/ntoaarch64-gcc
#QNX_TOOLCHAINS_CXX64=$QNX_TOOLS_PATH/host/linux/x86_64/usr/bin/ntoaarch64-g++
#use aarch64-unknown-nto-qnx7.0.0
QNX_TOOLCHAINS_CC64=$QNX_TOOLS_PATH/host/linux/x86_64/usr/bin/aarch64-unknown-nto-qnx7.0.0-gcc
QNX_TOOLCHAINS_CXX64=$QNX_TOOLS_PATH/host/linux/x86_64/usr/bin/aarch64-unknown-nto-qnx7.0.0-g++

echo "---------------------------"
echo " &gt; start to build ARM64."
echo "---------------------------"
	
./configure --prefix=$PREFIX \
	--host=aarch64-unknown-nto-qnx7.0.0 \
	--build=x86_64-pc-linux \
	CC=$QNX_TOOLCHAINS_CC64 \
	CXX=$QNX_TOOLCHAINS_CXX64 \
	CPPFLAGS='-D_XOPEN_SOURCE=500'
#--disable-shared
	
make -j12
make install

echo "---------------------------"
echo " &gt;   build finished."
echo "---------------------------"

cd $CURRENT_PATH
</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7f1fe23c429968df1c11c5618fa1b073/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Debian9.12镜像下载及网络、软件源配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f8f3524ceb2bb1bcefb85085c3246cd7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Pycharm中安装package</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>