<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>VS2022 CMake报错解决小结 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="VS2022 CMake报错解决小结" />
<meta property="og:description" content="目录
一、问题背景
二、问题分析
三、问题解决
一、问题背景 VS2022中能够跨平台的工程类型就是CMake项目，一套代码能跨windows/Linux/Mac多种操作系统。而实际使用时，发现相关资料比较少，需要摸索一下。
碰到的问题简述：
1、C&#43;&#43; Intellisense信息可能过时，生成要刷新的CMake缓存。
2、多次定义了变量 CMAKE_INSTALL_PREFIX
3、CMake Error: CMake was unable to find a build program corresponding to &#34;Ninja&#34;. CMAKE_MAKE_PROGRAM is not set. You probably need to select a different build tool. 4、CMake Error: CMAKE_CXX_COMPILER not set, after EnableLanguage 5、CMake Error: CMAKE_C_COMPILER not set, after EnableLanguage 二、问题分析 CMake工程中最重要的文件就是CMakeLists文件，其包含工程所有需要的元素，例如下面这个demo。直接用CMakeLists会觉得难用；但用了makefile再用这个就觉得CMakeLists十分友好了。
# CMakeList.txt: CMakeProject1 的 CMake 项目，在此处包括源代码并定义 # 项目特定的逻辑。 # cmake_minimum_required (VERSION 3.8) # 如果支持，请为 MSVC 编译器启用热重载。 if (POLICY CMP0141) cmake_policy(SET CMP0141 NEW) set(CMAKE_MSVC_DEBUG_INFORMATION_FORMAT &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/0ff34c78fb0a22aeaf9a1db5bab2e362/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-17T16:19:06+08:00" />
<meta property="article:modified_time" content="2023-08-17T16:19:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">VS2022 CMake报错解决小结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF" rel="nofollow">一、问题背景</a></p> 
<p style="margin-left:0px;"><a href="#%C2%A0%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90" rel="nofollow">二、问题分析</a></p> 
<p id="%E4%B8%89%E3%80%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3" rel="nofollow">三、问题解决</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF">一、问题背景</h2> 
<p>       VS2022中能够跨平台的工程类型就是CMake项目，一套代码能跨windows/Linux/Mac多种操作系统。而实际使用时，发现相关资料比较少，需要摸索一下。</p> 
<p><img alt="" height="635" src="https://images2.imgbox.com/89/e2/MbUJEacy_o.png" width="1011"></p> 
<p> 碰到的问题简述：</p> 
<p><img alt="" height="675" src="https://images2.imgbox.com/37/a2/7rFDKIiW_o.png" width="817"></p> 
<p> </p> 
<blockquote> 
 <p>1、C++ Intellisense信息可能过时，生成要刷新的CMake缓存。</p> 
 <p>2、多次定义了变量 CMAKE_INSTALL_PREFIX</p> 
 <p>3、CMake Error: CMake was unable to find a build program corresponding to "Ninja".  CMAKE_MAKE_PROGRAM is not set.  You probably need to select a different build tool.  4、CMake Error: CMAKE_CXX_COMPILER not set, after EnableLanguage    </p> 
 <p>5、CMake Error: CMAKE_C_COMPILER not set, after EnableLanguage         </p> 
</blockquote> 
<p></p> 
<h3 id="%C2%A0%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"> 二、问题分析</h3> 
<p>CMake工程中最重要的文件就是CMakeLists文件，其包含工程所有需要的元素，例如下面这个demo。直接用CMakeLists会觉得难用；但用了makefile再用这个就觉得CMakeLists十分友好了。</p> 
<pre><code class="language-bash"># CMakeList.txt: CMakeProject1 的 CMake 项目，在此处包括源代码并定义
# 项目特定的逻辑。
#
cmake_minimum_required (VERSION 3.8)

# 如果支持，请为 MSVC 编译器启用热重载。
if (POLICY CMP0141)
  cmake_policy(SET CMP0141 NEW)
  set(CMAKE_MSVC_DEBUG_INFORMATION_FORMAT "$&lt;IF:$&lt;AND:$&lt;C_COMPILER_ID:MSVC&gt;,$&lt;CXX_COMPILER_ID:MSVC&gt;&gt;,$&lt;$&lt;CONFIG:Debug,RelWithDebInfo&gt;:EditAndContinue&gt;,$&lt;$&lt;CONFIG:Debug,RelWithDebInfo&gt;:ProgramDatabase&gt;&gt;")
endif()

project ("CMakeProject1")

# 将源代码添加到此项目的可执行文件。
add_executable (CMakeProject1 "CMakeProject1.cpp" "CMakeProject1.h")

if (CMAKE_VERSION VERSION_GREATER 3.12)
  set_property(TARGET CMakeProject1 PROPERTY CXX_STANDARD 20)
endif()

# TODO: 如有需要，请添加测试并安装目标。
</code></pre> 
<p>如果上面的demo看不懂，建议先恶补一下，不然下面的内容会比较吃力。</p> 
<p>VS创建CMake工程时，默认会创建一个CMakePresets.json文件。</p> 
<p><img alt="" height="632" src="https://images2.imgbox.com/ba/f8/s1ECaItS_o.png" width="880"></p> 
<p> 例如本地计算机的x64-Debug工程属性由下面的json片段来描述。这个片段把CMake要用的c/c++编译器进行了定义（cl.exe）。</p> 
<pre><code class="language-bash">       {
            "name": "windows-base",
            "hidden": true,
            "generator": "Ninja",
            "binaryDir": "${sourceDir}/out/build/${presetName}",
            "installDir": "${sourceDir}/out/install/${presetName}",
            "cacheVariables": {
                "CMAKE_C_COMPILER": "cl.exe",
                "CMAKE_CXX_COMPILER": "cl.exe"
            },
            "condition": {
                "type": "equals",
                "lhs": "${hostSystemName}",
                "rhs": "Windows"
            }
        },
        {
            "name": "x64-debug",
            "displayName": "x64 Debug",
            "inherits": "windows-base",
            "architecture": {
                "value": "x64",
                "strategy": "external"
            },
            "cacheVariables": {
                "CMAKE_BUILD_TYPE": "Debug"
            }
        }</code></pre> 
<p>然而，这个json文件对于linux和mac的描述则不完整，以下为linux-debug工程属性，其中对c/c++编译器没有定义。</p> 
<pre><code class="language-bash">{
    "name": "linux-debug",
    "displayName": "Linux Debug",
    "generator": "Ninja",
    "binaryDir": "${sourceDir}/out/build/${presetName}",
    "installDir": "${sourceDir}/out/install/${presetName}",
    "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Debug"
    },
    "condition": {
        "type": "equals",
        "lhs": "${hostSystemName}",
        "rhs": "Linux"
    },
    "vendor": {
        "microsoft.com/VisualStudioRemoteSettings/CMake/1.0": {
            "sourceDir": "$env{HOME}/.vs/$ms{projectDirName}"
        }
    }
}</code></pre> 
<p>这就是把本地计算机工程改为远程Linux工程时，vs报错的原因了。猜想vs的开发工程师在做这个功能时，只针对本地window环境编写了完整的CMakePresets.json，而针对其他平台只写了一段参考，其实现并不完整，需要用户手动配置缺失部分。例如，配置Linux系统中CMake用到的c/c++编译器，Ninjia路径等。可以参考一下官方的文档</p> 
<p><a href="https://learn.microsoft.com/zh-cn/cpp/build/cmake-presets-vs?view=msvc-170" rel="nofollow" title="使用 CMake 预设进行配置和生成 | Microsoft Learn">使用 CMake 预设进行配置和生成 | Microsoft Learn</a></p> 
<h2></h2> 
<h2 id="%E4%B8%89%E3%80%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3">三、问题解决</h2> 
<p>有了第二部分的分析，解决问题的思路就有了，把相关的配置补充完整。</p> 
<p>首先，补充c/c++编译器，linux机器上已经装了gcc/g++，直接填好就可以了。</p> 
<p>（如果没有安装需要在linux安装一下 apt install gcc g++）</p> 
<pre><code class="language-bash">        {
            "name": "linux-debug",
            "displayName": "Linux Debug",
            "generator": "Ninja",
            "binaryDir": "${sourceDir}/out/build/${presetName}",
            "installDir": "${sourceDir}/out/install/${presetName}",
          "cacheVariables": {
            "CMAKE_BUILD_TYPE": "Debug",
            "CMAKE_C_COMPILER": "gcc",
            "CMAKE_CXX_COMPILER": "g++"
          }</code></pre> 
<p>改了以后，这两个报错没有了。</p> 
<blockquote> 
 <p>4、CMake Error: CMAKE_CXX_COMPILER not set, after EnableLanguage    </p> 
 <p>5、CMake Error: CMAKE_C_COMPILER not set, after EnableLanguage  </p> 
</blockquote> 
<p><img alt="" height="693" src="https://images2.imgbox.com/5e/05/suEcA7YQ_o.png" width="734"></p> 
<p> 上面的错误显示查询ninja版本号时失败了。装一个ninja：</p> 
<pre><code class="language-bash">sudo apt install ninja-build</code></pre> 
<p>安装完成后，回到vs中，按ctrl+S，保存工程时，会自动再次构建工程，发现构建成功。</p> 
<p><img alt="" height="297" src="https://images2.imgbox.com/77/70/K6fXlNB7_o.png" width="586"></p> 
<p>最后，虽然构建成功了，实际上有个错误最后还是没有解决，即使它不影响工程的构建结果。</p> 
<blockquote> 
 <p>多次定义了变量 CMAKE_INSTALL_PREFIX</p> 
</blockquote> 
<p>从构建日志看出，CMAKE_INSTALL_PREFIX，确实定义了两次。感觉这就是vs的一个bug，有博友知道如何解决，请评论告知，十分感谢。</p> 
<blockquote> 
 <p>/usr/bin/cmake -G "Ninja"   -DCMAKE_BUILD_TYPE:STRING="Debug" -DCMAKE_C_COMPILER:STRING="gcc" -DCMAKE_CXX_COMPILER:STRING="g++" -DCMAKE_INSTALL_PREFIX:PATH="/root/.vs/CMakeProject1/out/install/linux-debug"   -DCMAKE_INSTALL_PREFIX:PATH="/root/.vs/CMakeProject1/out/install/linux-debug"  /root/.vs/CMakeProject1/CMakeLists.txt</p> 
</blockquote> 
<p></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0666590eefcff522c167b943e3733f18/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Monodepth2和Lite-Mono准备数据集</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/11d2ccb5dcd047fe3860159894465b53/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【报错解决-Golang】go mod 替换第三方包提示：module declares its path as: ××× but was required as: ×××</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>