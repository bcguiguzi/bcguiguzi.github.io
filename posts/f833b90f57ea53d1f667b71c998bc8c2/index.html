<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>海康威视相机SDK二次开发（JAVA语言） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="海康威视相机SDK二次开发（JAVA语言）" />
<meta property="og:description" content="目录 前言客户端创建虚拟相机示例代码保存图片程序运行结果修改需求 二次开发引入外部包对SaveImage.java文件进行修改保存图片saveDataToFile方法选择相机chooseCamera方法主方法 FileUtil类处理过期照片启动类与配置文件application.yml通过实体类读取yml启动类 SaveImage.java类全部代码 运行结果 前言 有个项目需要使用java程序读取海康威视的相机图片。相机通过以太网连接服务器，部署在服务器上的java程序将相机拍摄的画面保存在指定路径下。
海康威视提供了sdk开发包，可以在官网中下载，windows和linux系统都有。但是开发包中给出的示例代码，无法满足实际需要，所以还需要对代码进行二次开发。
在进行二次开发时，官网并未提供java语言的开发手册，示例代码中也并未提供详细注释，所以我只能在阅读示例代码时，按照自己的理解添加一些注释。
客户端创建虚拟相机 实体相机已经还回去了，所以这里用MVS客户端创建一个虚拟相机，测试代码。
设置相机名字
示例代码 我这里只需要对保存照片的代码进行修改。
以下是官网提供的保存照片的代码
我在示例代码中对一些方法做了注释
保存图片程序 /*************************************************************************************************** * @file SaveImage.java * @breif Use functions provided in MvCameraControlWrapper.jar to save image as JPEG。 * @author zhanglei72 * @date 2020/02/10 * * @warning * @version V1.0.0 2020/02/10 Create this file * @since 2020/02/10 **************************************************************************************************/ import java.io.*; import java.util.ArrayList; import java.util.Arrays; import java.util.Scanner; import MvCameraControlWrapper.*; import static MvCameraControlWrapper.MvCameraControl.*; import static MvCameraControlWrapper." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/f833b90f57ea53d1f667b71c998bc8c2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-14T15:40:23+08:00" />
<meta property="article:modified_time" content="2024-03-14T15:40:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">海康威视相机SDK二次开发（JAVA语言）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_2" rel="nofollow">前言</a></li><li><a href="#_7" rel="nofollow">客户端创建虚拟相机</a></li><li><a href="#_14" rel="nofollow">示例代码</a></li><li><ul><li><a href="#_18" rel="nofollow">保存图片程序</a></li><li><a href="#_354" rel="nofollow">运行结果</a></li><li><a href="#_358" rel="nofollow">修改需求</a></li></ul> 
    </li><li><a href="#_360" rel="nofollow">二次开发</a></li><li><ul><li><a href="#_367" rel="nofollow">引入外部包</a></li><li><a href="#SaveImagejava_404" rel="nofollow">对SaveImage.java文件进行修改</a></li><li><ul><li><a href="#saveDataToFile_408" rel="nofollow">保存图片saveDataToFile方法</a></li><li><a href="#chooseCamera_441" rel="nofollow">选择相机chooseCamera方法</a></li><li><a href="#_485" rel="nofollow">主方法</a></li></ul> 
     </li><li><a href="#FileUtil_536" rel="nofollow">FileUtil类处理过期照片</a></li><li><a href="#_564" rel="nofollow">启动类与配置文件</a></li><li><ul><li><a href="#applicationyml_565" rel="nofollow">application.yml</a></li><li><a href="#yml_573" rel="nofollow">通过实体类读取yml</a></li><li><a href="#_611" rel="nofollow">启动类</a></li></ul> 
     </li><li><a href="#SaveImagejava_634" rel="nofollow">SaveImage.java类全部代码</a></li></ul> 
    </li><li><a href="#_919" rel="nofollow">运行结果</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_2"></a>前言</h4> 
<p>有个项目需要使用java程序读取海康威视的相机图片。相机通过以太网连接服务器，部署在服务器上的java程序将相机拍摄的画面保存在指定路径下。<br> 海康威视提供了sdk开发包，可以在官网中下载，windows和linux系统都有。但是开发包中给出的示例代码，无法满足实际需要，所以还需要对代码进行二次开发。<br> 在进行二次开发时，官网并未提供java语言的开发手册，示例代码中也并未提供详细注释，所以我只能在阅读示例代码时，按照自己的理解添加一些注释。</p> 
<h4><a id="_7"></a>客户端创建虚拟相机</h4> 
<p>实体相机已经还回去了，所以这里用MVS客户端创建一个虚拟相机，测试代码。<br> <img src="https://images2.imgbox.com/e2/4e/HEvJlKZc_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c6/d1/vQf6CSWU_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>设置相机名字</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/03/95/iT9W1Ziq_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_14"></a>示例代码</h4> 
<p>我这里只需要对保存照片的代码进行修改。<br> 以下是官网提供的保存照片的代码<br> <b>我在示例代码中对一些方法做了注释</b></p> 
<h5><a id="_18"></a>保存图片程序</h5> 
<pre><code class="prism language-java"><span class="token comment">/***************************************************************************************************
 * @file      SaveImage.java
 * @breif     Use functions provided in MvCameraControlWrapper.jar to save image as JPEG。
 * @author    zhanglei72
 * @date      2020/02/10
 *
 * @warning  
 * @version   V1.0.0  2020/02/10 Create this file
 * @since     2020/02/10
 **************************************************************************************************/</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token class-name">MvCameraControlWrapper</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token class-name">MvCameraControlWrapper</span><span class="token punctuation">.</span><span class="token class-name">MvCameraControl</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token class-name">MvCameraControlWrapper</span><span class="token punctuation">.</span><span class="token class-name">MvCameraControlDefines</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaveImage</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/**
	* 打印连接的设备信息
	* 如果是通过以太网连接的相机，则会输出ip、名称等内容
	* 如果是通过usb连接的相机，则会输出相机名称
	*/</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printDeviceInfo</span><span class="token punctuation">(</span><span class="token class-name">MV_CC_DEVICE_INFO</span> stDeviceInfo<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> stDeviceInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"stDeviceInfo is null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stDeviceInfo<span class="token punctuation">.</span>transportLayerType <span class="token operator">==</span> <span class="token constant">MV_GIGE_DEVICE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tCurrentIp:       "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>gigEInfo<span class="token punctuation">.</span>currentIp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tModel:           "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>gigEInfo<span class="token punctuation">.</span>modelName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tUserDefinedName: "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>gigEInfo<span class="token punctuation">.</span>userDefinedName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>stDeviceInfo<span class="token punctuation">.</span>transportLayerType <span class="token operator">==</span> <span class="token constant">MV_USB_DEVICE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tUserDefinedName: "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>usb3VInfo<span class="token punctuation">.</span>userDefinedName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tSerial Number:   "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>usb3VInfo<span class="token punctuation">.</span>serialNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tDevice Number:   "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>usb3VInfo<span class="token punctuation">.</span>deviceNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Device is not supported! \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tAccessible:      "</span>
            <span class="token operator">+</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_IsDeviceAccessible</span><span class="token punctuation">(</span>stDeviceInfo<span class="token punctuation">,</span> <span class="token class-name">MV_ACCESS_Exclusive</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printFrameInfo</span><span class="token punctuation">(</span><span class="token class-name">MV_FRAME_OUT_INFO</span> stFrameInfo<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> stFrameInfo<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"stFrameInfo is null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token class-name">StringBuilder</span> frameInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        frameInfo<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"\tFrameNum["</span> <span class="token operator">+</span> stFrameInfo<span class="token punctuation">.</span>frameNum <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        frameInfo<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\tWidth["</span> <span class="token operator">+</span> stFrameInfo<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        frameInfo<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\tHeight["</span> <span class="token operator">+</span> stFrameInfo<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        frameInfo<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"\tPixelType[%#x]"</span><span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>pixelType<span class="token punctuation">.</span><span class="token function">getnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>frameInfo<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">/**
	* 保存图片到本地
	* 这个方法中主要是设置了文件保存的路径
	*/</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveDataToFile</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dataToSave<span class="token punctuation">,</span> <span class="token keyword">int</span> dataSize<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">OutputStream</span> os <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Create directory</span>
            <span class="token class-name">File</span> tempFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"dat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tempFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
            <span class="token punctuation">{<!-- --></span>
                tempFile<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            os <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>tempFile<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>dataToSave<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dataSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SaveImage succeed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Close file stream</span>
            <span class="token keyword">try</span> 
            <span class="token punctuation">{<!-- --></span>
                os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> 
            <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
    * 当有多个相机连接但程序只能保存一台相机拍摄的照片
    * 所以需要通过此方法输入相机索引号
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">chooseCamera</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span>MV_CC_DEVICE_INFO<span class="token punctuation">&gt;</span></span> stDeviceList<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> stDeviceList<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// Choose a device to operate</span>
        <span class="token keyword">int</span> camIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
            	<span class="token comment">/*
            	* 手动输入
            	*/</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Please input camera index (-1 to quit):"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                camIndex <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>camIndex <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> camIndex <span class="token operator">&lt;</span> stDeviceList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> camIndex<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Input error: "</span> <span class="token operator">+</span> camIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                camIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        scanner<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> camIndex<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Bye."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> camIndex<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> camIndex <span class="token operator">&amp;&amp;</span> stDeviceList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> camIndex<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_GIGE_DEVICE</span> <span class="token operator">==</span> stDeviceList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>transportLayerType<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connect to camera["</span> <span class="token operator">+</span> camIndex <span class="token operator">+</span> <span class="token string">"]: "</span> <span class="token operator">+</span> stDeviceList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>gigEInfo<span class="token punctuation">.</span>userDefinedName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_USB_DEVICE</span> <span class="token operator">==</span> stDeviceList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>transportLayerType<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connect to camera["</span> <span class="token operator">+</span> camIndex <span class="token operator">+</span> <span class="token string">"]: "</span> <span class="token operator">+</span> stDeviceList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>usb3VInfo<span class="token punctuation">.</span>userDefinedName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Device is not supported."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Invalid index "</span> <span class="token operator">+</span> camIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            camIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> camIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">/**
	* 主方法
	* 保存照片的代码在这里
	*/</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> nRet <span class="token operator">=</span> <span class="token constant">MV_OK</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> camIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">Handle</span> hCamera <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span>MV_CC_DEVICE_INFO<span class="token punctuation">&gt;</span></span> stDeviceList<span class="token punctuation">;</span>

        <span class="token keyword">do</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SDK Version "</span> <span class="token operator">+</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_GetSDKVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Enuerate GigE and USB devices </span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                stDeviceList <span class="token operator">=</span> <span class="token class-name">MV_CC_EnumDevices</span><span class="token punctuation">(</span><span class="token constant">MV_GIGE_DEVICE</span> <span class="token operator">|</span> <span class="token constant">MV_USB_DEVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&gt;=</span> stDeviceList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"No devices found!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token constant">MV_CC_DEVICE_INFO</span> stDeviceInfo <span class="token operator">:</span> stDeviceList<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"[camera "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">printDeviceInfo</span><span class="token punctuation">(</span>stDeviceInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CameraControlException</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Enumrate devices failed!"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// choose camera</span>
            camIndex <span class="token operator">=</span> <span class="token function">chooseCamera</span><span class="token punctuation">(</span>stDeviceList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>camIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Create handle</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                hCamera <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_CreateHandle</span><span class="token punctuation">(</span>stDeviceList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CameraControlException</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Create handle failed!"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                hCamera <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Open device</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_OpenDevice</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Connect to camera failed, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Make sure that trigger mode is off</span>
            <span class="token comment">/*
            * 设置相机的触发器开关 Off On
            */</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_SetEnumValueByString</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">,</span> <span class="token string">"TriggerMode"</span><span class="token punctuation">,</span> <span class="token string">"Off"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SetTriggerMode failed, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Get payload size</span>
            <span class="token class-name">MVCC_INTVALUE</span> stParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MVCC_INTVALUE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_GetIntValue</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">,</span> <span class="token string">"PayloadSize"</span><span class="token punctuation">,</span> stParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Get PayloadSize fail, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Start grabbing</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_StartGrabbing</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Start Grabbing fail, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Get one frame</span>
            <span class="token class-name">MV_FRAME_OUT_INFO</span> stImageInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MV_FRAME_OUT_INFO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>stParam<span class="token punctuation">.</span>curValue<span class="token punctuation">]</span><span class="token punctuation">;</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_GetOneFrameTimeout</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">,</span> pData<span class="token punctuation">,</span> stImageInfo<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"GetOneFrameTimeout fail, errcode:[%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"GetOneFrame: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printFrameInfo</span><span class="token punctuation">(</span>stImageInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> imageLen <span class="token operator">=</span> stImageInfo<span class="token punctuation">.</span>width <span class="token operator">*</span> stImageInfo<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token comment">// Every RGB pixel takes 3 bytes</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> imageBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>imageLen<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token comment">// Call MV_CC_SaveImage to save image as JPEG</span>
            <span class="token class-name">MV_SAVE_IMAGE_PARAM</span> stSaveParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MV_SAVE_IMAGE_PARAM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stSaveParam<span class="token punctuation">.</span>width <span class="token operator">=</span> stImageInfo<span class="token punctuation">.</span>width<span class="token punctuation">;</span>                                  <span class="token comment">// image width</span>
            stSaveParam<span class="token punctuation">.</span>height <span class="token operator">=</span> stImageInfo<span class="token punctuation">.</span>height<span class="token punctuation">;</span>                                <span class="token comment">// image height</span>
            stSaveParam<span class="token punctuation">.</span>data <span class="token operator">=</span> pData<span class="token punctuation">;</span>                                               <span class="token comment">// image data</span>
            stSaveParam<span class="token punctuation">.</span>dataLen <span class="token operator">=</span> stImageInfo<span class="token punctuation">.</span>frameLen<span class="token punctuation">;</span>                             <span class="token comment">// image data length</span>
            stSaveParam<span class="token punctuation">.</span>pixelType <span class="token operator">=</span> stImageInfo<span class="token punctuation">.</span>pixelType<span class="token punctuation">;</span>                          <span class="token comment">// image pixel format</span>
            stSaveParam<span class="token punctuation">.</span>imageBuffer <span class="token operator">=</span> imageBuffer<span class="token punctuation">;</span>                                  <span class="token comment">// output image buffer</span>
            stSaveParam<span class="token punctuation">.</span>imageType <span class="token operator">=</span> <span class="token class-name">MV_SAVE_IAMGE_TYPE<span class="token punctuation">.</span>MV_Image_Jpeg</span><span class="token punctuation">;</span>               <span class="token comment">// output image pixel format</span>
            stSaveParam<span class="token punctuation">.</span>methodValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                                            <span class="token comment">// Interpolation method that converts Bayer format to RGB24.  0-Neareast 1-double linear 2-Hamilton</span>
            stSaveParam<span class="token punctuation">.</span>jpgQuality <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>                                            <span class="token comment">// JPG endoding quality(50-99]</span>

            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_SaveImage</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">,</span> stSaveParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SaveImage fail, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Save buffer content to file</span>
            <span class="token comment">/*
            * 将照片保存在本地，且在这里指定文件的名称
            */</span>
            <span class="token function">saveDataToFile</span><span class="token punctuation">(</span>imageBuffer<span class="token punctuation">,</span> stSaveParam<span class="token punctuation">.</span>imageLen<span class="token punctuation">,</span> <span class="token string">"SaveImage.jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Stop grabbing</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_StopGrabbing</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"StopGrabbing fail, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> hCamera<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Destroy handle</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_DestroyHandle</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"DestroyHandle failed, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h5><a id="_354"></a>运行结果</h5> 
<p><img src="https://images2.imgbox.com/57/b9/JT1WWhQv_o.png" alt="在这里插入图片描述"><br> 程序启动后，在控制台输出可连接的所有相机，用户输入相机索引号连接指定相机。[Camera 0]表示索引号为0。然后相机自动进行拍摄。<br> <img src="https://images2.imgbox.com/39/1f/afKVD0q9_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_358"></a>修改需求</h5> 
<p>通过运行程序，发现直接使用示例代码，无法满足实际使用需求。无法做到，图片保存名称不重复、图片保存路径无法自定义、需要用户手动输入相机索引号、对于指定日期以前的旧照片删除等等。</p> 
<h4><a id="_360"></a>二次开发</h4> 
<p>首先记录对核心代码的修改内容，然后再将所有代码都列出来。<br> 我这里使用了Springboot框架，为的是通过application.yml文件配置路径等数量，另外使用maven架构，方便打包。<br> <img src="https://images2.imgbox.com/93/79/0uIHssKa_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>SaveImage为核心代码类<br> FileUtil用来删除过期照片<br> ApplicationYml用来读取yml文件中的配置</p> 
</blockquote> 
<h5><a id="_367"></a>引入外部包</h5> 
<p>在进行二次开发前，还需要引入官网提供的下载包。<br> <img src="https://images2.imgbox.com/30/84/FIwXmNjc_o.png" alt="在这里插入图片描述"><br> 创建lib文件夹，将jar放入后，右击，Add as library。<br> 在pom.xml文件中引入依赖</p> 
<pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.hzx.testmaven34hikvision<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>MvCameraControlWrapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>system<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>systemPath</span><span class="token punctuation">&gt;</span></span>${project.basedir}/lib/MvCameraControlWrapper.jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>systemPath</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fork</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fork</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeSystemScope</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeSystemScope</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
                     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-surefire-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skip</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skip</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h5><a id="SaveImagejava_404"></a>对SaveImage.java文件进行修改</h5> 
<p>这里先对照着示例代码，将修改的地方列举出来。全部代码后面给出。<br> 示例代码中一些无关紧要的输出内容，在二次开发时注释掉了，这里就不再详细说明。<br> 修改的地方，通过注释标出</p> 
<h6><a id="saveDataToFile_408"></a>保存图片saveDataToFile方法</h6> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveDataToFile</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dataToSave<span class="token punctuation">,</span> <span class="token keyword">int</span> dataSize<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">,</span><span class="token class-name">String</span> savePath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">OutputStream</span> os <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Create directory</span>
           	<span class="token comment">/*
           	* savePath参数为图片保存路径，在调用方法时通过参数传入
           	*/</span>
            <span class="token class-name">File</span> tempFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>savePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tempFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                tempFile<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            os <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>tempFile<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>dataToSave<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dataSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/*
            * 图片保存成功后，输出当前时间
            */</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--- "</span> <span class="token operator">+</span> sfTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" Save Image succeed ---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Close file stream</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h6><a id="chooseCamera_441"></a>选择相机chooseCamera方法</h6> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">chooseCamera</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span>MV_CC_DEVICE_INFO<span class="token punctuation">&gt;</span></span> stDeviceList<span class="token punctuation">,</span><span class="token keyword">int</span> camIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> stDeviceList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Choose a device to operate</span>
        <span class="token comment">//int camIndex = -1;</span>
        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">/*
                * 原本需要用户输入的camIndex（相机索引），修改为调用方法时传参
                * 实际值从yml文件中获取
                */</span>
                <span class="token comment">//System.out.print("Please input camera index (-1 to quit):");</span>
                <span class="token comment">//camIndex = scanner.nextInt();</span>
                <span class="token comment">//camIndex = 1;</span>
                
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>camIndex <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> camIndex <span class="token operator">&lt;</span> stDeviceList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> camIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// System.out.println("自动连接 [camera 0]");</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Input error: "</span> <span class="token operator">+</span> camIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    camIndex<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                camIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        scanner<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
		<span class="token comment">/**
		* 未修改代码省略
		*/</span>
    <span class="token punctuation">}</span>

</code></pre> 
<h6><a id="_485"></a>主方法</h6> 
<p>这里已经不是main方法了，因为使用springboot所以有了StartApplication类</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">mainImage</span><span class="token punctuation">(</span><span class="token class-name">String</span> savePath<span class="token punctuation">,</span><span class="token class-name">Integer</span> deleteDay<span class="token punctuation">,</span><span class="token keyword">int</span> camIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> nRet <span class="token operator">=</span> <span class="token constant">MV_OK</span><span class="token punctuation">;</span>
        <span class="token comment">// int camIndex = -1;</span>
        <span class="token class-name">Handle</span> hCamera <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span>MV_CC_DEVICE_INFO<span class="token punctuation">&gt;</span></span> stDeviceList<span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> needConnectDevice <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Make sure that trigger mode is off</span>
            <span class="token comment">/*
            * 设置拍照触发器开关 出发模式需要到mvs客户端中为相机设置
            * 这里需要把MvCameraControl.MV_CC_SetEnumValueByString()方法第三个参数从Off改为On
            */</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_SetEnumValueByString</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">,</span> <span class="token string">"TriggerMode"</span><span class="token punctuation">,</span> <span class="token string">"On"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SetTriggerMode failed, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_SaveImage</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">,</span> stSaveParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//System.err.printf("SaveImage fail, errcode: [%#x]\n", nRet);</span>
                <span class="token comment">// System.out.println(sfTime.format(new Date())+" "+ nRet + " No Image Need Save...");</span>
                <span class="token comment">// break;</span>
                <span class="token comment">//continue;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>

                <span class="token comment">// 保存照片的方法 Save buffer content to file</span>
                <span class="token comment">/**
                * 在这里设置照片的保存路径
                */</span>
                <span class="token class-name">String</span> savePathFull <span class="token operator">=</span> savePath<span class="token operator">+</span> sfSave<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span><span class="token string">"camera"</span><span class="token operator">+</span>camIndex<span class="token operator">+</span><span class="token string">"/"</span><span class="token punctuation">;</span>
                <span class="token function">saveDataToFile</span><span class="token punctuation">(</span>imageBuffer<span class="token punctuation">,</span> stSaveParam<span class="token punctuation">.</span>imageLen<span class="token punctuation">,</span> <span class="token string">"SaveImage-"</span> <span class="token operator">+</span> sfSecond<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">".jpeg"</span><span class="token punctuation">,</span>savePathFull<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">/* 
                * 有新图片保存时，删除X天前保存图片的文件夹
                * X的实际值，通过参数传入
                */</span>
                <span class="token class-name">Calendar</span> calendar <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                calendar<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// X天前的日期</span>
                calendar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span>deleteDay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> deleteFile <span class="token operator">=</span> savePath<span class="token operator">+</span>sfSave<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>calendar<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/"</span><span class="token punctuation">;</span>
                <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">deleteAllFile</span><span class="token punctuation">(</span>deleteFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h5><a id="FileUtil_536"></a>FileUtil类处理过期照片</h5> 
<p>这里使用递归，删除保存的照片</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUtil</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">deleteAllFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> dir<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">File</span> dirFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 判断dir是否是目录且dir是否存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dirFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token operator">!</span>dirFile<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// System.out.println("目录："+dir+" 不存在");</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 删除文件夹中所有的文件，包括子文件夹</span>
        <span class="token class-name">File</span><span class="token punctuation">[</span><span class="token punctuation">]</span> files <span class="token operator">=</span> dirFile<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果是文件直接删除</span>
                files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果是目录，则通过递归删除</span>
                <span class="token function">deleteAllFile</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 最后删除当前文件夹</span>
        dirFile<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_564"></a>启动类与配置文件</h5> 
<h6><a id="applicationyml_565"></a>application.yml</h6> 
<pre><code class="prism language-yml"><span class="token key atrule">config-info</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>/JavaCode/testmaven34hikvision/catch<span class="token punctuation">-</span>image/ <span class="token comment">#图片保存路径</span>
  <span class="token key atrule">deleteDay</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment">#删除X天前的图片</span>
  <span class="token key atrule">connectCamera</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment">#连接相机编号</span>
</code></pre> 
<h6><a id="yml_573"></a>通过实体类读取yml</h6> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"config-info"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationYml</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> image<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> deleteDay<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> connectCamera<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ApplicationYml</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> image<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setImage</span><span class="token punctuation">(</span><span class="token class-name">String</span> image<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>image <span class="token operator">=</span> image<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDeleteDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> deleteDay<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDeleteDay</span><span class="token punctuation">(</span><span class="token class-name">String</span> deleteDay<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deleteDay <span class="token operator">=</span> deleteDay<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConnectCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> connectCamera<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConnectCamera</span><span class="token punctuation">(</span><span class="token class-name">String</span> connectCamera<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>connectCamera <span class="token operator">=</span> connectCamera<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_611"></a>启动类</h6> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartImage</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ApplicationYml</span> applicationYml<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationYml</span><span class="token punctuation">(</span><span class="token class-name">ApplicationYml</span> applicationYml<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>applicationYml <span class="token operator">=</span> applicationYml<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">StartImage</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"image: "</span><span class="token operator">+</span>applicationYml<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deleteDay: "</span><span class="token operator">+</span>applicationYml<span class="token punctuation">.</span><span class="token function">getDeleteDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"camera: "</span><span class="token operator">+</span>applicationYml<span class="token punctuation">.</span><span class="token function">getConnectCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> image <span class="token operator">=</span> applicationYml<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SaveImage</span><span class="token punctuation">.</span><span class="token function">mainImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>applicationYml<span class="token punctuation">.</span><span class="token function">getDeleteDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>applicationYml<span class="token punctuation">.</span><span class="token function">getConnectCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="SaveImagejava_634"></a>SaveImage.java类全部代码</h5> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaveImage</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SimpleDateFormat</span> sfSecond <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-M-d_HH-mm-dd-SSS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SimpleDateFormat</span> sfTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SimpleDateFormat</span> sfSave <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-M-d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printDeviceInfo</span><span class="token punctuation">(</span><span class="token class-name">MV_CC_DEVICE_INFO</span> stDeviceInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> stDeviceInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"stDeviceInfo is null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>stDeviceInfo<span class="token punctuation">.</span>transportLayerType <span class="token operator">==</span> <span class="token constant">MV_GIGE_DEVICE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tCurrentIp:       "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>gigEInfo<span class="token punctuation">.</span>currentIp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tModel:           "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>gigEInfo<span class="token punctuation">.</span>modelName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tUserDefinedName: "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>gigEInfo<span class="token punctuation">.</span>userDefinedName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>stDeviceInfo<span class="token punctuation">.</span>transportLayerType <span class="token operator">==</span> <span class="token constant">MV_USB_DEVICE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tUserDefinedName: "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>usb3VInfo<span class="token punctuation">.</span>userDefinedName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tSerial Number:   "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>usb3VInfo<span class="token punctuation">.</span>serialNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tDevice Number:   "</span> <span class="token operator">+</span> stDeviceInfo<span class="token punctuation">.</span>usb3VInfo<span class="token punctuation">.</span>deviceNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Device is not supported! \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tAccessible:      "</span> <span class="token operator">+</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_IsDeviceAccessible</span><span class="token punctuation">(</span>stDeviceInfo<span class="token punctuation">,</span> <span class="token class-name">MV_ACCESS_Exclusive</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printFrameInfo</span><span class="token punctuation">(</span><span class="token class-name">MV_FRAME_OUT_INFO</span> stFrameInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> stFrameInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"stFrameInfo is null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">StringBuilder</span> frameInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        frameInfo<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"\tFrameNum["</span> <span class="token operator">+</span> stFrameInfo<span class="token punctuation">.</span>frameNum <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        frameInfo<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\tWidth["</span> <span class="token operator">+</span> stFrameInfo<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        frameInfo<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\tHeight["</span> <span class="token operator">+</span> stFrameInfo<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        frameInfo<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"\tPixelType[%#x]"</span><span class="token punctuation">,</span> stFrameInfo<span class="token punctuation">.</span>pixelType<span class="token punctuation">.</span><span class="token function">getnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// System.out.println(frameInfo.toString());</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveDataToFile</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dataToSave<span class="token punctuation">,</span> <span class="token keyword">int</span> dataSize<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">,</span><span class="token class-name">String</span> savePath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">OutputStream</span> os <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Create directory</span>
            <span class="token comment">//File tempFile = new File(imagePathFun());</span>
            <span class="token class-name">File</span> tempFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>savePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tempFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                tempFile<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            os <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>tempFile<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>dataToSave<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dataSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--- "</span> <span class="token operator">+</span> sfTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" Save Image succeed ---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Close file stream</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">chooseCamera</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span>MV_CC_DEVICE_INFO<span class="token punctuation">&gt;</span></span> stDeviceList<span class="token punctuation">,</span><span class="token keyword">int</span> camIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> stDeviceList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Choose a device to operate</span>
        <span class="token comment">//int camIndex = -1;</span>
        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//System.out.print("Please input camera index (-1 to quit):");</span>
                <span class="token comment">//camIndex = scanner.nextInt();</span>
                <span class="token comment">//camIndex = 1;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>camIndex <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> camIndex <span class="token operator">&lt;</span> stDeviceList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> camIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// System.out.println("自动连接 [camera 0]");</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Input error: "</span> <span class="token operator">+</span> camIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    camIndex<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                camIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        scanner<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> camIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Bye."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> camIndex<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> camIndex <span class="token operator">&amp;&amp;</span> stDeviceList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> camIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_GIGE_DEVICE</span> <span class="token operator">==</span> stDeviceList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>transportLayerType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connect to camera["</span> <span class="token operator">+</span> camIndex <span class="token operator">+</span> <span class="token string">"]: "</span> <span class="token operator">+</span> stDeviceList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>gigEInfo<span class="token punctuation">.</span>userDefinedName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_USB_DEVICE</span> <span class="token operator">==</span> stDeviceList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>transportLayerType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connect to camera["</span> <span class="token operator">+</span> camIndex <span class="token operator">+</span> <span class="token string">"]: "</span> <span class="token operator">+</span> stDeviceList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">.</span>usb3VInfo<span class="token punctuation">.</span>userDefinedName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Device is not supported."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Invalid index "</span> <span class="token operator">+</span> camIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            camIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> camIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">mainImage</span><span class="token punctuation">(</span><span class="token class-name">String</span> savePath<span class="token punctuation">,</span><span class="token class-name">Integer</span> deleteDay<span class="token punctuation">,</span><span class="token keyword">int</span> camIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> nRet <span class="token operator">=</span> <span class="token constant">MV_OK</span><span class="token punctuation">;</span>
        <span class="token comment">// int camIndex = -1;</span>
        <span class="token class-name">Handle</span> hCamera <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span>MV_CC_DEVICE_INFO<span class="token punctuation">&gt;</span></span> stDeviceList<span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> needConnectDevice <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>needConnectDevice<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SDK Version "</span> <span class="token operator">+</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_GetSDKVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Enuerate GigE and USB devices</span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    stDeviceList <span class="token operator">=</span> <span class="token class-name">MV_CC_EnumDevices</span><span class="token punctuation">(</span><span class="token constant">MV_GIGE_DEVICE</span> <span class="token operator">|</span> <span class="token constant">MV_USB_DEVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&gt;=</span> stDeviceList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"No devices found!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token constant">MV_CC_DEVICE_INFO</span> stDeviceInfo <span class="token operator">:</span> stDeviceList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"[camera "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">printDeviceInfo</span><span class="token punctuation">(</span>stDeviceInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CameraControlException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Enumrate devices failed!"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// choose camera</span>
                camIndex <span class="token operator">=</span> <span class="token function">chooseCamera</span><span class="token punctuation">(</span>stDeviceList<span class="token punctuation">,</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>camIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Create handle</span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    hCamera <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_CreateHandle</span><span class="token punctuation">(</span>stDeviceList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>camIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CameraControlException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Create handle failed!"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    hCamera <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Open device</span>
                nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_OpenDevice</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Connect to camera failed, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                needConnectDevice <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">/*
            测试线路选择器
             */</span>

            <span class="token comment">// Make sure that trigger mode is off</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_SetEnumValueByString</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">,</span> <span class="token string">"TriggerMode"</span><span class="token punctuation">,</span> <span class="token string">"On"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SetTriggerMode failed, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Get payload size</span>
            <span class="token class-name">MVCC_INTVALUE</span> stParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MVCC_INTVALUE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_GetIntValue</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">,</span> <span class="token string">"PayloadSize"</span><span class="token punctuation">,</span> stParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Get PayloadSize fail, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Start grabbing</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_StartGrabbing</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Start Grabbing fail, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Get one frame</span>
            <span class="token class-name">MV_FRAME_OUT_INFO</span> stImageInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MV_FRAME_OUT_INFO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> stParam<span class="token punctuation">.</span>curValue<span class="token punctuation">]</span><span class="token punctuation">;</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_GetOneFrameTimeout</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">,</span> pData<span class="token punctuation">,</span> stImageInfo<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"GetOneFrameTimeout fail, errcode:[%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// System.out.println("GetOneFrame: ");</span>
            <span class="token function">printFrameInfo</span><span class="token punctuation">(</span>stImageInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> imageLen <span class="token operator">=</span> stImageInfo<span class="token punctuation">.</span>width <span class="token operator">*</span> stImageInfo<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token comment">// Every RGB pixel takes 3 bytes</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> imageBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>imageLen<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token comment">// Call MV_CC_SaveImage to save image as JPEG</span>
            <span class="token class-name">MV_SAVE_IMAGE_PARAM</span> stSaveParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MV_SAVE_IMAGE_PARAM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stSaveParam<span class="token punctuation">.</span>width <span class="token operator">=</span> stImageInfo<span class="token punctuation">.</span>width<span class="token punctuation">;</span>                                  <span class="token comment">// image width</span>
            stSaveParam<span class="token punctuation">.</span>height <span class="token operator">=</span> stImageInfo<span class="token punctuation">.</span>height<span class="token punctuation">;</span>                                <span class="token comment">// image height</span>
            stSaveParam<span class="token punctuation">.</span>data <span class="token operator">=</span> pData<span class="token punctuation">;</span>                                               <span class="token comment">// image data</span>
            stSaveParam<span class="token punctuation">.</span>dataLen <span class="token operator">=</span> stImageInfo<span class="token punctuation">.</span>frameLen<span class="token punctuation">;</span>                             <span class="token comment">// image data length</span>
            stSaveParam<span class="token punctuation">.</span>pixelType <span class="token operator">=</span> stImageInfo<span class="token punctuation">.</span>pixelType<span class="token punctuation">;</span>                          <span class="token comment">// image pixel format</span>
            stSaveParam<span class="token punctuation">.</span>imageBuffer <span class="token operator">=</span> imageBuffer<span class="token punctuation">;</span>                                  <span class="token comment">// output image buffer</span>
            stSaveParam<span class="token punctuation">.</span>imageType <span class="token operator">=</span> <span class="token class-name">MV_SAVE_IAMGE_TYPE<span class="token punctuation">.</span>MV_Image_Jpeg</span><span class="token punctuation">;</span>               <span class="token comment">// output image pixel format</span>
            stSaveParam<span class="token punctuation">.</span>methodValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                                            <span class="token comment">// Interpolation method that converts Bayer format to RGB24.  0-Neareast 1-double linear 2-Hamilton</span>
            stSaveParam<span class="token punctuation">.</span>jpgQuality <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>                                            <span class="token comment">// JPG endoding quality(50-99]</span>

            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_SaveImage</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">,</span> stSaveParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//System.err.printf("SaveImage fail, errcode: [%#x]\n", nRet);</span>
                <span class="token comment">// System.out.println(sfTime.format(new Date())+" "+ nRet + " No Image Need Save...");</span>
                <span class="token comment">// break;</span>
                <span class="token comment">//continue;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>

                <span class="token comment">// 保存照片的方法 Save buffer content to file</span>
                <span class="token class-name">String</span> savePathFull <span class="token operator">=</span> savePath<span class="token operator">+</span> sfSave<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span><span class="token string">"camera"</span><span class="token operator">+</span>camIndex<span class="token operator">+</span><span class="token string">"/"</span><span class="token punctuation">;</span>
                <span class="token function">saveDataToFile</span><span class="token punctuation">(</span>imageBuffer<span class="token punctuation">,</span> stSaveParam<span class="token punctuation">.</span>imageLen<span class="token punctuation">,</span> <span class="token string">"SaveImage-"</span> <span class="token operator">+</span> sfSecond<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">".jpeg"</span><span class="token punctuation">,</span>savePathFull<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 有新图片保存时，删除X天前保存图片的文件夹</span>
                <span class="token class-name">Calendar</span> calendar <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                calendar<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// X天前的日期</span>
                calendar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span>deleteDay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> deleteFile <span class="token operator">=</span> savePath<span class="token operator">+</span>sfSave<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>calendar<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/"</span><span class="token punctuation">;</span>
                <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">deleteAllFile</span><span class="token punctuation">(</span>deleteFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
            <span class="token comment">// Stop grabbing</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_StopGrabbing</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"StopGrabbing fail, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>


            <span class="token comment">//            try {<!-- --></span>
            <span class="token comment">//                Thread.sleep(1000);</span>
            <span class="token comment">//            } catch (InterruptedException e) {<!-- --></span>
            <span class="token comment">//                e.printStackTrace();</span>
            <span class="token comment">//            }</span>

        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> hCamera<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// Destroy handle</span>
            nRet <span class="token operator">=</span> <span class="token class-name">MvCameraControl<span class="token punctuation">.</span>MV_CC_DestroyHandle</span><span class="token punctuation">(</span>hCamera<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MV_OK</span> <span class="token operator">!=</span> nRet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"DestroyHandle failed, errcode: [%#x]\n"</span><span class="token punctuation">,</span> nRet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 根据年月日计算图片的路径
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">imagePathFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SimpleDateFormat</span> sfDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-M-d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"/home/hello/MVS/catch_image/"</span><span class="token operator">+</span>sfDate<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_919"></a>运行结果</h4> 
<p><img src="https://images2.imgbox.com/ee/37/z5i2b5DP_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/53/24/cxSZFymv_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ea9ec3c1657573fd58353e6689088ebd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安卓上架华为踩坑合集</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3e9487f061f1e75cb2ee28dd6f6ac7db/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于Selenium&#43;Python的web自动化测试框架（附框架源码&#43;项目实战）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>