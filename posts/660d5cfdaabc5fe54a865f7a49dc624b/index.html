<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pinia的使用 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pinia的使用" />
<meta property="og:description" content="前言 最近新开了个项目，以前老项目都是vue2&#43;vuex开发的，都说用vue3&#43;pinia爽得多，那新项目就vue3&#43;pinia吧。这里记录一下pinia的使用。
使用方法 安装pinia: npm i pinia main.js中引入pinia: //main.js import { createApp } from &#39;vue&#39;; import { createPinia } from &#39;pinia&#39;; import App from &#39;./App.vue&#39;; const app = createApp(App); const pinia = createPinia(); app.use(pinia); app.mount(&#39;#app&#39;) 创建store仓库： 在src下创建store目录，目录下创建index.js文件:
在index.js中利用pinia的defineStore方法创建仓库，一般使用只会用到defineStore的前两个参数(第三个参数可做持久化配置)，下面是setup组合式写法(你也可以改为选项式写法)。
第一个参数为一个字符串，作为仓库的唯一id；第二个参数为一个方法，内部可定义需要存储的数据，定义完成后返回即可，你可以在此处定义多个数据，也可在defineStore之外多次使用defineStore创建多个仓库。
定义的时候有几个取巧的办法：可以使用ref给数据添加响应式特性。只需定义set方法，无需定义get方法。
// /store/index.js import { defineStore } from &#34;pinia&#34;; import { ref } from &#34;vue&#34;; export const piniaStore = defineStore( &#34;piniaStore&#34;, () =&gt; { const pageData = ref(1);//页面数据 const setPageData = () =&gt; { pageData." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/660d5cfdaabc5fe54a865f7a49dc624b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-09T16:20:18+08:00" />
<meta property="article:modified_time" content="2023-11-09T16:20:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pinia的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>最近新开了个项目，以前老项目都是vue2+vuex开发的，都说用vue3+pinia爽得多，那新项目就vue3+pinia吧。这里记录一下pinia的使用。</p> 
<h2><a id="_4"></a>使用方法</h2> 
<ol><li>安装pinia:</li></ol> 
<pre><code>npm i pinia
</code></pre> 
<ol start="2"><li>main.js中引入pinia:</li></ol> 
<pre><code>//main.js
import { createApp } from 'vue';
import { createPinia } from 'pinia';
import App from './App.vue';
const app = createApp(App);
const pinia = createPinia();
app.use(pinia);
app.mount('#app')
</code></pre> 
<ol start="3"><li>创建store仓库：</li></ol> 
<ul><li> <p>在src下创建store目录，目录下创建index.js文件:<br> <img src="https://images2.imgbox.com/9a/29/c7r2fHAU_o.png" alt=""></p> </li><li> <p>在index.js中利用pinia的defineStore方法创建仓库，一般使用只会用到defineStore的前两个参数(第三个参数可做持久化配置)，下面是setup组合式写法(你也可以改为选项式写法)。</p> </li><li> <p>第一个参数为一个字符串，作为仓库的唯一id；第二个参数为一个方法，内部可定义需要存储的数据，定义完成后返回即可，你可以在此处定义多个数据，也可在defineStore之外多次使用defineStore创建多个仓库。</p> </li><li> <p>定义的时候有几个取巧的办法：可以使用ref给数据添加响应式特性。只需定义set方法，无需定义get方法。</p> </li></ul> 
<pre><code>// /store/index.js
import { defineStore } from "pinia";
import { ref } from "vue";
export const piniaStore = defineStore(
    "piniaStore",
    () =&gt; {
        const pageData = ref(1);//页面数据
        const setPageData = () =&gt; {
            pageData.value = pageData.value * 2;
        };//设置页面数据

        return {
            pageData,
            setPageData
        };
    },
);
</code></pre> 
<ol start="4"><li>页面使用</li></ol> 
<ul><li>使用仓库前必须先引入仓库创建store。</li><li>获取仓库数据可借助计算属性computed直接取出。</li><li>修改仓库数据可直接调用返回的对应set方法即可，此处方法没有传参直接在仓库内部修改的数据，你也可以传参使用外部数据修改。</li></ul> 
<pre><code>&lt;template&gt;
		&lt;h1&gt;{<!-- -->{ pageData }}&lt;/h1&gt;
		&lt;button @click="setData"&gt;设置数据&lt;/button&gt;
&lt;/template&gt;
&lt;script setup&gt;
import { computed } from 'vue';
import { piniaStore } from '@/store/index.js';
let store = piniaStore(),//获取仓库
  	pageData = computed(() =&gt; {
    	return store.pageData;//获取仓库中的数据
  	});
const setData = () =&gt; {
	store.setPageData();//设置仓库中的数据
};
&lt;/script&gt;
</code></pre> 
<p>点击前页面显示：<br> <img src="https://images2.imgbox.com/80/40/ZxYzxycZ_o.png" alt=""><br> 点击后页面显示：<br> <img src="https://images2.imgbox.com/6c/a0/2vyloUKS_o.png" alt=""></p> 
<ul><li>到此处其实你就已经学会使用pinia了，比vuex简单多了吧？但我当前项目需要对数据进行持久化处理，不处理页面刷新之后数据全部会重置，无法保存状态。</li></ul> 
<h2><a id="_77"></a>持久化</h2> 
<ul><li>其实可以直接使用sessionStorage或localstorage实现前端数据持久化。</li><li>但数据一旦多了，你会发现代码里面全是setItem、getItem，会有大量的重复代码。</li><li>有人说直接封装不久得了？就像这样：</li></ul> 
<pre><code>//storeTools.js
//写入仓库
export const setStore = (key, value) =&gt; {
    sessionStorage.setItem(key, JSON.stringify(value));
}
//读取仓库
export const getStore = (key) =&gt; {
    return JSON.parse(sessionStorage.getItem(key));
}
//清除所有仓库
export const clearStore = () =&gt; {
    sessionStorage.clear();
}
</code></pre> 
<ul><li>当然你也可以这样做，但在有轮子的情况下，我还是倾向于直接用轮子的，况且轮子提供的功能远比自己封装的方法多。</li><li>下面是pinia的持久化步骤：</li></ul> 
<ol><li>安装插件：</li></ol> 
<pre><code>npm i pinia-plugin-persistedstate
</code></pre> 
<ol start="2"><li>main.js引入插件:</li></ol> 
<pre><code>import { createApp } from 'vue';
import { createPinia } from 'pinia';
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate';
import App from './App.vue';
const app = createApp(App);
const pinia = createPinia();
pinia.use(piniaPluginPersistedstate);//pinia持久化
app.use(pinia);
app.mount('#app')
</code></pre> 
<ol start="3"><li>pinia配置插件，其实就是利用pinia中defineStore方法的第三个参数，直接传入一个对象persist，对象中enabled表示启用持久化，storage表示持久化方式(可选sessionStorage、localstorage)：</li></ol> 
<pre><code>import { defineStore } from "pinia";
import { ref } from "vue";
export const piniaStore = defineStore(
    "piniaStore",
    () =&gt; {
        const pageData = ref(1);//页面数据
        const setPageData = () =&gt; {
            pageData.value = pageData.value * 2;
        };//设置页面数据

        return {
            pageData,
            setPageData
        };
    },
    {
        persist: {
            enabled: true,
            storage: sessionStorage,
        }
    }
);
</code></pre> 
<ol start="4"><li>现在再操作页面后，数据会保存在sessionStorage中，刷新数据不会重置丢失。<br> <img src="https://images2.imgbox.com/0f/75/5KsqClda_o.png" alt=""></li></ol> 
<h2><a id="_146"></a>结语</h2> 
<p>其实vuex也有自己的持久化方法，但我还是倾向于pinia，毕竟更简洁方便了。<br> 原文链接：<font color="red">https://xiblogs.top/?id=64</font></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a77fdf5282b0c7245edd3afd083062b5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Qt相关开发库开发工具下载地址</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/54df747239a7243e80bf2d1113d5d8fa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue3 动态组件 component:is= 失效</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>