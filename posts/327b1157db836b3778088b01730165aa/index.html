<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>钉钉，浙政钉，专有钉钉 h5 免登 demo - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="钉钉，浙政钉，专有钉钉 h5 免登 demo" />
<meta property="og:description" content="前言 开始之前，先简单介绍下 &#34;钉钉家族&#34;
钉钉 是阿里巴巴集团专为中小企业打造的沟通和协同的多端平台。
浙政钉 为规范浙政钉整体架构体系，按照统分结合原则，由省政府办公厅统一设计整体工作界面和系统框架，统筹指导全省统建应用建设，各单位根据自身业务特点分别建设自建应用，最终形成全省统一的政府系统掌上协同办公平台。
浙政钉 1.0 钉钉上的一个特殊组织架构。
浙政钉 2.0 根据2020年浙江省深化“最多跑一次”改革推进政府数字化转型工作要点，为实现基本建成“掌上办公之省”年度工作目标，省大数据局联合阿里巴巴启动了“浙政钉”的迭代升级，将浙政钉从钉钉组织迁移出来，成为独立的浙政钉客户端。
专有钉钉 原名政务钉钉，有更开放的设计能力、集成能力、更结构化协同产品、更定制化开发平台。支持专有化部署，数据落本地，更安全、客户可对该产品持牌运营、结构化编排，协助构建本地应用中心、提供移动应用全面安全保障体系。
阿里专有钉钉产品简介 (注意到是SaaS版本)
简单来说，就是专有钉钉是升级版钉钉，而浙政钉则是专有钉钉 saas 化部署的一个特殊租户。
正文 本文将从 开发前置要求，本地启动步骤，部署 三个方面进行展示
开发前置要求 1 JDK8.0
2 IDEA 环境
3 创建好了的钉钉应用
4 创建好了的浙政钉（开发阶段一般由专有钉钉替代）应用
5 一台安装了 docker 的机器（非必须）
本地启动步骤 1 git 地址
https://github.com/kid626/dingding-demo.git
2 修改 application.yml 的配置
demo: # 修改钉钉 h5 微应用的配置 ding: appKey: &#34;ak&#34; appSecret: &#34;as&#34; corpId: &#34;企业id&#34; agentId: zzd: appKey: &#34;ak&#34; appSecret: &#34;as&#34; corpId: 租户 id # 专有钉钉 默认这个，浙政钉需要使用线上环境地址 domainName: &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/327b1157db836b3778088b01730165aa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-23T14:39:53+08:00" />
<meta property="article:modified_time" content="2021-07-23T14:39:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">钉钉，浙政钉，专有钉钉 h5 免登 demo</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 id="%E5%89%8D%E8%A8%80">前言</h3> 
<p>开始之前，先简单介绍下 "钉钉家族"</p> 
<p style="margin-left:0in;text-align:left;"><span style="color:#FF0000;"><strong>钉钉 </strong></span><span style="color:#000000;">是阿里巴巴集团专为中小企业打造的沟通和协同的多端平台。</span></p> 
<p style="margin-left:0in;text-align:left;"><span style="color:#FF0000;"><strong>浙政钉 </strong></span><span style="color:#000000;">为规范浙政钉整体架构体系，按照统分结合原则，由省政府办公厅统一设计整体工作界面和系统框架，统筹指导全省统建应用建设，各单位根据自身业务特点分别建设自建应用，最终形成全省统一的政府系统掌上协同办公平台。</span></p> 
<p style="margin-left:0in;text-align:left;"><span style="color:#FF0000;"><strong>浙政钉 </strong></span><span style="color:#FF0000;"><strong>1.0  </strong></span><span style="color:#000000;">钉钉上的一个特殊组织架构。</span></p> 
<p style="margin-left:0in;text-align:left;"><span style="color:#FF0000;"><strong>浙政钉 </strong></span><span style="color:#FF0000;"><strong>2.0 </strong></span><span style="color:#000000;">根据</span><span style="color:#000000;">2020</span><span style="color:#000000;">年浙江省深化“最多跑一次”改革推进政府数字化转型工作要点，为实现基本建成“掌上办公之省”年度工作目标，省大数据局联合阿里巴巴启动了“浙政钉”的迭代升级，将浙政钉从钉钉组织迁移出来，成为独立的浙政钉客户端。</span></p> 
<p style="margin-left:0in;text-align:left;"><span style="color:#FF0000;"><strong>专有钉钉 </strong></span><span style="color:#000000;">原名政务钉钉，有更开放的设计能力、集成能力、更结构化协同产品、更定制化开发平台。支持专有化部署，数据落本地，更安全、客户可对该产品持牌运营、结构化编排，协助构建本地应用中心、提供移动应用全面安全保障体系。</span></p> 
<p style="margin-left:0in;text-align:left;"><span style="color:#000000;"><a href="https://help.aliyun.com/document_detail/155317.html?spm=a2c4g.11186623.6.548.6cf06230ILVJHk" rel="nofollow">阿里专有钉钉产品简介</a></span> <span style="color:#000000;">(注意到是SaaS版本)</span></p> 
<p style="margin-left:0in;text-align:left;">简单来说，就是专有钉钉是升级版钉钉，而浙政钉则是专有钉钉 saas 化部署的一个特殊租户。</p> 
<h3 id="%E6%AD%A3%E6%96%87" style="margin-left:0in;text-align:left;"><span style="color:#000000;">正文</span></h3> 
<p><strong>         本文将从 开发前置要求，本地启动步骤，部署  三个方面进行展示</strong></p> 
<h4>开发前置要求</h4> 
<p>        1 JDK8.0</p> 
<p>        2 IDEA 环境</p> 
<p>        3 创建好了的钉钉应用</p> 
<p>        4 创建好了的浙政钉（开发阶段一般由专有钉钉替代）应用</p> 
<p>        5 一台安装了 docker 的机器（非必须）</p> 
<h4>本地启动步骤</h4> 
<p><br> 1 git 地址</p> 
<p><a href="https://github.com/kid626/dingding-demo.git">        https://github.com/kid626/dingding-demo.git</a></p> 
<p> 2 修改 application.yml 的配置</p> 
<pre><code>demo:
  # 修改钉钉 h5 微应用的配置
  ding:
    appKey: "ak"
    appSecret: "as"
    corpId: "企业id"
    agentId: 
  zzd:
    appKey: "ak"
    appSecret: "as"
    corpId: 租户 id
    # 专有钉钉 默认这个，浙政钉需要使用线上环境地址
    domainName: "openplatform.dg-work.cn"
# 可以修改启动端口号
server:
  port: 9001</code></pre> 
<p>3 配置内网穿透</p> 
<p>        鉴于很多开发者在临时体验开发时往往没有公网域名或者公网IP，本工具提供了一个公网代理服务，目的是方便开发测试。</p> 
<p>        可以使用钉钉提供的内网穿透工具 <a href="https://developers.dingtalk.com/document/resourcedownload/http-intranet-penetration" rel="nofollow">钉钉内网穿透介绍</a></p> 
<p>        我这边写了个启动脚本</p> 
<pre><code class="language-bash">#!/usr/bin/env bash
# 自行修改 subdomain 和端口号
echo "FORWARDING http://bruce.vaiwan.com/dd to http:127.0.0.1:9001/dd"
echo "FORWARDING http://bruce.vaiwan.com/zzd to http:127.0.0.1:9001/zzd"
./pierced/windows_64/ding.exe -config=./pierced/windows_64/ding.cfg -subdomain=bruce 9001</code></pre> 
<p>        修改完毕后，记得修改前端静态页面的请求路径(全局搜索 bruce.vaiwan.com)</p> 
<p>4 启动内网穿透工具</p> 
<pre><code class="language-bash">sh ding.sh</code></pre> 
<p>5 配置钉钉，浙政钉,专有钉钉 h5 微应用路径</p> 
<p>        钉钉可以通过 $CORPID$ 动态获取容器内的企业 id，但是浙政钉不行,此 id 在获取鉴权码时需要传入</p> 
<pre><code>钉钉:     http://***.vaiwan.com/dd/?corpid=$CORPID$
浙政钉:    http://***.vaiwan.com/zzd/</code></pre> 
<p>6 启动 SpringBoot 项目</p> 
<p>1）钉钉内部免登</p> 
<p><img alt="" height="512" src="https://images2.imgbox.com/a4/7e/m20lJuqZ_o.png" width="529"></p> 
<p>2）钉钉扫码登录</p> 
<p><a href="https://developers.dingtalk.com/document/tutorial/scan-qr-code-to-log-on-to-third-party-websites" rel="nofollow">钉钉扫码登录流程简介</a></p> 
<blockquote> 
 <p>https://oapi.dingtalk.com/connect/qrconnect?appid=APPID&amp;response_type=code&amp;scope=snsapi_login&amp;state=STATE&amp;redirect_uri=回调地址</p> 
 <p></p> 
</blockquote> 
<p><img alt="" height="513" src="https://images2.imgbox.com/01/38/D0OgAF7V_o.png" width="709"></p> 
<p>3）专有钉钉内部免登</p> 
<p>鉴于专有钉钉不支持应用内截图，在此不做演示了</p> 
<p></p> 
<p>4）专有扫码登录</p> 
<p><a href="https://openplatform-portal.dg-work.cn/portal/#/helpdoc?docKey=kfzn&amp;slug=engk1k" rel="nofollow">专有钉钉扫码登录流程</a></p> 
<blockquote> 
 <pre>https://login.dg-work.cn/oauth2/auth.htm?response_type=code&amp;client_id=应用标识&amp;redirect_uri=回调地址&amp;scope=get_user_info&amp;authType=QRCODE</pre> 
</blockquote> 
<p>这边需要注意的是，专有钉钉扫码和内部免登其实是两个应用，需要区分一下 ak,as</p> 
<p><img alt="" height="577" src="https://images2.imgbox.com/79/2e/R7zqvB9b_o.png" width="712"></p> 
<h4>部署</h4> 
<p>        这边采用 idea 的 docker 插件实现服务的一键部署，具体方式可以移步上一篇文章</p> 
<p><a href="https://blog.csdn.net/qq_38150250/article/details/118852596?spm=1001.2014.3001.5501">        </a><a href="https://blog.csdn.net/qq_38150250/article/details/118852596?spm=1001.2014.3001.5501">idea springboot 一键部署（Dockerfile 篇）</a></p> 
<h3>后记</h3> 
<p>        前段时间看到一句话，深以为然，在此也分享给大家</p> 
<blockquote> 
 <p>总结比埋头重要</p> 
</blockquote> 
<p>        去年疫情以来，加之 数字化改革 ，接到浙政钉的项目也越来越多，第一次还是一头雾水，随着踩得坑越来越多，也渐渐踩出了经验。自己开发倒还好，要是和别人分享，还是有很多问题。</p> 
<p>        因此这段时间静下心来，总结一些遇到的问题，最后整理出一个 demo，不能说保证看完这个 demo，就能流畅的完成开发，但是至少能保证有个能下手的地方。</p> 
<p>        当然作为职场小白一枚，其实还有很多不足的，需要改进的地方也很多，在此列举一下，有机会的话后期能继续改进</p> 
<p>        1 浙政钉，钉钉服务端 api 的调用，后期可能会封装成一个单独的 sdk。</p> 
<p>        2 获取 token 的频率太过频繁，资源浪费，可以考虑利用返回的有效期，对 token 做一个本地缓存</p> 
<p>        3 由于我是一枚JAVA 后端开发，第一次写前端页面，无论是界面还是代码结构上都是非常欠缺的。最近也打算学习一下前端的一些技术框架，像 vue，uni-app ,ant-design 等，希望能改进一下界面吧。</p> 
<p>        最后贴几个开发过程中的参考资料吧</p> 
<p><a href="https://www.cnblogs.com/applerosa/p/11509512.html" rel="nofollow">        </a><a href="https://www.cnblogs.com/applerosa/p/11509512.html" rel="nofollow">钉钉开发第三方H5微应用入门详细教程</a></p> 
<p><a href="https://blog.csdn.net/chachapaofan/article/details/88697452">        </a><a href="https://blog.csdn.net/chachapaofan/article/details/88697452">SpringBoot 热部署</a></p> 
<p><a href="https://blog.csdn.net/dongdingzhuo/article/details/78731704">        </a><a href="https://blog.csdn.net/dongdingzhuo/article/details/78731704">SpringBoot 引入本地 jar包</a></p> 
<p><a href="https://blog.csdn.net/qq_38150250/article/details/118852596?spm=1001.2014.3001.5501">        idea springboot 一键部署（Dockerfile 篇）</a></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b39e54110a212b2e08c5db3dc4d1f19c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">哈夫曼编码设计（C）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/25538ca5a3f394001c8ce013ed7bc7b5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机rapter 流程图,Raptor设计程序流程图并运行的具体操作步骤</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>