<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>纯前端实现图片验证码 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="纯前端实现图片验证码" />
<meta property="og:description" content="前言 之前业务系统中验证码一直是由后端返回base64与一个验证码的字符串来实现的，想了下，前端其实可以直接canvas实现，减轻服务器压力。
实现 子组件，允许自定义图片尺寸(默认尺寸为100 * 40)与验证码刷新时间(默认时间为60秒)。同时暴露绘制验证码方法drawPic(),允许父组件直接调用(需要利用ref实现)，点击验证码也可手动刷新。
//VerifyCodeImg.vue &lt;!--验证码生成--&gt; &lt;template&gt; &lt;canvas id=&#34;canvasDom&#34; :width=&#34;props.canvasWidth&#34; :height=&#34;props.canvasHeight&#34; @click=&#34;drawPic&#34;&gt;&lt;/canvas&gt; &lt;/template&gt; &lt;script setup&gt; import { onMounted, onBeforeUnmount, computed } from &#39;vue&#39;; let props = defineProps({ canvasWidth: { // 容器宽度 type: Number, default: 100 }, canvasHeight: { // 容器高度 type: Number, default: 40 }, refreshTime: {//验证码刷新间隔时间 type: Number, default: 60 } }), emits = defineEmits([&#39;getVerifyCodeStr&#39;]), verifyCodeTimeId = null,//定时器id randomStr = &#39;0123456789abcdefghijklmnopqrstuvwxyz&#39;,// 所有随机字符串 trueRefreshTime = computed(() =&gt; { return props." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/5b4ed7decb0880c09649539a576a0140/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-02T10:41:54+08:00" />
<meta property="article:modified_time" content="2023-11-02T10:41:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">纯前端实现图片验证码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>前言</h2> 
<p>之前业务系统中验证码一直是由后端返回base64与一个验证码的字符串来实现的，想了下，前端其实可以直接canvas实现，减轻服务器压力。</p> 
<h2><a id="_3"></a>实现</h2> 
<p>子组件，允许自定义图片尺寸(默认尺寸为100 * 40)与验证码刷新时间(默认时间为60秒)。同时暴露绘制验证码方法drawPic(),允许父组件直接调用(需要利用ref实现)，点击验证码也可手动刷新。</p> 
<pre><code>//VerifyCodeImg.vue
&lt;!--验证码生成--&gt;
&lt;template&gt;
    &lt;canvas id="canvasDom" :width="props.canvasWidth" :height="props.canvasHeight" @click="drawPic"&gt;&lt;/canvas&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { onMounted, onBeforeUnmount, computed } from 'vue';
let props = defineProps({
    canvasWidth: { // 容器宽度
        type: Number,
        default: 100
    },
    canvasHeight: { // 容器高度
        type: Number,
        default: 40
    },
    refreshTime: {//验证码刷新间隔时间
        type: Number,
        default: 60
    }
}),
    emits = defineEmits(['getVerifyCodeStr']),
    verifyCodeTimeId = null,//定时器id
    randomStr = '0123456789abcdefghijklmnopqrstuvwxyz',// 所有随机字符串
    trueRefreshTime = computed(() =&gt; {
        return props.refreshTime * 1000;
    }),
    verifyCodeStr = '';//验证码字符串

onMounted(() =&gt; {
    initVerifyCodeImg();
});

// 初始化
const initVerifyCodeImg = () =&gt; {
    drawPic();
    verifyCodeTimeId = setInterval(() =&gt; {
        drawPic();
    }, trueRefreshTime.value);
};

// 绘制验证码图片
const drawPic = () =&gt; {
    randomCode();
    let canvas = document.getElementById('canvasDom')
    let ctx = canvas.getContext('2d')
    ctx.textBaseline = 'bottom'
    // 绘制背景
    ctx.fillStyle = '#e6ecfd'
    ctx.fillRect(0, 0, props.canvasWidth, props.canvasHeight)
    // 绘制文字
    for (let i = 0; i &lt; verifyCodeStr.length; i++) {
        drawText(ctx, verifyCodeStr[i], i)
    }
    drawLine(ctx)
    drawDot(ctx)
};

//4个随机字符
const randomCode = () =&gt; {
    verifyCodeStr = ''
    for (let i = 0; i &lt; 4; i++) {
        let txt = randomStr[randomNum(0, randomStr.length)];
        verifyCodeStr += txt;
    }
    emits('getVerifyCodeStr', verifyCodeStr);
};

// 随机数
const randomNum = (min, max) =&gt; {
    return Math.floor(Math.random() * (max - min) + min)
};

// 随机色
const randomColor = (min, max) =&gt; {
    let r = randomNum(min, max)
    let g = randomNum(min, max)
    let b = randomNum(min, max)
    return 'rgb(' + r + ',' + g + ',' + b + ')'
};

// 绘制文字
const drawText = (ctx, txt, i) =&gt; {
    let fontSizeMin = 30,// 字体最小值
        fontSizeMax = 40;// 字体最大值
    ctx.fillStyle = randomColor(50, 160) // 随机生成字体颜色
    ctx.font = randomNum(fontSizeMin, fontSizeMax) + 'px SimHei' // 随机生成字体大小
    let x = (i + 1) * (props.canvasWidth / (verifyCodeStr.length + 1))
    let y = randomNum(fontSizeMax, props.canvasHeight - 5)
    var deg = randomNum(-30, 30)
    // 修改坐标原点和旋转角度
    ctx.translate(x, y)
    ctx.rotate(deg * Math.PI / 180)
    ctx.fillText(txt, 0, 0)
    // 恢复坐标原点和旋转角度
    ctx.rotate(-deg * Math.PI / 180)
    ctx.translate(-x, -y)
};

// 绘制干扰线
const drawLine = (ctx) =&gt; {
    for (let i = 0; i &lt; 4; i++) {
        ctx.strokeStyle = randomColor(100, 200)
        ctx.beginPath()
        ctx.moveTo(randomNum(0, props.canvasWidth), randomNum(0, props.canvasHeight))
        ctx.lineTo(randomNum(0, props.canvasWidth), randomNum(0, props.canvasHeight))
        ctx.stroke()
    }
};

// 绘制干扰点
const drawDot = (ctx) =&gt; {
    // 绘制干扰点
    for (let i = 0; i &lt; 30; i++) {
        ctx.fillStyle = randomColor(0, 255)
        ctx.beginPath()
        ctx.arc(randomNum(0, props.canvasWidth), randomNum(0, props.canvasHeight), 1, 0, 2 * Math.PI)
        ctx.fill()
    }
};

//暴露绘制图片方法供父组件使用
defineExpose({
    drawPic
});

onBeforeUnmount(() =&gt; {
    clearInterval(verifyCodeTimeId);//页面销毁前，需要清除定时器
});

&lt;/script&gt;

&lt;style scoped lang='scss'&gt;
#canvasDom {
    cursor: pointer;
}
&lt;/style&gt;
</code></pre> 
<p>父组件使用。</p> 
<pre><code>&lt;VerifyCodeImg :refreshTime="1" ref="verifyCodeImgRef" @getVerifyCodeStr="getVerifyCodeStr" /&gt;
</code></pre> 
<h2><a id="_149"></a>结语</h2> 
<p>上面是vue3的实现，你也可以改写为vue2的。<br> 原文链接：<font color="red">https://xiblogs.top/?id=63</font></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aa0a10bcd25fb4c7dcc3158de21a2c68/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">（附源码）基于Spring Boot的ERP仓储管理信息系统设计与实现 计算机毕设150958</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/620fc2cc9be7bab43dc13a89a06e6559/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于QT的餐厅服务与管理系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>