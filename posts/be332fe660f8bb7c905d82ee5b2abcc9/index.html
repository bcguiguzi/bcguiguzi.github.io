<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RuntimeError: Background label not declared (remeber that this should be label 0!) - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="RuntimeError: Background label not declared (remeber that this should be label 0!)" />
<meta property="og:description" content="目录
1、报错:
2、解决办法：
3、具体代码：
1、报错: nnUNet v2在准备进行数据预处理时候，出现如下报错。
上述问题的原因是： 在对下载好的数据集KiTS19进行转化时，建立了一个dataset.json说明文件，其中对数据格式作出描述。
但是nnunet v1和v2版本是有区别的，所以在nnunet框架识别的时候，会报错。
v2与 nnU-Net v1 相关的重要更改：
“modality”现在被称为“channel_names”，以消除对医学图像的强烈偏见
“labels”的结构不同（name -&gt; int 而不是 int -&gt; name）。这是支持基于区域的培训所必需的
添加了“file_ending”以支持不同的输入文件类型
“overwrite_image_reader_writer”可选！可用于指定某个（自定义）ReaderWriter 类，该类应 与此数据集一起使用。如果未提供，nnU-Net将自动确定ReaderWriter
“regions_class_order”仅用于基于区域的培训
2、解决办法： 具体解决办法则是修改生成dataset.json文件的代码：
像我的问题（如下）是之前的labels键值对，反过来了，正确修改结果如上图所示。 除此之外，“modality”需修改为“channel_names”。
加了一行这个用来说明file_ending： json_dict[&#39;file_ending&#39;] = &#34;.nii.gz&#34;
最终代码整体如下：
3、具体代码： json_dict = {} &#34;&#34;&#34; name: 数据集名字 dexcription: 对数据集的描述 modality: 模态，0表示CT数据，1表示MR数据。nnU-Net会根据不同模态进行不同的预处理（nnunet-v2版本改为channel_names） labels: label中，不同的数值代表的类别(v1版本和v2版本的键值对刚好是反过来的) file_ending: nnunet v2新加的 numTraining: 训练集数量 numTest: 测试集数量 training: 训练集的image 和 label 地址对 test: 只包含测试集的image. 这里跟Training不一样 &#34;&#34;&#34; json_dict[&#39;name&#39;] = &#34;KiTS&#34; json_dict[&#39;description&#39;] = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/be332fe660f8bb7c905d82ee5b2abcc9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-05T11:05:26+08:00" />
<meta property="article:modified_time" content="2023-08-05T11:05:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RuntimeError: Background label not declared (remeber that this should be label 0!)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="1%E3%80%81%E6%8A%A5%E9%94%99%3A-toc" style="margin-left:0px;"><a href="#1%E3%80%81%E6%8A%A5%E9%94%99%3A" rel="nofollow">1、报错:</a></p> 
<p id="2%E3%80%81%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%EF%BC%9A-toc" style="margin-left:0px;"><a href="#2%E3%80%81%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%EF%BC%9A" rel="nofollow">2、解决办法：</a></p> 
<p id="%C2%A03%E3%80%81%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%C2%A03%E3%80%81%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81%EF%BC%9A" rel="nofollow"> 3、具体代码：</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="1%E3%80%81%E6%8A%A5%E9%94%99%3A"><strong>1、报错:</strong></h2> 
<p>nnUNet v2在准备进行数据预处理时候，出现如下报错。</p> 
<p><img alt="" height="165" src="https://images2.imgbox.com/e4/23/OL5UFTQI_o.png" width="554"></p> 
<p> 上述问题的原因是：  在对下载好的数据集KiTS19进行转化时，建立了一个dataset.json说明文件，其中对数据格式作出描述。</p> 
<p><img alt="" height="643" src="https://images2.imgbox.com/ff/84/0rWy3fBr_o.png" width="683"></p> 
<p> <strong>但是nnunet v1和v2版本是有区别的</strong>，所以在nnunet框架识别的时候，会报错。</p> 
<p style="margin-left:.0001pt;text-align:justify;">v2与 nnU-Net v1 相关的重要更改：</p> 
<p style="margin-left:.0001pt;text-align:justify;">“modality”现在被称为“channel_names”，以消除对医学图像的强烈偏见</p> 
<p style="margin-left:.0001pt;text-align:justify;">“labels”的结构不同（name -&gt; int 而不是 int -&gt; name）。这是支持基于区域的培训所必需的</p> 
<p style="margin-left:.0001pt;text-align:justify;">添加了“file_ending”以支持不同的输入文件类型</p> 
<p style="margin-left:.0001pt;text-align:justify;">“overwrite_image_reader_writer”可选！可用于指定某个（自定义）ReaderWriter 类，该类应 与此数据集一起使用。如果未提供，nnU-Net将自动确定ReaderWriter</p> 
<p style="margin-left:.0001pt;text-align:justify;">“regions_class_order”仅用于基于区域的培训</p> 
<h2 id="2%E3%80%81%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%EF%BC%9A">2、解决办法：</h2> 
<p>具体解决办法则是修改生成dataset.json文件的代码：</p> 
<p class="img-center"><img alt="" height="191" src="https://images2.imgbox.com/55/7c/6arpnJjl_o.png" width="340"></p> 
<p>像我的问题（如下）是之前的labels键值对，反过来了，正确修改结果如上图所示。 </p> 
<p style="text-align:center;"><span style="background-color:#0d0016;"><img alt="" height="148" src="https://images2.imgbox.com/27/53/mCccwbjX_o.png" width="230"></span></p> 
<p>除此之外，“modality”需修改为“channel_names”。</p> 
<p>加了一行这个用来说明file_ending： json_dict['file_ending'] = ".nii.gz"</p> 
<p>最终代码整体如下：</p> 
<p class="img-center"><img alt="" height="495" src="https://images2.imgbox.com/c9/e9/HRRXD4LQ_o.png" width="1123"></p> 
<h2 id="%C2%A03%E3%80%81%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81%EF%BC%9A" style="background-color:transparent;"> 3、具体代码：</h2> 
<pre><code class="language-python">json_dict = {}
"""
name: 数据集名字
dexcription: 对数据集的描述
modality: 模态，0表示CT数据，1表示MR数据。nnU-Net会根据不同模态进行不同的预处理（nnunet-v2版本改为channel_names）
labels: label中，不同的数值代表的类别(v1版本和v2版本的键值对刚好是反过来的)
file_ending: nnunet v2新加的
numTraining: 训练集数量
numTest: 测试集数量
training: 训练集的image 和 label 地址对
test: 只包含测试集的image. 这里跟Training不一样
"""
json_dict['name'] = "KiTS"  
json_dict['description'] = "kidney and kidney tumor segmentation"
json_dict['tensorImageSize'] = "4D"
json_dict['reference'] = "KiTS data for nnunet"
json_dict['licence'] = ""
json_dict['release'] = "0.0"

json_dict['channel_names'] = {
    "0": "CT",
}
json_dict['labels'] = {
    "background": "0",
    "Kidney": "1",
    "Tumor": "2"
}
json_dict['numTraining'] = len(cases)  # 应该是210例
json_dict['file_ending'] = ".nii.gz"
json_dict['numTest'] = 0
json_dict['training'] = [{'image': "./imagesTr/%s.nii.gz" % i, "label": "./labelsTr/%s.nii.gz" % i} for i in cases]
#json_dict['test'] = []
save_json(json_dict, os.path.join(out, "dataset.json"))
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8261f46e0419c895225a63cae701731a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Apache RocketMQ之集成RocketMQ_MQTT 安装部署协议</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/396cd8f38f62cb10e8e3397906c96ad0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【OpenCV实战】简洁易懂的车牌号识别Python&#43;OpenCV实现“超详解”（含代码）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>