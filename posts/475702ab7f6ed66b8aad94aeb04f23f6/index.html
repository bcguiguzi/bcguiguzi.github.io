<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spinnaker多云持续交付平台: 部署Minio存储服务 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spinnaker多云持续交付平台: 部署Minio存储服务" />
<meta property="og:description" content="目录
一、实验
1.环境
2.K8S storage节点部署NFS
3.K8S 动态创建PV
4.K8S master节点部署HELM3
4.K8S master节点部署Minio存储服务（第一种方式安装）
5.Minio客户端安装MC命令
6.K8S master节点使用Docker 部署Minio存储服务（第二种方式安装）
二、问题
1.K8S无法删除pv，pvc问题
2.minio 部署模式有哪些
3.pod Readiness探针与Liveness探针失败
4. 添加 MinIO服务失败
5.docker创建容器失败
6.K8S如何快速创建Minio存储
一、实验 1.环境 （1）主机
表1 主机
主机架构版本IP备注master1K8S master节点1.20.6192.168.204.180 node1K8S node节点1.20.6192.168.204.181node2K8S node节点1.20.6192.168.204.182stor01 nfs存储节点
192.168.204.177 （2）查看集群状态
2.K8S storage节点部署NFS （1）安装配置nfs服务
#在stor01(192.168.204.183)节点上安装nfs，并配置nfs服务 mkdir /opt/k8s chmod 777 /opt/k8s/ yum -y install nfs-utils rpcbind #给204网段用户赋予读写权限、同步内容、不压缩共享对象root用户权限 vim /etc/exports /opt/k8s 192.168.204.0/24(rw,sync,no_root_squash) #首次安装 systemctl start rpcbind nfs #非首次安装 systemctl restart rpcbind systemctl restart nfs #监听服务 ss -antp | grep rpcbind #查看共享 exportfs -arv showmount -e #所有节点配置hosts映射，或者配置DNS解析 echo &#39;192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/475702ab7f6ed66b8aad94aeb04f23f6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-08T16:38:00+08:00" />
<meta property="article:modified_time" content="2024-02-08T16:38:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spinnaker多云持续交付平台: 部署Minio存储服务</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%C2%A0%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C-toc" style="margin-left:0px;"><a href="#%C2%A0%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C" rel="nofollow"> 一、实验</a></p> 
<p id="1.%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px;"><a href="#1.%E7%8E%AF%E5%A2%83" rel="nofollow">1.环境</a></p> 
<p id="2.K8S%20storage%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2NFS-toc" style="margin-left:40px;"><a href="#2.K8S%20storage%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2NFS" rel="nofollow">2.K8S storage节点部署NFS</a></p> 
<p id="3.K8S%20%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BAPV-toc" style="margin-left:40px;"><a href="#3.K8S%20%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BAPV" rel="nofollow">3.K8S 动态创建PV</a></p> 
<p id="4.K8S%20master%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2HELM3-toc" style="margin-left:40px;"><a href="#4.K8S%20master%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2HELM3" rel="nofollow">4.K8S master节点部署HELM3</a></p> 
<p id="4.K8S%20master%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2Minio%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%EF%BC%88%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85%EF%BC%89-toc" style="margin-left:40px;"><a href="#4.K8S%20master%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2Minio%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%EF%BC%88%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85%EF%BC%89" rel="nofollow">4.K8S master节点部署Minio存储服务（第一种方式安装）</a></p> 
<p id="5.Minio%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E8%A3%85MC%E5%91%BD%E4%BB%A4-toc" style="margin-left:40px;"><a href="#5.Minio%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E8%A3%85MC%E5%91%BD%E4%BB%A4" rel="nofollow">5.Minio客户端安装MC命令</a></p> 
<p id="6.K8S%20master%E8%8A%82%E7%82%B9%E4%BD%BF%E7%94%A8Docker%20%E9%83%A8%E7%BD%B2Minio%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%EF%BC%88%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85%EF%BC%89-toc" style="margin-left:40px;"><a href="#6.K8S%20master%E8%8A%82%E7%82%B9%E4%BD%BF%E7%94%A8Docker%20%E9%83%A8%E7%BD%B2Minio%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%EF%BC%88%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85%EF%BC%89" rel="nofollow">6.K8S master节点使用Docker 部署Minio存储服务（第二种方式安装）</a></p> 
<p id="%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98" rel="nofollow">二、问题</a></p> 
<p id="1.K8S%E6%97%A0%E6%B3%95%E5%88%A0%E9%99%A4pv%EF%BC%8Cpvc%E9%97%AE%E9%A2%98-toc" style="margin-left:40px;"><a href="#1.K8S%E6%97%A0%E6%B3%95%E5%88%A0%E9%99%A4pv%EF%BC%8Cpvc%E9%97%AE%E9%A2%98" rel="nofollow">1.K8S无法删除pv，pvc问题</a></p> 
<p id="2.minio%20%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B-toc" style="margin-left:40px;"><a href="#2.minio%20%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B" rel="nofollow">2.minio 部署模式有哪些</a></p> 
<p id="3.pod%C2%A0Readiness%E6%8E%A2%E9%92%88%E4%B8%8ELiveness%E6%8E%A2%E9%92%88%E5%A4%B1%E8%B4%A5-toc" style="margin-left:40px;"><a href="#3.pod%C2%A0Readiness%E6%8E%A2%E9%92%88%E4%B8%8ELiveness%E6%8E%A2%E9%92%88%E5%A4%B1%E8%B4%A5" rel="nofollow">3.pod Readiness探针与Liveness探针失败</a></p> 
<p id="4.%C2%A0%E6%B7%BB%E5%8A%A0%20MinIO%E6%9C%8D%E5%8A%A1%E5%A4%B1%E8%B4%A5-toc" style="margin-left:40px;"><a href="#4.%C2%A0%E6%B7%BB%E5%8A%A0%20MinIO%E6%9C%8D%E5%8A%A1%E5%A4%B1%E8%B4%A5" rel="nofollow">4. 添加 MinIO服务失败</a></p> 
<p id="5.docker%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E5%A4%B1%E8%B4%A5-toc" style="margin-left:40px;"><a href="#5.docker%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E5%A4%B1%E8%B4%A5" rel="nofollow">5.docker创建容器失败</a></p> 
<p id="6.Kuberneters%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BAMinio%E5%AD%98%E5%82%A8-toc" style="margin-left:40px;"><a href="#6.Kuberneters%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BAMinio%E5%AD%98%E5%82%A8" rel="nofollow">6.K8S如何快速创建Minio存储</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p></p> 
<h2 id="%C2%A0%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C"> 一、实验</h2> 
<h3 id="1.%E7%8E%AF%E5%A2%83">1.环境</h3> 
<p>（1）主机</p> 
<p style="text-align:center;">表1  主机</p> 
<table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td style="text-align:center;">主机</td><td style="text-align:center;">架构</td><td style="text-align:center;">版本</td><td style="text-align:center;width:204px;">IP</td><td style="text-align:center;width:82px;">备注</td></tr><tr><td style="text-align:center;">master1</td><td style="text-align:center;">K8S master节点</td><td style="text-align:center;">1.20.6</td><td style="text-align:center;width:204px;">192.168.204.180</td><td style="width:82px;"> <p style="text-align:center;"></p> </td></tr><tr><td style="text-align:center;">node1</td><td style="text-align:center;">K8S node节点</td><td style="text-align:center;">1.20.6</td><td style="text-align:center;width:204px;">192.168.204.181</td><td style="text-align:center;width:82px;"></td></tr><tr><td style="text-align:center;">node2</td><td style="text-align:center;">K8S node节点</td><td style="text-align:center;">1.20.6</td><td style="text-align:center;width:204px;">192.168.204.182</td><td style="text-align:center;width:82px;"></td></tr><tr><td style="text-align:center;">stor01</td><td> <p style="text-align:center;">nfs存储节点</p> </td><td style="text-align:center;"></td><td style="text-align:center;width:204px;">192.168.204.177</td><td style="width:82px;"> <p style="text-align:center;"></p> </td></tr></tbody></table> 
<p>（2）查看集群状态</p> 
<p><img alt="" height="156" src="https://images2.imgbox.com/b6/15/DhbNs33L_o.png" width="829"></p> 
<h3 id="2.K8S%20storage%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2NFS">2.K8S storage节点部署NFS</h3> 
<p>（1）安装配置nfs服务</p> 
<pre><code class="language-bash">#在stor01(192.168.204.183)节点上安装nfs，并配置nfs服务
mkdir /opt/k8s
chmod 777 /opt/k8s/
 
yum -y install nfs-utils rpcbind
 
#给204网段用户赋予读写权限、同步内容、不压缩共享对象root用户权限
vim /etc/exports
/opt/k8s 192.168.204.0/24(rw,sync,no_root_squash)

#首次安装 
systemctl  start  rpcbind nfs

#非首次安装
systemctl  restart rpcbind
systemctl restart nfs

#监听服务
ss -antp | grep rpcbind

#查看共享
exportfs  -arv 

showmount  -e

 
#所有节点配置hosts映射，或者配置DNS解析
echo '192.168.204.177 stor01' &gt;&gt; /etc/hosts</code></pre> 
<p>在stor01(192.168.204.177)节点上安装nfs，并配置nfs服务</p> 
<p><img alt="" height="36" src="https://images2.imgbox.com/1d/90/JKVJ7XGz_o.png" width="563"><img alt="" height="31" src="https://images2.imgbox.com/54/3b/WlhHuulN_o.png" width="503"></p> 
<p>安装</p> 
<p><img alt="" height="58" src="https://images2.imgbox.com/ce/d6/9cA0BQHm_o.png" width="912"></p> 
<p>配置文件</p> 
<p><img alt="" height="41" src="https://images2.imgbox.com/e5/6f/bWijk5UC_o.png" width="586"></p> 
<p><img alt="" height="75" src="https://images2.imgbox.com/d0/be/38Re7XWD_o.png" width="916"></p> 
<p>重启服务</p> 
<p><img alt="" height="47" src="https://images2.imgbox.com/5e/7e/c0sYW4s4_o.png" width="960"></p> 
<p>监听服务</p> 
<p><img alt="" height="213" src="https://images2.imgbox.com/73/28/yxdniiJo_o.png" width="1200"></p> 
<p>查看共享目录</p> 
<p><img alt="" height="135" src="https://images2.imgbox.com/8d/81/mujrRV7P_o.png" width="627"></p> 
<p>（2）查看域名</p> 
<pre><code class="language-bash">vim /etc/hosts</code></pre> 
<p><img alt="" height="55" src="https://images2.imgbox.com/c7/b7/3DLLXE8m_o.png" width="673"></p> 
<h3 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="147" src="https://images2.imgbox.com/50/74/Rv3gqWOU_o.png" width="449"></h3> 
<h3></h3> 
<h3 id="3.K8S%20%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BAPV">3.K8S 动态创建PV</h3> 
<p>(1) 创建 Service Account，用来管理 NFS-Subdir-External-Provisioner 在 k8s 集群中运行的权限，设置 nfs-client 对 PV，PVC，StorageClass 等的规则</p> 
<p>编写资源清单文件</p> 
<pre><code class="language-bash">vim nfs-rbac.yaml

apiVersion: v1
kind: ServiceAccount
metadata:
  name: nfs-client-provisioner
  namespace: default # 替换成你要部署的 Namespace
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: nfs-client-provisioner-runner
rules:
  - apiGroups: [""]
    resources: ["persistentvolumes"]
    verbs: ["get", "list", "watch", "create", "delete"]
  - apiGroups: [""]
    resources: ["persistentvolumeclaims"]
    verbs: ["get", "list", "watch", "update"]
  - apiGroups: ["storage.k8s.io"]
    resources: ["storageclasses"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["events"]
    verbs: ["create", "update", "patch"]
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: run-nfs-client-provisioner
subjects:
  - kind: ServiceAccount
    name: nfs-client-provisioner
    namespace: default
roleRef:
  kind: ClusterRole
  name: nfs-client-provisioner-runner
  apiGroup: rbac.authorization.k8s.io
---
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: leader-locking-nfs-client-provisioner
  namespace: default
rules:
  - apiGroups: [""]
    resources: ["endpoints"]
    verbs: ["get", "list", "watch", "create", "update", "patch"]
---
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: leader-locking-nfs-client-provisioner
  namespace: default
subjects:
  - kind: ServiceAccount
    name: nfs-client-provisioner
    namespace: default
roleRef:
  kind: Role
  name: leader-locking-nfs-client-provisioner
  apiGroup: rbac.authorization.k8s.io</code></pre> 
<h3></h3> 
<p>生成资源</p> 
<pre><code class="language-bash">kubectl apply -f nfs-rbac.yaml
</code></pre> 
<h3><img alt="" height="162" src="https://images2.imgbox.com/d7/a3/jJhQlvyc_o.png" width="1200"></h3> 
<p>再次查看sa</p> 
<pre><code class="language-bash">kubectl get sa</code></pre> 
<p><img alt="" height="199" src="https://images2.imgbox.com/6d/8b/U55X88Y1_o.png" width="741"></p> 
<p>（3）使用 Deployment 来部署 NFS-Subdir-External-Provisioner</p> 
<p>NFS Provisione(即 nfs-client)，有两个功能：一个是在 NFS 共享目录下创建挂载点(volume)，另一个则是将 PV 与 NFS 的挂载点建立关联。</p> 
<p></p> 
<pre><code class="language-bash">vim  nfs-provisioner-deploy.yaml
</code></pre> 
<p></p> 
<pre><code class="language-bash">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nfs-client-provisioner
  labels:
    app: nfs-client-provisioner
spec:
  replicas: 1
  strategy:
    type: Recreate                   ## 设置升级策略为删除再创建(默认为滚动更新)
  selector:
    matchLabels:
      app: nfs-client-provisioner
  template:
    metadata:
      labels:
        app: nfs-client-provisioner
    spec:
      serviceAccountName: nfs-client-provisioner
      containers:
        - name: nfs-client-provisioner
          #image: gcr.io/k8s-staging-sig-storage/nfs-subdir-external-provisioner:v4.0.0
          image: registry.cn-beijing.aliyuncs.com/xngczl/nfs-subdir-external-provisione:v4.0.0
          volumeMounts:
            - name: nfs-client-root
              mountPath: /persistentvolumes
          env:
            - name: PROVISIONER_NAME     ## Provisioner的名称,以后设置的storageclass要和这个保持一致
              value: nfs-client
            - name: NFS_SERVER           ## NFS服务器地址,需和valumes参数中配置的保持一致
              value: stor01
            - name: NFS_PATH             ## NFS服务器数据存储目录,需和valumes参数中配置的保持一致
              value: /opt/k8s
      volumes:
        - name: nfs-client-root
          nfs:
            server: stor01             ## NFS服务器地址
            path: /opt/k8s            ## NFS服务器数据存储目录</code></pre> 
<pre><code class="language-bash">
kubectl apply -f nfs-provisioner-deploy.yaml</code></pre> 
<h3></h3> 
<p><img alt="" height="63" src="https://images2.imgbox.com/82/a2/0ztKNqfR_o.png" width="1051"></p> 
<p>（5）创建 StorageClass，负责建立 PVC 并调用 NFS-Subdir-External-Provisioner进行预定的工作，并让 PV 与 PVC 建立关联，声明 NFS 动态卷提供者名称为 “nfs-storage”。</p> 
<pre><code class="language-bash">vim nfs-storage.yaml

apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: nfs-storage
  annotations:
    storageclass.kubernetes.io/is-default-class: "false"  ## 是否设置为默认的storageclass
provisioner: nfs-client                                   ## 动态卷分配者名称，必须和上面创建的"provisioner"变量中设置的Name一致
parameters:
  archiveOnDelete: "true"                                 ## 设置为"false"时删除PVC不会保留数据,"true"则保留数据
mountOptions:
  - hard                                                  ## 指定为硬挂载方式
  - nfsvers=4                                             ## 指定NFS版本,这个需要根据NFS Server版本号设置
</code></pre> 
<p></p> 
<pre><code class="language-bash">
kubectl apply -f nfs-storage.yaml</code></pre> 
<p><img alt="" height="64" src="https://images2.imgbox.com/cd/8d/DzZf0e3C_o.png" width="971"></p> 
<p></p> 
<p></p> 
<p></p> 
<h3 id="4.K8S%20master%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2HELM3">4.K8S master节点部署HELM3</h3> 
<p>（1）Helm版本与K8S集群兼容</p> 
<p><a href="https://helm.sh/zh/docs/topics/version_skew/" rel="nofollow" title="Helm | Helm版本支持策略">Helm | Helm版本支持策略</a></p> 
<p><img alt="ee70de7fccd441c2866678f1b28ca9da.png" src="https://images2.imgbox.com/dc/be/jFrxmetE_o.png"></p> 
<p>（2）查看K8S集群状态</p> 
<pre><code class="language-bash"># kubectl get node
</code></pre> 
<p></p> 
<p><img alt="" height="156" src="https://images2.imgbox.com/78/a4/Cwz6cwnY_o.png" width="829"></p> 
<p>（3）策略</p> 
<p>当前K8S 集群为1.20.6版本，选择HELM 3.8.1 版本。</p> 
<p>（4）部署</p> 
<pre><code class="language-bash">
1）安装 helm 
//下载二进制 Helm client 安装包
wget https://get.helm.sh/helm-v3.8.1-linux-amd64.tar.gz
 
tar -zxvf helm-v3.8.1-linux-amd64.tar.gz
mv linux-amd64/helm /usr/local/bin/helm
helm version
 
//命令补全
source &lt;(helm completion bash)
 
2）使用 helm 安装 Chart
//添加常用的 chart 仓库，
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts

3) 更新 charts 列表
helm repo update
helm repo list          </code></pre> 
<p>安装</p> 
<p><img alt="" height="242" src="https://images2.imgbox.com/3f/3a/63lcW4Eo_o.png" width="1200"></p> 
<p>使用 helm 安装 Chart</p> 
<p><img alt="" height="364" src="https://images2.imgbox.com/7f/40/d76HtKIp_o.png" width="1200"></p> 
<p></p> 
<h3 id="4.K8S%20master%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2Minio%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%EF%BC%88%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85%EF%BC%89">4.K8S master节点部署Minio存储服务（第一种方式安装）</h3> 
<p>（1）Minio官方文档</p> 
<p><a href="https://artifacthub.io/packages/helm/bitnami/minio" rel="nofollow" title="minio 13.4.2 · bitnami/bitnami (artifacthub.io)">minio 13.4.2 · bitnami/bitnami (artifacthub.io)</a></p> 
<p>（2）获取最新minio charts</p> 
<pre><code class="language-bash">1)查询 minio 资源
helm search repo minio

2)创建目录
mkdir -p /root/minio/ &amp;&amp; cd /root/minio/

3)拉取 chart 到本地目录
第一种方式：
helm fetch bitnami/minio --version 13.3.3
第二种方式
helm pull bitnami/minio --version 13.3.3 

4)解压
tar -zxvf minio-13.3.3.tgz
cp minio/values.yaml ./values-test.yaml

5）查看当前目录层级
tree -L 2
.
├── minio
│   ├── Chart.lock
│   ├── charts
│   ├── Chart.yaml
│   ├── README.md
│   ├── templates
│   └── values.yaml
├── minio-13.3.3.tgz
└── values-test.yaml

</code></pre> 
<p>查询</p> 
<p><img alt="" height="111" src="https://images2.imgbox.com/e7/a1/wrHGq5YL_o.png" width="1200"></p> 
<p></p> 
<p>拉取解压<img alt="" height="1084" src="https://images2.imgbox.com/38/7f/qXhnDmYN_o.png" width="1099"><img alt="" height="37" src="https://images2.imgbox.com/16/fe/yDi2RL0W_o.png" width="1173"></p> 
<p></p> 
<p>查看目录</p> 
<p><img alt="" height="341" src="https://images2.imgbox.com/ec/16/S3Eygry3_o.png" width="690"></p> 
<p></p> 
<p>（3）查看集群 <code>storageclasses</code></p> 
<pre><code class="language-bash">kubectl get storageclasses.storage.k8s.io</code></pre> 
<p><img alt="" height="98" src="https://images2.imgbox.com/d3/ea/6gPlgiak_o.png" width="1200"></p> 
<p>（4）修改配置文件</p> 
<pre><code class="language-bash">vim values-test.yaml </code></pre> 
<p><img alt="" height="37" src="https://images2.imgbox.com/58/8b/kj6tFEb3_o.png" width="992"></p> 
<p><img alt="" height="54" src="https://images2.imgbox.com/d1/d1/e0wxtMxx_o.png" width="617"><img alt="" height="62" src="https://images2.imgbox.com/ae/9e/NhKJRiHC_o.png" width="628"><img alt="" height="268" src="https://images2.imgbox.com/a7/41/oUP4TFwf_o.png" width="1138"></p> 
<p><img alt="" height="264" src="https://images2.imgbox.com/ac/b5/VGRXY1Rm_o.png" width="1122"><img alt="" height="70" src="https://images2.imgbox.com/3d/9f/XNPnTAdH_o.png" width="612"><img alt="" height="89" src="https://images2.imgbox.com/86/b6/P4ZmCS0c_o.png" width="655"><img alt="" height="59" src="https://images2.imgbox.com/02/11/DWNlOIyE_o.png" width="619"><img alt="" height="274" src="https://images2.imgbox.com/2c/78/4OrzYtva_o.png" width="1093"><img alt="" height="650" src="https://images2.imgbox.com/e6/b7/5HykAALV_o.png" width="1200"><img alt="" height="642" src="https://images2.imgbox.com/52/90/gUYN11b6_o.png" width="1200"><img alt="" height="558" src="https://images2.imgbox.com/64/1d/lOmLpXl2_o.png" width="1200"></p> 
<p>(5)安装minio集群</p> 
<pre><code class="language-bash">helm install minio minio -f values-test.yaml

-n 指定 kubernetes 集群名称空间
-f 指定使用的配置文件，文件中定义的配置可以覆盖 minio/values.yaml 文件中配置

NAME: minio
LAST DEPLOYED: Thu Feb  8 09:03:41 2024
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
CHART NAME: minio
CHART VERSION: 13.3.3
APP VERSION: 2024.1.31

** Please be patient while the chart is being deployed **

MinIO&amp;reg; can be accessed via port  on the following DNS name from within your cluster:

   minio.default.svc.cluster.local

To get your credentials run:

   export ROOT_USER=$(kubectl get secret --namespace default minio -o jsonpath="{.data.root-user}" | base64 -d)
   export ROOT_PASSWORD=$(kubectl get secret --namespace default minio -o jsonpath="{.data.root-password}" | base64 -d)

To connect to your MinIO&amp;reg; server using a client:

- Run a MinIO&amp;reg; Client pod and append the desired command (e.g. 'admin info'):

   kubectl run --namespace default minio-client \
     --rm --tty -i --restart='Never' \
     --env MINIO_SERVER_ROOT_USER=$ROOT_USER \
     --env MINIO_SERVER_ROOT_PASSWORD=$ROOT_PASSWORD \
     --env MINIO_SERVER_HOST=minio \
     --image docker.io/bitnami/minio-client:2024.1.31-debian-11-r1 -- admin info minio

To access the MinIO&amp;reg; web UI:

- Get the MinIO&amp;reg; URL:

   echo "MinIO&amp;reg; web URL: http://127.0.0.1:9001/minio"
   kubectl port-forward --namespace default svc/minio 9001:9001

</code></pre> 
<p></p> 
<p><img alt="" height="653" src="https://images2.imgbox.com/dd/ce/88ujG1dM_o.png" width="1044"></p> 
<p>(6) 查看</p> 
<pre><code class="language-bash">helm list

kubectl get deploy

kubectl get pod

kubectl get pod -o wide</code></pre> 
<p><img alt="" height="71" src="https://images2.imgbox.com/cc/37/PIC3bJUD_o.png" width="1110"></p> 
<p><img alt="" height="204" src="https://images2.imgbox.com/aa/fc/PVc0lJbC_o.png" width="1161"></p> 
<p>(7) 查看pv与pvc</p> 
<pre><code class="language-bash">kubectl get pv

kubectl get pvc</code></pre> 
<p><img alt="" height="148" src="https://images2.imgbox.com/32/64/WoXc4xxl_o.png" width="1137"></p> 
<p>（8）NFS 查看卷</p> 
<pre><code class="language-bash">ls</code></pre> 
<p><img alt="" height="71" src="https://images2.imgbox.com/f3/82/dxhDynJz_o.png" width="655"></p> 
<pre><code class="language-bash">ls | grep minio
</code></pre> 
<p></p> 
<p><img alt="" height="77" src="https://images2.imgbox.com/83/8a/mhUWLUBe_o.png" width="584"></p> 
<p></p> 
<h3 id="5.Minio%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E8%A3%85MC%E5%91%BD%E4%BB%A4">5.Minio客户端安装MC命令</h3> 
<p>（1）下载</p> 
<pre><code class="language-bash">wget https://dl.min.io/client/mc/release/linux-amd64/mc</code></pre> 
<p>（2）安装</p> 
<pre><code class="language-bash">chmod a+x mc

mv mc /usr/local/bin/

mc --version
</code></pre> 
<p><img alt="" height="43" src="https://images2.imgbox.com/87/cb/Hu2AFwLP_o.png" width="433"><img alt="" height="58" src="https://images2.imgbox.com/02/bd/bLnakqyr_o.png" width="817"></p> 
<p>(3) 配置访问minio</p> 
<pre><code class="language-bash">mc config host add minio http://10.99.219.173:9000 minio minio123 --api S3v4

# 查看配置，不同 mc 版本，以下内容输出可能不一定完全相同
mc config host list

gcs  
  URL       : https://storage.googleapis.com
  AccessKey : YOUR-ACCESS-KEY-HERE
  SecretKey : YOUR-SECRET-KEY-HERE
  API       : S3v2
  Path      : dns

local
  URL       : http://localhost:9000
  AccessKey : 
  SecretKey : 
  API       : 
  Path      : auto

minio
  URL       : http://10.99.219.173:9000
  AccessKey : minio
  SecretKey : minio123
  API       : S3v4
  Path      : auto

play 
  URL       : https://play.min.io
  AccessKey : Q3AM3UQ867SPQQA43P2F
  SecretKey : zuf+tfteSlswRu7BJ86wekitnifILbZam1KYY3TG
  API       : S3v4
  Path      : auto

s3   
  URL       : https://s3.amazonaws.com
  AccessKey : YOUR-ACCESS-KEY-HERE
  SecretKey : YOUR-SECRET-KEY-HERE
  API       : S3v4
  Path      : dns
</code></pre> 
<p><img alt="" height="648" src="https://images2.imgbox.com/a8/42/BRuvugOj_o.png" width="804"></p> 
<p></p> 
<h3 id="6.K8S%20master%E8%8A%82%E7%82%B9%E4%BD%BF%E7%94%A8Docker%20%E9%83%A8%E7%BD%B2Minio%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%EF%BC%88%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85%EF%BC%89">6.K8S master节点使用Docker 部署Minio存储服务（第二种方式安装）</h3> 
<p>（1）docker 命令去安装稳定版本的 minio</p> 
<pre><code class="language-bash">docker pull minio/minio</code></pre> 
<p><img alt="" height="213" src="https://images2.imgbox.com/84/a1/fgOifs1N_o.png" width="768"></p> 
<p>（2）创建存放数据的目录</p> 
<pre><code class="language-bash"># 一个用来存放配置，一个用来存储上传文件的目录
# 启动前需要先创建Minio外部挂载的配置文件（ /rootconfig）,和存储上传文件的目录（ /root/data）

mkdir -p /root/data

mkdir -p /root/config</code></pre> 
<p><img alt="" height="57" src="https://images2.imgbox.com/89/3c/1krnYs7U_o.png" width="510"></p> 
<p>(3) 创建Minio容器并运行（多行模式）</p> 
<pre><code class="language-bash"># 9090端口指的是minio的客户端端口
# MINIO_ACCESS_KEY ：账号
# MINIO_SECRET_KEY ：密码（账号长度必须大于等于5，密码长度必须大于等于8位）

docker run -p 9000:9000 -p 9090:9090 \
     --net=host \
     --name minio \
     -d --restart=always \
     -e "MINIO_ACCESS_KEY=minioadmin" \
     -e "MINIO_SECRET_KEY=minioadmin" \
     -v /root/data:/data \
     -v /root/config:/root/.minio \
     minio/minio server \
     /data --console-address ":9090" -address ":9000"
</code></pre> 
<p></p> 
<p>（4）另一种方式创建Minio容器并运行（单行模式）</p> 
<pre><code class="language-bash">docker run -p 9000:9000 -p 9090:9090      --net=host      --name minio      -d --restart=always      -e "MINIO_ACCESS_KEY=minioadmin"      -e "MINIO_SECRET_KEY=minioadmin"      -v /root/data:/data      -v /root/config:/root/.minio      minio/minio server      /data --console-address ":9090" -address ":9000"
</code></pre> 
<p>（5）查看docker进程</p> 
<pre><code class="language-bash">docker ps | grep minio</code></pre> 
<p><img alt="" height="75" src="https://images2.imgbox.com/d1/38/1ibZe5Iz_o.png" width="1165"></p> 
<p>（6）登录</p> 
<pre><code class="language-bash">http://192.168.204.180:9090/login</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/22/2f/GY9m1H4P_o.png" width="1200"></p> 
<p>进入系统</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/49/0c/AfyjaU2R_o.png" width="1200"></p> 
<p>（7）创建用户</p> 
<p><img alt="" height="358" src="https://images2.imgbox.com/3b/43/7hHW6kx3_o.png" width="1200"></p> 
<p>填写信息</p> 
<p><img alt="" height="292" src="https://images2.imgbox.com/b7/22/stEUD0Vh_o.png" width="753"><img alt="" height="197" src="https://images2.imgbox.com/dc/5c/BDpXpS5a_o.png" width="735"><img alt="" height="187" src="https://images2.imgbox.com/ee/bf/yYb7d5NU_o.png" width="716"></p> 
<p>（8）完成创建</p> 
<p><img alt="" height="367" src="https://images2.imgbox.com/c0/dc/2331nprG_o.png" width="1200"></p> 
<p>（9）创建组</p> 
<p><img alt="" height="334" src="https://images2.imgbox.com/76/4d/p86wvWq0_o.png" width="1200"></p> 
<p><img alt="" height="483" src="https://images2.imgbox.com/29/6b/UYkWPfjo_o.png" width="747"></p> 
<p>(10)创建accessKey和secretKey </p> 
<p><img alt="" height="377" src="https://images2.imgbox.com/44/0b/yDerniCY_o.png" width="1200"></p> 
<p><img alt="" height="309" src="https://images2.imgbox.com/1b/c7/jmy9NC39_o.png" width="753"></p> 
<p>查看</p> 
<p><img alt="" height="449" src="https://images2.imgbox.com/a6/ed/Ki7SPbGX_o.png" width="752"></p> 
<p>（11）创建Bucket</p> 
<p><img alt="" height="342" src="https://images2.imgbox.com/78/9f/Ui0b7Xpf_o.png" width="1200"></p> 
<p><img alt="" height="709" src="https://images2.imgbox.com/83/98/yg6sIPK5_o.png" width="1200"></p> 
<p>查看</p> 
<p><img alt="" height="310" src="https://images2.imgbox.com/e8/2c/5uAjj915_o.png" width="1200"></p> 
<p>（12）上传文件</p> 
<p><img alt="" height="181" src="https://images2.imgbox.com/00/b5/vlZIbA8T_o.png" width="293"></p> 
<p>查看</p> 
<p><img alt="" height="389" src="https://images2.imgbox.com/61/72/ckdWYUqZ_o.png" width="1200"></p> 
<p></p> 
<h2 id="%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98">二、问题</h2> 
<h3 id="1.K8S%E6%97%A0%E6%B3%95%E5%88%A0%E9%99%A4pv%EF%BC%8Cpvc%E9%97%AE%E9%A2%98">1.K8S无法删除pv，pvc问题</h3> 
<p>（1）报错</p> 
<pre><code class="language-bash">error: resource(s) were provided, but no name was specified</code></pre> 
<p>（2）原因分析</p> 
<p>删除顺序不对。</p> 
<p>（3）解决方法</p> 
<pre><code class="language-bash">正确的删除顺序：
 
1）先删除pod
helm -n devops uninstall minio(项目名称) 
 
2）解除pv绑定
kubectl patch pv pvname(pv名称) -p '{"metadata":{"finalizers":null}}'
 
3）解除pvc绑定
kubectl patch pvc pvcname(pvc名称) -p '{"metadata":{"finalizers":null}}'

4) 删除pv
kubectl delete pv pvname(pv名称) -n devops

5) 删除pvc
kubectl delete pvc pvname(pvc名称) -n devops
</code></pre> 
<p><img alt="" height="83" src="https://images2.imgbox.com/ae/33/5FEQwDfK_o.png" width="854"><img alt="" height="171" src="https://images2.imgbox.com/81/da/jCaya7Tr_o.png" width="1200"><img alt="" height="85" src="https://images2.imgbox.com/e4/f2/dfrbxTsM_o.png" width="1200"><img alt="" height="61" src="https://images2.imgbox.com/cb/89/765S115s_o.png" width="962"><img alt="" height="66" src="https://images2.imgbox.com/0c/09/GgykLvRc_o.png" width="810"></p> 
<p></p> 
<h3 id="2.minio%20%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B">2.minio 部署模式有哪些</h3> 
<p>（1）模式</p> 
<pre><code class="language-bash">1）standalone
独立模式下，服务部署数量为1个

3）distributed
分别模式下，服务部署数量，必须大于4个</code></pre> 
<p>（2）standalone模式</p> 
<p> <img alt="" height="267" src="https://images2.imgbox.com/9b/8c/0RvmjXXK_o.png" width="1127"></p> 
<p>创建（服务部署数量为1个）<img alt="" height="118" src="https://images2.imgbox.com/0c/c5/iMrunNGg_o.png" width="1112"><img alt="" height="161" src="https://images2.imgbox.com/de/78/eIj3sRQn_o.png" width="1200"></p> 
<p>（3）distributed模式</p> 
<p><img alt="" height="264" src="https://images2.imgbox.com/ee/0f/ynWyDUF1_o.png" width="1122"><img alt="" height="90" src="https://images2.imgbox.com/40/84/iS4ojtvx_o.png" width="1200"></p> 
<p>创建 （服务部署数量为4个）</p> 
<p> <img alt="" height="166" src="https://images2.imgbox.com/77/c3/RixDedH5_o.png" width="814"></p> 
<p><img alt="" height="165" src="https://images2.imgbox.com/b3/13/kLFt1L0e_o.png" width="1200"><img alt="" height="162" src="https://images2.imgbox.com/c9/68/4jchCF5q_o.png" width="1200"></p> 
<p></p> 
<h3 id="3.pod%C2%A0Readiness%E6%8E%A2%E9%92%88%E4%B8%8ELiveness%E6%8E%A2%E9%92%88%E5%A4%B1%E8%B4%A5">3.pod Readiness探针与Liveness探针失败</h3> 
<p>(1)报错</p> 
<p>通过yaml文件创建pod时，执行完yaml文件，过一会就开始报错说<code>Back-off restarting failed container</code>。</p> 
<p>查看pod状态一致处于<code>CrashLoopBackOff</code></p> 
<pre><code class="language-bash">kubectl get pod</code></pre> 
<p><img alt="" height="74" src="https://images2.imgbox.com/82/9c/eAHL5MLs_o.png" width="890"></p> 
<pre><code class="language-bash">kubectl describe pod minio-9c678d65c-45js9 </code></pre> 
<p><img alt="" height="86" src="https://images2.imgbox.com/09/c0/TufGmnnv_o.png" width="634"></p> 
<p><img alt="" height="153" src="https://images2.imgbox.com/f2/63/YcP4GOnh_o.png" width="1184"></p> 
<p></p> 
<p>（2）原因分析</p> 
<p>Back-off restarting failed container的Warning事件，一般是由于通过指定的镜像启动容器后，容器内部没有常驻进程，导致容器启动成功后即退出，从而进行了持续的重启。</p> 
<p>（3）解决方法</p> 
<pre><code class="language-bash">如果是通过yaml文件创建的pod，找到对应的deployment，增加命令command: ["/bin/bash", "-ce", "tail -f /dev/null"]</code></pre> 
<pre><code class="language-bash">kubectl edit deploy</code></pre> 
<p><img alt="" height="137" src="https://images2.imgbox.com/c6/0e/nQnKogON_o.png" width="746"><img alt="" height="203" src="https://images2.imgbox.com/93/26/7jGE0Sf7_o.png" width="1128"></p> 
<p></p> 
<h3 id="4.%C2%A0%E6%B7%BB%E5%8A%A0%20MinIO%E6%9C%8D%E5%8A%A1%E5%A4%B1%E8%B4%A5">4. 添加 MinIO服务失败</h3> 
<p>（1）报错</p> 
<p><img alt="" height="184" src="https://images2.imgbox.com/e0/ae/Ya6qtYCZ_o.png" width="1183"></p> 
<p>（2）原因分析</p> 
<p>端口不能漏，–api不能漏</p> 
<p>（3）解决方法</p> 
<p>连接</p> 
<pre><code class="language-bash">mc config host add minio http://10.99.219.173:9000 minio minio123 --api S3v4</code></pre> 
<p><img alt="" height="42" src="https://images2.imgbox.com/c3/1c/mjPEmxxo_o.png" width="850"></p> 
<p>如需删除</p> 
<pre><code class="language-bash">mc config host remove minio</code></pre> 
<p><img alt="" height="42" src="https://images2.imgbox.com/35/ce/hZiWvP6u_o.png" width="502"></p> 
<h3 id="5.docker%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E5%A4%B1%E8%B4%A5">5.docker创建容器失败</h3> 
<p>（1）报错</p> 
<p><img alt="" height="91" src="https://images2.imgbox.com/2e/d1/cmgLO26Q_o.png" width="1180"></p> 
<p>（2）原因分析</p> 
<p>容器名称重复</p> 
<p>（3）解决方法</p> 
<p>查看</p> 
<pre><code class="language-bash">docker ps -a</code></pre> 
<p><img alt="" height="85" src="https://images2.imgbox.com/74/ff/Y5e6wIuP_o.png" width="1179"></p> 
<p>删除</p> 
<pre><code class="language-bash">docker rm -f a17f4299e7bd</code></pre> 
<p><img alt="" height="39" src="https://images2.imgbox.com/d5/be/xsDmhOPB_o.png" width="446"></p> 
<p>成功：</p> 
<pre><code class="language-bash">docker run -p 9000:9000 --name minio -v /root/data:/data -v /root/config:/root/.minio minio/minio server /data
</code></pre> 
<p><img alt="" height="237" src="https://images2.imgbox.com/d1/8f/XsHXoBEj_o.png" width="1181"></p> 
<h3 id="6.Kuberneters%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BAMinio%E5%AD%98%E5%82%A8">6.K8S如何快速创建Minio存储</h3> 
<p>（1）官方文档</p> 
<p><a href="https://min.io/docs/minio/kubernetes/upstream/index.html?ref=docs-redirect" rel="nofollow" title="MinIO Object Storage for Kubernetes — MinIO Object Storage for Kubernetes">MinIO Object Storage for Kubernetes — MinIO Object Storage for Kubernetes</a></p> 
<p>（2）下载 MinIO 对象</p> 
<pre><code class="language-bash">curl https://raw.githubusercontent.com/minio/docs/master/source/extra/examples/minio-dev.yaml -O</code></pre> 
<p>（3）应用 MinIO 对象定义</p> 
<pre><code class="language-bash">kubectl apply -f minio-dev.yaml</code></pre> 
<p>命令输出应如下所示：</p> 
<pre><code class="language-bash">namespace/minio-dev created
pod/minio created</code></pre> 
<p>（4）验证 Pod 的状态</p> 
<pre><code class="language-bash">kubectl get pods -n minio-dev</code></pre> 
<p>（5）检索有关 Pod 状态的详细信息</p> 
<pre><code class="language-bash">kubectl describe pod/minio -n minio-dev

kubectl logs pod/minio -n minio-dev</code></pre> 
<p>（6）临时访问 MinIO S3 API 和控制台</p> 
<p>使用以下命令将流量从 MinIO Pod 临时转发到本地计算机</p> 
<pre><code class="language-bash">#该命令在 shell 中处于活动状态时，将 pod 端口转发到本地计算机上的匹配端口。 该命令仅在 shell 会话中处于活动状态时起作用。 终止会话将关闭本地计算机上的端口。

#要配置对 Pod 的长期访问，需要在 Kubernetes 中配置 Ingress 或类似的网络控制组件，以路由进出 Pod 的流量。

kubectl port-forward pod/minio 9000 9090 -n minio-dev</code></pre> 
<p>（7）浏览器连接到 MinIO 服务器</p> 
<pre><code class="language-bash">通过在本地计算机上打开浏览器并导航到 来访问 MinIO 控制台。http://127.0.0.1:9001

使用凭据 登录控制台。 这些是默认的 root 用户凭证。minioadmin | minioadmin</code></pre> 
<p>（8）连接 MinIO 客户端</p> 
<p>如果本地计算机已安装mc，请使用以下命令进行身份验证并连接到 MinIO 部署</p> 
<pre><code class="language-bash">mc alias set k8s-minio-dev http://127.0.0.1:9000 minioadmin minioadmin
mc admin info k8s-minio-dev</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4955c7ee2c737e20ed0c52779dd7774a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spark MLlib</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/90cb0fd6534dfcc1e98526fd7f8afe13/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">K8S之运用亲和性设置Pod的调度约束</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>