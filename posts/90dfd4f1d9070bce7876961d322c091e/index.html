<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hadoop大数据应用：HDFS 集群节点缩容 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Hadoop大数据应用：HDFS 集群节点缩容" />
<meta property="og:description" content="目录
一、实验
1.环境
2.HDFS 集群节点缩容
二、问题
1.数据迁移有哪些状态
2.数据迁移失败
一、实验 1.环境 （1）主机
表1 主机
主机架构软件版本IP备注hadoop NameNode （已部署）
SecondaryNameNode （已部署）
ResourceManager（已部署）
hadoop
2.7.7192.168.204.50 node01 DataNode（已部署）
NodeManager（已部署）
hadoop
2.7.7192.168.204.51node02 DataNode（已部署）
NodeManager（已部署）
hadoop
2.7.7192.168.204.52node03 DataNode（已部署）
NodeManager（已部署）
hadoop
2.7.7192.168.204.53node04 DataNode（已部署）
hadoop
2.7.7192.168.204.54需求迁移主机 （2）查看jps
hadoop节点
[root@hadoop ~]# jps node01节点
node02节点
node03节点
node04节点
2.HDFS 集群节点缩容 （1）查看节点状态 （已使用）
node01: 176KB (约等于0.18M )
node02: 280KB (约等于0.28M )
node03: 260KB (约等于0.26M )
node04: 8KB （约等于0.008M）
[root@hadoop hadoop]# ./bin/hdfs dfsadmin -report Configured Capacity: 822126559232 (765." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/90dfd4f1d9070bce7876961d322c091e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-14T17:28:58+08:00" />
<meta property="article:modified_time" content="2024-03-14T17:28:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hadoop大数据应用：HDFS 集群节点缩容</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%C2%A0%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C-toc" style="margin-left:0px;"><a href="#%C2%A0%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C" rel="nofollow">一、实验</a></p> 
<p id="1.%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px;"><a href="#1.%E7%8E%AF%E5%A2%83" rel="nofollow">1.环境</a></p> 
<p id="2.HDFS%20%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E7%BC%A9%E5%AE%B9-toc" style="margin-left:40px;"><a href="#2.HDFS%20%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E7%BC%A9%E5%AE%B9" rel="nofollow">2.HDFS 集群节点缩容</a></p> 
<p id="%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98" rel="nofollow">二、问题</a></p> 
<p id="1.%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E6%9C%89%E5%93%AA%E4%BA%9B%E7%8A%B6%E6%80%81-toc" style="margin-left:40px;"><a href="#1.%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E6%9C%89%E5%93%AA%E4%BA%9B%E7%8A%B6%E6%80%81" rel="nofollow">1.数据迁移有哪些状态</a></p> 
<p id="2.%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%A4%B1%E8%B4%A5-toc" style="margin-left:40px;"><a href="#2.%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%A4%B1%E8%B4%A5" rel="nofollow">2.数据迁移失败</a></p> 
<p id="1.%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E6%9C%89%E5%93%AA%E4%BA%9B%E7%8A%B6%E6%80%81-toc" style="margin-left:40px;"></p> 
<hr id="hr-toc"> 
<p></p> 
<p></p> 
<h2 id="%C2%A0%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C">一、实验</h2> 
<h3 id="1.%E7%8E%AF%E5%A2%83">1.环境</h3> 
<p>（1）主机</p> 
<p style="text-align:center;">表1  主机</p> 
<table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td style="text-align:center;">主机</td><td style="text-align:center;">架构</td><td style="text-align:center;">软件</td><td style="text-align:center;">版本</td><td style="text-align:center;">IP</td><td style="text-align:center;">备注</td></tr><tr><td style="text-align:center;">hadoop</td><td> <p style="text-align:center;">NameNode （已部署）</p> <p style="text-align:center;">SecondaryNameNode （已部署）</p> <p style="text-align:center;">ResourceManager（已部署）</p> </td><td> <p style="text-align:center;">hadoop</p> </td><td style="text-align:center;">2.7.7</td><td style="text-align:center;">192.168.204.50</td><td> <p style="text-align:center;"></p> </td></tr><tr><td style="text-align:center;">node01</td><td> <p style="text-align:center;">DataNode（已部署）</p> <p style="text-align:center;">NodeManager（已部署）</p> </td><td> <p style="text-align:center;">hadoop</p> </td><td style="text-align:center;">2.7.7</td><td style="text-align:center;">192.168.204.51</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">node02</td><td> <p style="text-align:center;">DataNode（已部署）</p> <p style="text-align:center;">NodeManager（已部署）</p> </td><td> <p style="text-align:center;">hadoop</p> </td><td style="text-align:center;">2.7.7</td><td style="text-align:center;">192.168.204.52</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">node03</td><td> <p style="text-align:center;">DataNode（已部署）</p> <p style="text-align:center;">NodeManager（已部署）</p> </td><td> <p style="text-align:center;">hadoop</p> </td><td style="text-align:center;">2.7.7</td><td style="text-align:center;">192.168.204.53</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">node04</td><td> <p style="text-align:center;">DataNode（已部署）</p> </td><td> <p style="text-align:center;">hadoop</p> </td><td style="text-align:center;">2.7.7</td><td style="text-align:center;">192.168.204.54</td><td style="text-align:center;">需求迁移主机</td></tr></tbody></table> 
<p></p> 
<p>（2）查看jps</p> 
<p>hadoop节点</p> 
<pre><code class="language-bash">[root@hadoop ~]# jps
</code></pre> 
<p><img alt="" height="162" src="https://images2.imgbox.com/8a/27/3n8p2G3Q_o.png" width="500"></p> 
<p>node01节点</p> 
<p><img alt="" height="149" src="https://images2.imgbox.com/81/36/UrqCttgK_o.png" width="484"></p> 
<p>node02节点</p> 
<p><img alt="" height="140" src="https://images2.imgbox.com/66/ab/WFBA7nDW_o.png" width="424"></p> 
<p>node03节点</p> 
<p><img alt="" height="166" src="https://images2.imgbox.com/ff/d7/eozcqJYt_o.png" width="524"></p> 
<p>node04节点</p> 
<p><img alt="" height="106" src="https://images2.imgbox.com/aa/a3/ryf6TWPU_o.png" width="572"></p> 
<p></p> 
<h3 id="2.HDFS%20%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E7%BC%A9%E5%AE%B9">2.HDFS 集群节点缩容</h3> 
<p>（1）查看节点状态 （已使用）</p> 
<p>node01: 176KB (约等于0.18M )</p> 
<p>node02: 280KB  (约等于0.28M )</p> 
<p>node03: 260KB  (约等于0.26M )</p> 
<p>node04:  8KB （约等于0.008M）</p> 
<pre><code class="language-bash">[root@hadoop hadoop]# ./bin/hdfs dfsadmin -report
Configured Capacity: 822126559232 (765.67 GB)
Present Capacity: 798788423680 (743.93 GB)
DFS Remaining: 798787682304 (743.93 GB)
DFS Used: 741376 (724 KB)
DFS Used%: 0.00%
Under replicated blocks: 0
Blocks with corrupt replicas: 0
Missing blocks: 0
Missing blocks (with replication factor 1): 0

-------------------------------------------------
Live datanodes (4):

Name: 192.168.204.54:50010 (node04)
Hostname: node04
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 8192 (8 KB)
Non DFS Used: 5658730496 (5.27 GB)
DFS Remaining: 199872901120 (186.15 GB)
DFS Used%: 0.00%
DFS Remaining%: 97.25%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 15:16:33 CST 2024


Name: 192.168.204.53:50010 (node03)
Hostname: node03
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 266240 (260 KB)
Non DFS Used: 5620936704 (5.23 GB)
DFS Remaining: 199910436864 (186.18 GB)
DFS Used%: 0.00%
DFS Remaining%: 97.27%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 15:16:33 CST 2024


Name: 192.168.204.51:50010 (node01)
Hostname: node01
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 180224 (176 KB)
Non DFS Used: 6029176832 (5.62 GB)
DFS Remaining: 199502282752 (185.80 GB)
DFS Used%: 0.00%
DFS Remaining%: 97.07%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 15:16:34 CST 2024


Name: 192.168.204.52:50010 (node02)
Hostname: node02
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 286720 (280 KB)
Non DFS Used: 6029291520 (5.62 GB)
DFS Remaining: 199502061568 (185.80 GB)
DFS Used%: 0.00%
DFS Remaining%: 97.07%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 15:16:34 CST 2024
</code></pre> 
<p></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/16/c9/xBDzyblr_o.png" width="605"></p> 
<p>（2）查看</p> 
<pre><code class="language-bash">[root@hadoop ~]# cd /usr/local/hadoop/
[root@hadoop hadoop]# ./bin/hadoop fs -ls /
</code></pre> 
<p><img alt="" height="241" src="https://images2.imgbox.com/bf/4c/Jbv2x9Ug_o.png" width="1093"></p> 
<p>（3）上传第一个测试文件</p> 
<pre><code class="language-bash">[root@hadoop ~]# /usr/local/hadoop/bin/hadoop fs -put /root/jenkins.tar.gz /jenkins.tar.gz
</code></pre> 
<p><img alt="" height="74" src="https://images2.imgbox.com/e8/07/kdX1pUJQ_o.png" width="1200"></p> 
<p>观察上传变化</p> 
<pre><code class="language-bash">[root@hadoop hadoop]# ./bin/hadoop fs -ls /
</code></pre> 
<p><img alt="" height="612" src="https://images2.imgbox.com/e7/48/1iGbOTN5_o.png" width="1200"></p> 
<p></p> 
<p>（4）上传第二个测试文件</p> 
<pre><code class="language-bash">[root@hadoop ~]# /usr/local/hadoop/bin/hadoop fs -put /root/pinpoint-image.tar.gz /pinpoint.tar.gz
</code></pre> 
<p><img alt="" height="61" src="https://images2.imgbox.com/c5/10/ZtDPSrRn_o.png" width="1200"></p> 
<p> 观察上传变化</p> 
<pre><code class="language-bash">[root@hadoop hadoop]# ./bin/hadoop fs -ls /
</code></pre> 
<p><img alt="" height="1123" src="https://images2.imgbox.com/21/b0/MXGNgEgW_o.png" width="1200"></p> 
<p>（5）web查看</p> 
<pre><code class="language-bash">http://192.168.204.50:50070/</code></pre> 
<p><img alt="" height="891" src="https://images2.imgbox.com/ae/69/mEyRPfLM_o.png" width="1200"></p> 
<p></p> 
<p>（6）清空本地文件</p> 
<pre><code class="language-bash">[root@hadoop ~]# rm -rf jenkins.tar.gz pinpoint-image.tar.gz
</code></pre> 
<p><img alt="" height="115" src="https://images2.imgbox.com/28/37/7YM02q0P_o.png" width="1182"></p> 
<p></p> 
<p>（7）再次查看节点状态 （已使用）</p> 
<p>node01: 2.41GB </p> 
<p>node02: 2.27GB </p> 
<p>node03: 2.15GB  </p> 
<p>node04:  2.26GB </p> 
<pre><code class="language-bash">[root@hadoop hadoop]#  ./bin/hdfs dfsadmin -report
Configured Capacity: 822126559232 (765.67 GB)
Present Capacity: 798784053248 (743.93 GB)
DFS Remaining: 789019389952 (734.83 GB)
DFS Used: 9764663296 (9.09 GB)
DFS Used%: 1.22%
Under replicated blocks: 0
Blocks with corrupt replicas: 0
Missing blocks: 0
Missing blocks (with replication factor 1): 0

-------------------------------------------------
Live datanodes (4):

Name: 192.168.204.54:50010 (node04)
Hostname: node04
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2424492032 (2.26 GB)
Non DFS Used: 5662638080 (5.27 GB)
DFS Remaining: 197444509696 (183.88 GB)
DFS Used%: 1.18%
DFS Remaining%: 96.07%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 15:57:57 CST 2024


Name: 192.168.204.53:50010 (node03)
Hostname: node03
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2312085504 (2.15 GB)
Non DFS Used: 5620936704 (5.23 GB)
DFS Remaining: 197598617600 (184.03 GB)
DFS Used%: 1.12%
DFS Remaining%: 96.14%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 15:57:58 CST 2024


Name: 192.168.204.51:50010 (node01)
Hostname: node01
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2592927744 (2.41 GB)
Non DFS Used: 6029148160 (5.62 GB)
DFS Remaining: 196909563904 (183.39 GB)
DFS Used%: 1.26%
DFS Remaining%: 95.80%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 15:57:57 CST 2024


Name: 192.168.204.52:50010 (node02)
Hostname: node02
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2435158016 (2.27 GB)
Non DFS Used: 6029783040 (5.62 GB)
DFS Remaining: 197066698752 (183.53 GB)
DFS Used%: 1.18%
DFS Remaining%: 95.88%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 15:57:59 CST 2024
</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/ad/9e/I5RmIp81_o.png" width="698"></p> 
<p>（8）计算总存储使用量</p> 
<p>9.09 G （jenkins 1.24 GB,pinpoint 3.27 GB ,存储副本量为2）</p> 
<p><img alt="" height="162" src="https://images2.imgbox.com/7a/d9/9WDNLbcC_o.png" width="958"></p> 
<p>(9)修改配置文件（hadoop节点）</p> 
<pre><code class="language-bash">#添加代码

[root@hadoop hadoop]# vim hdfs-site.xml</code></pre> 
<p><img alt="" height="53" src="https://images2.imgbox.com/79/21/iiRLLjyZ_o.png" width="842"></p> 
<p>修改前：</p> 
<p><img alt="" height="785" src="https://images2.imgbox.com/00/99/ocxBB63o_o.png" width="1086"></p> 
<p>修改后：</p> 
<pre><code class="language-bash">……
      &lt;property&gt;
          &lt;name&gt;dfs.hosts.exclude&lt;/name&gt;
          &lt;value&gt;/usr/local/hadoop/etc/hadoop/exclude&lt;/value&gt;
      &lt;/property&gt;
……</code></pre> 
<p><img alt="" height="893" src="https://images2.imgbox.com/fb/15/HsbSlgd0_o.png" width="1095"></p> 
<p></p> 
<p></p> 
<p>（10）配置移除主机</p> 
<pre><code class="language-bash">[root@hadoop hadoop]# vim /usr/local/hadoop/etc/hadoop/exclude
</code></pre> 
<p><img alt="" height="49" src="https://images2.imgbox.com/db/0f/uGTw15cF_o.png" width="1084"></p> 
<pre><code class="language-bash">node04</code></pre> 
<p><img alt="" height="64" src="https://images2.imgbox.com/b1/40/ODhk3oeZ_o.png" width="354"></p> 
<p></p> 
<p>（11）数据刷新</p> 
<pre><code class="language-bash">[root@hadoop hadoop]# ./bin/hdfs dfsadmin -refreshNodes
</code></pre> 
<p><img alt="" height="81" src="https://images2.imgbox.com/d0/e8/chgqdBtZ_o.png" width="1015"></p> 
<p>（12）查看节点状态 </p> 
<p>node04节点状态变为Decommissioned in Program</p> 
<pre><code class="language-bash">[root@hadoop hadoop]#  ./bin/hdfs dfsadmin -report
Configured Capacity: 619019411456 (576.51 GB)
Present Capacity: 600866701319 (559.60 GB)
DFS Remaining: 590966771712 (550.38 GB)
DFS Used: 9899929607 (9.22 GB)
DFS Used%: 1.65%
Under replicated blocks: 2
Blocks with corrupt replicas: 0
Missing blocks: 0
Missing blocks (with replication factor 1): 0

-------------------------------------------------
Live datanodes (4):

Name: 192.168.204.54:50010 (node04)
Hostname: node04
Decommission Status : Decommission in progress
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2424492032 (2.26 GB)
Non DFS Used: 5663162368 (5.27 GB)
DFS Remaining: 197443985408 (183.88 GB)
DFS Used%: 1.18%
DFS Remaining%: 96.06%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 16:34:33 CST 2024


Name: 192.168.204.53:50010 (node03)
Hostname: node03
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2312085504 (2.15 GB)
Non DFS Used: 5756112896 (5.36 GB)
DFS Remaining: 197463441408 (183.90 GB)
DFS Used%: 1.12%
DFS Remaining%: 96.07%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 2
Last contact: Thu Mar 14 16:34:31 CST 2024


Name: 192.168.204.51:50010 (node01)
Hostname: node01
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2592927744 (2.41 GB)
Non DFS Used: 6232051712 (5.80 GB)
DFS Remaining: 196706660352 (183.20 GB)
DFS Used%: 1.26%
DFS Remaining%: 95.71%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 3
Last contact: Thu Mar 14 16:34:33 CST 2024


Name: 192.168.204.52:50010 (node02)
Hostname: node02
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2570424327 (2.39 GB)
Non DFS Used: 6164545529 (5.74 GB)
DFS Remaining: 196796669952 (183.28 GB)
DFS Used%: 1.25%
DFS Remaining%: 95.75%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 2
Last contact: Thu Mar 14 16:34:32 CST 2024


Decommissioning datanodes (1):

Name: 192.168.204.54:50010 (node04)
Hostname: node04
Decommission Status : Decommission in progress
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2424492032 (2.26 GB)
Non DFS Used: 5663162368 (5.27 GB)
DFS Remaining: 197443985408 (183.88 GB)
DFS Used%: 1.18%
DFS Remaining%: 96.06%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 16:34:33 CST 2024
</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/ec/13/q0uW9Kae_o.png" width="712"></p> 
<p><img alt="" height="764" src="https://images2.imgbox.com/f2/ee/rxqcJiml_o.png" width="581"></p> 
<p>(13) 再次查看节点</p> 
<p>node04节点状态变为Decommissioned</p> 
<pre><code class="language-bash">[root@hadoop hadoop]#  ./bin/hdfs dfsadmin -report
Configured Capacity: 619019411456 (576.51 GB)
Present Capacity: 601338761216 (560.04 GB)
DFS Remaining: 589149618176 (548.69 GB)
DFS Used: 12189143040 (11.35 GB)
DFS Used%: 2.03%
Under replicated blocks: 0
Blocks with corrupt replicas: 0
Missing blocks: 0
Missing blocks (with replication factor 1): 0

-------------------------------------------------
Live datanodes (4):

Name: 192.168.204.54:50010 (node04)
Hostname: node04
Decommission Status : Decommissioned
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2424492032 (2.26 GB)
Non DFS Used: 5662666752 (5.27 GB)
DFS Remaining: 197444481024 (183.88 GB)
DFS Used%: 1.18%
DFS Remaining%: 96.07%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 16:42:33 CST 2024


Name: 192.168.204.53:50010 (node03)
Hostname: node03
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 3123707904 (2.91 GB)
Non DFS Used: 5620969472 (5.23 GB)
DFS Remaining: 196786962432 (183.27 GB)
DFS Used%: 1.52%
DFS Remaining%: 95.75%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 16:42:31 CST 2024


Name: 192.168.204.51:50010 (node01)
Hostname: node01
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2998738944 (2.79 GB)
Non DFS Used: 6029717504 (5.62 GB)
DFS Remaining: 196503183360 (183.01 GB)
DFS Used%: 1.46%
DFS Remaining%: 95.61%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 16:42:33 CST 2024


Name: 192.168.204.52:50010 (node02)
Hostname: node02
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 3642204160 (3.39 GB)
Non DFS Used: 6029963264 (5.62 GB)
DFS Remaining: 195859472384 (182.41 GB)
DFS Used%: 1.77%
DFS Remaining%: 95.29%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 16:42:32 CST 2024
</code></pre> 
<p><img alt="" height="594" src="https://images2.imgbox.com/33/d7/XynpP5TE_o.png" width="738"></p> 
<h2 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="1080" src="https://images2.imgbox.com/59/49/OUYiIoWC_o.png" width="587"></h2> 
<p>(14) 重启</p> 
<pre><code class="language-bash">[root@hadoop hadoop]# ssh node04

[root@node04 ~]# reboot

</code></pre> 
<p><img alt="" height="140" src="https://images2.imgbox.com/b4/60/CzHBd7va_o.png" width="852"></p> 
<h2></h2> 
<p>（15）查看节点（已使用）</p> 
<p>node01: 2.79GB </p> 
<p>node02: 3.39GB </p> 
<p>node03: 2.91GB  </p> 
<pre><code class="language-bash">[root@hadoop hadoop]#  ./bin/hdfs dfsadmin -report
Configured Capacity: 619019411456 (576.51 GB)
Present Capacity: 601338118144 (560.04 GB)
DFS Remaining: 589148975104 (548.69 GB)
DFS Used: 12189143040 (11.35 GB)
DFS Used%: 2.03%
Under replicated blocks: 0
Blocks with corrupt replicas: 0
Missing blocks: 0
Missing blocks (with replication factor 1): 0

-------------------------------------------------
Live datanodes (3):

Name: 192.168.204.53:50010 (node03)
Hostname: node03
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 3123707904 (2.91 GB)
Non DFS Used: 5621551104 (5.24 GB)
DFS Remaining: 196786380800 (183.27 GB)
DFS Used%: 1.52%
DFS Remaining%: 95.75%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 17:00:14 CST 2024


Name: 192.168.204.51:50010 (node01)
Hostname: node01
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2998738944 (2.79 GB)
Non DFS Used: 6029742080 (5.62 GB)
DFS Remaining: 196503158784 (183.01 GB)
DFS Used%: 1.46%
DFS Remaining%: 95.61%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 17:00:12 CST 2024


Name: 192.168.204.52:50010 (node02)
Hostname: node02
Decommission Status : Normal
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 3642204160 (3.39 GB)
Non DFS Used: 6030000128 (5.62 GB)
DFS Remaining: 195859435520 (182.41 GB)
DFS Used%: 1.77%
DFS Remaining%: 95.29%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 17:00:12 CST 2024


Dead datanodes (1):

Name: 192.168.204.54:50010 (node04)
Hostname: node04
Decommission Status : Decommissioned
Configured Capacity: 205531639808 (191.42 GB)
DFS Used: 2424492032 (2.26 GB)
Non DFS Used: 5663240192 (5.27 GB)
DFS Remaining: 197443907584 (183.88 GB)
DFS Used%: 1.18%
DFS Remaining%: 96.06%
Configured Cache Capacity: 0 (0 B)
Cache Used: 0 (0 B)
Cache Remaining: 0 (0 B)
Cache Used%: 100.00%
Cache Remaining%: 0.00%
Xceivers: 1
Last contact: Thu Mar 14 16:47:27 CST 2024
</code></pre> 
<p><img alt="" height="941" src="https://images2.imgbox.com/81/af/7jsD817N_o.png" width="650"><img alt="" height="772" src="https://images2.imgbox.com/3d/a3/tzdVVSVJ_o.png" width="577"></p> 
<p>计算总使用量</p> 
<p><img alt="" height="137" src="https://images2.imgbox.com/3e/8c/uTVA6voV_o.png" width="929"></p> 
<p>（16）回顾使用量变化</p> 
<p style="text-align:center;">表2  数据迁移</p> 
<table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td style="text-align:center;">主机</td><td style="text-align:center;">初始</td><td style="text-align:center;width:131px;">上传</td><td style="text-align:center;width:60px;">迁移前</td><td style="text-align:center;width:63px;">迁移后</td><td style="text-align:center;width:137px;">IP</td><td style="text-align:center;">备注</td></tr><tr><td style="text-align:center;">node01</td><td style="text-align:center;">76KB </td><td colspan="1" rowspan="4" style="width:131px;"> <p>jenkins 1.24 GB</p> <p>pinpoint 3.27 GB </p> </td><td style="width:60px;">2.41GB</td><td style="text-align:center;width:63px;">2.79GB </td><td style="text-align:center;width:137px;">192.168.204.51</td><td style="text-align:center;"> <p style="text-align:center;">replication 2</p> <p style="text-align:center;">(副本备份量)</p> </td></tr><tr><td style="text-align:center;">node02</td><td style="text-align:center;">280KB  </td><td style="width:60px;">2.27GB </td><td style="text-align:center;width:63px;">3.39GB </td><td style="text-align:center;width:137px;">192.168.204.52</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">node03</td><td style="text-align:center;">260KB  </td><td style="width:60px;">2.15GB  </td><td style="text-align:center;width:63px;">2.91GB  </td><td style="text-align:center;width:137px;">192.168.204.53</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">node04</td><td style="text-align:center;">8KB </td><td style="width:60px;">2.26GB </td><td style="text-align:center;width:63px;">/</td><td style="text-align:center;width:137px;">192.168.204.54</td><td style="text-align:center;">迁移主机</td></tr><tr><td style="text-align:center;">总大小</td><td style="text-align:center;"></td><td colspan="1" style="width:131px;"></td><td style="width:60px;">9.09GB</td><td style="text-align:center;width:63px;">9.09GB</td><td style="text-align:center;width:137px;"></td><td style="text-align:center;"></td></tr></tbody></table> 
<p></p> 
<p></p> 
<h2 id="%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98">二、问题</h2> 
<h3 id="1.%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E6%9C%89%E5%93%AA%E4%BA%9B%E7%8A%B6%E6%80%81">1.数据迁移有哪些状态</h3> 
<p>（1）状态</p> 
<pre><code class="language-bash">1）正常状态
Normal

2)数据正在迁移
Decommissioned in Progress

3)数据迁移完成 （仅变成当前状态才能down机下线）
Decommissioned
</code></pre> 
<h3 id="2.%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%A4%B1%E8%B4%A5">2.数据迁移失败</h3> 
<p>（1）失败</p> 
<p>迁移node04状态依然为Normal</p> 
<p><img alt="" height="103" src="https://images2.imgbox.com/1b/48/QeVROOxa_o.png" width="715"></p> 
<p>（2）原因分析</p> 
<p>配置错误。</p> 
<p>（3）解决方法</p> 
<p>修改配置。</p> 
<p>修改前：</p> 
<p><img alt="" height="29" src="https://images2.imgbox.com/dc/b3/ZO2LN87T_o.png" width="679"></p> 
<p>修改后：</p> 
<p><img alt="" height="27" src="https://images2.imgbox.com/b2/3b/Tqa9hZhM_o.png" width="480"></p> 
<p>成功：</p> 
<p><img alt="" height="75" src="https://images2.imgbox.com/e6/b3/LIy8maPv_o.png" width="743"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7315b18a346699e6c7d5ca41aed89661/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">pytorch之诗词生成3--utils</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f4106e91d9342cc18cd3729c6855fc7d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">FreeRTOS入门基础</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>