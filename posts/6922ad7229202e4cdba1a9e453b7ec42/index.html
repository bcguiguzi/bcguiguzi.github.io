<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>后端学习：数据库MySQL学习 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="后端学习：数据库MySQL学习" />
<meta property="og:description" content="数据库简介 数据库：英文为 DataBase，简称DB，它是存储和管理数据的仓库。
接下来，我们来学习Mysql的数据模型，数据库是如何来存储和管理数据的。在介绍 Mysql的数据模型之前，需要先了解一个概念：关系型数据库。
关系型数据库（RDBMS）是指建立在关系模型基础上，由多张相互连接的二维表组成的数据库。二维表，指的是由行和列组成的表。
二维表的优点： 使用表存储数据，格式统一，便于维护 使用SQL语言操作，标准统一，使用方便，可用于复杂查询 MySQL是关系型数据库，是基于二维表进行数据存储的，具体的结构图下:
通过MySQL客户端连接数据库管理系统DBMS，然后通过DBMS操作数据库使用MySQL客户端，向数据库管理系统发送一条SQL语句，由数据库管理系统根据SQL语句指令去操作数据库中的表结构及数据。一个数据库服务器中可以创建多个数据库，一个数据库中也可以包含多张表，而一张表中又可以包含多行记录。
在Mysql数据库服务器当中存储数据，你需要： 1. 先去创建数据库（可以创建多个数据库，之间是相互独立的） 2. 在数据库下再去创建数据表（一个数据库下可以创建多张表） 3. 再将数据存放在数据表中（一张表可以存储多行数据） SQL通用语法 SQL：一门操作关系型数据库的编程语言，定义操作所有关系型数据库的统一标准。
SQL语句可以单行或多行书写，以分号结尾。
SQL语句可以使用空格/缩进来增强语句的可读性。
MySQL数据库的SQL语句不区分大小写。
注释：
1.单行注释：-注释内容或#注释内容(MySQL特有)
2.多行注释：/* 注释内容 */
SQL数据类型 MySQL中的数据类型有很多，主要分为三类：数值类型、字符串类型、日期时间类型。
数值类型 类型大小有符号(SIGNED)范围(默认)无符号(UNSIGNED)范围描述TINYINT1byte(-128，127)(0，255)小整数值SMALLINT2bytes(-32768，32767)(0，65535)大整数值MEDIUMINT3bytes(-8388608，8388607)(0，16777215)大整数值INT/INTEGER4bytes(-2147483648，2147483647)(0，4294967295)大整数值BIGINT8bytes(-263， 263-1)(0，264-1)极大整数值FLOAT4bytes(-3.402823466 E&#43;38，3.402823466351 E&#43;38)0 和 (1.175494351 E-38，3.402823466 E&#43;38)单精度浮点数值DOUBLE8bytes(-1.7976931348623157E&#43;308，1.7976931348623157E&#43;308)0 和(2.2250738585072014 E-308，1.7976931348623157E&#43;308)双精度浮点数值DECIMAL依赖于M(精度)和D(标度)的值依赖于M(精度)和D(标度)的值小数值(精确定点数) 字符串类型 类型大小描述CHAR0-255 bytes定长字符串(需要指定长度)VARCHAR0-65535 bytes变长字符串(需要指定长度)TINYBLOB0-255 bytes不超过255个字符的二进制数据TINYTEXT0-255 bytes短文本字符串BLOB0-65 535 bytes二进制形式的长文本数据TEXT0-65 535 bytes长文本数据MEDIUMBLOB0-16 777 215 bytes二进制形式的中等长度文本数据MEDIUMTEXT0-16 777 215 bytes中等长度文本数据LONGBLOB0-4 294 967 295 bytes二进制形式的极大文本数据LONGTEXT0-4 294 967 295 bytes极大文本数据 char 与 varchar 都可以描述字符串，char是定长字符串，指定长度多长，就占用多少个字符，和字段值的长度无关 。而varchar是变长字符串，指定的长度为最大占用长度 。相对来说，char的性能会更高些。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/6922ad7229202e4cdba1a9e453b7ec42/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-27T22:13:33+08:00" />
<meta property="article:modified_time" content="2024-01-27T22:13:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">后端学习：数据库MySQL学习</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>数据库简介</h2> 
<p>  数据库：英文为 DataBase，简称DB，它是存储和管理数据的仓库。<br>   接下来，我们来学习Mysql的数据模型，数据库是如何来存储和管理数据的。在介绍 Mysql的数据模型之前，需要先了解一个概念：关系型数据库。<br>   关系型数据库（RDBMS）是指建立在关系模型基础上，由多张相互连接的二维表组成的数据库。二维表，指的是由行和列组成的表。</p> 
<pre><code>二维表的优点：
	使用表存储数据，格式统一，便于维护
	使用SQL语言操作，标准统一，使用方便，可用于复杂查询
</code></pre> 
<p>MySQL是关系型数据库，是基于二维表进行数据存储的，具体的结构图下:<br> <img src="https://images2.imgbox.com/39/6f/tQp5cSNn_o.png" alt="在这里插入图片描述"><br>   通过MySQL客户端连接数据库管理系统DBMS，然后通过DBMS操作数据库使用MySQL客户端，向数据库管理系统发送一条SQL语句，由数据库管理系统根据SQL语句指令去操作数据库中的表结构及数据。一个数据库服务器中可以创建多个数据库，一个数据库中也可以包含多张表，而一张表中又可以包含多行记录。</p> 
<pre><code>在Mysql数据库服务器当中存储数据，你需要：
	1. 先去创建数据库（可以创建多个数据库，之间是相互独立的）
	2. 在数据库下再去创建数据表（一个数据库下可以创建多张表）
	3. 再将数据存放在数据表中（一张表可以存储多行数据）
</code></pre> 
<h2><a id="SQL_18"></a>SQL通用语法</h2> 
<p>  SQL：一门操作关系型数据库的编程语言，定义操作所有关系型数据库的统一标准。<br>   SQL语句可以单行或多行书写，以分号结尾。</p> 
<p><img src="https://images2.imgbox.com/7b/64/as59pvUU_o.png" alt="在这里插入图片描述"></p> 
<p>  SQL语句可以使用空格/缩进来增强语句的可读性。<br> <img src="https://images2.imgbox.com/cb/dd/1QqchsbH_o.png" alt="在这里插入图片描述"></p> 
<p>  MySQL数据库的SQL语句不区分大小写。<br> <img src="https://images2.imgbox.com/31/a0/CQCScNbZ_o.png" alt="在这里插入图片描述"></p> 
<p>  注释：<br>     1.单行注释：-注释内容或#注释内容(MySQL特有)<br>     2.多行注释：/* 注释内容 */</p> 
<h2><a id="SQL_36"></a>SQL数据类型</h2> 
<p>  MySQL中的数据类型有很多，主要分为三类：数值类型、字符串类型、日期时间类型。</p> 
<h3><a id="_38"></a>数值类型</h3> 
<table><thead><tr><th>类型</th><th>大小</th><th>有符号(SIGNED)范围(默认)</th><th>无符号(UNSIGNED)范围</th><th>描述</th></tr></thead><tbody><tr><td>TINYINT</td><td>1byte</td><td>(-128，127)</td><td>(0，255)</td><td>小整数值</td></tr><tr><td>SMALLINT</td><td>2bytes</td><td>(-32768，32767)</td><td>(0，65535)</td><td>大整数值</td></tr><tr><td>MEDIUMINT</td><td>3bytes</td><td>(-8388608，8388607)</td><td>(0，16777215)</td><td>大整数值</td></tr><tr><td>INT/INTEGER</td><td>4bytes</td><td>(-2147483648，2147483647)</td><td>(0，4294967295)</td><td>大整数值</td></tr><tr><td>BIGINT</td><td>8bytes</td><td>(-2<sup>63</sup>， 2<sup>63</sup>-1)</td><td>(0，2<sup>64</sup>-1)</td><td>极大整数值</td></tr><tr><td>FLOAT</td><td>4bytes</td><td>(-3.402823466 E+38，3.402823466351 E+38)</td><td>0 和 (1.175494351 E-38，3.402823466 E+38)</td><td>单精度浮点数值</td></tr><tr><td>DOUBLE</td><td>8bytes</td><td>(-1.7976931348623157E+308，1.7976931348623157E+308)</td><td>0 和(2.2250738585072014 E-308，1.7976931348623157E+308)</td><td>双精度浮点数值</td></tr><tr><td>DECIMAL</td><td></td><td>依赖于M(精度)和D(标度)的值</td><td>依赖于M(精度)和D(标度)的值</td><td>小数值(精确定点数)</td></tr></tbody></table> 
<h3><a id="_50"></a>字符串类型</h3> 
<table><thead><tr><th>类型</th><th>大小</th><th>描述</th></tr></thead><tbody><tr><td>CHAR</td><td>0-255 bytes</td><td>定长字符串(需要指定长度)</td></tr><tr><td>VARCHAR</td><td>0-65535 bytes</td><td>变长字符串(需要指定长度)</td></tr><tr><td>TINYBLOB</td><td>0-255 bytes</td><td>不超过255个字符的二进制数据</td></tr><tr><td>TINYTEXT</td><td>0-255 bytes</td><td>短文本字符串</td></tr><tr><td>BLOB</td><td>0-65 535 bytes</td><td>二进制形式的长文本数据</td></tr><tr><td>TEXT</td><td>0-65 535 bytes</td><td>长文本数据</td></tr><tr><td>MEDIUMBLOB</td><td>0-16 777 215 bytes</td><td>二进制形式的中等长度文本数据</td></tr><tr><td>MEDIUMTEXT</td><td>0-16 777 215 bytes</td><td>中等长度文本数据</td></tr><tr><td>LONGBLOB</td><td>0-4 294 967 295 bytes</td><td>二进制形式的极大文本数据</td></tr><tr><td>LONGTEXT</td><td>0-4 294 967 295 bytes</td><td>极大文本数据</td></tr></tbody></table> 
<p>  char 与 varchar 都可以描述字符串，char是定长字符串，指定长度多长，就占用多少个字符，和字段值的长度无关 。而varchar是变长字符串，指定的长度为最大占用长度 。相对来说，char的性能会更高些。</p> 
<h3><a id="_65"></a>日期时间类型</h3> 
<table><thead><tr><th>类型</th><th>大小</th><th>范围</th><th>格式</th><th>描述</th></tr></thead><tbody><tr><td>DATE</td><td>3</td><td>1000-01-01 至 9999-12-31</td><td>YYYY-MM-DD</td><td>日期值</td></tr><tr><td>TIME</td><td>3</td><td>-838:59:59 至 838:59:59</td><td>HH:MM:SS</td><td>时间值或持续时间</td></tr><tr><td>YEAR</td><td>1</td><td>1901 至 2155</td><td>YYYY</td><td>年份值</td></tr><tr><td>DATETIME</td><td>8</td><td>1000-01-01 00:00:00 至9999-12-31 23:59:59</td><td>YYYY-MM-DD HH:MM:SS</td><td>混合日期和时间值</td></tr><tr><td>TIMESTAMP</td><td>4</td><td>1970-01-01 00:00:01 至2038-01-19 03:14:07</td><td>YYYY-MM-DD HH:MM:SS</td><td>混合日期和时间值，时间戳</td></tr></tbody></table> 
<h2><a id="SQL_73"></a>SQL语句分类</h2> 
<p>  SQL语句根据其功能被分为四大类：DDL、DML、DQL、DCL</p> 
<p><img src="https://images2.imgbox.com/09/39/BTcKO2WZ_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th>分类</th><th>全称</th><th>说明</th></tr></thead><tbody><tr><td>DDL</td><td>Data Definition Language</td><td>数据定义语言，用来定义数据库对象（数据库，表，字段)</td></tr><tr><td>DML</td><td>Data Manipulation Language</td><td>数据操作语言，用来对数据库表中的数据进行增删改</td></tr><tr><td>DOL</td><td>Data Query Language</td><td>数据查询语言，用来查询数据库中表的记录</td></tr><tr><td>DCL</td><td>Data Control Language</td><td>数据控制语言，用来创建数据库用户、控制数据库的访问权限</td></tr></tbody></table> 
<p>项目开发流程如下：<br> <img src="https://images2.imgbox.com/33/ee/8hBtleLk_o.png" alt="在这里插入图片描述"></p> 
<pre><code>在上述的流程当中，针对于数据库来说，主要包括三个阶段：
	1. 数据库设计阶段：参照页面原型以及需求文档设计数据库表结构
	2. 数据库操作阶段：根据业务功能的实现，编写SQL语句对数据表中的数据进行增删改查操作
	3. 数据库优化阶段：通过数据库的优化来提高数据库的访问性能。
		优化手段：索引、SQL优化、分库分表等
</code></pre> 
<h2><a id="DDL_94"></a>数据库设计-DDL-数据库操作</h2> 
<p>  DDL英文全称是Data Definition Language(数据定义语言)，用来定义数据库对象(数据库、表)。DDL中数据库的常见操作：查询、创建、使用、删除。</p> 
<h3><a id="_97"></a>查询数据库</h3> 
<p>查询所有数据库：show databases;<br> <img src="https://images2.imgbox.com/72/d0/0bcy29cl_o.png" alt="在这里插入图片描述"></p> 
<p>查询当前数据库：select database();<br> 要操作某一个数据库，必须要切换到对应的数据库中。通过指令：select database() ，就可以查询到当前所处的数据库。<br> <img src="https://images2.imgbox.com/c7/a7/xw3GfCxq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_106"></a>创建数据库</h3> 
<p>创建数据库语法：create database if not exists 数据库名;<br> 数据库不存在,则创建该数据库；如果存在则不创建。</p> 
<h3><a id="_111"></a>使用数据库</h3> 
<p>要操作某一个数据库下的表时，就需要通过指令，切换到对应的数据库下，否则不能操作。<br> 使用数据库语法：use 数据库名 ;</p> 
<h3><a id="_114"></a>删除数据库</h3> 
<p>删除数据库语法：drop database if exists 数据库名;<br> 数据库存在时删除</p> 
<h2><a id="DDL_117"></a>数据库设计-DDL-表操作</h2> 
<p>  约束：是指作用在表中字段上的规则，用于<strong>限制存储在表</strong>中的数据。来保证数据库当中数据的正确性、有效性和完整性。</p> 
<p>  在MySQL数据库当中，提供了以下5种约束：</p> 
<table><thead><tr><th>约束</th><th>描述</th><th>关键字</th></tr></thead><tbody><tr><td>非空约束</td><td>限制该字段值不能为null</td><td>not null</td></tr><tr><td>唯一约束</td><td>保证字段的所有数据都是唯一、不重复的</td><td>unique</td></tr><tr><td>主键约束</td><td>主键是一行数据的唯一标识，要求非空且唯</td><td>primary key</td></tr><tr><td>默认约束</td><td>保存数据时，如果未指定该字段值，则采用默认值</td><td>default</td></tr><tr><td>外键约束</td><td>让两张表的数据建立连接，保证数据的一致性和完整性</td><td>foreign key</td></tr></tbody></table> 
<p>主键自增：auto_increment，每次插入新的行记录时，数据库自动生成id字段(主键)下的值具有auto_increment的数据列是一个正数序列开始增长(从1开始自增)。</p> 
<h3><a id="_130"></a>创建表</h3> 
<p><img src="https://images2.imgbox.com/e6/c2/b25228XH_o.png" alt="在这里插入图片描述"></p> 
<pre><code>注意： [ ] 中的内容为可选参数； 最后一个字段后面没有逗号
</code></pre> 
<p>案例：创建tb_user表<br> <img src="https://images2.imgbox.com/58/74/bRhghXQl_o.png" alt="在这里插入图片描述"></p> 
<p>建表语句：</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> tb_user <span class="token punctuation">(</span>
	id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">comment</span> <span class="token string">'ID,唯一标识'</span><span class="token punctuation">,</span>
	username <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">unique</span> <span class="token keyword">comment</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
	name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
	age <span class="token keyword">int</span> <span class="token keyword">comment</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
	gender <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">'男'</span> <span class="token keyword">comment</span> <span class="token string">'性别'</span>
<span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'用户表'</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_149"></a>查询表</h3> 
<pre><code>查询当前数据库所有表：show tables;
查询表结构：desc 表名；
查询建表语句：show create table表名；
</code></pre> 
<p>图形化界面：<br> <img src="https://images2.imgbox.com/75/c1/GAyoRBqn_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_158"></a>修改表</h3> 
<pre><code>添加字段：alter table 表名 add 字段名 类型(长度) [comment注释] [约束]；
修改字段类型：alter table 表名 modify 字段名 新数据类型(长度)；
修改字段名和字段类型：alter table 表名 change l旧字段名 新字段名 类型(长度) [comment注释] [约束]；
删除字段：alter table 表名 drop column 字段名；
修改表名：rename table 表名 to 新表名；
</code></pre> 
<p>图形化界面：添加字段</p> 
<p><img src="https://images2.imgbox.com/5e/2d/moBv7Egf_o.png" alt="在这里插入图片描述"></p> 
<p>图形化界面：修改数据类型和字段名</p> 
<p><img src="https://images2.imgbox.com/98/d9/o1VCOGlK_o.png" alt="在这里插入图片描述"></p> 
<p>图形化界面：删除字段</p> 
<p><img src="https://images2.imgbox.com/be/8e/jNQMvgdA_o.png" alt="在这里插入图片描述"></p> 
<p>图形化界面：修改表名</p> 
<p><img src="https://images2.imgbox.com/c9/bf/4uNj80mg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_183"></a>删除表</h3> 
<pre><code>删除表语法：drop table [ if exists ] 表名;
</code></pre> 
<p>图形化操作：删除表<br> <img src="https://images2.imgbox.com/4a/2a/LDfl5bQh_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="DML_190"></a>数据库操作-DML</h2> 
<p>  DML英文全称是Data Manipulation Language(数据操作语言)，用来对数据库中表的数据记录进行<strong>增、删、改</strong>操作。</p> 
<h3><a id="INSERT_193"></a>添加数据（INSERT）</h3> 
<pre><code>向指定字段添加数据:insert into 表名 (字段名1, 字段名2) values (值1, 值2);
全部字段添加数据:insert into 表名 values (值1, 值2, ...);
批量添加数据（指定字段）:insert into 表名 (字段名1, 字段名2) values (值1, 值2), (值1, 值2);
批量添加数据（全部字段）:insert into 表名 values (值1, 值2, ...), (值1, 值2, ...);
</code></pre> 
<p>案例1：向tb_emp表的username、name、gender字段插入数据</p> 
<pre><code>-- 因为设计表时create_time, update_time两个字段不能为NULL，所以也做为要插入的字段
insert into tb_emp(username, name, gender, create_time, update_time) values ('wuji', '张无忌', 1, now(), now());
</code></pre> 
<p>案例2：向tb_emp表的所有字段插入数据</p> 
<pre><code>insert into tb_emp values (null, 'zhirou', '123', '周芷若', 2, '1.jpg', 1, '2010-01-01',now(), now());
</code></pre> 
<p>案例3：批量向tb_emp表的username、name、gender字段插入数据</p> 
<pre><code>insert into tb_emp(username, name, gender, create_time, update_time)
values ('weifuwang', '韦一笑', 1, now(), now()),('fengzi', '张三疯', 1, now(), now());
</code></pre> 
<p>图形化操作：双击tb_emp表查看数据<br> <img src="https://images2.imgbox.com/26/f1/MHXeb3n9_o.png" alt="在这里插入图片描述"></p> 
<pre><code>Insert操作的注意事项：	
	1. 插入数据时，指定的字段顺序需要与值的顺序是一一对应的。
	2. 字符串和日期型数据应该包含在引号中。
	3. 插入的数据大小，应该在字段的规定范围内。
</code></pre> 
<h3><a id="UPDATE_220"></a>修改数据（UPDATE）</h3> 
<pre><code>update语法：update 表名 set 字段名1 = 值1 , 字段名2 = 值2 , .... [where 条件] ;

案例1：将tb_emp表中id为1的员工，姓名name字段更新为'张三'
update tb_emp set name='张三',update_time=now() where id=1;

注意事项:
	1. 修改语句的条件可以有，也可以没有，如果没有条件，则会修改整张表的所有数据。
	2. 在修改数据时，一般需要同时修改公共字段update_time，将其修改为当前操作时间。
</code></pre> 
<h3><a id="DELETE_230"></a>删除数据（DELETE）</h3> 
<pre><code>delete语法：delete from 表名 [where 条件] ;

案例1：删除tb_emp表中id为1的员工
delete from tb_emp where id = 1;

注意事项:
	• DELETE 语句的条件可以有，也可以没有，如果没有条件，则会删除整张表的所有数据。
	• DELETE 语句不能删除某一个字段的值(可以使用UPDATE，将该字段值置为NULL即可)。
	• 当进行删除全部数据操作时，会提示询问是否确认删除所有数据，直接点击Execute即可。
</code></pre> 
<h2><a id="DQL_242"></a>数据库查询操作-DQL</h2> 
<p>  DQL英文全称是Data Query Language(数据查询语言)，用来查询数据库表中的记录。</p> 
<p>  查询关键字：SELECT</p> 
<p>  查询操作是所有SQL语句当中最为常见，也是最为重要的操作。在一个正常的业务系统中，查询操作的使用频次是要远高于增删改操作的。当打开某个网站或APP所看到的展示信息，都是通过从数据库中查询得到的，而在这个查询过程中，还会涉及到条件、排序、分页等操作。</p> 
<p>  DQL查询语句，语法结构如下：<br> <img src="https://images2.imgbox.com/33/98/uaeE4XTU_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="DQL_251"></a>DQL语句-单表操作</h3> 
<h4><a id="_252"></a>基本查询</h4> 
<pre><code>查询多个字段：select 字段1，字段2，字段3 from 表名;
查询所有字段（通配符）：select*from表名；
设置别名：select字段1[as别名1]，字段2[as别名2]from表名；
去除重复记录：select distinct字段列表from表名；

注：* 号代表查询所有字段，在实际开发中尽量少用（不直观、影响效率）
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment"># 案例1：查询指定字段 name，entrydate并返回</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>entrydate <span class="token keyword">from</span> tb_emp<span class="token punctuation">;</span>

<span class="token comment"># 案例2：查询返回所有字段</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp<span class="token punctuation">;</span>

<span class="token comment"># 案例3：查询所有员工的 name,entrydate，并起别名(姓名、入职日期)</span>
<span class="token keyword">select</span> name <span class="token keyword">as</span> <span class="token string">"姓名"</span> <span class="token punctuation">,</span> entrydate <span class="token keyword">as</span> <span class="token string">"入职日期"</span>  <span class="token keyword">from</span> tb_emp<span class="token punctuation">;</span>

<span class="token comment"># 案例4：查询已有的员工关联了哪几种职位(不要重复)</span>
<span class="token keyword">select</span> <span class="token keyword">distinct</span> job <span class="token keyword">from</span> tb_emp<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="where_274"></a>条件查询(where)</h4> 
<pre><code>语法：select 字段列表 from 表名 where 条件列表 ; 
条件列表：意味着可以有多个条件
</code></pre> 
<p>  学习条件查询就是学习条件的构建方式，而在SQL语句当中构造条件的运算符分为两类：比较运算符、逻辑运算符</p> 
<table><thead><tr><th>比较运算符</th><th>功能</th></tr></thead><tbody><tr><td>&gt;</td><td>大于</td></tr><tr><td>&gt;=</td><td>大于等于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&lt;=</td><td>小于等于</td></tr><tr><td>=</td><td>等于</td></tr><tr><td>&lt;&gt; 或 !=</td><td>不等于</td></tr><tr><td>between … and …</td><td>在某个范围之内(含最小、最大值)</td></tr><tr><td>in(…)</td><td>在in之后的列表中的值，多选一</td></tr><tr><td>like 占位符</td><td>模糊匹配(_匹配单个字符, %匹配任意个字符)</td></tr><tr><td>is null</td><td>是null</td></tr></tbody></table> 
<table><thead><tr><th>逻辑运算符</th><th>功能</th></tr></thead><tbody><tr><td>and 或 &amp;&amp;</td><td>并且 (多个条件同时成立)</td></tr><tr><td>or 或 1</td><td>或者 (多个条件任意一个成立)</td></tr><tr><td>not 或 !</td><td>非 , 不是</td></tr></tbody></table> 
<pre><code class="prism language-sql"><span class="token comment"># 案例1：查询 姓名 为 杨逍 的员工</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'杨逍'</span> <span class="token punctuation">;</span>

<span class="token comment"># 案例2：查询 id小于等于5 的员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> id<span class="token operator">&lt;=</span><span class="token number">5</span> <span class="token punctuation">;</span>

<span class="token comment"># 案例3：查询 没有分配职位 的员工信息</span>
<span class="token comment"># 注意：查询为NULL的数据时，不能使用 = null</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> job <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token punctuation">;</span>

<span class="token comment"># 案例4：查询 有职位 的员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> job <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token punctuation">;</span>

<span class="token comment"># 案例5：查询 密码不等于 '123456' 的员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> password <span class="token operator">!=</span> <span class="token number">123456</span> <span class="token punctuation">;</span>

<span class="token comment"># 案例6：查询 入职日期 在 '2000-01-01' (包含) 到 '2010-01-01'(包含) 之间的员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> entrydate<span class="token operator">&gt;=</span> <span class="token string">'2000-01-01'</span> <span class="token operator">and</span> entrydate<span class="token operator">&lt;=</span> <span class="token string">'2010-01-01'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> entrydate <span class="token operator">between</span> <span class="token string">'2000-01-01'</span> <span class="token operator">and</span> <span class="token string">'2010-01-01'</span><span class="token punctuation">;</span>

<span class="token comment"># 案例7：查询 入职时间 在 '2000-01-01' (包含) 到 '2010-01-01'(包含) 之间 且 性别为女的员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> entrydate <span class="token operator">between</span> <span class="token string">'2000-01-01'</span> <span class="token operator">and</span> <span class="token string">'2010-01-01'</span> <span class="token operator">and</span> gender<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment"># 案例8：查询 职位是 2 (讲师), 3 (学工主管), 4 (教研主管) 的员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> job<span class="token operator">=</span><span class="token number">2</span> <span class="token operator">or</span> job<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">or</span> job<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> job <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 案例9：查询 姓名 为两个字的员工信息</span>
<span class="token comment"># 通配符 "_" 代表任意1个字符</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'__'</span><span class="token punctuation">;</span>

<span class="token comment"># 案例10：查询 姓 '张' 的员工信息</span>
<span class="token comment"># 通配符 "%" 代表任意个字符（0个 ~ 多个）</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'张%'</span><span class="token punctuation">;</span>

</code></pre> 
<h4><a id="_337"></a>聚合函数</h4> 
<p>  之前做的查询都是横向查询，就是根据条件一行一行的进行判断，而使用聚合函数查询就是纵向查询，它是对一列的值进行计算，然后返回一个结果值。（将一列数据作为一个整体，进行纵向计算）</p> 
<pre><code>语法：select 聚合函数(字段列表) from 表名 ;
注意 : 聚合函数会忽略空值，对NULL值不作为统计。
</code></pre> 
<p>常用聚合函数：</p> 
<table><thead><tr><th>函数</th><th>功能</th><th>描述</th></tr></thead><tbody><tr><td>count</td><td>统计数量</td><td>按照列去统计有多少行数据（在根据指定的列统计的时候，如果这一列中有null的行，该行不会被统计在其中）</td></tr><tr><td>max</td><td>最大值</td><td>计算指定列的最大值</td></tr><tr><td>min</td><td>最小值</td><td>计算指定列的最小值</td></tr><tr><td>avg</td><td>平均值</td><td>计算指定列的平均值</td></tr><tr><td>sum</td><td>求和</td><td>计算指定列的数值和，如果不是数值类型，那么计算结果为0</td></tr></tbody></table> 
<pre><code class="prism language-sql"><span class="token comment"># 案例1：统计该企业员工数量</span>
<span class="token comment"># count(字段)</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp <span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp<span class="token punctuation">;</span>

<span class="token comment"># count(常量)</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp<span class="token punctuation">;</span>

<span class="token comment"># count(*) 推荐此写法（MySQL底层进行了优化）</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp<span class="token punctuation">;</span>


<span class="token comment"># 案例2：统计该企业最早入职的员工</span>
<span class="token keyword">select</span>  <span class="token function">min</span><span class="token punctuation">(</span>entrydate<span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp <span class="token punctuation">;</span>

<span class="token comment"># 案例3：统计该企业最迟入职的员工</span>
<span class="token keyword">select</span>  <span class="token function">max</span><span class="token punctuation">(</span>entrydate<span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp <span class="token punctuation">;</span>

<span class="token comment"># 案例4：统计该企业员工 ID 的平均值</span>
<span class="token keyword">select</span>  <span class="token function">avg</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp <span class="token punctuation">;</span>

<span class="token comment"># 案例5：统计该企业员工的 ID 之和</span>
<span class="token keyword">select</span>  <span class="token function">sum</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp <span class="token punctuation">;</span>
</code></pre> 
<h4><a id="group_by_378"></a>分组查询(group by)</h4> 
<p>  分组： 按照某一列或者某几列，把相同的数据进行合并输出。分组其实就是按列进行分类(指定列下相同的数据归为一类)，然后可以对分类完的数据进行合并计算。分组查询通常会使用聚合函数进行计算。</p> 
<pre><code>语法：select 字段列表 from 表名 [where 条件] group by 分组字段名 [having 分组后过滤条件];

注意事项:
	• 分组之后，查询的字段一般为聚合函数和分组字段，查询其他字段无任何意义
	• 执行顺序：where &gt; 聚合函数 &gt; having
	
where与having区别（面试题）
	执行时机不同：where是分组之前进行过滤，不满足where条件，不参与分组；而having是分组之后对结果进行过滤。
	判断条件不同：where不能对聚合函数进行判断，而having可以。
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment"># 案例1：根据性别分组 , 统计男性和女性员工的数量</span>
<span class="token keyword">select</span> gender<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">group</span> <span class="token keyword">by</span> gender <span class="token punctuation">;</span>

<span class="token comment"># 案例2：查询入职时间在 '2015-01-01' (包含) 以前的员工 , 并对结果根据职位分组 , 获取员工数量大于等于2的职位</span>
<span class="token keyword">select</span> job<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_emp
<span class="token comment"># 分组前：筛选出入职时间在'2015-01-01'之前的员工</span>
<span class="token keyword">where</span> entrydate<span class="token operator">&lt;=</span><span class="token string">'2015-01-01'</span>

<span class="token comment"># 按照职位分组(ob字段下相同的数据划分为一组)</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> job

<span class="token comment"># 分组后：筛选出各组中员工数量&gt;=2的（仅保留满足条件的组）</span>
<span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">2</span><span class="token punctuation">;</span>

</code></pre> 
<h4><a id="order_by_408"></a>排序查询(order by)</h4> 
<p>  排序在日常开发中是非常常见的一个操作，有升序排序，也有降序排序。ASC ：升序（默认值）、DESC：降序</p> 
<p><strong>语法：</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> 字段列表
<span class="token keyword">from</span> 表名
<span class="token punctuation">[</span><span class="token keyword">where</span> 条件列表<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">group</span> <span class="token keyword">by</span> 分组字段 <span class="token punctuation">]</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> 字段<span class="token number">1</span> 排序方式<span class="token number">1</span> <span class="token punctuation">,</span> 字段<span class="token number">2</span> 排序方式<span class="token number">2</span> … <span class="token punctuation">;</span>
</code></pre> 
<pre><code>注意事项：如果是多字段排序，当第一个字段值相同时，才会根据第二个字段进行排序
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment"># 案例1：根据入职时间, 对员工进行升序排序</span>
<span class="token comment"># 默认就是ASC（升序）</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">order</span> <span class="token keyword">by</span> entrydate <span class="token keyword">ASC</span> <span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">order</span> <span class="token keyword">by</span> entrydate<span class="token punctuation">;</span>

<span class="token comment"># 案例2：根据入职时间，对员工进行降序排序</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">order</span> <span class="token keyword">by</span> entrydate <span class="token keyword">desc</span> <span class="token punctuation">;</span>

<span class="token comment"># 案例3：根据入职时间对公司的员工进行升序排序，入职时间相同，再按照更新时间进行降序排序</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">order</span> <span class="token keyword">by</span> entrydate  <span class="token punctuation">,</span>update_time <span class="token keyword">desc</span> <span class="token punctuation">;</span>

</code></pre> 
<h4><a id="limit_436"></a>分页查询((limit)</h4> 
<p>  分页操作在业务系统开发时，也是非常常见的一个功能，日常我们在网站中看到的各种各样的分页条，后台也都需要借助于数据库的分页操作。</p> 
<pre><code>分页查询语法：select 字段列表 from 表名 limit 起始索引, 查询记录数 ;
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment"># 案例1：从起始索引0开始查询员工数据, 每页展示5条记录</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">;</span>

<span class="token comment"># 案例2：查询 第1页 员工数据, 每页展示5条记录</span>
<span class="token comment"># 如果查询的是第1页数据，起始索引可以省略，直接简写为：limit 条数</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">limit</span>  <span class="token number">5</span> <span class="token punctuation">;</span>

<span class="token comment"># 案例3：查询 第2页 员工数据, 每页展示5条记录</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">limit</span>  <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token punctuation">;</span>

<span class="token comment"># 案例4：查询 第3页 员工数据, 每页展示5条记录</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">limit</span>  <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span> <span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment">#员工性别统计：</span>
<span class="token comment">-- if(条件表达式, true取值 , false取值)</span>
<span class="token keyword">select</span> <span class="token keyword">if</span><span class="token punctuation">(</span>gender<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'男性员工'</span><span class="token punctuation">,</span><span class="token string">'女性员工'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 性别<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 人数
<span class="token keyword">from</span> tb_emp
<span class="token keyword">group</span> <span class="token keyword">by</span> gender<span class="token punctuation">;</span>


<span class="token comment"># 员工职位统计：</span>
<span class="token comment"># case 表达式 when 值1 then 结果1  when 值2  then 结果2 ...  else result end</span>
<span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">case</span> job
		<span class="token keyword">when</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token string">'班主任'</span>
		<span class="token keyword">when</span> <span class="token number">2</span> <span class="token keyword">then</span> <span class="token string">'讲师'</span>
		<span class="token keyword">when</span> <span class="token number">3</span> <span class="token keyword">then</span> <span class="token string">'学工主管'</span>
		<span class="token keyword">when</span> <span class="token number">4</span> <span class="token keyword">then</span> <span class="token string">'教研主管'</span>
		<span class="token keyword">else</span> <span class="token string">'未分配职位'</span>
	<span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 职位 <span class="token punctuation">,</span>
	<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 人数
<span class="token keyword">from</span> tb_emp
<span class="token keyword">group</span> <span class="token keyword">by</span> job<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="DQL_477"></a>DQL语句-多表操作</h3> 
<h4><a id="_478"></a>多表的设计</h4> 
<p>  关于单表的操作(单表的设计、单表的增删改查)已经学习完了。接下来就要来学习多表的操作，首先来学习多表的设计。项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构，由于业务之间相互关联，所以各个表结构之间也存在着各种联系，基本上分为三种：一对多(多对一)、多对多、一对一</p> 
<h5><a id="_481"></a>一对多(多对一)</h5> 
<p><img src="https://images2.imgbox.com/81/40/GcGtvOlD_o.png" alt="在这里插入图片描述"></p> 
<p>  一对多关系实现：在数据库表中多的一方，添加字段，来关联属于一这方的主键。使用<strong>外键约束</strong>，让两张表的数据建立连接，保证数据的一致性和完整性。<br>   对应的关键字：foreign key</p> 
<pre><code class="prism language-sql">外键约束的语法：
<span class="token comment">-- 创建表时指定</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> 表名<span class="token punctuation">(</span>
	字段名 数据类型<span class="token punctuation">,</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">[</span><span class="token keyword">constraint</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>外键名称<span class="token punctuation">]</span> <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>外键字段名<span class="token punctuation">)</span> 	<span class="token keyword">references</span>
	主表 <span class="token punctuation">(</span>主表列名<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 建完表后，添加外键</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> 表名 <span class="token keyword">add</span> <span class="token keyword">constraint</span> 外键名称 <span class="token keyword">foreign</span> <span class="token keyword">key</span><span class="token punctuation">(</span>外键字段名<span class="token punctuation">)</span> <span class="token keyword">references</span> 主表<span class="token punctuation">(</span>主表列名<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>方式1：通过SQL语句操作</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 修改表： 添加外键约束</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> tb_emp
<span class="token keyword">add</span> <span class="token keyword">constraint</span>  fk_dept_id <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">references</span> tb_dept<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>方式2：图形化界面操作<br> <img src="https://images2.imgbox.com/f7/ad/6aVkMa75_o.png" alt="在这里插入图片描述"></p> 
<pre><code>物理外键：指使用foreign key定义外键关联另外一张表。
	缺点：
		影响增、删、改的效率（需要检查外键关系）。
		仅用于单节点数据库，不适用与分布式、集群场景。
		容易引发数据库的死锁问题，消耗性能。
	
逻辑外键：指在业务层逻辑中，解决外键关联。
	通过逻辑外键，就可以很方便的解决上述问题。
	在现在的企业开发中，很少会使用物理外键，都是使用逻辑外键。 
	甚至在一些数据库开发规范中，会明确指出禁止使用物理外键 foreign key
</code></pre> 
<h5><a id="_523"></a>一对一</h5> 
<p>  一对一关系表在实际开发中应用起来比较简单，通常是用来做<strong>单表拆分</strong>，也就是将一张大表拆分成两张小表，将大表中的一些基础字段放在一张表当中，将其他的字段放在另外一张表当中，以此来提高数据的操作效率。<br>   一对一的应用场景： 用户表(基本信息+身份信息)<br>   其实，一对一我们可以看成一种特殊的一对多。同样，我们也可以通过外键来体现一对一之间的关系，只需要在任意一方来添加一个外键就可<br> 以了。</p> 
<pre><code>一对一 ：在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的(UNIQUE)
</code></pre> 
<p><img src="https://images2.imgbox.com/41/7d/B9yAD5rO_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/f0/b0/rMYUieOO_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_534"></a>多对多</h5> 
<p>  多对多的关系在开发中属于也比较常见的。比如：学生和老师的关系，一个学生可以有多个授课老师，一个授课老师也可以有多个学生。在比如：学生和课程的关系，一个学生可以选修多门课程，一个课程也可以供多个学生选修。</p> 
<pre><code>案例：学生与课程的关系
关系：一个学生可以选修多门课程，一门课程也可以供多个学生选择
实现关系：建立第三张中间表，中间表至少包含两个外键，分别关联两方主键
</code></pre> 
<p><img src="https://images2.imgbox.com/88/2a/lsYaC8wt_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_543"></a>多表查询</h4> 
<p>  多表查询：查询时从多张表中获取所需数据</p> 
<pre><code>单表查询的SQL语句：select 字段列表 from 表名;
多表查询的SQL语句：select 字段列表 from 表1, 表2;

直接使用会出现无效的笛卡尔积，需要给多表查询加上连接查询的条件。
多表查询的SQL语句：select * from 表1, 表2 where 连接条件 ;

如：select * from tb_emp , tb_dept where tb_emp.dept_id = tb_dept.id ;
</code></pre> 
<p>  多表查询可以分为：<strong>连接查询（内连接， 外连接）</strong>、<strong>子查询</strong>。<br>   内连接：相当于查询A、B交集部分数据<br> <img src="https://images2.imgbox.com/45/38/6SVhKcaK_o.png" alt="在这里插入图片描述"></p> 
<p>  外连接：<br>     左外连接：查询 <strong>左表</strong> 所有数据(包括两张表交集部分数据)<br>     右外连接：查询 <strong>右表</strong> 所有数据(包括两张表交集部分数据)</p> 
<h5><a id="_563"></a>连接查询</h5> 
<h6><a id="_564"></a><strong>内连接</strong></h6> 
<p>  内连接查询：查询两表或多表中交集部分数据。<br>   内连接从语法上可以分为：隐式内连接、显式内连接</p> 
<pre><code>隐式内连接：select 字段列表 from 表1 , 表2 where 条件 ... ;
显式内连接：select 字段列表 from 表1 [ inner ] join 表2 on 连接条件 ... ;

多表查询时给表起别名：
	tableA  as 别名1  ,  tableB  as 别名2 ;
	tableA 别名1  ,  tableB 别名2 ;
</code></pre> 
<pre><code class="prism language-sql">案例：查询员工的姓名及所属的部门名称
隐式内连接实现
<span class="token keyword">select</span> tb_emp<span class="token punctuation">.</span>name <span class="token punctuation">,</span> tb_dept<span class="token punctuation">.</span>name <span class="token comment">-- 分别查询两张表中的数据</span>
<span class="token keyword">from</span> tb_emp <span class="token punctuation">,</span> tb_dept <span class="token comment">-- 关联两张表</span>
<span class="token keyword">where</span> tb_emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> tb_dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span> <span class="token comment">-- 消除笛卡尔积</span>

显式内连接实现
<span class="token keyword">select</span> tb_emp<span class="token punctuation">.</span>name <span class="token punctuation">,</span> tb_dept<span class="token punctuation">.</span>name
<span class="token keyword">from</span> tb_emp <span class="token keyword">inner</span> <span class="token keyword">join</span> tb_dept
<span class="token keyword">on</span> tb_emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> tb_dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> 
<h6><a id="_588"></a><strong>外连接</strong></h6> 
<p>  外连接分为两种：左外连接 和 右外连接。</p> 
<pre><code>左外连接语法结构：select 字段列表 from 表1 left [ outer ] join 表2 on 连接条件 ... ;
右外连接语法结构：select 字段列表 from 表1 right [ outer ] join 表2 on 连接条件 ... ;
</code></pre> 
<pre><code class="prism language-sql">案例：查询员工表中所有员工的姓名<span class="token punctuation">,</span> 和对应的部门名称
<span class="token comment">-- 左外连接：以left join关键字左边的表为主表，查询主表中所有数据，以及和主表匹配的右边表中的数据</span>
<span class="token keyword">select</span> emp<span class="token punctuation">.</span>name <span class="token punctuation">,</span> dept<span class="token punctuation">.</span>name
<span class="token keyword">from</span> tb_emp <span class="token keyword">AS</span> emp <span class="token keyword">left</span> <span class="token keyword">join</span> tb_dept <span class="token keyword">AS</span> dept
<span class="token keyword">on</span> emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span>

案例：查询部门表中所有部门的名称<span class="token punctuation">,</span> 和对应的员工名称
<span class="token comment">-- 右外连接</span>
<span class="token keyword">select</span> dept<span class="token punctuation">.</span>name <span class="token punctuation">,</span> emp<span class="token punctuation">.</span>name
<span class="token keyword">from</span> tb_emp <span class="token keyword">AS</span> emp <span class="token keyword">right</span> <span class="token keyword">join</span>  tb_dept <span class="token keyword">AS</span> dept
<span class="token keyword">on</span> emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> 
<pre><code>注意事项：左外连接和右外连接是可以相互替换的，只需要调整连接查询时SQL语句中表的先后顺序就可以了。
		  日常开发使用中，更偏向于左外连接。
		  没有匹配到的数据，填充为null
</code></pre> 
<h5><a id="_613"></a>子查询</h5> 
<p>  SQL语句中嵌套select语句，称为嵌套查询，又称子查询。</p> 
<pre><code>形式：select * from t1 where column1=（select column1 from t2 ……);
子查询外部的语句可以是 insert/update/delete/select 的任何一个，最常见的是select。
</code></pre> 
<h6><a id="_619"></a><strong>标量子查询</strong>（子查询结果为单个值[一行一列]）</h6> 
<p>  子查询返回的结果是单个值(数字、字符串、日期等)，最简单的形式，这种子查询称为标量子查询。<br> 常用的操作符： =、&lt;&gt;、&gt;、&gt;=、&lt;、&lt;=</p> 
<pre><code class="prism language-sql">案例<span class="token number">1</span>：查询<span class="token string">"教研部"</span>的所有员工信息
将需求分解为两步：<span class="token number">1.</span> 查询 <span class="token string">"教研部"</span> 部门ID、<span class="token number">2.</span> 根据 <span class="token string">"教研部"</span> 部门ID，查询员工信息

<span class="token comment">-- 1.查询"教研部"部门ID</span>
<span class="token keyword">select</span> id <span class="token keyword">from</span> tb_dept <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'教研部'</span><span class="token punctuation">;</span>

<span class="token comment">-- 2.根据"教研部"部门ID, 查询员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> dept_id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">-- 合并出上两条SQL语句</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> dept_id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> tb_dept <span class="token keyword">where</span>
name <span class="token operator">=</span> <span class="token string">'教研部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<pre><code class="prism language-sql">案例<span class="token number">2</span>：查询在 <span class="token string">"方东白"</span> 入职之后的员工信息
将需求分解为两步：<span class="token number">1.</span> 查询 方东白 的入职日期、<span class="token number">2.</span> 查询 指定入职日期之后入职的员工信息

<span class="token comment">-- 1.查询"方东白"的入职日期</span>
<span class="token keyword">select</span> entrydate <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'方东白'</span><span class="token punctuation">;</span>

<span class="token comment">-- 2.查询指定入职日期之后入职的员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> entrydate <span class="token operator">&gt;</span> <span class="token string">'2012-11-01'</span><span class="token punctuation">;</span>

<span class="token comment">-- 合并以上两条SQL语句</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> entrydate <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> entrydate <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'方东白'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="_653"></a><strong>列子查询</strong>（子查询结果为一列，但可以是多行）</h6> 
<p>  常用的操作符：</p> 
<table><thead><tr><th>操作符</th><th>描述</th></tr></thead><tbody><tr><td>IN</td><td>在指定的集合范围之内，多选一</td></tr><tr><td>NOT IN</td><td>不在指定的集合范围之内</td></tr></tbody></table> 
<pre><code class="prism language-sql">案例：查询<span class="token string">"教研部"</span>和<span class="token string">"咨询部"</span>的所有员工信息
分解为两步：
	<span class="token number">1.</span> 查询 <span class="token string">"销售部"</span> 和 <span class="token string">"市场部"</span> 的部门ID
	<span class="token number">2.</span> 根据部门ID<span class="token punctuation">,</span> 查询员工信息
	<span class="token number">3.</span> 
<span class="token comment">-- 1.查询"销售部"和"市场部"的部门ID</span>
<span class="token keyword">select</span> id <span class="token keyword">from</span> tb_dept <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'教研部'</span> <span class="token operator">or</span> name <span class="token operator">=</span> <span class="token string">'咨询部'</span><span class="token punctuation">;</span>

<span class="token comment">-- 2.根据部门ID, 查询员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> dept_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 合并以上两条SQL语句</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> dept_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> tb_dept <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'教研部'</span> <span class="token operator">or</span> name <span class="token operator">=</span> <span class="token string">'咨询部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h6><a id="_678"></a><strong>行子查询</strong>（子查询结果为一行，但可以是多列）</h6> 
<p>  常用的操作符：= 、&lt;&gt; 、IN 、NOT IN</p> 
<pre><code class="prism language-sql">案例：查询与<span class="token string">"韦一笑"</span>的入职日期及职位都相同的员工信息
拆解为两步进行：
	<span class="token number">1.</span> 查询 <span class="token string">"韦一笑"</span> 的入职日期 及 职位
	<span class="token number">2.</span> 查询与<span class="token string">"韦一笑"</span>的入职日期及职位相同的员工信息

<span class="token comment">-- 查询"韦一笑"的入职日期 及 职位</span>
<span class="token keyword">select</span> entrydate <span class="token punctuation">,</span> job <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'韦一笑'</span><span class="token punctuation">;</span> <span class="token comment">#查询结果：2007-01-01 , 2</span>

<span class="token comment">-- 查询与"韦一笑"的入职日期及职位相同的员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> <span class="token punctuation">(</span>entrydate<span class="token punctuation">,</span>job<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'2007-01-01'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 合并以上两条SQL语句</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> <span class="token punctuation">(</span>entrydate<span class="token punctuation">,</span>job<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> entrydate <span class="token punctuation">,</span> job <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'韦一笑'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="_697"></a><strong>表子查询</strong>（子查询结果为多行多列[相当于子查询结果是一张表]）</h6> 
<p> &amp;emsp：子查询返回的结果是多行多列，常作为临时表，这种子查询称为表子查询。</p> 
<pre><code class="prism language-sql">查询入职日期是 <span class="token string">"2006-01-01"</span> 之后的员工信息 <span class="token punctuation">,</span> 及其部门信息
分解为两步执行：
	<span class="token number">1.</span> 查询入职日期是 <span class="token string">"2006-01-01"</span> 之后的员工信息
	<span class="token number">2.</span> 基于查询到的员工信息，在查询对应的部门信息
	
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> entrydate <span class="token operator">&gt;</span> <span class="token string">'2006-01-01'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> entrydate <span class="token operator">&gt;</span> <span class="token string">'2006-01-01'</span><span class="token punctuation">)</span> e <span class="token keyword">left</span> <span class="token keyword">join</span> dept d <span class="token keyword">on</span> e<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> d<span class="token punctuation">.</span>id <span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_710"></a>事务</h2> 
<p>  在实际的业务开发中，有些业务操作要多次访问数据库。一个业务要发送多条SQL语句给数据库执行。需要将多次访问数据库的操作视为一个整体来执行，要么所有的SQL语句全部执行成功。如果其中有一条SQL语句失败，就进行事务的回滚，所有的SQL语句全部执行失败。<br>   简而言之：事务是一组操作的集合，它是一个不可分割的工作单位。事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。<br>   事务作用：保证在一个事务中多次操作数据库表中数据时，要么全都成功,要么全都失败。</p> 
<pre><code>MYSQL中有两种方式进行事务的操作：
	1. 自动提交事务：即执行一条sql语句提交一次事务。（默认MySQL的事务是自动提交）
	2. 手动提交事务：先开启，再提交
</code></pre> 
<p>事务操作有关的SQL语句：</p> 
<table><thead><tr><th>SQL语句</th><th>描述</th></tr></thead><tbody><tr><td>start transaction; / begin ;</td><td>开启手动控制事务</td></tr><tr><td>commit;</td><td>提交事务</td></tr><tr><td>rollback;</td><td>回滚事务</td></tr></tbody></table> 
<pre><code>手动提交事务使用步骤：
	第1种情况：开启事务  =&gt; 执行SQL语句   =&gt; 成功  =&gt; 提交事务
	第2种情况：开启事务  =&gt; 执行SQL语句   =&gt; 失败  =&gt; 回滚事务
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment">--开启事务</span>
<span class="token keyword">start</span> <span class="token keyword">transaction</span>

<span class="token comment">--删除部门</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> tb dept <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">--删除部门下的员工</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> tb_emp <span class="token keyword">where</span> deptid <span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">--提交事务</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>

回滚事务
<span class="token keyword">rollback</span>
</code></pre> 
<h2><a id="_747"></a>索引</h2> 
<p>  索引是帮助数据库高效获取数据的数据结构 。简单来讲，就是使用索引可以提高查询的效率。</p> 
<pre><code>使用索引优点：
	1. 提高数据查询的效率，降低数据库的IO成本。
	2. 通过索引列对数据进行排序，降低数据排序的成本，降低CPU消耗。

使用索引缺点：
	1. 索引会占用存储空间。
	2. 索引大大提高了查询效率，同时却也降低了insert、update、delete的效率。
</code></pre> 
<p>  MySQL数据库支持的索引结构有很多，如：Hash索引、B+Tree索引、Full-Text索引等。我们平常所说的索引，如果没有特别指明，都是指默认的 B+Tree 结构组织的索引。</p> 
<pre><code>创建索引：create [ unique ] index 索引名 on 表名 (字段名,... ) ;
</code></pre> 
<pre><code class="prism language-sql">案例：为tb_emp表的name字段建立一个索引
<span class="token keyword">create</span> <span class="token keyword">index</span> idx_emp_name <span class="token keyword">on</span> tb_emp<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

在创建表时，如果添加了主键和唯一约束，就会默认创建：主键索引、唯一约束
</code></pre> 
<pre><code>查看索引：show index from 表名;
</code></pre> 
<pre><code class="prism language-sql">案例：查询 tb_emp 表的索引信息
<span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span>  tb_emp<span class="token punctuation">;</span>
</code></pre> 
<pre><code>删除索引：drop index 索引名 on 表名;
</code></pre> 
<pre><code class="prism language-sql">案例：删除 tb_emp 表中name字段的索引
<span class="token keyword">drop</span> <span class="token keyword">index</span> idx_emp_name <span class="token keyword">on</span> tb_emp<span class="token punctuation">;</span>

注意事项：
	主键字段，在建表时，会自动创建主键索引
	添加唯一约束时，数据库实际上会添加唯一索引
</code></pre> 
<h2><a id="Mybatis_787"></a>Mybatis</h2> 
<p>  在前面学习MySQL数据库时，都是利用图形化客户端工具(如：idea、datagrip)，来操作数据库的。做为后端程序开发人员，通常会使用Java程序来完成对数据库的操作。Java程序操作数据库，现在主流的方式是：Mybatis。</p> 
<p>  MyBatis是一款优秀的 持久层 框架，用于简化JDBC的开发。<br>   持久层：指的是数据访问层(dao)，是用来操作数据库的。<br>   框架：是一个半成品软件，是一套可重用的、通用的、软件基础代码模型。在框架的基础上进行软件开发更加高效、规范、通用、可拓展。</p> 
<h3><a id="Mybatis_794"></a>Mybatis入门</h3> 
<pre><code>Mybatis操作数据库的步骤：
	1. 准备工作(创建springboot工程、数据库表user、实体类User)
	2. 引入Mybatis的相关依赖，配置Mybatis(数据库连接信息)
	3. 编写SQL语句(注解/XML)
</code></pre> 
<p><strong>创建springboot工程：</strong><br> <img src="https://images2.imgbox.com/c2/ab/QQyfElu8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/00/28/1AivUAUE_o.png" alt="在这里插入图片描述"><br> <strong>在数据库中创建表user</strong><br> <img src="https://images2.imgbox.com/ee/f1/OxmRpb4X_o.png" alt="在这里插入图片描述"></p> 
<p><strong>在Java程序中创建实体类User</strong><br> 在创建实体类User时，实体类的属性名与表中的字段名一一对应。<br> <img src="https://images2.imgbox.com/0a/f4/y8WmOlQv_o.png" alt="在这里插入图片描述"></p> 
<p><strong>配置Mybatis</strong></p> 
<pre><code>连接数据库的四大参数：
	MySQL驱动类
	登录名
	密码
	数据库连接字符串
</code></pre> 
<p>  在springboot项目中，可以编写application.properties文件，配置数据库连接信息。要连接数据库，就需要配置数据库连接的基本信息，包括：driver-class-name、url 、username，password。</p> 
<pre><code class="prism language-sql"><span class="token comment">#驱动类名称</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>driver<span class="token operator">-</span>class<span class="token operator">-</span>name<span class="token operator">=</span>com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>Driver
<span class="token comment">#数据库连接的url</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>url<span class="token operator">=</span>jdbc:mysql:<span class="token comment">//localhost:3306/mybatis</span>
<span class="token comment">#连接数据库的用户名</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>username<span class="token operator">=</span>root
<span class="token comment">#连接数据库的密码</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>password<span class="token operator">=</span><span class="token number">1234</span>
</code></pre> 
<p><strong>编写SQL语句</strong><br>   在创建出来的springboot工程中，在引导类所在包下，在创建一个包 mapper。在mapper包下创建一个接口 UserMapper ，这是一个持久层接口（Mybatis的持久层接口规范一般都叫XxxMapper）。</p> 
<p><img src="https://images2.imgbox.com/92/98/3rqjCs9Z_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span> <span class="token comment">// 在运行时，会自动生成该接口的实现类对象，并且将该对象交给IOC容器管理</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//查询所有用户数据</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select id, name, age, gender, phone from user"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Userff</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code>@Mapper注解：表示是mybatis中的Mapper接口
程序运行时：框架会自动生成接口的实现类对象(代理对象)，并给交Spring的IOC容器管理
@Select注解：代表的就是select查询，用于书写select查询语句
</code></pre> 
<p><strong>单元测试</strong></p> 
<p>  在创建出来的SpringBoot工程中，在src下的test目录下，已经自动帮我们创建好了测试类 ，并且在测试类上已经添加了注解 SpringBootTest，代表该测试类已经与SpringBoot整合。该测试类在运行时，会自动通过引导类加载Spring的环境（IOC容器）。我们要测试那个bean对象，就可以直接通过@Autowired注解直接将其注入进行，然后就可以测试了。<br> 测试类代码如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootMybatisQuickstartApplicationTests</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Userff</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Userff</span> user <span class="token operator">:</span> userList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_871"></a>数据库连接池</h4> 
<p>  为了避免频繁的创建连接、销毁连接而带来的资源浪费，mybatis中使用了数据库连接池技术。</p> 
<p>  数据库连接池是个容器，负责分配、管理数据库连接(Connection)。</p> 
<pre><code>数据库连接池的好处：
	1. 资源重用
	2. 提升系统响应速度
	3. 避免数据库连接遗漏
</code></pre> 
<p>  官方(sun)提供了数据库连接池标准（javax.sql.DataSource接口）</p> 
<pre><code>获取连接： public Connection getConnection() throws SQLException;
第三方组织必须按照DataSource接口实现
</code></pre> 
<p>常见的数据库连接池：C3P0、DBCP、Druid、Hikari (springboot默认)<br> 现在使用更多的是：Hikari、Druid （性能更优越）</p> 
<pre><code>如果想把默认的数据库连接池切换为Druid数据库连接池：
1. 在pom.xml文件中引入依赖
	&lt;dependency&gt;
		&lt;!-- Druid连接池依赖 --&gt;
		&lt;groupId&gt;com.alibaba&lt;/groupId&gt;
		&lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;
		&lt;version&gt;1.2.8&lt;/version&gt;
	&lt;/dependency&gt;
	
2.  在application.properties中引入数据库连接配置
	方式1：
		spring.datasource.druid.driver-class-name=com.mysql.cj.jdbc.Driver
		spring.datasource.druid.url=jdbc:mysql://localhost:3306/mybatis
		spring.datasource.druid.username=root
		spring.datasource.druid.password=1234
		
	方式2：
		spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
		spring.datasource.url=jdbc:mysql://localhost:3306/mybatis
		spring.datasource.username=root
		spring.datasource.password=1234
</code></pre> 
<h4><a id="lombok_912"></a>lombok</h4> 
<p>  Lombok是一个实用的Java类库，可以通过简单的注解来简化和消除一些必须有但显得很臃肿的Java代码。</p> 
<p><img src="https://images2.imgbox.com/71/69/9vyFZXo4_o.png" alt="在这里插入图片描述"><br>   通过注解的形式自动生成构造器、getter/setter、equals、hashcode、toString等方法，并可以自动化生成日志变量，简化java开发、提高效率。</p> 
<table><thead><tr><th>注解</th><th>作用</th></tr></thead><tbody><tr><td>@Getter/@Setter</td><td>为所有的属性提供get/set方法</td></tr><tr><td>@ToString</td><td>会给类自动生成易阅读的 toString 方法</td></tr><tr><td>@EqualsAndHashCode</td><td>根据类所拥有的非静态字段自动重写 equals 方法和 hashCode方法</td></tr><tr><td>@Data</td><td>提供了更综合的生成代码功能（@Getter + @Setter +@ToString + EqualsAndHashCode）</td></tr><tr><td>@NoArgsConstructor</td><td>为实体类生成无参的构造器方法</td></tr><tr><td>@AllArgsConstructor</td><td>为实体类生成除了static修饰的字段之外带有各参数的构造器方法。</td></tr></tbody></table> 
<p><strong>lombok依赖</strong></p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>projectlombok<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>lombok<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="Mybatis_936"></a>Mybatis基础操作</h3> 
<h4><a id="_937"></a>删除</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EmpMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//  根据id删除数据,占位符-动态删除</span>
    <span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">"delete from emp where id=#{id}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  如果mapper接口方法形参只有一个普通类型的参数，#{…} 里面的属性名可以随便写，如：#{id}、#{value}。但是建议保持名字一致。</p> 
<h4><a id="_948"></a>日志输入</h4> 
<p>  在Mybatis当中可以借助日志，查看到sql语句的执行、执行传递的参数以及执行结果。</p> 
<pre><code>具体操作如下：
	1. 打开application.properties文件
	2. 开启mybatis的日志，并指定输出到控制台
</code></pre> 
<pre><code class="prism language-java">#指定mybatis输出日志的位置<span class="token punctuation">,</span> 输出控制台
mybatis<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>log<span class="token operator">-</span>impl<span class="token operator">=</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span></span>StdOutImpl</span>
</code></pre> 
<p>  开启日志之后，我们再次运行单元测试，可以看到在控制台中，输出了以下的SQL语句信息：<br> <img src="https://images2.imgbox.com/97/ba/PpGeS7mP_o.png" alt="在这里插入图片描述"></p> 
<p>  我们发现输出的SQL语句：delete from emp where id = ?，输入的参数16并没有在后面拼接，id的值是使用?进行占位。那这种SQL语句我们称为预编译SQL。预编译SQL有两个优势：1. 性能更高、2. 更安全(防止SQL注入)</p> 
<pre><code>性能更高：预编译SQL，编译一次之后会将编译后的SQL语句缓存起来，后面再次执行这条语句时，不会再次编译。（只是输入的参数不同）
更安全(防止SQL注入)：将敏感字进行转义，保障SQL的安全性。
SQL注入：是通过操作输入的数据来修改事先定义好的SQL语句，以达到执行代码对服务器进行攻击的方法。
</code></pre> 
<h4><a id="_968"></a>参数占位符</h4> 
<p>  在Mybatis中提供的参数占位符有两种：${…} 、#{…}</p> 
<pre><code>#{...}
	执行SQL时，会将#{…}替换为?，生成预编译SQL，会自动设置参数值
	使用时机：参数传递，都使用#{…}

${...}
	拼接SQL。直接将参数拼接在SQL语句中，存在SQL注入问题
	使用时机：如果对表名、列表进行动态设置时使用
	
注意事项：在项目开发中，建议使用#{...}，生成预编译SQL，防止SQL注入安全。
</code></pre> 
<h4><a id="_980"></a>新增</h4> 
<pre><code class="prism language-java">SQL语句：
insert into <span class="token function">emp</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> image<span class="token punctuation">,</span> job<span class="token punctuation">,</span> entrydate<span class="token punctuation">,</span>
dept_id<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_time<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token string">'songyuanqiao'</span><span class="token punctuation">,</span><span class="token string">'宋远桥'</span><span class="token punctuation">,</span>
<span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'1.jpg'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'2012-10-09'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'2022-10-01 10:00:00'</span><span class="token punctuation">,</span><span class="token string">'2022-10-01 10:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">接口方法：
<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EmpMapper</span> <span class="token punctuation">{<!-- --></span>
	<span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span>"insert into <span class="token function">emp</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> image<span class="token punctuation">,</span> job<span class="token punctuation">,</span>
	entrydate<span class="token punctuation">,</span> dept_id<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_time<span class="token punctuation">)</span> values <span class="token punctuation">(</span>#<span class="token punctuation">{<!-- --></span>username<span class="token punctuation">}</span><span class="token punctuation">,</span> #
	<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>gender<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>image<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>job<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>entrydate<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>deptId<span class="token punctuation">}</span><span class="token punctuation">,</span> #
	<span class="token punctuation">{<!-- --></span>createTime<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{<!-- --></span>updateTime<span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Emp</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span>

说明：#<span class="token punctuation">{<!-- --></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> 里面写的名称是对象的属性名
</code></pre> 
<pre><code class="prism language-java">测试类：
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">SpringbootMybatisBasicApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建对象</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">EmpMapper</span> empMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建员工对象</span>
        <span class="token class-name">Emp</span> emp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"汤姆"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span><span class="token string">"1.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setJob</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setEntrydate</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setDeptId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        empMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><strong>主键返回</strong>：在数据添加成功后，需要获取插入数据库数据的主键。</p> 
<p>  默认情况下，执行插入操作时，是不会主键值返回的。如果我们想要拿到主键值，需要在Mapper接口中的方法上添加一个Options注解，并在注解中指定属性useGeneratedKeys=true和keyProperty=“实体类属性名”</p> 
<p>主键返回代码实现：</p> 
<pre><code class="prism language-java"><span class="token comment">// 新增员工,参数多-封装成一个对象</span>
    <span class="token comment">//会自动将生成的主键值，赋值给emp对象的id属性</span>
    <span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>keyProperty <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into emp(username, name, gender, image, job,entrydate, dept_id, create_time, update_time) values"</span> <span class="token operator">+</span>
            <span class="token string">" (#{username}, #{name}, #{gender}, #{image}, #{job}, #{entrydate}, #{deptId}, #{createTime}, #{updateTime})"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Emp</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p>测试：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">SpringbootMybatisBasicApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建对象</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">EmpMapper</span> empMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建员工对象</span>
        <span class="token class-name">Emp</span> emp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"tom2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"汤姆2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span><span class="token string">"1.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setJob</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setEntrydate</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setDeptId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        empMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span><span class="token function">getDeptId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="_1078"></a>更新</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span>语句：
<span class="token keyword">update</span> emp <span class="token keyword">set</span> username <span class="token operator">=</span> <span class="token string">'linghushaoxia'</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'令狐少侠'</span><span class="token punctuation">,</span> gender <span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">,</span> 
image <span class="token operator">=</span> <span class="token string">'1.jpg'</span> <span class="token punctuation">,</span> job <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> entrydate <span class="token operator">=</span> <span class="token string">'2012-01-01'</span><span class="token punctuation">,</span> dept_id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
update_time <span class="token operator">=</span> <span class="token string">'2022-10-01 12:12:12'</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
</code></pre> 
<p>接口方法：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 根据id修改员工信息
 */</span>
<span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"update emp set username=#{username}, name=#{name}, gender=#{gender}, image=#{image}, job=#{job},"</span> <span class="token operator">+</span>
        <span class="token string">"entrydate=#{entrydate}, dept_id=#{deptId}, update_time=#{updateTime} where id=#{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Emp</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>测试类：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">SpringbootMybatisBasicApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建对象</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">EmpMapper</span> empMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//要修改的员工信息</span>
        <span class="token class-name">Emp</span> emp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"songdaxia"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"老宋"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span><span class="token string">"2.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setJob</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setEntrydate</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emp<span class="token punctuation">.</span><span class="token function">setDeptId</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用方法，修改员工数据</span>
        empMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_1130"></a>查询</h4> 
<p>SQL语句：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> id<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> image<span class="token punctuation">,</span> job<span class="token punctuation">,</span> entrydate<span class="token punctuation">,</span>dept_id<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_time <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
</code></pre> 
<p>接口方法：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time from emp where id=#{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Emp</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>测试类：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetById</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Emp</span> emp <span class="token operator">=</span> empMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>数据封装</strong><br>   我们看到查询返回的结果中大部分字段是有值的，但是deptId，createTime，updateTime这几个字段是没有值的，而数据库中是有对应的字段值的，这是为什么呢？<br> <img src="https://images2.imgbox.com/cb/23/EdguF2p2_o.png" alt="在这里插入图片描述"></p> 
<pre><code>原因如下：
	实体类属性名和数据库表查询返回的字段名一致，mybatis会自动封装。
	如果实体类属性名和数据库表查询返回的字段名不一致，不能自动封装。
	
解决方案：	
	1. 起别名
	2. 结果映射
	3. 开启驼峰命名
</code></pre> 
<p><strong>起别名</strong>：在SQL语句中，对不一样的列名起别名，别名和实体类属性名一样</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select id, username, password, name, gender, image, job, entrydate, "</span> <span class="token operator">+</span>
            <span class="token string">"dept_id AS deptId, create_time AS createTime, update_time AS updateTime "</span> <span class="token operator">+</span>
            <span class="token string">"from emp "</span> <span class="token operator">+</span><span class="token string">"where id=#{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Emp</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>手动结果映射</strong>：通过 @Results及@Result 进行手动结果映射</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column <span class="token operator">=</span> <span class="token string">"dept_id"</span><span class="token punctuation">,</span> property <span class="token operator">=</span> <span class="token string">"deptId"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column <span class="token operator">=</span> <span class="token string">"create_time"</span><span class="token punctuation">,</span> property <span class="token operator">=</span> <span class="token string">"createTime"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column <span class="token operator">=</span> <span class="token string">"update_time"</span><span class="token punctuation">,</span> property <span class="token operator">=</span> <span class="token string">"updateTime"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select id, username, password, name, gender, image, job,entrydate, "</span> <span class="token operator">+</span>
        <span class="token string">"dept_id, create_time, update_time from emp where id=#{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Emp</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>开启驼峰命名(推荐)</strong>：如果字段名与属性名符合驼峰命名规则，mybatis会自动通过驼峰命名规则映射</p> 
<pre><code class="prism language-java"># 在application<span class="token punctuation">.</span>properties中添加：
mybatis<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>map<span class="token operator">-</span>underscore<span class="token operator">-</span><span class="token keyword">to</span><span class="token operator">-</span>camel<span class="token operator">-</span><span class="token keyword">case</span><span class="token operator">=</span><span class="token boolean">true</span>
</code></pre> 
<p>要使用驼峰命名前提是 实体类的属性 与 数据库表中的字段名严格遵守驼峰命名。</p> 
<p><strong>条件查询</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SQL</span>语句：
<span class="token keyword">select</span> id<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> image<span class="token punctuation">,</span> job<span class="token punctuation">,</span> entrydate<span class="token punctuation">,</span>dept_id<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_time
<span class="token keyword">from</span> emp
<span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'%张%'</span>
<span class="token operator">and</span> gender <span class="token operator">=</span> <span class="token number">1</span>
<span class="token operator">and</span> entrydate <span class="token operator">between</span> <span class="token string">'2010-01-01'</span> <span class="token operator">and</span> <span class="token string">'2020-01-01 '</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> update_time <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre> 
<p>接口方法：</p> 
<pre><code class="prism language-java">方式一
<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EmpMapper</span> <span class="token punctuation">{<!-- --></span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from emp "</span> <span class="token operator">+</span>
		<span class="token string">"where name like '%${name}%' "</span> <span class="token operator">+</span>
		<span class="token string">"and gender = #{gender} "</span> <span class="token operator">+</span>
		<span class="token string">"and entrydate between #{begin} and #{end} "</span> <span class="token operator">+</span>
		<span class="token string">"order by update_time desc"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Emp</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Short</span> gender<span class="token punctuation">,</span> <span class="token class-name">LocalDate</span> begin<span class="token punctuation">,</span><span class="token class-name">LocalDate</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


方式二（解决SQL注入风险）
使用<span class="token class-name">MySQL</span>提供的字符串拼接函数：<span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'%'</span> <span class="token punctuation">,</span> <span class="token string">'关键字'</span> <span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EmpMapper</span> <span class="token punctuation">{<!-- --></span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from emp "</span> <span class="token operator">+</span>
		<span class="token string">"where name like concat('%',#{name},'%') "</span> <span class="token operator">+</span>
		<span class="token string">"and gender = #{gender} "</span> <span class="token operator">+</span>
		<span class="token string">"and entrydate between #{begin} and #{end} "</span> <span class="token operator">+</span>
		<span class="token string">"order by update_time desc"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Emp</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Short</span> gender<span class="token punctuation">,</span> <span class="token class-name">LocalDatebegin</span><span class="token punctuation">,</span> <span class="token class-name">LocalDate</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="MybatisXML_1234"></a>Mybatis的XML配置文件</h3> 
<p>  Mybatis的开发有两种方式：1. 注解、2. XML<br>   使用Mybatis的注解方式，主要是来完成一些简单的增删改查功能。如果需要实现复杂的SQL功能，建议使用XML来配置映射语句，也就是将SQL语句写在XML配置文件中。</p> 
<pre><code>在Mybatis中使用XML映射文件方式开发，需要符合一定的规范：
	1. XML映射文件的名称与Mapper接口名称一致，并且将XML映射文件和Mapper接口放置在相同包下		（同包同名）
	2. XML映射文件的namespace属性为Mapper接口全限定名一致
	3. XML映射文件中sql语句的id与Mapper接口中的方法名一致，并保持返回类型一致。

&lt;select&gt; 标签：就是用于编写select查询语句的。
resultType 属性，指的是查询返回的单条记录所封装的类型。
</code></pre> 
<p><img src="https://images2.imgbox.com/64/95/Ma0QaZwo_o.png" alt="在这里插入图片描述"></p> 
<p><strong>XML配置文件实现</strong><br> 第1步：创建XML映射文件</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE mapper
        PUBLIC <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
        <span class="token string">"https://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mapper namespace<span class="token operator">=</span><span class="token string">"com.example.mapper.EmpMapper"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>查询操作<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"list"</span> resultType<span class="token operator">=</span><span class="token string">"com.example.pojo.Emp"</span><span class="token operator">&gt;</span>
        select <span class="token operator">*</span> from emp where name like <span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">,</span>#<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span> and gender <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>gender<span class="token punctuation">}</span>
        and entrydate between #<span class="token punctuation">{<!-- --></span>begin<span class="token punctuation">}</span> and #<span class="token punctuation">{<!-- --></span>end<span class="token punctuation">}</span> order by update_time desc
    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>mapper<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="MybatisSQL_1267"></a>Mybatis动态SQL</h3> 
<p>  在页面原型中，列表上方的条件是动态的，是可以不传递的，也可以只传递其中的1个或者2个或者全部。SQL语句会随着用户的输入或外部条件的变化而变化，我们称为：动态SQL。</p> 
<h4><a id="SQLif_1271"></a>动态SQL-if</h4> 
<pre><code>&lt;if&gt; ：用于判断条件是否成立。

&lt;if test="条件表达式"&gt;
	要拼接的sql语句
&lt;/if&gt;

&lt;where&gt;
	where元素只会在子元素有内容的情况下才插入where子句，而且会自动去除子句的开头的AND或OR
	
&lt;set&gt;动态地在行首插入 SET 关键字，并会删掉额外的逗号。（用在update语句中）
</code></pre> 
<p><strong>条件查询</strong><br> 示例：把SQL语句改造为动态SQL方式</p> 
<pre><code class="prism language-java">原有的SQL语句<span class="token operator">:</span>
<span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"list"</span> resultType<span class="token operator">=</span><span class="token string">"com.itheima.pojo.Emp"</span><span class="token operator">&gt;</span>
	select <span class="token operator">*</span> from emp
	where name like <span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">,</span>#<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span>
		and gender <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>gender<span class="token punctuation">}</span>
		and entrydate between #<span class="token punctuation">{<!-- --></span>begin<span class="token punctuation">}</span> and #<span class="token punctuation">{<!-- --></span>end<span class="token punctuation">}</span>
	order by update_time desc
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>

动态SQL语句<span class="token operator">:</span>
<span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"list"</span> resultType<span class="token operator">=</span><span class="token string">"com.itheima.pojo.Emp"</span><span class="token operator">&gt;</span>
	select <span class="token operator">*</span> from emp
	<span class="token generics"><span class="token punctuation">&lt;</span>where<span class="token punctuation">&gt;</span></span>
		<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"name != null"</span><span class="token operator">&gt;</span>
			name like <span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">,</span>#<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
		
		<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"gender != null"</span><span class="token operator">&gt;</span>
			and gender <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>gender<span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
		
		<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"begin != null and end != null"</span><span class="token operator">&gt;</span>
			and entrydate between #<span class="token punctuation">{<!-- --></span>begin<span class="token punctuation">}</span> and #<span class="token punctuation">{<!-- --></span>end<span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>where<span class="token operator">&gt;</span>
	order by update_time desc
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>更新操作<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>update id<span class="token operator">=</span><span class="token string">"update"</span><span class="token operator">&gt;</span>
update emp
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用set标签，代替update语句中的set关键字 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>set<span class="token punctuation">&gt;</span></span>
	<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"username != null"</span><span class="token operator">&gt;</span>
		username<span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>username<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"name != null"</span><span class="token operator">&gt;</span>
		name<span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"gender != null"</span><span class="token operator">&gt;</span>
		gender<span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>gender<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"image != null"</span><span class="token operator">&gt;</span>
		image<span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>image<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"job != null"</span><span class="token operator">&gt;</span>
		job<span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>job<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"entrydate != null"</span><span class="token operator">&gt;</span>
		entrydate<span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>entrydate<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"deptId != null"</span><span class="token operator">&gt;</span>
		dept_id<span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>deptId<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"updateTime != null"</span><span class="token operator">&gt;</span>
		update_time<span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>updateTime<span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span><span class="token operator">/</span>set<span class="token operator">&gt;</span>
	where id<span class="token operator">=</span>#<span class="token punctuation">{<!-- --></span>id<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>update<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="SQLforeach_1359"></a>动态SQL-foreach</h4> 
<p>应用场景：删除功能（既支持删除单条记录，又支持批量删除）</p> 
<pre><code>使用 &lt;foreach&gt; 遍历指定方法中传递的参数集合
&lt;foreach collection="" item="" separator="" open="" close=""&gt; &lt;/foreach&gt;

collection:遍历的集合
item:遍历出来的元素
separator:分隔符
open:遍历开始前拼接的SQL片段
close：遍历结束后拼接的SQ工片段
</code></pre> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>批量删除操作<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>delete id<span class="token operator">=</span><span class="token string">"deleteByIds"</span><span class="token operator">&gt;</span>
	delete from emp where id in
	<span class="token operator">&lt;</span>foreach collection<span class="token operator">=</span><span class="token string">"ids"</span> item<span class="token operator">=</span><span class="token string">"id"</span> separator<span class="token operator">=</span><span class="token string">","</span> <span class="token keyword">open</span><span class="token operator">=</span><span class="token string">"("</span>	close<span class="token operator">=</span><span class="token string">")"</span><span class="token operator">&gt;</span>
		#<span class="token punctuation">{<!-- --></span>id<span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>foreach<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>delete<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="SQLsqlinclude_1382"></a>动态SQL-sql、include</h4> 
<p>  在xml映射文件中配置的SQL，有时可能会存在很多重复的片段，此时就会存在很多冗余的代码。可以对重复的代码片段进行抽取，将其通过 标签封装到一个SQL片段，然后再通过 &lt; include &gt; 标签进行引用。</p> 
<pre><code>&lt;sql&gt; ：定义可重用的SQL片段
&lt;include&gt; ：通过属性refid，指定包含的SQL片段
</code></pre> 
<p>SQL片段： 抽取重复的代码</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>sql id<span class="token operator">=</span><span class="token string">"commonSelect"</span><span class="token operator">&gt;</span>
	select id<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> name<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> image<span class="token punctuation">,</span> job<span class="token punctuation">,</span> entrydate<span class="token punctuation">,</span> dept_id<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_time from emp
<span class="token operator">&lt;</span><span class="token operator">/</span>sql<span class="token operator">&gt;</span>
</code></pre> 
<pre><code>通过 &lt;include&gt; 标签在原来抽取的地方进行引用
</code></pre> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"list"</span> resultType<span class="token operator">=</span><span class="token string">"com.itheima.pojo.Emp"</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>include refid<span class="token operator">=</span><span class="token string">"commonSelect"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token generics"><span class="token punctuation">&lt;</span>where<span class="token punctuation">&gt;</span></span>
		<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"name != null"</span><span class="token operator">&gt;</span>
			name like <span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">,</span>#<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">)</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
		
		<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"gender != null"</span><span class="token operator">&gt;</span>
			and gender <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>gender<span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
		
		<span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">"begin != null and end != null"</span><span class="token operator">&gt;</span>
			and entrydate between #<span class="token punctuation">{<!-- --></span>begin<span class="token punctuation">}</span> and #<span class="token punctuation">{<!-- --></span>end<span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">&gt;</span>
		
	<span class="token operator">&lt;</span><span class="token operator">/</span>where<span class="token operator">&gt;</span>
	order by update_time desc
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eecf6e1cd12c1f6917f7def95cc3225c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Golang协程池ants使用笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b39a64daf235b3b05c5e8e088dad3d26/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数据分享】1929-2023年全球站点的逐日平均气温数据（Shp\Excel\免费获取）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>