<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>内容分发网络（CDN） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="内容分发网络（CDN）" />
<meta property="og:description" content="文章目录 一、简介二、原理1. DNS解析2. 使用CDN后的DNS解析3. 负载均衡系统4. 分发服务系统5. 总结 三、作用1. 性能2. 安全 四、使用场景1. 第三方的CDN服务2. 静态资源的缓存3. 直播传送 五、总结五、总结 一、简介 CDN (全称 Content Delivery Network)，即内容分发网络。
构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN 的关键技术主要有内容存储和分发技术。
简单来讲，CDN就是根据用户位置分配最近的资源。
于是，用户在上网的时候不用直接访问源站，而是访问离他“最近的”一个 CDN 节点，术语叫边缘节点，其实就是缓存了源站内容的代理服务器。如下图：
二、原理 1. DNS解析 CDN和DNS有着密不可分的联系，先来看一下DNS的解析域名过程，在浏览器输入 www.test.com 的解析过程如下：
（1） 检查浏览器缓存
（2）检查操作系统缓存，常见的如hosts文件
（3）检查路由器缓存
（4）如果前几步都没没找到，会向ISP(网络服务提供商)的LDNS服务器查询
（5）如果LDNS服务器没找到，会向根域名服务器(Root Server)请求解析，分为以下几步：
根服务器返回顶级域名(TLD)服务器如.com，.cn，.org等的地址，该例子中会返回.com的地址接着向顶级域名服务器发送请求，然后会返回次级域名(SLD)服务器的地址，本例子会返回.test的地址。接着向次级域名服务器发送请求，然后会返回通过域名查询到的目标IP，本例子会返回www.test.com的地址。Local DNS Server会缓存结果，并返回给用户，缓存在系统中。 2. 使用CDN后的DNS解析 未使用CDN缓存
浏览器通过DNS对域名进行解析，依次得到此域名对应的IP地址浏览器根据得到的IP地址，向域名的服务主机发送数据请求服务器向浏览器返回响应数据 使用CDN缓存资源
对于点击的数据的URL，经过本地DNS系统的解析，发现该URL对应的是一个CDN专用的DNS服务器，DNS系统就会将域名解析权交给CNAME指向的CDN专用的DNS服务器。CND专用DNS服务器将CND的全局负载均衡设备IP地址返回给用户用户向CDN的全局负载均衡设备发起数据请求CDN的全局负载均衡设备根据用户的IP地址，以及用户请求的内容URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求区域负载均衡设备选择一台合适的缓存服务器来提供服务，将该缓存服务器的IP地址返回给全局负载均衡设备全局负载均衡设备把服务器的IP地址返回给用户用户向该缓存服务器发起请求，缓存服务器响应用户的请求，将用户所需内容发送至用户终端。 如果缓存服务器没有用户想要的内容，那么缓存服务器就会向它的上一级缓存服务器请求内容，以此类推，直到获取到需要的资源。最后如果还是没有，就会回到自己的服务器去获取资源。
CNAME（意为：别名）：在域名解析中，实际上解析出来的指定域名对应的IP地址，或者该域名的一个CNAME，然后再根据这个CNAME来查找对应的IP地址。
3. 负载均衡系统 由于没有返回IP地址，于是本地DNS会向负载均衡系统再发送请求 ，则进入到CDN的全局负载均衡系统进行智能调度：
看用户的 IP 地址，查表得知地理位置，找相对最近的边缘节点看用户所在的运营商网络，找相同网络的边缘节点检查边缘节点的负载情况，找负载较轻的节点其他，比如节点的“健康状况”、服务能力、带宽、响应时间等 总结，得到最合适的边缘节点，然后把这个节点的IP返回给用户，用户就能够就近访问CDN的缓存代理。
整体流程如下图：
4. 分发服务系统 最基本的工作单元就是Cache设备，cache（边缘cache）负责直接响应最终用户的访问请求，把缓存在本地的内容快速地提供给用户。cache还负责与源站点进行内容同步，把更新的内容以及本地没有的内容从源站点获取并保存在本地。Cache设备的数量、规模、总服务能力是衡量一个CDN系统服务能力的最基本的指标。 5. 总结 应用CDN前： 用户提交域名→浏览器对域名进行解释→DNS 解析得到目的主机的IP地址→根据IP地址访问发出请求→得到请求数据并回复 应用CDN后： DNS 返回的不再是 IP 地址，而是一个CNAME(Canonical Name ) 别名记录，指向CDN的全局负载均衡。CNAME实际上在域名解析的过程中承担了中间人（或者说代理）的角色，这是CDN实现的关键。 三、作用 CDN一般会用来托管Web资源（包括文本、图片和脚本等），可供下载的资源（媒体文件、软件、文档等），应用程序（门户网站等）。使用CDN来加速这些资源的访问。 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/31855f0e9d48612f2a537f18783fbe11/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-15T00:08:23+08:00" />
<meta property="article:modified_time" content="2022-10-15T00:08:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">内容分发网络（CDN）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">一、简介</a></li><li><a href="#_13" rel="nofollow">二、原理</a></li><li><ul><li><a href="#1_DNS_15" rel="nofollow">1. DNS解析</a></li><li><a href="#2_CDNDNS_34" rel="nofollow">2. 使用CDN后的DNS解析</a></li><li><a href="#3__58" rel="nofollow">3. 负载均衡系统</a></li><li><a href="#4__73" rel="nofollow">4. 分发服务系统</a></li><li><a href="#5__79" rel="nofollow">5. 总结</a></li></ul> 
   </li><li><a href="#_87" rel="nofollow">三、作用</a></li><li><ul><li><a href="#1__91" rel="nofollow">1. 性能</a></li><li><a href="#2__101" rel="nofollow">2. 安全</a></li></ul> 
   </li><li><a href="#_112" rel="nofollow">四、使用场景</a></li><li><ul><li><a href="#1_CDN_114" rel="nofollow">1. 第三方的CDN服务</a></li><li><a href="#2__118" rel="nofollow">2. 静态资源的缓存</a></li><li><a href="#3__122" rel="nofollow">3. 直播传送</a></li></ul> 
   </li><li><a href="#_127" rel="nofollow">五、总结</a></li><li><a href="#_134" rel="nofollow">五、总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>一、简介</h3> 
<p>CDN (全称 Content Delivery Network)，即<strong>内容分发网络</strong>。</p> 
<p>构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。<code>CDN</code> 的关键技术主要有内容存储和分发技术。</p> 
<p><strong>简单来讲，<code>CDN</code>就是根据用户位置分配最近的资源</strong>。</p> 
<p>于是，用户在上网的时候不用直接访问源站，而是访问离他“最近的”一个 CDN 节点，术语叫<strong>边缘节点</strong>，其实就是缓存了源站内容的代理服务器。如下图：</p> 
<p><img src="https://images2.imgbox.com/6c/ad/9lZtnsAJ_o.png" alt="img"></p> 
<h3><a id="_13"></a>二、原理</h3> 
<h4><a id="1_DNS_15"></a>1. DNS解析</h4> 
<p>CDN和DNS有着密不可分的联系，先来看一下DNS的解析域名过程，在浏览器输入 www.test.com 的解析过程如下：</p> 
<p>（1） 检查浏览器缓存</p> 
<p>（2）检查操作系统缓存，常见的如hosts文件</p> 
<p>（3）检查路由器缓存</p> 
<p>（4）如果前几步都没没找到，会向ISP(网络服务提供商)的LDNS服务器查询</p> 
<p>（5）如果LDNS服务器没找到，会向根域名服务器(Root Server)请求解析，分为以下几步：</p> 
<ul><li>根服务器返回顶级域名(TLD)服务器如<code>.com</code>，<code>.cn</code>，<code>.org</code>等的地址，该例子中会返回<code>.com</code>的地址</li><li>接着向顶级域名服务器发送请求，然后会返回次级域名(SLD)服务器的地址，本例子会返回<code>.test</code>的地址。</li><li>接着向次级域名服务器发送请求，然后会返回通过域名查询到的目标IP，本例子会返回<code>www.test.com</code>的地址。</li><li>Local DNS Server会缓存结果，并返回给用户，缓存在系统中。</li></ul> 
<h4><a id="2_CDNDNS_34"></a>2. 使用CDN后的DNS解析</h4> 
<p><strong>未使用CDN缓存</strong></p> 
<ol><li>浏览器通过DNS对域名进行解析，依次得到此域名对应的IP地址</li><li>浏览器根据得到的IP地址，向域名的服务主机发送数据请求</li><li>服务器向浏览器返回响应数据</li></ol> 
<p><strong>使用CDN缓存资源</strong></p> 
<ol><li>对于点击的数据的URL，经过本地DNS系统的解析，发现该URL对应的是一个CDN专用的DNS服务器，DNS系统就会将域名解析权交给CNAME指向的CDN专用的DNS服务器。</li><li>CND专用DNS服务器将CND的全局负载均衡设备IP地址返回给用户</li><li>用户向CDN的全局负载均衡设备发起数据请求</li><li>CDN的全局负载均衡设备根据用户的IP地址，以及用户请求的内容URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求</li><li>区域负载均衡设备选择一台合适的缓存服务器来提供服务，将该缓存服务器的IP地址返回给全局负载均衡设备</li><li>全局负载均衡设备把服务器的IP地址返回给用户</li><li>用户向该缓存服务器发起请求，缓存服务器响应用户的请求，将用户所需内容发送至用户终端。</li></ol> 
<p>如果缓存服务器没有用户想要的内容，那么缓存服务器就会向它的上一级缓存服务器请求内容，以此类推，直到获取到需要的资源。最后如果还是没有，就会回到自己的服务器去获取资源。</p> 
<p><img src="https://images2.imgbox.com/d4/5f/SCuwvgf3_o.png" alt="https://cdn.nlark.com/yuque/0/2020/png/1500604/1603966294889-153271b5-4b9f-4470-b05f-c7a9f030d043.png?x-oss-process=image%2Fresize%2Cw_1500"></p> 
<p>CNAME（意为：别名）：在域名解析中，实际上解析出来的指定域名对应的IP地址，或者该域名的一个CNAME，然后再根据这个CNAME来查找对应的IP地址。</p> 
<h4><a id="3__58"></a>3. 负载均衡系统</h4> 
<p>由于没有返回<code>IP</code>地址，于是本地<code>DNS</code>会向负载均衡系统再发送请求 ，则进入到<code>CDN</code>的全局负载均衡系统进行智能调度：</p> 
<ul><li>看用户的 IP 地址，查表得知地理位置，找相对最近的边缘节点</li><li>看用户所在的运营商网络，找相同网络的边缘节点</li><li>检查边缘节点的负载情况，找负载较轻的节点</li><li>其他，比如节点的“健康状况”、服务能力、带宽、响应时间等</li></ul> 
<p>总结，<strong>得到最合适的边缘节点，然后把这个节点的IP返回给用户，用户就能够就近访问<code>CDN</code>的缓存代理</strong>。</p> 
<p>整体流程如下图：</p> 
<p><img src="https://images2.imgbox.com/03/5b/SH0USlsr_o.png" alt="img"></p> 
<h4><a id="4__73"></a>4. 分发服务系统</h4> 
<ul><li>最基本的工作单元就是Cache设备，cache（边缘cache）负责直接响应最终用户的访问请求，把缓存在本地的内容快速地提供给用户。</li><li>cache还负责与源站点进行内容同步，把更新的内容以及本地没有的内容从源站点获取并保存在本地。</li><li>Cache设备的数量、规模、总服务能力是衡量一个CDN系统服务能力的最基本的指标。</li></ul> 
<h4><a id="5__79"></a>5. 总结</h4> 
<ul><li>应用<code>CDN</code>前： 
  <ul><li>用户提交域名→浏览器对域名进行解释→<code>DNS</code> 解析得到目的主机的IP地址→根据IP地址访问发出请求→得到请求数据并回复</li></ul> </li><li>应用<code>CDN</code>后： 
  <ul><li><code>DNS</code> 返回的不再是 <code>IP</code> 地址，而是一个<code>CNAME</code>(Canonical Name ) 别名记录，指向<code>CDN</code>的全局负载均衡。</li><li><code>CNAME</code>实际上在域名解析的过程中承担了中间人（或者说代理）的角色，这是<code>CDN</code>实现的关键。</li></ul> </li></ul> 
<h3><a id="_87"></a>三、作用</h3> 
<ul><li>CDN一般会用来托管Web资源（包括文本、图片和脚本等），可供下载的资源（媒体文件、软件、文档等），应用程序（门户网站等）。使用CDN来加速这些资源的访问。</li></ul> 
<h4><a id="1__91"></a>1. 性能</h4> 
<ul><li> <p><strong>提升用户体验</strong></p> <p>用户收到的内容来自最近的数据中心，延迟更低，内容加载更快</p> </li><li> <p><strong>减轻服务器负载</strong></p> <p>部分资源请求分配给了CDN，减少了服务器的负载</p> </li></ul> 
<h4><a id="2__101"></a>2. 安全</h4> 
<p>CDN有助于防御DDoS、MITM等网络攻击：</p> 
<ul><li>针对DDoS：通过监控分析异常流量，限制其请求频率</li><li>针对MITM：从源服务器到 CDN 节点到 ISP（Internet Service Provider），全链路 HTTPS 通信。</li></ul> 
<p>除此之外，CDN作为一种基础的云服务，同样具有资源托管、按需扩展（能够应对流量高峰）等方面的优势。</p> 
<h3><a id="_112"></a>四、使用场景</h3> 
<h4><a id="1_CDN_114"></a>1. 第三方的CDN服务</h4> 
<ul><li>如果想要开源一些项目，可以使用第三方的CDN服务。</li></ul> 
<h4><a id="2__118"></a>2. 静态资源的缓存</h4> 
<ul><li>将自己网站的静态资源放在CDN上，比如js、css、图片等。</li></ul> 
<h4><a id="3__122"></a>3. 直播传送</h4> 
<ul><li>直播本质上是使用流媒体进行传送，CDN也是支持流媒体传送的，所以直播完全可以使用CDN来提高访问速度。</li><li>CDN在处理流媒体的时候与处理普通静态文件有所不同，普通文件如果在边缘节点没有找到的话，就会去上一层接着寻找，但是流媒体本身数据量就非常大。如果使用回源的方式，必然会带来性能问题，所以流媒体一般采用的都是主动推送的方式来进行。</li></ul> 
<h3><a id="_127"></a>五、总结</h3> 
<ul><li>CDN的目的是：提高网站的访问速度</li><li>让用户就近访问专网里的边缘节点，降低了传输延迟</li><li>负载均衡系统——智能调度边缘节点<br> 量就非常大。如果使用回源的方式，必然会带来性能问题，所以流媒体一般采用的都是主动推送的方式来进行。</li></ul> 
<h3><a id="_134"></a>五、总结</h3> 
<ul><li>CDN的目的是：提高网站的访问速度</li><li>让用户就近访问专网里的边缘节点，降低了传输延迟</li><li>负载均衡系统——智能调度边缘节点</li><li>分发服务系统——同步（源站点）内容，响应（用户）请求</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a54bcc219ec7db9c585b37629b97ddab/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL 索引结构用B&#43;树的原因</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/de4e6c7340aa3e9cb7b7209ca6653bef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">记录｜ mac M1 homebrew安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>