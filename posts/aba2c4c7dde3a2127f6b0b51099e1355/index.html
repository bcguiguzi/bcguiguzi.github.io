<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JavaWeb（8）之Cookie&amp;Session - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="JavaWeb（8）之Cookie&amp;Session" />
<meta property="og:description" content="会话技术的概述 什么是会话 会话简单理解为:用户打开一个浏览器，点击多个超链接访问服务器的web资源,然后关闭浏览器，整个过程称为是一次会话。
为什么要学习会话技术 每个用户与服务器进行交互过程中，产生一些各自的数据,程序想要把这些数据进行保存，就需要使用会话技术。
例如：用户点击超链接购买一个商品, 程序应该保存用户所购买的商品，以便于用户点击结账可以得到用户所购买的商品信息。
思考：用户购买的商品保存在request或ServletContext中是否可以?
答案是不可以的。
会话技术的分类 session和cookie作用原理、区别
Cookie技术 Cookie是客户端技术，程序把每个用户的数据以cookie的形式保存到各自浏览器中。当用户使用浏览器再次访问服务器中的web资源的时候，就会带着各自的数据（cookie）过去。这样, web资源处理的就是用户各自的数据（cookie）了。
Cookie技术的实现原理 Http Cookie机制及Cookie的实现原理
客户端请求服务器后，如果服务器需要记录用户状态，服务器会在响应信息中包含一个Set-Cookie的响应头，客户端会根据这个响应头存储Cookie信息。再次请求服务器时，客户端会在请求信息中包含一个Cookie请求头，而服务器会根据这个请求头进行用户身份、状态等较验。
当用户访问一个网站需要登录，输入完账号和密码点击登录后，发送请求到服务器，服务器接收到请求后记录用户的登录状态（账号密码），响应是就会在响应头中携带一个Set-Cookie字段（账号密码），客户端接收到响应后就会在本地（内存或硬盘）中储存Set-Cookie字段，当再次请求时，将会在请求头中包含服务器响应的Cookie信息，因此用户再次访问网站时就不需要登录了。
Session技术 Session是服务器端技术,利用这个技术，服务器在运行时为每一个用户的浏览器创建一个独享的session对象。
由于session为用户浏览器独享,所有用户在访问服务器的时候，可以把各自的数据放在各自的session 中,当用户再次访问服务器中的web资源的时候，其他web资源再从用户各自的session中取出数据为用户服务。
Session技术的实现原理 Session的原理
记录用户上次的访问时间 分析需求和流程 记录用户上次访问时间的代码实现 获得从浏览器带过来的Cookie 通过HTTPServletRequest对象中的方法：
想浏览器回写Cookie 通过HTTPServletResponse对象中的方法：
Cookie的构造 案例代码实现 创建一个web项目
创建包结构 代码实现 编写工具类：
/** * 查找指定名称Cookie的工具类 * * @author 25858 * */ public class CookieUtils { public static Cookie findCookie(Cookie[] cookies, String name) { if (cookies == null) { // 浏览器没有携带Cookie return null; } else { for (Cookie cookie : cookies) { // 判断cookie是否是我们想要的那个cookie // public String getName()：返回 Cookie 的名称。创建后无法更改名称。 if (cookie." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/aba2c4c7dde3a2127f6b0b51099e1355/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-26T00:31:28+08:00" />
<meta property="article:modified_time" content="2020-04-26T00:31:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JavaWeb（8）之Cookie&amp;Session</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>会话技术的概述</h2> 
<h3><a id="_1"></a>什么是会话</h3> 
<p>会话简单理解为:用户打开一个浏览器，点击多个超链接访问服务器的web资源,然后关闭浏览器，整个过程称为是一次会话。</p> 
<h3><a id="_3"></a>为什么要学习会话技术</h3> 
<p>每个用户与服务器进行交互过程中，产生一些各自的数据,程序想要把这些数据进行保存，就需要使用会话技术。</p> 
<p>例如：用户点击超链接购买一个商品, 程序应该保存用户所购买的商品，以便于用户点击结账可以得到用户所购买的商品信息。</p> 
<p>思考：用户购买的商品保存在request或ServletContext中是否可以?<br> <img src="https://images2.imgbox.com/3f/15/XOduCIwb_o.png" alt="在这里插入图片描述"><br> 答案是不可以的。</p> 
<h2><a id="_11"></a>会话技术的分类</h2> 
<p><a href="https://www.cnblogs.com/yunian/articles/5736066.html" rel="nofollow">session和cookie作用原理、区别</a></p> 
<h3><a id="Cookie_13"></a>Cookie技术</h3> 
<p>Cookie是客户端技术，程序把每个用户的数据以cookie的形式保存到各自浏览器中。当用户使用浏览器再次访问服务器中的web资源的时候，就会带着各自的数据（cookie）过去。这样, web资源处理的就是用户各自的数据（cookie）了。</p> 
<h3><a id="Cookie_15"></a>Cookie技术的实现原理</h3> 
<p><a href="https://www.cnblogs.com/limengyao/p/8604379.html" rel="nofollow">Http Cookie机制及Cookie的实现原理</a><br> 客户端请求服务器后，如果服务器需要记录用户状态，服务器会在响应信息中包含一个Set-Cookie的响应头，客户端会根据这个响应头存储Cookie信息。再次请求服务器时，客户端会在请求信息中包含一个Cookie请求头，而服务器会根据这个请求头进行用户身份、状态等较验。</p> 
<p>当用户访问一个网站需要登录，输入完账号和密码点击登录后，发送请求到服务器，服务器接收到请求后记录用户的登录状态（账号密码），响应是就会在响应头中携带一个Set-Cookie字段（账号密码），客户端接收到响应后就会在本地（内存或硬盘）中储存Set-Cookie字段，当再次请求时，将会在请求头中包含服务器响应的Cookie信息，因此用户再次访问网站时就不需要登录了。<br> <img src="https://images2.imgbox.com/bd/a8/e6vjA0Fq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Session_21"></a>Session技术</h3> 
<p><strong>Session是服务器端技术,利用这个技术，服务器在运行时为每一个用户的浏览器创建一个<em>独享</em>的session对象。</strong><br> 由于session为用户浏览器独享,所有用户在访问服务器的时候，可以把各自的数据放在各自的session 中,当用户再次访问服务器中的web资源的时候，其他web资源再从用户各自的session中取出数据为用户服务。</p> 
<h3><a id="Session_24"></a>Session技术的实现原理</h3> 
<p><a href="https://blog.csdn.net/zhushuai1221/article/details/52072239">Session的原理</a><br> <img src="https://images2.imgbox.com/03/ee/pdLA2aK9_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_27"></a>记录用户上次的访问时间</h2> 
<h3><a id="_28"></a>分析需求和流程</h3> 
<p><img src="https://images2.imgbox.com/4c/99/U4rexlAN_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_30"></a>记录用户上次访问时间的代码实现</h2> 
<h3><a id="Cookie_31"></a>获得从浏览器带过来的Cookie</h3> 
<p>通过HTTPServletRequest对象中的方法：<br> <img src="https://images2.imgbox.com/bd/78/W1xaNd1z_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Cookie_34"></a>想浏览器回写Cookie</h3> 
<p>通过HTTPServletResponse对象中的方法：<br> <img src="https://images2.imgbox.com/0e/b1/XnjRN2CU_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Cookie_37"></a>Cookie的构造</h3> 
<p><img src="https://images2.imgbox.com/44/b3/tTObDWW8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_39"></a>案例代码实现</h3> 
<p>创建一个web项目<br> <img src="https://images2.imgbox.com/6f/0d/RZk8dweE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_42"></a>创建包结构</h3> 
<p><img src="https://images2.imgbox.com/34/99/0melD0LI_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_44"></a>代码实现</h3> 
<p>编写工具类：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 查找指定名称Cookie的工具类
 * 
 * @author 25858
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CookieUtils</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> Cookie <span class="token function">findCookie</span><span class="token punctuation">(</span>Cookie<span class="token punctuation">[</span><span class="token punctuation">]</span> cookies<span class="token punctuation">,</span> String name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cookies <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 浏览器没有携带Cookie</span>
			<span class="token keyword">return</span> null<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>Cookie cookie <span class="token operator">:</span> cookies<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 判断cookie是否是我们想要的那个cookie</span>
				<span class="token comment">// public String getName()：返回 Cookie 的名称。创建后无法更改名称。</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 直接返回cookie</span>
					<span class="token keyword">return</span> cookie<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 浏览器带有Cookie，但是没有指定名称的那个Cookie</span>
			<span class="token keyword">return</span> null<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>编写Servlet类</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 记录用户上次访问时间的Servlet
 */</span>
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/VisitServlet"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VisitServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1</span>L<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 用户访问Servlet *如果是第一次访问 
	 * * *显示，你好欢迎来到本网站 
	 * * *记录当前访问时间，存入到Cookie，回写到浏览器 
	 * *如果不是第一次访问
	 * * *从Cookie获取上次的访问时间，显示到页面 
	 * * *记录当前时间，存入到Cookie，回写到浏览器
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span>HttpServletRequest req<span class="token punctuation">,</span> HttpServletResponse res<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{<!-- --></span>

		<span class="token comment">// 判断是否是第一次访问，从指定的cookie数组，获取指定名称的cookie</span>
		<span class="token comment">// 获取从浏览器带过来的所有cookie</span>
		Cookie<span class="token punctuation">[</span><span class="token punctuation">]</span> cookies <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 从数组中找到指定名称的cookie，利用CookieUtils工具类</span>
		Cookie cookie <span class="token operator">=</span> CookieUtils<span class="token punctuation">.</span><span class="token function">findCookie</span><span class="token punctuation">(</span>cookies<span class="token punctuation">,</span> <span class="token string">"lastVisit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 判断是否是第一次访问</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cookie <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 是第一次访问</span>
			<span class="token comment">// 显示到页面上一段内容</span>
			res<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			res<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"&lt;h1&gt;您好，欢迎来到本网站&lt;/h1&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 不是第一次访问</span>
			<span class="token comment">// 获得cookie中的上一次访问时间，显示到页面上</span>
			<span class="token comment">//String getValue()：获取此 Cookie 的当前值。</span>
			String value <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 显示到页面上一段内容</span>
			res<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			res<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"&lt;h1&gt;您好，您的上一次访问时间为"</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">"&lt;/h1&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 记录当前系统时间到cookie，回写到浏览器</span>
		Date d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SimpleDateFormat sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy年MM月dd日HH时mm分ss秒"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		String s <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 存入到cookie</span>
		Cookie c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"lastVisit"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 回写到浏览器</span>
		res<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span>HttpServletRequest req<span class="token punctuation">,</span> HttpServletResponse res<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{<!-- --></span>
		<span class="token function">doGet</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果：<br> 第一次访问<br> <img src="https://images2.imgbox.com/0e/30/fGSW60my_o.png" alt="在这里插入图片描述"><br> 第二次访问<br> <img src="https://images2.imgbox.com/21/84/p08UfiG6_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Cookie_137"></a>Cookie的分类</h2> 
<h3><a id="_138"></a>案例存在的问题</h3> 
<p>用户访问Servlet, 记录用户的上次访问时间。但是如果用户将浏览器关闭，重新打开浏览器访问程序,程序就会把其当成是第一-次访问: (显示，您好，欢迎来到本网站)。</p> 
<h3><a id="Cookie_140"></a>默认级别的Cookie</h3> 
<p>指的是没有设置有效时间的Cookie,默认的情况下只要关闭了浏览器，Cookie 也会被销毁。(Cookie 存在于浏览器的内存中，当关闭了浏览器Cookie就销毁了)。</p> 
<h3><a id="Cookie_142"></a>持久级别的Cookie</h3> 
<p>指的是有有效时间的Cookie ,这种Cookie的内容不是保存在浏览器的内存中,将Cookie的内容保存(持久化)到硬盘上。这个时候，关闭浏览器，再次打开浏览器会加载硬盘上的文件，从而Cookie中的数据就不会丢失。</p> 
<h2><a id="CookieAPI_144"></a>Cookie的API概述</h2> 
<p><a href="https://www.cnblogs.com/gxlaqj/p/11404691.html" rel="nofollow">Cookie的API</a></p> 
<h3><a id="_146"></a>构造方法</h3> 
<p><img src="https://images2.imgbox.com/03/7f/9TJascHE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_148"></a>其他方法</h3> 
<p>获取Cookie名称的方法<br> <img src="https://images2.imgbox.com/cb/3c/XrR7nXK3_o.png" alt="在这里插入图片描述"><br> 获取Cookie的值的方法<br> <img src="https://images2.imgbox.com/c9/5a/tQ9YRwhR_o.png" alt="在这里插入图片描述"><br> 设置Cookie有效域名<br> <a href="https://www.cnblogs.com/wenjia-hao/p/7365569.html" rel="nofollow">Coolie的setDomian方法使用</a><br> <a href="https://www.jianshu.com/p/122606ffcc47" rel="nofollow">Cookie 中的setDomain 和 setPath的区别</a></p> 
<p><img src="https://images2.imgbox.com/f5/14/eDjnawdD_o.png" alt="在这里插入图片描述"><br> 设置Cookie的有效路径<br> <img src="https://images2.imgbox.com/31/1b/TGDr9D3w_o.png" alt="在这里插入图片描述"></p> 
<p>设置Cookie 的有效时长<br> <img src="https://images2.imgbox.com/21/00/Im8VOLQL_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_164"></a>案例问题的解决</h3> 
<p>添加Cookie的有效路径和有效时长<br> <img src="https://images2.imgbox.com/cd/da/TKl5oM24_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Cookie_167"></a>Cookie的使用细节</h2> 
<p>一个Cookie只用标识一种信息，至少含有一个标识该信息的名称和值。</p> 
<p>一个web站点可以给一个浏览器发送多个Cookie。一个web浏览器可以存储多个web站点的Cookie。</p> 
<p>浏览器一般只允许存放300个Cookie ,每个站点最多可以存放20个Cookie ,每个Cookie的大小限制为4KB (老版本浏览器)。------浏览器存放的Cookie的大小和个数是有限制的。</p> 
<p>如果创建了一个Cookie，并发送到浏览器，默认情况下它是一个会话级别的cookie。用户退出浏览器就被删除。如果希望将这个Cookie存到磁盘上，需要设置有效时长调用setMaxAge(int maxAge)方法，以秒为单位的。</p> 
<p>需要手动删除持久性Cookie,可以将Cookie的有效时长设置为0.必须注意:删除Cookie时候，path 必须-致，否则无法删除。</p> 
<h2><a id="Session_177"></a>Session的概述</h2> 
<h3><a id="Session_178"></a>什么是Session</h3> 
<p><img src="https://images2.imgbox.com/0b/e7/jAL3UeJY_o.png" alt="在这里插入图片描述"></p> 
<p>Session称为是一次会话, Cookie将用户产生的私有的数据保存到浏览器端，Session 将用户产生的私有的数据保存到服务器端。</p> 
<p>注意: 一个浏览器独占一个session对象。<br> 因此，在需要保存用户数据时候，服务器程序可以将用户数据写到session 对象中，当用户使用浏览器访问其他程序时，其他程序可以从用户的session中取出该用户的数据，为用户服务。</p> 
<h3><a id="CookieSession_185"></a>为什么有Cookie还要有Session</h3> 
<p>Cookie的局限性:<br> Cookie保存的数据是有个数和大小的限制的。<br> 数据是保存客户端浏览器上(相对不是很安全)。</p> 
<p>Session：<br> Session没有个数和大小限制。<br> 数据是保存在服务器上(相对比较安全)。</p> 
<h3><a id="Session_193"></a>Session如何保存用户数据</h3> 
<p>Session对象由服务器创建,开发人员可以调用request对象的getsession方法得到Session对象。<img src="https://images2.imgbox.com/fc/71/pyEpaWHw_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Session_195"></a>Session的实现原理</h3> 
<p>服务器是如何实现一个session为一个用户浏览器服务的?<br> <img src="https://images2.imgbox.com/dc/03/8xUycPsb_o.png" alt="在这里插入图片描述"><br> Session的实现原理:<br> 基于Cookie 的，基于Cookie回写了一个Session 的ID。</p> 
<h2><a id="Session_200"></a>Session作为域对象存取数据</h2> 
<h3><a id="SessionAPI_201"></a>Session作为域对象的API</h3> 
<p>想session中存入数据<br> <img src="https://images2.imgbox.com/23/ce/f0dFEvgf_o.png" alt="在这里插入图片描述"><br> 从session域中获取数据<br> <img src="https://images2.imgbox.com/6f/b2/Te5DpF0K_o.png" alt="在这里插入图片描述"><br> 从session中移除数据<br> <img src="https://images2.imgbox.com/5f/c8/gLVaM4f5_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Session_208"></a>Session作为域对象的作用范围</h3> 
<p>Session作为域对象，作用范围就是<strong>一次会话的范围</strong>。 一次会话,指的是用户打开浏览器点击多个超链接，访问服务器资源，到最后关闭浏览器的过程。</p> 
<h2><a id="Servlet_210"></a>Servlet的数据访问范围（域对象）的总结</h2> 
<p><a href="https://blog.csdn.net/h294590501/article/details/82634886">域对象</a></p> 
<p><a href="https://blog.csdn.net/WXZCYQ/article/details/101351891">Servlet域对象</a></p> 
<h3><a id="ServletRequest_214"></a>请求范围（ServletRequest）</h3> 
<ol><li>何时创建和销毁的</li></ol> 
<p>创建：当用户向服务器发送一次请求， 服务器创建一个request对象。</p> 
<p>销毁：当服务器对这次请求作出了响应，服务器就会销毁这个request 对象。</p> 
<ol start="2"><li>如何存取数据</li></ol> 
<p>存数据:<br>  void setAttribute(String name,Object value);</p> 
<p>取数据：<br>  Object getAttribute(String name);</p> 
<ol start="3"><li>作用范围</li></ol> 
<p>一次请求。(转发就是一次请求，重定向是两次请求)。</p> 
<h3><a id="HttpSession_232"></a>会话范围（HttpSession）</h3> 
<ol><li>何时创建和销毁的</li></ol> 
<p>创建:服务器端第一次调用 getSession()方法的时候。</p> 
<p>销毁:三种情况</p> 
<p>Session过期，默认的过期时间30分钟。（Tomcat的web.xml中可以设置默认过期时间）</p> 
<p>非正常关闭服务器。(正常关闭服务器—session会被序列化，再次开启服务器后会被反序列化)。</p> 
<p>手动调用session.invalidate();</p> 
<ol start="2"><li>如何存取数据</li></ol> 
<p>存数据:<br>  void setAttribute(String name,Object value);</p> 
<p>取数据：<br>  Object getAttribute(String name);</p> 
<ol start="3"><li>作用范围</li></ol> 
<p>一次会话(多次请求)</p> 
<h3><a id="ServletContext_256"></a>应用范围（ServletContext）</h3> 
<ol><li>何时创建和销毁的</li></ol> 
<p>创建:服务器启动的时候创建，为每个web项目创建一个单独ServletContext对象。</p> 
<p>销毁:服务器关闭的时候，或者项目从服务器中移除的时候。</p> 
<ol start="2"><li>如何存取数据</li></ol> 
<p>存数据:<br>  void setAttribute(String name,Object value);</p> 
<p>取数据：<br>  Object getAttribute(String name);</p> 
<ol start="3"><li>作用范围</li></ol> 
<p>整个应用</p> 
<h2><a id="_274"></a>案例需求描述</h2> 
<p><img src="https://images2.imgbox.com/f5/75/zfvNSinj_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_276"></a>案例准备</h2> 
<p>创建web项目<br> <img src="https://images2.imgbox.com/9d/6a/x25Zsb9T_o.png" alt="在这里插入图片描述"><br> 引入相关的jar包<br> <img src="https://images2.imgbox.com/4d/45/MWRgF4QT_o.png" alt="在这里插入图片描述"><br> 创建包结构<br> <img src="https://images2.imgbox.com/6c/6e/CZskhSQ9_o.png" alt="在这里插入图片描述"><br> 引入工具类和相关的文件<br> 引入的是JavaWeb（7）之JSP中你的类和xml文件<br> <img src="https://images2.imgbox.com/38/4f/DyQwq6RK_o.png" alt="在这里插入图片描述"><br> 创建登录页面</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>登录页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
		&lt;%
		//判断request域中是否有错误信息: (第一次进入登录页面的时候，没有错误信息)
		//如果有错误信息:显示错误信息
		String msg = " ";
		if (request.getAttribute("msg") != null) {
			//有错误信息，显示错误信息
			msg = (String) request.getAttribute("msg");
		}
	%&gt;
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>font</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>&lt;%=msg%&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>font</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/web03_login/LoginServlet<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>密<span class="token entity" title=" ">&amp;nbsp;</span><span class="token entity" title=" ">&amp;nbsp;</span><span class="token entity" title=" ">&amp;nbsp;</span><span class="token entity" title=" ">&amp;nbsp;</span>码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>验证码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkcode<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>remember<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>记住用户名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>登录<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="_334"></a>案例代码-用户登录的功能</h2> 
<h3><a id="_335"></a>用户登录流程</h3> 
<p>用户输入用户名或密码进行登录:</p> 
<p>如果用户名或密码错误，保存错误信息，回到登录页面。</p> 
<p>如果用户名或密码正确，将用户的信息保存到会话中，跳转到成功页面。</p> 
<h3><a id="_341"></a>用户登录代码实现</h3> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 
 * @author 25858
 *
 */</span>
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/LoginServlet"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1</span>L<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span>HttpServletRequest req<span class="token punctuation">,</span> HttpServletResponse res<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>

			<span class="token comment">// 1.接收数据</span>
			<span class="token comment">// 处理中文乱码</span>
			req<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			String name <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			String password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 2.封装数据</span>
			User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
			user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 3.处理数据</span>
			UserModel userModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			User existUser <span class="token operator">=</span> userModel<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 4.页面跳转</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>existUser <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 登录失败</span>
				<span class="token comment">// 向request域中保存一个错误信息</span>
				req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"用户名或密码错误！！！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 使用请求转发的方式进行页面跳转</span>
				req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 登录成功</span>
				<span class="token comment">// 保存用户信息：保存到会话当中</span>
				HttpSession session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 保存数据</span>
				session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"existUser"</span><span class="token punctuation">,</span> existUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 使用重定向的方式进行页面跳转</span>
				res<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/web03_login/success.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{<!-- --></span>
		<span class="token function">doGet</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>编写登录成功success.jsp代码</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	&lt;%
		if (request.getSession().getAttribute("existUser") == null) {
	%&gt;
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>
		您还没有登录！请去<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/web03_login/login.jsp<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
	&lt;%
		} else {
	%&gt;
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>用户登录成功！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
	&lt;%
		User existUser = (User) request.getSession().getAttribute("existUser");
	%&gt;
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>
		您好：&lt;%=existUser.getNickname()%&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
	&lt;%
		}
	%&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="_422"></a>案例代码-一次性验证码</h2> 
<h3><a id="_423"></a>分析</h3> 
<p>一次性验证码的作用：<br> 一次性验证码作用：防止恶意灌水。<br> 而且一次性验证码只能够使用一次，不管成功或者失败,验证码都将失效。</p> 
<h3><a id="_428"></a>一次性验证码的校验</h3> 
<p>一次性验证码生 成(随机生成4个字母或数字，由response 生成一张图片响应到页面)。<br> <img src="https://images2.imgbox.com/cd/d9/epT5KghE_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_431"></a>案例代码-一次性验证码的实现</h2> 
<p><a href="https://blog.csdn.net/hqhryn/article/details/79683027">Servlet+js实现简单验证码校验</a></p> 
<p>生成验证码图片的Servlet</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>Color<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>Font<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>Graphics<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>Graphics2D<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>image<span class="token punctuation">.</span>BufferedImage<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>imageio<span class="token punctuation">.</span>ImageIO<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>ServletException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>WebServlet<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServlet<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletRequest<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletResponse<span class="token punctuation">;</span>

<span class="token comment">/**
 * 将产生的字符串验证码存入Session中 生成验证码图片
 * 
 * 
 */</span>
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/CheckImgServlet"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CheckImgServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/**
	 * 
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">3561046967914640689</span>L<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 禁止缓存</span>
		<span class="token comment">// response.setHeader("Cache-Control", "no-cache");</span>
		<span class="token comment">// response.setHeader("Pragma", "no-cache");</span>
		<span class="token comment">// response.setDateHeader("Expires", -1);</span>

		<span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

		<span class="token comment">// 步骤一 绘制一张内存中图片</span>
		BufferedImage bufferedImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedImage</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> BufferedImage<span class="token punctuation">.</span>TYPE_INT_RGB<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 步骤二 图片绘制背景颜色 ---通过绘图对象</span>
		Graphics graphics <span class="token operator">=</span> bufferedImage<span class="token punctuation">.</span><span class="token function">getGraphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 得到画图对象 --- 画笔</span>
		<span class="token comment">// 绘制任何图形之前 都必须指定一个颜色</span>
		graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">getRandColor</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		graphics<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 步骤三 绘制边框</span>
		graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		graphics<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 步骤四 四个随机数字</span>
		Graphics2D graphics2d <span class="token operator">=</span> <span class="token punctuation">(</span>Graphics2D<span class="token punctuation">)</span> graphics<span class="token punctuation">;</span>
		<span class="token comment">// 设置输出字体</span>
		graphics2d<span class="token punctuation">.</span><span class="token function">setFont</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Font</span><span class="token punctuation">(</span><span class="token string">"宋体"</span><span class="token punctuation">,</span> Font<span class="token punctuation">.</span>BOLD<span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		String words <span class="token operator">=</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890"</span><span class="token punctuation">;</span>
		<span class="token comment">// String words =</span>
		<span class="token comment">// "\u7684\u4e00\u4e86\u662f\u6211\u4e0d\u5728\u4eba\u4eec\u6709\u6765\u4ed6\u8fd9\u4e0a\u7740\u4e2a\u5730\u5230\u5927\u91cc\u8bf4\u5c31\u53bb\u5b50\u5f97\u4e5f\u548c\u90a3\u8981\u4e0b\u770b\u5929\u65f6\u8fc7\u51fa\u5c0f\u4e48\u8d77\u4f60\u90fd\u628a\u597d\u8fd8\u591a\u6ca1\u4e3a\u53c8\u53ef\u5bb6\u5b66\u53ea\u4ee5\u4e3b\u4f1a\u6837\u5e74\u60f3\u751f\u540c\u8001\u4e2d\u5341\u4ece\u81ea\u9762\u524d\u5934\u9053\u5b83\u540e\u7136\u8d70\u5f88\u50cf\u89c1\u4e24\u7528\u5979\u56fd\u52a8\u8fdb\u6210\u56de\u4ec0\u8fb9\u4f5c\u5bf9\u5f00\u800c\u5df1\u4e9b\u73b0\u5c71\u6c11\u5019\u7ecf\u53d1\u5de5\u5411\u4e8b\u547d\u7ed9\u957f\u6c34\u51e0\u4e49\u4e09\u58f0\u4e8e\u9ad8\u624b\u77e5\u7406\u773c\u5fd7\u70b9\u5fc3\u6218\u4e8c\u95ee\u4f46\u8eab\u65b9\u5b9e\u5403\u505a\u53eb\u5f53\u4f4f\u542c\u9769\u6253\u5462\u771f\u5168\u624d\u56db\u5df2\u6240\u654c\u4e4b\u6700\u5149\u4ea7\u60c5\u8def\u5206\u603b\u6761\u767d\u8bdd\u4e1c\u5e2d\u6b21\u4eb2\u5982\u88ab\u82b1\u53e3\u653e\u513f\u5e38\u6c14\u4e94\u7b2c\u4f7f\u5199\u519b\u5427\u6587\u8fd0\u518d\u679c\u600e\u5b9a\u8bb8\u5feb\u660e\u884c\u56e0\u522b\u98de\u5916\u6811\u7269\u6d3b\u90e8\u95e8\u65e0\u5f80\u8239\u671b\u65b0\u5e26\u961f\u5148\u529b\u5b8c\u5374\u7ad9\u4ee3\u5458\u673a\u66f4\u4e5d\u60a8\u6bcf\u98ce\u7ea7\u8ddf\u7b11\u554a\u5b69\u4e07\u5c11\u76f4\u610f\u591c\u6bd4\u9636\u8fde\u8f66\u91cd\u4fbf\u6597\u9a6c\u54ea\u5316\u592a\u6307\u53d8\u793e\u4f3c\u58eb\u8005\u5e72\u77f3\u6ee1\u65e5\u51b3\u767e\u539f\u62ff\u7fa4\u7a76\u5404\u516d\u672c\u601d\u89e3\u7acb\u6cb3\u6751\u516b\u96be\u65e9\u8bba\u5417\u6839\u5171\u8ba9\u76f8\u7814\u4eca\u5176\u4e66\u5750\u63a5\u5e94\u5173\u4fe1\u89c9\u6b65\u53cd\u5904\u8bb0\u5c06\u5343\u627e\u4e89\u9886\u6216\u5e08\u7ed3\u5757\u8dd1\u8c01\u8349\u8d8a\u5b57\u52a0\u811a\u7d27\u7231\u7b49\u4e60\u9635\u6015\u6708\u9752\u534a\u706b\u6cd5\u9898\u5efa\u8d76\u4f4d\u5531\u6d77\u4e03\u5973\u4efb\u4ef6\u611f\u51c6\u5f20\u56e2\u5c4b\u79bb\u8272\u8138\u7247\u79d1\u5012\u775b\u5229\u4e16\u521a\u4e14\u7531\u9001\u5207\u661f\u5bfc\u665a\u8868\u591f\u6574\u8ba4\u54cd\u96ea\u6d41\u672a\u573a\u8be5\u5e76\u5e95\u6df1\u523b\u5e73\u4f1f\u5fd9\u63d0\u786e\u8fd1\u4eae\u8f7b\u8bb2\u519c\u53e4\u9ed1\u544a\u754c\u62c9\u540d\u5440\u571f\u6e05\u9633\u7167\u529e\u53f2\u6539\u5386\u8f6c\u753b\u9020\u5634\u6b64\u6cbb\u5317\u5fc5\u670d\u96e8\u7a7f\u5185\u8bc6\u9a8c\u4f20\u4e1a\u83dc\u722c\u7761\u5174\u5f62\u91cf\u54b1\u89c2\u82e6\u4f53\u4f17\u901a\u51b2\u5408\u7834\u53cb\u5ea6\u672f\u996d\u516c\u65c1\u623f\u6781\u5357\u67aa\u8bfb\u6c99\u5c81\u7ebf\u91ce\u575a\u7a7a\u6536\u7b97\u81f3\u653f\u57ce\u52b3\u843d\u94b1\u7279\u56f4\u5f1f\u80dc\u6559\u70ed\u5c55\u5305\u6b4c\u7c7b\u6e10\u5f3a\u6570\u4e61\u547c\u6027\u97f3\u7b54\u54e5\u9645\u65e7\u795e\u5ea7\u7ae0\u5e2e\u5566\u53d7\u7cfb\u4ee4\u8df3\u975e\u4f55\u725b\u53d6\u5165\u5cb8\u6562\u6389\u5ffd\u79cd\u88c5\u9876\u6025\u6797\u505c\u606f\u53e5\u533a\u8863\u822c\u62a5\u53f6\u538b\u6162\u53d4\u80cc\u7ec6";</span>
		Random random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 生成随机数</span>

		<span class="token comment">// 定义x坐标</span>
		<span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
		StringBuffer buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拼接产生的验证码字符</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 随机颜色</span>
			graphics2d
					<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">+</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token operator">+</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token operator">+</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 旋转 -30 --- 30度</span>
			<span class="token keyword">int</span> jiaodu <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>
			<span class="token comment">// 换算弧度</span>
			<span class="token keyword">double</span> theta <span class="token operator">=</span> jiaodu <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">;</span>

			<span class="token comment">// 生成一个随机数字</span>
			<span class="token keyword">int</span> index <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>words<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成随机数 0 到 length - 1</span>
			<span class="token comment">// 获得字母数字</span>
			<span class="token keyword">char</span> c <span class="token operator">=</span> words<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// 将生成汉字 加入buffer</span>
			buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 将c 输出到图片</span>
			graphics2d<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>theta<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			graphics2d<span class="token punctuation">.</span><span class="token function">drawString</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			graphics2d<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token operator">-</span>theta<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			x <span class="token operator">+=</span> <span class="token number">30</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 将产生的字符串验证码存入Session中</span>
		request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 步骤五 绘制干扰线</span>
		graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">getRandColor</span><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> x1<span class="token punctuation">;</span>
		<span class="token keyword">int</span> x2<span class="token punctuation">;</span>
		<span class="token keyword">int</span> y1<span class="token punctuation">;</span>
		<span class="token keyword">int</span> y2<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			x1 <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
			x2 <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			y1 <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
			y2 <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			graphics<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x1 <span class="token operator">+</span> x2<span class="token punctuation">,</span> x2 <span class="token operator">+</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 将上面图片输出到浏览器 ImageIO</span>
		graphics<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 释放资源</span>
		ImageIO<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bufferedImage<span class="token punctuation">,</span> <span class="token string">"jpg"</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{<!-- --></span>
		<span class="token function">doGet</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 取其某一范围的color
	 * 
	 * @param fc int 范围参数1
	 * @param bc int 范围参数2
	 * @return Color
	 */</span>
	<span class="token keyword">private</span> Color <span class="token function">getRandColor</span><span class="token punctuation">(</span><span class="token keyword">int</span> fc<span class="token punctuation">,</span> <span class="token keyword">int</span> bc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 取其随机颜色</span>
		Random random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>fc <span class="token operator">&gt;</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			fc <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>bc <span class="token operator">&gt;</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			bc <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">int</span> r <span class="token operator">=</span> fc <span class="token operator">+</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>bc <span class="token operator">-</span> fc<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> g <span class="token operator">=</span> fc <span class="token operator">+</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>bc <span class="token operator">-</span> fc<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> b <span class="token operator">=</span> fc <span class="token operator">+</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>bc <span class="token operator">-</span> fc<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>在页面引入Servlet<br> <img src="https://images2.imgbox.com/5c/0d/Vi2RSzIr_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_576"></a>校验一次性验证码</h2> 
<p><img src="https://images2.imgbox.com/c3/0b/wFfkvGLS_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">	<span class="token comment">// 一次性验证码的校验</span>
			String checkcode1 <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"checkcode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 从session中获取一次性验证码的值</span>
			String checkcode2 <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 为了保证一次性验证码的的值使用一次，应该将session中的值清空</span>
			request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 校验一次性验证码</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>checkcode1<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>checkcode2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"验证码错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_594"></a>案例代码-一次性验证码图片的点击刷新</h2> 
<p>创建一个超链接，将img放入超链接，再创建一个JS 事件，点击超链接时触发事件，此事件可以重新访问CheckImgServlet（验证码图片），但是想要重新访问CheckImgServlet就必须让访问路径有错变化，如果没有变化就会访问本地缓存的路径，所以在事件触发是路径要加一个本地的时间，这样就可以让访问路径每点击一次就不一样。</p> 
<p>注意：一定要将刷新验证码图片的JS放入代码的上方，否则会出现图片显示失败的错误。</p> 
<pre><code class="prism language-html">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%&gt;
<span class="token doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset=UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Insert title here<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
	<span class="token keyword">function</span> <span class="token function">changImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"img1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"/web03_login/CheckImgServlet?time="</span>
				<span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>登录页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
	&lt;%
		//判断request域中是否有错误信息: (第一次进入登录页面的时候，没有错误信息)
		//如果有错误信息:显示错误信息
		String msg = " ";
		if (request.getAttribute("msg") != null) {
			//有错误信息，显示错误信息
			msg = (String) request.getAttribute("msg");
		}
	%&gt;
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>font</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>&lt;%=msg%&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>font</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/web03_login/LoginServlet<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>密<span class="token entity" title=" ">&amp;nbsp;</span><span class="token entity" title=" ">&amp;nbsp;</span><span class="token entity" title=" ">&amp;nbsp;</span><span class="token entity" title=" ">&amp;nbsp;</span>码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>验证码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkcode<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>
					<span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>changImg()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>img1<span class="token punctuation">"</span></span>
						<span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/web03_login/CheckImgServlet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>remember<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>记住用户名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>登录<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="_662"></a>案例代码-记住用户名的实现</h2> 
<h3><a id="_663"></a>需求概述</h3> 
<p>如果在登录的过程中,将记住用户名的复选框勾选了,而且在登录成功情况下，需要记住用户名,在关闭浏览器，下次访问该网站的登录页面的时候，会在用户名的文本框中自动呈现出用户名。</p> 
<h3><a id="_665"></a>代码实现</h3> 
<p>记录用户名的后代代码：<br> <img src="https://images2.imgbox.com/cf/9b/tz6Z92bX_o.png" alt="在这里插入图片描述"></p> 
<p>在页面的文本框回显用户名<br> 使用EL表达式后面会学到<br> <img src="https://images2.imgbox.com/ee/e9/6nYelpAA_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_672"></a>案例代码-系统的退出功能</h2> 
<p>提供一个退出的链接<br> <img src="https://images2.imgbox.com/53/3f/JZV51mGs_o.png" alt="在这里插入图片描述"><br> 编写LogoutServlet.java<br> 我们登陆进来的信息都是保存在Session中的，所以想要退出，其实把Session销毁就可以了。</p> 
<pre><code class="prism language-java"><span class="token operator">*</span><span class="token operator">*</span>
 <span class="token operator">*</span> 系统退出的Servlet
 <span class="token operator">*</span> 
 <span class="token operator">*</span> <span class="token annotation punctuation">@author</span> <span class="token number">25858</span>
 <span class="token operator">*</span>
 <span class="token operator">*</span><span class="token operator">/</span>
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/LogoutServlet"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogoutServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1</span>L<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 销毁Session</span>
		request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 重定向</span>
		response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/web03_login/success.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{<!-- --></span>
		<span class="token function">doGet</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a71f5e9cdc24ea1ea08d240b91676867/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">shell编程（九）函数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/77656a1665e29e756275b60366cbbdf9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">通用树形控件——zTree</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>