<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>stable diffusion 百宝书 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="stable diffusion 百宝书" />
<meta property="og:description" content="文章目录 0. 环境搭建0.1 Windows0.1.1 git环境安装0.1.2 python 环境搭建0.1.2.1 配置pip国内镜像源 0.1.3 stable diffusion环境搭建0.1.3.1 远程访问Stable diffusion0.1.3.2 模型 Lora下载 1. SD 基础1.1 文生图基本原理1.2 Stable Diffusion实战1.2.1 基本参数说明1.2.1.1 模型1.2.1.2 采样方法1.2.1.3 采样迭代步数1.2.1.4 提示词相关性1.2.1.5 随机种子 1.2.2 SD 实战1.2.2.1 基础功能1.2.2.2 高清修复1.2.2.3 局部重绘1.2.2.4 ControlNet1.2.2.4.1 姿势控制1.2.2.4.2 精确控制1.2.2.4.3 画面分割1.2.2.4.4 深度图 2. SD 商业应用场景2.1 吉祥物2.2 商品展示2.3 LOGO2.4 商品模型附： 不同显卡出图效率 3. 扩展插件推荐3.1 中文语言包3.2 图库浏览器3.3 Tag Autocompletion：实现提示词的补全、翻译3.4 SD upscale 参考文献 0. 环境搭建 0.1 Windows 0.1.1 git环境安装 去下方网站获取git的win安装包，之后不断点击下一步就可以了：
https://git-scm.com/ 安装完之后，运行Win&#43;R唤出控制台，执行如下命令检验是否安装完成
git --version 0.1.2 python 环境搭建 去下方网站获取python的win安装包，之后不断点击下一步就可以了。在最后一步，一定要选择 Add python." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/001166be12e3e62ae6fa8521ada79f3d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-18T14:03:49+08:00" />
<meta property="article:modified_time" content="2023-09-18T14:03:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">stable diffusion 百宝书</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#0__1" rel="nofollow">0. 环境搭建</a></li><li><ul><li><a href="#01_Windows_2" rel="nofollow">0.1 Windows</a></li><li><ul><li><a href="#011_git_4" rel="nofollow">0.1.1 git环境安装</a></li><li><a href="#012_python__15" rel="nofollow">0.1.2 python 环境搭建</a></li><li><ul><li><a href="#0121_pip_25" rel="nofollow">0.1.2.1 配置pip国内镜像源</a></li></ul> 
    </li><li><a href="#013_stable_diffusion_32" rel="nofollow">0.1.3 stable diffusion环境搭建</a></li><li><ul><li><a href="#0131_Stable_diffusion_42" rel="nofollow">0.1.3.1 远程访问Stable diffusion</a></li><li><a href="#0132__Lora_56" rel="nofollow">0.1.3.2 模型 Lora下载</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#1_SD__66" rel="nofollow">1. SD 基础</a></li><li><ul><li><a href="#11__69" rel="nofollow">1.1 文生图基本原理</a></li><li><a href="#12_Stable_Diffusion_78" rel="nofollow">1.2 Stable Diffusion实战</a></li><li><ul><li><a href="#121__82" rel="nofollow">1.2.1 基本参数说明</a></li><li><ul><li><a href="#1211__93" rel="nofollow">1.2.1.1 模型</a></li><li><a href="#1212__111" rel="nofollow">1.2.1.2 采样方法</a></li><li><a href="#1213__136" rel="nofollow">1.2.1.3 采样迭代步数</a></li><li><a href="#1214__139" rel="nofollow">1.2.1.4 提示词相关性</a></li><li><a href="#1215__148" rel="nofollow">1.2.1.5 随机种子</a></li></ul> 
    </li><li><a href="#122_SD__153" rel="nofollow">1.2.2 SD 实战</a></li><li><ul><li><a href="#1221__154" rel="nofollow">1.2.2.1 基础功能</a></li><li><a href="#1222__175" rel="nofollow">1.2.2.2 高清修复</a></li><li><a href="#1223__192" rel="nofollow">1.2.2.3 局部重绘</a></li><li><a href="#1224_ControlNet_209" rel="nofollow">1.2.2.4 ControlNet</a></li><li><ul><li><a href="#12241__236" rel="nofollow">1.2.2.4.1 姿势控制</a></li><li><a href="#12242__240" rel="nofollow">1.2.2.4.2 精确控制</a></li><li><a href="#12243__244" rel="nofollow">1.2.2.4.3 画面分割</a></li><li><a href="#12244__248" rel="nofollow">1.2.2.4.4 深度图</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#2_SD__253" rel="nofollow">2. SD 商业应用场景</a></li><li><ul><li><a href="#21__254" rel="nofollow">2.1 吉祥物</a></li><li><a href="#22__259" rel="nofollow">2.2 商品展示</a></li><li><a href="#23_LOGO_264" rel="nofollow">2.3 LOGO</a></li><li><a href="#24__270" rel="nofollow">2.4 商品模型</a></li><li><a href="#__274" rel="nofollow">附： 不同显卡出图效率</a></li></ul> 
  </li><li><a href="#3__276" rel="nofollow">3. 扩展插件推荐</a></li><li><ul><li><a href="#31__280" rel="nofollow">3.1 中文语言包</a></li><li><a href="#32__283" rel="nofollow">3.2 图库浏览器</a></li><li><a href="#33_Tag_Autocompletion_288" rel="nofollow">3.3 Tag Autocompletion：实现提示词的补全、翻译</a></li><li><a href="#34_SD_upscale_297" rel="nofollow">3.4 SD upscale</a></li></ul> 
  </li><li><a href="#_303" rel="nofollow">参考文献</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0__1"></a>0. 环境搭建</h2> 
<h3><a id="01_Windows_2"></a>0.1 Windows</h3> 
<h4><a id="011_git_4"></a>0.1.1 git环境安装</h4> 
<p>去下方网站获取git的win安装包，之后不断点击下一步就可以了：</p> 
<pre><code class="prism language-bash">https://git-scm.com/
</code></pre> 
<p>安装完之后，运行<code>Win+R</code>唤出控制台，执行如下命令检验是否安装完成</p> 
<pre><code>git --version
</code></pre> 
<h4><a id="012_python__15"></a>0.1.2 python 环境搭建</h4> 
<p>去下方网站获取python的win安装包，之后不断点击下一步就可以了。在最后一步，一定要选择 <code>Add python.ext to PATH</code> 环境变量。</p> 
<pre><code>https://www.python.org/
</code></pre> 
<p>安装完之后，运行<code>Win+R</code>唤出控制台，执行如下命令检验是否安装完成</p> 
<pre><code>python --version
</code></pre> 
<h5><a id="0121_pip_25"></a>0.1.2.1 配置pip国内镜像源</h5> 
<p>运行<code>Win+R</code>唤出控制台，输入如下命令</p> 
<pre><code class="prism language-bash">python <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple <span class="token parameter variable">--upgrade</span> pip
pip config <span class="token builtin class-name">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<h4><a id="013_stable_diffusion_32"></a>0.1.3 stable diffusion环境搭建</h4> 
<ol><li>去想要安装的盘符上新建个文件夹用于存放stable diffusion的相关信息</li><li>下载stable diffusion的开源仓库</li></ol> 
<pre><code>git clone https://github.com/AUTOMATIC1111/stable-diffusion-webui
</code></pre> 
<ol start="3"><li>如果没问题的话，在当前目录会存在一个<code>webui-user.bat</code>这个批处理文件，双击运行</li><li>在批处理的控制台会出现如下信息<code>Running at local url：http://127.0.0.1:7860</code>类似的信息，复制这个网址，用浏览器打开</li></ol> 
<h5><a id="0131_Stable_diffusion_42"></a>0.1.3.1 远程访问Stable diffusion</h5> 
<p>远程访问主要有两种方式：</p> 
<ul><li><strong>内网穿透</strong>：依赖内网穿透软件（比如花生壳），这样可以在公网环境访问你的远端stable diffusion，随时出图。但是这依赖我们在批处理文件之中设置如下的启动参数：</li></ul> 
<pre><code class="prism language-bash"><span class="token builtin class-name">set</span> <span class="token assign-left variable">COMMANDLINE_ARGS</span><span class="token operator">=</span> <span class="token parameter variable">--listen</span>
</code></pre> 
<ul><li><strong>批处理启动参数</strong>：如果你的远端环境可以访问外网，可以在批处理文件中增加如下述的启动命令：</li></ul> 
<pre><code class="prism language-bash"><span class="token builtin class-name">set</span> <span class="token assign-left variable">COMMANDLINE_ARGS</span><span class="token operator">=</span> <span class="token parameter variable">--share</span>
</code></pre> 
<blockquote> 
 <p>注：不能同时设置listen和share参数，因为listen参数的优先级会更高</p> 
</blockquote> 
<h5><a id="0132__Lora_56"></a>0.1.3.2 模型 Lora下载</h5> 
<ol><li>访问相关模型网站，我们这里拿著名的C站(<a href="https://civitai.com/" rel="nofollow">https://civitai.com/</a>)举例：</li></ol> 
<blockquote> 
 <p>注：同学也可以访问国内模型网站libai（<a href="https://www.liblib.ai/" rel="nofollow">https://www.liblib.ai/</a>）<br> <img src="https://images2.imgbox.com/96/77/uon7iJ3o_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<ol start="3"><li>点击自己喜欢的模型，选择下载<br> <img src="https://images2.imgbox.com/7f/d3/cI2GKOYI_o.png" alt="在这里插入图片描述"></li><li>将下载后的文件放到stable diffusion指定的目录下<code>盘符:\目录\stable-diffusion-webui\models\Stable-diffusion</code></li></ol> 
<blockquote> 
 <p>注： Lora下载放到这个目录<code>盘符:\目录\stable-diffusion-webui\models\Lora</code></p> 
</blockquote> 
<ol start="5"><li>点击stable diffusion的刷新按钮，就可以刷新了<br> <img src="https://images2.imgbox.com/3e/1c/XQTrFGwF_o.png" alt="在这里插入图片描述"></li></ol> 
<h2><a id="1_SD__66"></a>1. SD 基础</h2> 
<p>Stable Diffusion是2022年发布的深度学习文本到图像生成模型，它是一种潜在扩散模型，它由创业公司Stability AI与多个学术研究者和非营利组织合作开发。目前的SD的源代码和模型都已经开源，在Github上由AUTOMATIC1111维护了一个完整的项目，正在由全世界的开发者共同维护。由于完整版对网络有一些众所周知的需求，国内有多位开发者维护着一些不同版本的封装包。</p> 
<h3><a id="11__69"></a>1.1 文生图基本原理</h3> 
<p>由于本人不是相关研究方向的学者，这里只是简述一下基本原来，如有错误，欢迎各位大佬批评指正。</p> 
<p>当用户输出一段提示词之后，比如说宇航员骑狗，其首先会被解析为两个特征向量宇航员、狗。然后去对应的数据库之中找到对应的图像，之后将这一部分特征向量信息传递到图像编码器之中。图像编码器会从潜在空间之中选取一张初始噪声图片。然后U-net卷积神经网络会根据特征向量预测出不需要的噪声，与原噪声相减得到一张新的噪声图，如此不断往复，之后会得到一张满足需求的特征图像，最终由图像解码器将其解析为呈现给用户的最终图像。</p> 
<blockquote> 
 <p>潜在空间：反映的是原始数据经过“中介空间”后的特征</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/6c/ee/TeKEMdVU_o.png" alt="请添加图片描述"></p> 
<h3><a id="12_Stable_Diffusion_78"></a>1.2 Stable Diffusion实战</h3> 
<p>说完了基本原理，我们接下来就进入Stable Diffusion的实战环节。<br> 下图是Stable Diffusion的Web ui展示：<br> <img src="https://images2.imgbox.com/4b/a7/EJCyJoHr_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="121__82"></a>1.2.1 基本参数说明</h4> 
<p>上图之中存在着很多参数，我这里按照对用户的重要性来逐一说明：</p> 
<table><thead><tr><th>参数</th><th align="left">含义</th></tr></thead><tbody><tr><td>采样方法</td><td align="left">采用方法其实就是刚刚讲原理时提到的降噪方法，SD提供了很多方法，这里根据用户需求简单分类了一下<br><strong>如果只是想得到一些较为简单的结果</strong>：选用欧拉（Eular)或者Heun <br><strong>对于侧重于速度、融合、新颖且质量不错的结果</strong>：<br> * DPM++ 2M Karras， Step Range：20-30<br>* UniPc, Step Range: 20-30<br> <strong>期望得到高质量的图像，且不关心图像是否收敛</strong>：<br>* DPM ++ SDE Karras， Step Range：8-12 <br>* DDIM， Step Range：10-15</td></tr><tr><td>采样迭代步数</td><td align="left">控制降噪的轮次，选择50就是降噪50轮之后将图像经过解码器返回给用户</td></tr><tr><td>提示词相关性</td><td align="left">对于人物类的提示词，一般将提示词相关性控制在 7-15 之间；<br> 而对于建筑等大场景类的提示词，一般控制在 3-7 左右</td></tr><tr><td>模型</td><td align="left">用素材+SD底模（如SD1.5/SD1.4/SD2.1），深度学习之后炼制出的大模型，可以直接用来生图。大模型决定了最终出图的大方向 。<br> 大模型被称为checkpoint，一般3-7GB</td></tr><tr><td>VAE</td><td align="left">类似类似美颜工具之中的滤镜，是对大模型的补充，稳定画面的色彩范围</td></tr><tr><td>LoRA模型</td><td align="left">大模型的低秩适应，可以理解为模型插件。其是在基于某个大模型的基础上，深度学习之后炼制出的小模型。需要搭配大模型使用，可以在中小范围内影响出图的风格，或是增加大模型所没有的东西。</td></tr><tr><td>ControlNet</td><td align="left">能够基于现有图片得到诸如线条或景深的信息，去知道SD扩散模型如何去生成图片</td></tr></tbody></table> 
<h5><a id="1211__93"></a>1.2.1.1 模型</h5> 
<p>• <strong>模型类目</strong><br> 模型大致可以分为三个类别：</p> 
<ul><li>二次元类：插画、漫画风</li><li>真实系：真实风格</li><li>2.5D风格：介于二者之间的</li></ul> 
<p>不同类模型，以及不同模型之间的出图效果都十分不一样，可以看一下在同一参数场景下不同。模型的出图效果对比：<img src="https://images2.imgbox.com/53/6d/GzHO3778_o.png" alt="请添加图片描述"></p> 
<p>• <strong>推荐查找关键词</strong></p> 
<table><thead><tr><th></th><th>二次元模型</th><th>真实系模型</th><th>2.5D模型</th></tr></thead><tbody><tr><td>推荐标签与风格关键词</td><td>illustration,painting,skectch,drawing,comic,anime,cartoon</td><td>photography,photo,realistic,photorealistic,Raw photo</td><td>3D,render,chibi,digital art,concept art,{realistic}</td></tr></tbody></table> 
<p>• <strong>模型推荐</strong><br> <img src="https://images2.imgbox.com/ec/e8/iiTDsFQ7_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="1212__111"></a>1.2.1.2 采样方法</h5> 
<blockquote> 
 <p><strong>采样方法总结</strong>：</p> 
 <ul><li><strong>如果只是想得到一些较为简单的结果</strong>：选用欧拉（Eular)或者Heun</li><li><strong>对于侧重于速度、融合、新颖且质量不错的结果</strong>：</li><li> <pre><code>DPM++ 2M Karras， Step Range：20-30
</code></pre> </li><li> <pre><code>UniPc, Step Range: 20-30
</code></pre> </li><li><strong>期望得到高质量的图像，且不关心图像是否收敛</strong>：</li><li> <pre><code>DPM ++ SDE Karras， Step Range：8-12 
</code></pre> </li><li> <pre><code>DDIM， Step Range：10-15
</code></pre> </li></ul> 
</blockquote> 
<ul><li><strong>Euler</strong> : 基于Karras论文，在K-diffusion实现，20-30steps就能生成效果不错的图片，采样器设置页面中的 sigma noise，sigma tmin和sigma churn这三个属性会影响到它</li><li><strong>Euler a</strong>： 使用了祖先采样（Ancestral sampling）的Euler方法，受采样器设置中的eta参数影响</li><li><strong>LMS</strong>：线性多步调度器（Linear multistep scheduler）源于K-diffusion的项目实现</li><li><strong>heun</strong>：基于Karras论文，在K-diffusion实现，受采样器设置页面中的 sigma参数影响</li><li><strong>DPM2</strong>：这个是Katherine Crowson在K-diffusion项目中自创的，灵感来源Karras论文中的DPM-Solver-2和算法2，受采样器设置页面中的 sigma参数影响；DPM2 a使用了祖先采样（Ancestral sampling）的DPM2方法，受采样器设置中的ETA参数影响</li><li><strong>DPM++ 2S a</strong>：基于Cheng Lu等人的论文（改进后，后面又发表了一篇），在K-diffusion实现的2阶单步并使用了祖先采样（Ancestral sampling）的方法，受采样器设置中的eta参数影响；Cheng Lu的github中也提供已经实现的代码，并且可以自定义，1、2、3阶，和单步多步的选择，webui使用的是K-diffusion中已经固定好的版本。对细节感兴趣的小伙伴可以参考Cheng Lu的github和原论文。</li><li><strong>DPM++ 2M</strong>：基于Cheng Lu等人的论文（改进后的版本），在K-diffusion实现的2阶多步采样方法，在Hagging face中Diffusers中被称作已知最强调度器，在速度和质量的平衡最好。这个代表M的多步比上面的S单步在采样时会参考更多步，而非当前步，所以能提供更好的质量。但也更复杂。</li><li><strong>DPM++ SDE</strong>：基于Cheng Lu等人的论文的，DPM++的SDE版本，即随机微分方程（stochastic differential equations），而DPM++原本是ODE的求解器即常微分方程（ordinary differential equations），在K-diffusion实现的版本，代码中调用了祖先采样（Ancestral sampling）方法，所以受采样器设置中的ETA参数影响</li><li><strong>DPM fast</strong>： 基于Cheng Lu等人的论文，在K-diffusion实现的固定步长采样方法，用于steps小于20的情况，受采样器设置中的ETA参数影响</li><li><strong>DPM adaptive</strong>： 基于Cheng Lu等人的论文，在K-diffusion实现的自适应步长采样方法，DPM-Solver-12 和 23，受采样器设置中的ETA参数影响</li><li><strong>Karras后缀</strong>：LMS Karras 基于Karras论文，运用了相关Karras的noise schedule的方法，可以算作是LMS使用Karras noise schedule的版本；</li></ul> 
<p>同样的不同的采样方法会得到不同效果的图片：<br> <img src="https://images2.imgbox.com/f7/e9/8vARDCXB_o.png" alt="请添加图片描述"></p> 
<h5><a id="1213__136"></a>1.2.1.3 采样迭代步数</h5> 
<p>输出画面需要的步数，每一次采样步数都是在上一次的迭代步骤基础上绘制生成一个新的图片，一般来说采样迭代步数保持在 18-30 左右即可，低的采样步数会导致画面计算不完整，高的采样步数仅在细节处进行优化，对比输出速度得不偿失。<br> <img src="https://images2.imgbox.com/84/c7/4sfLLYqt_o.png" alt="请添加图片描述"></p> 
<h5><a id="1214__139"></a>1.2.1.4 提示词相关性</h5> 
<p>Stable Diffusion 中的提示词相关性指的是输入提示词对生成图像的影响程度。当我们提高提示词相关性时，生成的图像将更符合提示信息的样子；相反，如果提示词相关性较低，对应的权重也较小，则生成的图像会更加随机。<br> 因此，通过调整提示词相关性，可以引导模型生成更符合预期的样本，从而提高生成的样本质量。</p> 
<ol><li>在具体应用中，对于人物类的提示词，一般将提示词相关性控制在 7-15 之间；</li><li>而对于建筑等大场景类的提示词，一般控制在 3-7 左右。这样可以在一定程度上突出随机性，同时又不会影响生成图像的可视化效果。</li></ol> 
<p>因此，提示词相关性可以帮助我们通过引导模型生成更符合预期的样本，从而提高生成的样本质量。<br> <img src="https://images2.imgbox.com/31/42/A0XljRVj_o.png" alt="请添加图片描述"></p> 
<h5><a id="1215__148"></a>1.2.1.5 随机种子</h5> 
<p>随机种子是一个可以锁定生成图像的初始状态的值。当使用相同的随机种子和其他参数，我们可以生成完全相同的图像。设置随机种子可以增加模型的可比性和可重复性，同时也可以用于调试和优化模型，以观察不同参数对图像的影响。</p> 
<p>在 Stable Diffusion 中，常用的随机种子有-1 和其他数值。当输入-1 或点击旁边的骰子按钮时，生成的图像是完全随机的，没有任何规律可言。而当输入其他随机数值时，就相当于锁定了随机种子对画面的影响，这样每次生成的图像只会有微小的变化。因此，使用随机种子可以控制生成图像的变化程度，从而更好地探索模型的性能和参数的影响。<br> <img src="https://images2.imgbox.com/66/e9/5IvD8AT2_o.png" alt="请添加图片描述"></p> 
<h4><a id="122_SD__153"></a>1.2.2 SD 实战</h4> 
<h5><a id="1221__154"></a>1.2.2.1 基础功能</h5> 
<p>了解完Stable Dissusion最基础的参数之后，我们可以尝试去绘制一幅宇航员骑狗的图片。<br> 在这里我们选择基本的绘图参数：</p> 
<ul><li>模型：3H混合超细节机甲</li><li>采样方法：DPM++ 2S a Karras</li><li>采样迭代步数： 30</li><li>尺寸： 512*512</li><li>提示词相关性： 7</li><li>随机种子：2060336848</li><li>提示词： 
  <ul><li>内容提示词：<code>Astronauts riding dogs</code></li><li>画质提示词： 
    <ul><li>正向： <code>Posters, wallpapers,best quality,highly detailed,masterpiece,ultra-detailed,illustratio</code></li><li>反向：<code>lowres,bad hands,text,error,cropped,worst quality,low quality,normal quality,jpeg artifacts,watermark,username,blurry,blurryd</code></li></ul> </li><li>场景提示词：<code>simple background</code></li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/b7/ba/iRY3ltJs_o.png" alt="在这里插入图片描述"></p> 
<p>结果如下：<br> <img src="https://images2.imgbox.com/9c/34/d9RE94iJ_o.png" alt="请添加图片描述"></p> 
<h5><a id="1222__175"></a>1.2.2.2 高清修复</h5> 
<p>我们可以看到上面的图片尺寸比较小，这是因为显卡显存（笔者电脑只有8G）的限制导致。如果我们想在小显存上面获得比较清晰的图像，我们可以使用Stable Diffusion的高清修复功能。</p> 
<blockquote> 
 <p><strong>高清修复参数</strong>：<br> <strong>放大倍数</strong>：是指放大到原图的多少倍，也可以按照参数后面手动设置新图像的宽和高<br> <strong>重绘幅度</strong>：是和原图的差异度，一般推荐0.5，安全放大区间0.3-0.5，具有自由度区间0.5-0.7<br> <strong>高清采样次数</strong>：和采样迭代数一样，不用选择，保持默认0的迭代次数<br> <strong>放大算法</strong>：网上推荐无脑选择R-ESRGAN 4x+ 的，二次元的选择R-ESRGAN4x+ Anime6B,效果相较于其他算法是好一点的。<br> <strong>GFPGAN 可见度</strong>：人脸修复功能，能够让这些老照片恢复原有的光泽，使用了GAN算法对照片进行修复，效果比其他同类模型都有更好的表现。<br> <strong>CodeFormer 可见度</strong>：马赛克修复功能，这是一种基于 Transformer 的预测网络，能够对低质量人脸的全局组成和上下文进行建模以进行编码预测，即使在输入信息严重缺失的情况下也能复原出与目标人脸非常接近的自然人脸图像。</p> 
</blockquote> 
<p>高清修复主要有两种办法：</p> 
<ul><li><strong>附加功能</strong>：分两步，第一步生成低分辨率的图画，第二步使用它指定的高清算法，生成一个高分辨率的版本，在不改变构图的情况下丰富细节。缺陷就是生成图片的大小受限于显存的大小。<br> <img src="https://images2.imgbox.com/fd/fe/PCgJR2UY_o.png" alt="在这里插入图片描述"></li><li><strong>SD放大</strong>：根据指定的放大倍数，将图生图的图像拆解成若干小块按照固定逻辑重绘，再合并成一张大图，可以实现在低显存的条件下生成大尺寸的图片。这种方法除了指定SD脚本所需参数之外，还需要指定相关的提示词。</li></ul> 
<blockquote> 
 <p>注：由于原理是拼合，所以为了拼合更加合理，所以需要设置图像重叠像素。设置完之后，图像尺寸应该是原尺寸+重合像素的大小</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/69/42/4ZLK0XMb_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/c4/a1/huBEdFOI_o.png" alt="请添加图片描述"></p> 
<h5><a id="1223__192"></a>1.2.2.3 局部重绘</h5> 
<p>局部重绘就是将图片中我们不满意的地方进行重新绘制，直到达到用户满意的程度。我们刚刚骑的是狗，现在来骑马试试。</p> 
<blockquote> 
 <p>局部重绘参数说明：<br> <strong>蒙版</strong>：蒙住关键区域的板子，重绘图中黑色区域就是蒙版<br> <strong>蒙版模式</strong>：默认选择“重绘蒙版内容”，如果是“重绘非蒙版内容”就是重绘黑色区域以外的内容<br> <strong>重绘区域</strong>：就是你要求AI重绘的时候你所提供的信息，默认“原图”，如果选择“仅蒙版”，那么AI得不到全图信息，重绘后的部分会和其他的地方有割裂感。如果你选的是仅蒙版模式，要对于右侧的仅蒙版模式的边缘预留像素进行调整，默认32。这个预留像素的意思就是缓冲带，使得重绘拼图的时候看上去更加自然。<br> <strong>蒙版模糊</strong>：类似PS羽化效果，使得拼接更加丝滑<br> <strong>蒙版蒙住的内容</strong>：随便选，看缘分</p> 
</blockquote> 
<p>点击【图生图】–&gt; 【局部重绘】<br> <img src="https://images2.imgbox.com/96/e6/NI5eZ2Qf_o.png" alt="在这里插入图片描述"></p> 
<p>我们维持提示词不变，<strong>在提示词后面添加需要改动的提示词</strong>，在参数重绘幅度开到一个比较高的数值，比如0.75，当把鼠标移动到图片区域会出现一个画笔笔尖，在图片中你想要更改的地方涂上黑色区域，画错了还有撤销和橡皮擦功能在右上角可以使用<br> <img src="https://images2.imgbox.com/01/c9/PUI2U3Ux_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/d5/53/SrAff7c4_o.png" alt="请添加图片描述"></p> 
<h5><a id="1224_ControlNet_209"></a>1.2.2.4 ControlNet</h5> 
<p>Control Net是一款可以对Stable Diffusion扩散模型进行精确控制的插件。在SD安装之后我们可以在Web ui之中找到如下的ControlNet选项：<br> <img src="https://images2.imgbox.com/89/5f/sBiVBTKL_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>参数说明：<br> <strong>控制单元</strong>：一个ControlNet单元描述了一种对扩散模型的提示，如果想要有多个提示可以在【设置】–&gt; 【ControlNet】–&gt;【Multi ControlNet】选择单元数量。<br> <strong>效果预览</strong>：在上方存在两个出图的地方，右边就是预览效果图片的地方<br> <strong>ControlWeight</strong>：控制权重，表示ControlNet的提示信息的权重占比<br> <strong>ControlType</strong>：控制类型，会识别用户传入的控制信息，将其描绘为简单的表述形式。主要包含以下几种：</p> 
 <ul><li>姿态控制(OpenPose)：会识别用户传入人物的姿态信息，是用来解决AI不会画手的大杀器。</li><li>精确控制（Canny）：会识别用户传入的所有信息，将其和Prompt结合生成新的图像。</li><li>画面分割（Seg）：识别用户传入的元素布局，将其进行不同的归类，用以控制画面大体细节不变。</li><li>深度控制（Depth）：即深度图，用以传入空间信息给扩散模型</li></ul> 
</blockquote> 
<p>下面我们会通过实操来掩饰这几种控制类型的效果。<br> 参数信息如下：</p> 
<ul><li>模型：3H混合超细节机甲</li><li>采样方法：DPM++ 2S a Karras</li><li>采样迭代步数： 30</li><li>尺寸： 512*512</li><li>提示词相关性： 7</li><li>随机种子：2060336848</li><li>提示词： 
  <ul><li>内容提示词：<code>a humanoid robot, full body, facing viewer, </code></li><li>画质提示词： 
    <ul><li>正向： <code>Posters, wallpapers,best quality,highly detailed,masterpiece,ultra-detailed,illustratio</code></li><li>反向：<code>lowres,bad hands,text,error,cropped,worst quality,low quality,normal quality,jpeg artifacts,watermark,username,blurry,blurryd</code></li></ul> </li><li>场景提示词：<code>simple background</code></li></ul> </li></ul> 
<h6><a id="12241__236"></a>1.2.2.4.1 姿势控制</h6> 
<p>当我们上传图片之后，选择OpenPose姿态控制，之后点击爆炸。右边就会生成我们上传图片的骨骼图。<br> <img src="https://images2.imgbox.com/92/08/glkQNSAS_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/98/58/AGEUPkbW_o.png" alt="请添加图片描述"></p> 
<h6><a id="12242__240"></a>1.2.2.4.2 精确控制</h6> 
<p>当我们上传图片之后，选择Canny姿态控制，之后点击爆炸。右边就会生成我们上传图片的线稿图。<br> <img src="https://images2.imgbox.com/47/d8/XHl3Crfy_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/83/b4/EHhp58JV_o.png" alt="请添加图片描述"></p> 
<h6><a id="12243__244"></a>1.2.2.4.3 画面分割</h6> 
<p>当我们上传图片之后，选择Seg姿态控制，之后点击爆炸。右边就会生成我们上传图片的画面分割。<br> <img src="https://images2.imgbox.com/c2/e6/6Ex0gfg3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b2/4e/QAfZIofy_o.png" alt="请添加图片描述"></p> 
<h6><a id="12244__248"></a>1.2.2.4.4 深度图</h6> 
<p>由于刚刚的图片没有空间感，所以我们需要换一下内容提示词：</p> 
<ul><li>内容提示词：<code>Palace, Architecture,no human, </code><br> <img src="https://images2.imgbox.com/40/aa/9JAitZ6n_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1f/f6/uBKB5XY0_o.png" alt="请添加图片描述"></li></ul> 
<h2><a id="2_SD__253"></a>2. SD 商业应用场景</h2> 
<h3><a id="21__254"></a>2.1 吉祥物</h3> 
<p>下面是淘宝天猫的一个例子：<br> 模型：RevAnimated<br> Lora：粿条Tmall model 3D卡通天猫场景<br> <img src="https://images2.imgbox.com/d5/0a/NqRFdiCk_o.png" alt="请添加图片描述"></p> 
<h3><a id="22__259"></a>2.2 商品展示</h3> 
<p>以化妆品来举例：<br> 模型：chilloutmix<br> Lora：自然美妆场景<br> <img src="https://images2.imgbox.com/98/28/KetbchHm_o.jpg" alt="请添加图片描述"></p> 
<h3><a id="23_LOGO_264"></a>2.3 LOGO</h3> 
<p>模型：3H机甲<br> Lora：None<br> ControlNet：Depth<br> <img src="https://images2.imgbox.com/79/94/Y9AT17bm_o.png" alt="请添加图片描述"></p> 
<blockquote> 
 <p>注：森马已经用上了</p> 
</blockquote> 
<h3><a id="24__270"></a>2.4 商品模型</h3> 
<p>通过将产品的图片喂给模型，生成对应商品模型。之后便可以对这个商品进行快速出图。<br> <img src="https://images2.imgbox.com/ed/46/nNGsukrO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="__274"></a>附： 不同显卡出图效率</h3> 
<p><img src="https://images2.imgbox.com/37/43/P7A7y82a_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3__276"></a>3. 扩展插件推荐</h2> 
<p>可以在stable diffusion中的【扩展】–&gt;【从网址安装】安装不同的扩展<br> <img src="https://images2.imgbox.com/45/4f/NHKrrcpq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="31__280"></a>3.1 中文语言包</h3> 
<p>让SD支持中文:</p> 
<ul><li><strong>github</strong>: https://github.com/journey-ad/sd-webui-bilingual-localization</li></ul> 
<h3><a id="32__283"></a>3.2 图库浏览器</h3> 
<p>方便浏览作品，进行多种查询和管理</p> 
<ul><li><strong>github</strong>：https://github.com/AlUlkesh/stable-diffusion-webui-images-browser</li></ul> 
<blockquote> 
 <p>注：刚开始不显示图片信息，点击”首页“标签，就会加载好以前的图片</p> 
</blockquote> 
<h3><a id="33_Tag_Autocompletion_288"></a>3.3 Tag Autocompletion：实现提示词的补全、翻译</h3> 
<p>Tag Autocompletion：实现提示词的补全、翻译<br> 有像只能输入法，可以帮你智能补全提示词，并为你推荐更适合AI明白的提示词<br> 它还包含热门IP，比较方便<br> 输入尖括号&lt;&gt;，输入e、l、h就可以自动加载embeddings,lora,hypeenetwork模型<br> 链接：<a href="http://www.123114514.xyz/WebUI/Tag" rel="nofollow">http://www.123114514.xyz/WebUI/Tag</a><br> 下载那个zip，将解压后的安装包放到extension文件夹里面<br> <img src="https://images2.imgbox.com/68/e2/krZWBHRV_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="34_SD_upscale_297"></a>3.4 SD upscale</h3> 
<p>可以看成SD脚本放大功能的高级版，提供更多的绘制选项和更好的放大效果<br> 在安装包的这个包里面下载，同样放置在extension文件夹<br> <img src="https://images2.imgbox.com/ee/15/BDth8o7k_o.png" alt="在这里插入图片描述"><br> 重新打开SD，在图生图选项中可以找到。<br> <img src="https://images2.imgbox.com/27/3b/2QvWHcqX_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_303"></a>参考文献</h2> 
<ol><li><a href="https://zhuanlan.zhihu.com/p/621083328" rel="nofollow">Stable Diffusion-采样器篇</a> --&gt; 1.2.1 采样方法</li><li><a href="https://zhuanlan.zhihu.com/p/612572004" rel="nofollow">stable diffusion webui如何工作以及采样方法的对比</a> --&gt; 1.2.1 采样方法</li><li><a href="https://zhuanlan.zhihu.com/p/629521125" rel="nofollow">万字保姆级教程！Stable Diffusion完整入门指南</a> --&gt; 1.2 参数说明</li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f412f76b2e8bdf2e9d29b3cdffd55cc8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用jupyter运行sympy库</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cd5e28e38c2246bf3d91251db2d3e3df/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【纯新手向】手把手带你使用模板创建第一个鸿蒙端云一体化元服务</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>