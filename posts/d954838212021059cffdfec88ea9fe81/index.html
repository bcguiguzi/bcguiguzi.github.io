<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WRF模型运行教程（ububtu系统）--III.运行WRF模型（官网案例） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="WRF模型运行教程（ububtu系统）--III.运行WRF模型（官网案例）" />
<meta property="og:description" content="零、创建DATA目录 # 1.创建一个DATA目录用于存放数据（一般为fnl数据，放在Build_WRF目录下）。 mkdir DATA # 2.进入 DATA cd DATA 一、WPS预处理 在模拟之前先确定模拟域（即模拟范围）,并进行数据预处理（插值陆面数据，比如地形，土壤等数据；插值气象数据到模拟域）。
（一）解压GRIB数据（ungrib.exe） I.解压GRIB数据---GFS（Matthew案例研究数据） # 1.下载官网案例数据（matthew） 【此处数据可替换自己所需的数据】 wget https://www2.mmm.ucar.edu/wrf/TUTORIAL_DATA/matthew_1deg.tar.gz # 2.解压数据包 # 得到matthew文件夹 tar -xf matthew_1deg.tar.gz ​ # 【非必要步骤】 ​# 3.用下面的命令读取数据内容 # 注意 两个文件路径 g2print.exe、fnl_20161006_00_00.grib2 ../WPS/util/g2print.exe ../DATA/matthew/fnl_20161006_00_00.grib2 &gt;&amp; g2print.log # 4.用下面的命令查看数据内容 nano g2print.log g2print.log文件【文件位置：/Build_WRF/DATA/g2print.log】
# 5.进入WPS文件（准备链接数据） cd ~/Build_WRF/WPS/ # 6.链接GFS Vtable ln -sf ungrib/Variable_Tables/Vtable.GFS Vtable # 7.通过脚本link_grib.csh链接grib数据 ./link_grib.csh ~/Build_WRF/DATA/data/fnl 得到：会产生一些链接：GRIBFILE.AAA~GRIBFILE.AAI
文件位置：/Build_WRF/WPS/
8.切换WPS目录且编辑namelist.wps
文件位置：~/Build_WRF/WPS/namelist.wps
注意：下面三步都有文件生成，具体名称与使用的动态核心（ARM/NMM）有关。
# 8.编辑namelist.wps nano namelist.wps # 需要修改的内容 max_dom = 1 start_date = &#39;2016-10-06_00:00:00&#39;, end_date = &#39;2016-10-08_00:00:00&#39;, interval_seconds = 21600, prefix = &#39;FILE&#39;, 得到：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/d954838212021059cffdfec88ea9fe81/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-16T17:34:39+08:00" />
<meta property="article:modified_time" content="2024-03-16T17:34:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">WRF模型运行教程（ububtu系统）--III.运行WRF模型（官网案例）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>零、创建DATA目录   </h2> 
<pre><code class="language-bash"># 1.创建一个DATA目录用于存放数据（一般为fnl数据，放在Build_WRF目录下）。
mkdir DATA
# 2.进入 DATA
cd DATA</code></pre> 
<h2>一、WPS预处理</h2> 
<p><span style="color:#ff9900;"><strong>  </strong></span><span style="color:#38d8f0;"><strong>    </strong>在模拟之前先确定模拟域（即模拟范围）,并进行数据预处理（插值陆面数据，比如地形，土壤等数据；插值气象数据到模拟域）。</span></p> 
<h3 style="background-color:transparent;">（一）解压<strong>GRIB数据（ungrib.exe）</strong></h3> 
<h4>I.解压<strong><em>GRIB数据---</em></strong>GFS（Matthew案例研究数据）</h4> 
<pre><code class="language-bash"># 1.下载官网案例数据（matthew） 【此处数据可替换自己所需的数据】
wget https://www2.mmm.ucar.edu/wrf/TUTORIAL_DATA/matthew_1deg.tar.gz
# 2.解压数据包
# 得到matthew文件夹
tar -xf matthew_1deg.tar.gz
​</code></pre> 
<pre><code class="language-bash"># 【非必要步骤】
​# 3.用下面的命令读取数据内容
# 注意 两个文件路径 g2print.exe、fnl_20161006_00_00.grib2 
../WPS/util/g2print.exe ../DATA/matthew/fnl_20161006_00_00.grib2 &gt;&amp; g2print.log
# 4.用下面的命令查看数据内容
nano g2print.log
</code></pre> 
<p style="text-align:center;">g2print.log文件【文件位置：/Build_WRF/DATA/g2print.log】</p> 
<p><img alt="" height="760" src="https://images2.imgbox.com/12/da/GXVwBH7R_o.png" width="911"></p> 
<pre><code class="language-bash"># 5.进入WPS文件（准备链接数据）
cd ~/Build_WRF/WPS/
# 6.链接GFS Vtable
ln -sf ungrib/Variable_Tables/Vtable.GFS Vtable
# 7.通过脚本link_grib.csh链接grib数据
./link_grib.csh ~/Build_WRF/DATA/data/fnl</code></pre> 
<p><strong>得到：</strong>会产生一些链接：GRIBFILE.AAA~GRIBFILE.AAI</p> 
<p><strong>文件位置：</strong>/Build_WRF/WPS/</p> 
<p><img alt="" height="266" src="https://images2.imgbox.com/e1/93/PMYg6WL7_o.png" width="861"></p> 
<p><strong>8.切换WPS目录且编辑namelist.wps</strong></p> 
<p><strong>      文件位置</strong>：~/Build_WRF/WPS/namelist.wps<br><strong>      注意：</strong>下面三步都有文件生成，具体名称与使用的动态核心（ARM/NMM）有关。</p> 
<pre><code class="language-bash"># 8.编辑namelist.wps
nano namelist.wps
# 需要修改的内容
max_dom = 1
start_date = '2016-10-06_00:00:00',
end_date = '2016-10-08_00:00:00',
interval_seconds = 21600,
prefix = 'FILE',</code></pre> 
<p><strong>得到：</strong></p> 
<h3><img alt="" height="149" src="https://images2.imgbox.com/e9/08/AIyqRx0J_o.png" width="534"></h3> 
<h3><img alt="" height="86" src="https://images2.imgbox.com/7e/0d/RJ4J8NXg_o.png" width="439"></h3> 
<p><strong>9.解压GRIB数据（ungrib.exe）</strong></p> 
<p>      在WPS目录下运行：</p> 
<pre><code class="language-bash"># 9.解码资料
./ungrib.exe</code></pre> 
<p> 得到：生成中间文件FILE:YYYY-MM-DD_HH</p> 
<p><img alt="" height="454" src="https://images2.imgbox.com/03/dd/Xj31jZaP_o.png" width="706"></p> 
<pre><code class="language-bash"># 【非必要步骤】
# 了解中间文件：2016-10-06_00
./util/rd_intermediate.exe FILE:2016-10-06_00</code></pre> 
<p><img alt="" height="530" src="https://images2.imgbox.com/7d/5e/yyAZmq3f_o.png" width="574"></p> 
<h4>II.解压<strong><em>SST数据---</em></strong>海温资料</h4> 
<pre><code class="language-bash"># 1.下载官网案例数据（matthew_sst） 【此处数据可替换自己所需的数据】
wget https://www2.mmm.ucar.edu/wrf/TUTORIAL_DATA/matthew_sst.tar.gz
# 2.解压数据包
# 得到matthew_sst文件夹
tar -xf matthew_sst.tar.gz</code></pre> 
<pre><code class="language-bash"># 3.进入WPS文件（准备链接数据）
cd ~/Build_WRF/WPS/
# 4.链接GFS Vtable
ln -sf ungrib/Variable_Tables/Vtable.SST Vtable
# 5.通过脚本link_grib.csh链接grib数据
./link_grib.csh ../DATA/matthew_sst/rtg_sst_grb</code></pre> 
<p><strong>6.切换WPS目录且编辑namelist.wps</strong><br>       文件位置：~/Build_WRF/WPS/namelist.wps</p> 
<pre><code class="language-bash"># 6.编辑namelist.wps
nano namelist.wps
# 需要修改的内容
prefix = 'SST',</code></pre> 
<p>得到：</p> 
<p><img alt="" height="85" src="https://images2.imgbox.com/dc/b9/0pNduQyl_o.png" width="269"></p> 
<pre><code class="language-bash"># 7.解码资料
./ungrib.exe</code></pre> 
<p>得到：</p> 
<p><img alt="" height="422" src="https://images2.imgbox.com/3f/be/APmtboZl_o.png" width="605"></p> 
<h3 style="background-color:transparent;">（二）<strong>设置模式区域（geogrid.exe）</strong></h3> 
<p>    <span style="color:#38d8f0;"> geogrid.exe:用以</span><span style="color:#fe2c24;">确定模拟区域</span><span style="color:#38d8f0;">，并将</span><span style="color:#fe2c24;">陆面数据插值</span><span style="color:#38d8f0;">到模拟区域。</span>     </p> 
<p><strong>切换WPS目录且编辑namelist.wps</strong></p> 
<p><strong>      文件位置</strong>：~/Build_WRF/WPS/namelist.wps</p> 
<pre><code class="language-bash"># 编辑namelist.wps（注意：本例中没有进行嵌套，忽略第二行的数值）
nano namelist.wps
# 需要修改的内容
max_dom = 1 
parent_id = 1,
parent_grid_ratio = 1,
i_parent_start = 1,
j_parent_start = 1,
e_we = 91,
e_sn = 100,
geog_data_res = 'default',
dx = 27000,
dy = 27000,
map_proj = 'mercator',
ref_lat = 28.00,
ref_lon = -75.00,
truelat1 = 30.0,
truelat2 = 60.0,
stand_lon = -75.0,
geog_data_path = 'Your WPS_GEOG data location'
# 注意最后一行位置</code></pre> 
<p><strong>得到：</strong></p> 
<h3><img alt="" height="149" src="https://images2.imgbox.com/0f/c6/DIXK8wa6_o.png" width="534"></h3> 
<h3><img alt="" height="86" src="https://images2.imgbox.com/bc/96/1xoFfM21_o.png" width="439"></h3> 
<pre><code># 绘制所设区域，查看是否合理
ncl util/plotgrids.ncl</code></pre> 
<p>得到：</p> 
<p class="img-center"><img alt="" height="510" src="https://images2.imgbox.com/cb/6a/kyR2Y2nZ_o.png" width="498"></p> 
<p>注：ncl的安装可参考作者的另一篇文章：<a href="https://blog.csdn.net/weixin_47288291/article/details/136758601?spm=1001.2014.3001.5501" title="Ubuntu 20.04 系统如何优雅地安装NCL？-CSDN博客">Ubuntu 20.04 系统如何优雅地安装NCL？-CSDN博客</a></p> 
<pre><code class="language-bash"># 生成静态数据
./geogrid.exe</code></pre> 
<p>      生成文件geo_nmm.d01.nc</p> 
<p>得到：</p> 
<p><img alt="" height="420" src="https://images2.imgbox.com/bd/d9/8jvHYRHs_o.png" width="647"></p> 
<pre><code class="language-bash">#【非必要】
# 安装ncview
sudo apt install ncview
# 查看nc文件
ncview geo_em.d01.nc</code></pre> 
<p>查看结果：</p> 
<p class="img-center"><img alt="" height="440" src="https://images2.imgbox.com/b9/43/eg6kddUx_o.png" width="514"></p> 
<p class="img-center"><img alt="" height="313" src="https://images2.imgbox.com/6c/96/VLktmE1w_o.png" width="335"></p> 
<p></p> 
<h3 style="background-color:transparent;">（三）<strong>将数据插值到网格点上（metgrid.exe）</strong></h3> 
<p>      在WPS目录下运行：</p> 
<pre><code class="language-bash"># 插值
./metgrid.exe</code></pre> 
<p>      生成文件：</p> 
<p><img alt="" height="452" src="https://images2.imgbox.com/88/75/B4yPjT2s_o.png" width="725"></p> 
<h2>二、运行WRF<strong>（real.exe &amp; wrf.exe</strong><strong>）</strong></h2> 
<h3>1、切换至em_real目录</h3> 
<p>      WRF的操作在em_real目录（运行真实案例）</p> 
<pre><code class="language-bash">cd ~/Build_WRF/WRF/test/em_real/</code></pre> 
<h3>2、链接WPS到WRF</h3> 
<pre><code class="language-bash">ln -sf ~/Build_WRF/WPS/met_em* .
mpirun -np 1 ./real.exe
ls -alh wrfbdy_d01 wrfinput_d01</code></pre> 
<pre><code class="language-bash"># 修改WRF中的namelist.input
nano namelist.input
# 主要修改部分
run_days = 0,
run_hours = 48,
run_minutes = 0,
run_seconds = 0,
start_year = 2016,
start_month = 10,
start_day = 06,
start_hour = 00,
end_year = 2016,
end_month = 10,
end_day = 08,
end_hour = 00,
interval_seconds = 21600
input_from_file = .true.,
history_interval = 180,
frames_per_outfile = 1,
restart = .false.,
restart_interval = 1440,
time_step = 150,
max_dom = 1,
e_we = 91,
e_sn = 100,
e_vert = 45,
num_metgrid_levels = 32
dx = 27000,
dy = 27000,</code></pre> 
<pre><code class="language-bash"># 初始化模式：
./real.exe 
# 检查是否生成下面两个文件：
wrfinput_d01
wrfbdy_d01</code></pre> 
<h3>3、运行WRF</h3> 
<pre><code class="language-bash">mpirun -np 2 ./wrf.exe</code></pre> 
<p><strong>      注意</strong>：代码里的2是指2核运行<br>       此处已经完成，生成的wrf_out文件可以在修改后缀之后直接用python和NCL读取，读取方式类似于NC文件。</p> 
<h2>三、ARWpost处理数据文件</h2> 
<pre><code class="language-bash">cd ~/Build_WRF/ARWpost/
./ARWpost.exe</code></pre> 
<p>      生成的ctl和dat文件可以用grads处理</p> 
<h2>参考资料</h2> 
<p><a class="has-card" href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compilation_tutorial.php" rel="nofollow" title="1.WRF模型安装官方教程"><span class="link-card-box"><span class="link-title">1.WRF模型安装官方教程</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/bf/d0/UythwHKb_o.png" alt="icon-default.png?t=N7T8">https://www2.mmm.ucar.edu/wrf/OnLineTutorial/compilation_tutorial.php</span></span></a><a class="has-card" href="https://www2.mmm.ucar.edu/wrf/OnLineTutorial/CASES/SingleDomain/index.php" rel="nofollow" title="2..WRF官网运行案例-(单域案例 - 飓风马修)"><span class="link-card-box"><span class="link-title">2..WRF官网运行案例-(单域案例 - 飓风马修)</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/76/71/0TXTosoA_o.png" alt="icon-default.png?t=N7T8">https://www2.mmm.ucar.edu/wrf/OnLineTutorial/CASES/SingleDomain/index.php</span></span></a></p> 
<p><a class="has-card" href="https://mp.weixin.qq.com/s/v-qrvED6mcJ_VyPC7L9uKg" rel="nofollow" title="3.WRF实例模拟——飓风Matthew（2016）"><span class="link-card-box"><span class="link-title">3.WRF实例模拟——飓风Matthew（2016）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/1b/c4/GNvgo8wx_o.png" alt="icon-default.png?t=N7T8">https://mp.weixin.qq.com/s/v-qrvED6mcJ_VyPC7L9uKg</span></span></a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/efb8d74b6396c55e033f6c1d7a4fbb43/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Docker安装MySQL</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6d961357945694911fb557dd4b623f1b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python提示：不是内部或外部命令，也不是可执行的程序或批处理文件 问题解决方法——《跟老吕学Python编程》附录资料</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>