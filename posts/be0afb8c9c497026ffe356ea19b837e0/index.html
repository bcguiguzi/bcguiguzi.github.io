<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>umijs - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="umijs" />
<meta property="og:description" content="目录 一、umijs二、项目创建三、(内置)less和antd四、路由搭建配置式路由：约定式路由： 五、路由跳转及参数传递路由参数获取路由权限 六、网络请求内置umi-request模块axios发送请求 七、数据管理内置 [dva](http://dvajs.com/)搭建异步请求数据 effects 一、umijs umijs：开发文档：
umi=react&#43;less&#43;antd(实现按需加载)&#43;umi-request&#43;dva（react&#43;redux-saga）
二、项目创建 (1)先在本地创建项目名字
mkdir myapp &amp;&amp; cd myapp (2)执行创建
$ yarn create @umijs/umi-app # 或 npx @umijs/create-umi-app (3)下载依赖
yarn install (4)启动项目
yarn start 三、(内置)less和antd umijs内置了less和antd，无需再配置相关环境，直接使用就行
import s from &#39;./index.less&#39;; import {Button} from &#34;antd&#34;; export default function IndexPage() { return ( &lt;div&gt; &lt;h1 className={s.title}&gt;Page index&lt;/h1&gt; &lt;Button type=&#39;default&#39;&gt;按钮&lt;/Button&gt; &lt;/div&gt; ); 配置主题色，只需要指定颜色就可以了,umirc.ts文件可以完成所有配置项
// umirc.ts import { defineConfig } from &#39;umi&#39;; export default defineConfig({ ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/be0afb8c9c497026ffe356ea19b837e0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-03T19:17:46+08:00" />
<meta property="article:modified_time" content="2023-06-03T19:17:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">umijs</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><ul><li><a href="#umijs_6" rel="nofollow">一、umijs</a></li><li><a href="#_12" rel="nofollow">二、项目创建</a></li><li><a href="#lessantd_38" rel="nofollow">三、(内置)less和antd</a></li><li><a href="#_73" rel="nofollow">四、路由搭建</a></li><li><ul><li><a href="#_79" rel="nofollow">配置式路由：</a></li><li><a href="#_108" rel="nofollow">约定式路由：</a></li></ul> 
    </li><li><a href="#_133" rel="nofollow">五、路由</a></li><li><ul><li><a href="#_135" rel="nofollow">跳转及参数传递</a></li><li><a href="#_161" rel="nofollow">路由参数获取</a></li><li><a href="#_182" rel="nofollow">路由权限</a></li></ul> 
    </li><li><a href="#_219" rel="nofollow">六、网络请求</a></li><li><ul><li><a href="#umirequest_221" rel="nofollow">内置umi-request模块</a></li><li><a href="#axios_241" rel="nofollow">axios发送请求</a></li></ul> 
    </li><li><a href="#_dvahttpdvajscom_262" rel="nofollow">七、数据管理内置 [dva](http://dvajs.com/)</a></li><li><ul><li><a href="#_270" rel="nofollow">搭建</a></li><li><a href="#_effects_315" rel="nofollow">异步请求数据 effects</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="umijs_6"></a>一、umijs</h4> 
<p>umijs：<a href="https://v3.umijs.org/zh-CN/docs/getting-started" rel="nofollow">开发文档</a>：</p> 
<p>umi=react+less+antd(实现按需加载)+umi-request+dva（react+redux-saga）</p> 
<h4><a id="_12"></a>二、项目创建</h4> 
<p>(1)先在本地创建项目名字</p> 
<pre><code class="prism language-js">mkdir myapp <span class="token operator">&amp;&amp;</span> cd myapp
</code></pre> 
<p>(2)执行创建</p> 
<pre><code>$ yarn create @umijs/umi-app # 或 npx @umijs/create-umi-app
</code></pre> 
<p>(3)下载依赖</p> 
<pre><code class="prism language-js">yarn install
</code></pre> 
<p>(4)启动项目</p> 
<pre><code class="prism language-js">yarn start
</code></pre> 
<h4><a id="lessantd_38"></a>三、(内置)less和antd</h4> 
<p>umijs内置了less和antd，无需再配置相关环境，直接使用就行</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> s <span class="token keyword">from</span> <span class="token string">'./index.less'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>Button<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"antd"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">IndexPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&gt;</span>Page index<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">'default'</span><span class="token operator">&gt;</span>按钮<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>配置主题色，只需要指定颜色就可以了,umirc.ts文件可以完成所有配置项</p> 
<pre><code class="prism language-js"><span class="token comment">// umirc.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
   <span class="token operator">...</span>
  <span class="token comment">//配置antd的主题色</span>
  <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">'primary-color'</span><span class="token operator">:</span> <span class="token string">'#ffa39e'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_73"></a>四、路由搭建</h4> 
<p>umi路由分两种，1、umirc配置式路由。2、约定式路由</p> 
<h5><a id="_79"></a>配置式路由：</h5> 
<ul><li>不用引入组件，component默认加载，一级路由出口不用配置，默认进入一级，二级通过 <code>{props.children}</code> 配置出口</li><li>exact: umijs的路由默认都是精确匹配</li><li>有二级路由配置时候，外层路由匹配默认模糊匹配。这样设计的目的就是让我们路由能够进入到二级路由甚至更多嵌套路由</li></ul> 
<pre><code class="prism language-js"><span class="token comment">// umirc.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
   <span class="token operator">...</span>
 <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">exact</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/home'</span><span class="token punctuation">,</span> <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token string">'/home/product'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//重定向</span>
    <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'@/pages/home'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'@/pages/Login'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/home'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'@/pages/Home'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">exact</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/home'</span><span class="token punctuation">,</span> <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token string">'/home/product'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/home/product'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'@/pages/Product'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'@/pages/404'</span> <span class="token punctuation">}</span> <span class="token comment">// 放在最后，没有psth属性，前面所有都不匹配就404</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre> 
<h5><a id="_108"></a>约定式路由：</h5> 
<ul><li><a href="https://v3.umijs.org/zh-CN/docs/convention-routing" rel="nofollow">umi</a> 提供的一种路由方式，无需搭建映射。文件系统就是路由系统（文件路由）。前提是按照官方给定的约束，来创建项目结构，且umirc中没有routes配置。路由会自动生成。</li><li>[ ]包裹的文件名是动态路由参数名，见<a href="https://v3.umijs.org/zh-CN/docs/convention-routing#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1" rel="nofollow">详情</a></li></ul> 
<p>被注册为路由的规则：</p> 
<ol><li>必须以<code>.js</code>、<code>.jsx</code>、<code>.ts</code> 或 <code>.tsx</code> 结尾的文件，内容必须有JSX元素，且不能是以 <code>test.ts</code>、<code>spec.ts</code>、<code>e2e.ts</code> 结尾的测试文件</li><li>文件或目录不以 <code>.</code> 或 <code>_</code> 开头</li><li>不是<code>components</code> 和 <code>component</code>、<code>utils</code> 和 <code>util</code>下的文件</li></ol> 
<p>全局约定式路由：约定 <code>src/layouts/index.tsx</code> 为全局路由<br> 嵌套路由：约定以 对应文件下<code>_layout.tsx</code> 为嵌套路由，</p> 
<pre><code class="prism language-js"><span class="token comment">// src/**/_layout.tsx</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">_layout</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span>any</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_133"></a>五、路由</h4> 
<h5><a id="_135"></a>跳转及参数传递</h5> 
<pre><code class="prism language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Link<span class="token punctuation">,</span> NavLink<span class="token punctuation">,</span> useHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"umi"</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Product</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span>any</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">useHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">gotoPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// props.history.push("/home/user?id=1")</span>
    history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"/home/user?id=1"</span><span class="token punctuation">)</span>
    history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">pathname</span><span class="token operator">:</span><span class="token string">"/home/user"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">query</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/home/user?id=1"</span><span class="token operator">&gt;</span>点击跳转<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/home/user?id=1"</span><span class="token operator">&gt;</span>点击跳转<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>gotoPage<span class="token punctuation">}</span><span class="token operator">&gt;</span>函数式跳转<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_161"></a>路由参数获取</h5> 
<p>umi参数传递，不管是那种方式，默认已经封装为一个对象，直接获取使用</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useLocation<span class="token punctuation">,</span> useParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"umi"</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_182"></a>路由权限</h5> 
<p>React开发中为了解决这个问题，自行封装高阶组件，动态生成Route组件。</p> 
<p>umi 中使用wrappers属性，提供auth组件来处理</p> 
<pre><code class="prism language-js"><span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'@/pages/index'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/register'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">'@/pages/Register'</span><span class="token punctuation">,</span> <span class="token literal-property property">wrappers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'@/wrappers/auth'</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> 
<p>auth组件代码为</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//   const { isLogin } = useAuth(); // 自定义hook。</span>
    <span class="token keyword">const</span> isLogin <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">"/login"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_219"></a>六、网络请求</h4> 
<h5><a id="umirequest_221"></a>内置umi-request模块</h5> 
<p>底层采用的fetch来实现，语法： <code>request.post("地址",{data:{}}) </code></p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">"umi-request"</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:8002/users/geUserList"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>fetchData<span class="token punctuation">}</span><span class="token operator">&gt;</span>请求发送<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="axios_241"></a>axios发送请求</h5> 
<p>axios相对内置 request 来说功能更丰富。比如请求拦截器、终端请求等等，一般使用axios</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">"umi-request"</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token function-variable function">axiosGetData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:8002/users/getAccountList2"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>axiosGetData<span class="token punctuation">}</span><span class="token operator">&gt;</span>axios请求<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_dvahttpdvajscom_262"></a>七、数据管理内置 <a href="http://dvajs.com/" rel="nofollow">dva</a></h4> 
<p>react一般结合redux来完成数据仓库管理（react+redux+redux-thunk）</p> 
<p>dva框架：react封装的框架，主要包括 react-redux、redux-saga。</p> 
<p>在umi中，内置dva作为一个插件来进行数据管理</p> 
<h5><a id="_270"></a>搭建</h5> 
<p>(1) 无需下载任何插件，src/models，models下的ts文件，默认会被加载为数据仓库(状态机)文件</p> 
<p>默认文件名字就是命名空间名字。必须要指定命名空间</p> 
<pre><code class="prism language-js"><span class="token comment">// src/models/userModel.ts</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 数据</span>
    <span class="token literal-property property">state</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">userName</span><span class="token operator">:</span><span class="token string">'神农'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 处理异步请求</span>
    <span class="token literal-property property">effects</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 存放 reducer 代码</span>
    <span class="token literal-property property">reducers</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">initState</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">state</span><span class="token operator">:</span>any<span class="token punctuation">,</span> <span class="token literal-property property">action</span><span class="token operator">:</span>any</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            state<span class="token punctuation">.</span>count <span class="token operator">=</span> action<span class="token punctuation">.</span>payload
            <span class="token keyword">return</span> state
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>(2)页面上使用状态机的数据</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>useDispatch<span class="token punctuation">,</span>useSelector<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"umi"</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>userName<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> state<span class="token punctuation">.</span>userModel
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//派发请求修改仓库数据</span>
<span class="token keyword">const</span> <span class="token function-variable function">changeUserName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 派发action到reducer的时候,必须指定命名空间名字</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"userModel/initState"</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'尝百草'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
 <span class="token keyword">const</span> dispatch <span class="token operator">=</span>  <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>userName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>changeUserName<span class="token punctuation">}</span><span class="token operator">&gt;</span>更新名字<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="_effects_315"></a>异步请求数据 effects</h5> 
<p><code>redux</code> 默认没有异步请求模块，需要借助于中间件来实现</p> 
<p><code>redux-thunk</code>：加强dispatch，在派发到reducer之前发送异步请求，得到结果赋值给 reducer</p> 
<p><code>redux-saga</code>：也是用于处理异步请求的中间件，采用 <code>iterator迭代器</code>与 <code>generato </code> 编程来实现异步请求</p> 
<pre><code class="prism language-js"><span class="token comment">// src/models/userModel.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getAllUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/user"</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 数据</span>
    <span class="token literal-property property">state</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">userName</span><span class="token operator">:</span><span class="token string">'神农'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 处理异步请求</span>
    <span class="token literal-property property">effects</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
         <span class="token comment">// generator语法代码，函数前加 *</span>
        <span class="token operator">*</span><span class="token function">getAllUserSaga</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span>payload<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 默认只能传递一个参数,如果多个参数,封装为对象传递过去</span>
            <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>getAllUser<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"initUser"</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 存放 reducer 代码</span>
    <span class="token literal-property property">reducers</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">initState</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">state</span><span class="token operator">:</span>any<span class="token punctuation">,</span> <span class="token literal-property property">action</span><span class="token operator">:</span>any</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            state<span class="token punctuation">.</span>count <span class="token operator">=</span> action<span class="token punctuation">.</span>payload
            <span class="token keyword">return</span>  <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span>state <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在函数有里面yield关键字来控制执行顺序。等待异步的结果</p> 
<p>put方法来调用 dispatch ，派发给reducer，更新仓库数据</p> 
<p>以上就是umi的简单使用，更多内容，查看<a href="https://v3.umijs.org/zh-CN/docs/getting-started" rel="nofollow">开发文档</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d5b2ac6aae979d0c2fa0647bc5b8683b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;初阶 — vector</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/552c865c63811c12a32ea34d70106ebc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">The connection to the server xx:6443 was refused - did you specify the right host or port?</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>