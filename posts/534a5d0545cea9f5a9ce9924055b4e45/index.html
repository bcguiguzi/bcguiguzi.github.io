<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ORA-03113：通信通道的文件结尾-完美解决方案 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ORA-03113：通信通道的文件结尾-完美解决方案" />
<meta property="og:description" content="oracle 文档中对这个错误这样解释： ORA-03113 错误就是说连接到数据库的网络中断了。有些错误由于频繁出现、原因复杂而被 Oracle DBA 们戏称之为&#34;经典的错误&#34;。
完美解决方案：
1、查看系统表空间用量： SELECT a.tablespace_name, a.bytes total, b.bytes used, c.bytes free, ( b.bytes * 100 ) / a.bytes &#34;% USED &#34;, ( c.bytes * 100 ) / a.bytes &#34;% FREE &#34; FROM sys.sm$ts_avail a, sys.sm$ts_used b, sys.sm$ts_free c WHERE a.tablespace_name = b.tablespace_name AND a.tablespace_name = c.tablespace_name; 2、分析ORA-03113主要原因 从图中主要分析SYSTEM、SYSAUX表空间用量，原因有两点：
1）、SYSTEM中审计表aud$在数据库编程过程中，对SQL语句的编译过程，资源占用会较大，因此在sys账户下查看，
select count(*) sum from AUD$; 会得知，该数值会非常大。
2）、SYSAUX则进行的是AWR快照，也会进行占用较多的空间。
因此，出现ORA-03113，一般以上两个空间会出现严重不足情况。
3、完美解决方式 用sys账户dba登录，两个原因一一解决：
1）、清理AUD$审计表记录；
Truncate table AUD$; 清理AUD$审计表一条命令即可。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/534a5d0545cea9f5a9ce9924055b4e45/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-22T09:47:58+08:00" />
<meta property="article:modified_time" content="2023-09-22T09:47:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ORA-03113：通信通道的文件结尾-完美解决方案</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>oracle 文档中对这个错误这样解释：</h3> 
<p>ORA-03113 错误就是说连接到数据库的网络中断了。有些错误由于频繁出现、原因复杂而被 Oracle DBA 们戏称之为"经典的错误"。</p> 
<p> </p> 
<p class="img-center"><img alt="" height="237" src="https://images2.imgbox.com/9a/06/klNugGbJ_o.png" width="475"></p> 
<p></p> 
<p></p> 
<p>完美解决方案：</p> 
<h3>1、查看系统表空间用量：</h3> 
<pre><code class="language-sql">SELECT
	a.tablespace_name,
	a.bytes total,
	b.bytes used,
	c.bytes free,
	( b.bytes * 100 ) / a.bytes "% USED ",
	( c.bytes * 100 ) / a.bytes "% FREE " 
FROM
	sys.sm$ts_avail a,
	sys.sm$ts_used b,
	sys.sm$ts_free c 
WHERE
	a.tablespace_name = b.tablespace_name 
	AND a.tablespace_name = c.tablespace_name;</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="161" src="https://images2.imgbox.com/ee/70/8S6LcbYg_o.png" width="583"></p> 
<p></p> 
<h3>2、分析ORA-03113主要原因</h3> 
<p>从图中主要分析SYSTEM、SYSAUX表空间用量，原因有两点：</p> 
<p>       1）、SYSTEM中审计表aud$在数据库编程过程中，对SQL语句的编译过程，资源占用会较大，因此在sys账户下查看，</p> 
<pre><code class="language-sql">select count(*) sum from AUD$;</code></pre> 
<p>会得知，该数值会非常大。</p> 
<p></p> 
<p>        2）、SYSAUX则进行的是AWR快照，也会进行占用较多的空间。</p> 
<p>        因此，出现ORA-03113，一般以上两个空间会出现严重不足情况。</p> 
<h3>3、完美解决方式</h3> 
<p>       用sys账户dba登录，两个原因一一解决：</p> 
<p>              1）、清理AUD$审计表记录；</p> 
<pre><code class="language-sql">Truncate table AUD$;</code></pre> 
<p>                       清理AUD$审计表一条命令即可。</p> 
<p>            2)、清理AWR快照步骤稍有麻烦</p> 
<pre><code class="language-sql">select dbid, retention from dba_hist_wr_control;</code></pre> 
<p><img alt="" height="108" src="https://images2.imgbox.com/0c/0d/49062HBm_o.png" width="293"></p> 
<pre><code class="language-sql">select min(snap_id), max(snap_id) from dba_hist_snapshot where dbid = 1673414163;</code></pre> 
<p>执行结果</p> 
<p>MIN(SNAP_ID) MAX(SNAP_ID)</p> 
<p>------------ ------------</p> 
<p>        7689         7896</p> 
<pre><code class="language-sql">exec dbms_workload_repository.drop_snapshot_range(7689, 7896,1673414163)</code></pre> 
<p>执行结果：PL/SQL procedure successfully completed</p> 
<p></p> 
<pre><code class="language-sql">select min(snap_id), max(snap_id) from dba_hist_snapshot where dbid = 1673414163;</code></pre> 
<p></p> 
<p>AWR快照清理结束。</p> 
<p>清理后，再去查看system表空间，对比前后结果会有明显变化，这是再进行数据库开发时，不会出现ORA-03113错误。</p> 
<p></p> 
<p>4、总结</p> 
<p>此种解决方案，针对的是数据库开发工作较多情况下，如大量的PL/SQL的函数、包、过程的开发、编译，建议在生产环境尽量不要进行开发，或是生产环境单独将审计和快照移至专门的表空间。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cb3389c4a7ced92ae11356feda93d3cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">c&#43;&#43;八股文</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/13417264ed2d5fdf2458342555889f6f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Docker注入环境变量且设置多个环境变量</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>