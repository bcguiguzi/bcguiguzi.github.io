<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>洛谷P1072 Hankson 的趣味题（题解） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="洛谷P1072 Hankson 的趣味题（题解）" />
<meta property="og:description" content="https://www.luogu.org/problemnew/show/P1072（题目传送）
数学的推理在编程的体现越来越明显了。（本人嘀咕）
首先，我们知道这两个等式： (a0,x)=a1,[b0,x]=b1(a0,x)=a1,[b0,x]=b1
于是，我们可以设： x=a1*p,b1=x*tx=a1∗p,b1=x∗t
于是有： a1*p*t=b1a1∗p∗t=b1
所以我们令： b1/a1=sb1/a1=s
则： p*t=sp∗t=s
即： t=s/pt=s/p
又由最大公约数与最小公倍数的定义与性质可得：
(a0/a1,p)=1,(b1/b0,t)=1(a0/a1,p)=1,(b1/b0,t)=1
所以我们令： a0/a1=m,b1/b0=na0/a1=m,b1/b0=n
则有： (p,m)=1,(s/p,n)=1(p,m)=1,(s/p,n)=1
这就是第一个结论，我们称其为结论一。事实上，我们其实已经可以由结论一整理出可以AC的方法，即用sqrt(s)的复杂度枚举s的因数，然后将每个因数放到结论一中，看看是否成立，再统计所有符合结论一的因数的个数，然后输出即可。这种算法的复杂度是：O(sqrt(s)*log(s)*n)。这样其实也能卡过数据，但是还是没有达到理论上的通过。所以我们还要继续优化。
我们考虑(s/p,n)=1。如果s/p与n有相同质因数，则无法使(s/p,n)=1成立。于是，为了使(s/p,n)=1成立，我们可以将s与n所有相同的质因数从s中去掉（不动s/p的原因是s/p是s的因变量，改变无意义），得到剩余的数l，若(s/p,n)=1成立，s/p就必须是l的约数。
我们继续考虑(p,m)=1。因为s/p是l的约数，那么p就一定可以表示为这样的形式：
p=(s/l)*r（因为s/p*r=p,r属于N*）
即：p一定是s/l的倍数（因为s/p是l的约数），r也是l的约数。于是就又有：
r|l,且(r,m)=1
这就是第二个结论，我们称其为结论二。而解决结论二的方法便很明显了。我们可以用与解决结论一相似的方法，将l与m所有相同的质因数从l中去掉，得到剩余的数q。那么所有使结论二成立的r都是q的因数了。然后，我们可以用sqrt(q)的复杂度枚举q的所有因数，输出q的因数个数就行了。这样，复杂度便降到了：O((sqrt(s)&#43;log(s))*n)，从理论来说也不会超时了。
还有一点需要注意，那就是特判没有符合要求的x的情况。这种情况出现只有四种可能：
1、s不为整数 2、m不为整数 3、n不为整数 4、(s/l,m)≠1，即因为p是s/l的倍数，所以无论r取何值，都会有(p,m)≠1 加上这四个特判，这道题便做完了。（来个总结公式：结论成立=筛去必要条件的不足&#43;必要条件，这也算是一种思路吧）
AC代码：
1 #include&lt;cstdio&gt; 2 #include&lt;iostream&gt; 3 #include&lt;cmath&gt; 4 #include&lt;algorithm&gt; 5 #include&lt;cstring&gt; 6 #include&lt;string&gt; 7 using namespace std; 8 int ssqrt; 9 int cf(int a,int b)//去掉a中与b共有的质因数。思想：将b质因数分解，同时将a中与b共有的质因数去掉。 10 { 11 ssqrt=sqrt(b); 12 for(int i=2;i&lt;=ssqrt;i&#43;&#43;)//sqrt(b)复杂度质因数分解b 13 { 14 if(b%i==0)while(a%i==0)a/=i;//去掉a中与b共有的质因数，将a分解 15 while(b%i==0)b/=i;//将b质因数分解 16 } 17 if(b!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/b1643cfd53d7fdc1af062dd57577b0e3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-03-26T10:59:00+08:00" />
<meta property="article:modified_time" content="2019-03-26T10:59:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">洛谷P1072 Hankson 的趣味题（题解）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p>https://www.luogu.org/problemnew/show/P1072（题目传送）</p> 
 <p><span style="font-family:'隶书';">数学的推理在编程的体现越来越明显了。<span style="text-decoration:line-through;"><em>（本人嘀咕）</em></span></span></p> 
 <p>首先，我们知道这两个等式： (a0,x)=a1,[b0,x]=b1(a0,x)=a1,[b0,x]=b1</p> 
 <p>于是，我们可以设： x=a1*p,b1=x*tx=a1∗p,b1=x∗t</p> 
 <p>于是有： a1*p*t=b1a1∗p∗t=b1</p> 
 <p>所以我们令： b1/a1=sb1/a1=s</p> 
 <p>则： p*t=sp∗t=s</p> 
 <p>即： t=s/pt=s/p</p> 
 <p>又由最大公约数与最小公倍数的定义与性质可得：</p> 
 <p>(a0/a1,p)=1,(b1/b0,t)=1(a0/a1,p)=1,(b1/b0,t)=1</p> 
 <p>所以我们令： a0/a1=m,b1/b0=na0/a1=m,b1/b0=n</p> 
 <p>则有： (p,m)=1,(s/p,n)=1(p,m)=1,(s/p,n)=1</p> 
 <p>这就是第一个结论，我们称其为结论一。事实上，我们其实已经可以由结论一整理出可以AC的方法，即用sqrt(s)的复杂度枚举s的因数，然后将每个因数放到结论一中，看看是否成立，再统计所有符合结论一的因数的个数，然后输出即可。这种算法的复杂度是：O(sqrt(s)*log(s)*n)。这样其实也能卡过数据，但是还是没有达到理论上的通过。所以我们还要继续优化。</p> 
 <p>我们考虑(s/p,n)=1。如果s/p与n有相同质因数，则无法使(s/p,n)=1成立。于是，为了使(s/p,n)=1成立，我们可以将s与n所有相同的质因数从s中去掉（不动s/p的原因是s/p是s的因变量，改变无意义），得到剩余的数l，若(s/p,n)=1成立，s/p就必须是l的约数。</p> 
 <p>我们继续考虑(p,m)=1。因为s/p是l的约数，那么p就一定可以表示为这样的形式：</p> 
 <p>p=(s/l)*r（因为s/p*r=p,r属于N<sup>*</sup>）</p> 
 <p>即：p一定是s/l的倍数（因为s/p是l的约数），r也是l的约数。于是就又有：</p> 
 <p>r|l,且(r,m)=1</p> 
 <p>这就是第二个结论，我们称其为结论二。而解决结论二的方法便很明显了。我们可以用与解决结论一相似的方法，将l与m所有相同的质因数从l中去掉，得到剩余的数q。那么所有使结论二成立的r都是q的因数了。然后，我们可以用sqrt(q)的复杂度枚举q的所有因数，输出q的因数个数就行了。这样，复杂度便降到了：O((sqrt(s)+log(s))*n)，从理论来说也不会超时了。</p> 
 <p>还有一点需要注意，那就是特判没有符合要求的x的情况。这种情况出现只有四种可能：</p> 
 <h4>1、s不为整数</h4> 
 <h4>2、m不为整数</h4> 
 <h4>3、n不为整数</h4> 
 <h4>4、(s/l,m)≠1，即因为p是s/l的倍数，所以无论r取何值，都会有(p,m)≠1</h4> 
 <p>加上这四个特判，这道题便做完了。<span style="font-family:'隶书';">（来个总结公式：结论成立=筛去必要条件的不足+必要条件，这也算是一种思路吧）</span></p> 
 <p>AC代码：</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008080;"> 1</span> #include&lt;cstdio&gt;
<span style="color:#008080;"> 2</span> #include&lt;iostream&gt;
<span style="color:#008080;"> 3</span> #include&lt;cmath&gt;
<span style="color:#008080;"> 4</span> #include&lt;algorithm&gt;
<span style="color:#008080;"> 5</span> #include&lt;cstring&gt;
<span style="color:#008080;"> 6</span> #include&lt;<span style="color:#0000ff;">string</span>&gt;
<span style="color:#008080;"> 7</span> <span style="color:#0000ff;">using</span> <span style="color:#0000ff;">namespace</span><span style="color:#000000;"> std;
</span><span style="color:#008080;"> 8</span> <span style="color:#0000ff;">int</span><span style="color:#000000;"> ssqrt;
</span><span style="color:#008080;"> 9</span> <span style="color:#0000ff;">int</span> cf(<span style="color:#0000ff;">int</span> a,<span style="color:#0000ff;">int</span> b)<span style="color:#008000;">//</span><span style="color:#008000;">去掉a中与b共有的质因数。思想：将b质因数分解，同时将a中与b共有的质因数去掉。</span>
<span style="color:#008080;">10</span> <span style="color:#000000;">{
</span><span style="color:#008080;">11</span>     ssqrt=<span style="color:#000000;">sqrt(b);
</span><span style="color:#008080;">12</span>     <span style="color:#0000ff;">for</span>(<span style="color:#0000ff;">int</span> i=<span style="color:#800080;">2</span>;i&lt;=ssqrt;i++)<span style="color:#008000;">//</span><span style="color:#008000;">sqrt(b)复杂度质因数分解b</span>
<span style="color:#008080;">13</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">14</span>         <span style="color:#0000ff;">if</span>(b%i==<span style="color:#800080;">0</span>)<span style="color:#0000ff;">while</span>(a%i==<span style="color:#800080;">0</span>)a/=i;<span style="color:#008000;">//</span><span style="color:#008000;">去掉a中与b共有的质因数，将a分解</span>
<span style="color:#008080;">15</span>         <span style="color:#0000ff;">while</span>(b%i==<span style="color:#800080;">0</span>)b/=i;<span style="color:#008000;">//</span><span style="color:#008000;">将b质因数分解</span>
<span style="color:#008080;">16</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">17</span>     <span style="color:#0000ff;">if</span>(b!=<span style="color:#800080;">1</span>)<span style="color:#0000ff;">while</span>(a%b==<span style="color:#800080;">0</span>)a/=b;<span style="color:#008000;">//</span><span style="color:#008000;">注意：此时b可能还不是1，因为b可能有比sqrt(b)更大的质因数，但至多只有一个，且它的次幂至多是1。所以如果b不是1，那就只能是一个质数。于是此时继续分解a。</span>
<span style="color:#008080;">18</span>     <span style="color:#0000ff;">return</span> a;<span style="color:#008000;">//</span><span style="color:#008000;">返回剩下的a</span>
<span style="color:#008080;">19</span> <span style="color:#000000;">}
</span><span style="color:#008080;">20</span> <span style="color:#0000ff;">int</span> gcd(<span style="color:#0000ff;">int</span> a,<span style="color:#0000ff;">int</span> b){<!-- --><span style="color:#0000ff;">return</span> b==<span style="color:#800080;">0</span>?a:gcd(b,a%b);}<span style="color:#008000;">//</span><span style="color:#008000;">辗转相除求最大公约数</span>
<span style="color:#008080;">21</span> <span style="color:#0000ff;">int</span><span style="color:#000000;"> main()
</span><span style="color:#008080;">22</span> <span style="color:#000000;">{
</span><span style="color:#008080;">23</span>     <span style="color:#0000ff;">int</span><span style="color:#000000;"> a0,a1,b0,b1;
</span><span style="color:#008080;">24</span>     <span style="color:#0000ff;">int</span><span style="color:#000000;"> gs;
</span><span style="color:#008080;">25</span>     <span style="color:#0000ff;">int</span><span style="color:#000000;"> m,n,s,l,q;
</span><span style="color:#008080;">26</span>     scanf(<span style="color:#800000;">"</span><span style="color:#800000;">%d</span><span style="color:#800000;">"</span>,&amp;<span style="color:#000000;">gs);
</span><span style="color:#008080;">27</span>     <span style="color:#0000ff;">int</span><span style="color:#000000;"> cnt;
</span><span style="color:#008080;">28</span>     <span style="color:#0000ff;">while</span>(gs--<span style="color:#000000;">)
</span><span style="color:#008080;">29</span> <span style="color:#000000;">    {
</span><span style="color:#008080;">30</span>         scanf(<span style="color:#800000;">"</span><span style="color:#800000;">%d%d%d%d</span><span style="color:#800000;">"</span>,&amp;a0,&amp;a1,&amp;b0,&amp;<span style="color:#000000;">b1);
</span><span style="color:#008080;">31</span>         <span style="color:#0000ff;">if</span>(a0%a1|b1%b0|b1%a1){printf(<span style="color:#800000;">"</span><span style="color:#800000;">0\n</span><span style="color:#800000;">"</span>);<span style="color:#0000ff;">continue</span>;}<span style="color:#008000;">//</span><span style="color:#008000;">如果m、n、s中有小数，则直接输出0。这里的代码用到了一些位运算</span>
<span style="color:#008080;">32</span>         m=a0/a1,n=b1/b0,s=b1/a1;l=cf(s,n);<span style="color:#008000;">//</span><span style="color:#008000;">求出m、n、s，然后求出l</span>
<span style="color:#008080;">33</span>         <span style="color:#0000ff;">if</span>(gcd(max(s/l,m),min(s/l,m))!=<span style="color:#800080;">1</span>){printf(<span style="color:#800000;">"</span><span style="color:#800000;">0\n</span><span style="color:#800000;">"</span>);<span style="color:#0000ff;">continue</span>;}<span style="color:#008000;">//</span><span style="color:#008000;">如果不互质，则直接输出0</span>
<span style="color:#008080;">34</span>         q=cf(l,m);cnt=<span style="color:#800080;">0</span>,ssqrt=sqrt(q);<span style="color:#008000;">//</span><span style="color:#008000;">求出q，开始枚举q的因数，求出q的因数个数</span>
<span style="color:#008080;">35</span>         <span style="color:#0000ff;">for</span>(<span style="color:#0000ff;">int</span> i=<span style="color:#800080;">1</span>;i&lt;=ssqrt;i++)<span style="color:#0000ff;">if</span>(q%i==<span style="color:#800080;">0</span>)cnt+=i==q/i?<span style="color:#800080;">1</span>:<span style="color:#800080;">2</span>;<span style="color:#008000;">//</span><span style="color:#008000;">这里注意，如果i==q/i，则只加1，否则加2</span>
<span style="color:#008080;">36</span>         printf(<span style="color:#800000;">"</span><span style="color:#800000;">%d\n</span><span style="color:#800000;">"</span>,cnt);<span style="color:#008000;">//</span><span style="color:#008000;">输出</span>
<span style="color:#008080;">37</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">38</span>     <span style="color:#0000ff;">return</span> <span style="color:#800080;">0</span>;</pre> 
 </div> 
 <p>另附应用结论一的代码（好像更快。。。估计上面代码cf函数拖时间了吧）：</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008080;"> 1</span> #include&lt;cstdio&gt;
<span style="color:#008080;"> 2</span> <span style="color:#0000ff;">using</span> <span style="color:#0000ff;">namespace</span><span style="color:#000000;"> std;
</span><span style="color:#008080;"> 3</span> <span style="color:#0000ff;">int</span> gcd(<span style="color:#0000ff;">int</span> a,<span style="color:#0000ff;">int</span><span style="color:#000000;"> b) {
</span><span style="color:#008080;"> 4</span>     <span style="color:#0000ff;">return</span> b==<span style="color:#800080;">0</span>?a:gcd(b,a%<span style="color:#000000;">b);
</span><span style="color:#008080;"> 5</span> <span style="color:#000000;">}
</span><span style="color:#008080;"> 6</span> <span style="color:#0000ff;">int</span><span style="color:#000000;"> main() {
</span><span style="color:#008080;"> 7</span>     <span style="color:#0000ff;">int</span><span style="color:#000000;"> T;
</span><span style="color:#008080;"> 8</span>     scanf(<span style="color:#800000;">"</span><span style="color:#800000;">%d</span><span style="color:#800000;">"</span>,&amp;<span style="color:#000000;">T);
</span><span style="color:#008080;"> 9</span>     <span style="color:#0000ff;">while</span>(T--<span style="color:#000000;">) {
</span><span style="color:#008080;">10</span>         <span style="color:#0000ff;">int</span><span style="color:#000000;"> a0,a1,b0,b1;
</span><span style="color:#008080;">11</span>         scanf(<span style="color:#800000;">"</span><span style="color:#800000;">%d%d%d%d</span><span style="color:#800000;">"</span>,&amp;a0,&amp;a1,&amp;b0,&amp;<span style="color:#000000;">b1);
</span><span style="color:#008080;">12</span>         <span style="color:#0000ff;">int</span> p=a0/a1,q=b1/b0,ans=<span style="color:#800080;">0</span><span style="color:#000000;">;
</span><span style="color:#008080;">13</span>         <span style="color:#ff0000;">for(int x=1;x*x&lt;=b1;x++) //精华
</span><span style="color:#008080;">14</span>             <span style="color:#0000ff;">if</span>(b1%x==<span style="color:#800080;">0</span><span style="color:#000000;">){
</span><span style="color:#008080;">15</span>                 <span style="color:#0000ff;">if</span>(x%a1==<span style="color:#800080;">0</span>&amp;&amp;gcd(x/a1,p)==<span style="color:#800080;">1</span>&amp;&amp;gcd(q,b1/x)==<span style="color:#800080;">1</span>) ans++<span style="color:#000000;">;
</span><span style="color:#008080;">16</span>                 <span style="color:#ff0000;">int y=b1/x</span>;<span style="color:#008000;">//</span><span style="color:#008000;">得到另一个因子</span>
<span style="color:#008080;">17</span>                 <span style="color:#0000ff;">if</span>(x==y) <span style="color:#0000ff;">continue</span><span style="color:#000000;">; 
</span><span style="color:#008080;">18</span>                 <span style="color:#0000ff;">if</span>(y%a1==<span style="color:#800080;">0</span>&amp;&amp;gcd(y/a1,p)==<span style="color:#800080;">1</span>&amp;&amp;gcd(q,b1/y)==<span style="color:#800080;">1</span>) ans++<span style="color:#000000;">;
</span><span style="color:#008080;">19</span> <span style="color:#000000;">            }
</span><span style="color:#008080;">20</span>         printf(<span style="color:#800000;">"</span><span style="color:#800000;">%d\n</span><span style="color:#800000;">"</span><span style="color:#000000;">,ans);
</span><span style="color:#008080;">21</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">22</span>     <span style="color:#0000ff;">return</span> <span style="color:#800080;">0</span><span style="color:#000000;">;
</span><span style="color:#008080;">23</span> }</pre> 
 </div> 
 <p><span style="font-family:'隶书';">做题在纸上推理推理写写思路，更清晰地解题</span></p> 
 <hr> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p> </p> 
 <p><span style="font-family:'隶书';">给看到这里的OIer一个小干货吧（虽然很可能知道，但也是试了好久才总结出来的啊）：cmd的窗口默认保存297行，宽80字符，高25字符</span></p> 
 <p> </p> 
</div> 
<p>转载于:https://www.cnblogs.com/InductiveSorting-QYF/p/10598817.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/24459b258535bc71ca00d07d25218c5a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">UUID的定义以及作用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5ae1640bd5de7d6251945e0ed123eb31/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vuex中的state和mapState</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>