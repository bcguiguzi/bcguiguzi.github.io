<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>TypedValue.applyDimension 中dp和sp之间转化的真相 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="TypedValue.applyDimension 中dp和sp之间转化的真相" />
<meta property="og:description" content="最近在看了许多关于dp-px，px-dp，sp-px,px-sp之间转化的博文，过去我比较常用的方式是：
1 //转换dip为px 2 public static int convertDipOrPx(Context context, int dip) { 3 float scale = context.getResources().getDisplayMetrics().density; 4 return (int)(dip*scale &#43; 0.5f*(dip&gt;=0?1:-1)); 5 } 6 7 //转换px为dip 8 public static int convertPxOrDip(Context context, int px) { 9 float scale = context.getResources().getDisplayMetrics().density; 10 return (int)(px/scale &#43; 0.5f*(px&gt;=0?1:-1)); 11 } 然后看到了一种新的转化方式，代码如下：
1 public static int dp2sp(float dpVal){ 2 return (int)(TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, dpVal, 3 MyAppliction.getInstance().getApplicationContext().getResources().getDisplayMetrics())); 4 } 5 //????? 6 public static int sp2dp(float spVal){ 7 return (int) TypedValue." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/ba9d34b80eca12106d70d8cab2d64462/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-04-21T16:55:00+08:00" />
<meta property="article:modified_time" content="2015-04-21T16:55:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">TypedValue.applyDimension 中dp和sp之间转化的真相</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p>   最近在看了许多关于dp-px，px-dp，sp-px,px-sp之间转化的博文，过去我比较常用的方式是：</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008080;"> 1</span> <span style="color:#008000;">//</span><span style="color:#008000;">转换dip为px </span>
<span style="color:#008080;"> 2</span> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> convertDipOrPx(Context context, <span style="color:#0000ff;">int</span><span style="color:#000000;"> dip) { 
</span><span style="color:#008080;"> 3</span>     <span style="color:#0000ff;">float</span> scale =<span style="color:#000000;"> context.getResources().getDisplayMetrics().density; 
</span><span style="color:#008080;"> 4</span>     <span style="color:#0000ff;">return</span> (<span style="color:#0000ff;">int</span>)(dip*scale + 0.5f*(dip&gt;=0?1:-1<span style="color:#000000;">)); 
</span><span style="color:#008080;"> 5</span> <span style="color:#000000;">} 
</span><span style="color:#008080;"> 6</span>  
<span style="color:#008080;"> 7</span> <span style="color:#008000;">//</span><span style="color:#008000;">转换px为dip </span>
<span style="color:#008080;"> 8</span> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> convertPxOrDip(Context context, <span style="color:#0000ff;">int</span><span style="color:#000000;"> px) { 
</span><span style="color:#008080;"> 9</span>     <span style="color:#0000ff;">float</span> scale =<span style="color:#000000;"> context.getResources().getDisplayMetrics().density; 
</span><span style="color:#008080;">10</span>     <span style="color:#0000ff;">return</span> (<span style="color:#0000ff;">int</span>)(px/scale + 0.5f*(px&gt;=0?1:-1<span style="color:#000000;">)); 
</span><span style="color:#008080;">11</span> } </pre> 
 </div> 
 <p>然后看到了一种新的转化方式，代码如下：</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008080;">1</span> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> dp2sp(<span style="color:#0000ff;">float</span><span style="color:#000000;"> dpVal){
</span><span style="color:#008080;">2</span>     <span style="color:#0000ff;">return</span> (<span style="color:#0000ff;">int</span><span style="color:#000000;">)(TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, dpVal,
</span><span style="color:#008080;">3</span> <span style="color:#000000;">            MyAppliction.getInstance().getApplicationContext().getResources().getDisplayMetrics()));
</span><span style="color:#008080;">4</span> <span style="color:#000000;">}
</span><span style="color:#008080;">5</span>  //?????
<span style="color:#008080;">6</span> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> sp2dp(<span style="color:#0000ff;">float</span><span style="color:#000000;"> spVal){
</span><span style="color:#008080;">7</span>     <span style="color:#0000ff;">return</span> (<span style="color:#0000ff;">int</span><span style="color:#000000;">) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, spVal,
</span><span style="color:#008080;">8</span> <span style="color:#000000;">            MyAppliction.getInstance().getApplicationContext().getResources().getDisplayMetrics()));
</span><span style="color:#008080;">9</span> }</pre> 
 </div> 
 <p>码农对TypedValue充满好奇,通过查询官网了解该类</p> 
 <p>TypedValue</p> 
 <p><span style="line-height:1.5;">  ---android.util.TypedValue<br> </span>Container for a dynamically typed data value. Primarily used with <code><a href="http://developer.android.com/reference/android/content/res/Resources.html" rel="nofollow">Resources</a></code> for holding resource values.</p> 
 <p> 翻译过来就是：这个类是工具类,作为一个动态容器，它存放一些数据值，这些值主要是resource中的值。</p> 
 <p>我们来理解一下:resource中到底有哪些值？layout、drawable、string、style、anim、dimens、menu、colors、ids这些值一些和屏幕适配有直接的关系。</p> 
 <p>有一些方法必然是可以读取这些资源文件信息的，比如：</p> 
 <div class="cnblogs_code"> 
  <pre>getDimension(DisplayMetrics metrics)</pre> 
 </div> 
 <p>再看具体的方法：</p> 
 <pre>applyDimension(int unit, float value,DisplayMetrics metrics)</pre> 
 <pre>第一个参数是单位,第二个参数是对应值,第三个你懂的，封装了显示区域的各种属性值。<br><br></pre> 
 <pre>对于applyDimension(int unit, float value,DisplayMetrics metrics)中的代码我们来看下<br><br></pre> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008080;"> 1</span>  <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">float</span> applyDimension(<span style="color:#0000ff;">int</span> unit, <span style="color:#0000ff;">float</span><span style="color:#000000;"> value,
</span><span style="color:#008080;"> 2</span> <span style="color:#000000;">                                       DisplayMetrics metrics)
</span><span style="color:#008080;"> 3</span> <span style="color:#000000;">    {
</span><span style="color:#008080;"> 4</span>         <span style="color:#0000ff;">switch</span><span style="color:#000000;"> (unit) {
</span><span style="color:#008080;"> 5</span>         <span style="color:#0000ff;">case</span><span style="color:#000000;"> COMPLEX_UNIT_PX:
</span><span style="color:#008080;"> 6</span>             <span style="color:#0000ff;">return</span><span style="color:#000000;"> value;
</span><span style="color:#008080;"> 7</span>         <span style="color:#0000ff;">case</span><span style="color:#000000;"> COMPLEX_UNIT_DIP:
</span><span style="color:#008080;"> 8</span>             <span style="color:#0000ff;">return</span> value *<span style="color:#000000;"> metrics.density;
</span><span style="color:#008080;"> 9</span>         <span style="color:#0000ff;">case</span><span style="color:#000000;"> COMPLEX_UNIT_SP:
</span><span style="color:#008080;">10</span>             <span style="color:#0000ff;">return</span> value *<span style="color:#000000;"> metrics.scaledDensity;
</span><span style="color:#008080;">11</span>         <span style="color:#0000ff;">case</span><span style="color:#000000;"> COMPLEX_UNIT_PT:
</span><span style="color:#008080;">12</span>             <span style="color:#0000ff;">return</span> value * metrics.xdpi * (1.0f/72<span style="color:#000000;">);
</span><span style="color:#008080;">13</span>         <span style="color:#0000ff;">case</span><span style="color:#000000;"> COMPLEX_UNIT_IN:
</span><span style="color:#008080;">14</span>             <span style="color:#0000ff;">return</span> value *<span style="color:#000000;"> metrics.xdpi;
</span><span style="color:#008080;">15</span>         <span style="color:#0000ff;">case</span><span style="color:#000000;"> COMPLEX_UNIT_MM:
</span><span style="color:#008080;">16</span>             <span style="color:#0000ff;">return</span> value * metrics.xdpi * (1.0f/25.4f<span style="color:#000000;">);
</span><span style="color:#008080;">17</span> <span style="color:#000000;">        }
</span><span style="color:#008080;">18</span>         <span style="color:#0000ff;">return</span> 0<span style="color:#000000;">;
</span><span style="color:#008080;">19</span>     }</pre> 
 </div> 
 <p>其中单位为dip的，将其转化为密度*值，也就是像素值，而单位sp的也将其转化为px值，因此该方法可以能进行</p> 
 <p>dip--&gt;px</p> 
 <p>sp-- &gt;px</p> 
 <pre>因此上面</pre> 
 <p>TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, value ,DisplayMetrics );<br>这个方法肯定不能将sp转化为dp，我们判断<br><br></p> 
 <p>dp2sp(50) = 150</p> 
 <p>sp2dp(50) = 150</p> 
 <p>convertDipOrPx(50) = 150</p> 
 <p>convertPxOrDip(50) = 17<br>将代码运行实际结果与判断结果一致。<br><br>接下来我们继续分析</p> 
 <p>TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, value ,DisplayMetrics );<br>该方法系统本意是用来做什么的？</p> 
 <p>查看官方说明:</p> 
 <p>Converts an unpacked complex data value holding a dimension to its final floating point value.</p> 
 <p>这里就把对应的值转化为实际屏幕上的点值，也就是像素值。<br>如果是TypedValue.COMPLEX_UNIT_DIP，则乘以显示密度density。</p> 
 <p>而如果是TypedValue.COMPLEX_UNIT_SP，则乘以像素密度<em id="__mceDel" style="font-family:'Courier New';font-size:12px;line-height:1.5;">scaledDensity<em style="font-family:verdana, Arial, Helvetica, sans-serif;font-size:14px;line-height:1.5;">。</em></em></p> 
 <p><em> </em></p> 
 <p>我们继续刨根追底</p> 
 <p>density和scaledDensity的区别在于</p> 
 <p>density：The logical density of the display.显示密度density = dpi/160</p> 
 <p>scaledDensity：A scaling factor for fonts displayed on the display.显示字体的缩放因子 = density</p> 
 <p>实际上两者的值一样，为了验证这个结论我们随便找两台机器小米2S和华为p7，取出density和scaledDensity是一致的,P7为3.0，小米2S = 2.0</p> 
 <p> </p> 
 <p>因此本文结论转化dp-px，px-dp，sp-px,px-sp</p> 
 <p>使用下面方法：<br><br></p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008080;"> 1</span> <span style="color:#008000;">//</span><span style="color:#008000;">转换dip为px </span>
<span style="color:#008080;"> 2</span>   <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> convertDipOrPx(Context context, <span style="color:#0000ff;">int</span><span style="color:#000000;"> dip) { 
</span><span style="color:#008080;"> 3</span>       <span style="color:#0000ff;">float</span> scale =<span style="color:#000000;"> context.getResources().getDisplayMetrics().density; 
</span><span style="color:#008080;"> 4</span>       <span style="color:#0000ff;">return</span> (<span style="color:#0000ff;">int</span>)(dip*scale + 0.5f*(dip&gt;=0?1:-1<span style="color:#000000;">)); 
</span><span style="color:#008080;"> 5</span> <span style="color:#000000;">  } 
</span><span style="color:#008080;"> 6</span>    
<span style="color:#008080;"> 7</span>   <span style="color:#008000;">//</span><span style="color:#008000;">转换px为dip </span>
<span style="color:#008080;"> 8</span>   <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> convertPxOrDip(Context context, <span style="color:#0000ff;">int</span><span style="color:#000000;"> px) { 
</span><span style="color:#008080;"> 9</span>       <span style="color:#0000ff;">float</span> scale =<span style="color:#000000;"> context.getResources().getDisplayMetrics().density; 
</span><span style="color:#008080;">10</span>      <span style="color:#0000ff;">return</span> (<span style="color:#0000ff;">int</span>)(px/scale + 0.5f*(px&gt;=0?1:-1<span style="color:#000000;">)); 
</span><span style="color:#008080;">11</span> <span style="color:#000000;"> } 
</span><span style="color:#008080;">12</span>  
<span style="color:#008080;">13</span>   <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> sp2px(Context context, <span style="color:#0000ff;">float</span><span style="color:#000000;"> spValue) {
</span><span style="color:#008080;">14</span>         <span style="color:#0000ff;">float</span> fontScale =<span style="color:#000000;"> context.getResources().getDisplayMetrics().scaledDensity;
</span><span style="color:#008080;">15</span>         <span style="color:#0000ff;">return</span> (<span style="color:#0000ff;">int</span>) (spValue * fontScale + 0.5f<span style="color:#000000;">);
</span><span style="color:#008080;">16</span> <span style="color:#000000;">    }
</span><span style="color:#008080;">17</span> 
<span style="color:#008080;">18</span>     <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> px2sp(Context context, <span style="color:#0000ff;">float</span><span style="color:#000000;"> pxValue) {
</span><span style="color:#008080;">19</span>         <span style="color:#0000ff;">float</span> fontScale =<span style="color:#000000;"> context.getResources().getDisplayMetrics().scaledDensity;
</span><span style="color:#008080;">20</span>         <span style="color:#0000ff;">return</span> (<span style="color:#0000ff;">int</span>) (pxValue / fontScale + 0.5f<span style="color:#000000;">);
</span><span style="color:#008080;">21</span>     }</pre> 
 </div> 
 <p> </p> 
 <p>如有错误，敬请指正。</p> 
 <p> </p> 
</div> 
<p>转载于:https://www.cnblogs.com/xilinch/p/4444833.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d49c351867a2fb10ca585770a6efbc40/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">css基础学习-link标签详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4e24408e692d7126efdc7e11c4a883f5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">黑马程序员--java基础--异常（二）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>