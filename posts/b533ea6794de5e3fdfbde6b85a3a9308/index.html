<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux 进程状态函数,三十七、Linux 线程——线程清理和控制函数、进程和线程启动方式比较、线程的状态转换... - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux 进程状态函数,三十七、Linux 线程——线程清理和控制函数、进程和线程启动方式比较、线程的状态转换..." />
<meta property="og:description" content="37.1 线程清理和控制函数
#include void pthread_cleanup_push(void (* rtn)(void *), void *arg);
void pthread_cleanup_pop(int execute);
函数参数
rtn：清理函数指针
arg：调用清理函数传递的参数
execute：值 1 时，执行线程清理函数；值 0 时，不执行线程清理函数
返回值
成功，返回 0；否则，返回错误编号
触发线程调用清理函数的工作
调用 pthread_exit
响应取消请求
用非零 execute 参数调用 thread_cleanup_pop 时
#include #include #include /** 定义线程清理函数 */
void clean_fun(void *arg)
{
char *s = (char *)arg;
printf(&#34;clean_fun: %s\n&#34;, s);
}
void *th_fun(void *arg)
{
int execute = (int )arg;
pthread_cleanup_push(clean_fun, &#34;first clean func&#34;);
pthread_cleanup_push(clean_fun, &#34;second clean func&#34;);" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/b533ea6794de5e3fdfbde6b85a3a9308/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-29T04:16:33+08:00" />
<meta property="article:modified_time" content="2021-04-29T04:16:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux 进程状态函数,三十七、Linux 线程——线程清理和控制函数、进程和线程启动方式比较、线程的状态转换...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>37.1 线程清理和控制函数</p> 
 <p>#include </p> 
 <p>void pthread_cleanup_push(void (* rtn)(void *), void *arg);</p> 
 <p>void pthread_cleanup_pop(int execute);</p> 
 <p>函数参数</p> 
 <p>rtn：清理函数指针</p> 
 <p>arg：调用清理函数传递的参数</p> 
 <p>execute：值 1 时，执行线程清理函数；值 0 时，不执行线程清理函数</p> 
 <p>返回值</p> 
 <p>成功，返回 0；否则，返回错误编号</p> 
 <p>触发线程调用清理函数的工作</p> 
 <p>调用 pthread_exit</p> 
 <p>响应取消请求</p> 
 <p>用非零 execute 参数调用 thread_cleanup_pop 时</p> 
 <p>#include </p> 
 <p>#include </p> 
 <p>#include </p> 
 <p>/** 定义线程清理函数 */</p> 
 <p>void clean_fun(void *arg)</p> 
 <p>{<!-- --></p> 
 <p>char *s = (char *)arg;</p> 
 <p>printf("clean_fun: %s\n", s);</p> 
 <p>}</p> 
 <p>void *th_fun(void *arg)</p> 
 <p>{<!-- --></p> 
 <p>int execute = (int )arg;</p> 
 <p>pthread_cleanup_push(clean_fun, "first clean func");</p> 
 <p>pthread_cleanup_push(clean_fun, "second clean func");</p> 
 <p>printf("thread running %lx\n", pthread_self());</p> 
 <p>pthread_cleanup_pop(execute);</p> 
 <p>pthread_cleanup_pop(execute);</p> 
 <p>return (void *);</p> 
 <p>}</p> 
 <p>int main(void)</p> 
 <p>{<!-- --></p> 
 <p>int err;</p> 
 <p>pthread_t th1, th2;</p> 
 <p>if((err = pthread_create(&amp;th1, NULL, th_fun, (void *))) != ) {<!-- --></p> 
 <p>perror("pthread create error");</p> 
 <p>}</p> 
 <p>pthread_join(th1, NULL);</p> 
 <p>printf("th1(%lx) finished\n", th1);</p> 
 <p>if((err = pthread_create(&amp;th2, NULL, th_fun, (void *))) != ) {<!-- --></p> 
 <p>perror("pthread create error");</p> 
 <p>}</p> 
 <p>pthread_join(th2, NULL);</p> 
 <p>printf("th2(%lx) finished\n", th2);</p> 
 <p>return ;</p> 
 <p>}</p> 
 <p>运行如下：</p> 
 <p align="center"><img src="https://images2.imgbox.com/58/59/l09v4L1Q_o.png" alt="639ede41e518ddd2488a918a5344e865.png"></p> 
 <p>线程结束，会触发调用最终的 clean 函数，调用的时候会根据 pop 里面的入栈顺序，先入后出进行调用。</p> 
 <p>37.2 进程和线程启动方式比较</p> 
 <p align="center"><img src="https://images2.imgbox.com/63/8b/RJuhd65Z_o.png" alt="da607ef96e0af850f8f99fb58148656e.png"></p> 
 <p>37.3 线程的状态转换</p> 
 <p align="center"><img src="https://images2.imgbox.com/3c/6c/p7TJhZG7_o.png" alt="f5d7adee88c898869d2641a76319a757.png"></p> 
 <p>Java-多线程第三篇3种创建的线程方式、线程的生命周期、线程控制、线程同步、线程通信</p> 
 <p>1.Java使用Thread类代表线程.     所有的线程对象必须是Thread类或其子类的实例. 当线程继承Thread类时,直接使用this即可获取当前线程,Thread对象的getName() ...</p> 
 <p>11&amp;period;python之线程，协程，进程，</p> 
 <p>一,进程与线程 1.什么是线程 线程是操作系统能够进行运算调度的最小单位.它被包含在进程之中,是进程中的实际运作单位.一条线程指的是进程中一个单一顺序的控制流,一个进程中可以并发多个线程,每条线程并行 ...</p> 
 <p>&amp;OpenCurlyDoubleQuote;全栈2019”Java多线程第三十七章：如何让等待的线程无法被中断</p> 
 <p>难度 初级 学习时间 10分钟 适合人群 零基础 开发语言 Java 开发环境 JDK v11 IntelliJ IDEA v2018.3 文章原文链接 "全栈2019"Java多 ...</p> 
 <p>Java并发编程原理与实战三十七：线程池的原理与使用</p> 
 <p>一.简介 线程池在我们的高并发环境下,实际应用是非常多的!!适用频率非常高! 有过使用过Executors框架的朋友,可能不太知道底层的实现,这里就是讲Executors是由ThreadPoolExe ...</p> 
 <p>第三十七章 POSIX线程(一)</p> 
 <p>POSIX线程库相关介绍   与线程有关的函数构成了一个完整的系列,绝大多数函数的名字都有"pthread_"开头   要使用这些函数库,都需要加入头文件"</p> 
 <p>VC启动一个新线程的三种方法</p> 
 <p>第一种AfxBeginThread() 用AfxBeginThread()函数来创建一个新线程来执行任务,工作者线程的AfxBeginThread的原型如下: CWinThread* AfxBegin ...</p> 
 <p>Linux常用三十七条指令</p> 
 <p>Linux常用三十七条指令 基础指令(11):ls,pwd,cd,mkdir,touch,cp.mv,rm,vim,&gt;/&gt;&gt;/,cat 进阶指令(10):df,free,head,t ...</p> 
 <p>&amp;lbrack;转帖&amp;rsqb;Linux系统进程的知识总结，进程与线程之间的纠葛&amp;period;&amp;period;&amp;period;</p> 
 <p>Linux系统进程的知识总结,进程与线程之间的纠葛... https://cloud.tencent.com/developer/article/1500509 当一个程序开始执行后,在开始执行到执行 ...</p> 
 <p>Linux系统进程的知识总结，进程与线程之间的纠葛&amp;period;&amp;period;&amp;period;</p> 
 <p>来源:嵌入式ARM 当一个程序开始执行后,在开始执行到执行完毕退出这段时间内,它在内存中的部分就叫称作一个进程. Linux 是一个多任务的操作系统,也就是说,在同一时间内,可以有多个进程同时执行.我 ...</p> 
 <p>随机推荐</p> 
 <p>51nod比赛</p> 
 <p>http://www.cnblogs.com/wzj-is-a-juruo/p/5619901.html</p> 
 <p>一步一步写一个简单通用的makefile&amp;lpar;四&amp;rpar;--写一个通用的makefile编译android可执行文件</p> 
 <p>通常要把我们自己的的代码编译成在android里面编译的可执行文件,我们通常是建一个文件夹 . ├── Android.mk ├── Application.mk ├── convolve.cl ├─ ...</p> 
 <p>Angular过滤器 自定义及使用方法</p> 
 <p>首先设置自定义过滤器. 定义模块名:angular .module('myApp') .filter('filterName',function(){ return function(要过滤的对象,参 ...</p> 
 <p>form表单提交</p> 
 <p>1.form表单提交.html页面失败 </p> 
 <p>Linux 查找命令汇总</p> 
 <p>linux下查找命令挺多,本文以列表方式说明which.whereis.locate.find命令的区别: 命令 概述 语法 示例 适用OS 搜索结果 which 在PATH变量指定的路径中,搜索某个 ...</p> 
 <p>STL --&amp;gt&amp;semi; set用法</p> 
 <p>set用法 一.set和multiset基础 set和multiset会根据特定的排序准则,自动将元素进行排序.不同的是后者允许元素重复而前者不允许. 需要包含头文件: #include </p> 
 <p>esxi虚拟机克隆后的主机网卡设置</p> 
 <p>windows 在虚拟机配置页面右击属性,编辑虚拟机设置,删除掉原来的网卡,重新添加新的网卡 进入系统以后,进入 windows/system32 找到sysprep,运行等待电脑重启 重启过程会稍微 ...</p> 
 <p>MySQL concat用法举例</p> 
 <p>concat配合information_schema的应用 1    concat的一般用法主要是用于拼接 示例: 执行语句 SELECT CONCAT('M','y','S','Q','L') 可以 ...</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fcc5e521fae88cbd4ee08715e7a68f98/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java 基础编程练习2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e82b6d5d7723ccc7df553863b0233eb8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux中如何查看文件上下文,linux通过grep根据关键字查找日志文件上下文</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>