<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vue全家桶&#43;Socket.io&#43;Express/Koa2打造网页版手机QQ - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Vue全家桶&#43;Socket.io&#43;Express/Koa2打造网页版手机QQ" />
<meta property="og:description" content="Vue全家桶&#43;Socket.io&#43;Express/Koa2打造的网页版手机QQ(web app),高仿手机QQ7.1.0版本。为了方便大家学习，现在IP定位接口和实时气温接口也开放了！接口请在源码中查看。
预览 在线预览地址：https://qq.lenshen.com （尽量使用Chrome浏览器体验最佳效果，另外提供了3个测试账号，需要账号才能登录哦）
源码地址：https://github.com/lensh/vue-qq
三个测试账号如下:
qq:986992484 密码:111111
qq:986992483 密码:111111
qq:986992482 密码:111111
技术栈 Vue2.0：实现前端页面构建Vuex：实现不同组件间的状态共享Vue-router：页面路由切换,实现单页的核心vueg：页面复杂场景切换效果Socket.io：实现实时消息推送axios：一个基于 Promise 的 HTTP 库，向后端发起请求Express、Koa2：开发环境使用Express，生产环境使用Koa2ES6、ES7、ES8：服务端和客户端均使用ES6语法，promise/async/await 处理异步localStorage：本地保存用户信息Webpack：模块打包，前端项目构建工具首选SASS(SCSS)：CSS预处理语言Flex：flex弹性布局，简单适配手机、PC端CSS3：CSS3过渡动画及样式IScroll：模拟原生app的列表滚动效果(ListView)MySQL：MySQL关系型数据库持久化数据（考虑到表与表之间关系复杂，需要多表查询，最复杂的时候是六张表联查，用MySQL会比Mongodb好得多）jsonp：跨域请求数据pm2：服务端使用pm2部署，常驻进程，比forever好用得多（https://github.com/Unitech/pm2）nginx：服务端使用nginx代理端口转发 使用方式 先将根目录下的qq.sql导入到你的MySQL数据库里(可以使用Navicat)，用户名为root，登录密码为空。启动MySQL服务。然后使用cnpm install 安装所有依赖(最好用cnpm安装，因为项目依赖很多，npm用的是国外的镜像，在网络不稳定的情况下很有可能会导致安装失败，而且下载速度远远慢于国内的cnpm)，最后运行npm run dev。服务器部署运行项目只需要npm run pm2，这样就可以常驻进程，不过前提是得先全局安装pm2。
目前已经实现了QQ的核心功能，如消息列表、好友列表、新朋友、好友申请、实时群聊、实时私聊、聊天设置、屏蔽对方聊天、特别关心、会员等级、个性名片、添加好友、删除好友、好友分组、查找用户、登录、注销、切换用户、右滑显示侧栏、IP地理定位、实时气温等等。后期会考虑增加更多功能。如果你想体验实时聊天的酷炫效果，那么你可以打开两个浏览器，用上面不同的账号登录即可。
截图 消息页面 联系人页面 群聊 私聊 分析 服务端使用ES6语法 不需要使用babel转码以及一系列的配置，只需要将node升级到V8版本，V8已经很好地支持了ES6/ES7/ES8等最新特性，这是目前最好的办法。升级到V8版本，可以直接到nodejs中文网(http://nodejs.cn/download/) 下载即可，也可以使用NVM切换node版本。
升级到V8后，还不支持通过import/export关键字来导入导出模块(因为服务端已经有了CommonJS规范，如果再使用import/export的话就有点冲突了)，如果一定要使用import/export关键字，这时可以在服务端的入口文件首行添加以下代码：
require(&#34;babel-core/register&#34;)({ presets: [&#39;es2015&#39;, &#39;stage-0&#39;] }) require(&#34;babel-polyfill&#34;) 上面的模块不可以使用import来导入，必须使用require，同时需要通过npm安装babel-core、babel-preset-es2015、babel-preset-stage-0、babel-polyfill等依赖。这样就可以愉快地使用import/export了。
服务端代码片段如下：
// ES7 async/await import express from &#39;express&#39; import login from &#39;../../controller/login&#39; const loginRouter = express.Router() loginRouter .get(&#39;/:user/:pwd&#39;, async(req, res) =&gt; { // 登录 const result = await login." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/e5164a5e63138cfb1ec25693ab6083d4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-29T23:25:12+08:00" />
<meta property="article:modified_time" content="2017-07-29T23:25:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vue全家桶&#43;Socket.io&#43;Express/Koa2打造网页版手机QQ</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <span style="">Vue全家桶+Socket.io+Express/Koa2打造的网页版手机QQ(web app),高仿手机QQ7.1.0版本。为了方便大家学习，现在IP定位接口和实时气温接口也开放了！接口请在源码中查看。</span></p> 
<h3 style="margin-top:24px; margin-bottom:16px; line-height:1.25; padding-bottom:0.3em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(234,236,239); color:rgb(36,41,46)"> <a target="_blank" id="user-content-预览" class="anchor" href="https://github.com/lensh/vue-qq#%E9%A2%84%E8%A7%88" style="color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1; background-color:transparent" rel="noopener noreferrer"></a>预览</h3> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 在线预览地址：<a target="_blank" href="https://qq.lenshen.com" rel="nofollow noopener noreferrer">https://qq.lenshen.com</a> （尽量使用Chrome浏览器体验最佳效果，另外提供了3个测试账号，需要账号才能登录哦）</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 源码地址：<a target="_blank" href="https://github.com/lensh/vue-qq" rel="noopener noreferrer">https://github.com/lensh/vue-qq</a></p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 三个测试账号如下:</p> 
<ul style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"><li style=""> <p style="margin-top:16px; margin-bottom:16px">qq:986992484 密码:111111</p> </li><li style="margin-top:0.25em"> <p style="margin-top:16px; margin-bottom:16px">qq:986992483 密码:111111</p> </li><li style="margin-top:0.25em"> <p style="margin-top:16px; margin-bottom:16px">qq:986992482 密码:111111</p> </li></ul> 
<h3 style="margin-top:24px; margin-bottom:16px; line-height:1.25; padding-bottom:0.3em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(234,236,239); color:rgb(36,41,46)"> <a target="_blank" id="user-content-技术栈" class="anchor" href="https://github.com/lensh/vue-qq#%E6%8A%80%E6%9C%AF%E6%A0%88" style="color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1; background-color:transparent" rel="noopener noreferrer"></a>技术栈</h3> 
<ul style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"><li style=""><span style="font-weight:600">Vue2.0</span>：实现前端页面构建</li><li style="margin-top:0.25em"><span style="font-weight:600">Vuex</span>：实现不同组件间的状态共享</li><li style="margin-top:0.25em"><span style="font-weight:600">Vue-router</span>：页面路由切换,实现单页的核心</li><li style="margin-top:0.25em"><span style="font-weight:600">vueg</span>：页面复杂场景切换效果</li><li style="margin-top:0.25em"><span style="font-weight:600">Socket.io</span>：实现实时消息推送</li><li style="margin-top:0.25em"><span style="font-weight:600">axios</span>：一个基于 <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">Promise</code> 的 HTTP 库，向后端发起请求</li><li style="margin-top:0.25em"><span style="font-weight:600">Express</span>、<span style="font-weight:600">Koa2</span>：开发环境使用Express，生产环境使用Koa2</li><li style="margin-top:0.25em"><span style="font-weight:600">ES6</span>、<span style="font-weight:600">ES7</span>、<span style="font-weight:600">ES8</span>：服务端和客户端均使用ES6语法，promise/async/await 处理异步</li><li style="margin-top:0.25em"><span style="font-weight:600">localStorage</span>：本地保存用户信息</li><li style="margin-top:0.25em"><span style="font-weight:600">Webpack</span>：模块打包，前端项目构建工具首选</li><li style="margin-top:0.25em"><span style="font-weight:600">SASS</span>(<span style="font-weight:600">SCSS</span>)：CSS预处理语言</li><li style="margin-top:0.25em"><span style="font-weight:600">Flex</span>：flex弹性布局，简单适配手机、PC端</li><li style="margin-top:0.25em"><span style="font-weight:600">CSS3</span>：CSS3过渡动画及样式</li><li style="margin-top:0.25em"><span style="font-weight:600">IScroll</span>：模拟原生app的列表滚动效果(ListView)</li><li style="margin-top:0.25em"><span style="font-weight:600">MySQL</span>：MySQL关系型数据库持久化数据（考虑到表与表之间关系复杂，需要多表查询，最复杂的时候是六张表联查，用MySQL会比Mongodb好得多）</li><li style="margin-top:0.25em"><span style="font-weight:600">jsonp</span>：跨域请求数据</li><li style="margin-top:0.25em"><span style="font-weight:600">pm2</span>：服务端使用pm2部署，常驻进程，比forever好用得多（<a target="_blank" href="https://github.com/Unitech/pm2%EF%BC%89" style="color:rgb(3,102,214); text-decoration:none; background-color:transparent" rel="noopener noreferrer">https://github.com/Unitech/pm2）</a></li><li style="margin-top:0.25em"><span style="font-weight:600">nginx</span>：服务端使用nginx代理端口转发</li></ul> 
<h3 style="margin-top:24px; margin-bottom:16px; line-height:1.25; padding-bottom:0.3em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(234,236,239); color:rgb(36,41,46)"> <a target="_blank" id="user-content-使用方式" class="anchor" href="https://github.com/lensh/vue-qq#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F" style="color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1; background-color:transparent" rel="noopener noreferrer"></a>使用方式</h3> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 先将根目录下的qq.sql导入到你的MySQL数据库里(可以使用Navicat)，用户名为root，登录密码为空。启动MySQL服务。然后使用cnpm install 安装所有依赖(最好用cnpm安装，因为项目依赖很多，npm用的是国外的镜像，在网络不稳定的情况下很有可能会导致安装失败，而且下载速度远远慢于国内的cnpm)，最后运行npm run dev。服务器部署运行项目只需要npm run pm2，这样就可以常驻进程，不过前提是得先全局安装pm2。</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 目前已经实现了QQ的核心功能，如消息列表、好友列表、新朋友、好友申请、实时群聊、实时私聊、聊天设置、屏蔽对方聊天、特别关心、会员等级、个性名片、添加好友、删除好友、好友分组、查找用户、登录、注销、切换用户、右滑显示侧栏、IP地理定位、实时气温等等。后期会考虑增加更多功能。如果你想体验实时聊天的酷炫效果，那么你可以打开两个浏览器，用上面不同的账号登录即可。</p> 
<h3 style="margin-top:24px; margin-bottom:16px; line-height:1.25; padding-bottom:0.3em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(234,236,239); color:rgb(36,41,46)"> <a target="_blank" id="user-content-截图" class="anchor" href="https://github.com/lensh/vue-qq#%E6%88%AA%E5%9B%BE" style="color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1; background-color:transparent" rel="noopener noreferrer"></a>截图</h3> 
<ul style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"><li style="">消息页面</li></ul> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <a target="_blank" href="https://github.com/lensh/vue-qq/blob/master/screenshot/1.png" style="color:rgb(3,102,214); text-decoration:none; background-color:transparent" rel="noopener noreferrer"><img src="https://images2.imgbox.com/42/48/5TUohAM5_o.png" alt="" style="border-style:none; max-width:100%"></a></p> 
<ul style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"><li style="">联系人页面</li></ul> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <a target="_blank" href="https://github.com/lensh/vue-qq/blob/master/screenshot/2.png" style="color:rgb(3,102,214); text-decoration:none; background-color:transparent" rel="noopener noreferrer"><img src="https://images2.imgbox.com/91/8f/PLRheqKv_o.png" alt="" style="border-style:none; max-width:100%"></a></p> 
<ul style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"><li style="">群聊</li></ul> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <a target="_blank" href="https://github.com/lensh/vue-qq/blob/master/screenshot/3.png" style="color:rgb(3,102,214); text-decoration:none; background-color:transparent" rel="noopener noreferrer"><img src="https://images2.imgbox.com/1f/8f/vQPTjV8H_o.png" alt="" style="border-style:none; max-width:100%"></a></p> 
<ul style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"><li style="">私聊</li></ul> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <a target="_blank" href="https://github.com/lensh/vue-qq/blob/master/screenshot/4.png" style="color:rgb(3,102,214); text-decoration:none; background-color:transparent" rel="noopener noreferrer"><img src="https://images2.imgbox.com/9d/82/QQD7juvN_o.png" alt="" style="border-style:none; max-width:100%"></a></p> 
<h3 style="margin-top:24px; margin-bottom:16px; line-height:1.25; padding-bottom:0.3em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(234,236,239); color:rgb(36,41,46)"> <a target="_blank" id="user-content-分析" class="anchor" href="https://github.com/lensh/vue-qq#%E5%88%86%E6%9E%90" style="color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1; background-color:transparent" rel="noopener noreferrer"></a>分析</h3> 
<ul style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"><li style=""> <h4 style="margin-top:24px; margin-bottom:16px; font-size:1.25em; line-height:1.25"> <a target="_blank" id="user-content-服务端使用es6语法" class="anchor" href="https://github.com/lensh/vue-qq#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BD%BF%E7%94%A8es6%E8%AF%AD%E6%B3%95" style="color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1; background-color:transparent" rel="noopener noreferrer"></a>服务端使用ES6语法</h4> </li></ul> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 不需要使用babel转码以及一系列的配置，只需要将node升级到V8版本，V8已经很好地支持了ES6/ES7/ES8等最新特性，这是目前最好的办法。升级到V8版本，可以直接到nodejs中文网(<a target="_blank" href="http://nodejs.cn/download/" rel="nofollow noopener noreferrer" style="color:rgb(3,102,214); text-decoration:none; background-color:transparent">http://nodejs.cn/download/</a>) 下载即可，也可以使用NVM切换node版本。</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 升级到V8后，还不支持通过import/export关键字来导入导出模块(因为服务端已经有了CommonJS规范，如果再使用import/export的话就有点冲突了)，如果一定要使用import/export关键字，这时可以在服务端的入口文件首行添加以下代码：</p> 
<div class="highlight highlight-source-js" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 
 <pre style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; word-break:normal; background-color:rgb(246,248,250)"><span class="pl-c1" style="color:rgb(0,92,197)">require</span>(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>babel-core/register<span class="pl-pds" style="">"</span></span>)({
	presets<span class="pl-k" style="color:rgb(215,58,73)">:</span> [<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>es2015<span class="pl-pds" style="">'</span></span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>stage-0<span class="pl-pds" style="">'</span></span>]
})
<span class="pl-c1" style="color:rgb(0,92,197)">require</span>(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>babel-polyfill<span class="pl-pds" style="">"</span></span>)</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 上面的模块不可以使用import来导入，必须使用require，同时需要通过npm安装babel-core、babel-preset-es2015、babel-preset-stage-0、babel-polyfill等依赖。这样就可以愉快地使用import/export了。</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 服务端代码片段如下：</p> 
<div class="highlight highlight-source-js" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 
 <pre style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; word-break:normal; background-color:rgb(246,248,250)"><span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> ES7 async/await</span>
<span class="pl-k" style="color:rgb(215,58,73)">import</span> <span class="pl-smi" style="">express</span> <span class="pl-k" style="color:rgb(215,58,73)">from</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>express<span class="pl-pds" style="">'</span></span>
<span class="pl-k" style="color:rgb(215,58,73)">import</span> <span class="pl-smi" style="">login</span> <span class="pl-k" style="color:rgb(215,58,73)">from</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>../../controller/login<span class="pl-pds" style="">'</span></span>

<span class="pl-k" style="color:rgb(215,58,73)">const</span> <span class="pl-c1" style="color:rgb(0,92,197)">loginRouter</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">express</span>.<span class="pl-en" style="color:rgb(111,66,193)">Router</span>()

loginRouter
	.<span class="pl-c1" style="color:rgb(0,92,197)">get</span>(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>/:user/:pwd<span class="pl-pds" style="">'</span></span>, <span class="pl-k" style="color:rgb(215,58,73)">async</span>(req, res) <span class="pl-k" style="color:rgb(215,58,73)">=&gt;</span> { <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> 登录</span>
		<span class="pl-k" style="color:rgb(215,58,73)">const</span> <span class="pl-c1" style="color:rgb(0,92,197)">result</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-k" style="color:rgb(215,58,73)">await</span> <span class="pl-smi" style="">login</span>.<span class="pl-en" style="color:rgb(111,66,193)">login</span>(req, res)
		<span class="pl-smi" style="">res</span>.<span class="pl-en" style="color:rgb(111,66,193)">json</span>(result)
	})

<span class="pl-k" style="color:rgb(215,58,73)">export</span> <span class="pl-c1" style="color:rgb(0,92,197)">default</span> <span class="pl-smi" style="">loginRouter</span></pre> 
</div> 
<ul style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"><li style=""> <h4 style="margin-top:24px; margin-bottom:16px; font-size:1.25em; line-height:1.25"> <a target="_blank" id="user-content-socketio" class="anchor" href="https://github.com/lensh/vue-qq#socketio" style="color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1; background-color:transparent" rel="noopener noreferrer"></a>Socket.io</h4> </li></ul> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 服务端(结合Express/Koa):</p> 
<div class="highlight highlight-source-js" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 
 <pre style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; word-break:normal; background-color:rgb(246,248,250)"><span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> Server</span>
<span class="pl-k" style="color:rgb(215,58,73)">import</span> <span class="pl-smi" style="">express</span> <span class="pl-k" style="color:rgb(215,58,73)">from</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>express<span class="pl-pds" style="">'</span></span>
<span class="pl-k" style="color:rgb(215,58,73)">import</span> <span class="pl-smi" style="">http</span> <span class="pl-k" style="color:rgb(215,58,73)">from</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>http<span class="pl-pds" style="">'</span></span>
<span class="pl-k" style="color:rgb(215,58,73)">import</span> <span class="pl-smi" style="">socketio</span> <span class="pl-k" style="color:rgb(215,58,73)">from</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>socket.io<span class="pl-pds" style="">'</span></span>

<span class="pl-k" style="color:rgb(215,58,73)">const</span> <span class="pl-c1" style="color:rgb(0,92,197)">app</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-en" style="color:rgb(111,66,193)">express</span>()
<span class="pl-k" style="color:rgb(215,58,73)">const</span> <span class="pl-c1" style="color:rgb(0,92,197)">server</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">http</span>.<span class="pl-en" style="color:rgb(111,66,193)">createServer</span>(app)
<span class="pl-k" style="color:rgb(215,58,73)">const</span> <span class="pl-c1" style="color:rgb(0,92,197)">io</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-en" style="color:rgb(111,66,193)">socketio</span>(server)
<span class="pl-smi" style="">server</span>.<span class="pl-en" style="color:rgb(111,66,193)">listen</span>(<span class="pl-c1" style="color:rgb(0,92,197)">3000</span>)

<span class="pl-smi" style="">io</span>.<span class="pl-en" style="color:rgb(111,66,193)">on</span>(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>connection<span class="pl-pds" style="">'</span></span>, (<span class="pl-smi" style="">socket</span>)<span class="pl-k" style="color:rgb(215,58,73)">=&gt;</span>{
  <span class="pl-smi" style="">socket</span>.<span class="pl-en" style="color:rgb(111,66,193)">emit</span>(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>news<span class="pl-pds" style="">'</span></span>, { hello<span class="pl-k" style="color:rgb(215,58,73)">:</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>world<span class="pl-pds" style="">'</span></span> })
  <span class="pl-smi" style="">socket</span>.<span class="pl-en" style="color:rgb(111,66,193)">on</span>(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>my other event<span class="pl-pds" style="">'</span></span>, <span class="pl-k" style="color:rgb(215,58,73)">function</span> (<span class="pl-smi" style="">data</span>) {
    <span class="pl-en" style="color:rgb(111,66,193)">console</span>.<span class="pl-c1" style="color:rgb(0,92,197)">log</span>(data)
  })
})</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 客户端：</p> 
<div class="highlight highlight-source-js" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 
 <pre style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; word-break:normal; background-color:rgb(246,248,250)"><span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> Client</span>
<span class="pl-k" style="color:rgb(215,58,73)">&lt;</span>script src<span class="pl-k" style="color:rgb(215,58,73)">=</span><span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>http://localhost:3000/socket.io/socket.io.js<span class="pl-pds" style="">"</span></span><span class="pl-k" style="color:rgb(215,58,73)">&gt;&lt;</span><span class="pl-k" style="color:rgb(215,58,73)">/</span>script<span class="pl-k" style="color:rgb(215,58,73)">&gt;</span>
<span class="pl-k" style="color:rgb(215,58,73)">&lt;</span>script<span class="pl-k" style="color:rgb(215,58,73)">&gt;</span>
  <span class="pl-k" style="color:rgb(215,58,73)">const</span> <span class="pl-c1" style="color:rgb(0,92,197)">socket</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">io</span>.<span class="pl-en" style="color:rgb(111,66,193)">connect</span>(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>http://localhost:3000<span class="pl-pds" style="">'</span></span>)
  <span class="pl-smi" style="">socket</span>.<span class="pl-en" style="color:rgb(111,66,193)">on</span>(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>news<span class="pl-pds" style="">'</span></span>, (<span class="pl-smi" style="">data</span>)<span class="pl-k" style="color:rgb(215,58,73)">=&gt;</span>{
    <span class="pl-smi" style="">socket</span>.<span class="pl-en" style="color:rgb(111,66,193)">emit</span>(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>my other event<span class="pl-pds" style="">'</span></span>, { my<span class="pl-k" style="color:rgb(215,58,73)">:</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">'</span>data<span class="pl-pds" style="">'</span></span> })
  })
<span class="pl-k" style="color:rgb(215,58,73)">&lt;</span><span class="pl-k" style="color:rgb(215,58,73)">/</span>script<span class="pl-k" style="color:rgb(215,58,73)">&gt;</span></pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> socket.io最核心的两个api就是<code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">emit</code> 和 <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">on</code>了 ，服务端和客户端都有这两个api。通过 <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">emit</code> 和 <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">on</code>可以实现服务器与客户端之间的双向通信。</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">emit</code> ：发射一个事件，第一个参数为事件名，第二个参数为要发送的数据，第三个参数为回调函数（如需对方接受到信息后立即得到确认时，则需要用到回调函数）。</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">on</code> ：监听一个 emit 发射的事件，第一个参数为要监听的事件名，第二个参数为回调函数，用来接收对方发来的数据，该函数的第一个参数为接收的数据。</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 服务端常用API：</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">socket.emit()</code>：向建立该连接的客户端发送消息</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">socket.on()</code>：监听客户端发送信息</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">io.to(socketid).emit()</code>：向指定客户端发送消息</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">io.sockets.socket(socketid).emit()</code>：向指定客户端发送消息，新版本用<code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">io.sockets.socket[socketid].emit()</code> ，数组访问</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">socket.broadcast.emit()</code>：向除去建立该连接的客户端的所有客户端广播</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">io.sockets.emit()</code>：向所有客户端广播</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 客户端常用API：</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">socket.emit()</code>：向服务端发送消息</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> <code style="font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace; font-size:13.6px; padding:0.2em 0px; margin:0px">socket.on()</code>：监听服务端发来的信息</p> 
<h3 style="margin-top:24px; margin-bottom:16px; line-height:1.25; padding-bottom:0.3em; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(234,236,239); color:rgb(36,41,46)"> <a target="_blank" id="user-content-faq" class="anchor" href="https://github.com/lensh/vue-qq#faq" style="color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1; background-color:transparent" rel="noopener noreferrer"></a>FAQ</h3> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px; line-height:24px"> 若使用的过程中遇到问题，可以加官方群交流：611212696。</p> 
<p style="margin-top:0px; color:rgb(36,41,46); font-size:16px; line-height:24px; margin-bottom:0px!important"> 如果觉得不错，就毫不吝啬地给个star吧。后期项目还会继续更新和完善。</p> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cf877efe09334b95ecfd17549cc3e907/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TypedValue.applyDimension()返回值</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2cbdc793ac6fb88ef0356d5ea01e34b2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">百度坐标，火星坐标和WGS84之间转换Java代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>