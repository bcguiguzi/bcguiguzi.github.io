<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>搭建企业级镜像仓库Harbor - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="搭建企业级镜像仓库Harbor" />
<meta property="og:description" content="1、环境准备：
centos7 docker-ce-19.03.5 docker-compose version 1.25.4, build 8d51620a harbor-v1.8.0 2、安装docker ：
官方安装文档：https://docs.docker.com/install/linux/docker-ce/centos/
3、安装docker-compose：
官方安装文档：https://docs.docker.com/compose/install/
4、安装Harbor
1、下载安装包 # wget https://storage.googleapis.com/harbor-releases/release-1.8.0/harbor-offline-installer-v1.8.1.tgz 2、解压并修改配置文件 # tar -zxvf harbor-offline-installer-v1.8.1.tgz -C /var/data/harbor # cd /var/data/harbor 150服务器上修改harbor.yml # vim harbor.yml hostname: 192.168.0.150 160服务器上修改harbor.yml # vim harbor.yml hostname: 192.168.0.160 3、执行安装脚本 # ./install.sh ✔ ----Harbor has been installed and started successfully.---- #看到这一行就表示成功了 Now you should be able to visit the admin portal at http://192.168.0.150. For more details, please visit https://github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/470c4ec4f948b1066e07f24ec9b0dabd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-06T18:04:02+08:00" />
<meta property="article:modified_time" content="2020-03-06T18:04:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">搭建企业级镜像仓库Harbor</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>1、环境准备：</strong></p> 
<pre><code>centos7
docker-ce-19.03.5
docker-compose version 1.25.4, build 8d51620a
harbor-v1.8.0</code></pre> 
<p><strong>2、安装docker ：</strong></p> 
<p>官方安装文档：<a href="https://docs.docker.com/install/linux/docker-ce/centos/" rel="nofollow">https://docs.docker.com/install/linux/docker-ce/centos/</a></p> 
<p><strong>3、安装docker-compose：</strong></p> 
<p>官方安装文档：<a href="https://docs.docker.com/compose/install/" rel="nofollow">https://docs.docker.com/compose/install/</a></p> 
<p><strong>4、安装Harbor</strong></p> 
<pre><code class="language-bash">
1、下载安装包
# wget https://storage.googleapis.com/harbor-releases/release-1.8.0/harbor-offline-installer-v1.8.1.tgz

2、解压并修改配置文件
# tar -zxvf harbor-offline-installer-v1.8.1.tgz -C /var/data/harbor
# cd /var/data/harbor

150服务器上修改harbor.yml
# vim harbor.yml
hostname: 192.168.0.150

160服务器上修改harbor.yml
# vim harbor.yml
hostname: 192.168.0.160

3、执行安装脚本
# ./install.sh

✔ ----Harbor has been installed and started successfully.----   #看到这一行就表示成功了

Now you should be able to visit the admin portal at http://192.168.0.150.
For more details, please visit https://github.com/goharbor/harbor .

4、启动和停止
# docker-compose up -d  #启动
# docker-compose down  #停止</code></pre> 
<p></p> 
<p><strong> 5、访问服务</strong></p> 
<p>浏览器输入：<a href="http://192.168.0.150/harbor/users" rel="nofollow">http://192.168.0.150/harbor/users</a></p> 
<p>#用户名密码查看harbory.yml文件</p> 
<p>用户名：admin</p> 
<p>密码：Harbor12345</p> 
<p><img alt="" height="914" src="https://images2.imgbox.com/b9/f0/fQ7WydZV_o.png" width="1200"></p> 
<p>到此服务安装完成。</p> 
<p><strong>6、验证镜像上传</strong></p> 
<p>修改docker文件并重启服务</p> 
<pre><code class="language-bash">#修改配置文件并重启服务
[root@k8s-master harbor]# cat /etc/docker/daemon.json 
{
  "insecure-registries": ["http://192.168.0.150"]
}
[root@k8s-master harbor]# systemctl reload docker
#镜像打标签
[root@k8s-master harbor]# docker tag busybox:latest  192.168.0.150/test01/busybox:latest
#登录仓库
[root@k8s-master harbor]# docker login http://192.168.0.150
Username: admin
Password: 
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
#上传镜像
[root@k8s-master harbor]# docker push 192.168.0.150/test01/busybox:latest
The push refers to repository [192.168.0.150/test01/busybox]
195be5f8be1d: Pushed 
latest: digest: sha256:edafc0a0fb057813850d1ba44014914ca02d671ae247107ca70c94db686e7de6 size: 527
#删除镜像
[root@k8s-master harbor]# docker rmi 192.168.0.150/test01/busybox:latest
Untagged: 192.168.0.150/test01/busybox:latest
Untagged: 192.168.0.150/test01/busybox@sha256:edafc0a0fb057813850d1ba44014914ca02d671ae247107ca70c94db686e7de6
#测试下载仓库镜像
[root@k8s-master harbor]# docker pull 192.168.0.150/test01/busybox:latest
latest: Pulling from test01/busybox
Digest: sha256:edafc0a0fb057813850d1ba44014914ca02d671ae247107ca70c94db686e7de6
Status: Downloaded newer image for 192.168.0.150/test01/busybox:latest
192.168.0.150/test01/busybox:latest

</code></pre> 
<p>查看</p> 
<p><img alt="" height="760" src="https://images2.imgbox.com/f9/98/keWeEMjU_o.png" width="1200"></p> 
<p><img alt="" height="902" src="https://images2.imgbox.com/ce/e4/g35PbVrp_o.png" width="1200"></p> 
<p><strong>配置LDAP</strong></p> 
<p><img alt="" height="905" src="https://images2.imgbox.com/af/cb/XWMsvIMA_o.png" width="881"></p> 
<p>填写完成以后保存，点击测试服务，测试ldap用户登录</p> 
<p><img alt="" height="678" src="https://images2.imgbox.com/52/d4/aRLNGxFM_o.png" width="1200"></p> 
<p>到此ldap用户可以正常登录，用户第一次登录以后用户信息就会被写入数据库</p> 
<p><strong>邮箱配置：</strong></p> 
<p><img alt="" height="631" src="https://images2.imgbox.com/c7/09/eoTqkIxp_o.png" width="777"></p> 
<p>我用的是QQ邮箱，如何设置就不在赘述。</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3672ff44bffac0c56ef66a10fb5bf851/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">蛇行矩阵（C语言）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/107ea60e08fa862a60c5ad6ff5065e59/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">WebView使用方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>