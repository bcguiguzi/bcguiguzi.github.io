<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>美女图片采集器 (源码&#43;解析) - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="美女图片采集器 (源码&#43;解析)" />
<meta property="og:description" content="前言: 有一段时间没写博客了, &#34;持之以恒&#34;徽章都暗了, 实在不该。 前一段确实比较忙, ...小小地给自己的懒找个借口吧。 大二即将结束, 学习iOS也有一段时间了。今天抽点时间, 开源一个前几天刚上传的App里面的一个功能, RT, 美女图片采集器。 美女.. 相信没有人不喜欢吧, 基于此, 这个小Demo应运而生。
注: 本文正在参加博客大赛。 如果觉得对你有所帮助, 还望帮忙投下票。 多谢。 投票链接: http://vote.blog.csdn.net/Article/Details?articleid=37825177 (投票按钮在最下方)
效果演示: 看到这里, 如果还有兴趣学习的话, 可以先到我的git中下载源码, 然后配合着源码看我下面的解析。相信, 会让你有所收获的。
git下载链接: BeautyPickDemo.git
涉及内容: 百度图片API的使用JSON格式数据解析图片异步下载 &#43; 离线缓存图片基本操作(缩放, 删除, 添加, 保存到本地)下拉刷新, 上提加载幻灯片放映自定义后台显示图片 源码解析: 一。百度图片API的使用 首先, 我们知道百度是没有对外开放图片API的, 但是我们可以通过谷歌浏览器来捕捉到访问过程中它调用的API。有兴趣的, 可以了解下谷歌浏览器Network选项的使用, 也可以参考下这篇文章: 百度图片api 这里, 我们主要介绍如何使用即可。 1.百度图片通用API: http://image.baidu.com/i?tn=resultjsonavstar&amp;ie=utf-8&amp;word=刘德华&amp;pn=0&amp;rn=60 说明： 返回格式为json word为查询的内容 pn为第几页 rn为一页返回的图片数量 用法：大家在浏览器地址栏输入上述地址，回车即可看到返回的图片地址 2.百度图片分类API (我们使用的就是这个) http://image.baidu.com/channel/listjson?pn=0&amp;rn=30&amp;tag1=美女&amp;tag2=全部&amp;ie=utf8 http://image.baidu.com/channel/listjson?pn=0&amp;rn=30&amp;tag1=美女&amp;tag2=全部&amp;ftags=校花&amp;ie=utf8 至于其他的, 依照这个方法都能获取到. 就不重复说明了。 至于如何调用API, 涉及到网络编程。 开源的ASI类库做的比较好(虽然挺老的一个东西了, 也有一段时间没更新了, 但是能满足我们需求)。 从源码中, 可以找到 网络请求ASI文件夹，里面有需要的文件 1。导入这里的文件 2。导入必须的框架, 包括: SystemConfiguration." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/f9ddb60d4b6b06ff2c25470c1ad05c25/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-07-15T22:23:53+08:00" />
<meta property="article:modified_time" content="2014-07-15T22:23:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">美女图片采集器 (源码&#43;解析)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>前言:</h2> 
<p><span style="white-space:pre"><br></span></p> 
<p><span style="white-space:pre"> </span><span style="font-size:14px;color:#990000;"><strong>有一段时间没写博客了, "持之以恒"徽章都暗了, 实在不该。 前一段确实比较忙, ...小小地给自己的懒找个借口吧。 大二即将结束, 学习iOS也有一段时间了。今天抽点时间, 开源一个前几天刚上传的App里面的一个功能, RT, 美女图片采集器。   美女.. 相信没有人不喜欢吧, 基于此, 这个小Demo应运而生。</strong></span></p> 
<p><br></p> 
<h2>注: </h2> 
<p><br></p> 
<p><span style="font-size:18px;color:#990000;"><strong>本文正在参加博客大赛。 如果觉得对你有所帮助, 还望帮忙投下票。 多谢。 </strong></span></p> 
<p><span style="font-size:18px;color:#ff0000;"><strong>投票链接: <a target="_blank" href="http://vote.blog.csdn.net/Article/Details?articleid=37825177" rel="nofollow noopener noreferrer">http://vote.blog.csdn.net/Article/Details?articleid=37825177 (投票按钮在最下方)</a></strong></span></p> 
<h2>效果演示:</h2> 
<p><br></p> 
<p><img src="https://images2.imgbox.com/35/7f/sNoNTkBs_o.gif" alt=""><img src="https://images2.imgbox.com/4e/77/sPNpmpHa_o.gif" alt=""><img src="https://images2.imgbox.com/2f/b7/gphO9hH7_o.gif" alt=""><img src="https://images2.imgbox.com/69/ca/ooLbTQgB_o.gif" alt=""><img src="https://images2.imgbox.com/c9/aa/R6TYT0jj_o.gif" alt=""><br></p> 
<p><br></p> 
<p><span style="font-size:14px;color:#ff0000;"><strong><span style="white-space:pre"> </span>看到这里, 如果还有兴趣学习的话, 可以先到我的git中下载源码, 然后配合着源码看我下面的解析。相信, 会让你有所收获的。</strong></span></p> 
<p><span style="color: rgb(255, 0, 0);"><strong><span style="font-size:32px;"><span style="white-space: pre;"> </span>git下载链接: <a target="_blank" href="https://github.com/colin1994/BeautyPickDemo.git" rel="noopener noreferrer">BeautyPickDemo.git</a></span></strong></span></p> 
<p><br></p> 
<h2>涉及内容:</h2> 
<p></p> 
<p><br></p> 
<ol><li><span style="font-size:14px;color:#3333ff;"><strong>百度图片API的使用</strong></span></li><li><span style="font-size:14px;color:#3333ff;"><strong>JSON格式数据解析</strong></span></li><li><span style="font-size:14px;color:#3333ff;"><strong>图片异步下载 + 离线缓存</strong></span></li><li><span style="font-size:14px;color:#3333ff;"><strong>图片基本操作(缩放, 删除, 添加, 保存到本地)</strong></span></li><li><span style="font-size:14px;color:#3333ff;"><strong>下拉刷新, 上提加载</strong></span></li><li><span style="font-size:14px;color:#3333ff;"><strong>幻灯片放映</strong></span></li><li><span style="font-size:14px;color:#3333ff;"><strong>自定义后台显示图片</strong></span></li></ol> 
<div> 
 <br> 
</div> 
<h2>源码解析:</h2> 
<div> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<h3>一。百度图片API的使用</h3> 
<div>
  首先, 我们知道百度是没有对外开放图片API的, 但是我们可以通过谷歌浏览器来捕捉到访问过程中它调用的API。有兴趣的, 可以了解下谷歌浏览器Network选项的使用, 也可以参考下这篇文章:  
 <a target="_blank" href="http://blog.csdn.net/yuanwofei/article/details/16343743" rel="noopener noreferrer">百度图片api</a> 
</div> 
<div>
  这里, 我们主要介绍如何使用即可。 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <span style="font-size:14px;color:#ff0000;"><strong>1.百度图片通用API:</strong></span> 
</div> 
<div>
  http://image.baidu.com/i?tn=resultjsonavstar&amp;ie=utf-8&amp;word=刘德华&amp;pn=0&amp;rn=60 
 <br>说明： 
 <br>返回格式为json 
 <br>word为查询的内容 
 <br>pn为第几页 
 <br>rn为一页返回的图片数量 
 <br>用法：大家在浏览器地址栏输入上述地址，回车即可看到返回的图片地址 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <strong><span style="font-size:14px;color:#ff0000;">2.百度图片分类API (我们使用的就是这个)</span></strong> 
</div> 
<div>
  http://image.baidu.com/channel/listjson?pn=0&amp;rn=30&amp;tag1=美女&amp;tag2=全部&amp;ie=utf8 
 <br>http://image.baidu.com/channel/listjson?pn=0&amp;rn=30&amp;tag1=美女&amp;tag2=全部&amp;ftags=校花&amp;ie=utf8 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<div>
  至于其他的, 依照这个方法都能获取到. 就不重复说明了。 
</div> 
<div> 
 <br> 
</div> 
<div>
  至于如何调用API, 涉及到网络编程。 
</div> 
<div>
  开源的ASI类库做的比较好(虽然挺老的一个东西了, 也有一段时间没更新了, 但是能满足我们需求)。 
</div> 
<div>
  从源码中, 可以找到 网络请求ASI文件夹，里面有需要的文件 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <strong><span style="font-size:14px;color:#3333ff;">1。导入这里的文件</span></strong> 
</div> 
<div> 
 <span style="font-size:14px;color:#3333ff;"><strong>2。导入必须的框架, 包括:</strong></span> 
</div> 
<div>
  SystemConfiguration.framework 
 <br>MobileCoreServices.framework 
 <br>CFNetwork.framework 
 <br>libz.dylib 
 <br> 
</div> 
<div> 
 <strong><span style="font-size:14px;color:#3333ff;">3。调用API (参见 主界面--&gt;picVC)</span></strong> 
</div> 
<div> 
 <pre><code class="language-objc">@property (nonatomic,strong) ASIHTTPRequest *testRequest;
</code></pre> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <pre><code class="language-objc">NSString* urlString = [NSString stringWithFormat:@"http://image.baidu.com/channel/listjson?pn=%d&amp;rn=10&amp;tag1=美女&amp;tag2=%@", nowPage, [chooseArr objectAtIndex:nowChoose]];

urlString = [urlString stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding];
NSURL *url = [NSURL URLWithString:urlString];
testRequest = [ASIHTTPRequest requestWithURL:url];
[testRequest setDelegate:self];
[testRequest startAsynchronous];</code></pre> 
 <br> 
</div> 
<div>
  即可正常调用API。至于如何处理返回的数据, 下面再详细讲。 
</div> 
<div> 
 <br> 
</div> 
<h3>二。JSON格式数据解析</h3> 
<div>
  一般的数据格式有 
 <span style="color:#ff0000;"><strong>XML</strong></span>和 
 <strong><span style="color:#ff0000;">JSON</span></strong>, 这里因为调用百度图片API返回的数据格式是JSON, 所以我们只要解析JSON即可。 
</div> 
<div>
  调用API成功后, 它会自动执行这个函数 
 <pre><code class="language-objc">#pragma mark - 加载数据完毕
- (void)requestFinished:(ASIHTTPRequest *)request</code></pre>我们只需要在这里解析数据, 使用数据即可。 
</div> 
<div> 
 <br> 
</div> 
<div>
  这个方法返回的数据是二进制格式的NSData, 我们需要手动转为UTF8编码。可以这样获取: 
</div> 
<div> 
 <pre><code class="language-objc">//当以二进制读取返回内容时用这个方法
    NSData *responseData = [request responseData];
    NSString *responseString = [[NSString alloc] initWithData:responseData encoding:NSUTF8StringEncoding];</code></pre> 
 <br>接下去就是神奇的时候了, 对于这样的一个字符串, 如果直接打印, 你可能会看得云里雾里的, json格式并且没有重新排列。 
</div> 
<div>
  但是我们可以使用JsonKit来直接解析。(文件在json解析文件夹中) 
</div> 
<div> 
 <br> 
</div> 
<div>
  只需这样一条语句即可: 
</div> 
<div> 
 <pre><code class="language-objc">self.testDic = [responseString objectFromJSONString];</code></pre> 
 <br> 
</div> 
<div>
  打印解析后的数据如下: 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <img src="https://images2.imgbox.com/5a/a4/MyNbtOy2_o.png" alt=""> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<div>
  至于需要哪些, 直接取就好了。比如. 我们这里需要获取到图片的标题. url, 宽度, 高度 
</div> 
<div> 
 <pre><code class="language-objc">NSMutableDictionary *nowDic = [[NSMutableDictionary alloc]init];
[nowDic setObject:[[array objectAtIndex:i]objectForKey:@"image_url"] forKey:@"image_url"];
[nowDic setObject:[[array objectAtIndex:i]objectForKey:@"image_width"] forKey:@"image_width"];
[nowDic setObject:[[array objectAtIndex:i]objectForKey:@"image_height"] forKey:@"image_height"];
[nowDic setObject:[[array objectAtIndex:i]objectForKey:@"desc"] forKey:@"desc"];

[picArray addObject:nowDic];</code></pre> 
 <br> 
 <br> 
</div> 
<h3>三。图片异步下载+离线缓存</h3> 
<div> 
 <br> 
</div> 
<div>
  这里提一下SDWebImage, 我们将会使用它来实现。 具体使用参见: 
 <a target="_blank" href="http://blog.csdn.net/uxyheaven/article/details/7909373" rel="noopener noreferrer">SDWebImage 笔记</a> 
</div> 
<div>
  在解析完json数据后, 我们会获取到图片对应的url。 
</div> 
<div>
  我们可以通过访问url获取图片。  
</div> 
<div> 
 <pre><code class="language-objc">- (void)setImageWithURL:(NSURL *)url placeholderImage:(UIImage *)placeholder;</code></pre>这是SDWebImage给我们提供的一个函数. 通过调用它, 我们可以实现异步下载和离线缓存。 
</div> 
<div> 
 <br> 
</div> 
<div>
  使用方法: 
</div> 
<div> 
 <pre><code class="language-objc">UIImageView *imageView = [[UIImageView alloc]initWithFrame:CGRectMake(SPACE / 2 , SPACE / 2 , width, height)];
NSURL *url = [NSURL URLWithString:imageInfo.thumbURL];
[imageView setImageWithURL:url placeholderImage:nil];
imageView.backgroundColor = [UIColor palePurpleColor];
[self addSubview:imageView];</code></pre> 
 <br> 
 <br> 
</div> 
<div>
  异步下载,离线缓存效果:(离线缓存可以到应用沙盒中查看) 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <img src="https://images2.imgbox.com/9a/31/u7R6x4MZ_o.png" alt=""> 
 <img src="https://images2.imgbox.com/7a/9b/rBWedjxF_o.png" alt=""> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<h3>四。图片基本操作(缩放, 删除, 添加, 保存到本地)</h3> 
<div> 
 <br> 
</div> 
<div>
  这里涉及的主要是一些常规操作, 包括缩放, 删除, 添加, 保存到本地等。 
</div> 
<div> 
 <strong><span style="font-size:14px;color:#cc0000;">至于删除, 一般是长按删除, 只要在图片上加上长按手势响应即可。然后弹出一个对话框, 提示用户是否删除。确定删除后, 从沙盒中清除缓存即可。</span></strong> 
</div> 
<div>
  添加手势方法: 
</div> 
<div> 
 <pre><code class="language-objc">//长按
UILongPressGestureRecognizer *longRecognizer;
longRecognizer = [[UILongPressGestureRecognizer alloc]initWithTarget:self action:@selector(handleSingleLongFrom:)];
[self addGestureRecognizer:longRecognizer];</code></pre> 
 <br>从视图和沙盒中删除 
</div> 
<div> 
 <pre><code class="language-objc">        //从当前视图中删除
        [testArr removeObject:data];
        //刷新数据
        __weak picVC *blockSelf = self;
        [blockSelf.waterView refreshView:testArr];
        [blockSelf.waterView.infiniteScrollingView stopAnimating];
        
        //从沙盒中删除
        //打开沙盒
        NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
        NSString *documentsDirectory = [paths objectAtIndex:0];
        NSString * namePath = [documentsDirectory stringByAppendingPathComponent:[NSString stringWithFormat:@"savedPicInfo_%d.plist",nowChoose]];
        NSMutableArray *picArray = [[NSMutableArray alloc] initWithContentsOfFile:namePath];
        
        for (int i=0; i&lt;[picArray count]; i++)
        {
            if ([[[picArray objectAtIndex:i]objectForKey:@"image_url"] isEqualToString:data.thumbURL])
            {
                [picArray removeObjectAtIndex:i];
                break;
            }
        }
        [picArray writeToFile:namePath atomically:YES];</code></pre> 
 <br>至于缩放, 首先要弹出一个全屏显示的视图。 
</div> 
<div>
  像这样: 
</div> 
<div> 
 <pre><code class="language-objc">//单击, 显示大图
-(void)showImage:(ImageInfo*)data
{
    NSURL *url = [NSURL URLWithString:data.thumbURL];
    [clickImage setImageWithURL:url placeholderImage:nil];
    TGRImageViewController *viewController = [[TGRImageViewController alloc] initWithImage:clickImage.image setImageInfo:data];
    viewController.transitioningDelegate = self;
    [self presentViewController:viewController animated:YES completion:nil];
}
</code></pre> 
 <br>本质就是调用presentViewController:viewController。 
</div> 
<div>
  当然，我们可以给新视图的显示加上动画效果, 如下: 
</div> 
<div> 
 <pre><code class="language-objc">#pragma mark - UIViewControllerTransitioningDelegate methods
- (id&lt;UIViewControllerAnimatedTransitioning&gt;)animationControllerForPresentedController:(UIViewController *)presented presentingController:(UIViewController *)presenting sourceController:(UIViewController *)source
{
    if ([presented isKindOfClass:TGRImageViewController.class]) {
        return [[TGRImageZoomAnimationController alloc] initWithReferenceImageView:clickImage];
    }
    return nil;
}

- (id&lt;UIViewControllerAnimatedTransitioning&gt;)animationControllerForDismissedController:(UIViewController *)dismissed {
    if ([dismissed isKindOfClass:TGRImageViewController.class]) {
        return [[TGRImageZoomAnimationController alloc] initWithReferenceImageView:clickImage];
    }
    return nil;
}</code></pre> 
 <br> 
 <br> 
</div> 
<div>
  然后, 在新视图中, 添加点击移除, 长按弹出新操作, 双指移动缩放手势即可。 
</div> 
<div>
  具体实现如下: 
</div> 
<div> 
 <pre><code class="language-objc">#pragma mark - Private methods

- (void)longPress:(UITapGestureRecognizer *)tapGestureRecognizer
{
    
    if(tapGestureRecognizer.state == UIGestureRecognizerStateBegan)
    {
        [self popupActionSheet];
    }
}

- (IBAction)handleSingleTap:(UITapGestureRecognizer *)tapGestureRecognizer {
    [self dismissViewControllerAnimated:YES completion:nil];
}

- (IBAction)handleDoubleTap:(UITapGestureRecognizer *)tapGestureRecognizer {
    if (self.scrollView.zoomScale == self.scrollView.minimumZoomScale) {
        // Zoom in
        CGPoint center = [tapGestureRecognizer locationInView:self.scrollView];
        CGSize size = CGSizeMake(self.scrollView.bounds.size.width / self.scrollView.maximumZoomScale,
                                 self.scrollView.bounds.size.height / self.scrollView.maximumZoomScale);
        CGRect rect = CGRectMake(center.x - (size.width / 2.0), center.y - (size.height / 2.0), size.width, size.height);
        [self.scrollView zoomToRect:rect animated:YES];
    }
    else {
        // Zoom out
        [self.scrollView zoomToRect:self.scrollView.bounds animated:YES];
    }
}</code></pre> 
 <br> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<h3>五。下拉刷新, 上提加载</h3> 
<div>
  这个功能具体在浏览图片的时候使用。 代码在picVC中。 
</div> 
<div>
  但是因为我之前专门写过一篇这样的博客。 就不再重复了。 
</div> 
<div>
  详细可以看这里: 
 <a target="_blank" href="http://blog.csdn.net/hitwhylz/article/details/19046725" rel="noopener noreferrer"><span style="font-size:18px;color:#3333ff;"><strong> iOS开发-ios7下拉刷新,上提加载快速集成</strong></span></a> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<h3>六。幻灯片放映</h3> 
<div>
  顾名思义, 就是能够自动播放收藏过的美女图片..   
</div> 
<div>
  这里的原理是利用UIView的动画, 不断切换显示图片和显示效果。 
</div> 
<div> 
 <br> 
</div> 
<div>
  切换效果如下: 
</div> 
<div> 
 <pre><code class="language-objc">    _transitionOptions= @[[NSNumber numberWithInteger:UIViewAnimationOptionTransitionFlipFromLeft],
                          [NSNumber numberWithInteger:UIViewAnimationOptionTransitionFlipFromRight],
                          [NSNumber numberWithInteger:UIViewAnimationOptionTransitionCurlUp],
                          [NSNumber numberWithInteger:UIViewAnimationOptionTransitionCurlDown],
                          [NSNumber numberWithInteger:UIViewAnimationOptionTransitionCrossDissolve],
                          [NSNumber numberWithInteger:UIViewAnimationOptionTransitionFlipFromTop],
                          [NSNumber numberWithInteger:UIViewAnimationCurveEaseIn],
                          [NSNumber numberWithInteger:UIViewAnimationCurveEaseOut],
                          [NSNumber numberWithInteger:UIViewAnimationCurveLinear],
                          [NSNumber numberWithInteger:UIViewAnimationOptionAllowAnimatedContent],
                          [NSNumber numberWithInteger:UIViewAnimationOptionOverrideInheritedCurve],
                          [NSNumber numberWithInteger:UIViewAnimationOptionTransitionFlipFromTop],
                          [NSNumber numberWithInteger:UIViewAnimationOptionTransitionFlipFromBottom]];</code></pre> 
 <br>然后切换图片的时候, 实现如下代码即可。  (具体参见PhotoStackView) 
</div> 
<div> 
 <pre><code class="language-objc">-(void)reloadData {
    
    if (!self.dataSource) {
        //exit if data source has not been set up yet
        self.photoViews = nil;
        return;
    }
    
    NSInteger numberOfPhotos = [self.dataSource numberOfPhotosInPhotoStackView:self];
    NSInteger topPhotoIndex  = [self indexOfTopPhoto]; // Keeping track of current photo's top index so that it remains on top if new photos are added
    
    if(numberOfPhotos &gt; 0) {

        NSMutableArray *photoViewsMutable   = [[NSMutableArray alloc] initWithCapacity:numberOfPhotos];
        UIImage *borderImage                = [self.borderImage resizableImageWithCapInsets:UIEdgeInsetsMake(self.borderWidth, self.borderWidth, self.borderWidth, self.borderWidth)];
        
        for (NSUInteger index = 0; index &lt; numberOfPhotos; index++) {

            UIImage *image = [self.dataSource photoStackView:self photoForIndex:index];
            CGSize imageSize = image.size;
            if([self.dataSource respondsToSelector:@selector(photoStackView:photoSizeForIndex:)]){
                imageSize = [self.dataSource photoStackView:self photoSizeForIndex:index];
            }
            UIImageView *photoImageView     = [[UIImageView alloc] initWithFrame:(CGRect){CGPointZero, imageSize}];
            photoImageView.image            = image;
            UIView *view                    = [[UIView alloc] initWithFrame:photoImageView.frame];
            view.layer.rasterizationScale   = [[UIScreen mainScreen] scale];            
            view.layer.shouldRasterize      = YES; // rasterize the view for faster drawing and smooth edges

            if (self.showBorder) {
                
                // Add the background image
                if (borderImage) {
                    // If there is a border image, we need to add a background image view, and add some padding around the photo for the border

                    CGRect photoFrame                = photoImageView.frame;
                    photoFrame.origin                = CGPointMake(self.borderWidth, self.borderWidth);
                    photoImageView.frame             = photoFrame;

                    view.frame                       = CGRectMake(0, 0, photoImageView.frame.size.width+(self.borderWidth*2), photoImageView.frame.size.height+(self.borderWidth*2));
                    UIImageView *backgroundImageView = [[UIImageView alloc] initWithFrame:view.frame];
                    backgroundImageView.image        = borderImage;
                    
                    [view addSubview:backgroundImageView];
                } else {
                    // if there is no boarder image draw one with the CALayer
                    view.layer.borderWidth        = self.borderWidth;
                    view.layer.borderColor        = [[UIColor whiteColor] CGColor];
                    view.layer.shadowOffset       = CGSizeMake(0, 0);
                    view.layer.shadowOpacity      = 0.5;
                }
            }

            [view addSubview:photoImageView];

            view.tag    = index;
            view.center = CGPointMake(CGRectGetMidX(self.bounds), CGRectGetMidY(self.bounds));

            [photoViewsMutable addObject:view];
            
        }

        // Photo views are added to subview in the photoView setter
        self.photoViews = photoViewsMutable; photoViewsMutable = nil;
        [self goToPhotoAtIndex:topPhotoIndex];
        
    }
    
}
</code></pre> 
 <div> 
  <br> 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  <br> 
 </div> 
 <h3>七。自定义后台显示图片</h3>这个功能就是演示效果里面, 当应用切换到后台后， 我们双击home键后显示后台程序时候, 该应用的显示效果。 
</div> 
<div>
  比如..  有时候我们浏览的图片尺度比较大.. 然后切到后台的时候, 就希望把它隐藏起来..   
</div> 
<div> 
 <br> 
</div> 
<div>
  这就涉及到了Background Fetch的应用。 
</div> 
<div>
  之前也写过一篇博客专门介绍。 这里就不重复了。 
</div> 
<div>
  具体参见: 
 <a target="_blank" href="http://blog.csdn.net/hitwhylz/article/details/25557725" rel="noopener noreferrer"><strong><span style="font-size:18px;color:#3333ff;"> iOS开发-自定义后台显示图片(iOS7-Background Fetch的应用)</span></strong></a> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <strong><span style="font-size:18px;color:#990000;">好了。 到这里终于是介绍的差不多了。</span></strong> 
</div> 
<div> 
 <strong><span style="font-size:18px;color:#990000;">当然。 我这里的解析都比较概括， 列举的都是几个关键代码段。</span></strong> 
</div> 
<div> 
 <strong><span style="font-size:18px;color:#990000;">更加详细的还是需要自己去看代码。 注释也写了, 估计没什么问题。 如果有问题, 欢迎联系我。</span></strong> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <strong><span style="font-size:18px;color:#990000;">一口气写了3个小时的博客...  累的够呛的。也希望, 能对你有所帮助。</span></strong> 
</div> 
<div> 
 <strong><span style="font-size:18px;color:#990000;"><br></span></strong> 
</div> 
<div> 
 <strong><span style="font-size:18px;color:#990000;"></span></strong> 
 <p><span style="font-size:18px;color:#990000;"><strong>本文正在参加博客大赛。 如果觉得对你有所帮助, 还望帮忙投下票。 多谢。 </strong></span></p> 
 <p><span style="font-size:18px;color:#ff0000;"><strong>投票链接: <a target="_blank" href="http://vote.blog.csdn.net/Article/Details?articleid=37825177" rel="nofollow noopener noreferrer">http://vote.blog.csdn.net/Article/Details?articleid=37825177 (投票按钮在最下方)</a></strong></span></p> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<div style="text-align: center;"> 
 <span style="font-size:48px;color:#ff0000;"><strong>学习的路上, 与君共勉。</strong></span> 
</div> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/141bd630b600de3be46be9c3e128590b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySql安装最后一步start service失败，手动启动报1067错误</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/470c5fa3126d600326616d792f56caf8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL Broker SET ENABLE_BROKER 一直在执行,卡在那里解决方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>