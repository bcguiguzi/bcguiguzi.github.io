<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>0基础学MySQL数据库—从小白到大牛(38)数据库备份与恢复 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="0基础学MySQL数据库—从小白到大牛(38)数据库备份与恢复" />
<meta property="og:description" content="文章目录 前言物理备份与逻辑备份MySQLdump实现逻辑备份备份一个数据库备份全部数据库备份部分数据库备份部分表备份单表的部分数据排除某些表的备份只备份结构或只备份数据备份中包含存储过程、函数、事件mysqldump常用选项 MySQL命令恢复数据单库备份中恢复单库全量备份恢复从全量备份中恢复单库从单库备份中恢复单表 物理备份：直接复制整个数据库物理恢复：直接复制到数据库目录表的导入与导出表的导出表的导入 前言 本章使用的测试数据库为GreatSQL8.0.25版本
(Wed Aug 3 16:17:03 2022)[root@GreatSQL][(none)]&gt;select version(); &#43;-----------&#43; | version() | &#43;-----------&#43; | 8.0.25-16 | &#43;-----------&#43; 1 row in set (0.00 sec) 物理备份与逻辑备份 物理备份：备份数据文件，转储数据库物理文件到某一目录。物理备份恢复速度比较快，但占用空间比较大，MySQL中可以用xtrabackup工具来进行物理备份。
逻辑备份：对数据库对象利用工具进行导出工作，汇总入备份文件内。逻辑备份恢复速度慢，但占用空间小，更灵活。MySQL 中常用的逻辑备份工具为mysqldump。逻辑备份就是备份sql语句，在恢复的时候执行备份的sql语句实现数据库数据的重现。
MySQLdump实现逻辑备份 备份一个数据库 mysqldump –u 用户名称 –h 主机名称 –p密码 待备份的数据库名称[tbname, [tbname...]]&gt; 备份文件名 称.sql 说明： 备份的文件并非一定要求后缀名为.sql，例如后缀名为.txt的文件也是可以的。
举例：使用root用户备份atguigu数据库：
mysqldump -uroot -p GG&gt;GG.sql #备份文件存储在当前目录下 mysqldump -uroot -p GG &gt; /var/lib/mysql/GG.sql 备份全部数据库 若想用mysqldump备份整个实例，可以使用 --all-databases 或-A参数：
mysqldump -uroot -pxxxxxx --all-databases &gt; all_database.sql mysqldump -uroot -pxxxxxx -A &gt; all_database." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/9f7814c77bcdaf6128e041c6c40c4950/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-07T15:08:12+08:00" />
<meta property="article:modified_time" content="2022-10-07T15:08:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">0基础学MySQL数据库—从小白到大牛(38)数据库备份与恢复</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_5" rel="nofollow">前言</a></li><li><a href="#_17" rel="nofollow">物理备份与逻辑备份</a></li><li><a href="#MySQLdump_21" rel="nofollow">MySQLdump实现逻辑备份</a></li><li><ul><li><a href="#_22" rel="nofollow">备份一个数据库</a></li><li><a href="#_35" rel="nofollow">备份全部数据库</a></li><li><a href="#_43" rel="nofollow">备份部分数据库</a></li><li><a href="#_54" rel="nofollow">备份部分表</a></li><li><a href="#_66" rel="nofollow">备份单表的部分数据</a></li><li><a href="#_73" rel="nofollow">排除某些表的备份</a></li><li><a href="#_78" rel="nofollow">只备份结构或只备份数据</a></li><li><a href="#_90" rel="nofollow">备份中包含存储过程、函数、事件</a></li><li><a href="#mysqldump_95" rel="nofollow">mysqldump常用选项</a></li></ul> 
  </li><li><a href="#MySQL_165" rel="nofollow">MySQL命令恢复数据</a></li><li><ul><li><a href="#_171" rel="nofollow">单库备份中恢复单库</a></li><li><a href="#_178" rel="nofollow">全量备份恢复</a></li><li><a href="#_183" rel="nofollow">从全量备份中恢复单库</a></li><li><a href="#_191" rel="nofollow">从单库备份中恢复单表</a></li></ul> 
  </li><li><a href="#_207" rel="nofollow">物理备份：直接复制整个数据库</a></li><li><a href="#_227" rel="nofollow">物理恢复：直接复制到数据库目录</a></li><li><a href="#_249" rel="nofollow">表的导入与导出</a></li><li><ul><li><a href="#_250" rel="nofollow">表的导出</a></li><li><a href="#_266" rel="nofollow">表的导入</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_5"></a>前言</h2> 
<p>本章使用的测试数据库为GreatSQL8.0.25版本</p> 
<pre><code class="prism language-sql"><span class="token punctuation">(</span>Wed Aug  <span class="token number">3</span> <span class="token number">16</span>:<span class="token number">17</span>:<span class="token number">03</span> <span class="token number">2022</span><span class="token punctuation">)</span><span class="token punctuation">[</span>root<span class="token variable">@GreatSQL</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token keyword">select</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span> <span class="token number">8.0</span><span class="token number">.25</span><span class="token operator">-</span><span class="token number">16</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_17"></a>物理备份与逻辑备份</h2> 
<p><strong>物理备份</strong>：备份数据文件，转储数据库物理文件到某一目录。物理备份恢复速度比较快，但占用空间比较大，MySQL中可以用<code>xtrabackup</code>工具来进行物理备份。<br> <strong>逻辑备份</strong>：对数据库对象利用工具进行导出工作，汇总入备份文件内。逻辑备份恢复速度慢，但占用空间小，更灵活。MySQL 中常用的逻辑备份工具为<code>mysqldump</code>。逻辑备份就是<code>备份sql语句</code>，在恢复的时候执行备份的sql语句实现数据库数据的重现。</p> 
<h2><a id="MySQLdump_21"></a>MySQLdump实现逻辑备份</h2> 
<h3><a id="_22"></a>备份一个数据库</h3> 
<pre><code class="prism language-sql">mysqldump –u 用户名称 –h 主机名称 –p密码 待备份的数据库名称<span class="token punctuation">[</span>tbname<span class="token punctuation">,</span> <span class="token punctuation">[</span>tbname<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> 备份文件名 称<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<blockquote> 
 <p>说明： 备份的文件并非一定要求后缀名为.sql，例如后缀名为.txt的文件也是可以的。</p> 
</blockquote> 
<p>举例：使用root用户备份atguigu数据库：</p> 
<pre><code class="prism language-sql">mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p GG<span class="token operator">&gt;</span>GG<span class="token punctuation">.</span><span class="token keyword">sql</span> <span class="token comment">#备份文件存储在当前目录下</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p GG <span class="token operator">&gt;</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>GG<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<h3><a id="_35"></a>备份全部数据库</h3> 
<p>若想用mysqldump备份整个实例，可以使用<code> --all-databases</code> 或<code>-A</code>参数：</p> 
<pre><code class="prism language-sql">mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>pxxxxxx <span class="token comment">--all-databases &gt; all_database.sql </span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>pxxxxxx <span class="token operator">-</span>A <span class="token operator">&gt;</span> all_database<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<h3><a id="_43"></a>备份部分数据库</h3> 
<p>使用 <code>--databases </code>或<code>-B</code>参数了，该参数后面跟数据库名称，多个数据库间用空格隔开。如果指定databases参数，备份文件中会存在创建数据库的语句，如果不指定参数，则不存在。语法如下：</p> 
<pre><code class="prism language-sql">mysqldump –u <span class="token keyword">user</span> –h host –p <span class="token comment">--databases [数据库的名称1 [数据库的名称2...]] &gt; 备份文件名 称.sql</span>
</code></pre> 
<pre><code class="prism language-sql">mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p <span class="token comment">--databases KK KK2 &gt;two_database.sql</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p <span class="token operator">-</span>B KK KK12 <span class="token operator">&gt;</span> two_database<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<h3><a id="_54"></a>备份部分表</h3> 
<p>比如，在表变更前做个备份。语法如下：</p> 
<pre><code class="prism language-sql">mysqldump –u <span class="token keyword">user</span> –h host –p 数据库的名称 <span class="token punctuation">[</span>表名<span class="token number">1</span> <span class="token punctuation">[</span>表名<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> 备份文件名称<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<p>举例：备份atguigu数据库下的book表</p> 
<pre><code class="prism language-sql">mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p KK book<span class="token operator">&gt;</span> book<span class="token punctuation">.</span><span class="token keyword">sql</span>

<span class="token comment">#备份多张表 </span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p KK book account <span class="token operator">&gt;</span> <span class="token number">2</span>_tables_bak<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<h3><a id="_66"></a>备份单表的部分数据</h3> 
<p>有些时候一张表的数据量很大，我们只需要部分数据。这时就可以使用 <code>--where</code>选项了。where后面附带需要满足的条件。</p> 
<p>举例：备份student表中id小于10的数据：</p> 
<pre><code class="prism language-sql">mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p atguigu student <span class="token comment">--where="id &lt; 10 " &gt; student_part_id10_low_</span>
</code></pre> 
<h3><a id="_73"></a>排除某些表的备份</h3> 
<p>如果我们想备份某个库，但是某些表数据量很大或者与业务关联不大，这个时候可以考虑排除掉这些表，同样的，选项<code>--ignore-table</code>可以完成这个功能。</p> 
<pre><code class="prism language-sql">mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p atguigu <span class="token comment">--ignore-table=atguigu.student &gt; no_stu_bak.sql</span>
</code></pre> 
<h3><a id="_78"></a>只备份结构或只备份数据</h3> 
<p>只备份结构的话可以使用<code>--no-data</code>简写为<code>-d</code>选项；只备份数据可以使用<code>--no-create-info</code>简写为<br> -t 选项。</p> 
<ul><li>只备份结构</li></ul> 
<pre><code class="prism language-sql">mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p atguigu <span class="token comment">--no-data &gt; atguigu_no_data_bak.sql</span>
</code></pre> 
<ul><li>只备份数据</li></ul> 
<pre><code class="prism language-sql">mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p atguigu <span class="token comment">--no-create-info &gt; atguigu_no_create_info_bak.sql</span>
</code></pre> 
<h3><a id="_90"></a>备份中包含存储过程、函数、事件</h3> 
<p>mysqldump备份默认是不包含存储过程，自定义函数及事件的。可以使用 --routines 或<code>-R</code>选项来备份存储过程及函数，使用 --events 或<code>-E</code>参数来备份事件。</p> 
<pre><code class="prism language-sql">mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p <span class="token operator">-</span>R <span class="token operator">-</span>E <span class="token comment">--databases atguigu &gt; fun_atguigu_bak.sql</span>
</code></pre> 
<h3><a id="mysqldump_95"></a>mysqldump常用选项</h3> 
<p>mysqldump其他常用选项如下：</p> 
<pre><code class="prism language-sql"><span class="token comment">--add-drop-database：在每个CREATE DATABASE语句前添加DROP DATABASE语句。</span>

<span class="token comment">--add-drop-tables：在每个CREATE TABLE语句前添加DROP TABLE语句。</span>

<span class="token comment">--add-locking：用LOCK TABLES和UNLOCK TABLES语句引用每个表转储。重载转储文件时插入得更快。</span>

<span class="token comment">--all-database, -A：转储所有数据库中的所有表。与使用--database选项相同，在命令行中命名所有数据库。</span>

<span class="token comment">--comment[=0|1]：如果设置为0，禁止转储文件中的其他信息，例如程序版本、服务器版本和主机。--skip- comments与--comments=0的结果相同。默认值为1，即包括额外信息。</span>

<span class="token comment">--compact：产生少量输出。该选项禁用注释并启用--skip-add-drop-tables、--no-set-names、--skip- disable-keys和--skip-add-locking选项。</span>

<span class="token comment">--compatible=name：产生与其他数据库系统或旧的MySQL服务器更兼容的输出，值可以为ansi、MySQL323、 MySQL40、postgresql、oracle、mssql、db2、maxdb、no_key_options、no_table_options或者 no_field_options。</span>

<span class="token comment">--complete_insert, -c：使用包括列名的完整的INSERT语句。</span>

<span class="token comment">--debug[=debug_options], -#[debug_options]：写调试日志。</span>
<span class="token comment">--delete，-D：导入文本文件前清空表。</span>

<span class="token comment">--default-character-set=charset：使用charsets默认字符集。如果没有指定，就使用utf8。</span>

<span class="token comment">--delete--master-logs：在主复制服务器上，完成转储操作后删除二进制日志。该选项自动启用-master- data。</span>

<span class="token comment">--extended-insert，-e：使用包括几个VALUES列表的多行INSERT语法。这样使得转储文件更小，重载文件时可 以加速插入。</span>

<span class="token comment">--flush-logs，-F：开始转储前刷新MySQL服务器日志文件。该选项要求RELOAD权限。</span>

<span class="token comment">--force，-f：在表转储过程中，即使出现SQL错误也继续。</span>

<span class="token comment">--lock-all-tables，-x：对所有数据库中的所有表加锁。在整体转储过程中通过全局锁定来实现。该选项自动关 闭--single-transaction和--lock-tables。</span>

<span class="token comment">--lock-tables，-l：开始转储前锁定所有表。用READ LOCAL锁定表以允许并行插入MyISAM表。对于事务表（例 如InnoDB和BDB），--single-transaction是一个更好的选项，因为它根本不需要锁定表。</span>

<span class="token comment">--no-create-db，-n：该选项禁用CREATE DATABASE /*!32312 IF NOT EXIST*/db_name语句，如果给出- -database或--all-database选项，就包含到输出中。</span>

<span class="token comment">--no-create-info，-t：只导出数据，而不添加CREATE TABLE语句。</span>

<span class="token comment">--no-data，-d：不写表的任何行信息，只转储表的结构。</span>

<span class="token comment">--opt：该选项是速记，它可以快速进行转储操作并产生一个能很快装入MySQL服务器的转储文件。该选项默认开启， 但可以用--skip-opt禁用。</span>

<span class="token comment">--password[=password]，-p[password]：当连接服务器时使用的密码。</span>

<span class="token operator">-</span>port<span class="token operator">=</span>port_num，<span class="token operator">-</span>P port_num：用于连接的TCP<span class="token operator">/</span>IP端口号。

<span class="token comment">--protocol={TCP|SOCKET|PIPE|MEMORY}：使用的连接协议。</span>

<span class="token comment">--replace，-r –replace和--ignore：控制替换或复制唯一键值已有记录的输入记录的处理。如果指定-- replace，新行替换有相同的唯一键值的已有行；如果指定--ignore，复制已有的唯一键值的输入行被跳过。如果不 指定这两个选项，当发现一个复制键值时会出现一个错误，并且忽视文本文件的剩余部分。</span>

<span class="token comment">--silent，-s：沉默模式。只有出现错误时才输出。</span>

<span class="token comment">--socket=path，-S path：当连接localhost时使用的套接字文件（为默认主机）。</span>

<span class="token comment">--user=user_name，-u user_name：当连接服务器时MySQL使用的用户名。</span>

<span class="token comment">--verbose，-v：冗长模式，打印出程序操作的详细信息。</span>

<span class="token comment">--xml，-X：产生XML输出</span>
</code></pre> 
<p>运行帮助命令<code>mysqldump --help</code>，可以获得特定版本的完整选项列表。</p> 
<blockquote> 
 <p>提示 如果运行mysqldump没有–quick或–opt选项，mysqldump在转储结果前将整个结果集装入内存。如果转储大数据库可能会出现问题，该选项默认启用，但可以用–skip-opt禁用。如果使用最新版本的mysqldump程序备份数据，并用于恢复到比较旧版本的MySQL服务器中，则不要使用–opt 或-e选项。</p> 
</blockquote> 
<h2><a id="MySQL_165"></a>MySQL命令恢复数据</h2> 
<p>基本语法：</p> 
<pre><code class="prism language-sql">mysql –u root –p <span class="token punctuation">[</span>dbname<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token keyword">backup</span><span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<h3><a id="_171"></a>单库备份中恢复单库</h3> 
<pre><code class="prism language-sql"><span class="token comment">#备份文件中包含了创建数据库的语句</span>
mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p <span class="token operator">&lt;</span> atguigu<span class="token punctuation">.</span><span class="token keyword">sql</span>
<span class="token comment">#备份文件中不包含了创建数据库的语句</span>
mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p atguigu4<span class="token operator">&lt;</span> atguigu<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<h3><a id="_178"></a>全量备份恢复</h3> 
<p>如果我们现在有昨天的全量备份，现在想整个恢复，则可以这样操作：</p> 
<pre><code class="prism language-sql">mysql –u root –p <span class="token operator">&lt;</span> <span class="token keyword">all</span><span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre> 
<h3><a id="_183"></a>从全量备份中恢复单库</h3> 
<p>可能有这样的需求，比如说我们只想恢复某一个库，但是我们有的是整个实例的备份，这个时候我们可<br> 以从全量备份中分离出单个库的备份。</p> 
<pre><code class="prism language-sql">sed <span class="token operator">-</span>n <span class="token string">'/^-- Current Database: `atguigu`/,/^-- Current Database: `/p'</span> all_database<span class="token punctuation">.</span><span class="token keyword">sql</span> <span class="token operator">&gt;</span> atguigu<span class="token punctuation">.</span><span class="token keyword">sql</span> 
<span class="token comment">#分离完成后我们再导入KK.sql即可恢复单个库</span>
</code></pre> 
<h3><a id="_191"></a>从单库备份中恢复单表</h3> 
<p>这个需求还是比较常见的。比如说我们知道哪个表误操作了，那么就可以用单表恢复的方式来恢复。</p> 
<p>举例：我们有atguigu整库的备份，但是由于class表误操作，需要单独恢复出这张表。</p> 
<pre><code class="prism language-sql">cat KK<span class="token punctuation">.</span><span class="token keyword">sql</span> <span class="token operator">|</span> sed <span class="token operator">-</span>e <span class="token string">'/./{H;$!d;}'</span> <span class="token operator">-</span>e <span class="token string">'x;/CREATE TABLE `class`/!d;q'</span> <span class="token operator">&gt;</span> class_structure<span class="token punctuation">.</span><span class="token keyword">sql</span> 
cat KK<span class="token punctuation">.</span><span class="token keyword">sql</span> <span class="token operator">|</span> grep <span class="token comment">--ignore-case 'insert into `class`' &gt; class_data.sql </span>
<span class="token comment">#用shell语法分离出创建表的语句及插入数据的语句后 再依次导出即可完成恢复 </span>
<span class="token keyword">use</span> test<span class="token punctuation">;</span> 
mysql<span class="token operator">&gt;</span> source class_structure<span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">;</span> 
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span> 

mysql<span class="token operator">&gt;</span> source class_data<span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">;</span> 
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_207"></a>物理备份：直接复制整个数据库</h2> 
<p>直接将MySQL中的数据库文件复制出来。这种方法最简单，速度也最快。MySQL的数据库目录位置不一定相同：</p> 
<ul><li>在Windows平台下，MySQL 8.0存放数据库的目录通常默认为 “ C:\ProgramData\MySQL\MySQL Server 8.0\Data ”或者其他用户自定义目录；</li><li>在Linux平台下，数据库目录位置通常为/var/lib/mysql/；</li><li>在MAC OSX平台下，数据库目录位置通常为“/usr/local/mysql/data”</li></ul> 
<p>但为了保证备份的一致性。需要保证：</p> 
<ul><li>方式1：备份前，将服务器停止。</li><li>方式2：备份前，对相关表执行 FLUSH TABLES WITH READ LOCK 操作。这样当复制数据库目录中的文件时，允许其他客户继续查询表。同时，FLUSH TABLES语句来确保开始备份前将所有激活的索引页写入硬盘。</li></ul> 
<p>这种方式方便、快速，但不是最好的备份方法，因为实际情况可能 不允许停止MySQL服务器 或者 锁住 表 ，而且这种方法 对InnoDB存储引擎 的表不适用。对于MyISAM存储引擎的表，这样备份和还原很方便，但是还原时最好是相同版本的MySQL数据库，否则可能会存在文件类型不同的情况。</p> 
<p>注意，物理备份完毕后，执行<code>UNLOCK TABLES</code>来结算其他客户对表的修改行为。</p> 
<blockquote> 
 <p>说明： 在MySQL版本号中，第一个数字表示主版本号，主版本号相同的MySQL数据库文件格式相同。</p> 
</blockquote> 
<p>此外，还可以考虑使用相关工具实现备份。比如， MySQLhotcopy 工具。MySQLhotcopy是一个Perl脚本，它使用LOCK TABLES、FLUSH TABLES和cp或scp来快速备份数据库。它是备份数据库或单个表最快的途径，但它只能运行在数据库目录所在的机器上，并且只能备份MyISAM类型的表。多用于mysql5.5之前。</p> 
<h2><a id="_227"></a>物理恢复：直接复制到数据库目录</h2> 
<p>步骤：<br> 1）演示删除备份的数据库中指定表的数据<br> 2）将备份的数据库数据拷贝到数据目录下，并重启MySQL服务器<br> 3）查询相关表的数据是否恢复。需要使用下面的 chown 操作。<br> 要求</p> 
<ul><li>必须确保备份数据的数据库和待恢复的数据库服务器的主版本号相同。 
  <ul><li>因为只有MySQL数据库主版本号相同时，才能保证这两个MySQL数据库文件类型是相同的。</li></ul> </li><li>这种方式对 MyISAM类型的表比较有效 ，对于InnoDB类型的表则不可用。 
  <ul><li>因为InnoDB表的表空间不能直接复制。</li></ul> </li><li>在Linux操作系统下，复制到数据库目录后，一定要将数据库的用户和组变成mysql，命令如下：</li></ul> 
<pre><code class="prism language-sql">chown <span class="token operator">-</span>R mysql<span class="token punctuation">.</span>mysql <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>dbname
</code></pre> 
<p>其中，两个mysql分别表示组和用户；“-R”参数可以改变文件夹下的所有子文件的用户和组；“dbname”参数表示数据库目录。</p> 
<blockquote> 
 <p>提示 Linux操作系统下的权限设置非常严格。通常情况下，MySQL数据库只有root用户和mysql用户组下的mysql用户才可以访问，因此将数据库目录复制到指定文件夹后，一定要使用chown命令将文件夹的用户组变为mysql，将用户变为mysql。</p> 
</blockquote> 
<h2><a id="_249"></a>表的导入与导出</h2> 
<h3><a id="_250"></a>表的导出</h3> 
<ol><li>使用SELECT…INTO OUTFILE导出文本文件</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%secure%'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account <span class="token keyword">INTO</span> <span class="token keyword">OUTFILE</span> <span class="token string">"/var/lib/mysql-files/account.txt"</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>使用mysqldump命令导出文本文件</li></ol> 
<pre><code class="prism language-sql">mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p <span class="token operator">-</span>T <span class="token string">"/var/lib/mysql-files/"</span> atguigu account
<span class="token comment"># 或</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p <span class="token operator">-</span>T <span class="token string">"/var/lib/mysql-files/"</span> atguigu account <span class="token comment">--fields-terminated- by=',' --fields-optionally-enclosed-by='\"'</span>
</code></pre> 
<ol start="3"><li>使用mysql命令导出文本文件</li></ol> 
<pre><code class="prism language-sql">mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p <span class="token comment">--execute="SELECT * FROM account;" atguigu&gt; "/var/lib/mysql-files/account.txt</span>
</code></pre> 
<h3><a id="_266"></a>表的导入</h3> 
<ol><li>使用LOAD DATA INFILE方式导入文本文件</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">INFILE</span> <span class="token string">'/var/lib/mysql-files/account_0.txt'</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> atguigu<span class="token punctuation">.</span>account<span class="token punctuation">;</span>
<span class="token comment"># 或</span>
<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">INFILE</span> <span class="token string">'/var/lib/mysql-files/account_1.txt'</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> atguigu<span class="token punctuation">.</span>account <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span> <span class="token keyword">ENCLOSED</span> <span class="token keyword">BY</span> <span class="token string">'\"'</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>使用mysqlimport方式导入文本文件</li></ol> 
<pre><code class="prism language-sql">mysqlimport <span class="token operator">-</span>uroot <span class="token operator">-</span>p atguigu <span class="token string">'/var/lib/mysql-files/account.txt'</span> <span class="token comment">--fields-terminated- by=',' -</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4ba5afb9fa0601596f258cdafee833da/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用-screen命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49773826f9fbed9af8dc136e08ec976f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ROS：bag包内容提取——有时间戳的图片</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>