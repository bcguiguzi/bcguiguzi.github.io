<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hibernate实战——无连接表的N-1关联 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Hibernate实战——无连接表的N-1关联" />
<meta property="og:description" content="一 配置文件
&lt;?xml version=&#34;1.0&#34; encoding=&#34;GBK&#34;?&gt; &lt;!-- 指定Hibernate配置文件的DTD信息 --&gt; &lt;!DOCTYPE hibernate-configuration PUBLIC &#34;-//Hibernate/Hibernate Configuration DTD 3.0//EN&#34; &#34;http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd&#34;&gt; &lt;!-- hibernate-configuration是配置文件的根元素 --&gt; &lt;hibernate-configuration&gt; &lt;session-factory&gt; &lt;!-- 指定连接数据库所用的驱动 --&gt; &lt;property name=&#34;connection.driver_class&#34;&gt;com.mysql.jdbc.Driver&lt;/property&gt; &lt;!-- 指定连接数据库的url，其中hibernate是本应用连接的数据库名 --&gt; &lt;property name=&#34;connection.url&#34;&gt;jdbc:mysql://localhost/hibernate&lt;/property&gt; &lt;!-- 指定连接数据库的用户名 --&gt; &lt;property name=&#34;connection.username&#34;&gt;root&lt;/property&gt; &lt;!-- 指定连接数据库的密码 --&gt; &lt;property name=&#34;connection.password&#34;&gt;32147&lt;/property&gt; &lt;!-- 指定连接池里最大连接数 --&gt; &lt;property name=&#34;hibernate.c3p0.max_size&#34;&gt;20&lt;/property&gt; &lt;!-- 指定连接池里最小连接数 --&gt; &lt;property name=&#34;hibernate.c3p0.min_size&#34;&gt;1&lt;/property&gt; &lt;!-- 指定连接池里连接的超时时长 --&gt; &lt;property name=&#34;hibernate.c3p0.timeout&#34;&gt;5000&lt;/property&gt; &lt;!-- 指定连接池里最大缓存多少个Statement对象 --&gt; &lt;property name=&#34;hibernate.c3p0.max_statements&#34;&gt;100&lt;/property&gt; &lt;property name=&#34;hibernate.c3p0.idle_test_period&#34;&gt;3000&lt;/property&gt; &lt;property name=&#34;hibernate.c3p0.acquire_increment&#34;&gt;2&lt;/property&gt; &lt;property name=&#34;hibernate.c3p0.validate&#34;&gt;true&lt;/property&gt; &lt;!-- 指定数据库方言 --&gt; &lt;property name=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/11f84c64282949f2eb35c22aec2ae0da/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-18T19:18:01+08:00" />
<meta property="article:modified_time" content="2019-09-18T19:18:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hibernate实战——无连接表的N-1关联</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>一 配置文件</strong></p> 
<pre class="has"><code class="language-html">&lt;?xml version="1.0" encoding="GBK"?&gt;
&lt;!-- 指定Hibernate配置文件的DTD信息 --&gt;
&lt;!DOCTYPE hibernate-configuration PUBLIC
     "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
     "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;
&lt;!-- hibernate-configuration是配置文件的根元素 --&gt;
&lt;hibernate-configuration&gt;
     &lt;session-factory&gt;
           &lt;!-- 指定连接数据库所用的驱动 --&gt;
           &lt;property  name="connection.driver_class"&gt;com.mysql.jdbc.Driver&lt;/property&gt;
           &lt;!-- 指定连接数据库的url，其中hibernate是本应用连接的数据库名 --&gt;
           &lt;property  name="connection.url"&gt;jdbc:mysql://localhost/hibernate&lt;/property&gt;
           &lt;!-- 指定连接数据库的用户名 --&gt;
           &lt;property name="connection.username"&gt;root&lt;/property&gt;
           &lt;!-- 指定连接数据库的密码 --&gt;
           &lt;property name="connection.password"&gt;32147&lt;/property&gt;
           &lt;!-- 指定连接池里最大连接数 --&gt;
           &lt;property  name="hibernate.c3p0.max_size"&gt;20&lt;/property&gt;
           &lt;!-- 指定连接池里最小连接数 --&gt;
           &lt;property name="hibernate.c3p0.min_size"&gt;1&lt;/property&gt;
           &lt;!-- 指定连接池里连接的超时时长 --&gt;
           &lt;property  name="hibernate.c3p0.timeout"&gt;5000&lt;/property&gt;
           &lt;!-- 指定连接池里最大缓存多少个Statement对象 --&gt;
           &lt;property  name="hibernate.c3p0.max_statements"&gt;100&lt;/property&gt;
           &lt;property  name="hibernate.c3p0.idle_test_period"&gt;3000&lt;/property&gt;
           &lt;property  name="hibernate.c3p0.acquire_increment"&gt;2&lt;/property&gt;
           &lt;property  name="hibernate.c3p0.validate"&gt;true&lt;/property&gt;
           &lt;!-- 指定数据库方言 --&gt;
           &lt;property  name="dialect"&gt;org.hibernate.dialect.MySQL5InnoDBDialect&lt;/property&gt;
           &lt;!-- 根据需要自动创建数据库 --&gt;
           &lt;property name="hbm2ddl.auto"&gt;update&lt;/property&gt;
           &lt;!-- 显示Hibernate持久化操作所生成的SQL --&gt;
           &lt;property name="show_sql"&gt;true&lt;/property&gt;
           &lt;!-- 将SQL脚本进行格式化后再输出 --&gt;
           &lt;property name="hibernate.format_sql"&gt;true&lt;/property&gt;
           &lt;!-- 罗列所有持久化类的类名 --&gt;
           &lt;mapping class="org.crazyit.app.domain.Person"/&gt;
           &lt;mapping class="org.crazyit.app.domain.Address"/&gt;
     &lt;/session-factory&gt;
&lt;/hibernate-configuration&gt;</code></pre> 
<p><strong>二 PO</strong></p> 
<p>1 Person</p> 
<pre class="has"><code class="language-java">package org.crazyit.app.domain;

import java.util.*;

import javax.persistence.*;
import org.hibernate.annotations.Cascade;
import org.hibernate.annotations.CascadeType;

@Entity
@Table(name="person_inf")
public class Person
{
    // 标识属性
    @Id @Column(name="person_id")
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    private Integer id;
    private String name;
    private int age;
    // 定义该Person实体关联的Address实体
    @ManyToOne(targetEntity=Address.class)
    // 映射外键列，指定外键列的列名为address_id、不允许为空
    @JoinColumn(name="address_id" , nullable=false)
    @Cascade(CascadeType.ALL)
    private Address address;

    // id的setter和getter方法
    public void setId(Integer id)
    {
        this.id = id;
    }
    public Integer getId()
    {
        return this.id;
    }

    // name的setter和getter方法
    public void setName(String name)
    {
        this.name = name;
    }
    public String getName()
    {
        return this.name;
    }

    // age的setter和getter方法
    public void setAge(int age)
    {
        this.age = age;
    }
    public int getAge()
    {
        return this.age;
    }

    // address的setter和getter方法
    public void setAddress(Address address)
    {
        this.address = address;
    }
    public Address getAddress()
    {
        return this.address;
    }
}</code></pre> 
<p>2 Address</p> 
<pre class="has"><code class="language-java">package org.crazyit.app.domain;

import java.util.*;

import javax.persistence.*;

@Entity
@Table(name="address_inf")
public class Address
{
    // 标识属性
    @Id @Column(name="address_id")
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    private int addressId;
    // 定义地址详细信息的成员变量
    private String addressDetail;
    // 无参数的构造器
    public Address()
    {
    }
    // 初始化全部成员变量的构造器
    public Address(String addressDetail)
    {
        this.addressDetail = addressDetail;
    }

    // addressId的setter和getter方法
    public void setAddressId(int addressId)
    {
        this.addressId = addressId;
    }
    public int getAddressId()
    {
        return this.addressId;
    }

    // addressDetail的setter和getter方法
    public void setAddressDetail(String addressDetail)
    {
        this.addressDetail = addressDetail;
    }
    public String getAddressDetail()
    {
        return this.addressDetail;
    }
}</code></pre> 
<p><strong>三 测试</strong></p> 
<p>1 工具类</p> 
<pre class="has"><code class="language-java">package lee;

import org.hibernate.*;
import org.hibernate.cfg.*;
import org.hibernate.service.*;
import org.hibernate.boot.registry.*;

public class HibernateUtil
{
    public static final SessionFactory sessionFactory;

    static
    {
        try
        {
            // 使用默认的hibernate.cfg.xml配置文件创建Configuration实例
            Configuration cfg = new Configuration()
                .configure();
            // 以Configuration实例来创建SessionFactory实例
            ServiceRegistry serviceRegistry = new StandardServiceRegistryBuilder()
                .applySettings(cfg.getProperties()).build();
            sessionFactory = cfg.buildSessionFactory(serviceRegistry);
        }
        catch (Throwable ex)
        {
            System.err.println("Initial SessionFactory creation failed." + ex);
            throw new ExceptionInInitializerError(ex);
        }
    }

    // ThreadLocal可以隔离多个线程的数据共享，因此不再需要对线程同步
    public static final ThreadLocal&lt;Session&gt; session
        = new ThreadLocal&lt;Session&gt;();

    public static Session currentSession()
        throws HibernateException
    {
        Session s = session.get();
        // 如果该线程还没有Session,则创建一个新的Session
        if (s == null)
        {
            s = sessionFactory.openSession();
            // 将获得的Session变量存储在ThreadLocal变量session里
            session.set(s);
        }
        return s;
    }

    public static void closeSession()
        throws HibernateException
    {
        Session s = session.get();
        if (s != null)
            s.close();
        session.set(null);
    }
}</code></pre> 
<p>2 测试类</p> 
<pre class="has"><code class="language-java">package lee;

import org.hibernate.Transaction;
import org.hibernate.Session;

import java.util.Date;
import java.util.Set;
import java.util.HashSet;

import org.crazyit.app.domain.*;

public class PersonManager
{
    public static void main(String[] args)
    {
        PersonManager mgr = new PersonManager();
        mgr.testCascase();
        HibernateUtil.sessionFactory.close();
    }

private void testCascase()
{
    Session session = HibernateUtil.currentSession();
    Transaction tx = session.beginTransaction();
    // 创建一个Person对象
    Person p = new Person();
    // 创建一个瞬态的Address对象
    Address a = new Address("广州天河");          // ①
    // 设置Person的name为crazyit.org字符串
    p.setName("crazyit.org");
    p.setAge(21);
    // 设置Person和Address之间的关联关系
    p.setAddress(a);
    // 持久化Person对象
    session.persist(p);
    // 创建一个瞬态的Address对象
    Address a2 = new Address("上海虹口");         // ②
    // 修改持久化状态的Person对象
    p.setAddress(a2);                             // ③
    tx.commit();
    HibernateUtil.closeSession();
}


private void testPerson()
{
    Session session = HibernateUtil.currentSession();
    Transaction tx = session.beginTransaction();
    // 创建一个Person对象
    Person p = new Person();
    // 设置Person的name为crazyit字符串
    p.setName("crazyit");
    p.setAge(21);
    // 持久化Person对象(对应于插入主表记录)
    session.save(p);
    // 创建一个瞬态的Address对象
    Address a = new Address("广州天河");        // ①
    // 先设置Person和Address之间的关联关系
    p.setAddress(a);
    // 再持久化Address对象(对应于插入从表记录)
    session.persist(a);
    // 创建一个瞬态的Address对象
    Address a2 = new Address("上海虹口");      // ②
    // 先设置Person和Address之间的关联关系
    p.setAddress(a2);
    // 再持久化Address对象(对应于插入从表记录)
    session.persist(a2);                       // ③
    tx.commit();
    HibernateUtil.closeSession();
}
}</code></pre> 
<p><strong>四 测试结果</strong></p> 
<pre class="has"><code class="language-sql">Hibernate:
    insert
    into
        address_inf
        (addressDetail)
    values
        (?)
Hibernate:
    insert
    into
        person_inf
        (address_id, age, name)
    values
        (?, ?, ?)
Hibernate:
    insert
    into
        address_inf
        (addressDetail)
    values
        (?)
Hibernate:
    update
        person_inf
    set
        address_id=?,
        age=?,
        name=?
    where
        person_id=?</code></pre> 
<p><img alt="" class="has" src="https://images2.imgbox.com/e0/03/GKjYja1L_o.png"></p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/3f/8c/p6Dbvr48_o.png"></p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/75/15/DK1G18Aw_o.png"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/540ce1f5b91fbc0be0e84a9a12ee1cd4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">http状态码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/20b221aede6a046cd57a8657ac74b81c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">仿抖音❤️点赞  双击点赞</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>