<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>BAT批处理：文件批量查找与复制 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="BAT批处理：文件批量查找与复制" />
<meta property="og:description" content="近期因为工作需要，经常要根据文件清单批量查找文件并复制到指定文件夹，手动操作十分繁琐。因此，参考本站文章编写了一个文件批量查找与复制的批处理程序。
参考文章:http://t.csdnimg.cn/aNciG
本文程序的主体代码来自上方参考文章，与其相比增加了手动输入相关参数的功能。
1、程序代码 @echo off setlocal enabledelayedexpansion echo -------------------------------- BEGIN ---------------------------------- rem set parameter here rem dirCopy: 0-file copy, 1-directory copy rem path do not end with backslash rem sourcePath only support one path when use directory copy, multi path(separated by semicolons and make sure all path is exist) is available when use file copy rem eg: rem file copy: rem set sourcePath=C:\Users\Desktop\test 1;C:\Users\Desktop\test2 rem set targetPath=C:\Users\Desktop\target rem set fileList=list." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/cd279725200904b26fcd74ffbedee275/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-26T10:49:38+08:00" />
<meta property="article:modified_time" content="2023-10-26T10:49:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">BAT批处理：文件批量查找与复制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>近期因为工作需要，经常要根据文件清单批量查找文件并复制到指定文件夹，手动操作十分繁琐。因此，参考本站文章编写了一个文件批量查找与复制的批处理程序。</p> 
<p>参考文章:<a href="http://t.csdnimg.cn/aNciG" rel="nofollow" title="http://t.csdnimg.cn/aNciG">http://t.csdnimg.cn/aNciG</a></p> 
<p>本文程序的主体代码来自上方参考文章，与其相比增加了手动输入相关参数的功能。</p> 
<h3>1、程序代码</h3> 
<pre><code class="language-Matlab">@echo off
setlocal enabledelayedexpansion

echo -------------------------------- BEGIN ----------------------------------
 
rem set parameter here
rem dirCopy: 0-file copy, 1-directory copy
rem path do not end with backslash
rem sourcePath only support one path when use directory copy, multi path(separated by semicolons and make sure all path is exist) is available when use file copy
rem eg:
rem     file copy:
rem         set sourcePath=C:\Users\Desktop\test 1;C:\Users\Desktop\test2
rem         set targetPath=C:\Users\Desktop\target
rem         set fileList=list.txt
rem         set dirCopy=0  
rem     directory copy:
rem         set sourcePath=C:\Users\Desktop\test 1
rem         set targetPath=C:\Users\Desktop\target
rem         set fileList=list.txt
rem         set dirCopy=1

set /p sourcePath=Source path:
set /p targetPath=Target path:
set /p fileList=Search file:
set /p dirCopy=Copy type(0-file,1-dir):




rem add double quotes
set before=!sourcePath!
set after=


echo Job running...

:QUOTE_LOOP
for /f "tokens=1* delims=;" %%i in ("!before!") do (
    set after=!after!"%%i";
    if not "%%j"=="" (
        set before=%%j
        goto QUOTE_LOOP
    )
)




rem begin job
set /a copyCount=0
dir /s /b !after!&gt;filelist.txt
if !dirCopy! equ 0 (
    echo Start coping files...
    goto FILE_COPY
)else (
    echo Start coping file dir...
    goto DIR_COPY
)


:FILE_COPY
for /f "delims=" %%i in (!fileList!) do (
    find "\%%i" filelist.txt &gt; findfile.txt
    if !errorlevel! equ 0 (
        for /f "skip=2 delims=" %%j in (findfile.txt) do (
            copy /y "%%j" "!targetPath!\%%~nxj"&gt;nul
            set /a copyCount+=1
        )
    )else (
        echo Can't find file %%i
        echo %%i &gt;&gt; failedfile.txt
    )
)
goto END


:DIR_COPY
for /f "delims=" %%i in (!fileList!) do (
    find "\%%i" filelist.txt &gt; findfile.txt
    if !errorlevel! equ 0 (
        for /f "skip=2 delims=" %%j in (findfile.txt) do (
            set tPath=%%~fj
            set tPath=!tPath:%sourcePath%=!
            echo f | xcopy /y "%%j" "!targetPath!!tPath!"&gt;nul
            set /a copyCount+=1
        )
    )else (
        echo Can't find file: %%i
        echo %%i &gt;&gt; failedfile.txt
    )
)
goto END



:END


del filelist.txt
del findfile.txt

echo Copy file success: !copyCount!
echo --------------------------------  END  ----------------------------------


pause</code></pre> 
<h3>2、操作指南</h3> 
<ol><li>将上方代码复制至txt文件，将txt文件的后缀修改为BAT并保存。本文程序文件以“文件批量查找与复制 - 手动输入版.BAT”命名。</li><li>新建BATCopyFiles文件夹用来当做程序的操作空间，包含以下文件（夹）：source文件夹、target文件夹、list.txt、文件批量查找与复制 - 手动输入版.BAT。 
  <table border="1" cellpadding="1" cellspacing="1" style="width:535px;"><tbody><tr><td style="width:158px;">source文件夹</td><td style="width:375px;">用来存放需要用于查找的文件库</td></tr><tr><td style="width:158px;">target文件夹</td><td style="width:375px;">用来复制、存放查找成功的文件</td></tr><tr><td style="width:158px;">list.txt</td><td style="width:375px;">内容为需要查找复制的文件清单，内容以换行区分，文件名可不包含后缀</td></tr><tr><td style="width:158px;">文件批量查找与复制 - 手动输入版.BAT</td><td style="width:375px;">内容为程序代码</td></tr></tbody></table><strong><span style="color:#fe2c24;">注意：文件夹路径不能包含中文！！！</span></strong><img alt="" height="199" src="https://images2.imgbox.com/fa/74/gM1BXz2K_o.png" width="334"></li><li>双击“文件批量查找与复制 - 手动输入版.BAT”运行程序，依次输入参数。 
  <table border="1" cellpadding="1" cellspacing="1" style="width:500px;"><tbody><tr><td style="width:160px;">Source path:</td><td style="width:71px;">source</td><td style="width:276px;">源文件夹，可填其他文件夹的绝对路径</td></tr><tr><td style="width:160px;">Target path:</td><td style="width:71px;">target</td><td style="width:276px;">目标文件夹，可填其他文件夹的绝对路径</td></tr><tr><td style="width:160px;">Search file:</td><td style="width:71px;">list.txt</td><td style="width:276px;">文件清单</td></tr><tr><td style="width:160px;">Copy type(0-file,1-dir):</td><td style="width:71px;">0/1</td><td style="width:276px;">复制类型：0-文件，1-文件及完整路径</td></tr></tbody></table><p><img alt="" height="441" src="https://images2.imgbox.com/df/af/c6O0l5Sw_o.png" width="675"></p> </li><li> <p>查看输出结果。</p> 查询成功的文件将会被复制至target文件夹；查询失败的文件将会被记录在自动生成的failedfile.txt文件中。</li></ol> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/29e1beb998cb7f350eddbd484c95cd88/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Linux Screen命令】Linux用户注销后可长时间运行的命令行</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1a63bceeaf8e7d7c0f2696d67b6595d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">“淘宝” 开放平台接口设计思路|开放平台接口接入流程教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>