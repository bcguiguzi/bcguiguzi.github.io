<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>一文搞懂Base64编码原理 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="一文搞懂Base64编码原理" />
<meta property="og:description" content="Base64是最常见的用于传输8Bit字节码的编码方式之一，它是一种基于64个可打印字符来表示二进制数据的方法。
Base64是什么 Base64编码，是由64个字符组成编码集：26个大写字母AZ，26个小写字母az，10个数字0~9，符号“&#43;”与符号“/”。Base64编码的基本思路是将原始数据的三个字节拆分转化为四个字节，然后根据Base64的对应表，得到对应的编码数据。
当原始数据凑不够三个字节时，编码结果中会使用额外的**符号“=”**来表示这种情况。
Base64编码表 码值字符码值字符码值字符码值字符0A16Q32g48w1B17R33h49x2C18S34i50y3D19T35j51z4E20U36k5205F21V37l5316G22W38m5427H23X39n5538I24Y40o5649J25Z41p57510K26a42q58611L27b43r59712M28c44s60813N29d45t61914O30e46u62&#43;15P31f47v63/ Base64编码步骤 将原始数据按照每三个字节作为一组进行划分，每组一共是24个二进制位。再将这24个二进制位，每6个一划分，分为四组（6×4=24个二进制位）。然后在每组前面补上00，扩展成8×4=32个二进制位，即四个字节（因为每个字节前面有2个0，所以每个字节的最大值是63）。最后根据Base64编码表，将这四个字节的码值，转换为对应的Base64的字符即可。 Base64编码过程举例 情况1：正常的3个字节编码 将单词“PCB”转换为Base64编码：
“P”、“C”、&#34;B&#34;的ASCII值分别是80、67、66，对应的二进制值是0101 0000、0100 0011、0100 0010，将它们连成一个24位的二进制字符串010100000100001101000010。
将这个24位的二进制字符串，每6个一组分成4组：010100、000100、001101、000010。
在每组前面加两个00，扩展成32个二进制位，即四个字节：00010100、00000100、00001101、00000010。它们的十进制值分别是19、22、5、46。(最前面加上两个0只是为了凑成一个字节，实际上其本身的数值是没有变化的)
根据上表，得到每个值对应Base64编码，即U、E、N、C。
情况2：剩余2个字节编码 对于2个字节（16个二进制数）的情况，比如将“PC”转换为Base64编码：
转换方法同上，区别在于：
16个二进制数，每6个一组分割，最后剩余4个，这时再在后面补两个0凑成6个。然后还按照基础的方法转换，最后补一个“=”即可 转换过程如下表，最终将“PC”转换为了“UEM=”
情况3：剩余1个字节编码 对于12个字节（8个二进制数）的情况，比如将“P”转换为Base64编码：
转换方法同上，区别在于：
16个二进制数，每6个一组分割，最后剩余2个，后面要再补4个0然后还按照基础的方法转换，最后补两个“=”即可 转换过程如下表，最终将“P”转换为了“UA==”
Base64编解码C程序 编码程序 编码的程序设计思路，就是按照上面讲解的编码过程，每3个原始字符为一组，进行编码，得到4个base64的字符。对于不够3个字符的情况，编码的base64的字符后面补上一到两个=号。
#include &lt;stdio.h&gt; #include &lt;string.h&gt; /*base64符号表*/ const char *base64Arr = &#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#43;/&#34;; /*base64增补符号*/ const char paddingChar = &#39;=&#39;; /** @func: base64_encode * @brief: base64编码 * @para: [srcData]:要进行编码的原始数据 * [resBase64]:base64编码结果 * @return:none */ void base64_encode(const unsigned char * srcData, char * resBase64) { int i=0; /*原始数据索引*/ int j=0; /*base64结果索引*/ unsigned char transIdx=0; // 索引是8位，但是高两位都为0 const int srcLen = strlen((const char*)srcData); /*每3个一组，进行编码*/ for(i=0; i &lt; srcLen; i&#43;=3) { /*取出第1个字符的高6位*/ transIdx = ((srcData[i] &gt;&gt; 2) &amp; 0x3f); /*0011 1111*/ /*查表*/ resBase64[j&#43;&#43;] = base64Arr[(int)transIdx]; /*取出第1个字符的低2位*/ transIdx = ((srcData[i] &lt;&lt; 4) &amp; 0x30); /*0011 0000*/ /*第1个字符后面还有字符*/ if (i &#43; 1 &lt; srcLen) { /*取出第2个字符的高4位，并与第1个字符的低2位进行组合*/ transIdx |= ((srcData[i &#43; 1] &gt;&gt; 4) &amp; 0x0f); /*0000 1111*/ /*查表*/ resBase64[j&#43;&#43;] = base64Arr[(int)transIdx]; } else /*第1个字符后面没有字符了*/ { /*直接使用第1个字符的低2位查表*/ resBase64[j&#43;&#43;] = base64Arr[(int)transIdx]; /*然后补上两个=号*/ resBase64[j&#43;&#43;] = paddingChar; resBase64[j&#43;&#43;] = paddingChar; break; /*没有数据了，break结束*/ } /*取出第2个字符的低4位*/ transIdx = ((srcData[i &#43; 1] &lt;&lt; 2) &amp; 0x3c); /*0011 1100*/ /*第2个字符后面还有字符*/ if (i &#43; 2 &lt; srcLen) { /*取出第3个字符的高2位，并与第2个字符的低4位进行组合*/ transIdx |= ((srcData[i &#43; 2] &gt;&gt; 6) &amp; 0x03); /*0000 0011*/ /*查表*/ resBase64[j&#43;&#43;] = base64Arr[(int)transIdx]; /*取出第3个字符的低6位*/ transIdx = srcData[i &#43; 2] &amp; 0x3f; /*0011 1111*/ /*查表*/ resBase64[j&#43;&#43;] = base64Arr[(int)transIdx]; } else /*第2个字符后面没有字符了*/ { /*直接使用第2个字符的低4位查表*/ resBase64[j&#43;&#43;] = base64Arr[(int)transIdx]; /*然后补上一个=号*/ resBase64[j&#43;&#43;] = paddingChar; break; /*没有数据了，break结束*/ } } /*结束符*/ resBase64[j] = &#39;\0&#39;; } 解码程序 解码的程序设计思路，其实就是编码的反过程，把要解码的base64符号，每4个为一组，译码成3个字符。对于最后出现的=的情况，就说明是要结束了，直接使用剩余的base64符号进行译码，然后就结束了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/5d93739832c78b6b780e99823d0045b3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-06T22:14:04+08:00" />
<meta property="article:modified_time" content="2021-07-06T22:14:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">一文搞懂Base64编码原理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>Base64是最常见的用于传输8Bit字节码的编码方式之一，它是一种基于64个可打印字符来表示二进制数据的方法。</p> 
<h2><a id="Base64_4"></a>Base64是什么</h2> 
<p>Base64编码，是由64个字符组成编码集：<strong>26个大写字母A<sub>Z，26个小写字母a</sub>z，10个数字0~9，符号“+”与符号“/”</strong>。Base64编码的基本思路是<strong>将原始数据的三个字节拆分转化为四个字节</strong>，然后根据Base64的对应表，得到对应的编码数据。</p> 
<p>当原始数据凑不够三个字节时，编码结果中会使用额外的**符号“=”**来表示这种情况。</p> 
<h3><a id="Base64_10"></a>Base64编码表</h3> 
<table><thead><tr><th>码值</th><th>字符</th><th>码值</th><th>字符</th><th>码值</th><th>字符</th><th>码值</th><th>字符</th></tr></thead><tbody><tr><td><strong>0</strong></td><td><strong>A</strong></td><td>16</td><td>Q</td><td>32</td><td>g</td><td>48</td><td>w</td></tr><tr><td>1</td><td>B</td><td>17</td><td>R</td><td>33</td><td>h</td><td>49</td><td>x</td></tr><tr><td>2</td><td>C</td><td>18</td><td>S</td><td>34</td><td>i</td><td>50</td><td>y</td></tr><tr><td>3</td><td>D</td><td>19</td><td>T</td><td>35</td><td>j</td><td>51</td><td>z</td></tr><tr><td>4</td><td>E</td><td>20</td><td>U</td><td>36</td><td>k</td><td><strong>52</strong></td><td><strong>0</strong></td></tr><tr><td>5</td><td>F</td><td>21</td><td>V</td><td>37</td><td>l</td><td>53</td><td>1</td></tr><tr><td>6</td><td>G</td><td>22</td><td>W</td><td>38</td><td>m</td><td>54</td><td>2</td></tr><tr><td>7</td><td>H</td><td>23</td><td>X</td><td>39</td><td>n</td><td>55</td><td>3</td></tr><tr><td>8</td><td>I</td><td>24</td><td>Y</td><td>40</td><td>o</td><td>56</td><td>4</td></tr><tr><td>9</td><td>J</td><td>25</td><td>Z</td><td>41</td><td>p</td><td>57</td><td>5</td></tr><tr><td>10</td><td>K</td><td><strong>26</strong></td><td><strong>a</strong></td><td>42</td><td>q</td><td>58</td><td>6</td></tr><tr><td>11</td><td>L</td><td>27</td><td>b</td><td>43</td><td>r</td><td>59</td><td>7</td></tr><tr><td>12</td><td>M</td><td>28</td><td>c</td><td>44</td><td>s</td><td>60</td><td>8</td></tr><tr><td>13</td><td>N</td><td>29</td><td>d</td><td>45</td><td>t</td><td>61</td><td>9</td></tr><tr><td>14</td><td>O</td><td>30</td><td>e</td><td>46</td><td>u</td><td><strong>62</strong></td><td><strong>+</strong></td></tr><tr><td>15</td><td>P</td><td>31</td><td>f</td><td>47</td><td>v</td><td><strong>63</strong></td><td><strong>/</strong></td></tr></tbody></table> 
<h3><a id="Base64_31"></a>Base64编码步骤</h3> 
<ul><li>将原始数据按照每三个字节作为一组进行划分，每组一共是24个二进制位。</li><li>再将这24个二进制位，每6个一划分，分为四组（6×4=24个二进制位）。</li><li>然后在每组前面补上00，扩展成8×4=32个二进制位，即四个字节（因为每个字节前面有2个0，所以每个字节的最大值是63）。</li><li>最后根据Base64编码表，将这四个字节的码值，转换为对应的Base64的字符即可。</li></ul> 
<h2><a id="Base64_40"></a>Base64编码过程举例</h2> 
<h3><a id="13_42"></a>情况1：正常的3个字节编码</h3> 
<p>将单词“PCB”转换为Base64编码：</p> 
<ul><li> <p>“P”、“C”、"B"的ASCII值分别是80、67、66，对应的二进制值是0101 0000、0100 0011、0100 0010，将它们连成一个24位的二进制字符串010100000100001101000010。</p> </li><li> <p>将这个24位的二进制字符串，每6个一组分成4组：010100、000100、001101、000010。</p> </li><li> <p>在每组前面加两个00，扩展成32个二进制位，即四个字节：00010100、00000100、00001101、00000010。它们的十进制值分别是19、22、5、46。(最前面加上两个0只是为了凑成一个字节，实际上其本身的数值是没有变化的)</p> </li><li> <p>根据上表，得到每个值对应Base64编码，即U、E、N、C。</p> </li></ul> 
<p><img src="https://images2.imgbox.com/d1/94/35pMaUFz_o.png" alt=""></p> 
<h3><a id="22_56"></a>情况2：剩余2个字节编码</h3> 
<p>对于2个字节（16个二进制数）的情况，比如将“PC”转换为Base64编码：</p> 
<p>转换方法同上，区别在于：</p> 
<ul><li>16个二进制数，每6个一组分割，最后剩余4个，这时再在后面补两个0凑成6个。</li><li>然后还按照基础的方法转换，最后补一个“=”即可</li></ul> 
<p>转换过程如下表，最终将“PC”转换为了“UEM=”</p> 
<p><img src="https://images2.imgbox.com/ce/77/fOjv1nRW_o.png" alt=""></p> 
<h3><a id="31_69"></a>情况3：剩余1个字节编码</h3> 
<p>对于12个字节（8个二进制数）的情况，比如将“P”转换为Base64编码：</p> 
<p>转换方法同上，区别在于：</p> 
<ul><li>16个二进制数，每6个一组分割，最后剩余2个，后面要再补4个0</li><li>然后还按照基础的方法转换，最后补两个“=”即可</li></ul> 
<p>转换过程如下表，最终将“P”转换为了“UA==”</p> 
<p><img src="https://images2.imgbox.com/3a/6a/MXBERxMh_o.png" alt=""></p> 
<h2><a id="Base64C_82"></a>Base64编解码C程序</h2> 
<h3><a id="_84"></a>编码程序</h3> 
<p>编码的程序设计思路，就是按照上面讲解的编码过程，每3个原始字符为一组，进行编码，得到4个base64的字符。对于不够3个字符的情况，编码的base64的字符后面补上一到两个<code>=</code>号。</p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token comment">/*base64符号表*/</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>base64Arr <span class="token operator">=</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span><span class="token punctuation">;</span>
<span class="token comment">/*base64增补符号*/</span> 
<span class="token keyword">const</span> <span class="token keyword">char</span> paddingChar <span class="token operator">=</span> <span class="token string">'='</span><span class="token punctuation">;</span>

<span class="token comment">/** @func:  base64_encode
*   @brief: base64编码 
*   @para:  [srcData]:要进行编码的原始数据
*           [resBase64]:base64编码结果 
*   @return:none
*/</span>
<span class="token keyword">void</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span> srcData<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> resBase64<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*原始数据索引*/</span> 
	<span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*base64结果索引*/</span> 
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> transIdx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// 索引是8位，但是高两位都为0</span>
    <span class="token keyword">const</span> <span class="token keyword">int</span> srcLen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>srcData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/*每3个一组，进行编码*/</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> srcLen<span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{<!-- --></span>
        <span class="token comment">/*取出第1个字符的高6位*/</span> 
        transIdx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>srcData<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*0011 1111*/</span>
        <span class="token comment">/*查表*/</span> 
        resBase64<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> base64Arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>transIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">/*取出第1个字符的低2位*/</span> 
        transIdx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>srcData<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*0011 0000*/</span>
        
        <span class="token comment">/*第1个字符后面还有字符*/</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> srcLen<span class="token punctuation">)</span> 
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">/*取出第2个字符的高4位，并与第1个字符的低2位进行组合*/</span> 
            transIdx <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>srcData<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*0000 1111*/</span>
            <span class="token comment">/*查表*/</span> 
            resBase64<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> base64Arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>transIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token comment">/*第1个字符后面没有字符了*/</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">/*直接使用第1个字符的低2位查表*/</span>
            resBase64<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> base64Arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>transIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
            
            <span class="token comment">/*然后补上两个=号*/</span> 
            resBase64<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> paddingChar<span class="token punctuation">;</span>
            resBase64<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> paddingChar<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>   <span class="token comment">/*没有数据了，break结束*/</span> 
        <span class="token punctuation">}</span>
        
        <span class="token comment">/*取出第2个字符的低4位*/</span> 
        transIdx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>srcData<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3c</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*0011 1100*/</span>
        
        <span class="token comment">/*第2个字符后面还有字符*/</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">&lt;</span> srcLen<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span> 
		    <span class="token comment">/*取出第3个字符的高2位，并与第2个字符的低4位进行组合*/</span> 
            transIdx <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>srcData<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/*0000 0011*/</span>
            <span class="token comment">/*查表*/</span> 
            resBase64<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> base64Arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>transIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
            
            <span class="token comment">/*取出第3个字符的低6位*/</span> 
            transIdx <span class="token operator">=</span> srcData<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">;</span> <span class="token comment">/*0011 1111*/</span> 
            <span class="token comment">/*查表*/</span> 
            resBase64<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> base64Arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>transIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token comment">/*第2个字符后面没有字符了*/</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">/*直接使用第2个字符的低4位查表*/</span>
            resBase64<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> base64Arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>transIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
            
            <span class="token comment">/*然后补上一个=号*/</span> 
            resBase64<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> paddingChar<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>  <span class="token comment">/*没有数据了，break结束*/</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/*结束符*/</span> 
    resBase64<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_174"></a>解码程序</h3> 
<p>解码的程序设计思路，其实就是编码的反过程，把要解码的base64符号，每4个为一组，译码成3个字符。对于最后出现的<code>=</code>的情况，就说明是要结束了，直接使用剩余的base64符号进行译码，然后就结束了。</p> 
<pre><code class="prism language-c"><span class="token comment">/** @func:  idx_in_base64Arr
*   @brief: 在base64符号表中查找字符c对应的索引值
*   @para:  [c]:要查找的字符
*   @return:字符c在base64符号表中对应的索引值(0~63) 
*/</span>
<span class="token keyword">int</span> <span class="token function">idx_in_base64Arr</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*在base64表中搜索第一次出现字符c的位置*/</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pIdx <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>base64Arr<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> pIdx<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">/*找不到对应的base64字符，说明输入的base64字符串有误*/</span> 
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/*返回字符c在base64表中的位置*/</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>pIdx <span class="token operator">-</span> base64Arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>   

<span class="token comment">/** @func:  base64_decode
*   @brief: base64解码 
*   @para:  [srcBase64]:要进行解码的原始base64数据
*           [resData]:解码出的结果 
*   @return:none
*/</span>
<span class="token keyword">void</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>srcBase64<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>resData<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*原始base64数据索引*/</span> 
	<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/*解码后的结果数据索引*/</span> 
    <span class="token keyword">int</span> trans<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">/*4个base64符号对应的表中的位置（0~63的数字）转换值*/</span> 
    
    <span class="token comment">/*base64符号每4个一组，译码成3个字符*/</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> srcBase64<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'\0'</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">/*------译码第1个字符------*/</span>
		<span class="token comment">/*前2个base64符号在表中的位置（0~63的数字）*/</span>
        trans<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">idx_in_base64Arr</span><span class="token punctuation">(</span>srcBase64<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        trans<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">idx_in_base64Arr</span><span class="token punctuation">(</span>srcBase64<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
		<span class="token comment">/*第1个符号的后6位，与第2个符号的6、5位，译出第1个字符*/</span> 
        resData<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>trans<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xfc</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>trans<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*1111 1100   0000 0011 */</span> 

        <span class="token comment">/*------译码第2个字符------*/</span>  
        <span class="token comment">/*第3个base64符号是否是=号*/</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>srcBase64<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'='</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">/*第3个base64符号在表中的位置（0~63的数字）*/</span>
            trans<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">idx_in_base64Arr</span><span class="token punctuation">(</span>srcBase64<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
            <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">/*没有数据了，break结束*/</span> 
        <span class="token punctuation">}</span>
        <span class="token comment">/*第2个符号的后4位，与第3个符号的6、5、4、3位，译出第2个字符*/</span> 
        resData<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>trans<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf0</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>trans<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*1111 0000  0000 1111*/</span>
  
        <span class="token comment">/*------译码第3个字符------*/</span>
        <span class="token comment">/*第4个base64符号是否是=号*/</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>srcBase64<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'='</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">/*第4个base64符号在表中的位置（0~63的数字）*/</span>
			trans<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">idx_in_base64Arr</span><span class="token punctuation">(</span>srcBase64<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
            <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">/*没有数据了，break结束*/</span> 
        <span class="token punctuation">}</span>
        <span class="token comment">/*第3个符号的后2位，与第4个符号的后6位，译出第3个字符*/</span> 
        resData<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>trans<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xc0</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>trans<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*1100 0000   0011 1111*/</span> 
    <span class="token punctuation">}</span>
  
    <span class="token comment">/*结束符*/</span> 
    resData<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_257"></a>测试程序</h3> 
<p>使用字符串“PCB”进行base64编码测试，然后再将编码得到的结果，进行解码测试。</p> 
<pre><code class="prism language-c"><span class="token comment">/*测试*/</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*定义要进行base64编码的字符串*/</span> 
    <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>srcData <span class="token operator">=</span> <span class="token string">"PCB"</span> <span class="token punctuation">;</span>
    
    <span class="token comment">/*先测试编码*/</span>
    <span class="token keyword">char</span> base64<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">base64_encode</span><span class="token punctuation">(</span>srcData<span class="token punctuation">,</span> base64<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"base64编码：%s\n"</span><span class="token punctuation">,</span>base64<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*再测试解码*/</span> 
    <span class="token keyword">char</span> resData<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">base64_decode</span><span class="token punctuation">(</span>base64<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>resData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"base64解码：%s"</span><span class="token punctuation">,</span> resData<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>输出结果如下，可以看出，“PCB”进行base64编码，得到了“UENC”，然后再反向解码，又得到了“PCB”</p> 
<pre><code>base64编码：UENC
base64解码：PCB
--------------------------------
Process exited after 0.01123 seconds with return value 0
请按任意键继续. . .
</code></pre> 
<p>完整程序可从我的gitee仓库下载：<br> <a href="https://gitee.com/xxpcb/c-test/tree/master/C-Base64-Test" rel="nofollow">https://gitee.com/xxpcb/c-test/tree/master/C-Base64-Test</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ef8b22b22a074cae383249c1e16dd955/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">什么是B&#43;树？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e9487cf8bcff3e6614d1939aacbaa120/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数字转中文大写</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>