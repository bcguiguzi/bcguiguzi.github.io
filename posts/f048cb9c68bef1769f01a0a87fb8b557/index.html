<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql笔记：16. InnoDB存储引擎 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql笔记：16. InnoDB存储引擎" />
<meta property="og:description" content="文章目录 一、InnoDB的存储结构1. 逻辑存储结构1.1. 表空间1.2. 段1.3. 区1.4. 页1.5. 行 2. 物理存储结构2.1 数据文件2.2. 重做日志文件2.3. 撤销日志文件2.4. 参数文件2.5. 错误日志2.6. 二进制日志2.7. 慢查询日志2.8. 全量日志2.9. 中继日志2.10. PID文件2.11. Socket文件2.12. 表结构文件 二、InnoDB的内存结构1. SGA与PGA中的缓冲区2. Buffer缓冲区的状态3. 内存的刷新机制3.1 MySQL检查点的类型3.2 MySQL的模糊检查点 三、InnoDB的线程结构1. 主线程结构2. I/O线程结构3. 其他线程结构 InnoDB是MySQL默认的存储引擎，它主要由三部分组成，分别是存储结构、内存结构和线程结构。 一、InnoDB的存储结构 1. 逻辑存储结构 InnoDB存储引擎的逻辑存储结构和Oracle大致相同，所有创建的表都存放在一个空间中，称为表空间（tablespace）。表空间又由段（segment）、区（extend）、页（page）组成。InnoDB存储引擎的逻辑存储结构如下：
page extend segment tablespace row trx id roll pointer roll pointer col 1 col 2 ... col n row row ... row page 1 page 2 page ... page 64 extend extend ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/f048cb9c68bef1769f01a0a87fb8b557/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-13T16:29:22+08:00" />
<meta property="article:modified_time" content="2024-03-13T16:29:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql笔记：16. InnoDB存储引擎</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#InnoDB_2" rel="nofollow">一、InnoDB的存储结构</a></li><li><ul><li><a href="#1__3" rel="nofollow">1. 逻辑存储结构</a></li><li><ul><li><a href="#11__45" rel="nofollow">1.1. 表空间</a></li><li><a href="#12__55" rel="nofollow">1.2. 段</a></li><li><a href="#13__59" rel="nofollow">1.3. 区</a></li><li><a href="#14__61" rel="nofollow">1.4. 页</a></li><li><a href="#15__76" rel="nofollow">1.5. 行</a></li></ul> 
   </li><li><a href="#2__78" rel="nofollow">2. 物理存储结构</a></li><li><ul><li><a href="#21__80" rel="nofollow">2.1 数据文件</a></li><li><a href="#22__83" rel="nofollow">2.2. 重做日志文件</a></li><li><a href="#23__94" rel="nofollow">2.3. 撤销日志文件</a></li><li><a href="#24__97" rel="nofollow">2.4. 参数文件</a></li><li><a href="#25__107" rel="nofollow">2.5. 错误日志</a></li><li><a href="#26__112" rel="nofollow">2.6. 二进制日志</a></li><li><a href="#27__133" rel="nofollow">2.7. 慢查询日志</a></li><li><a href="#28__150" rel="nofollow">2.8. 全量日志</a></li><li><a href="#29__159" rel="nofollow">2.9. 中继日志</a></li><li><a href="#210_PID_167" rel="nofollow">2.10. PID文件</a></li><li><a href="#211_Socket_172" rel="nofollow">2.11. Socket文件</a></li><li><a href="#212__179" rel="nofollow">2.12. 表结构文件</a></li></ul> 
  </li></ul> 
  </li><li><a href="#InnoDB_182" rel="nofollow">二、InnoDB的内存结构</a></li><li><ul><li><a href="#1_SGAPGA_187" rel="nofollow">1. SGA与PGA中的缓冲区</a></li><li><a href="#2_Buffer_200" rel="nofollow">2. Buffer缓冲区的状态</a></li><li><a href="#3__213" rel="nofollow">3. 内存的刷新机制</a></li><li><ul><li><a href="#31_MySQL_214" rel="nofollow">3.1 MySQL检查点的类型</a></li><li><a href="#32_MySQL_220" rel="nofollow">3.2 MySQL的模糊检查点</a></li></ul> 
  </li></ul> 
  </li><li><a href="#InnoDB_229" rel="nofollow">三、InnoDB的线程结构</a></li><li><ul><li><a href="#1__231" rel="nofollow">1. 主线程结构</a></li><li><a href="#2_IO_238" rel="nofollow">2. I/O线程结构</a></li><li><a href="#3__250" rel="nofollow">3. 其他线程结构</a></li></ul> 
 </li></ul> 
</div> 
<br> InnoDB是MySQL默认的存储引擎，它主要由三部分组成，分别是存储结构、内存结构和线程结构。 
<p></p> 
<h2><a id="InnoDB_2"></a>一、InnoDB的存储结构</h2> 
<h3><a id="1__3"></a>1. 逻辑存储结构</h3> 
<p>InnoDB存储引擎的逻辑存储结构和Oracle大致相同，所有创建的表都存放在一个空间中，称为表空间（tablespace）。表空间又由段（segment）、区（extend）、页（page）组成。InnoDB存储引擎的逻辑存储结构如下：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-TP4c623FZUG3JJA9" width="920.0078125" xmlns="http://www.w3.org/2000/svg" height="673" viewbox="0 0 920.0078125 673" class="mermaid-svg"> 
  <style>#mermaid-svg-TP4c623FZUG3JJA9 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-TP4c623FZUG3JJA9 .error-icon{fill:#552222;}#mermaid-svg-TP4c623FZUG3JJA9 .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-TP4c623FZUG3JJA9 .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-TP4c623FZUG3JJA9 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-TP4c623FZUG3JJA9 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-TP4c623FZUG3JJA9 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-TP4c623FZUG3JJA9 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-TP4c623FZUG3JJA9 .marker{fill:#333333;stroke:#333333;}#mermaid-svg-TP4c623FZUG3JJA9 .marker.cross{stroke:#333333;}#mermaid-svg-TP4c623FZUG3JJA9 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-TP4c623FZUG3JJA9 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-TP4c623FZUG3JJA9 .cluster-label text{fill:#333;}#mermaid-svg-TP4c623FZUG3JJA9 .cluster-label span{color:#333;}#mermaid-svg-TP4c623FZUG3JJA9 .label text,#mermaid-svg-TP4c623FZUG3JJA9 span{fill:#333;color:#333;}#mermaid-svg-TP4c623FZUG3JJA9 .node rect,#mermaid-svg-TP4c623FZUG3JJA9 .node circle,#mermaid-svg-TP4c623FZUG3JJA9 .node ellipse,#mermaid-svg-TP4c623FZUG3JJA9 .node polygon,#mermaid-svg-TP4c623FZUG3JJA9 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-TP4c623FZUG3JJA9 .node .label{text-align:center;}#mermaid-svg-TP4c623FZUG3JJA9 .node.clickable{cursor:pointer;}#mermaid-svg-TP4c623FZUG3JJA9 .arrowheadPath{fill:#333333;}#mermaid-svg-TP4c623FZUG3JJA9 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-TP4c623FZUG3JJA9 .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-TP4c623FZUG3JJA9 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-TP4c623FZUG3JJA9 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-TP4c623FZUG3JJA9 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-TP4c623FZUG3JJA9 .cluster text{fill:#333;}#mermaid-svg-TP4c623FZUG3JJA9 .cluster span{color:#333;}#mermaid-svg-TP4c623FZUG3JJA9 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-TP4c623FZUG3JJA9 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"> 
     <g class="cluster default" id="page"> 
      <rect style="" rx="0" ry="0" x="623.640625" y="281" width="91.7109375" height="384"></rect> 
      <g class="cluster-label" transform="translate(652.45703125, 286)"> 
       <foreignobject width="34.078125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">page</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="cluster default" id="extend"> 
      <rect style="" rx="0" ry="0" x="452.1171875" y="281" width="121.5234375" height="384"></rect> 
      <g class="cluster-label" transform="translate(488.14453125, 286)"> 
       <foreignobject width="49.46875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">extend</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="cluster default" id="segment"> 
      <rect style="" rx="0" ry="0" x="287.6484375" y="281" width="114.46875" height="384"></rect> 
      <g class="cluster-label" transform="translate(314.71875, 286)"> 
       <foreignobject width="60.328125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">segment</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="cluster default" id="tablespace"> 
      <rect style="" rx="0" ry="0" x="8" y="281" width="229.6484375" height="293"></rect> 
      <g class="cluster-label" transform="translate(84.046875, 286)"> 
       <foreignobject width="77.5546875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">tablespace</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="edgePaths"> 
     <path d="M196.67578125,336.5L203.50455729166666,336.5C210.33333333333334,336.5,223.99088541666666,336.5,234.986328125,336.5C245.98177083333334,336.5,254.31510416666666,336.5,262.6484375,336.5C270.9817708333333,336.5,279.3151041666667,336.5,283.4817708333333,336.5L287.6484375,336.5" id="L-a1-segment-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-a1 LE-segment" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M377.1171875,336.5L381.2838541666667,336.5C385.4505208333333,336.5,393.7838541666667,336.5,402.1171875,336.5C410.4505208333333,336.5,418.7838541666667,336.5,427.1171875,336.5C435.4505208333333,336.5,443.7838541666667,336.5,447.9505208333333,336.5L452.1171875,336.5" id="L-b1-extend-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b1 LE-extend" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M544.0234375,336.5L548.9596354166666,336.5C553.8958333333334,336.5,563.7682291666666,336.5,572.87109375,336.5C581.9739583333334,336.5,590.3072916666666,336.5,598.640625,336.5C606.9739583333334,336.5,615.3072916666666,336.5,619.4739583333334,336.5L623.640625,336.5" id="L-c1-page-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c1 LE-page" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M690.3515625,336.5L694.5182291666666,336.5C698.6848958333334,336.5,707.0182291666666,336.5,715.3515625,336.5C723.6848958333334,336.5,732.0182291666666,336.5,740.3515625,336.5C748.6848958333334,336.5,757.0182291666666,336.5,761.1848958333334,336.5L765.3515625,336.5" id="L-d1-row-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-d1 LE-row" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="root" transform="translate(757.8515625, 0)"> 
      <g class="clusters"> 
       <g class="cluster default" id="row"> 
        <rect style="" rx="0" ry="0" x="8" y="8" width="146.15625" height="657"></rect> 
        <g class="cluster-label" transform="translate(67.72265625, 13)"> 
         <foreignobject width="26.7109375" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">row</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
      <g class="edgePaths"></g> 
      <g class="edgeLabels"></g> 
      <g class="nodes"> 
       <g class="node default default" id="flowchart-e1-4855" transform="translate(81.078125, 63.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-26.9375" y="-20.5" width="53.875" height="41"></rect> 
        <g class="label" style="" transform="translate(-19.4375, -13)"> 
         <foreignobject width="38.875" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">trx id</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-e2-4856" transform="translate(81.078125, 154.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-48.078125" y="-20.5" width="96.15625" height="41"></rect> 
        <g class="label" style="" transform="translate(-40.578125, -13)"> 
         <foreignobject width="81.15625" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">roll pointer</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-e3-4857" transform="translate(81.078125, 245.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-48.078125" y="-20.5" width="96.15625" height="41"></rect> 
        <g class="label" style="" transform="translate(-40.578125, -13)"> 
         <foreignobject width="81.15625" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">roll pointer</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-e4-4858" transform="translate(81.078125, 336.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-24.71875" y="-20.5" width="49.4375" height="41"></rect> 
        <g class="label" style="" transform="translate(-17.21875, -13)"> 
         <foreignobject width="34.4375" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">col 1</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-e5-4859" transform="translate(81.078125, 427.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-24.71875" y="-20.5" width="49.4375" height="41"></rect> 
        <g class="label" style="" transform="translate(-17.21875, -13)"> 
         <foreignobject width="34.4375" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">col 2</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-e6-4860" transform="translate(81.078125, 518.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-16.3125" y="-20.5" width="32.625" height="41"></rect> 
        <g class="label" style="" transform="translate(-8.8125, -13)"> 
         <foreignobject width="17.625" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">...</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-e7-4861" transform="translate(81.078125, 609.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-24.89453125" y="-20.5" width="49.7890625" height="41"></rect> 
        <g class="label" style="" transform="translate(-17.39453125, -13)"> 
         <foreignobject width="34.7890625" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">col n</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-d1-4851" transform="translate(669.49609375, 336.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-20.85546875" y="-20.5" width="41.7109375" height="41"></rect> 
      <g class="label" style="" transform="translate(-13.35546875, -13)"> 
       <foreignobject width="26.7109375" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">row</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-d2-4852" transform="translate(669.49609375, 427.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-20.85546875" y="-20.5" width="41.7109375" height="41"></rect> 
      <g class="label" style="" transform="translate(-13.35546875, -13)"> 
       <foreignobject width="26.7109375" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">row</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-d3-4853" transform="translate(669.49609375, 518.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-16.3125" y="-20.5" width="32.625" height="41"></rect> 
      <g class="label" style="" transform="translate(-8.8125, -13)"> 
       <foreignobject width="17.625" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">...</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-d4-4854" transform="translate(669.49609375, 609.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-20.85546875" y="-20.5" width="41.7109375" height="41"></rect> 
      <g class="label" style="" transform="translate(-13.35546875, -13)"> 
       <foreignobject width="26.7109375" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">row</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-c1-4847" transform="translate(512.87890625, 336.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-31.14453125" y="-20.5" width="62.2890625" height="41"></rect> 
      <g class="label" style="" transform="translate(-23.64453125, -13)"> 
       <foreignobject width="47.2890625" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">page 1</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-c2-4848" transform="translate(512.87890625, 427.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-31.14453125" y="-20.5" width="62.2890625" height="41"></rect> 
      <g class="label" style="" transform="translate(-23.64453125, -13)"> 
       <foreignobject width="47.2890625" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">page 2</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-c3-4849" transform="translate(512.87890625, 518.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-35.76171875" y="-20.5" width="71.5234375" height="41"></rect> 
      <g class="label" style="" transform="translate(-28.26171875, -13)"> 
       <foreignobject width="56.5234375" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">page ...</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-c4-4850" transform="translate(512.87890625, 609.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-35.33984375" y="-20.5" width="70.6796875" height="41"></rect> 
      <g class="label" style="" transform="translate(-27.83984375, -13)"> 
       <foreignobject width="55.6796875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">page 64</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b1-4843" transform="translate(344.8828125, 336.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-32.234375" y="-20.5" width="64.46875" height="41"></rect> 
      <g class="label" style="" transform="translate(-24.734375, -13)"> 
       <foreignobject width="49.46875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">extend</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b2-4844" transform="translate(344.8828125, 427.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-32.234375" y="-20.5" width="64.46875" height="41"></rect> 
      <g class="label" style="" transform="translate(-24.734375, -13)"> 
       <foreignobject width="49.46875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">extend</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b3-4845" transform="translate(344.8828125, 518.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-16.3125" y="-20.5" width="32.625" height="41"></rect> 
      <g class="label" style="" transform="translate(-8.8125, -13)"> 
       <foreignobject width="17.625" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">...</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b4-4846" transform="translate(344.8828125, 609.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-32.234375" y="-20.5" width="64.46875" height="41"></rect> 
      <g class="label" style="" transform="translate(-24.734375, -13)"> 
       <foreignobject width="49.46875" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">extend</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-a1-4840" transform="translate(122.82421875, 336.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-73.8515625" y="-20.5" width="147.703125" height="41"></rect> 
      <g class="label" style="" transform="translate(-66.3515625, -13)"> 
       <foreignobject width="132.703125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">leaf node segment</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-a2-4841" transform="translate(122.82421875, 427.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-89.82421875" y="-20.5" width="179.6484375" height="41"></rect> 
      <g class="label" style="" transform="translate(-82.32421875, -13)"> 
       <foreignobject width="164.6484375" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">non-leaf node segment</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-a3-4842" transform="translate(122.82421875, 518.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-68.8515625" y="-20.5" width="137.703125" height="41"></rect> 
      <g class="label" style="" transform="translate(-61.3515625, -13)"> 
       <foreignobject width="122.703125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">rollback segment</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<h4><a id="11__45"></a>1.1. 表空间</h4> 
<p>表空间可以看作是InnoDB存储引擎逻辑结构的最高层，所有的数据都是存放在表空间中。默认情况下，InnoDB存储引擎有一个共享表空间ibdata1，用于存放撤销（Undo）信息、系统事务信息、二次写缓冲（Double Write Buffer）数据等。</p> 
<pre><code class="prism language-shell"><span class="token comment"># 查看表空间对应的物理文件</span>
$ ll /usr/local/mysql/data/ibdata1

mysql<span class="token operator">&gt;</span> show variables like <span class="token string">'innodb_file_per_table'</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果启用了参数<code>innodb_file_per_table</code>，则每张表内的数据可以单独放到一个表空间中。该参数默认启用。</p> 
<blockquote> 
 <p>启用<code>innodb_file_per_table</code>参数时，每张表的表空间内存放的只是数据、索引和插入缓冲的数据，而撤销信息、系统事务信息、二次写缓冲数据等还是存放在原来的共享表空间内。即使启用了<code>innodb_file_per_table</code>参数，共享表空间还是会不断增加大小。</p> 
</blockquote> 
<h4><a id="12__55"></a>1.2. 段</h4> 
<p>表空间由各个段组成。常见的段有数据段、索引段、回滚段等。InnoDB存储引擎表是用索引组织的（Index Organized）。因此，数据即索引，索引即数据。<br> 与Oracle不同的是，InnoDB存储引擎对于段的管理是由引擎本身完成的。这和Oracle的自动段空间管理（ASSM）类似，没有手动段空间管理（MSSM）方式，这从一定程度上简化了DBA的管理。</p> 
<blockquote> 
 <p>并不是每个对象都有段。准确的说：表空间是由分散的页和段组成。</p> 
</blockquote> 
<h4><a id="13__59"></a>1.3. 区</h4> 
<p>区是由连续的页组成，是物理上连续分配的一段空间，每个区的大小固定是1MB。对于大的数据段，InnoDB存储引擎最多每次可以申请4个区，以此来保证数据的顺序性能。</p> 
<h4><a id="14__61"></a>1.4. 页</h4> 
<p>InnoDB存储引擎的最小物理存储分配单位是页，默认大小是16KB。查看方式：</p> 
<pre><code class="prism language-SQL">mysql&gt; show variable like 'innodb_page_size';
</code></pre> 
<p>常见的页类型有：</p> 
<ul><li>数据页（B-Tree Node）</li><li>Undo页（Undo Log Page）</li><li>系统页（System Page）</li><li>事务数据页（Transaction System Page）</li><li>插入缓冲位图页（Insert Buffer Bitmap）</li><li>插入缓冲空闲列表页（Insert Buffer Free List）</li><li>未压缩的二进制大对象页（Uncompressed BLOB Page）</li><li>压缩的二进制大对象页（Compressed BLOB Page）</li></ul> 
<h4><a id="15__76"></a>1.5. 行</h4> 
<p>InnoDB存储引擎是面向行的（row-oriented），也就是说数据的存放是按行进行。每个页存放的行记录也是有硬性定义的，最多允许存放16*1024/2-200行的记录，即7992行记录。</p> 
<h3><a id="2__78"></a>2. 物理存储结构</h3> 
<p>MySQL通过逻辑存储结构来管理物理存储结构，即管理磁盘上存储的各种文件。</p> 
<h4><a id="21__80"></a>2.1 数据文件</h4> 
<p>数据文件包括 <strong>.ibd</strong> 文件和 <strong>ibdata</strong> 文件，它们都是存放InnoDB数据的文件。之所以有两种文件来存放InnoDB数据（包括索引），是因为InnoDB的数据存储方式能够通过配置来决定使用共享表空间存储数据，还是使用独享表空间存储。</p> 
<blockquote> 
 <p>使用InnoDB存储引擎时，如果在配置文件中没有启用参数<code>innodb_file_per_table</code>，默认使用InnoDB存储引擎的表都将数据存在<strong>ibdata1</strong>文件中。如果开启了该参数，则表示每个InnoDB表将单独使用一个目录来存放表的数据文件。</p> 
</blockquote> 
<h4><a id="22__83"></a>2.2. 重做日志文件</h4> 
<p>重做日志（Redo log）文件是InnoDB存储引擎生成的日志，主要为了保证数据的可靠性和事务的持久性。每个文件默认大小是1GB，可由参数<code>innodb_log_file_size</code>参数配置，而文件存放路径由参数<code>innodb_log_group_home_dir</code>参数配置。</p> 
<pre><code class="prism language-SQL">mysql&gt; show variable like 'innodb_log_file_size';
mysql&gt; show variable like 'innodb_log_group_home_dir';
mysql&gt; show variable like 'innodb_log_files_in_group';

# Redo log文件与数据文件默认存放在同一个目录，例如，下面命令执行后可以看到两个ib_logfile开头的文件，它们就是log group中的Redo log file。
$ ll /usr/local/mysql/data/ib_logfile*
</code></pre> 
<p>MySQL与Oracle一样都采用重做日志组的方式来管理Redo log文件。一个组内由多个大小完全相同的Redo log file组成，组内Redo log file的数量由<code>innodb_log_files_in_group</code>配置，默认是2。</p> 
<h4><a id="23__94"></a>2.3. 撤销日志文件</h4> 
<p>撤销日志（Undo log）文件中记录的是旧版本的数据，当用户对记录做了变更操作时就会产生undo记录。当一个旧的事务需要读取数据时，为了能读取到老版本的数据，需要顺着undo链找到满足其要求的数据记录。<br> 从MySQL 8.0版本开始，MySQL默认对undo进行了分离操作。即不需要在初始化中手动配置参数，默认会在MySQL数据目录下生成两个10MB的undo表空间文件<strong>undo_001</strong>和<strong>undo_002</strong>，并且可以在线增加和删除undo表空间文件进行动态扩容和收缩。</p> 
<h4><a id="24__97"></a>2.4. 参数文件</h4> 
<p>MySQL启动时，数据库先去读一个参数配置文件，用来寻找数据库的各种文件所在位置及指定某些初始化参数。在默认情况下，MySQL会按照一定的顺序在指定的位置进行读取，通过下面的语句可以查看读取参数文件的顺序：</p> 
<pre><code class="prism language-shell">mysql <span class="token parameter variable">--help</span> <span class="token operator">|</span> <span class="token function">grep</span> my.cnf
</code></pre> 
<p>MySQL参数有两类：</p> 
<ul><li>动态参数<br> MySQL在运行的过程中可以对参数进行在线修改。可以通过命令<code>set global</code>或<code>set session</code>在数据库中完成。</li><li>静态参数<br> 无法在线修改参数</li></ul> 
<h4><a id="25__107"></a>2.5. 错误日志</h4> 
<p>MySQL的错误日志文件对MySQL的启动、运行、关闭过程中出现的问题进行了记录。</p> 
<pre><code class="prism language-SQL">mysql&gt; show variables like 'log_error';
</code></pre> 
<h4><a id="26__112"></a>2.6. 二进制日志</h4> 
<p>二进制日志（binlog）文件记录了对MySQL数据库执行更改的所有操作，但是不包括SELECT和SHOW这类操作（因为这类操作不修改数据本身）。binlog的主要作用如下：</p> 
<ul><li>可以完成主从复制。在主服务器上把所有修改数据的操作记录到binlog中，通过网络发送给从服务器，从而达到主从同步的目的。</li><li>进行恢复操作。数据可以通过binlog文件，使用mysqlbinlog命令，实现基于时间点和位置的恢复操作。</li></ul> 
<p>binlog有三种模式：</p> 
<ul><li>STATEMENT模式（SBR）<br> 每一条修改数据的SQL语句会记录到binlog中。优点是并不需要记录每一条SQL语句和每一行的数据变化，减少了binlog日志量，节约I/O，提高性能。缺点是在某些情况下会导致主从复制中的数据不一致。</li><li>ROW模式（RBR）<br> 不记录每条SQL语句的上下文信息，仅需要记录哪条数据被修改了，修改成什么样了，而且不会出现某些特定情况下的存储过程、存储函数或者触发器的调用问题。缺点是会产生大量的日志，尤其是alter table的时候会让日志暴涨。</li><li>MIXED模式（MBR）<br> 以上两种模式的混合使用，一般的复制使用STATEMENT模式保存binlog，对于STATEMENT模式无法复制的操作使用ROW模式保存binlog，MySQL会根据执行的SQL语句选择日志保存方式。</li></ul> 
<p>binlog与redo log相似，但又不同。</p> 
<table><thead><tr><th>binlog</th><th>redo log</th></tr></thead><tbody><tr><td>binlog是MySQL数据库的上层应用产生的，并且binlog不仅仅针对InnoDB存储引擎，MySQL数据库中的任何存储引擎对于数据库的更改都会产生binlog</td><td>redo log是InnoDB存储引擎产生的</td></tr><tr><td>binlog是逻辑日志，其对应的是SQL语句</td><td>InnoDB存储引擎层面的redo log是物理日志</td></tr><tr><td>binlog只在事务提交完成后一次写入</td><td>redo log在事务进行中不断地被写入，并且日志不是随事务提交的顺序进行写入的</td></tr><tr><td>binlog不是循环使用的，在写满或者重启之后，会生成新的binlog文件</td><td>redo log是循环使用的</td></tr><tr><td>binlog可以作为恢复数据使用，主从复制的搭建</td><td>redo log作为异常宕机或介质故障后的数据恢复使用</td></tr></tbody></table> 
<h4><a id="27__133"></a>2.7. 慢查询日志</h4> 
<p>慢查询日志可以把超过参数<code>long_query_time</code>时间的所有SQL语句记录进来，帮助DBA人员优化有问题的SQL语句。</p> 
<pre><code class="prism language-SQL"># 查看慢查询日志功能配置
mysql&gt; show variables like '%slow_query%';

# 临时启用慢查询日志功能
mysql&gt; set global slow_query_log='ON';
mysql&gt; set session long_query_time=2;
</code></pre> 
<blockquote> 
 <p>如果需要在服务启动时启用慢查询日志，可以修改配置文件<code>/etc/mysql.cnf</code>，增加下面的内容：</p> 
</blockquote> 
<pre><code>[mysqld]
slow_query_log=ON
slow_query_log_file=./slow.log
long_query_time=2
</code></pre> 
<h4><a id="28__150"></a>2.8. 全量日志</h4> 
<p>全量日志（general log）会记录MySQL数据库所有操作的SQL语句，包含select和show。</p> 
<pre><code class="prism language-SQL"># 查看全量日志功能配置
mysql&gt; show variables like '%general_query%';

# 临时启用全量日志功能
mysql&gt; set global general_log='ON';
</code></pre> 
<h4><a id="29__159"></a>2.9. 中继日志</h4> 
<p>主从复制中，中继日志是从服务器上一个很重要的文件。主从复制的工作原理分为以下3个步骤：</p> 
<ol><li>主服务器把数据更改记录到二进制日志中</li><li>从服务器把主服务器的二进制日志复制到自己的中继日志中</li><li>从服务器重做中继日志中的日志，把更改应用到自己的数据库上，以达到数据的最终一致性。</li></ol> 
<pre><code class="prism language-SQL">mysql&gt; show variables like '%relay%';
</code></pre> 
<h4><a id="210_PID_167"></a>2.10. PID文件</h4> 
<p>MySQL实例启动时，会将自己的进程ID写入一个文件中，该文件为PID文件。它由参数pid_file配置，默认位于数据库目录下。</p> 
<pre><code class="prism language-SQL">mysql&gt; show variables like 'pid_file';
</code></pre> 
<h4><a id="211_Socket_172"></a>2.11. Socket文件</h4> 
<p>在UNIX系统下本地连接MySQL可以采用UNIX域套接字方式，这种方式需要一个套接字文件，由参数socket配置。</p> 
<pre><code class="prism language-SQL">mysql&gt; system cat /usr/local/mysql/data/mysql.pid

mysql&gt; show variables like 'socket';
</code></pre> 
<h4><a id="212__179"></a>2.12. 表结构文件</h4> 
<p>在MySQL8以前的版本中，数据的存储是根据表进行的，每个表都会有与之对应的文件。但不论采用哪种存储引擎，MySQL都有一个以frm为后缀名的文本文件，它记录了该表的表结构定义。frm可以存放视图的定义。</p> 
<h2><a id="InnoDB_182"></a>二、InnoDB的内存结构</h2> 
<p>MySQL内存可以分为系统全局区（SGA）和程序缓存区（PGA）。</p> 
<pre><code class="prism language-SQL">mysql&gt; show variables like '%buffer%';
</code></pre> 
<h3><a id="1_SGAPGA_187"></a>1. SGA与PGA中的缓冲区</h3> 
<table><thead><tr><th>SGA缓冲区</th><th>作用</th></tr></thead><tbody><tr><td>innodb_buffer_pool_size</td><td>缓存InnoDB表的数据、索引，以及数据字典等信息</td></tr><tr><td>innodb_log_buffer_size</td><td>事务在内存中的缓冲</td></tr><tr><td>query_cache</td><td>高速查询缓存，在生产环境建议关闭</td></tr></tbody></table> 
<table><thead><tr><th>PGA缓冲区</th><th>作用</th></tr></thead><tbody><tr><td>innodb_sort_buffer_size</td><td>主要用于SQL语句在内存中的临时排序</td></tr><tr><td>join_buffer_size</td><td>表连接使用，用于优化索引。</td></tr><tr><td>read_buffer_size</td><td>表顺序扫描的缓冲，只能应用于MyISAM存储引擎</td></tr><tr><td>read_rnd_buffer_size</td><td>MySQL随机读取缓冲区大小，用于减少磁盘的随机访问</td></tr></tbody></table> 
<h3><a id="2_Buffer_200"></a>2. Buffer缓冲区的状态</h3> 
<p>页是InnoDB磁盘的最小单位，数据都存放在页中，对应到内存中就是一个个Buffer。Buffer的不同状态值含义也不一样。</p> 
<table><thead><tr><th>Buffer状态</th><th>含义</th></tr></thead><tbody><tr><td>freeBuffer</td><td>该Buffer未被使用</td></tr><tr><td>cleanBuffer</td><td>内存中的Buffer与磁盘中页的数据一致</td></tr><tr><td>dirtyBuffer</td><td>内存中的数据还未被刷新到磁盘，和磁盘中的数据不一致</td></tr><tr><td>Buffer由链表来管理。不同的Buffer状态，产生不同的链表，因此一共有3种不同的链表。</td><td></td></tr><tr><td>链表类型</td><td>作用</td></tr><tr><td>—</td><td>—</td></tr><tr><td>free list</td><td>把freeBuffer串联起来。如果使用时不够用，将从lru list和flush list中释放出freeBuffer</td></tr><tr><td>lru list</td><td>把最近少访问到的cleanBuffer串联起来</td></tr><tr><td>flush list</td><td>把dirtyBuffer串联起来，方便线程将数据刷新到磁盘</td></tr></tbody></table> 
<h3><a id="3__213"></a>3. 内存的刷新机制</h3> 
<h4><a id="31_MySQL_214"></a>3.1 MySQL检查点的类型</h4> 
<p>MySQL采用检查点（checkpoint）的方式来刷新内存。在InnoDB存储引擎中，有两种checkpoint：</p> 
<ul><li>Sharp Checkpoint（完全检查点）<br> 将内存中所有脏页全部写入磁盘就是完全检查点，比如数据库实例关闭时。</li><li>Fuzzy Checkpoint（模糊检查点）<br> 将部分脏页写入磁盘就是模糊检查点，数据库实例运行过程产生的检查点基本上就是这种类型的检查点。</li></ul> 
<h4><a id="32_MySQL_220"></a>3.2 MySQL的模糊检查点</h4> 
<p>MySQL的模糊检查点会在以下4种条件下被触发。</p> 
<ol><li>每隔1秒或者每隔10秒，将强制执行模糊检查点。这个过程是周期性异步的，不会阻塞用户查询，不影响业务；但每次执行检查点刷新的脏页量比较小，具体由参数<code>innodb_io_capacity</code>配置每次刷新脏页的数量，默认是200。</li><li>当LRU队列的列表中空闲页不足时，将强制执行模糊检查点。可以通过<code>innodb_lru_scan_depth</code>配置LRU列表中可用页的数量，默认值是1024。如果LRU队列中不满足这一条件，InnoDB引擎将会移除LRU列表尾端的页。如果这些页中有脏数据，则执行模糊检查点。</li><li>当重做日志redo log不够用时，将强制执行模糊检查点。重做日志有两个水位：</li></ol> 
<ul><li>异步水位：75% x innodb的总大小</li><li>同步水位：90% x innodb大小<br> 当这两个事件中的任何一个发生时，都会记录到error log中。一旦error log出现这种日志提示，一定需要加大日志文件的大小。</li></ul> 
<ol start="4"><li>系统中整体脏页达到一定比例，将强制执行模糊检查点。使用参数<code>innodb_dirty_page_pct</code>来配置内存Buffer中脏数据的比例，默认值是90%。</li></ol> 
<h2><a id="InnoDB_229"></a>三、InnoDB的线程结构</h2> 
<p>InnoDB的线程结构主要分为主线程结构、I/O线程结构和其他线程结构。</p> 
<h3><a id="1__231"></a>1. 主线程结构</h3> 
<p>后台线程中的主线程（master thread），优先级别最高。<br> 主线程内部有4个循环：主循环（loop）、后台循环（background loop）、刷新循环（flush loop）、和暂定循环（suspend loop）。其中最主要的就是主循环，它分为每1秒操作和每10秒操作两种情况。</p> 
<table><thead><tr><th>主循环操作</th><th align="left">操作行为</th></tr></thead><tbody><tr><td>每1秒操作</td><td align="left">日志刷新到磁盘，即使事务还没提交。<br>刷新脏页到磁盘。<br>执行合并插入缓冲操作。<br>产生检查点。<br>删除无用的表缓存。<br>当前没有操作切换到后台循环</td></tr><tr><td>每10秒操作</td><td align="left">日志刷新到磁盘，即使事务还没有提交。<br>刷新脏页到磁盘。<br>执行合并插入缓冲操作。<br>产生检查点。<br>删除无用的undo</td></tr></tbody></table> 
<h3><a id="2_IO_238"></a>2. I/O线程结构</h3> 
<p>MySQL有4大I/O线程。</p> 
<table><thead><tr><th>I/O线程</th><th align="left">线程作用</th></tr></thead><tbody><tr><td>read thread</td><td align="left">数据库的读请求线程，默认4个</td></tr><tr><td>write thread</td><td align="left">数据库的写请求线程，默认4个</td></tr><tr><td>redo log thread</td><td align="left">把日志缓存中的内容刷新到redo log文件中</td></tr><tr><td>change buffer thread</td><td align="left">把插入缓存（change buffer）中的数据刷新到磁盘的数据文件中</td></tr></tbody></table> 
<pre><code class="prism language-SQL">mysql&gt; show variables like 'innodb_read_io_threads';
mysql&gt; show variables like 'innodb_write_io_threads';
</code></pre> 
<h3><a id="3__250"></a>3. 其他线程结构</h3> 
<p>InnoDB存储引擎中还有一些线程，作用也不同。</p> 
<table><thead><tr><th>线程名称</th><th align="left">线程作用</th></tr></thead><tbody><tr><td>page clean thread</td><td align="left">将脏数据写入磁盘，脏数据写入磁盘后相应的redo就可以覆盖，然后达到redo循环使用的目的。</td></tr><tr><td>purge thread</td><td align="left">负责删除无用的undo页。由于DML语句操作都会生成undo，系统需要定期对undo页进行清理，这时就需要purge操作。默认线程数是4，最大可调整至32。</td></tr><tr><td>error monitor thread</td><td align="left">负责数据库报错的线程</td></tr><tr><td>lock monitor thread</td><td align="left">负责监控锁的线程</td></tr></tbody></table> 
<pre><code class="prism language-SQL">mysql&gt; show variables like 'innodb_page_cleaners';
mysql&gt; show variables like 'innodb_purge_threads';
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/143077e5d9b7cbeac11076a523ff6a10/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">功能测试--APP专项测试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8b25c13fe03ef37696f4d2dd8f8fb533/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【机器人控制 Robot Control】点对点控制 P2P Control 和 路径控制 Path Control【新加坡南洋理工大学 NTU Singapore】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>