<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springBoot集成jcifs - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="springBoot集成jcifs" />
<meta property="og:description" content="这个是抄的网上的，web项目 springboot 是都可以支持的 配置过滤的地址要处理下，我在下个文章里面阐述了。
1、添加jcifs依赖包。 &lt;dependency&gt; &lt;groupId&gt;jcifs&lt;/groupId&gt; &lt;artifactId&gt;jcifs&lt;/artifactId&gt; &lt;version&gt;1.2.9&lt;/version&gt; &lt;/dependency&gt; 2、在配置文件application.properties里添加jcifs的配置参数，也可新增独立的资源文件进行读取，在这里就不在赘述了。(账号密码自行向域控管理员申请) jcifs.http.domainController=10.100.xxx.xx jcifs.smb.client.domain=xxx.com jcifs.smb.client.username=XXX jcifs.smb.client.password=XXX 3、创建jcifs初始化NtlmHttpFilter 的子过滤器，在这里我只初始化了4个必须参数，其他参数见类中所展示的，根据项目需要进行配置。
注：在传统项目中是通过web.xml进行初始化，在springBoot项目中无法生效，难受~~~ import jcifs.Config; import jcifs.http.NtlmHttpFilter; /** * 初始化jcifs域控登录参数 * @author ex_lihui * @date 2019/03/28 */ public class JcifsFilter extends NtlmHttpFilter { public JcifsFilter(){}; public JcifsFilter(String defaultDomain,String domainController,String loadBalance,String enableBasic,String insecureBasic,String realm,String level,String username,String password){ Config.setProperty(&#34;jcifs.smb.client.domain&#34;,defaultDomain); Config.setProperty(&#34;jcifs.http.domainController&#34;,domainController); Config.setProperty(&#34;jcifs.smb.client.username&#34;,username); Config.setProperty(&#34;jcifs.smb.client.password&#34;,password); /*Config.setProperty(&#34;jcifs.http.loadBalance&#34;,loadBalance); Config.setProperty(&#34;jcifs.http.enableBasic&#34;,enableBasic); Config.setProperty(&#34;jcifs.http.insecureBasic&#34;,insecureBasic); Config.setProperty(&#34;jcifs.http.basicRealm&#34;,realm); Config.setProperty(&#34;jcifs.util.loglevel&#34;,level);*/ }; } 附录，传统初始化方式。
&lt;filter&gt; &lt;filter-name&gt;NtlmHttpFilter&lt;/filter-name&gt; &lt;filter-class&gt;jcifs.http.NtlmHttpFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;jcifs.smb.client.soTimeout&lt;/param-name&gt; &lt;param-value&gt;5000&lt;/param-value&gt; &lt;/init-param&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/535c2f2232968c0317e68fd28ddc4320/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-08T09:53:33+08:00" />
<meta property="article:modified_time" content="2022-12-08T09:53:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springBoot集成jcifs</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>这个是抄的网上的，web项目  springboot 是都可以支持的</h4> 
<p>配置过滤的地址要处理下，我在下个文章里面阐述了。</p> 
<h4>1、添加jcifs依赖包。</h4> 
<pre>&lt;dependency&gt;
&lt;groupId&gt;jcifs&lt;/groupId&gt;  
&lt;artifactId&gt;jcifs&lt;/artifactId&gt;
&lt;version&gt;1.2.9&lt;/version&gt;
&lt;/dependency&gt;</pre> 
<h4>2、在配置文件application.properties里添加jcifs的配置参数，也可新增独立的资源文件进行读取，在这里就不在赘述了。(账号密码自行向域控管理员申请)</h4> 
<pre>jcifs.http.domainController=10.100.xxx.xx
jcifs.smb.client.domain=xxx.com
jcifs.smb.client.username=XXX
jcifs.smb.client.password=XXX</pre> 
<h4>3、创建jcifs初始化NtlmHttpFilter 的子过滤器，在这里我只初始化了4个必须参数，其他参数见类中所展示的，根据项目需要进行配置。<br> 注：在传统项目中是通过web.xml进行初始化，在springBoot项目中无法生效，难受~~~</h4> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e7/39/dfZaWbpw_o.gif"></p> 
<pre>import jcifs.Config;
import jcifs.http.NtlmHttpFilter;
/**
 * 初始化jcifs域控登录参数
 * @author ex_lihui
 * @date 2019/03/28
 */
public class JcifsFilter extends NtlmHttpFilter {

      public JcifsFilter(){};
      public JcifsFilter(String defaultDomain,String domainController,String loadBalance,String enableBasic,String insecureBasic,String realm,String level,String username,String password){
              Config.setProperty("jcifs.smb.client.domain",defaultDomain);            
              Config.setProperty("jcifs.http.domainController",domainController);    
              Config.setProperty("jcifs.smb.client.username",username);
              Config.setProperty("jcifs.smb.client.password",password);
            /*Config.setProperty("jcifs.http.loadBalance",loadBalance);            
            Config.setProperty("jcifs.http.enableBasic",enableBasic);            
            Config.setProperty("jcifs.http.insecureBasic",insecureBasic);            
            Config.setProperty("jcifs.http.basicRealm",realm);            
            Config.setProperty("jcifs.util.loglevel",level);*/
      };

}</pre> 
<p>附录，传统初始化方式。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c8/35/Ld3bd2Rp_o.gif"></p> 
<pre> &lt;filter&gt; 
    &lt;filter-name&gt;NtlmHttpFilter&lt;/filter-name&gt; 
    &lt;filter-class&gt;jcifs.http.NtlmHttpFilter&lt;/filter-class&gt; 
    &lt;init-param&gt;
        &lt;param-name&gt;jcifs.smb.client.soTimeout&lt;/param-name&gt;
      &lt;param-value&gt;5000&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!--域服务器地址--&gt;
    &lt;init-param&gt; 
        &lt;param-name&gt;jcifs.http.domainController&lt;/param-name&gt; 
        &lt;param-value&gt;192.16.xxx.xx&lt;/param-value&gt; 
    &lt;/init-param&gt;
    &lt;!--域服务器域名--&gt;
    &lt;init-param&gt; 
        &lt;param-name&gt;jcifs.smb.client.domain&lt;/param-name&gt; 
        &lt;param-value&gt;xxx&lt;/param-value&gt; 
    &lt;/init-param&gt; 
    &lt;init-param&gt; 
     &lt;param-name&gt;jcifs.util.loglevel&lt;/param-name&gt; 
     &lt;param-value&gt;2&lt;/param-value&gt; 
    &lt;/init-param&gt;
    &lt;!--域服务器账号--&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;jcifs.smb.client.username&lt;/param-name&gt;
        &lt;param-value&gt;xxxxxx&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!--域服务器密码--&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;jcifs.smb.client.password&lt;/param-name&gt;
        &lt;param-value&gt;xxxxxx&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;jcifs.smb.lmCompatibility&lt;/param-name&gt;
      &lt;param-value&gt;0&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;jcifs.smb.client.useExtendedSecurity&lt;/param-name&gt;
      &lt;param-value&gt;false&lt;/param-value&gt;
    &lt;/init-param&gt;
 &lt;/filter&gt; 
 &lt;filter-mapping&gt; 
    &lt;filter-name&gt;NtlmHttpFilter&lt;/filter-name&gt; 
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt; 
 &lt;/filter-mapping&gt;</pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/26/41/cM1tT5n0_o.gif"></p> 
<h4> 4、在springBoot启动类中进行拦截器的注册配置。</h4> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/83/5f/IhpKlSBy_o.gif"></p> 
<pre>    /**
     * 代码方式注册Bean
     * @return
     */
    @Bean
    public FilterRegistrationBean setFilter(){

        FilterRegistrationBean filterBean = new FilterRegistrationBean();
        JcifsFilter ntl = new JcifsFilter(defaultDomain, domainController, loadBalance, enableBasic, insecureBasic, realm, level,username,password);
        filterBean.setFilter(ntl);
        filterBean.setName("NtlmHttpFilter");
        //配置需要获取域控的请求路径也可以直接配置 '/*'(代表全部都会进行域控加载)
            filterBean.addUrlPatterns(
                /*"/",*/
                "/index/*"
                );
        filterBean.setOrder(1);//设置级别最高
        return filterBean;
    }</pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/bf/78/PBXBbdhI_o.gif"></p> 
<h4>5、启动项目访问即可获取域用户，在需要的地方调用如下方法即可获取，一般放在过滤器中，当session中没有用户信息再去域控获取。</h4> 
<pre>例：
String userId = (String) request.getSession().getAttribute(ConstKey.SESSION_USERID.getKey());
if(StringUtils.isBlank(userId)){
        userId=UserUtil.parseUserName(request);
}</pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/3a/27/yT8sSj7k_o.gif"></p> 
<pre></pre> 
<pre>UserUtil.class</pre> 
<pre>//获取域控userId的封装方法
public static String parseUserName(HttpServletRequest request){
        String userId = request.getRemoteUser(); // JAAS 认证通过
        if (userId != null &amp;&amp; userId.indexOf("\\") &gt; 0)
        {
            userId = userId.substring(userId.indexOf("\\") + 1).trim();
        } else if (userId != null &amp;&amp; userId.indexOf("@") &gt; 0)
        {
            userId = userId.substring(0, userId.indexOf("@")).trim();
        }
        return userId;
    }</pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5f9bcefe82941c3eecb490df3d637d58/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Win10安装Nacos</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fb518e6452495f1bac2d5e92ceddc38f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">lambdaQuery中EQ、NE、GT、LT、GE、LE的用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>