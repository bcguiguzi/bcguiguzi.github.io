<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Macbook Pro 外接显卡实现Tensorflow GPU运行之环境配置（重点） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Macbook Pro 外接显卡实现Tensorflow GPU运行之环境配置（重点）" />
<meta property="og:description" content="Macbook Pro 外接显卡实现Tensorflow GPU运行–环境配置 MacOS 重装外接显卡（内屏输出）环境配置（重点）👆Tensorflow GPU 配置 环境配置 准备工作 显卡：GTX 1080TI 11G显卡坞：Mantiz （技嘉的Gamingbox应该也可以）显卡欺骗器（有条件的配个外屏吧，毕竟外屏转内屏输出损耗还是挺大的）MacOS：雷电3接口 安装步骤 macOS 系统安装（见blog1）CUDA配置cuDNN配置Tensorflow配置（见blog4） CUDA加速 准备列表 资源版本号MacOS10.13. 6（17G65）GPU driverNIVIDIA Web Driver 387.10.10.40.105CUDA driver9.2（396.148 ）cuDNNcudnn-9.2-osx-x64-v7.2.1.38Xcode9.2 注意⚠️：相关驱动版本以及编译环境工具必须配套对应！
步骤
关闭SIP：重新启动macOS，并同时按住Command和R进入Recovery OS；
在Utilities菜单中启动Terminal；
在Terminal中执行命令：
$ csrutil disable;
重新启动后进入Recovery OS 在Utilities中启动Terminal 执行命令：
$ csrutil status
确认状态为disable
安装GPU驱动
在Terminal中执行：
sudo curl -s &#34;https://api.github.com/repos/mayankk2308/purge-wrangler/releases/latest&#34; | grep &#39;&#34;browser_download_url&#34;:&#39; | sed -E &#39;s/.*&#34;([^&#34;]&#43;)&#34;.*/\1/&#39; | xargs curl -L -s -0 &gt; purge-wrangler.sh &amp;&amp; chmod &#43;x purge-wrangler.sh &amp;&amp; ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/be1651a42c88254ecd6f630282e9f746/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-31T12:01:55+08:00" />
<meta property="article:modified_time" content="2020-05-31T12:01:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Macbook Pro 外接显卡实现Tensorflow GPU运行之环境配置（重点）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Macbook_Pro_Tensorflow_GPU_0"></a>Macbook Pro 外接显卡实现Tensorflow GPU运行–环境配置</h2> 
<ol><li><a href="https://blog.csdn.net/weixin_38250514/article/details/106453383">MacOS 重装</a></li><li><a href="https://blog.csdn.net/weixin_38250514/article/details/106453419">外接显卡（内屏输出）</a></li><li>环境配置（重点）👆</li><li><a href="https://blog.csdn.net/weixin_38250514/article/details/106453555">Tensorflow GPU 配置</a></li></ol> 
<hr> 
<h2><a id="_6"></a>环境配置</h2> 
<h3><a id="_7"></a>准备工作</h3> 
<ul><li>显卡：GTX 1080TI 11G</li><li>显卡坞：Mantiz （技嘉的Gamingbox应该也可以）</li><li>显卡欺骗器（有条件的配个外屏吧，毕竟外屏转内屏输出损耗还是挺大的）</li><li>MacOS：</li><li>雷电3接口</li></ul> 
<h3><a id="_13"></a>安装步骤</h3> 
<ul><li>macOS 系统安装（见blog1）</li><li>CUDA配置</li><li>cuDNN配置</li><li>Tensorflow配置（见blog4）</li></ul> 
<h4><a id="CUDA_18"></a>CUDA加速</h4> 
<ul><li>准备列表</li></ul> 
<table><thead><tr><th>资源</th><th>版本号</th></tr></thead><tbody><tr><td>MacOS</td><td>10.13. 6（17G65）</td></tr><tr><td>GPU driver</td><td>NIVIDIA Web Driver 387.10.10.40.105</td></tr><tr><td>CUDA driver</td><td>9.2（396.148 ）</td></tr><tr><td>cuDNN</td><td>cudnn-9.2-osx-x64-v7.2.1.38</td></tr><tr><td>Xcode</td><td>9.2</td></tr></tbody></table> 
<p>注意⚠️：相关驱动版本以及编译环境工具必须配套对应！</p> 
<ul><li> <p>步骤</p> </li><li> <p>关闭SIP：重新启动macOS，并同时按住Command和R进入Recovery OS；<br> 在Utilities菜单中启动Terminal；<br> 在Terminal中执行命令：<br> <code>$ csrutil disable;</code><br> 重新启动后进入Recovery OS 在Utilities中启动Terminal 执行命令：<br> <code>$ csrutil status</code><br> 确认状态为disable</p> </li><li> <p>安装GPU驱动<br> 在Terminal中执行：<br> <code>sudo curl -s "https://api.github.com/repos/mayankk2308/purge-wrangler/releases/latest" | grep '"browser_download_url":' | sed -E 's/.*"([^"]+)".*/\1/' | xargs curl -L -s -0 &gt; purge-wrangler.sh &amp;&amp; chmod +x purge-wrangler.sh &amp;&amp; ./purge-wrangler.sh &amp;&amp; rm purge-wrangler.sh</code><br> 选择对应的显卡即可</p> </li><li> <p>安装CUDA：</p> 
  <ol><li>⚠️：CUDA driver必须与GPU driver版本一致！版本号对应查找：<a href="http://www.macvidcards.com/drivers.html" rel="nofollow">http://www.macvidcards.com/drivers.html</a></li><li>在CUDA driver里找到对应版本号下载安装 <a href="http://www.nvidia.com/object/mac-driver-archive.html" rel="nofollow">http://www.nvidia.com/object/mac-driver-archive.html</a></li><li>安装CUDA Toolkit<br> ⚠️： CUDA Toolkit必须与CUDA driver版本号以及macOS对应！<br> 下载安装顺序：先安装基础安装包再装补丁，一定注意顺序！<br> <a href="https://developer.nvidia.com/cuda-toolkit-archive" rel="nofollow">https://developer.nvidia.com/cuda-toolkit-archive</a></li></ol> </li><li> <p>配置CUDA环境前的工作</p> 
  <ol><li>Xcode 安装<br> CUDA环境配置时，需要Xcode command line tools的支持。macOS 10.13.6 一般对应的是Xcode 9.2。如果有Xcode版本较高的同学建议重新安装Xcode<br> 下载地址： <a href="https://developer.apple.com/downloads/" rel="nofollow">https://developer.apple.com/downloads/</a><br> 如果Xcode 和Command Line Tools与CUDA的版本对应不一致，后面在验证CUDA环境时可能会出现如下❌错误：<br> <code>nvcc fatal : The version ('10.0') of the host compiler ('Apple clang') is not supported</code><br> 此时需要重新安装Xcode以及CLT<br> 安装后切换到当前<code>sudo xcode-select --switch /Library/Developer/CommandLineTools</code></li><li>外接显卡连接<br> 参考另一篇</li></ol> </li><li> <p>正式配置CUDA环境</p> 
  <ol><li> <p>在Terminal中执行如下命令：<br> <code>cd ~ open -e .bash_profile</code></p> <p>编辑～/.bash_profile 文件</p> </li><li> <p>在文件末尾添加如下内容：<br> <code>export CUDA_HOME=/usr/local/cuda export DYLD_LIBRARY_PATH="$CUDA_HOME/lib:$CUDA_HOME/extras/CUPTI/lib" export LD_LIBRARY_PATH=$DYLD_LIBRARY_PATH export PATH=$DYLD_LIBRARY_PATH:$PATH export flags="--config=cuda --config=opt"</code><br> 添加完毕，保存文件后关闭</p> </li><li> <p>执行命令重启bash_profile<br> <code>.~/.bash_profile</code></p> </li><li> <p>确认CUDA环境，在Terminal中执行如下命令：<br> <code>cs /usr/local/cuda/samples</code><br> <code>sudo make -C 1_Utilities/deviceQuery</code><br> <code>./bin/x86_64/darwin/release/deviceQuery</code><br> 执行后如果得到显示 Result = PASS 则CUDA环境配置成功</p> </li></ol> </li><li> <p>安装cuDNN<br> 下载安装：<a href="https://developer.nvidia.com/rdp/cudnn-archive" rel="nofollow">https://developer.nvidia.com/rdp/cudnn-archive</a><br> 依旧注意版本号的对应！<br> 官方安装指导：https://docs.nvidia.com/deeplearning/sdk/cudnn-install/index.html#install-mac<br> 手动傻瓜式安装：<br> 之前配置CUDA环境时，在系统上会生成一个名为Developer的文件夹<br> 将下载好的cuDNN压缩文件拖至该文件夹<br> 启动Terminal，执行解压操作：<br> <code>$ tar -xzvf cudnn-9.0-osx-x64-v7.tgz</code><br> 解压后复制以下文件至要求路径：<br> <code>$ sudo cp cuda/include/cudnn.h /usr/local/cuda/include</code><br> <code>$ sudo cp cuda/lib/libcudnn* /usr/local/cuda/lib</code><br> <code>$ sudo chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib/libcudnn*</code><br> 最后添加环境变量：<br> <code>$ export DYLD_LIBRARY_PATH=/usr/local/cuda/lib:$DYLD_LIBRARY_PATH</code></p> </li></ul> 
<p>至此配置结束。<br> 在配置过程中可能会遇到的问题及解决方案，大家可以参考以下博文：</p> 
<ol><li>问题：# xcode-select: error: tool ‘xcodebuild’ requires Xcode<br> 解决：<a href="https://www.jianshu.com/p/07a281ff57d3" rel="nofollow">https://www.jianshu.com/p/07a281ff57d3</a></li><li>问题：# CUDA driver version is insufficient for CUDA runtime version<br> 解决：<a href="https://blog.csdn.net/nijun1992/article/details/80446226%20https://www.cnblogs.com/liaohuiqiang/archive/2018/10/15/9791365.html">https://blog.csdn.net/nijun1992/article/details/80446226<br> https://www.cnblogs.com/liaohuiqiang/archive/2018/10/15/9791365.html</a></li><li>问题：nvcc fatal : The version (‘10.0’) of the host compiler (‘Apple clang’) is not supported<br> 解决： <a href="https://github.com/colmap/colmap/issues/296#ref-issue-290211077">https://github.com/colmap/colmap/issues/296#ref-issue-290211077</a></li></ol> 
<h3><a id="_106"></a>⚠️注意</h3> 
<ol><li>外接显卡不支持热插拔！开机进入登录界面后再接入显卡，关机黑屏后再拔掉显卡。</li><li>外接显卡必须接外屏或者显卡欺骗器才能工作，不然CUDA环境配置不会成功。</li><li>如果有MacOS 10.13.6（17G66）的同学，强烈建议重装系统。这个系统版本找不到对应NIVIDA web driver，CUDA等，尽管GitHub上有自动编译的方式可以安装CUDA但是之后的Xcode CTL，cuDNN都会出现问题。⚠：不要从苹果官网获得High Sierra 10.13.6，因为官网的都是这个17G66的版本！</li></ol> 
<h3><a id="_111"></a>参考资料</h3> 
<ol><li><a href="https://blog.csdn.net/ignoreyou/article/details/85132738">https://blog.csdn.net/ignoreyou/article/details/85132738</a></li><li><a href="https://blog.csdn.net/wz22881916/article/details/78807993">https://blog.csdn.net/wz22881916/article/details/78807993</a></li><li><a href="https://www.cnblogs.com/didda/p/9065387.html" rel="nofollow">https://www.cnblogs.com/didda/p/9065387.html</a></li><li><a href="https://blog.csdn.net/u014475479/article/details/81702392">https://blog.csdn.net/u014475479/article/details/81702392</a></li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ac88e6f354c24583ce5b8e18fd0254a8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">haspMap源码分析之-链表拆分问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4e33a9eb9f4662b3642dcc8fa0d94095/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Andriod P DNS解析不了问题解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>