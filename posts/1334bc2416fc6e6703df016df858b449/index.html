<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>小程序安卓和苹果手机是一个服务器吗,小程序兼容安卓和IOS数据处理问题 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="小程序安卓和苹果手机是一个服务器吗,小程序兼容安卓和IOS数据处理问题" />
<meta property="og:description" content="最近开发微信小程序，遇到到过种坑，例如什么前端发送请求，后端请求成功，没有获取到前端传递的值；后端请求成功，并且值，前端就是出不来数据；请求接口出现Provision headers are shown的现象；到最后苹果手机上出现数据，安卓手机出现不了数据等等，非常多的bug。备注后端我用的php开发的，框架用的TP5.0，我一度怀疑是我框架的原因。安卓需要的是字符串，苹果好像都行吧，我是做的兼容处理。
作为一名程序员，连bug都没有，你还开发什么软件？废话不说了先上问题吧；
1.小程序前端发送请求给后端，常用的有2中方式，一种是get请求，一种是POST请求，首先举例get请求吧，wx.request({
url: that.globalData.baseUrl &#43; &#39;user/add&#39;,//请求后台接口
data: {
code: avatarUrl,
username: nickName }
header: {
&#39;content-type&#39;:&#39;application/json&#39;,// 默认值
token: wx.getStorageSync(&#39;token&#39;)
},
method: &#34;get&#34;,
success: function (res) {
// console.log(res)
}
}) 这种传递方式是没有什么问题，后端怎么都会接受到数据，前端也可以接受到数据。
主要是看第二种post方法；
wx.request({
url: that.globalData.baseUrl &#43; &#39;wx/getToken&#39;,//请求后台接口
data: {
code: res.code
},
header: {
&#34;Content-Type&#34;: &#34;application/x-www-form-urlencoded&#34;,
},
method: &#34;POST&#34;,
success: function (res) {
console.log(res);
wx.setStorageSync(&#39;token&#39;, res.data.data)
}
})
这种情况是后端是可以接受到数据的，，但是把 &#34;Content-Type&#34;: &#34;application/x-www-form-urlencoded&#34;,换成 &#39;content-type&#39;:&#39;application/json&#39;，后端接口就接收不到数据，但是有的小程序上面post请求中header头换成&#39;content-type&#39;:&#39;application/json&#39;，也能接受到数据。但是我后端就是不能，后来我就换成了这个。
2.后端请求成功，并且值，前端就是出不来数据？
主要是请求的类型和你返回给前端的数据类型不对一致。这是你就需要及时检测数据类型，并且换成对应的数据类型。
3.请求接口出现Provision headers are shown的现象" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/1334bc2416fc6e6703df016df858b449/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-11T09:45:33+08:00" />
<meta property="article:modified_time" content="2021-08-11T09:45:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">小程序安卓和苹果手机是一个服务器吗,小程序兼容安卓和IOS数据处理问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>最近开发微信小程序，遇到到过种坑，例如什么前端发送请求，后端请求成功，没有获取到前端传递的值；后端请求成功，并且值，前端就是出不来数据；请求接口出现Provision headers are shown的现象；到最后苹果手机上出现数据，安卓手机出现不了数据等等，非常多的bug。备注后端我用的php开发的，框架用的TP5.0，我一度怀疑是我框架的原因。安卓需要的是字符串，苹果好像都行吧，我是做的兼容处理。</p> 
 <p>作为一名程序员，连bug都没有，你还开发什么软件？废话不说了先上问题吧；</p> 
 <p>1.小程序前端发送请求给后端，常用的有2中方式，一种是get请求，一种是POST请求，首先举例get请求吧，wx.request({<!-- --></p> 
 <p>url: that.globalData.baseUrl + 'user/add',//请求后台接口</p> 
 <p>data: {<!-- --></p> 
 <p>code: avatarUrl,</p> 
 <p>username: nickName }</p> 
 <p>header: {<!-- --></p> 
 <p>'content-type':'application/json',// 默认值</p> 
 <p>token: wx.getStorageSync('token')</p> 
 <p>},</p> 
 <p>method: "get",</p> 
 <p>success: function (res) {<!-- --></p> 
 <p>// console.log(res)</p> 
 <p>}</p> 
 <p>})  这种传递方式是没有什么问题，后端怎么都会接受到数据，前端也可以接受到数据。</p> 
 <p>主要是看第二种post方法；</p> 
 <p>wx.request({<!-- --></p> 
 <p>url: that.globalData.baseUrl + 'wx/getToken',//请求后台接口</p> 
 <p>data: {<!-- --></p> 
 <p>code: res.code</p> 
 <p>},</p> 
 <p>header: {<!-- --></p> 
 <p>"Content-Type": "application/x-www-form-urlencoded",</p> 
 <p>},</p> 
 <p>method: "POST",</p> 
 <p>success: function (res) {<!-- --></p> 
 <p>console.log(res);</p> 
 <p>wx.setStorageSync('token', res.data.data)</p> 
 <p>}</p> 
 <p>})</p> 
 <p>这种情况是后端是可以接受到数据的，，但是把  "Content-Type": "application/x-www-form-urlencoded",换成 'content-type':'application/json'，后端接口就接收不到数据，但是有的小程序上面post请求中header头换成'content-type':'application/json'，也能接受到数据。但是我后端就是不能，后来我就换成了这个。</p> 
 <p>2.后端请求成功，并且值，前端就是出不来数据？</p> 
 <p>主要是请求的类型和你返回给前端的数据类型不对一致。这是你就需要及时检测数据类型，并且换成对应的数据类型。</p> 
 <p>3.请求接口出现Provision headers are shown的现象</p> 
 <p>出现上述现象主要是应为阻塞的原因，主要需要下面几个方面，首先是否用了断点，断点没注意，就会出现；数据库方面的请求连接是否过长，否则也会出现。小程序要求速度快，所以一般都用原生数据库接口更好点，响应速度短，界面反应也快。</p> 
 <p>4.到最后苹果手机上出现数据，安卓手机出现不了数据</p> 
 <p>例如后端返回数据出现是这种 "{"code":1,"data":"4f756fd91b8a81f1","msg":"请求成功"}" ，那么需要对应处理：首先判断是那种数据类型</p> 
 <p>var json =res.data</p> 
 <p>if (typeof json != 'object') {<!-- --></p> 
 <p>if (json != null) {<!-- --></p> 
 <p>json = json.replace("\ufeff", "")</p> 
 <p>var ob = JSON.parse(json)</p> 
 <p>} }，转字符串还是json对象，一般都是转json对象，传值得时候转json字符串比较多。有时候返回的值可能会出现前面有个隐藏的点，JSON.parse处理返回什么“token 有个0”，那么需要用下面的处理一下数据var aa = res.data.trim();var bb = JSON.parse(aa)；谢谢大家，第一次写。以前都是印象笔记上写；现在简书上写。请多多指教</p> 
 <p>高尔基：学习并不等于就是摹仿某些东西，而是掌握技巧和方法。</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6ca27ed7145b2bd4ddf0984d6d9c4474/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringBoot定时任务：使用shedlock解决SpringBoot分布式定时任务重复执行的问题，SpringBoot定时任务SchedulerLock的用法，不使用Redis实现定时任务事务</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/23d92a61c8fd65b26af43c001af460e9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">服务器文件夹变成自读,服务器终端改文件读写权限</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>