<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java基于itextPDF实现pdf动态导出 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java基于itextPDF实现pdf动态导出" />
<meta property="og:description" content="Java基于itextPDF实现pdf动态导出 1、制作PDF导出模板2 、集成itextpdf3 、编写实体4 、编写主要代码5、编写controller并测试补充：踩坑记录 现在的业务越来越复杂了，有些业务场景已经不能满足与EXCEL导出和WORD导出了，例如准考证打印，电子证书等等，这些都是动态数据导出的PDF。接下来我们就看一下怎么实现PDF的动态导出吧。
1、制作PDF导出模板 第一步，我们需要制作一个PDF模板，可以先使用WORD去制作，制作完成以后再转为PDF。
当转为PDF以后，我们就需要去给PDF设置表单域了，表单域的名称和你要填充的数据名称需要一一对应。
这里推荐几个可以编辑表单域的软件：Adobe Acrobat 、 万兴PDF、PDFill、Nitro
我这里懒省事用的万兴PDF（免费版有水印），具体哪个更好用一点请大家自行判断。
2 、集成itextpdf 接下来第二步则是在项目中集成itextpdf，项目中使用的是SpringBoot 2.7 , 同时还集成了lombok.
&lt;dependency&gt; &lt;groupId&gt;com.itextpdf&lt;/groupId&gt; &lt;artifactId&gt;itextpdf&lt;/artifactId&gt; &lt;version&gt;5.5.13&lt;/version&gt; &lt;/dependency&gt; 3 、编写实体 编写导出PDF需要用到的实体，这里注意，实体中的属性名需要和表单域名一一对应。
同时为了方便测试，在无参构造中初始化了一些默认数据。
package com.vinci.pdf.entity; import lombok.Data; /** * @package: com.vinci.pdf.entity * @className: Person * @author: Vinci * @description: 测试用实体 * @date: 2023/11/13 9:56 */ @Data public class Person { /** * @description: 姓名 **/ private String name; /** * @description: 国籍 **/ private String nationality; /** * @description: 居住地 **/ private String address; /** * @description: 民族 **/ private String nation; /** * @description: 户籍地 **/ private String registeredResidence; /** * @description: 身高 / 体重 **/ private String heightAndWeight; /** * @description: 婚姻状况 **/ private String maritalStatus; /** * @description: 年龄 **/ private Integer age; /** * @description: 照片 **/ private String largeHeadPhoto; /** * @description: 这里为了方便测试，在无参构造直接初始化数据来模拟持久化数据。 **/ public Person() { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/2bebfa9e9756a30863ac7e991a4ac0ff/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-14T09:21:24+08:00" />
<meta property="article:modified_time" content="2023-11-14T09:21:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java基于itextPDF实现pdf动态导出</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Java基于itextPDF实现pdf动态导出</h4> 
 <ul><li><a href="#1PDF_6" rel="nofollow">1、制作PDF导出模板</a></li><li><a href="#2_itextpdf_15" rel="nofollow">2 、集成itextpdf</a></li><li><a href="#3__24" rel="nofollow">3 、编写实体</a></li><li><a href="#4__108" rel="nofollow">4 、编写主要代码</a></li><li><a href="#5controller_258" rel="nofollow">5、编写controller并测试</a></li><li><ul><li><a href="#_317" rel="nofollow">补充：踩坑记录</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>现在的业务越来越复杂了，有些业务场景已经不能满足与EXCEL导出和WORD导出了，例如准考证打印，电子证书等等，这些都是动态数据导出的PDF。接下来我们就看一下怎么实现PDF的动态导出吧。</p> 
<h2><a id="1PDF_6"></a>1、制作PDF导出模板</h2> 
<p>第一步，我们需要制作一个PDF模板，可以先使用WORD去制作，制作完成以后再转为PDF。<br> <img src="https://images2.imgbox.com/9a/82/OMd8HG67_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/fe/d2/nSZIZePW_o.png" alt="在这里插入图片描述"><br> 当转为PDF以后，我们就需要去给PDF设置表单域了，表单域的名称和你要填充的数据名称需要一一对应。<br> <img src="https://images2.imgbox.com/4e/2d/p3tlkgCm_o.png" alt="在这里插入图片描述"></p> 
<p>这里推荐几个可以编辑表单域的软件：Adobe Acrobat 、 万兴PDF、PDFill、Nitro<br> 我这里懒省事用的万兴PDF（免费版有水印），具体哪个更好用一点请大家自行判断。</p> 
<h2><a id="2_itextpdf_15"></a>2 、集成itextpdf</h2> 
<p>接下来第二步则是在项目中集成itextpdf，项目中使用的是SpringBoot 2.7 , 同时还集成了lombok.</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.itextpdf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>itextpdf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="3__24"></a>3 、编写实体</h2> 
<p>编写导出PDF需要用到的实体，这里注意，实体中的属性名需要和表单域名一一对应。<br> 同时为了方便测试，在无参构造中初始化了一些默认数据。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>vinci<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>


<span class="token comment">/**
 * @package: com.vinci.pdf.entity
 * @className: Person
 * @author: Vinci
 * @description: 测试用实体
 * @date: 2023/11/13 9:56
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>


    <span class="token comment">/**
     * @description: 姓名
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @description: 国籍
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> nationality<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @description: 居住地
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @description: 民族
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> nation<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @description: 户籍地
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> registeredResidence<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @description: 身高 / 体重
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> heightAndWeight<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @description: 婚姻状况
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> maritalStatus<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @description: 年龄
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @description: 照片
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> largeHeadPhoto<span class="token punctuation">;</span>


    <span class="token comment">/**
     * @description: 这里为了方便测试，在无参构造直接初始化数据来模拟持久化数据。
     **/</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"vinci"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nationality <span class="token operator">=</span> <span class="token string">"中国"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> <span class="token string">"江苏南京"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nation <span class="token operator">=</span> <span class="token string">"汉族"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>registeredResidence <span class="token operator">=</span> <span class="token string">"河南漯河"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>heightAndWeight <span class="token operator">=</span> <span class="token string">"178cm / 65Kg"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maritalStatus <span class="token operator">=</span> <span class="token string">"未婚"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>largeHeadPhoto <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">"static/header1.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="4__108"></a>4 、编写主要代码</h2> 
<p>在Service实现类中编写主要功能，将数据填充到PDF中并实现导出。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>vinci<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">Image</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">Rectangle</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itextpdf<span class="token punctuation">.</span>text<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>vinci<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Person</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>vinci<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span>service<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">PdfGenerateTestService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Objects</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @package: com.vinci.pdf.service.impl
 * @className: PdfGenerateTestServiceImpl
 * @author: Vinci
 * @description: pdf生成测试接口实现
 * @date: 2023/11/13 10:15
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PdfGenerateTestServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PdfGenerateTestService</span> <span class="token punctuation">{<!-- --></span>


    <span class="token comment">/**
     * @description: 日志服务
     **/</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">PdfGenerateTestServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * @description: pdf生成
     * @author: Vinci
     * @date: 2023/11/13 10:25
     **/</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pdfGenerate</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 模板地址</span>
        <span class="token class-name">URL</span> resource <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">"templates/aipuu-y1mhx.pdf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>resource <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"没有找到模板"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">String</span> path <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// PDF的文件名称 及响应头</span>
        <span class="token class-name">String</span> fileName <span class="token operator">=</span> <span class="token string">"test.pdf"</span><span class="token punctuation">;</span>
        fileName <span class="token operator">=</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/force-download"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//如果想要下载文件的话，这里的inline可以替换为 attachment</span>
        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span>
                <span class="token string">"fileName="</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">OutputStream</span> ops <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteArrayOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">PdfStamper</span> pdfStamper <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">PdfReader</span> pdfReader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            ops <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pdfReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PdfReader</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 根据模板生成新的PDF</span>
            pdfStamper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PdfStamper</span><span class="token punctuation">(</span>pdfReader<span class="token punctuation">,</span> bos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">AcroFields</span> form <span class="token operator">=</span> pdfStamper<span class="token punctuation">.</span><span class="token function">getAcroFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 设置字体</span>
            <span class="token class-name">BaseFont</span> font <span class="token operator">=</span> <span class="token class-name">BaseFont</span><span class="token punctuation">.</span><span class="token function">createFont</span><span class="token punctuation">(</span>
                    <span class="token string">"C:/WINDOWS/Fonts/SIMSUN.TTC,1"</span><span class="token punctuation">,</span>
                    <span class="token class-name">BaseFont</span><span class="token punctuation">.</span><span class="token constant">IDENTITY_H</span><span class="token punctuation">,</span>
                    <span class="token class-name">BaseFont</span><span class="token punctuation">.</span><span class="token constant">EMBEDDED</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            form<span class="token punctuation">.</span><span class="token function">addSubstitutionFont</span><span class="token punctuation">(</span>font<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 获取数据(这里在无参构造中生成了一些数据，实际开发中可用持久化数据来代替)</span>
            <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 通过反射遍历来给PDF中的表单生成数据</span>
            <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> person<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> fields<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> key <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span> value <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token string">"largeHeadPhoto"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//处理文本数据</span>
                    form<span class="token punctuation">.</span><span class="token function">setField</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 通过表单域名获取所在页和坐标，左下角为起点</span>
                    <span class="token keyword">int</span> pageNo <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">getFieldPositions</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>page<span class="token punctuation">;</span>
                    <span class="token class-name">Rectangle</span> signRect <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">getFieldPositions</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>position<span class="token punctuation">;</span>
                    <span class="token keyword">float</span> x <span class="token operator">=</span> signRect<span class="token punctuation">.</span><span class="token function">getLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">float</span> y <span class="token operator">=</span> signRect<span class="token punctuation">.</span><span class="token function">getBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 读图片</span>
                    <span class="token class-name">Image</span> image <span class="token operator">=</span> <span class="token class-name">Image</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 获取操作的页面</span>
                    <span class="token class-name">PdfContentByte</span> under <span class="token operator">=</span> pdfStamper<span class="token punctuation">.</span><span class="token function">getOverContent</span><span class="token punctuation">(</span>pageNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 根据域的大小缩放图片</span>
                    image<span class="token punctuation">.</span><span class="token function">scaleToFit</span><span class="token punctuation">(</span>signRect<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> signRect<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 添加图片</span>
                    image<span class="token punctuation">.</span><span class="token function">setAbsolutePosition</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    under<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 设置PDF为只读</span>
            pdfStamper<span class="token punctuation">.</span><span class="token function">setFormFlattening</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 关闭资源</span>
            pdfStamper<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">PdfCopy</span> copy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PdfCopy</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> ops<span class="token punctuation">)</span><span class="token punctuation">;</span>
            doc<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">PdfImportedPage</span> importPage <span class="token operator">=</span> copy<span class="token punctuation">.</span><span class="token function">getImportedPage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PdfReader</span><span class="token punctuation">(</span>bos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            copy<span class="token punctuation">.</span><span class="token function">addPage</span><span class="token punctuation">(</span>importPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            doc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"发现异常"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ops <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    ops<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ops<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>pdfReader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    pdfReader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"发现异常"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="5controller_258"></a>5、编写controller并测试</h2> 
<p>编写Controller来方便我们通过浏览器的请求的方式去测试</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>vinci<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>vinci<span class="token punctuation">.</span>pdf<span class="token punctuation">.</span>service<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">PdfGenerateTestService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>


<span class="token comment">/**
 * @package: com.vinci.pdf.controller
 * @className: PdfGenerateTestController
 * @author: Vinci
 * @description:pdf生成测试controller
 * @date: 2023/11/13 10:16
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/pdf"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PdfGenerateTestController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * @description: 日志打印
     **/</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">PdfGenerateTestController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * @description: 业务接口
     **/</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PdfGenerateTestService</span> pdfGenerateTestService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @description: 测试pdf生成
     * @author: Vinci
     * @date: 2023/11/13 10:17
     **/</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/generate"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pdfGenerate</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
            pdfGenerateTestService<span class="token punctuation">.</span><span class="token function">pdfGenerate</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"发现异常"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>这里我们打开浏览器访问 http://localhost:8080/pdf/generate 发现PDF已经在下载了<br> <img src="https://images2.imgbox.com/5f/fd/iW4tbQTd_o.png" alt="在这里插入图片描述"><br> 下载成功后我们打开，发现里面已经有数据了。<br> <img src="https://images2.imgbox.com/2c/dc/gygrvBvZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_317"></a>补充：踩坑记录</h3> 
<p>使用万兴PDF编辑图片类型的表单域时一定要注意，去掉背景色，否则导出后你会看不到图片<br> <img src="https://images2.imgbox.com/3e/35/fIn8RU4f_o.png" alt="在这里插入图片描述"></p> 
<p>本文代码下载地址：<a href="https://gitee.com/vinci99/springboot-pdf-generate.git" rel="nofollow">https://gitee.com/vinci99/springboot-pdf-generate.git</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/64b5c568099d7717bc26b97cd4640d12/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Apache的顶级项目文件下载地址</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/970dddb34f0bfc01c3b9d81b5be7d446/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2024年计算，信息科学与系统国际会议 (CCISS 2024)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>