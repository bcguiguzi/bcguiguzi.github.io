<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ant-design 的 a-tree-select 使用 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ant-design 的 a-tree-select 使用" />
<meta property="og:description" content="需求：
树形结构中的children 和 labels 需要同时展示在页面
递归处理数据，将labels 合并进入children
展示labels时需要在前面加一个标记○
// 需求1 需求2 /** * @description 获取标签分类的树形结构 */ getData(data, dataIndex) { const list = data.map((item, index) =&gt; { if (item.children &amp;&amp; item.children.length &gt; 0) { item.children = item.children.map((child) =&gt; { return { ...child, type: &#39;children&#39;, // 添加标识符，判断是否为children/labels 给需求4使用 label: child.name, // a-tree-select 中为选中子节点的内容和展示字节点内容做区分 } }) this.getData(item.children, dataIndex &#43; &#39;-&#39; &#43; index) } else { item.children = [] } if (item.labels &amp;&amp; item." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/54fe48170578cca869eb8ff5349aff19/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-24T18:11:38+08:00" />
<meta property="article:modified_time" content="2023-02-24T18:11:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ant-design 的 a-tree-select 使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>需求：</strong><img src="https://images2.imgbox.com/f6/f3/tpezdBWw_o.png" alt="需求"></p> 
<ol><li> <p>树形结构中的children 和 labels 需要同时展示在页面</p> 
  <blockquote> 
   <p>递归处理数据，将labels 合并进入children</p> 
  </blockquote> </li><li> <p>展示labels时需要在前面加一个标记○</p> <pre><code>// 需求1 需求2 
/** 
 * @description 获取标签分类的树形结构
 */
getData(data, dataIndex) {
  const list = data.map((item, index) =&gt; {
    if (item.children &amp;&amp; item.children.length &gt; 0) {
      item.children = item.children.map((child) =&gt; {
        return {
          ...child,
          type: 'children', // 添加标识符，判断是否为children/labels 给需求4使用
          label: child.name, // a-tree-select 中为选中子节点的内容和展示字节点内容做区分
        }
      })
      this.getData(item.children, dataIndex + '-' + index)
    } else {
      item.children = []
    }
    if (item.labels &amp;&amp; item.labels.length &gt; 0) {
      item.children = item.children
        .map((child) =&gt; {
          return {
            ...child,
            type: 'children',
            label: child.name,
          }
        })
        .concat(
          item.labels.map((label) =&gt; {
            return {
              ...label,
              type: 'label',
              label: label.name,
              name: `○ ${label.name}`, // 需求2
            }
          })
        )
    }
    return {
      ...item,
      label: item.name,
      key: dataIndex + '-' + index,
    }
  })
  return list
},
</code></pre> </li><li> <p>选中label时需要去除标记</p> 
  <blockquote> 
   <p>注意事项：<br> - 可以自定义下拉框中的title，展示icon，但是选中时，icon也会出现在输入框中，而且必须在treeData的每一项中加入scopedSlots:{title:‘custom’}，使用时slot=‘custom’<br> - 选中后输入框中显示值可以用 treeNodeLabelProp=“label” 进行显示设置，目前选项有 title/label/id/key，默认选项是title</p> 
  </blockquote> </li></ol> 
<pre><code>	&lt;a-tree-select
       v-model="searchParams.labelIds"
       tree-checkable
       :tree-data="treeData"
       :show-checked-strategy="SHOW_PARENT"
       :replaceFields="{
         title: 'name', //  == 下拉框显示值 ==
         children: 'children',
         value: 'id'
       }"
       search-placeholder="请选择"
       class="color-select"
       style="min-width: 400px"
       :dropdownStyle="{ width: '400px' }"
       :dropdownMatchSelectWidth="false"
       treeNodeLabelProp="label" // == 选中后输入框中显示值 ==
     &gt;
     	&lt;!-- 自定义下拉框中title的内容，配合treeData中加入scopedSlots --&gt;
     	&lt;!-- 
	     	&lt;span  slot="custom" slot-scope="{key, value}"&gt;
	     		&lt;a-icon type="close-circle"  /&gt;
		       {<!-- -->{value}}
		    &lt;/span&gt;
	    --&gt;
	    
	 &lt;/a-tree-select&gt;
</code></pre> 
<ol start="4"><li>选中父节点时，需要将父节点中的labels全部过滤给后端 
  <blockquote> 
   <p>新建一个 new Map()，接收一个 Id1:[labelId1, labelId2]…<br> 选中某个父节点时，直接在Map的get方法获取下面所有的labels</p> 
  </blockquote> </li></ol> 
<p><img src="https://images2.imgbox.com/a9/44/dpmGtQEB_o.png" alt="过滤得到的数据"></p> 
<pre><code>	// 使用时的代码
	let labels = []
    this.searchParams.labelIds.forEach((item) =&gt; {
      if (this.treeDataValues.get(item)) {
        labels = labels.concat(this.treeDataValues.get(item))
      }
    })


	// 数据转化时的代码
	/**
     * @description 获取标签分类中子分类的id
     */
    getLabelIds(data) {
      const list = data
        .map((item) =&gt; {
          if (item.children &amp;&amp; item.children.length &gt; 0) {
          // 只需要存在 label 的父元素 id
            const val = item.children
              .map((child) =&gt; (child.type === 'label' ? child.id : null))
              .filter((i) =&gt; i)
              .concat(this.getLabelIds(item.children))
            // 过滤掉不存在labels
            if (val.length &gt; 0) {
              if (!this.treeDataValues.has(item.id)) { // treeDataValues : new Map()
                this.treeDataValues.set(item.id, val.flat(Infinity)) // 使用es6的方法，将多维数组转化为一维数据， Infinity：代表不管有多少层都转化为一维数组
              }
              return val
              // { [item.id] : val }
            }
          }
        })
        .filter((i) =&gt; i)
      return list
    },
</code></pre> 
<p><strong>数据结构：</strong></p> 
<pre><code>{
    "code":200,
    "traceId":"",
    "message":"成功",
    "data":[
        {
            "id":16,
            "name":"驾驶行为属性",
            "children":[
                {
                    "id":137,
                    "name":"guyufan_test1"
                },
                {
                    "id":148,
                    "name":"温油"
                }
            ],
            "labels":[
                {
                    "id":600024,
                    "name":"智能驾驶"
                },
                {
                    "id":600018,
                    "name":"test8"
                }
            ]
        },
        {
            "id":17,
            "name":"车主使用属性",
            "children":[
                {
                    "id":18,
                    "name":"地图产品",
                    "labels":[
                        {
                            "id":600006,
                            "name":"年龄"
                        },
                        {
                            "id":600005,
                            "name":"销售城市"
                        },
                        {
                            "id":600004,
                            "name":"性别"
                        }
                    ]
                },
                {
                    "id":19,
                    "name":"音乐产品",
                    "children":[
                        {
                            "id":20,
                            "name":"音乐产品行为偏好",
                            "labels":[
                                {
                                    "id":600000,
                                    "name":"用户30天内的驾驶习惯"
                                }
                            ]
                        },
                        {
                            "id":21,
                            "name":"音乐内容偏好",
                            "children":[
                                {
                                    "id":144,
                                    "name":"guyufan_test1"
                                }
                            ]
                        }
                    ]
                },
                {
                    "id":143,
                    "name":"guyufan_test1"
                }
            ]
        },
        {
            "id":15,
            "name":"车主核心属性",
            "children":[
                {
                    "id":117,
                    "name":"guyufan_test2"
                },
                {
                    "id":135,
                    "name":"guyufan_test1"
                },
                {
                    "id":153,
                    "name":"未命名子分类",
                    "children":[
                        {
                            "id":155,
                            "name":"未命名子分类1213"
                        }
                    ]
                }
            ]
        },
        {
            "id":126,
            "name":"guyufan_parent_test4",
            "labels":[
                {
                    "id":600023,
                    "name":"mark3"
                }
            ]
        },
        {
            "id":138,
            "name":"guyufan_parent_test5"
        },
        {
            "id":139,
            "name":"guyufan_parent_test"
        },
        {
            "id":142,
            "name":"guyufan_parent_test645"
        },
        {
            "id":150,
            "name":"未命名分类",
            "children":[
                {
                    "id":152,
                    "name":"未命名子分类"
                }
            ]
        },
        {
            "id":151,
            "name":"guyufan_parent_test6"
        },
        {
            "id":159,
            "name":"未命名分类111"
        }
    ]
}
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/83c840fb4e46468e5948fc3d3b8f99cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">EMOS在线协同办公小程序解决Illegal instruction</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2cfdb5ab84ae0810dcdc16fff56d63a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;中vector容器的三种遍历方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>