<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>此上下文中不支持函数定义。请在代码文件中创建函数_python3从零学习-5.4.6、生成临时文件和目录tempfile... - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="此上下文中不支持函数定义。请在代码文件中创建函数_python3从零学习-5.4.6、生成临时文件和目录tempfile..." />
<meta property="og:description" content="源代码： Lib/tempfile.py 该模块用于创建临时文件和目录，它可以跨平台使用。TemporaryFile、NamedTemporaryFile、TemporaryDirectory 和 SpooledTemporaryFile 是带有自动清理功能的高级接口，可用作上下文管理器。mkstemp() 和 mkdtemp() 是低级函数，使用完毕需手动清理。
所有由用户调用的函数和构造函数都带有参数，这些参数可以设置临时文件和临时目录的路径和名称。该模块生成的文件名包括一串随机字符，在公共的临时目录中，这些字符可以让创建文件更加安全。为了保持向后兼容性，参数的顺序有些奇怪。所以为了代码清晰，建议使用关键字参数。
这个模块定义了以下内容供用户调用：
tempfile.TemporaryFile(mode=&#39;w&#43;b&#39;, buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None) 返回一个 file-like object 作为临时存储区域。创建该文件使用了与 mkstemp() 相同的安全规则。它将在关闭后立即销毁（包括垃圾回收机制关闭该对象时）。在 Unix 下，该文件在目录中的条目根本不创建，或者创建文件后立即就被删除了，其他平台不支持此功能。您的代码不应依赖使用此功能创建的临时文件名称，因为它在文件系统中的名称可能是可见的，也可能是不可见的。
生成的对象可以用作上下文管理器（参见 例子）。完成文件对象的上下文或销毁后，临时文件将从文件系统中删除。
mode 参数默认值为 &#39;w&#43;b&#39; 因此创建的文件可以读取或写入而不用关闭。 因为是使用二进制模式，所以它在所有平台上的行为都保持一致而不用关心所存储的是什么数据。 buffering, encoding 和 newline 的解读方式与 open() 相同。
参数 dir、prefix 和 suffix 的含义和默认值都与它们在 mkstemp() 中的相同。
在 POSIX 平台上，它返回的对象是真实的文件对象。在其他平台上，它是一个文件类对象 (file-like object)，它的 file 属性是底层的真实文件对象。
如果可用，则使用 os.O_TMPFILE 标志（仅限于 Linux，需要 3.11 及更高版本的内核）。
在 3.5 版更改: 如果可用，现在用的是 os.O_TMPFILE 标志。
tempfile.NamedTemporaryFile(mode=&#39;w&#43;b&#39;, buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None, delete=True) 此函数执行的操作与 TemporaryFile() 完全相同，但确保了该临时文件在文件系统中具有可见的名称（在 Unix 上表现为目录条目不取消链接）。从返回的文件类对象的 name 属性中可以检索到文件名。在临时文件仍打开时，是否允许用文件名第二次打开文件，在各个平台上是不同的（在 Unix 上可以，但在 Windows NT 或更高版本上不行）。如果 delete 为 true（默认值），则文件会在关闭后立即被删除。该函数返回的对象始终是文件类对象 (file-like object)，它的 file 属性是底层的真实文件对象。文件类对象可以像普通文件一样在 with 语句中使用。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/880c2bc2ce1e1815c8b448ac93e5beb7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-24T11:38:48+08:00" />
<meta property="article:modified_time" content="2021-01-24T11:38:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">此上下文中不支持函数定义。请在代码文件中创建函数_python3从零学习-5.4.6、生成临时文件和目录tempfile...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/02/67/AlpL3OYF_o.png" alt="3391bd0728588b719ee3b2037ca83458.png"> 
 </div> 
 <h3><b>源代码：</b> Lib/tempfile.py</h3> 
 <p>该模块用于创建临时文件和目录，它可以跨平台使用。TemporaryFile、NamedTemporaryFile、TemporaryDirectory 和 SpooledTemporaryFile 是带有自动清理功能的<b>高级接口</b>，可用作上下文管理器。mkstemp() 和 mkdtemp() 是低级函数，使用完毕需手动清理。</p> 
 <p>所有由用户调用的函数和构造函数都带有参数，这些参数可以设置临时文件和临时目录的路径和名称。该模块生成的文件名包括一串随机字符，在公共的临时目录中，这些字符可以让创建文件更加安全。为了保持向后兼容性，参数的顺序有些奇怪。所以为了代码清晰，建议使用关键字参数。</p> 
 <p><i>这个模块定义了以下内容供用户调用：</i></p> 
 <ul><li><b><i>tempfile.TemporaryFile(mode='w+b', buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None)</i></b></li></ul> 
 <p>返回一个 file-like object 作为临时存储区域。创建该文件使用了与 mkstemp() 相同的安全规则。它将在关闭后立即销毁（包括垃圾回收机制关闭该对象时）。在 Unix 下，该文件在目录中的条目根本不创建，或者创建文件后立即就被删除了，其他平台不支持此功能。您的代码不应依赖使用此功能创建的临时文件名称，因为它在文件系统中的名称可能是可见的，也可能是不可见的。</p> 
 <p>生成的对象可以用作上下文管理器（参见 例子）。完成文件对象的上下文或销毁后，临时文件将从文件系统中删除。</p> 
 <p><i>mode</i> 参数默认值为 'w+b' 因此创建的文件可以读取或写入而不用关闭。 因为是使用二进制模式，所以它在所有平台上的行为都保持一致而不用关心所存储的是什么数据。 <i>buffering</i>, <i>encoding</i> 和 <i>newline</i> 的解读方式与 open() 相同。</p> 
 <p>参数 <i>dir</i>、<i>prefix</i> 和 <i>suffix</i> 的含义和默认值都与它们在 mkstemp() 中的相同。</p> 
 <p>在 POSIX 平台上，它返回的对象是真实的文件对象。在其他平台上，它是一个文件类对象 (file-like object)，它的 file 属性是底层的真实文件对象。</p> 
 <p>如果可用，则使用 os.O_TMPFILE 标志（仅限于 Linux，需要 3.11 及更高版本的内核）。</p> 
 <p><i>在 3.5 版更改: </i>如果可用，现在用的是 os.O_TMPFILE 标志。</p> 
 <ul><li><b><i>tempfile.NamedTemporaryFile(mode='w+b', buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None, delete=True)</i></b></li></ul> 
 <p>此函数执行的操作与 TemporaryFile() 完全相同，但确保了该临时文件在文件系统中具有可见的名称（在 Unix 上表现为目录条目不取消链接）。从返回的文件类对象的 name 属性中可以检索到文件名。在临时文件仍打开时，是否允许用文件名第二次打开文件，在各个平台上是不同的（在 Unix 上可以，但在 Windows NT 或更高版本上不行）。如果 <i>delete</i> 为 true（默认值），则文件会在关闭后立即被删除。该函数返回的对象始终是文件类对象 (file-like object)，它的 file 属性是底层的真实文件对象。文件类对象可以像普通文件一样在 with 语句中使用。</p> 
 <ul><li><b><i>tempfile.SpooledTemporaryFile(max_size=0, mode='w+b', buffering=None, encoding=None, newline=None, suffix=None, prefix=None, dir=None)</i></b></li></ul> 
 <p>此函数执行的操作与 TemporaryFile() 完全相同，但会将数据缓存在内存中，直到文件大小超过 <i>max_size</i>，或调用文件的 fileno() 方法为止，此时数据会被写入磁盘，并且写入操作与 TemporaryFile() 相同。</p> 
 <p>此函数生成的文件对象有一个额外的方法——rollover()，可以忽略文件大小，让文件立即写入磁盘。</p> 
 <p>The returned object is a file-like object whose _file attribute is either an io.BytesIO or io.StringIO object (depending on whether binary or text <i>mode</i> was specified) or a true file object, depending on whether rollover() has been called. This file-like object can be used in a with statement, just like a normal file.</p> 
 <blockquote> 
  <i>在 3.3 版更改: </i>现在，文件的 truncate 方法可接受一个 size 参数。 
 </blockquote> 
 <ul><li><b><i>tempfile.TemporaryDirectory(suffix=None, prefix=None, dir=None)</i></b></li></ul> 
 <p>此函数会安全地创建一个临时目录，且使用与 mkdtemp() 相同的规则。此函数返回的对象可用作上下文管理器。完成上下文或销毁临时目录对象后，新创建的临时目录及其所有内容将从文件系统中删除。</p> 
 <p>The directory name can be retrieved from the name attribute of the returned object. When the returned object is used as a context manager, the name will be assigned to the target of the as clause in the with statement, if there is one.</p> 
 <p>可以调用 cleanup() 方法来手动清理目录。</p> 
 <p><i>3.2 新版功能.</i></p> 
 <ul><li><b><i>tempfile.mkstemp(suffix=None, prefix=None, dir=None, text=False)</i></b></li></ul> 
 <p>以最安全的方式创建一个临时文件。假设所在平台正确实现了 os.open() 的 os.O_EXCL 标志，则创建文件时不会有竞争的情况。该文件只能由创建者读写，如果所在平台用权限位来标记文件是否可执行，那么没有人有执行权。文件描述符不会过继给子进程。</p> 
 <p>与 TemporaryFile() 不同，mkstemp() 用户用完临时文件后需要自行将其删除。</p> 
 <p>如果 <i>suffix</i> 不是 None 则文件名将以该后缀结尾，是 None 则没有后缀。mkstemp() 不会在文件名和后缀之间加点，如果需要加一个点号，请将其放在 <i>suffix</i> 的开头。</p> 
 <p>如果 <i>prefix</i> 不是 None，则文件名将以该前缀开头，是 None 则使用默认前缀。默认前缀是 gettempprefix() 或 gettempprefixb() 函数的返回值（自动调用合适的函数）。</p> 
 <p>如果 <i>dir</i> 不为 None，则在指定的目录创建文件，是 None 则使用默认目录。默认目录是从一个列表中选择出来的，这个列表不同平台不一样，但是用户可以设置 <i>TMPDIR</i>、<i>TEMP</i> 或 <i>TMP</i> 环境变量来设置目录的位置。因此，不能保证生成的临时文件路径很规范，比如，通过 os.popen() 将路径传递给外部命令时仍需要加引号。</p> 
 <p>如果 <i>suffix</i>、<i>prefix</i> 和 <i>dir</i> 中的任何一个不是 None，就要保证它们是同一数据类型。如果它们是 bytes，则返回的名称的类型就是 bytes 而不是 str。如果确实要用默认参数，但又想要返回值是 bytes 类型，请传入 suffix=b''。</p> 
 <p>如果指定了 <i>text</i> 参数，它表示的是以二进制模式（默认）还是文本模式打开文件。在某些平台上，两种模式没有区别。</p> 
 <p>mkstemp() 返回一个元组，元组中第一个元素是句柄，它是一个系统级句柄，指向一个打开的文件（等同于 os.open() 的返回值），第二元素是该文件的绝对路径。</p> 
 <p><i>在 3.5 版更改: </i>现在，<i>suffix</i>、<i>prefix</i> 和 <i>dir</i> 可以以 bytes 类型按顺序提供，以获得 bytes 类型的返回值。之前只允许使用 str。<i>suffix</i> 和 <i>prefix</i> 现在可以接受 None，并且默认为 None 以使用合适的默认值。</p> 
 <ul><li><b><i>tempfile.mkdtemp(suffix=None, prefix=None, dir=None)</i></b></li></ul> 
 <p>以最安全的方式创建一个临时目录，创建该目录时不会有竞争的情况。该目录只能由创建者读取、写入和搜索。</p> 
 <p>mkdtemp() 用户用完临时目录后需要自行将其删除。</p> 
 <p><i>prefix</i>、<i>suffix</i> 和 <i>dir</i> 的含义与它们在 mkstemp() 中的相同。</p> 
 <p>mkdtemp() 返回新目录的绝对路径名。</p> 
 <p><i>在 3.5 版更改: </i>现在，<i>suffix</i>、<i>prefix</i> 和 <i>dir</i> 可以以 bytes 类型按顺序提供，以获得 bytes 类型的返回值。之前只允许使用 str。<i>suffix</i> 和 <i>prefix</i> 现在可以接受 None，并且默认为 None 以使用合适的默认值。</p> 
 <ul><li><b><i>tempfile.gettempdir()</i></b></li></ul> 
 <p>返回放置临时文件的目录的名称。这个方法的返回值就是本模块所有函数的 <i>dir</i> 参数的默认值。</p> 
 <p>Python 搜索标准目录列表，以找到调用者可以在其中创建文件的目录。这个列表是：</p> 
 <ol><li>TMPDIR 环境变量指向的目录。</li><li>TEMP 环境变量指向的目录。</li><li>TMP 环境变量指向的目录。</li><li>与平台相关的位置：</li></ol> 
 <ul><li>在 Windows 上，依次为 C:TEMP、C:TMP、TEMP 和 TMP。</li><li>在所有其他平台上，依次为 /tmp、/var/tmp 和 /usr/tmp。</li></ul> 
 <ol><li>不得已时，使用当前工作目录。</li></ol> 
 <p>搜索的结果会缓存起来，参见下面 tempdir 的描述。</p> 
 <ul><li><b><i>tempfile.gettempdirb()</i></b></li></ul> 
 <p>与 gettempdir() 相同，但返回值为字节类型。</p> 
 <p><i>3.5 新版功能.</i></p> 
 <ul><li><b><i>tempfile.gettempprefix()</i></b></li></ul> 
 <p>返回用于创建临时文件的文件名前缀，它不包含目录部分。</p> 
 <ul><li><b><i>tempfile.gettempprefixb()</i></b></li></ul> 
 <p>与 gettempprefix() 相同，但返回值为字节类型。</p> 
 <p><i>3.5 新版功能.</i></p> 
 <p>本模块使用一个全局变量来存储由 gettempdir() 返回的临时文件目录路径。可以直接给它赋值，这样可以覆盖自动选择的路径，但是不建议这样做。本模块中的所有函数都带有一个 <i>dir</i> 参数，该参数可用于指定目录，这是推荐的方法。</p> 
 <ul><li><b><i>tempfile.tempdir</i></b></li></ul> 
 <p>当设置为 None 以外的其他值时，此变量将决定本模块所有函数的 <i>dir</i> 参数的默认值。</p> 
 <p>如果在调用除 gettempprefix() 外的上述任何函数时 tempdir 为 None (默认值) 则它会按照 gettempdir() 中所描述的算法来初始化。</p> 
 <div class="has"> 
  <pre class="has"><code>例子
以下是 tempfile 模块典型用法的一些示例:
&gt;&gt;&gt; import tempfile 

# create a temporary file and write some data to it
&gt;&gt;&gt; fp = tempfile.TemporaryFile() 
&gt;&gt;&gt; fp.write(b'Hello world!') 
# read data from file
&gt;&gt;&gt; fp.seek(0) 
&gt;&gt;&gt; fp.read() 
b'Hello world!'
# close the file, it will be removed
&gt;&gt;&gt; fp.close() 


# create a temporary file using a context manager
&gt;&gt;&gt; with tempfile.TemporaryFile() as fp: 
...     fp.write(b'Hello world!') 
...     fp.seek(0) 
...     fp.read() 
b'Hello world!'
&gt;&gt;&gt;
# file is now closed and removed


# create a temporary directory using the context manager
&gt;&gt;&gt; with tempfile.TemporaryDirectory() as tmpdirname: 
...   print('created temporary directory', tmpdirname) 
&gt;&gt;&gt;
# directory and contents have been removed</code></pre> 
 </div> 
 <p><br>已弃用的函数和变量<br>创建临时文件有一种历史方法，首先使用 mktemp() 函数生成一个文件名，然后使用该文件名创建文件。不幸的是，这是不安全的，因为在调用 mktemp() 与随后尝试创建文件的进程之间的时间里，其他进程可能会使用该名称创建文件。解决方案是将两个步骤结合起来，立即创建文件。这个方案目前被 mkstemp() 和上述其他函数所采用。</p> 
 <ul><li><b><i>tempfile.mktemp(suffix='', prefix='tmp', dir=None)</i></b></li></ul> 
 <p><i>2.3 版后已移除: </i>使用 mkstemp() 来代替。<br>返回一个绝对路径，这个路径指向的文件在调用本方法时不存在。<i>prefix</i>、<i>suffix</i> 和 <i>dir</i> 参数与 mkstemp() 中的同名参数类似，不同之处在于不支持字节类型的文件名，不支持 suffix=None 和 prefix=None。</p> 
 <p><b>警告</b><br>使用此功能可能会在程序中引入安全漏洞。当你开始使用本方法返回的文件执行任何操作时，可能有人已经捷足先登了。mktemp() 的功能可以很轻松地用 NamedTemporaryFile() 代替，当然需要传递 delete=False 参数:</p> 
 <div class="has"> 
  <pre class="has"><code>&gt;&gt;&gt; f = NamedTemporaryFile(delete=False) 
&gt;&gt;&gt; f.name 
'/tmp/tmptjujjt'
&gt;&gt;&gt; f.write(b"Hello World!n") 
13
&gt;&gt;&gt; f.close() 
&gt;&gt;&gt; os.unlink(f.name) 
&gt;&gt;&gt; os.path.exists(f.name) 
False</code></pre> 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9168dfd0d65ca4a4de27f9ba6642a7e5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">伽马校正(Gamma Correction)与sRGB</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7dc66ee852debce0a83d9b20afcddf2a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">pyqtgragh——动态数据可视化：绘制静态和动态两种数据曲线</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>