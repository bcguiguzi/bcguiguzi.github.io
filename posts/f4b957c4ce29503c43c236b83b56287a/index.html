<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>.NET REST API的数据驱动本地化 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content=".NET REST API的数据驱动本地化" />
<meta property="og:description" content="目录
介绍 NuGet包
文化——本地化基础
文化Provider
数据本地化
本地化扩展方法
Product本地化
Blazor客户端应用程序
本地化数据的关系持久性
本地化表
本地化列
Entity Framework代码优先本地化
Dapper本地化
下载最新的存储库存档下载本地副本 介绍 由于云的高度自动化，软件模型和数据变得越来越动态。让我们以一家在线水果店为例，该商店在多个国家/地区销售其产品。新产品由用户以不同的语言输入。
使用本地化模型数据设计REST API时，必须考虑以下注意事项
需要支持哪些语言？哪些数据需要本地化（文本、数字、图像等）？管理本地化对象需要哪些端点？哪些端点将提供本地化数据？如何在关系数据库系统中管理本地化数据？ 可扩展的REST API将信息分离为可翻译和可读的数据。模型数据管理终结点包含所有本地化数据。在在线商店终结点中，数据以特定语言提供。这样可以节省资源，并且通常可以确保并非所有信息都以所有语言分发。
除了数据本地化之外，对于依赖区域性设置来转换数字、货币和日期数据的REST API来说，以下注意事项也很重要。
REST API产品本地化：
REST客户端标识可用的区域性。产品以多种语言捕获和提交。REST客户端以查询字符串、HTTP请求标头或cookie的形式请求特定语言的产品。REST API返回本地化的产品数据。 NuGet包 若要使用此处所述的本地化功能，必须安装NuGet包 RestApiLocalization.NET。该软件包包括对支持的系统区域性（Culture Provider）的管理以及用于本地化数据的扩展方法。
文化——本地化基础 根据 RFC4646/ISO639/ISO3166 的规则，NET区域性具有唯一的名称，该规则定义了用于确定区域性的三个级别：
Windows系统中注册的语言可以根据以下条件进行选择：
Neutral文化，例如en或de。Specific文化，例如en-US或de-DE。Installed区域性，安装在REST API计算机上。Custom自定义用户区域性。Replacement已替换的默认区域性的区域性。 阅读有关.NET 区域性类型的微尘。
文化Provider 系统区域性函数在ICultureProvider接口中指定，并提供在处理API请求时限制可用区域性和控制工作区域性的能力。
public interface ICultureProvider { /// &lt;summary&gt;Get the default culture name&lt;/summary&gt; string DefaultCultureName { get; } /// &lt;summary&gt;Get the current culture&lt;/summary&gt; CultureInfo CurrentCulture { get; } /// &lt;summary&gt;Get the current UI culture&lt;/summary&gt; CultureInfo CurrentUICulture { get; } /// &lt;summary&gt;Set the current application und UI culture&lt;/summary&gt; void SetCurrentCulture(string cultureName); /// &lt;summary&gt;Get the culture by name&lt;/summary&gt; CultureInfo?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/f4b957c4ce29503c43c236b83b56287a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-12T19:30:00+08:00" />
<meta property="article:modified_time" content="2024-03-12T19:30:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">.NET REST API的数据驱动本地化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%BB%8B%E7%BB%8D%C2%A0-toc" style="margin-left:0px;"><a href="#%E4%BB%8B%E7%BB%8D%C2%A0" rel="nofollow">介绍 </a></p> 
<p id="NuGet%E5%8C%85-toc" style="margin-left:40px;"><a href="#NuGet%E5%8C%85" rel="nofollow">NuGet包</a></p> 
<p id="%E6%96%87%E5%8C%96%E2%80%94%E2%80%94%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%9F%BA%E7%A1%80-toc" style="margin-left:0px;"><a href="#%E6%96%87%E5%8C%96%E2%80%94%E2%80%94%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%9F%BA%E7%A1%80" rel="nofollow">文化——本地化基础</a></p> 
<p id="%E6%96%87%E5%8C%96Provider-toc" style="margin-left:0px;"><a href="#%E6%96%87%E5%8C%96Provider" rel="nofollow">文化Provider</a></p> 
<p id="%E6%95%B0%E6%8D%AE%E6%9C%AC%E5%9C%B0%E5%8C%96-toc" style="margin-left:0px;"><a href="#%E6%95%B0%E6%8D%AE%E6%9C%AC%E5%9C%B0%E5%8C%96" rel="nofollow">数据本地化</a></p> 
<p id="%E6%9C%AC%E5%9C%B0%E5%8C%96%E6%89%A9%E5%B1%95%E6%96%B9%E6%B3%95-toc" style="margin-left:0px;"><a href="#%E6%9C%AC%E5%9C%B0%E5%8C%96%E6%89%A9%E5%B1%95%E6%96%B9%E6%B3%95" rel="nofollow">本地化扩展方法</a></p> 
<p id="Product%E6%9C%AC%E5%9C%B0%E5%8C%96-toc" style="margin-left:40px;"><a href="#Product%E6%9C%AC%E5%9C%B0%E5%8C%96" rel="nofollow">Product本地化</a></p> 
<p id="Blazor%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-toc" style="margin-left:0px;"><a href="#Blazor%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" rel="nofollow">Blazor客户端应用程序</a></p> 
<p id="%E6%9C%AC%E5%9C%B0%E5%8C%96%E6%95%B0%E6%8D%AE%E7%9A%84%E5%85%B3%E7%B3%BB%E6%8C%81%E4%B9%85%E6%80%A7-toc" style="margin-left:0px;"><a href="#%E6%9C%AC%E5%9C%B0%E5%8C%96%E6%95%B0%E6%8D%AE%E7%9A%84%E5%85%B3%E7%B3%BB%E6%8C%81%E4%B9%85%E6%80%A7" rel="nofollow">本地化数据的关系持久性</a></p> 
<p id="%E6%9C%AC%E5%9C%B0%E5%8C%96%E8%A1%A8-toc" style="margin-left:40px;"><a href="#%E6%9C%AC%E5%9C%B0%E5%8C%96%E8%A1%A8" rel="nofollow">本地化表</a></p> 
<p id="%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%88%97-toc" style="margin-left:40px;"><a href="#%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%88%97" rel="nofollow">本地化列</a></p> 
<p id="Entity%20Framework%E4%BB%A3%E7%A0%81%E4%BC%98%E5%85%88%E6%9C%AC%E5%9C%B0%E5%8C%96-toc" style="margin-left:40px;"><a href="#Entity%20Framework%E4%BB%A3%E7%A0%81%E4%BC%98%E5%85%88%E6%9C%AC%E5%9C%B0%E5%8C%96" rel="nofollow">Entity Framework代码优先本地化</a></p> 
<p id="Dapper%E6%9C%AC%E5%9C%B0%E5%8C%96-toc" style="margin-left:40px;"><a href="#Dapper%E6%9C%AC%E5%9C%B0%E5%8C%96" rel="nofollow">Dapper本地化</a></p> 
<hr id="hr-toc"> 
<p></p> 
<ul><li style="text-align:left;"><a href="https://github.com/Giannoudis/RestApiLocalization/archive/main.zip" title="下载最新的存储库存档">下载最新的存储库存档</a></li><li style="text-align:left;"><strong><u><span style="color:#005782;"><a class="link-info" href="https://download.csdn.net/download/mzl87/88947573" title="下载本地副本">下载本地副本</a></span></u></strong></li></ul> 
<h2 id="%E4%BB%8B%E7%BB%8D%C2%A0" style="background-color:transparent;">介绍 </h2> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">由于云的高度自动化，软件模型和数据变得越来越动态。让我们以一家在线水果店为例，该商店在多个国家</span><span style="color:#111111;">/</span><span style="color:#111111;">地区销售其产品。新产品由用户以不同的语言输入。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">使用本地化模型数据设计</span><span style="color:#111111;">REST API</span><span style="color:#111111;">时，必须考虑以下注意事项</span></span></p> 
<ul><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">需要支持哪些语言？</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">哪些数据需要本地化（文本、数字、图像等）？</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">管理本地化对象需要哪些端点？</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">哪些端点将提供本地化数据？</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">如何在关系数据库系统中管理本地化数据？</span></span></li></ul> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">可扩展的</span><span style="color:#111111;">REST API</span><span style="color:#111111;">将信息分离为可翻译和可读的数据。模型数据管理终结点包含所有本地化数据。在在线商店终结点中，数据以特定语言提供。这样可以节省资源，并且通常可以确保并非所有信息都以所有语言分发。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">除了数据本地化之外，对于依赖区域性设置来转换数字、货币和日期数据的</span><span style="color:#111111;">REST API</span><span style="color:#111111;">来说，以下注意事项也很重要。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">REST API</span><span style="color:#111111;">产品本地化：</span></span></p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="510" src="https://images2.imgbox.com/c9/c4/NqiEHoLE_o.png" width="700"></p> 
<ol><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">REST客户端标识可用的区域性。</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">产品以多种语言捕获和提交。</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">REST客户端以查询字符串、HTTP请求标头或cookie的形式请求特定语言的产品。</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">REST API返回本地化的产品数据。</span></span></li></ol> 
<h3 id="NuGet%E5%8C%85" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><strong><span style="color:#111111;">NuGet</span></strong><strong><span style="color:#111111;">包</span></strong></span></h3> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">若要使用此处所述的本地化功能，必须安装</span><span style="color:#111111;">NuGet</span><span style="color:#111111;">包</span> <span style="color:#000000;"><a href="https://www.nuget.org/packages/RestApiLocalization.NET/" rel="nofollow" title="RestApiLocalization.NET">RestApiLocalization.NET</a></span><span style="color:#111111;">。该软件包包括对支持的系统区域性（</span><span style="color:#990000;">Culture Provider</span><span style="color:#111111;">）的管理以及用于本地化数据的扩展方法。</span></span></p> 
<h2 id="%E6%96%87%E5%8C%96%E2%80%94%E2%80%94%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%9F%BA%E7%A1%80" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#ff9900;">文化——本地化基础</span></span></h2> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">根据</span> <span style="color:#000000;"><a href="https://learn.microsoft.com/en-us/dotnet/api/system.globalization.cultureinfo#culture-names-and-identifiers" rel="nofollow" title="RFC4646/ISO639/ISO3166">RFC4646/ISO639/ISO3166</a></span> <span style="color:#111111;">的规则，</span><span style="color:#111111;">NET</span><span style="color:#111111;">区域性具有唯一的名称，该规则定义了用于确定区域性的三个级别：</span></span></p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="335" src="https://images2.imgbox.com/28/b4/2QI68Xhl_o.png" width="698"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">Windows</span><span style="color:#111111;">系统中注册的语言可以根据以下条件进行选择：</span></span></p> 
<ul><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;"><span style="color:#990000;">Neutral</span>文化，例如<span style="color:#990000;">en</span>或<span style="color:#990000;">de</span>。</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;"><span style="color:#990000;">Specific</span>文化，例如<span style="color:#990000;">en-US</span>或<span style="color:#990000;">de-DE</span>。</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;"><span style="color:#990000;">Installed</span>区域性，安装在REST API计算机上。</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;"><span style="color:#990000;">Custom</span>自定义用户区域性。</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;"><span style="color:#990000;">Replacement</span>已替换的默认区域性的区域性。</span></span></li></ul> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">阅读有关</span><span style="color:#111111;">.NET </span><span style="color:#000000;"><a href="https://learn.microsoft.com/en-us/dotnet/api/system.globalization.culturetypes" rel="nofollow" title="区域性类型的">区域性类型的</a></span><span style="color:#111111;">微尘。</span></span></p> 
<h2 id="%E6%96%87%E5%8C%96Provider" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#ff9900;">文化</span><span style="color:#ff9900;">Provider</span></span></h2> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">系统区域性函数在</span><span style="color:#990000;">ICultureProvider</span><span style="color:#111111;">接口中指定，并提供在处理</span><span style="color:#111111;">API</span><span style="color:#111111;">请求时限制可用区域性和控制工作区域性的能力。</span></span></p> 
<div> 
 <pre><code class="language-cs">public interface ICultureProvider
{
    /// &lt;summary&gt;Get the default culture name&lt;/summary&gt;
    string DefaultCultureName { get; }

    /// &lt;summary&gt;Get the current culture&lt;/summary&gt;
    CultureInfo CurrentCulture { get; }

   /// &lt;summary&gt;Get the current UI culture&lt;/summary&gt;
    CultureInfo CurrentUICulture { get; }

    /// &lt;summary&gt;Set the current application und UI culture&lt;/summary&gt;
    void SetCurrentCulture(string cultureName);

    /// &lt;summary&gt;Get the culture by name&lt;/summary&gt;
    CultureInfo? GetCulture(string cultureName);

    /// &lt;summary&gt;Get the supported cultures&lt;/summary&gt;
    IList&lt;CultureInfo&gt; GetSupportedCultures();

    /// &lt;summary&gt;Get the supported culture descriptions&lt;/summary&gt;
    IList&lt;CultureDescription&gt; GetSupportedCultureDescriptions();
}</code></pre> 
 <p></p> 
</div> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">在</span><span style="color:#111111;">REST</span><span style="color:#111111;">应用程序中，本地化服务是在启动时设置的。</span></span></p> 
<div> 
 <pre><code class="language-cs">public static void Main(string[] args)
{
    var builder = WebApplication.CreateBuilder(args);
    ...

    // localization
    // use AddLocalizationWithRequest() to register the request localization
    builder.Services.AddLocalization(
        cultureScope: new(
            neutral: true,
            specific: true,
            installed: true,
            custom: false,
            replacement: false),
        supportedCultures: new[]
            {
                "en", "en-US", "en-GB",
                "de", "de-DE", "de-AT", "de-CH",
                "zh",
            },
        defaultCulture: "en-US");

    var app = builder.Build();
    ...
}</code></pre> 
 <p></p> 
</div> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#990000;">CultureScope</span><span style="color:#111111;">基本上定义了哪些系统区域性可用。这些可以用</span><span style="color:#990000;">SupportedCultures</span><span style="color:#111111;">进一步限制。如果事先知道数据可以本地化为哪些语言，则限制可用区域性是有意义的。对于不知道数据将被翻译成哪种语言的通用</span><span style="color:#111111;">REST API</span><span style="color:#111111;">，则不需要此限制。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">区域性提供程序包含</span><span style="color:#111111;">ASP.NET Core</span><span style="color:#111111;">本地化</span><span style="color:#111111;"><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/localization/select-language-culture" rel="nofollow" title="请求本地化">请求本地化</a></span><span style="color:#111111;">所需的所有信息。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">区域性提供程序在</span><span style="color:#111111;">DI</span><span style="color:#111111;">中注册为单一实例，可在</span><span style="color:#111111;">REST API</span><span style="color:#111111;">控制器中用于提供来自区域性</span><span style="color:#111111;">API</span><span style="color:#111111;">的信息：</span></span></p> 
<div> 
 <pre><code class="language-cs">[ApiController]
[Route(&lt;span class="pl-s"&gt;"cultures")&lt;/span&gt;]
public class CulturesController : ControllerBase
{
    private ICultureProvider CultureProvider { get; }
    public CulturesController(ICultureProvider cultureProvider)
    {
        CultureProvider = cultureProvider;
    }

    [HttpGet(Name = &lt;span class="pl-s"&gt;"GetCultures")&lt;/span&gt;]
    public IEnumerable&lt;string&gt; GetCultures() =&gt;
        CultureProvider.GetSupportedCultures()
            .Select(x =&gt; x.Name).ToList();

    [HttpGet(&lt;span class="pl-s"&gt;"description", Name = "GetCultureDescriptions")&lt;/span&gt;]
    public IEnumerable&lt;CultureDescription&gt; GetCultureDescriptions() =&gt;
        CultureProvider.GetSupportedCultureDescriptions();
}</code></pre> 
 <p></p> 
</div> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">此示例使用</span><span style="color:#990000;">GetCultures</span><span style="color:#111111;">返回区域性名称列表，并使用</span><span style="color:#990000;">GetCultureDescriptions</span><span style="color:#111111;">端点返回英文和本机的可读描述列表。</span></span></p> 
<h2 id="%E6%95%B0%E6%8D%AE%E6%9C%AC%E5%9C%B0%E5%8C%96" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#ff9900;">数据本地化</span></span></h2> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">本地化基于</span><span style="color:#111111;">C#</span><span style="color:#111111;">类属性的约定。本地化以字符串</span><span style="color:#111111;">/</span><span style="color:#111111;">值字典的形式存储在名为</span><span style="color:#990000;">&lt;PropertyName&gt;Localizations</span><span style="color:#111111;">的属性中。示例产品将</span><span style="color:#990000;">Name</span><span style="color:#111111;">属性本地化为</span><span style="color:#990000;">NameLocalizations</span><span style="color:#111111;">，</span><span style="color:#990000;">Price</span><span style="color:#111111;">属性为</span><span style="color:#990000;">PriceLocalizations</span><span style="color:#111111;">。</span></span></p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="206" src="https://images2.imgbox.com/6f/23/ULP20iFl_o.png" width="698"></p> 
<h2 id="%E6%9C%AC%E5%9C%B0%E5%8C%96%E6%89%A9%E5%B1%95%E6%96%B9%E6%B3%95" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#ff9900;">本地化扩展方法</span></span></h2> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">本地化库包含多个用于对象本地化的扩展方法。</span></span></p> 
<div> 
 <pre><code class="language-cs">/// Test if localization property exists
bool IsLocalizable(this Type type, string propertyName);

/// Get the property localization values
Dictionary&lt;string, object?&gt; GetLocalizations&lt;TObject&gt;(
  this TObject obj, string propertyName);

/// Get an optional localized property value
object? GetOptionalLocalization&lt;TObject&gt;(
  this TObject obj, string propertyName, string? culture = null);

/// Get an optional localized property value
TValue? GetOptionalLocalization&lt;TObject, TValue&gt;(
  this TObject obj, string propertyName, string? culture = null);

/// Get the localized property value
TValue GetLocalization&lt;TObject, TValue&gt;(
  this TObject obj, string propertyName, string? culture = null);

/// Map all source object localized values to the target object base properties
TTarget MapLocalizations&lt;TTarget, TSource&gt;(
  this TTarget target, TSource source, string? culture = null);

/// Map a source object localized value to the target object base property
void MapLocalization&lt;TTarget, TSource&gt;(
  this TTarget target, TSource source, string propertyName, string? culture = null)</code></pre> 
 <h3 id="Product%E6%9C%AC%E5%9C%B0%E5%8C%96"><span style="background-color:#FFFFFF;"><span style="color:#ff9900;">Product</span><span style="color:#ff9900;">本地化</span></span></h3> 
</div> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">以下产品可用于水果在线商店。</span></span></p> 
<div> 
 <pre><code class="language-javascript">[
  {
    "name": "Nectarine",
    "nameLocalizations": {
      "en": "Nectarine",
      "de": "Nektarine",
      "zh-CN": "油桃"
    },
    "price": 0,
    "priceLocalizations": {
      "en": 3,
      "de": 3.6,
      "de-CH": 3.9,
      "zh-CN": 2.8
    }
  },
  {
    "name": "GoldenMelon",
    "nameLocalizations": {
      "en": "Golden Melon",
      "de": "Honigmelone",
      "zh-CN": "金瓜"
    },
    "price": 0,
    "priceLocalizations": {
      "en": 4.5,
      "de": 5.7,
      "de-CH": 6.2,
      "zh-CN": 4
    }
  }
]</code></pre> 
 <p></p> 
</div> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">该产品由以下</span><span style="color:#111111;">DTO</span><span style="color:#111111;">描述：</span></span></p> 
<div> 
 <pre><code class="language-cs">public class ProductDto
{
    public string Name { get; set; } = string.Empty;
    public decimal Price { get; set; }
}</code></pre> 
 <p></p> 
</div> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">在产品控制器中，</span><span style="color:#990000;">GetProducts</span><span style="color:#111111;">终结点返回可本地化的产品，该</span><span style="color:#990000;">GetProductsDto</span><span style="color:#111111;">方法返回存储的</span><span style="color:#111111;">DTO</span><span style="color:#111111;">。</span></span></p> 
<div> 
 <pre><code class="language-cs">[ApiController]
[Route(&lt;span class="pl-s"&gt;"products")&lt;/span&gt;]
public class ProductsController : ControllerBase
{

    [HttpGet(Name = &lt;span class="pl-s"&gt;"GetProducts")&lt;/span&gt;]
    public IEnumerable&lt;Product&gt; GetProducts()
    {
        var products = new ProductService().GetProducts();
        return products;
    }

    [HttpGet(&lt;span class="pl-s"&gt;"dto", Name = "GetProductsDto")&lt;/span&gt;]
    public IEnumerable&lt;ProductDto&gt; GetProductsDto(
        [FromQuery] string? culture = null)
    {
        // map products to dto objects
        var config = new MapperConfiguration(
            cfg =&gt; cfg.CreateMap&lt;Product, ProductDto&gt;());
        var mapper = new Mapper(config);

        var products = new ProductService().GetProducts();
        var dataProducts = products.ConvertAll(
            // map object
            x =&gt; mapper.Map&lt;ProductDto&gt;(x)
                // map localizations
                .MapLocalizations(x, culture)).ToList();
        return dataProducts;
    }
}</code></pre> 
 <p></p> 
</div> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">若要将产品转换为</span><span style="color:#111111;">DTO</span><span style="color:#111111;">，首先使用</span><span style="color:#111111;"> <a href="https://github.com/AutoMapper/AutoMapper" title="AutoMapper">AutoMapper</a>  </span><span style="color:#990000;">mapper.Map&lt;ProductDto&gt;</span><span style="color:#111111;">映射对象，然后</span><span style="color:#990000;">MapLocalizations()</span><span style="color:#111111;">用于将本地化应用于</span><span style="color:#111111;">DTO</span><span style="color:#111111;">。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">此示例的</span><span style="color:#111111;">REST API</span><span style="color:#111111;">可以使用</span><span style="color:#111111;">Visual Studio</span><span style="color:#111111;">解决方案</span><span style="color:#990000;">ObjectLocalization.WebApi.sln</span><span style="color:#111111;">启动。</span></span></p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="615" src="https://images2.imgbox.com/14/cc/DzAzoXW5_o.png" width="699"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">为了简化示例，产品存储在本地</span><span style="color:#111111;">JSON</span><span style="color:#111111;">文件中。</span></span></p> 
<h2 id="Blazor%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#ff9900;">Blazor</span><span style="color:#ff9900;">客户端应用程序</span></span></h2> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">为了说明客户端中的本地化，有一个使用开源</span><span style="color:#111111;"> <a href="https://github.com/MudBlazor/MudBlazor" title="MudBlazor">MudBlazor</a> UI</span><span style="color:#111111;">框架的</span><span style="color:#111111;">Blazor</span><span style="color:#111111;">应用程序。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">应用程序在</span><span style="color:#990000;">Cultures</span><span style="color:#111111;">页面上列出了</span><span style="color:#111111;">REST API</span><span style="color:#111111;">的可用语言。</span></span></p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="597" src="https://images2.imgbox.com/b0/22/9xHktslB_o.png" width="697"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">该</span><span style="color:#990000;">Products</span><span style="color:#111111;">页面列出了产品，包括所有翻译，以及列出的</span><span style="color:#111111;">DTO</span><span style="color:#111111;">。</span></span></p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="358" src="https://images2.imgbox.com/f7/7f/eD7isj30_o.png" width="698"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">DTO</span><span style="color:#111111;">产品会随着</span><span style="color:#990000;">Culture</span><span style="color:#111111;">变化而相应地进行调整。</span></span></p> 
<h2 id="%E6%9C%AC%E5%9C%B0%E5%8C%96%E6%95%B0%E6%8D%AE%E7%9A%84%E5%85%B3%E7%B3%BB%E6%8C%81%E4%B9%85%E6%80%A7" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#ff9900;">本地化数据的关系持久性</span></span></h2> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">可以通过多种方式在关系数据库中实现本地化数据：</span></span></p> 
<ul><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;"><span style="color:#990000;">Table</span>：本地化在单独的表中维护。</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;"><span style="color:#990000;">Column</span>：本地化在附加列中以JSON形式进行管理。</span></span></li></ul> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">哪种变体有意义取决于几个因素</span></span></p> 
<ul><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">本地化是否可索引（性能）-&gt;表</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">本地化是否可寻址（模型引用）-&gt;表</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">本地化是可搜索的（REST请求）-&gt; 表（简单）还是列（复杂）</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">本地化对象是否保持紧凑（审核）-&gt; 列</span></span></li><li style="text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">数据模型是否应尽可能简单-&gt;列</span></span></li></ul> 
<h3 id="%E6%9C%AC%E5%9C%B0%E5%8C%96%E8%A1%A8" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#ff9900;">本地化表</span></span></h3> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">此变体为每个可本地化的字段创建一个本地化表。</span></span></p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="404" src="https://images2.imgbox.com/61/8c/B6SefQBB_o.png" width="689"></p> 
<h3 id="%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%88%97" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#ff9900;">本地化列</span></span></h3> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">当本地化数据存储在附加列中时，它将序列化为</span><span style="color:#111111;"> JSON</span><span style="color:#111111;">。</span></span></p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="409" src="https://images2.imgbox.com/ff/ff/UXjKbS5T_o.png" width="664"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">大多数</span><span style="color:#111111;">ORM</span><span style="color:#111111;">工具都提供了在字段中序列化字典的功能。</span></span></p> 
<h3 id="Entity%20Framework%E4%BB%A3%E7%A0%81%E4%BC%98%E5%85%88%E6%9C%AC%E5%9C%B0%E5%8C%96" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><strong><span style="color:#111111;">Entity Framework</span></strong><strong><span style="color:#111111;">代码优先本地化</span></strong></span></h3> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">将</span><span style="color:#111111;"><a href="https://learn.microsoft.com/en-us/ef/core/modeling/entity-properties" rel="nofollow" title="NotMapped">NotMapped</a></span><span style="color:#111111;">属性与包含序列化</span><span style="color:#111111;">JSON</span><span style="color:#111111;">的其他字符串字段一起使用。</span></span></p> 
<div> 
 <pre><code class="language-cs">using System.Text.Json;
public class Product
{
    public string Name { get; set; }
    [NotMapped]
    public Dictionary&lt;string, string&gt; NameLocalizations  { get; set; }
    public string NameLocalizationsJson
    {
        get =&gt; JsonSerializer.Serialize&lt;Dictionary&lt;string, string&gt;&gt;(NameLocalizations);
        set =&gt; NameLocalizations = JsonSerializer.Deserialize&lt;Dictionary&lt;string, string&gt;(value);
    }

    public decimal Price { get; set; }
    [NotMapped]
    public Dictionary&lt;string, decimal&gt; PriceLocalizations  { get; set; }
    public decimal PriceLocalizationsJson
    {
        get =&gt; JsonSerializer.Serialize&lt;Dictionary&lt;string, decimal&gt;&gt;(PriceLocalizations);
        set =&gt; PriceLocalizations = JsonSerializer.Deserialize&lt;Dictionary&lt;string, decimal&gt;&gt;(value);
    }
}</code></pre> 
 <p></p> 
</div> 
<h3 id="Dapper%E6%9C%AC%E5%9C%B0%E5%8C%96" style="margin-left:0px;text-align:left;"><span style="background-color:#FFFFFF;"><strong><span style="color:#111111;">Dapper</span></strong><strong><span style="color:#111111;">本地化</span></strong></span></h3> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">使用</span><span style="color:#111111;">Dapper</span><span style="color:#111111;">，您可以使用自定义类型处理程序转换数据。</span></span></p> 
<div> 
 <pre><code class="language-cs">using System.Text.Json;
public class NamedDictionaryTypeHandler&lt;TValue&gt; : 
             SqlMapper.TypeHandler&lt;Dictionary&lt;string, TValue&gt;&gt;
{
    public override void SetValue(IDbDataParameter parameter, 
                                  Dictionary&lt;string, TValue&gt; value)
    {
        parameter.Value = JsonSerializer.Serialize&lt;Dictionary&lt;string, TValue&gt;&gt;(value);
    }

    public override Dictionary&lt;string, TValue&gt; Parse(object value)
    {
        var json = value as string;
        if (string.IsNullOrWhiteSpace(json))
        {
            return null;
        }
        return JsonSerializer.Deserialize&lt;Dictionary&lt;string, TValue&gt;&gt;(json);
    }
}</code></pre> 
 <p><span style="background-color:#FFFFFF;"><span style="color:#111111;">类型处理程序必须在程序开始时以</span><span style="color:#990000;">SqlMapper.AddTypeHandler(new NamedDictionaryTypeHandler&lt;object&gt;());</span><span style="color:#111111;">注册。</span></span></p> 
</div> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#FFFFFF;"><span style="color:#111111;">本文最初发表于</span> <span style="color:#000000;"><a href="https://github.com/Giannoudis/RestApiLocalization" title="GitHub - Giannoudis/RestApiLocalization: REST API Localization for .NET">GitHub - Giannoudis/RestApiLocalization: REST API Localization for .NET</a></span></span></p> 
<p style="margin-left:0;text-align:justify;"><a class="link-info" href="https://www.codeproject.com/Articles/5367347/Data-driven-Localization-for-NET-REST-APIs" rel="nofollow" title="https://www.codeproject.com/Articles/5367347/Data-driven-Localization-for-NET-REST-APIs">https://www.codeproject.com/Articles/5367347/Data-driven-Localization-for-NET-REST-APIs</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/656d028a75812936542b4e9756d2a4b7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android http server</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/de0de755130ca2caa79b0520d94e78fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">探索性数据分析EDA的数据可视化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>