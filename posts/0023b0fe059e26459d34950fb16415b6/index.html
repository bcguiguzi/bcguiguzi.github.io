<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>一阶低通滤波 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="一阶低通滤波" />
<meta property="og:description" content="一阶低通滤波 前言：在使用单片机开发中，常常会用到的外设包括ADC采样。而采样必然会伴随这随机干扰引起的毛刺噪声，对于需要捕捉采样值突变的系统来说尤其需要减小毛刺突变的影响。从硬件电路和软件算法上都能一定程度的减少噪声达到滤波的目的，本文主要讲解软件使用低通滤波算法来滤波ADC采样值的方法。
一阶低通滤波（又叫惯性滤波）算法 算法原理 滤波算法公式：
Y(n) = a * X(n) &#43; (1 - a) * Y(n - 1)
Y(n)：本次滤波结果。
a：滤波系数。取值范围为0~1, 值越小越稳定，越大越灵敏。
X(n)：本次采样值。
Y(n - 1)：上次滤波结果。
C代码实现 //一阶低通滤波 #define FO_LOW_PASS_FILTER_SENSITIVE_a 0.8f //一阶低通滤波系数取值范围为(0,1)。值越小越稳定，越大越灵敏，二者难兼顾。 #define FO_LOW_PASS_FILTER_STEADY_a 0.15f //输入Adc采样值，输出低通滤波值 //优点：调节精细，稳定度和灵敏度偏向分明。缺点：带有浮点运算 #define FOLowPassFilter(AdcSample, a) \ { \ g_u16FOLowPassFilterResult = (uint16_t)(a * AdcSample &#43; (1 - a) * g_u16FOLowPassFilterResultL); \ g_u16FOLowPassFilterResultL = g_u16FOLowPassFilterResult; \ } 一阶低通滤波算法特点 1. 相比于硬件滤波，软件滤波节省成本，可靠性高，滤波范围可以由软件任意修改（硬件需要考虑阻抗匹配问题）。 2. 一阶低通滤波运算量小，需要调节的参数少，易于软件实现和单片机快速处理，是实时性强的滤波。 使用一阶低通滤波算法的缺点：
1. 滤波系数越小，滤波结果越稳定，滤波系数越大结果越灵敏。稳定性和灵敏性二者难兼顾。
算法改进 系数a取较小值时（偏稳定） 图中蓝色表示原始ADC采样值，橙色为滤波后的值，其他图片也这样。当电压不变化时采集到的ADC采样值实际存在很多毛刺噪声，选取较小的a值则能有效减小毛刺的幅度，使信号趋于稳定，防止误判。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/0023b0fe059e26459d34950fb16415b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-24T16:19:20+08:00" />
<meta property="article:modified_time" content="2019-09-24T16:19:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">一阶低通滤波</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="centercenter_0"></a> 
 <center>
   一阶低通滤波 
 </center></h2> 
<p><em>前言：在使用单片机开发中，常常会用到的外设包括ADC采样。而采样必然会伴随这随机干扰引起的毛刺噪声，对于需要捕捉采样值突变的系统来说尤其需要减小毛刺突变的影响。从硬件电路和软件算法上都能一定程度的减少噪声达到滤波的目的，本文主要讲解软件使用低通滤波算法来滤波ADC采样值的方法。</em></p> 
<h4><a id="_4"></a>一阶低通滤波（又叫惯性滤波）算法</h4> 
<h6><a id="_5"></a>算法原理</h6> 
<p>  滤波算法公式：<br> Y(n) = a * X(n) + (1 - a) * Y(n - 1)</p> 
<p>Y(n)：本次滤波结果。<br> a：滤波系数。取值范围为0~1, 值越小越稳定，越大越灵敏。<br> X(n)：本次采样值。<br> Y(n - 1)：上次滤波结果。</p> 
<h6><a id="C_14"></a>C代码实现</h6> 
<pre><code class="prism language-c"><span class="token comment">//一阶低通滤波</span>
<span class="token macro property">#<span class="token directive keyword">define</span> FO_LOW_PASS_FILTER_SENSITIVE_a                   0.8f                        </span><span class="token comment">//一阶低通滤波系数取值范围为(0,1)。值越小越稳定，越大越灵敏，二者难兼顾。</span>
<span class="token macro property">#<span class="token directive keyword">define</span> FO_LOW_PASS_FILTER_STEADY_a                      0.15f</span>
<span class="token comment">//输入Adc采样值，输出低通滤波值</span>
<span class="token comment">//优点：调节精细，稳定度和灵敏度偏向分明。缺点：带有浮点运算</span>
<span class="token macro property">#<span class="token directive keyword">define</span> FOLowPassFilter(AdcSample, a)                                                                                                       \
{                                                                                                                                           \
    g_u16FOLowPassFilterResult = (uint16_t)(a * AdcSample + (1 - a) * g_u16FOLowPassFilterResultL);                                         \
    g_u16FOLowPassFilterResultL = g_u16FOLowPassFilterResult;                                                                               \
}</span>
</code></pre> 
<h6><a id="_28"></a>一阶低通滤波算法特点</h6> 
<pre><code>1. 相比于硬件滤波，软件滤波节省成本，可靠性高，滤波范围可以由软件任意修改（硬件需要考虑阻抗匹配问题）。  
2. 一阶低通滤波运算量小，需要调节的参数少，易于软件实现和单片机快速处理，是实时性强的滤波。  
</code></pre> 
<p>使用一阶低通滤波算法的缺点：<br> 1. 滤波系数越小，滤波结果越稳定，滤波系数越大结果越灵敏。稳定性和灵敏性二者难兼顾。</p> 
<h4><a id="_35"></a>算法改进</h4> 
<h6><a id="a_36"></a>系数a取较小值时（偏稳定）</h6> 
<p><img src="https://images2.imgbox.com/0f/f9/hufDXf23_o.png" alt="在这里插入图片描述"></p> 
<p>  图中蓝色表示原始ADC采样值，橙色为滤波后的值，其他图片也这样。当电压不变化时采集到的ADC采样值实际存在很多毛刺噪声，选取较小的a值则能有效减小毛刺的幅度，使信号趋于稳定，防止误判。</p> 
<p><img src="https://images2.imgbox.com/a2/9b/lmkigl70_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/92/b2/zs2dhEpY_o.png" alt="在这里插入图片描述"></p> 
<p>  选取较小a值时，稳定段过滤很多毛刺噪声，但灵敏性（跟随性）较差，信号幅度变化明显时滤波结果明显滞后，且无法达到波峰波谷值。</p> 
<h6><a id="a_46"></a>系数a取较大时（偏灵敏）</h6> 
<p>  特点与a较小时相反，滤波结果有较好的跟随性，但消除毛刺噪声能力差。</p> 
<h6><a id="_49"></a>使用动态系数</h6> 
<p>  既然一阶低通滤波无法同时兼容滤波的稳定性和灵敏性， 那么我们可以根据实际情况，在采样值较低且变换幅度较小时使用小系数偏稳定性，当检测到采样值大于一定范围且增幅明显时立刻且大系数偏灵敏性。</p> 
<p>代码示例：</p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">define</span> Filter(AdcSample)                                                                                               \
{                                                                                                                       \
    if(g_u16AdcSampleVal &gt; g_u16AdcInitBaseVal)                                                                         \
    {                                                                                                                   \
        if((DifferenceAbs(g_u16AdcSampleVal, g_u16AdcSampleValL) &lt;= ADC_SAMPLE_LARGE_JUMP)   </span><span class="token comment">/*采样值无大幅度跳变*/</span>     \
         <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">DifferenceAbs</span><span class="token punctuation">(</span>g_u16AdcSampleVal<span class="token punctuation">,</span> g_u16AdcSampleValLL<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> ADC_SAMPLE_LARGE_JUMP<span class="token punctuation">)</span><span class="token punctuation">)</span>                           \
        <span class="token punctuation">{<!-- --></span>                                                                                                               \
            <span class="token function">FOLowPassFilter</span><span class="token punctuation">(</span>AdcSample<span class="token punctuation">,</span> FO_LOW_PASS_FILTER_STEADY_a<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/*一阶低通滤波,偏稳定*/</span>                       \
        <span class="token punctuation">}</span>                                                                                                               \
        <span class="token keyword">else</span>                                                                                                            \
        <span class="token punctuation">{<!-- --></span>                                                                                                               \
            <span class="token function">FOLowPassFilter</span><span class="token punctuation">(</span>AdcSample<span class="token punctuation">,</span> FO_LOW_PASS_FILTER_SENSITIVE_a<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/*一阶低通滤波,偏灵敏*/</span>                       \
        <span class="token punctuation">}</span>                                                                                                               \
    <span class="token punctuation">}</span>                                                                                                                   \
    <span class="token keyword">else</span>                                                                                                                \
    <span class="token punctuation">{<!-- --></span>                                                                                                                   \
        <span class="token function">FOLowPassFilter</span><span class="token punctuation">(</span>AdcSample<span class="token punctuation">,</span> FO_LOW_PASS_FILTER_STEADY_a<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">/*一阶低通滤波,偏稳定*/</span>                       \
    <span class="token punctuation">}</span>                                                                                                                   \
<span class="token punctuation">}</span>
</code></pre> 
<p>效果展示：<br> <img src="https://images2.imgbox.com/de/c6/zItMBICB_o.png" alt='[外链图片转存失败(img-PZAXWohS-1569312974471)(.\png\动态系数兼顾稳定性和灵敏度.png "动态系数")]'><br> <img src="https://images2.imgbox.com/20/f7/WD4Qzv8C_o.png" alt='[外链图片转存失败(img-hBVXKAf4-1569312974471)(.\png\a0.3.png "兼顾稳定和灵敏")]'></p> 
<h6><a id="_79"></a>算法改进</h6> 
<p>  以下算法时一阶低通滤波的变形，可以避免单片机做浮点运算，如果你的单片机浮点运算的性能较差可以使用该变形公式。这个公式不是我发明的，是由一个大佬传授给我的，我将其拿出来分享。</p> 
<pre><code class="prism language-c"><span class="token comment">//一阶低通滤波变形</span>
<span class="token macro property">#<span class="token directive keyword">define</span> FO_LOW_PASS_FILTER_EXTERN_SENSITIVE_a            1u                          </span><span class="token comment">//值越大越稳定，越小越灵敏，二者难兼顾。</span>
<span class="token macro property">#<span class="token directive keyword">define</span> FO_LOW_PASS_FILTER_EXTERN_STEADY_a               7u </span>
<span class="token comment">//一阶低通滤波变形，此方法为网上借鉴</span>
<span class="token comment">//优点：无浮点运算。缺点：调节粗糙。</span>
<span class="token macro property">#<span class="token directive keyword">define</span> FOLowPassFilterExtern(AdcSample, a)                                                                                                 \
{                                                                                                                                           \
    g_u16FOLowPassFilterResult = AdcSample + g_u16FOLowPassFilterResultL * a;                                                               \
    g_u16FOLowPassFilterResult = g_u16FOLowPassFilterResult / (a + 1);                                                                      \
    g_u16FOLowPassFilterResultL = g_u16FOLowPassFilterResult;                                                                               \
}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5cfc8a8cf27d78faa009db07b1396d34/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C# 并行编程 PLINQ</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/aabb1d7ca956c738f4f3b7b7ff2f5826/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">代码整洁之道读书笔记 1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>