<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>安卓系统启动流程 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="安卓系统启动流程" />
<meta property="og:description" content="安卓系统主要启动流程如下：
启动电源以及系统启动引导程序 BootLoaderLinux 内核启动init 进程启动Zygote 进程启动SystemServer 进程启动Launcher 启动 一、init 进程启动过程 init 过程启动过程中主要做了以下三件事：
创建和挂在启动所需的目录文件初始化和启动属性服务：属性服务采用键值对的形式记录用户、软件的一些使用信息，使得系统或者软件重启之后可以根据注册表中的记录进行相应的初始化工作。解析 init.rc 配置文件并启动 Zygote 进程（调用 Zygote 的 main 函数） 二、Zygote 进程启动过程 Zygote 进程被称为安卓系统的孵化器，Zygote 进程在启动时会创建 DVM（Dalvik虚拟机）和 ART（Android Runtime），后续其他的应用程序进程和 SystemService 进程都有 Zygote 进程通过 fork （复制进程）的方式创建。（因此应用程序进程和 SystemService 进程可以在内部获得一个 DVM 和 ART 副本）。
Zygote 进程的启动过程主要做了以下几件事：
创建 AppRuntime 并调用其 start 方法，启动 Zygote 进程：main 函数中通过 init 进程调用时携带的参数判断出此时是在启动 Zygote 进程，因此调用 start 方法创建 Java 虚拟机并为其注册 JNI 方法：在 AppRuntime 的 start 方法中调用通过 JNI 调用 ZygoteInit 的 main 函数进入 Zygote 的 Java 框架层：在 AppRuntime 的 start 方法中调用通过调用 ZygoteServer 的 registerServerSocket 方法创建服务端 Socket：在 ZygoteInit 的 main 方法中调用启动 SystemServer 进程：在 ZygoteInit 的 main 方法中调用 startSystemServer 方法完成创建和启动通过调用 ZygoteServer 的 runSelectLoop 方法等待 AMS 的请求来创建新的应用程序进程：在 ZygoteInit 的 main 方法中调用，runSelectLoop 方法是一个死循环 三、SystemServer 启动过程 由上文可知 ZygoteInit 的 main 方法调用 startSystemServer 方法，startSystemServer 方法首先复制 Zygote 进程创建 SystemServer 进程，接着关闭掉对 SystemServer 进程没有用处的 Socket 服务，最后调用 handleSystemServerProcess 方法启动 SystemServer 进程。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/1f15046f20fad187c9deae05d6759fee/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-29T21:16:58+08:00" />
<meta property="article:modified_time" content="2022-03-29T21:16:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">安卓系统启动流程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>安卓系统主要启动流程如下：</p> 
<ol><li>启动电源以及系统启动</li><li>引导程序 BootLoader</li><li>Linux 内核启动</li><li>init 进程启动</li><li>Zygote 进程启动</li><li>SystemServer 进程启动</li><li>Launcher 启动</li></ol> 
<h3><a id="init__9"></a>一、init 进程启动过程</h3> 
<p>init 过程启动过程中主要做了以下三件事：</p> 
<ol><li>创建和挂在启动所需的目录文件</li><li>初始化和启动属性服务：属性服务采用键值对的形式记录用户、软件的一些使用信息，使得系统或者软件重启之后可以根据注册表中的记录进行相应的初始化工作。</li><li>解析 init.rc 配置文件并启动 Zygote 进程（调用 Zygote 的 main 函数）</li></ol> 
<h3><a id="Zygote__17"></a>二、Zygote 进程启动过程</h3> 
<p>Zygote 进程被称为安卓系统的孵化器，Zygote 进程在启动时会创建 DVM（Dalvik虚拟机）和 ART（Android Runtime），后续其他的应用程序进程和 SystemService 进程都有 Zygote 进程通过 fork （复制进程）的方式创建。（因此应用程序进程和 SystemService 进程可以在内部获得一个 DVM 和 ART 副本）。</p> 
<p>Zygote 进程的启动过程主要做了以下几件事：</p> 
<ol><li><strong>创建 AppRuntime 并调用其 start 方法，启动 Zygote 进程</strong>：main 函数中通过 init 进程调用时携带的参数判断出此时是在启动 Zygote 进程，因此调用 start 方法</li><li><strong>创建 Java 虚拟机并为其注册 JNI 方法</strong>：在 AppRuntime 的 start 方法中调用</li><li><strong>通过 JNI 调用 ZygoteInit 的 main 函数进入 Zygote 的 Java 框架层</strong>：在 AppRuntime 的 start 方法中调用</li><li><strong>通过调用 ZygoteServer 的 registerServerSocket 方法创建服务端 Socket</strong>：在 ZygoteInit 的 main 方法中调用</li><li><strong>启动 SystemServer 进程</strong>：在 ZygoteInit 的 main 方法中调用 startSystemServer 方法完成创建和启动</li><li><strong>通过调用 ZygoteServer 的 runSelectLoop 方法等待 AMS 的请求来创建新的应用程序进程</strong>：在 ZygoteInit 的 main 方法中调用，runSelectLoop 方法是一个死循环</li></ol> 
<h3><a id="SystemServer__30"></a>三、SystemServer 启动过程</h3> 
<p>由上文可知 ZygoteInit 的 main 方法调用 startSystemServer 方法，startSystemServer 方法首先复制 Zygote 进程创建 SystemServer 进程，接着关闭掉对 SystemServer 进程没有用处的 Socket 服务，最后调用 handleSystemServerProcess 方法启动 SystemServer 进程。</p> 
<p>handleSystemServerProcess 方法主要做了以下几件事：</p> 
<ol><li><strong>启动 Binder 线程池</strong>，获得与其他进程通信的能力：通过 ZygoteInit 类中的 zygoteInit 方法调用 native 方法完成启动</li><li><strong>创建 SystemServerManager</strong>，用于对系统的服务进行创建、启动和生命周期管理</li><li><strong>通过 SystemServerManager 启动各种系统服务</strong></li></ol> 
<p>SystemServerManager 会依次启动以下三种服务：</p> 
<ul><li>startBootstrapServices（启动引导服务）：ActivityManagerServer 、PackageManagerServer等</li><li>startCoreServices（启动核心服务）：BatteryServer 、UsageStateServer（手机用户每一个App使用频率和时长）等</li><li>startOtherServices（启动其他服务）：CameraServer 、WindowManagerServer等</li></ul> 
<h3><a id="Launcher__46"></a>四、Launcher 进程启动过程</h3> 
<p>在 SystemServerManager 调用 startOtherServices 启动其他服务时，通过 AMS 的 systemReady 方法启动 Launcher 进程</p> 
<p>参考书籍：《Android 进阶解密》</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/791237790bb8ff95f50bce1534202fa1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">蓝桥杯—全球变暖 两种方法 深搜和广搜</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bc342f1871274680314e5f6b5348abea/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Microsoft Network Monitor的select network栏空白</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>