<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SqlAlchemy使用教程(五) ORM API 编程入门 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SqlAlchemy使用教程(五) ORM API 编程入门" />
<meta property="og:description" content="SqlAlchemy使用教程(一) 原理与环境搭建SqlAlchemy使用教程(二) 入门示例及编程步骤SqlAlchemy使用教程(三) CoreAPI访问与操作数据库详解SqlAlchemy使用教程(四) MetaData 与 SQL Express Language 的使用SqlAlchemy使用教程(五) ORM API 编程入门 前一章用SQL表达式(SQL Express)语法操作数据库时，仍然侧重于从Core API的角度来看 SQL表达式语言，主要目的是通过封装的SQL表达式来实现跨不同数据库目的。
本章主要介绍ORM API 基础知识、实现ORM CRUD 基础操作。我尽可能使用简洁的语言，配合实例代码，帮助你尽快上手。下一章将深入学习ORM API的主要方法、使用方式，以及较复杂需求的编程实现。
1、ORM 原理 在第1章介绍过ORM原理时。 Python类对象通过ORM与数据库Table进行映射，通过Python类对象的方式来操作数据库。开发人员无须再使用各类数据库的接口API，以及SQL语法。
注： ORM的理想很丰满，现实却是这样的：用好ORM还是需要扎实的SQL基础才能用好。
ORM如何实现从Python对象到数据库的映射呢?
这种映射结构可分为如下几层 Python Table类： 将 Database 的表结构 =&gt; 表示为 Python Metadata, 数据库字段 =&gt; Python Table类的属性(Column对象) Python Table 对象：数据的每行记录相当于1个Python类的实例对象(object)，多行用 `object 列表` 表示。数据库操作的ORM实现 插入1行数据，就相当于: 新建1个Python类实例对象，通过ORM插入数据库 通过ORM查询数据库，返回值为Python对象列表 2、ORM基础编程步骤 2.1 ORM API的使用步骤： 预备知识：
metadata:
上一章已详细介绍过，用于保存表结构, 通常1个应用定义1个全局metadata对象, 集中保存表结构。
declarative Table 声明式Table类
将数据库的表、字段，定义成Python类与属性的结构，这种结构称为声明式映射(Declarative Mapping)。Sqlalchemy2以后。table 类必须继承自 DeclarativeBase。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/38449228a87b07958a47682629d30c12/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-24T10:57:06+08:00" />
<meta property="article:modified_time" content="2024-01-24T10:57:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SqlAlchemy使用教程(五) ORM API 编程入门</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/36/17/onkk0G6p_o.png" alt="在这里插入图片描述" width="1000"></p> 
<blockquote> 
 <ul><li><a href="https://blog.csdn.net/captain5339/article/details/135561292">SqlAlchemy使用教程(一) 原理与环境搭建</a></li><li><a href="https://blog.csdn.net/captain5339/article/details/135580682">SqlAlchemy使用教程(二) 入门示例及编程步骤</a></li><li><a href="https://blog.csdn.net/captain5339/article/details/135582739">SqlAlchemy使用教程(三) CoreAPI访问与操作数据库详解</a></li><li><a href="https://blog.csdn.net/captain5339/article/details/135598914">SqlAlchemy使用教程(四) MetaData 与 SQL Express Language 的使用</a></li><li><a href="https://blog.csdn.net/captain5339/article/details/135685624">SqlAlchemy使用教程(五) ORM API 编程入门</a></li></ul> 
</blockquote> 
<blockquote> 
 <p>前一章用SQL表达式(SQL Express)语法操作数据库时，仍然侧重于从Core API的角度来看 SQL表达式语言，主要目的是通过封装的SQL表达式来实现跨不同数据库目的。</p> 
</blockquote> 
<p>本章主要介绍ORM API 基础知识、实现ORM CRUD 基础操作。我尽可能使用简洁的语言，配合实例代码，帮助你尽快上手。下一章将深入学习ORM API的主要方法、使用方式，以及较复杂需求的编程实现。</p> 
<h3><a id="1ORM__12"></a>1、ORM 原理</h3> 
<p>在第1章介绍过ORM原理时。 Python类对象通过ORM与数据库Table进行映射，通过Python类对象的方式来操作数据库。开发人员无须再使用各类数据库的接口API，以及SQL语法。<br> <img src="https://images2.imgbox.com/62/cc/au9nQFbZ_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>注： ORM的理想很丰满，现实却是这样的：用好ORM还是需要扎实的SQL基础才能用好。</p> 
</blockquote> 
<p><strong>ORM如何实现从Python对象到数据库的映射呢?</strong></p> 
<ol><li>
  这种映射结构可分为如下几层 
 </li><li>Python Table类： 将 Database 的表结构 =&gt; 表示为 Python Metadata, 数据库字段 =&gt; Python Table类的属性(Column对象) </li><li> Python Table 对象：数据的每行记录相当于1个Python类的实例对象(object)，多行用 `object 列表` 表示。</li><li>数据库操作的ORM实现 
  <ul><li>插入1行数据，就相当于: 新建1个Python类实例对象，通过ORM插入数据库 </li><li>通过ORM查询数据库，返回值为Python对象列表</li></ul> </li></ol> 
<h3><a id="2ORM_34"></a>2、ORM基础编程步骤</h3> 
<h4><a id="21_ORM_API_35"></a>2.1 ORM API的使用步骤：</h4> 
<p><strong>预备知识：</strong></p> 
<p><strong>metadata:</strong><br> 上一章已详细介绍过，用于保存表结构, 通常1个应用定义1个全局metadata对象, 集中保存表结构。</p> 
<p><strong>declarative Table 声明式Table类</strong><br> 将数据库的表、字段，定义成Python类与属性的结构，这种结构称为声明式映射(Declarative Mapping)。Sqlalchemy2以后。table 类必须继承自 DeclarativeBase。</p> 
<p><strong>ORM API的使用流程：</strong><br> (1)定义1个DeclarativeBase子类，做为Python table类的父类<br> (2)定义映射table类，映射到1个数据库表<br> (3)通过engine在数据库中实际创建表。 由Base.metadata向engine 发关create table DDL的事件.<br> (4) 创建Session对象，连接到engine，用于管理后续数据库操作。<br> (5) <strong>ORM对数据的增删改查操作，与Core API 有明显不同</strong>。 ORM的添加、修改、删除操作是通过Session来操作映射Table类的对象来完成。ORM查询使用的 select()方法也对 SQL表达式做了进一步封装，输入是以映射Table对象，而非metadata 的table类。</p> 
<blockquote> 
 <p>说明：此处提到的 table 类，是为了描述方便，此类用于映射数据库表，不是上一节提到的sqlalchemy.Table 内置类。</p> 
</blockquote> 
<h4><a id="22_TableColumn_54"></a>2.2 声明式映射语法定义Table类与Column类</h4> 
<h5><a id="1table__57"></a>1)申明式定义table 类</h5> 
<p>继承自DeclarativeBase, column 字段定义遵照mapping 语法</p> 
<p>定义1个Base做为Table类的基类</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> DeclarativeBase
<span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">(</span>DeclarativeBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token keyword">pass</span>
</code></pre> 
<p>注：Base对象包含metadfata. registry 属性</p> 
<pre><code class="prism language-python">Base<span class="token punctuation">.</span>metadata
Base<span class="token punctuation">.</span>registry
</code></pre> 
<p>设置数据库表名<br> <code>__tablename__ = "user_account" </code>， 设置为db table 名</p> 
<p>定义column属性，<br> <code>name: Mapped[str] = mapped_column(String(30))</code><br> 等号左边使用type notation注明Python类型，右边用mapped_column()给出最匹配的Database字段类型<br> <em>这是SqlAlchemy2.0推荐的方式，别嫌麻烦，这样做可以大大减少数据库迁移时出错的概率，</em></p> 
<p>下面是1个用声明式映射方式定义的Person 类。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> DeclarativeBase<span class="token punctuation">,</span> Session
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> Mapped<span class="token punctuation">,</span> mapped_column
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> String<span class="token punctuation">,</span> Integer

<span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">(</span>DeclarativeBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">'person'</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    age<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>Integer<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Person(</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>age<span class="token punctuation">}</span></span><span class="token string">)"</span></span>
</code></pre> 
<p>说明：<br> 上述模型类，除将用属性映射到数据库字段外，与普通类定义一样，也提供了对象初始化方法__init__()，以及__repr__()魔法方法。 还可以添加其它的方法，如属性的校验方法等。</p> 
<h5><a id="2engine_110"></a>2)通过engine对象在数据库中创建表</h5> 
<p>创建数据库连接引擎对象</p> 
<pre><code class="prism language-python">engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span>
    <span class="token string">"mysql+mysqlconnector://root:12345678@localhost:3306/testdb"</span><span class="token punctuation">)</span>
<span class="token comment"># 请用你的mysql用户名及密码替换root:12345678</span>
</code></pre> 
<p>将DDL语句映射到数据库表，如果数据库表不存在，则创建该表</p> 
<pre><code class="prism language-python">Base<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span>engine<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="23__125"></a>2.3 向数据库插入数据</h4> 
<p>我们现在可以在数据库中插入数据了。通过创建类的实例来实现这一点. 还要使用一个名为Session的对象将它们传递到数据库，该对象利用Engine与数据库进行交互。使用Se木本油料Session.add(obj)添加1个对象（数据记录行），或使用Session.add_all（）方法一次添加多个对象，而Session.commit（）方法将用于保存对数据库的变更。</p> 
<pre><code class="prism language-python">session <span class="token operator">=</span> Session<span class="token punctuation">(</span>engine<span class="token punctuation">)</span>
<span class="token comment"># 创建Person实例对象</span>
p1 <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">"刘备"</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>
p2 <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">"关羽"</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span>
p3 <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">"张飞"</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span>
<span class="token comment"># 将Person实例对象添加到session</span>
session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>p2<span class="token punctuation">)</span>
session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>p3<span class="token punctuation">)</span>
session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 提交事务到数据库</span>
</code></pre> 
<p>建议通过上下文管理器使用Session，即使用Python with语句。</p> 
<h4><a id="24SELECT_144"></a>2.4简单SELECT查询</h4> 
<p>对于数据库中的某些行，以下是发出SELECT语句以加载某些对象的最简单形式。要创建SELECT语句，<br> 1）使用SELECT() 函数创建一个新的SELECT对象.<br> 2) 使用Session调用该对象。执行ORM查询时，最常用方法是Session.scalars（）方法，它将返回一个ScalarResult对象，该对象将遍历我们选择的ORM对象. (另1个执行方法 Session.execute() 在后面章节也会介绍）</p> 
<pre><code class="prism language-python">stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"刘备"</span><span class="token punctuation">)</span>
results <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>Output:</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>Person<span class="token punctuation">(</span>刘备<span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<p>返回值 results对象为ScalarResult类实例， all()以对象列表方式返回查询结果, 每个元素是1个映射table类对象 ，每个对象的各个属性，相对应于数据库表的字段值。</p> 
<p>ScalarResult对象还提供了first(), fetchone(), fetchmany(), fetchall()等方法，习惯于DBAPI编程的同样都很熟悉。</p> 
<p>ScalarResult对象也是可迭代的，用for 循环遍历读取结果</p> 
<pre><code class="prism language-python">stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>name<span class="token punctuation">.</span>in_<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"刘备"</span><span class="token punctuation">,</span> <span class="token string">"关羽"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
results <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token keyword">for</span> p <span class="token keyword">in</span> results<span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
</code></pre> 
<p>Output:</p> 
<pre><code class="prism language-python">Person<span class="token punctuation">(</span>刘备<span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>
Person<span class="token punctuation">(</span>关羽<span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>查询全部数据</strong></p> 
<pre><code class="prism language-python">results <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>select<span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>多条件查询</strong><br> Where()方法不支持 and, or逻辑运算符，但支持where()方法的链式调用来实现多条件查询。</p> 
<pre><code class="prism language-python">stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>age <span class="token operator">&gt;</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>age <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span>
results <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="24__196"></a>2.4 更新数据</h4> 
<p>更新数据时，先以对象的方式读取到1条数据后，更新该对象的属性，然后通过session提交事件，即自动将更新数据库相应记录。<br> 例如。我们先在Person表中插入1条name=”张辽”的数据</p> 
<pre><code class="prism language-python">p4 <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">"张辽"</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>p4<span class="token punctuation">)</span>
session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 提交事务到数据库</span>
</code></pre> 
<p>然后获取该记录对象，将name属性改为”赵云”，提交更新。</p> 
<pre><code class="prism language-python">stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"张辽"</span><span class="token punctuation">)</span>
person <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"赵云"</span>
person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">32</span>
session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
results <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>select<span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>Output</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>Person<span class="token punctuation">(</span>赵云<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Person<span class="token punctuation">(</span>张飞<span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Person<span class="token punctuation">(</span>关羽<span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Person<span class="token punctuation">(</span>刘备<span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<h4><a id="25__225"></a>2.5 删除数据</h4> 
<p>删除数据，也就是用session.delete()方法向engine传递1个对象。如果该对象不存在，则会抛出异常，如果该对象存在，则删除。</p> 
<pre><code class="prism language-python">p5 <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">"曹操"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>p5<span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数据库中不存在该记录"</span><span class="token punctuation">)</span>
p6 <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>select<span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"赵云"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>p6<span class="token punctuation">)</span>
session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
results <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>select<span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>Output:<br> 数据库中不存在该记录</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>Person<span class="token punctuation">(</span>张飞<span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Person<span class="token punctuation">(</span>关羽<span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Person<span class="token punctuation">(</span>刘备<span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="3__250"></a>3. 本章小结</h3> 
<p><strong>ORM API编程的基本流程为：</strong><br> 1）用声明式映射方式，定义Python Table类，其父类必须是DeclarativeBase<br> 2）Table类的属性映射到数据库字段，左边用 maped()注明Python类型，右边用mapped_column()申明对应的数据库字段类型。<br> 3）用Base.metadata.emit()方法将DDL语句发送到数据库创建表。<br> 4）创建Session对象，做为ORM 至 Database的管理器。<br> 5）通过实例对象完成数据库的添加、修改、删除操作<br> 6）通过select()查询数据， 并且提供了where(), order_by()等支持条件查询，排序等。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/20e9432b5b6b68e1cfd458d8dae8be24/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Transformer——位置编码（Positional embding）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7cbb3c05bab79ac22e7fcb71d3f2e49d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SqlAlchemy使用教程(六) -- ORM 表间关系的定义与CRUD操作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>