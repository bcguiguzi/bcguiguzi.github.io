<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【TensorFlow随笔】关于一个矩阵与多个矩阵相乘的问题 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【TensorFlow随笔】关于一个矩阵与多个矩阵相乘的问题" />
<meta property="og:description" content="问题描述：
Specifically, I want to do matmul(A,B) where
&#39;A&#39; has shape (m,n)
&#39;B&#39; has shape (k,n,p)
and the result should have shape (k,m,p)
参考网站：
https://groups.google.com/a/tensorflow.org/forum/#!topic/discuss/4tgsOSxwtkY
https://stackoverflow.com/questions/38235555/tensorflow-matmul-of-input-matrix-with-batch-data
解决办法：
1，我们知道TensorFlow的matmul已经支持了batch，即：
A = tf.Variable(tf.random_normal(shape=(a, b, n, m))) B = tf.Variable(tf.random_normal(shape=(a, b, m, k))) tf.matmul(A, B) 会返回(a,b,n,k)，前面的N个维度会被保留。但是适用情景与题目不符。
2，所以我们自然想到reshape。
You can conflate the two dimensions not used in the multiplication using reshape, multiply the two matrices, and then call reshape again to get the desired shape." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/6170e6c6950ac68122298ee1144623c3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-12-21T01:00:00+08:00" />
<meta property="article:modified_time" content="2017-12-21T01:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【TensorFlow随笔】关于一个矩阵与多个矩阵相乘的问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p>问题描述：</p> 
 <p>Specifically, I want to do matmul(A,B) where<br>  'A' has shape (m,n)<br>  'B' has shape (k,n,p)<br> and the result should have shape (k,m,p)</p> 
 <hr> 
 <p>参考网站：</p> 
 <p>https://groups.google.com/a/tensorflow.org/forum/#!topic/discuss/4tgsOSxwtkY</p> 
 <p>https://stackoverflow.com/questions/38235555/tensorflow-matmul-of-input-matrix-with-batch-data</p> 
 <hr> 
 <p>解决办法：</p> 
 <p>1，我们知道TensorFlow的matmul已经支持了batch，即：</p> 
 <pre><code>A = tf.Variable(tf.random_normal(shape=(a, b, n, m)))
B = tf.Variable(tf.random_normal(shape=(a, b, m, k)))
tf.matmul(A, B)</code></pre> 
 <p>会返回(a,b,n,k)，前面的N个维度会被保留。但是适用情景与题目不符。</p> 
 <p>2，所以我们自然想到reshape。</p> 
 <p><span class="comment-copy">You can conflate the two dimensions not used in the multiplication using reshape, multiply the two matrices, and then call reshape again to get the desired shape. This is equivalent to doing batch multiplication.</span></p> 
 <p><span class="comment-copy">简而言之呢，就是，你可以将乘法中用不到的维度reshape到后面去，比如</span></p> 
 <p><span class="comment-copy">(k, m, p) =&gt; (m, p * k)</span></p> 
 <p>进行矩阵乘法得到：(n, p * k)</p> 
 <p>之后reshape成：(k, n, p)。</p> 
 <p>虽然有些麻烦，但这是唯一的解决办法了。</p> 
 <p>适用情景：A矩阵只有一个，但是B矩阵有batch_num个，需要逐个进行矩阵乘法的场合。</p> 
</div> 
<p>转载于:https://www.cnblogs.com/ldzhangyx/p/8076522.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2f2a276ecb6dec52e33c6da534d7c4cd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">网络端口号汇总</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e105245068e74320c2521ca887920203/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Building the kernel with clang</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>