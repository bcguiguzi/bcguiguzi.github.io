<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>开源一个简单的RTS游戏（Unity） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="开源一个简单的RTS游戏（Unity）" />
<meta property="og:description" content="apk download : https://www.taptap.com/app/202356
Video Demo : https://www.bilibili.com/video/BV1vK4y177U6/
ScratchLottery 一款由Unity开发的RTS类型的游戏，游戏的核心玩法为派遣士兵攻占城堡获取胜利。（该玩法思路来源于作者很早之前玩过的一款游戏，名字已经忘记，感谢朋友的试玩，提出了很多好的修改意见）
游戏开发至1.0版本耗时一周左右，开发时的指导思想即为轻美工、轻剧情、强玩法、强操作。游戏英文名暂定为ScratchLottery，因为添加战斗迷雾后，配合上像素风界面，战斗时酷似刮彩票。\o/
代码：https://github.com/Iamttp/Castle
游戏演示 游戏界面 技术分割线，下面的讨论涉及游戏本身所使用的技术。
游戏目录 Prefabs文件夹： 包含道路（go）、城堡（house）、不可移动道路（stop）、士兵（Sphere）、雾（fog）、顶部势力图（cube）预制体。
Resources文件夹： 包含道路（go）、不可移动道路（stop）、雾（fog）、顶部势力图（cube）纹理。
Materials文件夹： 包含道路（go）、不可移动道路（stop）、雾（fog）、城堡（New Material 1）、闪烁城堡（New Material 3）材质。
Shaders文件夹： 包含城堡（NewUnlitShader）、闪烁城堡（SelectShader）材质。
Scenes文件夹： 包含六大场景
Scripts文件夹： 包含六大场景文件夹，里面存放场景对应的C# Script。
关键技术分享 作者刚学Unity，很多效果都是通过直觉（做过GUI程序、OpenGL程序）做出来的，有更好的实现方法欢迎批评指正。游戏虽然表现为2D，但是项目创建时为Unity 3D。
像素风雾效果 首先想到的是在shader里面定义一个Color和一个int变量，
在C#脚本里面初始化一个对应图的二维bool数组表示当前位置是否有雾效果，
在Update里面遍历每一个点，如果为false表示有雾，设置Shader的int变量为1，让Shader的输出颜色为指定的Color（雾颜色），如果为true表示没有雾，设置Shader的int变量为0，让Shader的输出颜色为原本的纹理颜色。
实现时发现比较繁琐，于是采用了第二种方法，用GameObject的SetActive来控制是否开启雾。这种方法简单统一，且便于修改。
还是在C#脚本里面初始化一个对应图的二维bool数组表示当前位置是否有雾效果，在Update里面遍历每一个点，如果为false表示有雾，设置雾的预制体SetActive为true。反之false。
顶部势力图 首先用unity提供的UI控件很难自定义出想要的效果。（应该不能魔改滚动条吧）
而如果直接是在游戏场景中则会发生位置的变化。于是用另一个摄像头在距离很远处，将结果渲染至纹理。
再在主摄像头的UI里面，定义RAW IMAGE显示纹理。
势力图的每个Cube表示一个城堡，通过计算当前城堡数，设置相应的scale。
随机技能 过关后会有随机三个技能提示选项（我的思路来源于崩坏3）。
在一堆技能中做到随机三个，使用洗牌算法在O(N)时间复杂度 O(1)空间复杂度下随机打乱。然后选取前三个就行。
随机地图生成 城堡随机的生成，首先是固定4个势力分布在4个角，保证每个角城堡数相同，for循环城堡数 %4 就行。
生成时，参考八皇后放置算法，设置城堡四周为不可放置，放置城堡过于密集。
因为考虑到地图太小，后放置的城堡放不下，设定一个运行尝试次数，达到次数后，重新加载场景，重新生成。
道路随机的生成，随机选取两个城堡，使用绘制直线方法绘制（用的斜率绘制法，布雷森汉姆直线算法更好），
绘制时为保证不出现道路割裂感，在位置偏移时，多绘制一个转角。
为保证生成的地图质量，检测生成的直线是否存在交叉，存在交叉时，该条道路放弃生成。
在生成后，进行检测，从任一城堡出发，通过DFS遍历，若遍历后城堡数不为总城堡数，则表明存在孤立的城堡，重新加载场景，重新生成。
打包APK网盘链接，欢迎大家批评指正：
链接：https://pan.baidu.com/s/1M2PLkdbvAW-NQ1y-_ZFqBA
提取码：aaaa
复制这段内容后打开百度网盘手机App，操作更方便哦
2020-10-30更新：
WaterFlow 最新2.0版更名为Water Flow。游戏的核心玩法未变，游戏的迷雾由之前的GameObject遮挡改为点光源光照。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/ae8f0ca2bb4f09fc59089f215f2f0998/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-27T15:41:07+08:00" />
<meta property="article:modified_time" content="2020-10-27T15:41:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">开源一个简单的RTS游戏（Unity）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>apk download : <a href="https://www.taptap.com/app/202356" rel="nofollow">https://www.taptap.com/app/202356</a></p> 
<p>Video Demo : <a href="https://www.bilibili.com/video/BV1vK4y177U6/" rel="nofollow">https://www.bilibili.com/video/BV1vK4y177U6/</a></p> 
<hr> 
<h2><a id="ScratchLottery_6"></a>ScratchLottery</h2> 
<p>一款由Unity开发的RTS类型的游戏，游戏的核心玩法为派遣士兵攻占城堡获取胜利。（该玩法思路来源于作者很早之前玩过的一款游戏，名字已经忘记，感谢朋友的试玩，提出了很多好的修改意见）</p> 
<p>游戏开发至1.0版本耗时一周左右，开发时的指导思想即为轻美工、轻剧情、强玩法、强操作。游戏英文名暂定为ScratchLottery，因为添加战斗迷雾后，配合上像素风界面，战斗时酷似刮彩票。\<sup>o</sup>/</p> 
<p>代码：<a href="https://github.com/Iamttp/Castle">https://github.com/Iamttp/Castle</a></p> 
<h3><a id="_14"></a>游戏演示</h3> 
<p><img src="https://images2.imgbox.com/ce/d1/aP4txSkw_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="_19"></a>游戏界面</h3> 
<p><img src="https://images2.imgbox.com/d5/25/VQd54t0i_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/05/b2/O5oP5tsw_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/26/1a/uQKj4DE9_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ad/26/2ICV7B5S_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7e/42/sQ4G68p5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/43/86/XZK9jrSf_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p>技术分割线，下面的讨论涉及游戏本身所使用的技术。</p> 
<hr> 
<h3><a id="_33"></a>游戏目录</h3> 
<ul><li>Prefabs文件夹：</li></ul> 
<p>包含道路（go）、城堡（house）、不可移动道路（stop）、士兵（Sphere）、雾（fog）、顶部势力图（cube）预制体。</p> 
<ul><li>Resources文件夹：</li></ul> 
<p>包含道路（go）、不可移动道路（stop）、雾（fog）、顶部势力图（cube）纹理。</p> 
<ul><li>Materials文件夹：</li></ul> 
<p>包含道路（go）、不可移动道路（stop）、雾（fog）、城堡（New Material 1）、闪烁城堡（New Material 3）材质。</p> 
<ul><li>Shaders文件夹：</li></ul> 
<p>包含城堡（NewUnlitShader）、闪烁城堡（SelectShader）材质。</p> 
<ul><li>Scenes文件夹：</li></ul> 
<p>包含六大场景</p> 
<ul><li>Scripts文件夹：</li></ul> 
<p>包含六大场景文件夹，里面存放场景对应的C# Script。</p> 
<h3><a id="_59"></a>关键技术分享</h3> 
<p>作者刚学Unity，很多效果都是通过直觉（做过GUI程序、OpenGL程序）做出来的，有更好的实现方法欢迎批评指正。游戏虽然表现为2D，但是项目创建时为Unity 3D。</p> 
<ul><li>像素风雾效果</li></ul> 
<p>首先想到的是在shader里面定义一个Color和一个int变量，<br> 在C#脚本里面初始化一个对应图的二维bool数组表示当前位置是否有雾效果，<br> 在Update里面遍历每一个点，如果为false表示有雾，设置Shader的int变量为1，让Shader的输出颜色为指定的Color（雾颜色），如果为true表示没有雾，设置Shader的int变量为0，让Shader的输出颜色为原本的纹理颜色。</p> 
<p>实现时发现比较繁琐，于是采用了第二种方法，用GameObject的SetActive来控制是否开启雾。这种方法简单统一，且便于修改。<br> 还是在C#脚本里面初始化一个对应图的二维bool数组表示当前位置是否有雾效果，在Update里面遍历每一个点，如果为false表示有雾，设置雾的预制体SetActive为true。反之false。</p> 
<ul><li>顶部势力图</li></ul> 
<p>首先用unity提供的UI控件很难自定义出想要的效果。（应该不能魔改滚动条吧）<br> 而如果直接是在游戏场景中则会发生位置的变化。于是用另一个摄像头在距离很远处，将结果渲染至纹理。<br> 再在主摄像头的UI里面，定义RAW IMAGE显示纹理。</p> 
<p>势力图的每个Cube表示一个城堡，通过计算当前城堡数，设置相应的scale。</p> 
<ul><li>随机技能</li></ul> 
<p>过关后会有随机三个技能提示选项（我的思路来源于崩坏3）。</p> 
<p>在一堆技能中做到随机三个，使用洗牌算法在O(N)时间复杂度 O(1)空间复杂度下随机打乱。然后选取前三个就行。</p> 
<ul><li>随机地图生成</li></ul> 
<p>城堡随机的生成，首先是固定4个势力分布在4个角，保证每个角城堡数相同，for循环城堡数 %4 就行。<br> 生成时，参考八皇后放置算法，设置城堡四周为不可放置，放置城堡过于密集。</p> 
<p>因为考虑到地图太小，后放置的城堡放不下，设定一个运行尝试次数，达到次数后，重新加载场景，重新生成。</p> 
<p>道路随机的生成，随机选取两个城堡，使用绘制直线方法绘制（用的斜率绘制法，布雷森汉姆直线算法更好），<br> 绘制时为保证不出现道路割裂感，在位置偏移时，多绘制一个转角。</p> 
<p>为保证生成的地图质量，检测生成的直线是否存在交叉，存在交叉时，该条道路放弃生成。</p> 
<p>在生成后，进行检测，从任一城堡出发，通过DFS遍历，若遍历后城堡数不为总城堡数，则表明存在孤立的城堡，重新加载场景，重新生成。</p> 
<hr> 
<p>打包APK网盘链接，欢迎大家批评指正：</p> 
<p>链接：https://pan.baidu.com/s/1M2PLkdbvAW-NQ1y-_ZFqBA<br> 提取码：aaaa<br> 复制这段内容后打开百度网盘手机App，操作更方便哦</p> 
<hr> 
<p>2020-10-30更新：</p> 
<h2><a id="WaterFlow_113"></a>WaterFlow</h2> 
<p>最新2.0版更名为<code>Water Flow</code>。游戏的核心玩法未变，游戏的迷雾由之前的GameObject遮挡改为点光源光照。</p> 
<p>具体操作演示： <a href="https://www.bilibili.com/video/BV1vK4y177U6/" rel="nofollow">https://www.bilibili.com/video/BV1vK4y177U6/</a></p> 
<h3><a id="_120"></a>关键技术分享</h3> 
<ul><li>音效编辑</li></ul> 
<p>游戏的音效使用 Audacity 进行编辑，非常简洁好用的软件，可以使用它录制系统声音或者麦克风声音，然后进行一些诸如截取片段、改变音量等操作。</p> 
<ul><li>新版雾效果分享</li></ul> 
<p>为每个水滴（士兵）预制体添加了点光源，每个水泡（城堡）预制体也添加了点光源，然后去除全局方向光即非常方便的实现了雾效果。</p> 
<p>同时为了表示敌方水泡是否被查看（被查看的话显示水滴数等），需要定义一个二维 float 矩阵，每次 Update 将矩阵的值减小。当减小到一定值时，表示无法查看。而在我方水泡、水滴周围的矩阵的值将设定为一个初始值表示可以查看。</p> 
<ul><li>水波纹设计</li></ul> 
<p>为符合整体主题设计了水波纹，思想为在片段着色器里面对纹理坐标采样时的进行偏移。百度水波纹有这方面的实现。也可以参考我github里面的实现。</p> 
<ul><li>自定义地图编辑</li></ul> 
<p>实现要实现地图数据的保存，采用了SQLite保存，为保证保存速度，采用批量插入。<br> 需要注意的是在Android平台下，SQLite的批量插入格式为：</p> 
<pre><code class="prism language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> 表名<span class="token punctuation">(</span>列名<span class="token number">1</span><span class="token punctuation">,</span>列名<span class="token number">2</span><span class="token punctuation">)</span>    
<span class="token keyword">select</span>  值<span class="token number">1</span><span class="token punctuation">,</span>值<span class="token number">2</span>
<span class="token keyword">union</span> <span class="token keyword">all</span> 
<span class="token keyword">select</span> 值<span class="token number">1</span><span class="token punctuation">,</span>值<span class="token number">2</span>
</code></pre> 
<p>区别于</p> 
<pre><code class="prism language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> 表名<span class="token punctuation">(</span>列名<span class="token number">1</span><span class="token punctuation">,</span>列名<span class="token number">2</span><span class="token punctuation">)</span>    
<span class="token keyword">values</span>  <span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span>值<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span>值<span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<p>并且一次最多500条数据。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/25b96d4fbbba27a806c34d7f898b8e2d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">webRTC 初接触</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/132880b7cb2968f64e0e10d3f0c5d7b8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">6-11 求自定类型元素序列的中位数 (25分)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>