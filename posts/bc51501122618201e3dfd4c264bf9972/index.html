<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apollo详解之定位模块——NDT定位 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apollo详解之定位模块——NDT定位" />
<meta property="og:description" content="前言 代码分析 NDTLocalizationComponent NDTLocalizationComponent::Init 该函数完成了NDT组件的初始化工作。该组件通过命令行参数gflag对相关参数进行初始化，各命令行参数的默认值可参考modules/common/adapters/adapter_gflags.cc和modules/localization/common/localization_gflags.cc，该组件读取命令行参数配置文件modules/localization/conf/localization.conf，因此可在该文件中对各命令行参数进行定义。
命令行参数 话题相关
FLAGS_localization_topic 融合定位发布话题FLAGS_lidar_topic 激光雷达点云订阅话题FLAGS_localization_ndt_topic NDT定位发布话题FLAGS_ins_stat_topic 组合导航定位状态订阅话题FLAGS_localization_msf_status 融合定位状态发布话题
变换相关FLAGS_broadcast_tf_frame_id 固定世界坐标系FLAGS_broadcast_tf_child_frame_id 子坐标系
融合相关FLAGS_local_utm_zone_id 定位地图UTM坐标系IDFLAGS_online_resolutionFLAGS_ndt_debug_log_flag 是否记录日志FLAGS_lidar_height_file 激光雷达高度YAML配置文件FLAGS_lidar_extrinsics_file 激光雷达外参YAML配置文件FLAGS_ndt_bad_score_count_thresholdFLAGS_ndt_warnning_ndt_scoreFLAGS_ndt_error_ndt_score
定位地图相关FLAGS_map_dir 定位地图文件夹路径FLAGS_ndt_map_dir ndt地图相对路径FLAGS_local_map_name 定位地图相对路径 NDTLocalization::Init 该函数会被调用，读取激光雷达外参和激光雷达高度参数以及定位地图
配置参数文件 velodyne128_novatel_extrinsics.yaml
header: stamp: secs: 1542235619 nsecs: 0 frame_id: novatel seq: 0 child_frame_id: velodyne128 transform: rotation: x: 0.007209096210038245 y: 0.01691200555753232 z: 0.7076293956185187 w: 0.7063445699206772 translation: x: 0.03614259942391 y: 1.033871037991605 z: 1.21285 velodyne128_height.yaml
vehicle: parameters: height: 1.89 height_var: 0.0045 回调函数 LidarCallback 点云消息的回调函数，获得点云消息，进行计算后得到根据NDT的定位消息，并进行发布。
OdometryStatusCallback 组合导航状态回调函数，获得导航状态，存储在相关容器中" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/bc51501122618201e3dfd4c264bf9972/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-22T20:34:06+08:00" />
<meta property="article:modified_time" content="2021-07-22T20:34:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apollo详解之定位模块——NDT定位</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>前言</h3> 
<h2><a id="_1"></a>代码分析</h2> 
<h3><a id="NDTLocalizationComponent_2"></a>NDTLocalizationComponent</h3> 
<h5><a id="NDTLocalizationComponentInit_3"></a>NDTLocalizationComponent::Init</h5> 
<p>该函数完成了NDT组件的初始化工作。该组件通过命令行参数gflag对相关参数进行初始化，各命令行参数的默认值可参考<code>modules/common/adapters/adapter_gflags.cc</code>和<code>modules/localization/common/localization_gflags.cc</code>，该组件读取命令行参数配置文件<code>modules/localization/conf/localization.conf</code>，因此可在该文件中对各命令行参数进行定义。</p> 
<h6><a id="_5"></a>命令行参数</h6> 
<p>话题相关</p> 
<ul><li>FLAGS_localization_topic 融合定位发布话题</li><li>FLAGS_lidar_topic 激光雷达点云订阅话题</li><li>FLAGS_localization_ndt_topic NDT定位发布话题</li><li>FLAGS_ins_stat_topic 组合导航定位状态订阅话题</li><li>FLAGS_localization_msf_status 融合定位状态发布话题<br> 变换相关</li><li>FLAGS_broadcast_tf_frame_id 固定世界坐标系</li><li>FLAGS_broadcast_tf_child_frame_id 子坐标系<br> 融合相关</li><li>FLAGS_local_utm_zone_id 定位地图UTM坐标系ID</li><li>FLAGS_online_resolution</li><li>FLAGS_ndt_debug_log_flag 是否记录日志</li><li>FLAGS_lidar_height_file 激光雷达高度YAML配置文件</li><li>FLAGS_lidar_extrinsics_file 激光雷达外参YAML配置文件</li><li>FLAGS_ndt_bad_score_count_threshold</li><li>FLAGS_ndt_warnning_ndt_score</li><li>FLAGS_ndt_error_ndt_score<br> 定位地图相关</li><li>FLAGS_map_dir 定位地图文件夹路径</li><li>FLAGS_ndt_map_dir ndt地图相对路径</li><li>FLAGS_local_map_name 定位地图相对路径</li></ul> 
<h6><a id="NDTLocalizationInit_29"></a>NDTLocalization::Init</h6> 
<p>该函数会被调用，读取激光雷达外参和激光雷达高度参数以及定位地图</p> 
<h6><a id="_31"></a>配置参数文件</h6> 
<p>velodyne128_novatel_extrinsics.yaml</p> 
<pre><code>header:
  stamp:
    secs: 1542235619
    nsecs: 0
  frame_id: novatel
  seq: 0
child_frame_id: velodyne128
transform:
  rotation:
    x: 0.007209096210038245
    y: 0.01691200555753232
    z: 0.7076293956185187
    w: 0.7063445699206772
  translation:
    x: 0.03614259942391
    y: 1.033871037991605
    z: 1.21285
</code></pre> 
<p>velodyne128_height.yaml</p> 
<pre><code>vehicle:
  parameters:
    height: 1.89
    height_var: 0.0045
</code></pre> 
<h3><a id="_60"></a>回调函数</h3> 
<h5><a id="LidarCallback_61"></a>LidarCallback</h5> 
<p>点云消息的回调函数，获得点云消息，进行计算后得到根据NDT的定位消息，并进行发布。</p> 
<h5><a id="OdometryStatusCallback_63"></a>OdometryStatusCallback</h5> 
<p>组合导航状态回调函数，获得导航状态，存储在相关容器中</p> 
<h5><a id="NDTLocalizationComponentProc_65"></a>NDTLocalizationComponent::Proc</h5> 
<p>Gps定位消息的回调函数，根据Gps定位的时间戳，从容器中获得相应的导航状态，根据生成的NDT定位消息获得定位参数，再结合Gps的速度加速度信息，得到融合定位消息和相应的状态，进行发布，并根据定位信息发布世界坐标系和定位坐标系的动态坐标变换</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/deddbdb5d71096491296aa62651512e6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">鼠标dpi在线测试软件,测试鼠标灵敏度-中关村在线</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b39e54110a212b2e08c5db3dc4d1f19c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">哈夫曼编码设计（C）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>