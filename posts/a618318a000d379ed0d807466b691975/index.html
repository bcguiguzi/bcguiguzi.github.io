<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>TextView实现打印机效果 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="TextView实现打印机效果" />
<meta property="og:description" content="首先申明,这篇文章不是我写的,我是对着大神的博客,对着写了一遍而已! 感谢写这篇文章的作者,其原创博客地址为: http://www.jianshu.com/p/4d987769785c
其示意图如下: 其自定义TextView的代码如下:
/** * Created by pxw on 2017/6/12. * 打印机效果TextView */ public class FadeInTextView extends TextView { //绘制显示的文字 private StringBuffer mStringBuffer = new StringBuffer(); //矩形 private Rect textRect = new Rect(); //定义文字的个数 private int textCount; //属性动画-值动画 private ValueAnimator textAnimation; //每个字出现的时间 private int duration = 300; //当前显示的字的索引 private int currentIndex = -1; //字的数组 private String[] arr; //接口对象 private TextAnimationListener textAnimationListener; public FadeInTextView(Context context) { super(context); } public FadeInTextView(Context context, @Nullable AttributeSet attrs) { super(context, attrs); } public FadeInTextView(Context context, @Nullable AttributeSet attrs, int defStyleAttr) { super(context, attrs, defStyleAttr); } public FadeInTextView setTextAnimationListener(TextAnimationListener textAnimationListener){ this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/a618318a000d379ed0d807466b691975/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-06-12T19:24:21+08:00" />
<meta property="article:modified_time" content="2017-06-12T19:24:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">TextView实现打印机效果</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>首先申明,这篇文章不是我写的,我是对着大神的博客,对着写了一遍而已! <br> 感谢写这篇文章的作者,其原创博客地址为: <br> <a href="http://www.jianshu.com/p/4d987769785c" rel="nofollow noopener noreferrer" target="_blank">http://www.jianshu.com/p/4d987769785c</a></p> 
<p>其示意图如下: <br> <img src="https://images2.imgbox.com/3b/0e/XQWJUwWX_o.gif" alt="这里写图片描述" title=""></p> 
<p><strong>其自定义TextView的代码如下:</strong></p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-javadoc">/**
 * Created by pxw on 2017/6/12.
 * 打印机效果TextView
 */</span>

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FadeInTextView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TextView</span> {<!-- --></span>

    <span class="hljs-comment">//绘制显示的文字</span>
    <span class="hljs-keyword">private</span> StringBuffer mStringBuffer = <span class="hljs-keyword">new</span> StringBuffer();
    <span class="hljs-comment">//矩形</span>
    <span class="hljs-keyword">private</span> Rect textRect = <span class="hljs-keyword">new</span> Rect();
    <span class="hljs-comment">//定义文字的个数</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> textCount;
    <span class="hljs-comment">//属性动画-值动画</span>
    <span class="hljs-keyword">private</span> ValueAnimator textAnimation;
    <span class="hljs-comment">//每个字出现的时间</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> duration = <span class="hljs-number">300</span>;
    <span class="hljs-comment">//当前显示的字的索引</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> currentIndex = -<span class="hljs-number">1</span>;
    <span class="hljs-comment">//字的数组</span>
    <span class="hljs-keyword">private</span> String[] arr;
    <span class="hljs-comment">//接口对象</span>
    <span class="hljs-keyword">private</span> TextAnimationListener textAnimationListener;
    <span class="hljs-keyword">public</span> <span class="hljs-title">FadeInTextView</span>(Context context) {
        <span class="hljs-keyword">super</span>(context);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">FadeInTextView</span>(Context context, @Nullable AttributeSet attrs) {
        <span class="hljs-keyword">super</span>(context, attrs);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">FadeInTextView</span>(Context context, @Nullable AttributeSet attrs, <span class="hljs-keyword">int</span> defStyleAttr) {
        <span class="hljs-keyword">super</span>(context, attrs, defStyleAttr);
    }

    <span class="hljs-keyword">public</span> FadeInTextView <span class="hljs-title">setTextAnimationListener</span>(TextAnimationListener textAnimationListener){
        <span class="hljs-keyword">this</span>.textAnimationListener = textAnimationListener;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
    <span class="hljs-comment">//绘制显示的文字</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDraw</span>(Canvas canvas) {
        <span class="hljs-keyword">super</span>.onDraw(canvas);
        <span class="hljs-keyword">if</span>(mStringBuffer != <span class="hljs-keyword">null</span>) {
            drawText(canvas,mStringBuffer.toString());
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drawText</span>(Canvas canvas, String str) {
        <span class="hljs-comment">//设置文字绘制的区域</span>
        textRect.left = getPaddingLeft();
        textRect.top = getPaddingTop();
        textRect.right = getWidth()-getPaddingRight();
        textRect.bottom = getHeight()-getPaddingBottom();
        <span class="hljs-comment">//获取画笔</span>
        TextPaint paint = getPaint();
        <span class="hljs-comment">//描述画笔对象的属性特征,计算位置的坐标</span>
        Paint.FontMetrics fontMetrics = paint.getFontMetrics();
        <span class="hljs-comment">//TODO 不是特别明白为啥要除以2</span>
        <span class="hljs-keyword">int</span> baseLine = (<span class="hljs-keyword">int</span>) ((textRect.bottom+textRect.top-fontMetrics.bottom-fontMetrics.top)/<span class="hljs-number">2</span>);
        <span class="hljs-comment">//文字绘制到整个布局的中心位置</span>
        canvas.drawText(str,getPaddingLeft(),baseLine,paint);
    }

    <span class="hljs-comment">//利用属性动画冬天改变绘制的文字,文字逐个显示动画,通过插值的方式改变数据源</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initAnimation</span>(){
        <span class="hljs-comment">//从0到textCount -1,是设置从第一个字到最后一个字的变化因子,获取单个字符</span>
        textAnimation = ValueAnimator.ofInt(<span class="hljs-number">0</span>,textCount-<span class="hljs-number">1</span>);
        <span class="hljs-comment">//执行的总时间就是每个字的时间乘以字数</span>
        textAnimation.setDuration(textCount*duration);
        <span class="hljs-comment">//通过插值器来控制来匀速显示文字</span>
        textAnimation.setInterpolator(<span class="hljs-keyword">new</span> LinearInterpolator());
        <span class="hljs-comment">//监听动画更新过程</span>
        textAnimation.addUpdateListener(<span class="hljs-keyword">new</span> ValueAnimator.AnimatorUpdateListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationUpdate</span>(ValueAnimator animation) {
                <span class="hljs-keyword">int</span> index = (<span class="hljs-keyword">int</span>) animation.getAnimatedValue();
                Log.e(<span class="hljs-string">"index"</span>,index+<span class="hljs-string">""</span>);
               <span class="hljs-comment">//过滤去重,保证每个字只重绘一次</span>
                <span class="hljs-keyword">if</span>(currentIndex != index) {
                    mStringBuffer.append(arr[index]);

                    currentIndex = index;
                    Log.e(<span class="hljs-string">"index"</span>,index+<span class="hljs-string">"index"</span>);
                    <span class="hljs-comment">//所有文字都显成之后进度回调结束动画</span>
                    <span class="hljs-keyword">if</span>(currentIndex == textCount -<span class="hljs-number">1</span>) {
                        <span class="hljs-keyword">if</span>(textAnimationListener != <span class="hljs-keyword">null</span>) {
                            textAnimationListener.annimationFinish();
                        }
                    }
                    <span class="hljs-comment">//不断通知重新绘制</span>
                    invalidate();
                }
            }
        });
    }
    <span class="hljs-comment">//设置逐渐显示的字符串,对外提供的方法</span>
    <span class="hljs-keyword">public</span> FadeInTextView <span class="hljs-title">setTextString</span>(String textString){
        <span class="hljs-keyword">if</span>(textString != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">//总字数</span>
            textCount = textString.length();
            <span class="hljs-comment">//存放单个字的数组</span>
            arr = <span class="hljs-keyword">new</span> String[textCount];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; textCount; i++) {
                <span class="hljs-comment">//通过循环,截取</span>
                arr[i] = textString.substring(i,i+<span class="hljs-number">1</span>);
            }
            <span class="hljs-comment">//初始化</span>
            initAnimation();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }

    <span class="hljs-comment">//开启动画</span>
    <span class="hljs-keyword">public</span> FadeInTextView <span class="hljs-title">startFadeInAnimation</span>(){
        <span class="hljs-keyword">if</span>(textAnimation != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">//动画开启的时候参数都设置成初始状态,设置长度为及索引</span>
            mStringBuffer.setLength(<span class="hljs-number">0</span>);
            currentIndex = -<span class="hljs-number">1</span>;
            textAnimation.start();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }

    <span class="hljs-comment">//停止动画</span>
    <span class="hljs-keyword">public</span> FadeInTextView <span class="hljs-title">stopFadeInAnimation</span>(){
        <span class="hljs-keyword">if</span>(textAnimation != <span class="hljs-keyword">null</span>) {
            textAnimation.end();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
    <span class="hljs-comment">//回调接口</span>
    interface  TextAnimationListener{
        <span class="hljs-keyword">void</span> annimationFinish();
    }
}</code></pre> 
<p><strong>调用方法为:</strong></p> 
<pre class="prettyprint"><code class=" hljs java">fadeInTextView.setTextString(<span class="hljs-string">"自定义view实现字符串逐字显示"</span>)
                .startFadeInAnimation()
                .setTextAnimationListener(<span class="hljs-keyword">new</span> FadeInTextView.TextAnimationListener() {
                    <span class="hljs-annotation">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">annimationFinish</span>() {

                    }
                });</code></pre> 
<p>以上,即可, <br> 再次感谢原创博客作者</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/860216b681ea7fb778fc070e6e8ac92f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">spring之把配置文件的加载交给服务</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f73215fdad09f08a8d2cb3b6f0d93276/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">快速搭建Web Api OData V4服务端</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>