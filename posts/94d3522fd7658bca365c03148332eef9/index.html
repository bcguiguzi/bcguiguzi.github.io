<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>osmdroid 在线加载谷歌瓦片（谷歌地图瓦片地址解释） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="osmdroid 在线加载谷歌瓦片（谷歌地图瓦片地址解释）" />
<meta property="og:description" content="osmdroid作为一个开源的项目，在在线地图上还是做的不错，离线地图上也能支持多种格式，例如：zip，sqlite，.mbtiles，gemf，map，gpkg等格式。就是不能直接加载shp文件大为苦恼。osmdroid没有可以设置坐标参考系的接口。只有地图坐标与屏幕坐标的转换绘制。接下来就讲讲osmdroid 在线加载谷歌瓦片。
android osmdroid 加载常用离线地图格式（开源的在线地图）
android osmdroid 加载离线地图map格式以及地图网格绘制 android 开源库osmdroid绘制点线面（比例尺，缩小放大，导航图标等）
1、实现效果 影像数据，加上地图标注
影像数据，没有地图标注
矢量数据地图
2、在线地图地址 package com.googlemap.online; import org.osmdroid.tileprovider.MapTile; import org.osmdroid.tileprovider.tilesource.XYTileSource; public class GoogleTileSource extends XYTileSource { //影像的叠加层 lyrs=h static final String[] baseUrl_GoogleLabel = new String[]{ &#34;http://mt1.google.cn/vt/imgtp=png32&amp;lyrs=h@210000000&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G&#34;, &#34;http://mt2.google.cn/vt/imgtp=png32&amp;lyrs=h@210000000&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G&#34;, &#34;http://mt3.google.cn/vt/imgtp=png32&amp;lyrs=h@210000000&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G&#34; }; //矢量底图 lyrs=m lyrs=是指瓦片类型 有标注 在国内但有偏移，国外暂无测试 static final String[] baseUrl_GoogleRoad = new String[]{ &#34;http://mt1.google.cn/vt/lyrs=m@209712068&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G&#34;, &#34;http://mt2.google.cn/vt/lyrs=m@209712068&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G&#34;, &#34;http://mt3.google.cn/vt/lyrs=m@209712068&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G&#34; }; //影像底图 lyrs=y 有标注 在国内但有偏移，国外暂无测试 static final String[] baseUrl_Google_cn = new String[]{ &#34;http://mt0.google.cn/vt/lyrs=y@126&amp;hl=zh-CN&amp;gl=cn&amp;src=app&amp;s=G&#34;, &#34;http://mt1.google.cn/vt/lyrs=y@126&amp;hl=zh-CN&amp;gl=cn&amp;src=app&amp;s=G&#34;, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/94d3522fd7658bca365c03148332eef9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-12-22T08:36:12+08:00" />
<meta property="article:modified_time" content="2017-12-22T08:36:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">osmdroid 在线加载谷歌瓦片（谷歌地图瓦片地址解释）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-size:14px;">osmdroid作为一个开源的项目，在在线地图上还是做的不错，离线地图上也能支持多种格式，例如：<span style='color: rgb(85, 85, 85); font-family: Helvetica, "Tahoma, Arial", sans-serif; text-align: justify;'>zip，sqlite，.mbtiles，gemf</span>，map，gpkg等格式。就是不能直接加载shp文件大为苦恼。osmdroid没有可以设置坐标参考系的接口。只有地图坐标与屏幕坐标的转换绘制。接下来就讲讲osmdroid 在线加载谷歌瓦片。</span></p> 
<p></p> 
<div style='color: rgb(85, 85, 85); font-family: "microsoft yahei";'> 
 <span style="box-sizing: border-box; margin: 0px; padding: 0px;"><span style="font-size:14px;"><a target="_blank" href="http://blog.csdn.net/qq_16064871/article/details/54024687" style="text-decoration-line: none; color: rgb(0, 0, 0); font-weight: bold;" rel="noopener noreferrer">android osmdroid 加载常用离线地图格式（开源的在线地图）</a><br></span></span> 
</div> 
<div style='color: rgb(85, 85, 85); font-family: "microsoft yahei";'> 
 <a target="_blank" href="http://blog.csdn.net/qq_16064871/article/details/57131517" style="text-decoration-line: none; color: rgb(0, 0, 0); font-weight: bold;" rel="noopener noreferrer"><span style="font-size:14px;">android osmdroid 加载离线地图map格式以及地图网格绘制</span></a> 
</div> 
<div style='color: rgb(85, 85, 85); font-family: "microsoft yahei";'> 
 <span style="font-size:14px;"><a target="_blank" href="http://blog.csdn.net/qq_16064871/article/details/71046357" style='text-decoration-line: none; color: rgb(0, 0, 0); font-family: "microsoft yahei"; font-weight: 700;' rel="noopener noreferrer">android 开源库osmdroid绘制点线面（比例尺，缩小放大，导航图标等）</a><br></span> 
</div> 
<h4 style='font-family: "microsoft yahei";'><span style="font-size:14px;">1、实现效果</span></h4> 
<img src="https://images2.imgbox.com/f8/d2/pNgooPYt_o.png" alt=""> 
<br> 
<p></p> 
<p><span style="font-size:14px;">影像数据，加上地图标注</span></p> 
<p><br></p> 
<p><img src="https://images2.imgbox.com/26/e2/9UjOmJfQ_o.png" alt=""><br></p> 
<p><span style="font-size:14px;">影像数据，没有地图标注</span></p> 
<p><br></p> 
<p><img src="https://images2.imgbox.com/76/ab/bEjNql8p_o.png" alt=""><br></p> 
<p><span style="font-size:14px;">矢量数据地图</span></p> 
<h4><span style="font-size:14px;">2、在线地图地址</span></h4> 
<p></p> 
<pre><code class="language-java">package com.googlemap.online;

import org.osmdroid.tileprovider.MapTile;
import org.osmdroid.tileprovider.tilesource.XYTileSource;

public class GoogleTileSource extends XYTileSource {
    //影像的叠加层 lyrs=h
    static final String[] baseUrl_GoogleLabel = new String[]{
            "http://mt1.google.cn/vt/imgtp=png32&amp;lyrs=h@210000000&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G",
            "http://mt2.google.cn/vt/imgtp=png32&amp;lyrs=h@210000000&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G",
            "http://mt3.google.cn/vt/imgtp=png32&amp;lyrs=h@210000000&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G"
    };

    //矢量底图 lyrs=m  lyrs=是指瓦片类型 有标注  在国内但有偏移，国外暂无测试
    static final String[] baseUrl_GoogleRoad = new String[]{
            "http://mt1.google.cn/vt/lyrs=m@209712068&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G",
            "http://mt2.google.cn/vt/lyrs=m@209712068&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G",
            "http://mt3.google.cn/vt/lyrs=m@209712068&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G"
    };


    //影像底图 lyrs=y  有标注  在国内但有偏移，国外暂无测试
    static final String[] baseUrl_Google_cn = new String[]{
            "http://mt0.google.cn/vt/lyrs=y@126&amp;hl=zh-CN&amp;gl=cn&amp;src=app&amp;s=G",
            "http://mt1.google.cn/vt/lyrs=y@126&amp;hl=zh-CN&amp;gl=cn&amp;src=app&amp;s=G",
            "http://mt2.google.cn/vt/lyrs=y@126&amp;hl=zh-CN&amp;gl=cn&amp;src=app&amp;s=G",
            "http://mt3.google.cn/vt/lyrs=y@126&amp;hl=zh-CN&amp;gl=cn&amp;src=app&amp;s=G"
    };


    //影像底图 lyrs=s  没有标注
    static final String[] baseUrl_GoogleSatellite = new String[]{
            "http://mt0.google.cn/vt/lyrs=s@126&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G",
            "http://mt1.google.cn/vt/lyrs=s@126&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G",
            "http://mt2.google.cn/vt/lyrs=s@126&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G",
            "http://mt3.google.cn/vt/lyrs=s@126&amp;hl=en-US&amp;gl=US&amp;src=app&amp;s=G"
    };

    String urlXYZ = "&amp;x={$x}&amp;y={$y}&amp;z={$z}";

    public GoogleTileSource() {
        super("Google", 2, 22, 256, "png", baseUrl_GoogleRoad);
    }

    @Override
    public String getTileURLString(MapTile aTile) {
        String url = getBaseUrl() + urlXYZ
                .replace("{$x}", aTile.getX() + "")
                .replace("{$y}", aTile.getY() + "")
                .replace("{$z}", aTile.getZoomLevel() + "");
        return url;
    }
}
</code></pre> 
<p></p> 
<p><br></p> 
<span style="font-size:14px;">我在网上找到如下解释，比较详细的解释<br>地图瓦片地址：http://mt2.google.cn/vt/lyrs=m@167000000&amp;hl=zh-CN&amp;gl=cn&amp;x=420&amp;y=193&amp;z=9&amp;s=Galil<br>详细解释下<br><br>mt2.google.cn ：Google瓦片服务服务器，可以尝试mt1.google.cn依然有效<br>。Google提供多台瓦片服务器，减轻服务器负载，提高网络访问效率。<br>x瓦片的横向索引，起始位置为最左边，数值为0，向右+1递增。<br>y瓦片的纵向索引，起始位置为最上面，数值为0，向下+1递增。<br>z地图的级别Zoom，最上一级为0，向下依次递增。(0~22)<br><br>​s             <br>(3*x + y)%8 = s<br>x , y , z 组合后与 8 求余即可得到 s 的值。​<br><br>其它几个参数的含义<br><br>1)mt ( 0—3)<br>Google 地图使用了四个服务地址，<br>即 http://mt ( 0—3).google.cn/......，都可以用。<br>地图：http://mt2.google.cn/vt/lyrs=m@&amp;hl=zh-CN&amp;gl=cn&amp;x=...<br>影像底图：http://mt3.google.cn/vt/lyrs=s@110&amp;hl=zh-CN&amp;gl=cn&amp;x=...<br>影像的叠加：http://mt1.google.cn/vt/imgtp=png32&amp;lyrs=h&amp;hl=zh-CN&amp;gl=cn&amp;x=...<br><br>2)lyrs=...<br>表示的是图层类型，即瓦片类型，<br>具体含义如下：<br>m：路线图<br>t：地形图<br>​p：带标签的地形图<br>​s：卫星图<br>y：带标签的卫星图<br>​h：标签层（路名、地名等）<br><br>3)&amp;s=...<br>暂时未发现 "&amp;s=..." 的意义，url有无此后缀都不影响瓦片地址的访问。<br>计算瓦片URL<br>​要想出图就必须知道地图控件可视范围起始点瓦片索引、末尾瓦片索引，中间区域的瓦片索引循环遍历即可得出。</span> 
<h4><span style="font-size:14px;">3、osmdroid调用</span></h4> 
<p></p> 
<pre><code class="language-java">package com.googlemap.online;

import android.app.Activity;
import android.os.Bundle;
import android.util.DisplayMetrics;
import android.view.MotionEvent;
import android.view.View;
import android.widget.Toast;

import org.osmdroid.tileprovider.MapTileProviderBasic;
import org.osmdroid.tileprovider.tilesource.TileSourceFactory;
import org.osmdroid.util.GeoPoint;
import org.osmdroid.views.MapView;
import org.osmdroid.views.overlay.ScaleBarOverlay;
import org.osmdroid.views.overlay.TilesOverlay;
import org.osmdroid.views.overlay.compass.CompassOverlay;
import org.osmdroid.views.overlay.compass.InternalCompassOrientationProvider;
import org.osmdroid.views.overlay.gestures.RotationGestureOverlay;
import org.osmdroid.views.overlay.mylocation.GpsMyLocationProvider;
import org.osmdroid.views.overlay.mylocation.MyLocationNewOverlay;

public class MainActivity extends Activity  implements View.OnClickListener {

    private MapView mapView;
    //et地图旋转
    private RotationGestureOverlay mRotationGestureOverlay;
    //比例尺
    private ScaleBarOverlay mScaleBarOverlay;
    //指南针方向
    private CompassOverlay mCompassOverlay = null;
    //设置导航图标的位置
    private MyLocationNewOverlay mLocationOverlay;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        initView();
    }

    private void initView() {

        findViewById(R.id.button1).setOnClickListener(this);

        mapView = (MapView) findViewById(R.id.mymapview);
        mapView.setDrawingCacheEnabled(true);
        mapView.setMaxZoomLevel(22);
        mapView.setMinZoomLevel(6);
        mapView.getController().setZoom(12);
        //加载谷歌地图，设置地图数据源的形式
        mapView.setTileSource(new GoogleTileSource());

        mapView.setUseDataConnection(true);
        mapView.setMultiTouchControls(true);// 触控放大缩小
        //是否显示地图数据源
        mapView.getOverlayManager().getTilesOverlay().setEnabled(true);

        //地图自由旋转
        mRotationGestureOverlay = new RotationGestureOverlay(mapView);
        mRotationGestureOverlay.setEnabled(true);
        mapView.getOverlays().add(this.mRotationGestureOverlay);

        //比例尺配置
        final DisplayMetrics dm = getResources().getDisplayMetrics();
        mScaleBarOverlay = new ScaleBarOverlay(mapView);
        mScaleBarOverlay.setCentred(true);
        mScaleBarOverlay.setAlignBottom(true); //底部显示
        mScaleBarOverlay.setScaleBarOffset(dm.widthPixels / 5, 80);
        mapView.getOverlays().add(this.mScaleBarOverlay);

        //指南针方向
        mCompassOverlay = new CompassOverlay(this, new InternalCompassOrientationProvider(this),
                mapView);
        mCompassOverlay.enableCompass();
        mapView.getOverlays().add(this.mCompassOverlay);

        //设置导航图标
        this.mLocationOverlay = new MyLocationNewOverlay(new GpsMyLocationProvider(this),
                mapView);
        mapView.getOverlays().add(this.mLocationOverlay);
        mLocationOverlay.enableMyLocation();  //设置可视
    }

    @Override
    public void onClick(View v) {
        switch (v.getId()) {
            case R.id.button1:
                //定位当前的位置，并设置缩放级别
                mapView.getController().setZoom(18);
                mapView.getController().setCenter(new GeoPoint(23.12648183, 113.365548756));
                break;
            default:
                break;
        }
    }

    //增加图层的形式
    public void initExtendMap() {
        MapTileProviderBasic mapTileProviderBasic =
                new MapTileProviderBasic(this, new GoogleTileSource());
        TilesOverlay tilesOverlay = new TilesOverlay(mapTileProviderBasic, this);
        mapView.getOverlays().add(tilesOverlay);

    }

    @Override
    public void onPause() {
        super.onPause();
    }


    @Override
    public void onResume() {
        super.onResume();
    }
}
</code></pre> 
<br> 
<h4><span style="font-size:14px;">4、记得权限</span></h4> 
<p></p> 
<p><span style="font-size:14px;">还有网上下载瓦片数据需要存储的权限</span></p> 
<p><span style="font-size:14px;">定位，联网的权限</span></p> 
<p></p> 
<pre><code class="language-html">    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;
    &lt;uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;
    &lt;uses-permission android:name="android.permission.INTERNET" /&gt;</code></pre> 
<br> 
<h4><span style="font-size:14px;">5、测试注意</span></h4> 
<p></p> 
<p><span style="font-size:14px;">在线瓦片加载后是有缓存，有时候比较缓慢。默认缓存是放在根目录下面的osmdroid文件夹。如果你一个app出现多次测试不同的在线资源，有可能出现叠加的情况。出现就删除缓存吧。还有测试时候最好定位一下你当前的位置，比较好确认。</span></p> 
<p><span style="font-size:14px;">博客源码下载：<a target="_blank" href="http://download.csdn.net/download/qq_16064871/10168741" rel="noopener noreferrer">http://download.csdn.net/download/qq_16064871/10168741</a></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e105245068e74320c2521ca887920203/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Building the kernel with clang</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c071d1ce7e66ca0b04eb10ad016c725a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">android boot image格式分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>