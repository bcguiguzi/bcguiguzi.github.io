<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>伽马校正(Gamma Correction)与sRGB - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="伽马校正(Gamma Correction)与sRGB" />
<meta property="og:description" content="文章目录 CRT显示器与人眼视觉非线性显示与渲染伽马校正sRGB 纹理正确的点光衰减补充参考资料 CRT显示器与人眼视觉 过去, 大多数监视器是阴极射线管显示器(CRT). 这些监视器有一个物理特性就是两倍的输入电压产生的不是两倍的亮度. 输入电压产生约为输入电压的 2.2 次幂的亮度. 这本质上是一个问题, 但是由于一个神奇的巧合, CRT显示器的这一特性被保留了下来.
这个神奇的巧合就是: 人类的视觉系统进化出了一个特性, 黑暗环境下的辨识能力要强于明亮环境, 这可能有助于我们及时发现黑暗中隐藏的危险. 如下图所示, 第一行表示的人眼感受到的亮度, 第二行表示实际的物理亮度. 物理亮度基于光子数量, 是线性的, 而感知亮度基于人的感觉是非线性的.
通过观察可以看到物理亮度在我们眼中会显得暗部细节缺失而亮部细节过剩. 人眼对物理亮度的感知和 CRT 显示器显示亮度对电压的感知很接近, CRT亮度是电压的2.2次幂而人眼的观察亮度相当于物理亮度的2次幂, 因此CRT这个缺陷正好能满足人的需要, 后面的硬件也都保留了这一非线性特性.
2.2 这一数字就是所谓的伽马(Gamma), 也叫灰度系数, 各种显示设备会有各自的伽马值, 矫正使用的伽马值取决于显示器, 但是现代系统基本上都统一使用 2.2.
非线性显示与渲染 显示器的非线性特性让亮度在我们眼中看起来更好, 但是在渲染时反而会因此导致问题. 我们的渲染计算都是在伽马值为 1 的理想线性空间进行的. 比如现在我们输入了一个暗红色的光照(0.5, 0.0, 0.0), 然后希望将亮度提升一倍变为 (1.0, 0.0, 0.0). 但是由于显示器的非线性特性, 最终显示的颜色实际是从 (0.218, 0.0, 0.0) 变成了 (1.0, 0.0, 0.0).
我们一度忽略了这一问题, 通常是美术同学将光照设置的比本来更亮一些来抵消显示器对亮度的削减. 但是这本来就是一个数学上的错误, 使用更高级的光照算法时, 这个问题会越来越明显. 在 Physically Based Rendering 兴起之后, 我们更是不可能在渲染底层存在这样的问题, 于是便产生了伽马校正技术(Gamma Correction)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/9168dfd0d65ca4a4de27f9ba6642a7e5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-24T01:24:01+08:00" />
<meta property="article:modified_time" content="2021-01-24T01:24:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">伽马校正(Gamma Correction)与sRGB</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#CRT_4" rel="nofollow">CRT显示器与人眼视觉</a></li><li><a href="#_16" rel="nofollow">非线性显示与渲染</a></li><li><a href="#_24" rel="nofollow">伽马校正</a></li><li><a href="#sRGB__32" rel="nofollow">sRGB 纹理</a></li><li><a href="#_44" rel="nofollow">正确的点光衰减</a></li><li><a href="#_59" rel="nofollow">补充</a></li><li><a href="#_73" rel="nofollow">参考资料</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="CRT_4"></a>CRT显示器与人眼视觉</h2> 
<p>过去, 大多数监视器是阴极射线管显示器(CRT). 这些监视器有一个物理特性就是两倍的输入电压产生的不是两倍的亮度. 输入电压产生约为输入电压的 2.2 次幂的亮度. 这本质上是一个问题, 但是由于一个神奇的巧合, CRT显示器的这一特性被保留了下来.</p> 
<p>这个神奇的巧合就是: 人类的视觉系统进化出了一个特性, 黑暗环境下的辨识能力要强于明亮环境, 这可能有助于我们及时发现黑暗中隐藏的危险. 如下图所示, 第一行表示的人眼感受到的亮度, 第二行表示实际的物理亮度. <strong>物理亮度基于光子数量, 是线性的, 而感知亮度基于人的感觉是非线性的.</strong><br> <img src="https://images2.imgbox.com/26/01/so3eLA8p_o.png" alt="灰阶"><br> 通过观察可以看到物理亮度在我们眼中会显得暗部细节缺失而亮部细节过剩. 人眼对物理亮度的感知和 CRT 显示器显示亮度对电压的感知很接近, CRT亮度是电压的2.2次幂而人眼的观察亮度相当于物理亮度的2次幂, 因此CRT这个缺陷正好能满足人的需要, 后面的硬件也都保留了这一非线性特性.</p> 
<p>2.2 这一数字就是所谓的伽马(Gamma), 也叫灰度系数, 各种显示设备会有各自的伽马值, 矫正使用的伽马值取决于显示器, 但是现代系统基本上都统一使用 2.2.</p> 
<hr> 
<h2><a id="_16"></a>非线性显示与渲染</h2> 
<p>显示器的非线性特性让亮度在我们眼中看起来更好, 但是在渲染时反而会因此导致问题. <strong>我们的渲染计算都是在伽马值为 1 的理想线性空间进行的</strong>. 比如现在我们输入了一个暗红色的光照(0.5, 0.0, 0.0), 然后希望将亮度提升一倍变为 (1.0, 0.0, 0.0). 但是由于显示器的非线性特性, 最终显示的颜色实际是从 (0.218, 0.0, 0.0) 变成了 (1.0, 0.0, 0.0).<br> <img src="https://images2.imgbox.com/38/b4/DeApsBg4_o.png" alt="伽马曲线"><br> 我们一度忽略了这一问题, 通常是美术同学将光照设置的比本来更亮一些来抵消显示器对亮度的削减. 但是这本来就是一个数学上的错误, 使用更高级的光照算法时, 这个问题会越来越明显. 在 Physically Based Rendering 兴起之后, 我们更是不可能在渲染底层存在这样的问题, 于是便产生了伽马校正技术(Gamma Correction).</p> 
<p><img src="https://images2.imgbox.com/bd/52/PRN6PI37_o.png" alt="伽马校正对比"></p> 
<hr> 
<h2><a id="_24"></a>伽马校正</h2> 
<p>分析上面的错误情况, 问题的原因在于我们理想的输出颜色被显示器执行了 pow2.2 的操作. 所以伽马校正的思路就是在颜色被输送到显示器之前, 我们<strong>先对其进行 pow0.454 的逆运算以抵消显示器的作用.</strong></p> 
<p>伽马校正可以通过图形API提供的方法由硬件执行, 也可以在像素着色器最终输出之前我们自己执行. 但无论哪种方式都需要注意区分我们当前需要的颜色是在 Gamma 1.0 的线性空间中还是在 Gamma 2.2 的 sRGB 空间中. 比如一个效果需要执行两个 pass, 第一个 pass 生成的是中间结果作为第二个 pass 的输入, 数据尚处于线性空间, 那么就不能对其进行伽马校正. 第二个 pass 生成的结果要输出到显示器, 需要进入 sRGB 空间, 所以在输出之前要对计算结果进行伽马校正.<br> <img src="https://images2.imgbox.com/09/c1/2vp4rGKO_o.jpg" alt="伽马校正原理"></p> 
<hr> 
<h2><a id="sRGB__32"></a>sRGB 纹理</h2> 
<p>2.2 是大多数显示设备的平均伽马值. 每个监视器的伽马曲线都有所不同, 但是 Gamma 2.2 在大多数显示器上表现都不错. 出于这个原因, 大多数游戏会将伽马值设置为 2.2, 并且有的游戏会为玩家提供伽马值的自定义设置选项, 以适应每个监视器. <strong>基于 Gamma 2.2 的颜色空间叫做 sRGB 颜色空间.</strong></p> 
<p>由于显示器总是在 sRGB 空间显示应用了伽马之后的颜色, 这导致制作纹理资源的美术同学创建的纹理都在 sRGB 空间. 在我们应用伽马校正之前, 这个纹理是可以正常使用的, 因为其制作和使用的颜色空间没有发生变化. 但是在应用伽马校正之后, 我们是把所有东西都放在线性空间中展示的, 纹理最终会错误的变亮. <strong>这是由于在纹理制作时美术同学为了达到人眼的感知亮度相当于已经为实际需要的线性空间亮度进行了一次 pow0.454 的伽马校正, 如果此时不做处理直接使用就进行了两次伽马校正!</strong></p> 
<p><img src="https://images2.imgbox.com/00/f5/zwIMPTMC_o.png" alt="sRGB纹理错误"><br> 让美术人员在线性空间中进行纹理制作可以解决这一问题, 但是伽马校正的内部逻辑并不一定是所有美术人员都需要理解的知识, 并且在 sRGB 空间进行创作显然更加容易. 所以<strong>一般情况下我们都会由程序来对纹理进行重校.</strong> 重校可以在 shader 中进行, 读取出纹理中的颜色之后对其进行 pow 2.2 的校正. 也可以通过图形 API 由硬件进行处理, 比如 OpenGL 中可以在创建纹理的时候将其指定为 GL_SRGB 或 GL_SRGB_ALPHA.</p> 
<p><strong>sRGB 纹理重校和伽马校正一样, 使用时需要注意应用的对象, 并不是所有的纹理都是在 sRGB 空间制作的.</strong> 诸如 diffuse 贴图这类为物体上色的纹理几乎都是在 sRGB 空间的, 相反像法线贴图这种提供光照参数的纹理则几乎都是在线性空间的. 将法线贴图配置为 sRGB 纹理反而会导致渲染错误.</p> 
<hr> 
<h2><a id="_44"></a>正确的点光衰减</h2> 
<p>在真实世界中, 光源产生的亮度与距离的平方成反比, 也就是</p> 
<pre><code class="prism language-c++">float attenuation = 1.0 / (distance * distance);
</code></pre> 
<p>但是当我们在光照计算中应用这一方程的时候会发现这个衰减过于强烈. 这时如果不进行伽马校正的话, 由于显示器的伽马值, 最终的衰减实际变成了 (1.0 / distance ^ 2) ^ 2.2, 这个衰减确实太过强烈了. 在引入伽马校正之前, 通常使用亮度与距离成反比的衰减公式. 不过在显示器伽马值的作用下, 这种衰减反而变得和物理公式很接近: (1.0 / distance) ^ 2.2 = 1.0 / distance ^ 2.2</p> 
<table><thead><tr><th></th><th>无伽马校正</th><th>有伽马校正</th></tr></thead><tbody><tr><td>平方衰减</td><td>衰减过度</td><td>期望图像</td></tr><tr><td>线性衰减</td><td>衰减接近期望效果但是画面整体亮度错误偏暗</td><td>衰减不足</td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/9c/fc/n6NuQkDq_o.png" alt="衰减与伽马校正"></p> 
<hr> 
<h2><a id="_59"></a>补充</h2> 
<p>在查阅相关资料的时候发现了一个精妙的方法, 此方法对人眼视觉, 显示器伽马等现象进行了直观的展现.</p> 
<p>我们已知纯黑和纯白在显示时分别是 0 和 255. 如下图所示, 图像分为 3 列, 左右两列为黑线和白线的均匀混合, 中间一列为纯色色块. 这时让我们稍微远离屏幕, 可以发现两侧表现出来的颜色与中间列下半部分显示的颜色比较接近.</p> 
<p><img src="https://images2.imgbox.com/c3/b7/NTGoiYhF_o.png" alt="视觉测试"><br> 在我们朴素的线性空间认知下, 黑白均匀混合后得到颜色值应该在 128 左右. 也就是中间列上半部分的颜色值估计在 60 左右, 下半部分的颜色值应该在 128 左右. 但是事实上用取色器取色可以得知上半部分的颜色值才是 128, 下半部分的颜色值已经达到了 187. <strong>这一现象正和我们上面研究的人眼视觉特性和显示器非线性特性有关.</strong><br> <img src="https://images2.imgbox.com/10/48/vhvUOoAi_o.png" alt="实际颜色值"><br> <strong>左右两侧黑白混合线条的意义在于: 在屏幕上直接模拟出了一个亮度居中(0.5)的光源.</strong> 所以这张图表现出的含义如下.<br> <img src="https://images2.imgbox.com/12/f2/HYyaO1xw_o.png" alt="说明"></p> 
<hr> 
<h2><a id="_73"></a>参考资料</h2> 
<ul><li><a href="https://learnopengl-cn.github.io/05%20Advanced%20Lighting/02%20Gamma%20Correction/" rel="nofollow">LearnOpenGL CN: Gamma校正</a></li><li><a href="https://www.zhihu.com/question/27467127/answer/37602200" rel="nofollow">知乎答案: 色彩校正中的 gamma 值是什么？Avatar Ye</a></li><li><a href="https://www.cnblogs.com/TracePlus/p/4168447.html" rel="nofollow">Gamma校正与线性空间 TraceYang</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a28529860412abf1dd6fb12e68bb2498/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Matplotlib学习笔记（三）散点图&amp;柱状图&amp;等高线图</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/880c2bc2ce1e1815c8b448ac93e5beb7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">此上下文中不支持函数定义。请在代码文件中创建函数_python3从零学习-5.4.6、生成临时文件和目录tempfile...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>