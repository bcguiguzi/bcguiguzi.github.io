<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python处理Excel文件 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python处理Excel文件" />
<meta property="og:description" content="对 excel 文档操作有多简单？看看python如何处理。
1 前言 最近需要频繁读写 excel 文件，想通过程序对 excel 文件进行自动化处理，发现使用 python 的 openpyxl 库进行 excel 文件读写实在太方便了，结构清晰，操作简单。本文对 openpyxl 的使用进行总结，主要包含以下内容：
openpyxl 的介绍及 excel 文件结构说明工作表的读写处理行列的读写处理单元格的读写处理 2 openpyxl 及 excel 文件结构 openpyxl 是一个对 xlsx/xlsm/xltx/xltm 格式的 2010 excel 文档进行读写的 python 库。它官网有详细的文档介绍。在进行使用前，需先安装并引入
# 安装 pip install openpyxl # 引入openpyxl 模块 import openpyxl 在进行 excel 操作之前，先对 excel 的文件结构做一个简单了解，以便于熟悉后续的操作。如下图：
一个 excel 文件，其内容按层次分为工作簿(文件) -&gt; 工作表(sheet) -&gt; 行列 -&gt; 单元格 ，对应上图，整个 excel 文件即是一个工作簿；工作簿下可以有多个工作表(如图中的 Sheet1/test1 等等)；工作表中就是对应的表格数据，分为行和列，行是用序号表示，列用大写字母表示（也可用序号）；行与列的交点就是每一个存储数据的单元格。因此，我们对 excel 表格进行读写，基本按这个层次思路来操作：读入文件，找到工作表，遍历行列，定位单元格，对单元格进行读写。因此，会涉及到工作表、行列、单元格的读写操作。这些操作之前，需要先把文件加载进来，一个 excel 文件就是一个工作簿 (workbook)，加载操作如下（示例中的 excel 文件为 text." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/6b18fc2094a99516dbdcc22ced757bcb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-01T22:19:18+08:00" />
<meta property="article:modified_time" content="2020-07-01T22:19:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python处理Excel文件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>对 excel 文档操作有多简单？看看python如何处理。</p> 
</blockquote> 
<h3><a id="1__3"></a>1 前言</h3> 
<p>最近需要频繁读写 excel 文件，想通过程序对 excel 文件进行自动化处理，发现使用 python 的 openpyxl 库进行 excel 文件读写实在太方便了，结构清晰，操作简单。本文对 openpyxl 的使用进行总结，主要包含以下内容：</p> 
<ul><li>openpyxl 的介绍及 excel 文件结构说明</li><li>工作表的读写处理</li><li>行列的读写处理</li><li>单元格的读写处理</li></ul> 
<h3><a id="2_openpyxl__excel__12"></a>2 openpyxl 及 excel 文件结构</h3> 
<p>openpyxl 是一个对 <code>xlsx/xlsm/xltx/xltm</code> 格式的 2010 excel 文档进行读写的 python 库。它<a href="https://openpyxl.readthedocs.io/" rel="nofollow">官网</a>有详细的文档介绍。在进行使用前，需先安装并引入</p> 
<pre><code class="prism language-python"><span class="token comment"># 安装</span>
pip install openpyxl
<span class="token comment"># 引入openpyxl 模块</span>
<span class="token keyword">import</span> openpyxl
</code></pre> 
<p>在进行 excel 操作之前，先对 excel 的文件结构做一个简单了解，以便于熟悉后续的操作。如下图：</p> 
<p><img src="https://images2.imgbox.com/de/c8/mWmFIpew_o.png" alt="excel示例"></p> 
<p>一个 excel 文件，其内容按层次分为<code>工作簿(文件) -&gt; 工作表(sheet) -&gt; 行列 -&gt; 单元格</code> ，对应上图，整个 excel 文件即是一个工作簿；工作簿下可以有多个工作表(如图中的 Sheet1/test1 等等)；工作表中就是对应的表格数据，分为行和列，行是用序号表示，列用大写字母表示（也可用序号）；行与列的交点就是每一个存储数据的单元格。因此，我们对 excel 表格进行读写，基本按这个层次思路来操作：读入文件，找到工作表，遍历行列，定位单元格，对单元格进行读写。因此，会涉及到工作表、行列、单元格的读写操作。这些操作之前，需要先把文件加载进来，一个 excel 文件就是一个工作簿 (workbook)，加载操作如下（示例中的 excel 文件为 text.xlsx）：</p> 
<pre><code class="prism language-python"><span class="token comment"># 加载excel文件</span>
file_path <span class="token operator">=</span> <span class="token string">"E:/pythontest/test.xlsx"</span>
workbook <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="3__37"></a>3 工作表处理</h3> 
<h4><a id="31__39"></a>3.1 工作表读取</h4> 
<p>工作表( sheet )会有多个，可以读取全部的工作表，读取单个时，可以按 sheet 名称读取，也可以按下标（下标从0开始）。</p> 
<ul><li>全部工作表对象：<code>workbook.worksheets</code></li><li>全部工作表名称：<code>workbook.sheetnames</code></li><li>按名称(sheet_name)获取工作表：<code>workbook[sheet_name]</code></li><li>按下标(i从0开始)获取工作表：<code>workbook.worksheets[i]</code></li><li>获取正在使用的工作表：<code>workbook.active</code></li><li>获取工作表的属性（如工作表名称、最大行数和列数等）：<code>sheet.title</code>、<code>sheet.max_row</code>、<code>sheet.max_column</code></li></ul> 
<p>如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># 全部sheet对象</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> workbook<span class="token punctuation">.</span>worksheets
<span class="token punctuation">[</span><span class="token operator">&lt;</span>Worksheet <span class="token string">"Sheet1"</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Worksheet <span class="token string">"test1"</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Worksheet <span class="token string">"test2"</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
<span class="token comment"># 全部sheet名称</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> workbook<span class="token punctuation">.</span>sheetnames
<span class="token punctuation">[</span><span class="token string">'Sheet1'</span><span class="token punctuation">,</span> <span class="token string">'test1'</span><span class="token punctuation">,</span> <span class="token string">'test2'</span><span class="token punctuation">]</span>
<span class="token comment"># 按名称读取sheet</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> workbook<span class="token punctuation">[</span><span class="token string">"Sheet1"</span><span class="token punctuation">]</span>
<span class="token operator">&lt;</span>Worksheet <span class="token string">"Sheet1"</span><span class="token operator">&gt;</span>
<span class="token comment"># 按下标读取</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> workbook<span class="token punctuation">.</span>worksheets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token operator">&lt;</span>Worksheet <span class="token string">"Sheet1"</span><span class="token operator">&gt;</span>
<span class="token comment"># 获取当前正在使用的sheet</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> workbook<span class="token punctuation">.</span>active
<span class="token operator">&lt;</span>Worksheet <span class="token string">"Sheet1"</span><span class="token operator">&gt;</span>
<span class="token comment"># 获取sheet的属性</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet_active<span class="token punctuation">.</span>title
Sheet1
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet_active<span class="token punctuation">.</span>max_row
<span class="token number">6</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet_active<span class="token punctuation">.</span>max_column
<span class="token number">3</span>
</code></pre> 
<h4><a id="32__77"></a>3.2 工作表添加</h4> 
<p>若需要新增工作表，按操作流程，先添加工作表，再保存文件。创建通过<code>create_sheet</code>完成，创建后保存(save)文件，添加才能生效。</p> 
<ul><li>创建工作表，若名称相同，则自动进行重命名：<code>workbook.create_sheet("test3")</code></li><li>在指定的下标创建工作表：<code>workbook.create_sheet("test4",1)</code></li><li>保存文件，若文件路径与打开的文件路径相同，则覆盖；不同，则会复制原文件并保存（相当于另存为）：<code>workbook.save(file_path)</code></li></ul> 
<h4><a id="33__85"></a>3.3 工作表修改</h4> 
<p>要修改工作表名称，直接通过设置工作表的 title 即可，修改后同样需要保存文件。</p> 
<pre><code class="prism language-python"><span class="token comment"># 修改工作表名称</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet1 <span class="token operator">=</span> workbook<span class="token punctuation">[</span><span class="token string">'test1'</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet1<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'test11'</span>
<span class="token comment"># 保存文件</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> workbook<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="34__97"></a>3.4 工作表删除</h4> 
<p>删除工作表，需要先获取 sheet 对象，然后删除。删除有两种方式，一是使用 <code>workbook</code> 提供的 <code>remove</code> 方法，也可以直接使用 python 的<code>del</code>进行删除。删除操作后，同样需要保存文件：</p> 
<pre><code class="prism language-python"><span class="token comment"># remove删除工作表</span>
sheet <span class="token operator">=</span> workbook<span class="token punctuation">[</span><span class="token string">"test-1"</span><span class="token punctuation">]</span>
workbook<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>sheet<span class="token punctuation">)</span>
<span class="token comment"># del操作删除</span>
<span class="token keyword">del</span> workbook<span class="token punctuation">[</span><span class="token string">"test2"</span><span class="token punctuation">]</span>
<span class="token comment"># 保存文件</span>
workbook<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="4__113"></a>4 行列处理</h3> 
<p>获取 sheet 对象后，后续即可进行行列操作，包括行列读取，添加，删除等。</p> 
<h4><a id="41__117"></a>4.1 读行列</h4> 
<ul><li>获取全部行和列，然后可以进行遍历：<code>sheet.rows</code> ，<code>sheet.columns</code></li><li>读取部分行列：读一行<code>sheet[1]</code>,读多行<code>sheet[2:3]</code>，读一列<code>sheet['A']</code>，读多列<code>sheet['B:C']</code></li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 遍历全部行</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> sheet<span class="token punctuation">.</span>rows<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A1<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>B1<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>C1<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A2<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>B2<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>C2<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment"># 读取部分行列</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A1<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>B1<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>C1<span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet<span class="token punctuation">[</span><span class="token string">"A:B"</span><span class="token punctuation">]</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A1<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A2<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A3<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A4<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A5<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A6<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>B1<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>B2<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>B3<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>B4<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>B5<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>B6<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="42__137"></a>4.2 添加行列</h4> 
<p>添加行列，可以指定位置添加单个行列或多个行列。</p> 
<ul><li>直接在工作表中追加行数据：<code>sheet.append(rowdata)</code></li><li>在指定 index（从1开始计算） 位置添加行列：<code>sheet.insert_rows</code>,<code>sheet.insert_cols</code></li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 在第4行插入1行空行</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet<span class="token punctuation">.</span>insert_rows<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment"># 在第2行插入2行空行</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet<span class="token punctuation">.</span>insert_rows<span class="token punctuation">(</span>idx<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>amount<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment"># 添加一行数据到表</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> row_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">"tom@test.com"</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row_data<span class="token punctuation">)</span>
<span class="token comment"># 保存修改内容</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> workbook<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="43__156"></a>4.3 删除行列</h4> 
<p>删除操作与插入行列操作方式一致，使用<code>delete_rows</code>及<code>delete_cols</code>方法。</p> 
<pre><code class="prism language-python"><span class="token comment"># 删除行</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet<span class="token punctuation">.</span>delete_rows<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> workbook<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="5__166"></a>5 单元格处理</h3> 
<p>我们的数据最终是保存在每一个单元格（Cell）中，因此，最终我们操作数据其实就是单元格中的数据，单元格中，openpyxl 使用是 Cell 对象。前面在遍历行列数据时，可以看到输出<code>&lt;Cell 'Sheet1'.A1&gt;</code>的内容，这对应的单元格对象。下面对单元格的操作进行说明。</p> 
<h4><a id="51__170"></a>5.1 获取单元格数据值及属性值</h4> 
<p>定位获取单元格有两种方式：</p> 
<ul><li>直接指定行列名：<code>sheet[A1]</code></li><li>使用 <code>cell</code> 函数（行列下标从1开始）：<code>sheet.cell(row=2,column=1)</code></li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 指定行列坐标获取单元格</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet<span class="token punctuation">[</span><span class="token string">"A1"</span><span class="token punctuation">]</span>
<span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A1<span class="token operator">&gt;</span>
<span class="token comment"># cell函数获取单元格</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>Cell <span class="token string">'Sheet1'</span><span class="token punctuation">.</span>A1<span class="token operator">&gt;</span>
</code></pre> 
<p>获取单元格对象后，可以获取数据值及其属性，包括它所在的行列数，坐标，值等。</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cell <span class="token operator">=</span> sheet<span class="token punctuation">[</span><span class="token string">"A2"</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cell<span class="token punctuation">.</span>value
<span class="token string">'张三'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cell<span class="token punctuation">.</span>coordinate
<span class="token string">'A2'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cell<span class="token punctuation">.</span>column
<span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cell<span class="token punctuation">.</span>row
<span class="token number">2</span>
</code></pre> 
<h4><a id="52__200"></a>5.2 移动单元格</h4> 
<p>通过对单元格区域，可以向上、下、左、右进行移动，使用的是<code>move_range(range,rows,cols)</code>，其中 rows 和 cols 为整数，正整数表示向下或向右，负整数为向上或向左。</p> 
<pre><code class="prism language-python"><span class="token comment"># 移动数据区域(向上移动2行，向右移动3列)，正整数为向下或向右，负整数为向上或向左</span>
sheet<span class="token punctuation">.</span>move_range<span class="token punctuation">(</span><span class="token string">"A3:C3"</span><span class="token punctuation">,</span> rows<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> cols<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="53__210"></a>5.3 合并拆分单元格</h4> 
<p>对于跨行和跨列，需要对单元格进行合并，使用的是<code>merge_cells(range_string, start_row, start_column, end_row, end_column)</code>。如果要合并的单元格都有数据，只会保留左上角的数据，其他则丢弃。合并及拆分都可以通过行列坐标（如A1）或者行列下标（如1,2）进行。</p> 
<pre><code class="prism language-python"><span class="token comment"># 单元格合并，使用范围坐标</span>
sheet<span class="token punctuation">.</span>merge_cells<span class="token punctuation">(</span><span class="token string">"A2:B3"</span><span class="token punctuation">)</span>
<span class="token comment"># 单元格合并，指定行列下标（下标从1开始）</span>
sheet<span class="token punctuation">.</span>merge_cells<span class="token punctuation">(</span>start_row<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> start_column<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> end_row<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> end_column<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
<span class="token comment"># 拆分单元格</span>
sheet<span class="token punctuation">.</span>unmerge_cells<span class="token punctuation">(</span><span class="token string">"A2:B3"</span><span class="token punctuation">)</span>
sheet<span class="token punctuation">.</span>unmerge_cells<span class="token punctuation">(</span>start_row<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> start_column<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> end_row<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> end_column<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment"># 保存文件</span>
wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="54__229"></a>5.4 写入单元格</h4> 
<p>对单元格值进行修改和写入，直接对<code>cell.value</code>进行赋值即可。这里需要注意的是，可以写入 excel 公式，具体公式与 excel 中用到公式一致，另外，若是写入公式，读取时获取到的 value 值也是公式，而非公式值。</p> 
<pre><code class="prism language-python"><span class="token comment"># 写入值</span>
cell<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">"张三"</span>
<span class="token comment"># 写入公式(求平均值)</span>
cell<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">"=AVERAGE(B2:B6)"</span>
</code></pre> 
<h4><a id="55__242"></a>5.5 设置单元格格式</h4> 
<p>单元格的格式包括行高，列宽，字体、边框、对齐方式、填充颜色等。这些都在 openpyxl 的 styles 模块中。</p> 
<ul><li>行高/列宽：<code>row_dimensions[row_num].height = xx</code>，<code>sheet.column_dimensions[col_name].width = xx</code></li><li>字体( Font 对象)：包括字段名称，大小、加粗、斜体、颜色等，<code>Font(name="微软雅黑", size=20, bold=True, italic=True, color="000000")</code></li><li>边框（ Border 对象和 Side 对象）：边框每一条边的格式大小/颜色<code>Side(style="thin", color="000000")</code>，通过边构建边框对象：<code>Border(left=side, right=side, top=side, bottom=side)</code></li><li>对齐（ Alignment 对象）：垂直和水平对齐方向，是否自动换行。<code>Alignment(horizontal="center", vertical="center", wrap_text=True)</code></li><li>填充颜色，分为普通颜色填充和渐变颜色填充：<code>PatternFill(fill_type="solid", fgColor="FF0000")</code>和 <code>GradientFill(stop=("FF0000", "FD1111", "000000"))</code></li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 设置行高和列宽</span>
sheet<span class="token punctuation">.</span>row_dimensions<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">50</span>
sheet<span class="token punctuation">.</span>column_dimensions<span class="token punctuation">[</span><span class="token string">"A"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">20</span>
<span class="token comment"># 设置单元格字体</span>
cell <span class="token operator">=</span> sheet<span class="token punctuation">[</span><span class="token string">"A1"</span><span class="token punctuation">]</span>
current_font <span class="token operator">=</span> cell<span class="token punctuation">.</span>font
font <span class="token operator">=</span> Font<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"微软雅黑"</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> bold<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> italic<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"000000"</span><span class="token punctuation">)</span>
cell<span class="token punctuation">.</span>font <span class="token operator">=</span> font
<span class="token comment"># 设置边框(细边，黑色)</span>
side_style <span class="token operator">=</span> Side<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">"thin"</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"000000"</span><span class="token punctuation">)</span>
border <span class="token operator">=</span> Border<span class="token punctuation">(</span>left<span class="token operator">=</span>side_style<span class="token punctuation">,</span> right<span class="token operator">=</span>side_style<span class="token punctuation">,</span> top<span class="token operator">=</span>side_style<span class="token punctuation">,</span> bottom<span class="token operator">=</span>side_style<span class="token punctuation">)</span>
cell<span class="token punctuation">.</span>border <span class="token operator">=</span> border
<span class="token comment"># 居中对齐，自动换行</span>
cell_alignment <span class="token operator">=</span> Alignment<span class="token punctuation">(</span>horizontal<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">,</span> vertical<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">,</span> wrap_text<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
cell<span class="token punctuation">.</span>alignment <span class="token operator">=</span> cell_alignment
<span class="token comment"># 填充颜色（红色填充，和红色到黑色渐变填充）</span>
p_fill <span class="token operator">=</span> PatternFill<span class="token punctuation">(</span>fill_type<span class="token operator">=</span><span class="token string">"solid"</span><span class="token punctuation">,</span> fgColor<span class="token operator">=</span><span class="token string">"FF0000"</span><span class="token punctuation">)</span>
g_fill <span class="token operator">=</span> GradientFill<span class="token punctuation">(</span>stop<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"FF0000"</span><span class="token punctuation">,</span> <span class="token string">"FD1111"</span><span class="token punctuation">,</span> <span class="token string">"000000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cell<span class="token punctuation">.</span>fill <span class="token operator">=</span> p_fill
sheet<span class="token punctuation">[</span><span class="token string">"B1"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fill <span class="token operator">=</span> g_fill
</code></pre> 
<p>最后注意的是，这些修改操作最后都需要通过保存操作（<code>wb.save(file_path)</code>）才能生效。</p> 
<h3><a id="6__277"></a>6 总结</h3> 
<p>通过上面的讲解，了解如何使用 python 的 openpyxl 库对 excel 文档的处理操作，可以发现它的操作逻辑相当是清晰简单的，符合的我们使用 excel 的习惯。处理流程基本是加载文件、定位需要处理的工作表、行、列及单元格。对它们进行读、写、修改格式等操作。因此，如果有自动化处理 excel 文件的需求，用 openpyxl 吧，但它限制只能处理 2010 格式的 excel 文档，对于旧格式（ xls ）的建议都统一换为新的格式再操作，或者也可以使用 xlrd 和 xlwt 模块操作。</p> 
<h3><a id="_283"></a>参考资料</h3> 
<ul><li><a href="https://openpyxl.readthedocs.io/" rel="nofollow">openpyxl官方文档</a>: <code>https://openpyxl.readthedocs.io/</code></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzAxMjMwODMyMQ==&amp;mid=2456344302&amp;idx=2&amp;sn=75ab19a0094163736e707c4575e95814&amp;utm_source=tuicool&amp;utm_medium=referral" rel="nofollow">Python自动化办公系列之Python操作Excel</a></li></ul> 
<h3><a id="_290"></a>往期文章</h3> 
<ul><li><a href="https://mp.weixin.qq.com/s/neO8OuWu7Za41xcdmwu2wA" rel="nofollow">python基本操作-文件、目录及路径</a></li><li><a href="https://mp.weixin.qq.com/s/LX-4jhVV7FbB-TA8jcWYOA" rel="nofollow">MinIO 的分布式部署</a></li><li><a href="https://mp.weixin.qq.com/s/rzaqPmpTOUJJsKISr6eF9Q" rel="nofollow">利用MinIO轻松搭建静态资源服务</a></li><li><a href="https://mp.weixin.qq.com/s/ZzzPJZAhPiGCQjN3RNZJ3Q" rel="nofollow">搞定SpringBoot多数据源(3)：参数化变更源</a></li><li><a href="https://mp.weixin.qq.com/s/neIN3htjkn4bifPpdq5l7w" rel="nofollow">搞定SpringBoot多数据源(2)：动态数据源</a></li><li><a href="https://mp.weixin.qq.com/s/0J-FLYScYtEMnj0vZToX7g" rel="nofollow">搞定SpringBoot多数据源(1)：多套源策略</a></li><li><a href="https://mp.weixin.qq.com/s/a3x_pKUryb_at_4Xk48IiQ" rel="nofollow">java开发必学知识:动态代理</a></li><li><a href="https://mp.weixin.qq.com/s/Wlbjhohb_HrqT67lstwVwA" rel="nofollow">2019 读过的好书推荐</a></li></ul> 
<p>我的公众号（搜索<code>Mason技术记录</code>），获取更多技术记录：</p> 
<p><img src="https://images2.imgbox.com/fe/cd/7hYfm29Y_o.png" alt="mason"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dd17068f1893de8ee9b8a9f42cea19ee/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CMMI 2.0 和 1.3</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1f8cbe7cc6f495ac4bbbcdde96296859/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux云计算架构-文件权限、所有者、所属组详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>