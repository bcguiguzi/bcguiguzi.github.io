<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu&#43;Apache2配置腾讯云ssl证书实现https - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu&#43;Apache2配置腾讯云ssl证书实现https" />
<meta property="og:description" content="Ubuntu&#43;Apache2配置腾讯云ssl证书实现https 前言 本文所用的服务器环境是 Ubuntu18.04 &#43; Apache2 .通过部署 ssl 来达到默认使用https方式访问网站的目的。
超文本传输安全协议（英语：Hypertext Transfer Protocol Secure，缩写：HTTPS，常称为HTTP over TLS，HTTP over SSL或HTTP Secure）是一种透过计算机网络进行安全通信的传输协议。HTTPS经由HTTP进行通信，但利用SSL/TLS来加密数据包。HTTPS开发的主要目的，是提供对网站服务器的身份认证，保护交换数据的隐私与完整性。这个协议由网景公司（Netscape）在1994年首次提出，随后扩展到互联网上。
历史上，HTTPS连接经常用于万维网上的交易支付和企业信息系统中敏感信息的传输。在2000年代晚期和2010年代早期，HTTPS开始广泛使用于保护所有类型网站上的网页真实性，保护账户和保持用户通信，身份和网络浏览的私密性。
— 来自《维基百科》
其实可以解决很大部分的运营商劫持问题，比如别人打开你的网站，网页上面会出现一些广告之类的，所以需要配置 https 来防止这个问题。
正文 Ubuntu 下 LAMP 环境的搭建，就不细说了，主要讲一下如何配置证书。
申请证书 打开腾讯云https://buy.cloud.tencent.com/ssl来获得腾讯云提供的免费证书：
点击域名型免费版，然后进去填一下网址和邮箱即可申请到。
过了几分钟，就会受到一个邮件，是一个压缩包，里面有各种服务器的 ssl 证书文件，我们进入 Apache2 这个目录，然后发现里面有三个文件：
1_root_bundle.crt # 证书文件 2_xxx.xxx.xxx.crt # 证书文件 3_xxx.xxx.xxx.key # 私钥文件 1_root_bundle.crt包含一段代码-----BEGIN CERTIFICATE-----和-----END CERTIFICATE-----2_xxx.xxx.xxx.crt文件包括一段证书代码-----BEGIN CERTIFICATE-----和-----END CERTIFICATE-----3_xxx.xxx.xxx.key文件包括一段私钥代码-----BEGIN RSA PRIVATE KEY-----和-----END RSA PRIVATE KEY----- 这是这几个文件的作用。
配置证书 在这里，我假设你已经会配置基本的/etc/apache2/sites-available/000-default.conf这个文件来达到已经可以通过 http 的方式来访问你的站点。
在/etc/apache2这个目录下，有两个有关的目录sites-available和sites-enabled，我们进入sites-enabled目录下可以发现，里面有一个文件000-default.conf
lrwxrwxrwx 1 root root 35 Dec 28 15:24 000-default." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/ca597c5e17f8fa87b9db830bdae82c37/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-12-28T19:23:21+08:00" />
<meta property="article:modified_time" content="2018-12-28T19:23:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu&#43;Apache2配置腾讯云ssl证书实现https</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="UbuntuApache2sslhttps_0"></a>Ubuntu+Apache2配置腾讯云ssl证书实现https</h2> 
<h3><a id="_2"></a>前言</h3> 
<p>本文所用的服务器环境是 Ubuntu18.04 + Apache2 .通过部署 ssl 来达到默认使用https方式访问网站的目的。</p> 
<blockquote> 
 <p><strong>超文本传输安全协议</strong>（英语：<strong>Hypertext Transfer Protocol Secure</strong>，<a href="https://zh.wikipedia.org/wiki/%E7%B8%AE%E5%AF%AB" rel="nofollow">缩写</a>：<strong>HTTPS</strong>，常称为<strong>HTTP over TLS</strong>，<strong>HTTP over SSL</strong>或<strong>HTTP Secure</strong>）是一种透过<a href="https://zh.wikipedia.org/wiki/%E8%A8%88%E7%AE%97%E6%A9%9F%E7%B6%B2%E7%B5%A1" rel="nofollow">计算机网络</a>进行安全通信的<a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E5%82%B3%E8%BC%B8%E5%8D%94%E5%AE%9A" rel="nofollow">传输协议</a>。HTTPS经由<a href="https://zh.wikipedia.org/wiki/HTTP" rel="nofollow">HTTP</a>进行通信，但利用<a href="https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E5%B1%82%E5%AE%89%E5%85%A8" rel="nofollow">SSL/TLS</a>来加密数据包。HTTPS开发的主要目的，是提供对<a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E7%AB%99" rel="nofollow">网站</a>服务器的<a href="https://zh.wikipedia.org/wiki/%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81" rel="nofollow">身份认证</a>，保护交换数据的隐私与<a href="https://zh.wikipedia.org/wiki/%E5%AE%8C%E6%95%B4%E6%80%A7" rel="nofollow">完整性</a>。这个协议由<a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E6%99%AF" rel="nofollow">网景</a>公司（Netscape）在1994年首次提出，随后扩展到<a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E9%9A%9B%E7%B6%B2%E8%B7%AF" rel="nofollow">互联网</a>上。</p> 
 <p>历史上，HTTPS连接经常用于<a href="https://zh.wikipedia.org/wiki/%E4%B8%87%E7%BB%B4%E7%BD%91" rel="nofollow">万维网</a>上的交易支付和企业信息系统中敏感信息的传输。在2000年代晚期和2010年代早期，HTTPS开始广泛使用于保护所有类型网站上的网页真实性，保护账户和保持用户通信，身份和网络浏览的私密性。</p> 
 <p>— 来自《维基百科》</p> 
</blockquote> 
<p>其实可以解决很大部分的运营商劫持问题，比如别人打开你的网站，网页上面会出现一些广告之类的，所以需要配置 https 来防止这个问题。</p> 
<h3><a id="_14"></a>正文</h3> 
<p>Ubuntu 下 LAMP 环境的搭建，就不细说了，主要讲一下如何配置证书。</p> 
<h4><a id="_18"></a>申请证书</h4> 
<p>打开腾讯云<a href="https://buy.cloud.tencent.com/ssl" rel="nofollow">https://buy.cloud.tencent.com/ssl</a>来获得腾讯云提供的免费证书：</p> 
<p><img src="https://images2.imgbox.com/95/1b/FXzI2N3d_o.png" alt=""></p> 
<p>点击<code>域名型免费版</code>，然后进去填一下网址和邮箱即可申请到。</p> 
<p>过了几分钟，就会受到一个邮件，是一个压缩包，里面有各种服务器的 ssl 证书文件，我们进入 Apache2 这个目录，然后发现里面有三个文件：</p> 
<pre><code class="prism language-shell">1_root_bundle.crt    <span class="token comment"># 证书文件</span>
2_xxx.xxx.xxx.crt <span class="token comment"># 证书文件</span>
3_xxx.xxx.xxx.key <span class="token comment"># 私钥文件</span>
</code></pre> 
<ul><li><code>1_root_bundle.crt</code>包含一段代码<code>-----BEGIN CERTIFICATE-----</code>和<code>-----END CERTIFICATE-----</code></li><li><code>2_xxx.xxx.xxx.crt</code>文件包括一段证书代码<code>-----BEGIN CERTIFICATE-----</code>和<code>-----END CERTIFICATE-----</code></li><li><code>3_xxx.xxx.xxx.key</code>文件包括一段私钥代码<code>-----BEGIN RSA PRIVATE KEY-----</code>和<code>-----END RSA PRIVATE KEY-----</code></li></ul> 
<p>这是这几个文件的作用。</p> 
<h4><a id="_40"></a>配置证书</h4> 
<p>在这里，我假设你已经会配置基本的<code>/etc/apache2/sites-available/000-default.conf</code>这个文件来达到已经可以通过 http 的方式来访问你的站点。</p> 
<p>在<code>/etc/apache2</code>这个目录下，有两个有关的目录<code>sites-available</code>和<code>sites-enabled</code>，我们进入<code>sites-enabled</code>目录下可以发现，里面有一个文件<code>000-default.conf</code></p> 
<pre><code class="prism language-shell">lrwxrwxrwx 1 root root 35 Dec 28 15:24 000-default.conf -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/sites-available/000-default.conf
</code></pre> 
<p>实质上这个文件是<code>/etc/apache2/sites-available/000-default.conf</code>这个文件的软链接。</p> 
<p>我们要配置另 ssl 证书，要依靠另一个文件，也就是<code>default-ssl.conf</code>，首先我们需要设置一个软链接，把这个文件链接到<code>sites-enabled</code>这个文件夹中:</p> 
<pre><code class="prism language-shell"><span class="token function">ln</span> -s /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-enabled/000-default-ssl.conf
</code></pre> 
<p>然后去修改这个文件<code>000-default-ssl.conf</code>，因为已经做了软链接，其实这时候修改<code>000-default-ssl.conf</code>或<code>default-ssl.conf</code>都一样。</p> 
<p>这个文件没有做任何修改前长这样子（去除自带的注释之后）：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfModule</span> <span class="token attr-name">mod_ssl.c</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>VirtualHost</span> <span class="token attr-name"><span class="token namespace">_default_:</span>443</span><span class="token punctuation">&gt;</span></span>
		ServerAdmin webmaster@localhost

		DocumentRoot /var/www/html

		ErrorLog ${APACHE_LOG_DIR}/error.log
		CustomLog ${APACHE_LOG_DIR}/access.log combined

		SSLEngine on

		SSLCertificateFile	/etc/ssl/certs/ssl-cert-snakeoil.pem
		SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
	
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FilesMatch</span> <span class="token attr-name">"\.(cgi|shtml|phtml|php)$"</span><span class="token punctuation">&gt;</span></span>
				SSLOptions +StdEnvVars
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FilesMatch</span><span class="token punctuation">&gt;</span></span>
		&lt;Directory /usr/lib/cgi-bin&gt;
				SSLOptions +StdEnvVars
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Directory</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>VirtualHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>IfModule</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>然后把从腾讯云上面下载好的证书(3个文件)传到你自定义的目录中</p> 
<p>然后我们需要修改一下，修改成这样:</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IfModule</span> <span class="token attr-name">mod_ssl.c</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>VirtualHost</span> <span class="token attr-name"><span class="token namespace">_default_:</span>443</span><span class="token punctuation">&gt;</span></span>
		ServerAdmin 你的邮箱
        
		DocumentRoot /var/www/你的目录
	    ServerName 你的域名

		ErrorLog ${APACHE_LOG_DIR}/error.log
		CustomLog ${APACHE_LOG_DIR}/access.log combined

		SSLEngine on
		# 注意，需要添加这三行
		SSLCertificateFile 你自定义的路径/2_xxx.xxx.xxx.crt
    	SSLCertificateKeyFile 你自定义的路径/3_xxx.xxx.xxx.key
    	SSLCertificateChainFile 你自定义的路径/1_root_bundle.crt
	
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FilesMatch</span> <span class="token attr-name">"\.(cgi|shtml|phtml|php)$"</span><span class="token punctuation">&gt;</span></span>
				SSLOptions +StdEnvVars
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FilesMatch</span><span class="token punctuation">&gt;</span></span>
		&lt;Directory /usr/lib/cgi-bin&gt;
				SSLOptions +StdEnvVars
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Directory</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>VirtualHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>IfModule</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>重要的三个参数的作用如下表：</p> 
<table><thead><tr><th>配置文件参数</th><th>说明</th></tr></thead><tbody><tr><td>SSLEngine on</td><td>启用 SSL 功能</td></tr><tr><td>SSLCertificateFile</td><td>证书文件</td></tr><tr><td>SSLCertificateKeyFile</td><td>私钥文件</td></tr><tr><td>SSLCertificateChainFile</td><td>证书链文件</td></tr></tbody></table> 
<p>改好之后保存。</p> 
<p>然后这时，我们加载一下 Apache2 的 SSL 模块：</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> a2enmod ssl   <span class="token comment">#加载模块</span>
<span class="token function">sudo</span> <span class="token function">service</span> apache2 restart <span class="token comment"># 重启服务</span>
</code></pre> 
<p>这时，在浏览器输入<code>https://你的域名</code>应该已经可以通过 https 的方式来访问网站了，这时浏览器那里应该也已经有了一个绿色的小锁。</p> 
<p><strong>但是</strong>，<strong>但是</strong>…这还不够，因为我们如果不主动输入<code>https://</code>的话，直接输入域名，还是会直接跳转到 80 端口的普通的 http 方式访问，所以我们需要强制使用 https 来访问</p> 
<h4><a id="https_141"></a>强制使用https</h4> 
<p>我们只需要打开<code>/etc/apache2/sites-available/000-default.conf</code>这个文件，在你的<code>&lt;VirtualHost*:80&gt;&lt;/VirtualHost&gt;</code>这个标签内随便一个地方加上三行：</p> 
<pre><code>RewriteEngine on
RewriteCond   %{HTTPS} !=on
RewriteRule   ^(.*)  https://%{SERVER_NAME}$1 [L,R]
</code></pre> 
<p>然后保存,然后启动 Apache2 的重定向：</p> 
<pre><code class="prism language-shell"> <span class="token function">sudo</span> a2enmod rewrite
</code></pre> 
<p>然后再重启 Apache2，至此大功告成：</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">service</span> apache2 restart
</code></pre> 
<p>然后，打开浏览器直接输入域名，就会自动跳转到 https 的方式。</p> 
<h4><a id="_165"></a>参考链接：</h4> 
<ul><li><a href="https://cloud.tencent.com/document/product/400/4143" rel="nofollow">证书安装指引</a></li><li><a href="https://blog.csdn.net/qq_36652619/article/details/78310779">腾讯云 Ubuntu+Apache2配置https和重定向</a></li><li><a href="http://bbs.qcloud.com/thread-22552-1-1.html" rel="nofollow">ubuntu下apache2.4怎么配置SSL证书</a></li><li><a href="https://www.luochenzhimu.com/archives/448.html" rel="nofollow">Ubuntu下Apache2配置https且强制http转为https</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6677da548ebf8c67e0d1313a5ee08eb8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">POST 下载文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c30261f0afdaa45758a57d8142ba7d86/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">YUV格式初探（一）---NV12格式转RGB24的两种方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>