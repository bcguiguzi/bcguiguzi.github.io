<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>系统编程之进程间的 信号量 通信（4） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="系统编程之进程间的 信号量 通信（4）" />
<meta property="og:description" content="系列文章目录 第一章 系统编程之多进程
第二章 系统编程之进程间的 管道 通信（1）
第二章 系统编程之进程间的 信号 通信（2）
第二章 系统编程之进程间的 共享内存 通信（3）
第二章 系统编程之进程间的 信号量 通信（4）
第二章 系统编程之进程间的 消息队列 通信（5）
目录
系列文章目录
前言
一、信号量
1 信号量的工作原理
2 信号量相关命令
​编辑
3 相关的接口函数
3.1 申请信号量(信号灯)
3.2 操作信号量(重点，重点，重点) 3.3 设置信号量的值，获取值，删除信号量 4 信号量的特点 总结
前言 这篇文章将讲述另一种进程间通信的机制——信号量。注意请不要把它与之前所说的信号混淆起来，信号与信号量是不同的两种事物。
一、信号量 信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。
作用：协调多个进程在通信的时候，对于共享资源(临界区资源)的访问。
1 信号量的工作原理 由于信号量只能进行两种操作等待和发送信号，即P(sv)和V(sv),他们的行为是这样的：
P(sv)：如果sv的值大于零，就给它减1；如果它的值为零，就挂起该进程的执行
V(sv)：如果有其他进程因等待sv而被挂起，就让它恢复运行，如果没有进程因等待sv而挂起，就给它加1.
举个例子，就是两个进程共享信号量sv，一旦其中一个进程执行了P(sv)操作，它将得到信号量，并可以进入临界区，使sv减1。而第二个进程将被阻止进入临界区，因为当它试图执行P(sv)时，sv为0，它会被挂起以等待第一个进程离开临界区域并执行V(sv)释放信号量，这时第二个进程就可以恢复执行。
2 信号量相关命令 ipcs -s // 查看信号量 ipcrm -s 信号量的ID // 删除信号量 3 相关的接口函数 3.1 申请信号量(信号灯) #include &lt;sys/sem." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/8af35890769c27fcc7588e1fafd61a42/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-04T19:08:21+08:00" />
<meta property="article:modified_time" content="2023-02-04T19:08:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">系统编程之进程间的 信号量 通信（4）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95"><a id="_0"></a>系列文章目录</h2> 
<p><a class="link-info" href="http://t.csdn.cn/9kdVW" rel="nofollow" title="第一章 系统编程之多进程">第一章 系统编程之多进程</a></p> 
<p><a class="link-info" href="http://t.csdn.cn/uWGxQ" rel="nofollow" title="第二章 系统编程之进程间的 管道 通信（1）">第二章 系统编程之进程间的 管道 通信（1）</a></p> 
<p><a class="link-info" href="http://t.csdn.cn/td8jD" rel="nofollow" title="第二章 系统编程之进程间的 信号 通信（2）">第二章 系统编程之进程间的 信号 通信（2）</a></p> 
<p><a class="link-info" href="http://t.csdn.cn/rwu36" rel="nofollow" title="第二章 系统编程之进程间的 共享内存 通信（3）">第二章 系统编程之进程间的 共享内存 通信（3）</a></p> 
<p><a class="link-info" href="http://t.csdn.cn/8mQ60" rel="nofollow" title="第二章 系统编程之进程间的 信号量 通信（4）">第二章 系统编程之进程间的 信号量 通信（4）</a></p> 
<p style="margin-left:.0001pt;text-align:justify;"><a class="link-info" href="http://t.csdn.cn/ZYUyc" rel="nofollow" title="第二章 系统编程之进程间的 消息队列 通信（5）">第二章 系统编程之进程间的 消息队列 通信（5）</a></p> 
<div> 
 <p id="main-toc"><strong>目录</strong></p> 
 <p id="%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95-toc" style="margin-left:0px;"><a href="#%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95" rel="nofollow">系列文章目录</a></p> 
 <p id="-toc" style="margin-left:0px;"></p> 
 <p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
 <p id="%E4%B8%80%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F" rel="nofollow">一、信号量</a></p> 
 <p id="1%20%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-toc" style="margin-left:40px;"><a href="#1%20%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" rel="nofollow">1 信号量的工作原理</a></p> 
 <p id="2%20%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4-toc" style="margin-left:40px;"><a href="#2%20%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4" rel="nofollow">2 信号量相关命令</a></p> 
 <p id="%E2%80%8B%E7%BC%96%E8%BE%91-toc" style="margin-left:40px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91" rel="nofollow">​编辑</a></p> 
 <p id="3%C2%A0%E7%9B%B8%E5%85%B3%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%87%BD%E6%95%B0-toc" style="margin-left:40px;"><a href="#3%C2%A0%E7%9B%B8%E5%85%B3%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%87%BD%E6%95%B0" rel="nofollow">3 相关的接口函数</a></p> 
 <p id="3.1%C2%A0%E7%94%B3%E8%AF%B7%E4%BF%A1%E5%8F%B7%E9%87%8F(%E4%BF%A1%E5%8F%B7%E7%81%AF)-toc" style="margin-left:80px;"><a href="#3.1%C2%A0%E7%94%B3%E8%AF%B7%E4%BF%A1%E5%8F%B7%E9%87%8F%28%E4%BF%A1%E5%8F%B7%E7%81%AF%29" rel="nofollow">3.1 申请信号量(信号灯)</a></p> 
 <p id="3.2%20%E6%93%8D%E4%BD%9C%E4%BF%A1%E5%8F%B7%E9%87%8F(%E9%87%8D%E7%82%B9%EF%BC%8C%E9%87%8D%E7%82%B9%EF%BC%8C%E9%87%8D%E7%82%B9)%C2%A0-toc" style="margin-left:80px;"><a href="#3.2%20%E6%93%8D%E4%BD%9C%E4%BF%A1%E5%8F%B7%E9%87%8F%28%E9%87%8D%E7%82%B9%EF%BC%8C%E9%87%8D%E7%82%B9%EF%BC%8C%E9%87%8D%E7%82%B9%29%C2%A0" rel="nofollow">3.2 操作信号量(重点，重点，重点) </a></p> 
 <p id="3.3%20%E8%AE%BE%E7%BD%AE%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E5%80%BC%EF%BC%8C%E8%8E%B7%E5%8F%96%E5%80%BC%EF%BC%8C%E5%88%A0%E9%99%A4%E4%BF%A1%E5%8F%B7%E9%87%8F%C2%A0-toc" style="margin-left:80px;"><a href="#3.3%20%E8%AE%BE%E7%BD%AE%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E5%80%BC%EF%BC%8C%E8%8E%B7%E5%8F%96%E5%80%BC%EF%BC%8C%E5%88%A0%E9%99%A4%E4%BF%A1%E5%8F%B7%E9%87%8F%C2%A0" rel="nofollow">3.3 设置信号量的值，获取值，删除信号量 </a></p> 
 <p id="4%C2%A0%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E7%89%B9%E7%82%B9%C2%A0-toc" style="margin-left:40px;"><a href="#4%C2%A0%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E7%89%B9%E7%82%B9%C2%A0" rel="nofollow">4 信号量的特点 </a></p> 
 <p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">总结</a></p> 
</div> 
<p></p> 
<h2><a id="_12"></a></h2> 
<h2 id="%E5%89%8D%E8%A8%80">前言</h2> 
<p>        这篇文章将讲述另一种进程间通信的机制——信号量。注意请不要把它与之前所说的信号混淆起来，信号与信号量是不同的两种事物。</p> 
<h2 id="%E4%B8%80%E3%80%81%E4%BF%A1%E5%8F%B7%E9%87%8F"><a id="pandas_22"></a>一、信号量</h2> 
<p>        信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。</p> 
<p><span style="color:#fe2c24;">作用：</span>协调多个进程在通信的时候，对于共享资源(临界区资源)的访问。</p> 
<h3 id="1%20%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">1 信号量的工作原理</h3> 
<p>        由于信号量只能进行两种操作等待和发送信号，即P(sv)和V(sv),他们的行为是这样的：</p> 
<p><strong>P(sv)：</strong>如果sv的值大于零，就给它减1；如果它的值为零，就挂起该进程的执行</p> 
<p><strong>V(sv)：</strong>如果有其他进程因等待sv而被挂起，就让它恢复运行，如果没有进程因等待sv而挂起，就给它加1.</p> 
<p>举个例子，就是两个进程共享信号量sv，一旦其中一个进程执行了P(sv)操作，它将得到信号量，并可以进入临界区，使sv减1。而第二个进程将被阻止进入临界区，因为当它试图执行P(sv)时，sv为0，它会被挂起以等待第一个进程离开临界区域并执行V(sv)释放信号量，这时第二个进程就可以恢复执行。</p> 
<h3 id="2%20%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4">2 信号量相关命令</h3> 
<blockquote> 
 <p>ipcs  -s                           // 查看信号量    </p> 
 <p>ipcrm  -s   信号量的ID    // 删除信号量  </p> 
</blockquote> 
<h3 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="308" src="https://images2.imgbox.com/24/0a/2pgSw3yu_o.png" width="741"></h3> 
<h3 id="3%C2%A0%E7%9B%B8%E5%85%B3%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%87%BD%E6%95%B0">3 相关的接口函数</h3> 
<h4 id="3.1%C2%A0%E7%94%B3%E8%AF%B7%E4%BF%A1%E5%8F%B7%E9%87%8F(%E4%BF%A1%E5%8F%B7%E7%81%AF)">3.1 申请信号量(信号灯)</h4> 
<blockquote> 
 <p>#include &lt;sys/sem.h&gt;                </p> 
 <p>int semget(key_t key, int nsems, int semflg)                              </p> 
 <p>参数1：key（唯一非零）：不相关的进程可以通过它访问一个信号量</p> 
 <p>参数2：nsems：你打算申请多少个信号量</p> 
 <p>参数3：sem_flags：代表一组标志，当想要当信号量不存在时创建一个新的信号量，可以和值IPC_CREAT做按位或操作</p> 
 <p>返回值：成功返回一个相应信号标识符（非零）</p> 
 <p>               失败返回-1</p> 
 <p></p> 
 <p>semget(key, 2,IPC_CREAT|IPC_EXCL|0777);</p> 
</blockquote> 
<h4 id="3.2%20%E6%93%8D%E4%BD%9C%E4%BF%A1%E5%8F%B7%E9%87%8F(%E9%87%8D%E7%82%B9%EF%BC%8C%E9%87%8D%E7%82%B9%EF%BC%8C%E9%87%8D%E7%82%B9)%C2%A0">3.2 操作信号量</h4> 
<blockquote> 
 <p>PV操作：                      </p> 
 <p>        p操作：对信号量的值做减法运算                      </p> 
 <p>        v操作：对信号量的值做加法运算                </p> 
 <p>tips:  可以把semop函数做二次封装                              </p> 
 <p>int  p操作(int 减少多少，int 哪个信号量)                              </p> 
 <p>{                                      </p> 
 <p>        semop(int semid, struct sembuf *sops, size_t nsops);                              </p> 
 <p>}                              </p> 
 <p>int  v操作(int 减少多少，int 哪个信号量)                              </p> 
 <p>{                                    </p> 
 <p>        semop(int semid, struct sembuf *sops, size_t nsops);                              </p> 
 <p>}                </p> 
 <p>int semop(int semid, struct sembuf *sops, size_t nsops);                          </p> 
 <p>返回值：成功0  失败-1                              </p> 
 <p>参数1：sops ：结构体指针                                      </p> 
 <p>         struct sembuf                                      </p> 
 <p>        {                                            </p> 
 <p>             unsigned short sem_num;   //信号量的序号,序号从0开始</p> 
 <p>             short          sem_op;             //你想对信号量进行p操作还是v操作</p> 
 <p>             short          sem_flg;             //SEM_UNDO，pv操作改变信号量的值，下次重新运                                                                行，信号量恢复成原始值                                      </p> 
 <p>        }                                      </p> 
 <p>参数2：nsops：struct sembuf的个数，一般设置为1</p> 
</blockquote> 
<h4 id="3.3%20%E8%AE%BE%E7%BD%AE%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E5%80%BC%EF%BC%8C%E8%8E%B7%E5%8F%96%E5%80%BC%EF%BC%8C%E5%88%A0%E9%99%A4%E4%BF%A1%E5%8F%B7%E9%87%8F%C2%A0">3.3 设置信号量的值，获取值，删除信号量 </h4> 
<blockquote> 
 <p>int semctl(int semid, int semnum, int cmd, ...);                          </p> 
 <p>参数：semnum：信号量的序号                                    </p> 
 <p>           cmd：IPC_RMID //删除信号量</p> 
 <p>                      GETVAL   //我想获取信号量的值</p> 
 <p>                      SETVAL   //我想设置信号量的值  </p> 
 <p>                            </p> 
 <p>semctl(semid, 0,  IPC_RMID );   //我要删除第一个信号量                                                        </p> 
 <p>semctl(semid, 1,  IPC_RMID );   //我要删除第二个信号量                                                         int value=semctl(semid, 0,  GETVAL); //我要获取第一个信号量的值，返回值就是信号量的值 semctl(semid, 0, SETVAL,1);  //我要把第一个信号量的值设置为1</p> 
</blockquote> 
<h3 id="4%C2%A0%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E7%89%B9%E7%82%B9%C2%A0">4 信号量的特点 </h3> 
<ul><li>信号量的值不能是负数，信号量值为0，你还要进行p操作，会阻塞当前进程，v操作做加法，不会阻塞进程。               </li><li>信号量表示进程拥有的资源的数量，比如：值是5，进程拥有5个资源  p操作剥夺我的资源  v操作增加资源。</li></ul> 
<p></p> 
<h2 id="%E6%80%BB%E7%BB%93"><a id="_55"></a>总结</h2> 
<p>以上就是本文要讲的内容，本文仅仅简单介绍了信号量的原理和使用方法。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f47d77b5e2cd7027ea0b6fc59f1c4a38/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">系统编程之多进程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/817029bbbacf5c06568d71b5f5223bed/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python将文本信息拷贝到剪切板(解决selenium send_keys输入文本很慢,会卡住的情况)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>