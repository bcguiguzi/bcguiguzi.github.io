<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ajax解析properties,AJAX result.d实例解释 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ajax解析properties,AJAX result.d实例解释" />
<meta property="og:description" content="When working directly with JSON serialized ASMX services, be it
via jQuery, pure XmlHttpRequest calls, or anything else other
than the ScriptManager, one question inevitably arises. That
question is of the inexplicable .d attribute that
appeared in ASP.NET 3.5.
What is it? Why is it there?
In this post, I’ll use both a 2.0 and a 3.5 example ASMX web
service to illustrate exactly what’s going on.
I’ll also show you why it’s a good change." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/2e852a28d0eefdcc756f31a31819ce0b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-05T12:26:42+08:00" />
<meta property="article:modified_time" content="2021-08-05T12:26:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ajax解析properties,AJAX result.d实例解释</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>When working directly with JSON serialized ASMX services, be it</p> 
 <p>via jQuery, pure XmlHttpRequest calls, or anything else other</p> 
 <p>than the ScriptManager, one question inevitably arises. That</p> 
 <p>question is of the inexplicable .d attribute that</p> 
 <p>appeared in ASP.NET 3.5.</p> 
 <p>What is it? Why is it there?</p> 
 <p>In this post, I’ll use both a 2.0 and a 3.5 example ASMX web</p> 
 <p>service to illustrate exactly what’s going on.</p> 
 <p>I’ll also show you why it’s a good change.</p> 
 <p>An example</p> 
 <p>Following a concrete example always helps to better clarify</p> 
 <p>these things. For that purpose, let’s assume that we want to call a</p> 
 <p>web service and retrieve an instance of the following</p> 
 <p>Person class:</p> 
 <p>public class Person</p> 
 <p>{<!-- --></p> 
 <p>public string FirstName;</p> 
 <p>public string LastName;</p> 
 <p>}</p> 
 <p>The ASMX web service to return an instance of that class could</p> 
 <p>be simple as this:</p> 
 <p>[ScriptService]</p> 
 <p>public class PersonService : WebService</p> 
 <p>{<!-- --></p> 
 <p>[WebMethod]</p> 
 <p>public Person GetPerson()</p> 
 <p>{<!-- --></p> 
 <p>Person p = new Person();</p> 
 <p>p.FirstName = "Dave";</p> 
 <p>p.LastName = "Ward";</p> 
 <p>return p;</p> 
 <p>}</p> 
 <p>}</p> 
 <p>Because our WebService class is decorated with the</p> 
 <p>[ScriptService] attribute, the ASP.NET AJAX Extensions</p> 
 <p>(System.Web.Extensions) will automatically serialize the return value as JSON if properly</p> 
 <p>requested.</p> 
 <p>Note: A common anti-pattern that I’ve seen in</p> 
 <p>practice is using a return type of string and returning a manually</p> 
 <p>JSON serialized object. Don’t. It’s unnecessary and results in</p> 
 <p>doubled effort on both the server and in the browser.</p> 
 <p>Let the framework handle this task unless you have a good reason</p> 
 <p>not to use the built-in functionality. It works just fine in most</p> 
 <p>scenarios.</p> 
 <p>Calling the service and inspecting its result</p> 
 <p>Using jQuery to consume an ASMX web service is simple, but does</p> 
 <p>require jumping through a few hoops. We can use this jQuery to consume</p> 
 <p>the Person service we just created:</p> 
 <p>$.ajax({<!-- --></p> 
 <p>type: "POST",</p> 
 <p>contentType: "application/json; charset=utf-8",</p> 
 <p>url: "PersonService.asmx/GetPerson",</p> 
 <p>data: "{}",</p> 
 <p>dataType: "json",</p> 
 <p>success: function(msg) {<!-- --></p> 
 <p>// Do interesting things here.</p> 
 <p>}</p> 
 <p>});</p> 
 <p>Making that call against an ASP.NET 2.0 site with the ASP.NET</p> 
 <p>AJAX Extensions 1.0 installed, this JSON object would be the return</p> 
 <p>value:</p> 
 <p align="center"><img src="https://images2.imgbox.com/f4/e7/ubwGdwix_o.png" alt="a4c26d1e5885305701be709a3d33442f.png"></p> 
 <p>I find that it often helps to visualize the JSON in a more human</p> 
 <p>readable format. This is the same JSON object as seen in the</p> 
 <p>Firebug screenshot above:</p> 
 <p>{"__type" : "Person",</p> 
 <p>"FirstName" : "Dave",</p> 
 <p>"LastName" : "Ward"}</p> 
 <p>Within the success callback shown above, you</p> 
 <p>may access properties of the Person exactly as you would expect.</p> 
 <p>For example, msg.FirstName will evaluate to</p> 
 <p>“Dave”.</p> 
 <p>Waiter, there’s a .d in my msg soup!</p> 
 <p>Eventually, you’ll finally convince management to let</p> 
 <p>you upgrade the site to ASP.NET 3.5. After all, you can use an</p> 
 <p>object initializer to cut the size of the web service in half!</p> 
 <p>However, your msg.FirstName statement now results in the</p> 
 <p>dreaded undefined.</p> 
 <p>What happened? Let’s inspect the ASP.NET 3.5 response in</p> 
 <p>Firebug:</p> 
 <p align="center"><img src="https://images2.imgbox.com/80/fe/Tl2QmW1u_o.png" alt="a4c26d1e5885305701be709a3d33442f.png"></p> 
 <p>The entire Person object is wrapped within a new</p> 
 <p>“d” object now. Alternatively we might visualize</p> 
 <p>it this way:</p> 
 <p>{"d":{"__type" : "Person",</p> 
 <p>"FirstName" : "Dave",</p> 
 <p>"LastName" : "Ward"}}</p> 
 <p>As you’ve probably figured out by now, the solution is to</p> 
 <p>reference the property as msg.d.FirstName now. In</p> 
 <p>our example, this will again resolve correctly as “Dave”.</p> 
 <p>This is the case with all ASMX services JSON</p> 
 <p>serialized through the ASP.NET AJAX Extensions in ASP.NET 3.5. Even</p> 
 <p>if you’re only returning a scalar return value, such as a string,</p> 
 <p>int, or boolean, the result will always be enclosed within the</p> 
 <p>“d”.</p> 
 <p>Why did it change?</p> 
 <p>While I wish this unexpected change had been more clearly</p> 
 <p>announced, it’s a good one. Here’s how Dave Reed explained it</p> 
 <p>to me:</p> 
 <p>{"d": 1 }</p> 
 <p>Is not a valid JavaScript statement, where as this:</p> 
 <p>[1]</p> 
 <p>Is.</p> 
 <p>So the wrapping of the "d" parameter prevents direct execution</p> 
 <p>of the string as script. No Object or Array constructor</p> 
 <p>worries.</p> 
 <p>[] is JavaScript’s array literal notation, allowing you to</p> 
 <p>instantiate an array without explicitly calling a constructor. To</p> 
 <p>expand on Dave’s explanation, simply consider this code:</p> 
 <p>["Dave", alert("Do Evil"), "Ward"]</p> 
 <p>That literal array declaration will execute the</p> 
 <p>alert in most browsers. Danger!</p> 
 <p>Update: For an even better description of why</p> 
 <p>the .d is important, from Dave Reed himself, be sure to see</p> 
 <p>his comment below.</p> 
 <p>Conclusion</p> 
 <p>I hope this post has helped clarify any confusion caused by the</p> 
 <p>“d” in ASP.NET 3.5’s JSON serialized ASMX services, and made you</p> 
 <p>aware of why it’s worth the hassle. As</p> 
 <p>sophisticated as XSS exploits have become in recent years,</p> 
 <p>unexpected script execution has the potential for devastating</p> 
 <p>consequences. That extra “d” is well worth the short-term</p> 
 <p>hassle.</p> 
 <p>Microsoft often catches flak over security related issues, but</p> 
 <p>rarely gets credit when they do things right. I, for one, think the</p> 
 <p>ASP.NET team deserves credit for remaining vigilant and often</p> 
 <p>preempting these exploits for us.</p> 
 <p>Thanks, guys.</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/28731edf167abadedc15c6b33430579c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">炉石传说无法登录服务器未响应是什么意思,炉石传说：你还在卡大门无法登陆游戏吗？这些方法也许能帮到你...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/890440bffcea88fb1f55fd02384f928f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">100台电脑无盘服务器配置,100台机子建立一个无盘工作站，用什么结构什么配置..... 爱问知识人...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>