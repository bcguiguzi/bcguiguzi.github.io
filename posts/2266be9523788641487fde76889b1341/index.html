<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何获取事件冒泡里最顶层的元素（或者任意层的元素） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何获取事件冒泡里最顶层的元素（或者任意层的元素）" />
<meta property="og:description" content="先举个例子，有如下DOM结构：
&lt;ul @click=&#34;toApply&#34;&gt; &lt;li data-user-id=&#34;1&#34;&gt; &lt;img src=&#34;/static/user/face/4.jpg&#34; class=&#34;user&#34;&gt; &lt;div class=&#34;info&#34;&gt; &lt;p class=&#34;name&#34;&gt;ThreeTree&lt;/p&gt; &lt;p class=&#34;intro&#34;&gt; &lt;span class=&#34;man&#34;&gt;19&lt;/span&gt; 大哥 想请教一个问题 &lt;/p&gt; &lt;p class=&#34;from&#34;&gt;来自：JS讨论群&lt;/p&gt; &lt;button class=&#34;agree&#34;&gt;同意&lt;/button&gt; &lt;/div&gt; &lt;/li&gt; &lt;li data-user-id=&#34;2&#34;&gt; &lt;img src=&#34;/static/user/face/6.jpg&#34; class=&#34;user&#34;&gt; &lt;div class=&#34;info&#34;&gt; &lt;p class=&#34;name&#34;&gt;rshu&lt;/p&gt; &lt;p class=&#34;intro&#34;&gt; &lt;span class=&#34;man&#34;&gt;19&lt;/span&gt; 我是rshu &lt;/p&gt; &lt;p class=&#34;from&#34;&gt;来自：QQ群-ThinkPHP技术讨论中心&lt;/p&gt; &lt;button class=&#34;other&#34;&gt;已拒绝&lt;/button&gt; &lt;/div&gt; &lt;/li&gt; &lt;li data-user-id=&#34;3&#34;&gt; &lt;img src=&#34;/static/user/face/7.jpg&#34; class=&#34;user&#34;&gt; &lt;div class=&#34;info&#34;&gt; &lt;p class=&#34;name&#34;&gt;云端之上&lt;/p&gt; &lt;p class=&#34;intro&#34;&gt; &lt;span class=&#34;man&#34;&gt;19&lt;/span&gt; 你是腾讯的? &lt;/p&gt; &lt;p class=&#34;from&#34;&gt;来自：临时会话&lt;/p&gt; &lt;button class=&#34;other&#34;&gt;已拒绝&lt;/button&gt; &lt;/div&gt; &lt;/li&gt; &lt;li data-user-id=&#34;4&#34;&gt; &lt;img src=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/2266be9523788641487fde76889b1341/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-06-30T13:03:53+08:00" />
<meta property="article:modified_time" content="2017-06-30T13:03:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何获取事件冒泡里最顶层的元素（或者任意层的元素）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-family:Microsoft YaHei; font-size:14px">先举个例子，有如下DOM结构：</span></p> 
<p><span style="font-family:Microsoft YaHei; font-size:14px"></span></p> 
<pre><code class="language-html">    &lt;ul @click="toApply"&gt;
              &lt;li data-user-id="1"&gt;  
                  &lt;img src="/static/user/face/4.jpg" class="user"&gt;
                  &lt;div class="info"&gt;
                     &lt;p class="name"&gt;ThreeTree&lt;/p&gt;
                     &lt;p class="intro"&gt;
                         &lt;span class="man"&gt;19&lt;/span&gt;
                         大哥 想请教一个问题 
                      &lt;/p&gt;
                     &lt;p class="from"&gt;来自：JS讨论群&lt;/p&gt;
                     &lt;button class="agree"&gt;同意&lt;/button&gt;
                  &lt;/div&gt;
              &lt;/li&gt;
              &lt;li data-user-id="2"&gt;  
                  &lt;img src="/static/user/face/6.jpg" class="user"&gt;
                  &lt;div class="info"&gt;
                     &lt;p class="name"&gt;rshu&lt;/p&gt;
                     &lt;p class="intro"&gt;
                         &lt;span class="man"&gt;19&lt;/span&gt;
                         我是rshu
                      &lt;/p&gt;
                     &lt;p class="from"&gt;来自：QQ群-ThinkPHP技术讨论中心&lt;/p&gt;
                     &lt;button class="other"&gt;已拒绝&lt;/button&gt;
                  &lt;/div&gt;
              &lt;/li&gt;
              &lt;li data-user-id="3"&gt;  
                  &lt;img src="/static/user/face/7.jpg" class="user"&gt;
                  &lt;div class="info"&gt;
                     &lt;p class="name"&gt;云端之上&lt;/p&gt;
                     &lt;p class="intro"&gt;
                         &lt;span class="man"&gt;19&lt;/span&gt;
                         你是腾讯的?
                      &lt;/p&gt;
                     &lt;p class="from"&gt;来自：临时会话&lt;/p&gt;
                     &lt;button class="other"&gt;已拒绝&lt;/button&gt;
                  &lt;/div&gt;
              &lt;/li&gt;
              &lt;li data-user-id="4"&gt;  
                  &lt;img src="/static/user/face/8.jpg" class="user"&gt;
                  &lt;div class="info"&gt;
                     &lt;p class="name"&gt;后知后觉&lt;/p&gt;
                     &lt;p class="intro"&gt;
                         &lt;span class="man"&gt;19&lt;/span&gt;
                         请求加为好友
                      &lt;/p&gt;
                     &lt;p class="from"&gt;来自：JS讨论群&lt;/p&gt;
                     &lt;button class="other"&gt;已同意&lt;/button&gt;
                  &lt;/div&gt;
              &lt;/li&gt;
              &lt;li data-user-id="5"&gt;  
                  &lt;img src="/static/user/face/9.jpg" class="user"&gt;
                  &lt;div class="info"&gt;
                     &lt;p class="name mes"&gt;阿里巴巴社招内推&lt;/p&gt;
                     &lt;p class="message"&gt;已发送验证消息&lt;/p&gt;
                     &lt;button class="other"&gt;等待验证&lt;/button&gt;
                  &lt;/div&gt;
              &lt;/li&gt;
       &lt;/ul&gt;</code></pre> 
<br> 渲染结果如下图： 
<p></p> 
<p><span style="font-family:Microsoft YaHei; font-size:14px"><img src="https://images2.imgbox.com/91/43/xruvFR3n_o.png" alt=""><br> </span></p> 
<p><span style="font-family:Microsoft YaHei; font-size:14px"><br> </span></p> 
<p><span style="font-family:Microsoft YaHei; font-size:14px">现在我的需求是点击每个LI里面的任何区域，都会<span style="font-family:'Microsoft YaHei'; font-size:14px">根据LI的</span><span style="font-family:'Microsoft YaHei'; font-size:14px">data-user-id属性</span>跳转到各自的好友申请页面。显然我是不会直接在LI上绑定事件的，因为那样会造成浏览器的性能下降。更优的做法是在LI的父元素上绑定事件，也就是事件代理（或者说事件委托），<span style="font-family:'Microsoft YaHei'; font-size:14px">事件代理原理是</span>通过事件冒泡，点击LI元素，那么LI的父元素ul也会触发click事件，这样性能就得到了极大的提升。</span></p> 
<p><span style="font-family:Microsoft YaHei; font-size:14px">但是，现在问题来了，我通过</span><span style="font-family:'Microsoft YaHei'; font-size:14px">let target=e.target||e.srcElement来获取目标元素，</span><span style="font-family:'Microsoft YaHei'; font-size:14px">获取到的</span><span style="font-family:'Microsoft YaHei'; font-size:14px">target就</span><span style="font-family:'Microsoft YaHei'; font-size:14px">可能是img，可能是p，可能是div，也可能是span，button。在这些子元素上是没有</span><span style="font-family:'Microsoft YaHei'; font-size:14px">data-user-id属性的，这个属性唯独LI元素才有。也就是说，我只有拿到LI元素，才能获取data-user-id属性，不然是跳转不到好友申请页面的。</span></p> 
<p><span style="font-family:'Microsoft YaHei'; font-size:14px">那怎样获取LI元素呢？这其实就是经典的获取事件冒泡里任意层指定的元素的问题，现在我提供一种完美的解决方案，可以获取任意层的父元素。</span></p> 
<p><span style="font-family:'Microsoft YaHei'; font-size:14px">toApply方法如下：</span></p> 
<p><span style="font-family:'Microsoft YaHei'; font-size:14px"></span></p> 
<pre><code class="language-javascript"> toApply(e){
      let target=e.target||e.srcElement   // ES6的语法，用let声明一个变量
      while(target.tagName!='LI'){
        target=target.parentNode?target.parentNode:''  //不断取父节点来替换target
      }
      if(target) {   //如果目标元素LI存在
        const user_id=$(target).attr('data-user-id')
        this.$router.push({   //这是vue2.0的语法，跳转到指定页面
          path: '/friendApply',
          query: {user_id: user_id} 
        })
      }
 }</code></pre>我通过一个while循环，来不断地取target的父元素，直至target为父元素LI为止，取到后再跳转到各自的好友申请页面。这样问题就完美解决了。 
<p></p> 
<p><span style="font-family:'Microsoft YaHei'; font-size:14px">总结：项目中遇到的坑，很多时候只要加以思索就可以解决。只有想不到，没有做不到。</span></p> 
<p><span style="font-family:'Microsoft YaHei'; font-size:14px"><br> </span></p> 
<p><span style="font-family:Microsoft YaHei; font-size:14px"><br> </span></p> 
<p><span style="font-family:Microsoft YaHei; font-size:14px"><br> </span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9677f51476cd4c2b0bdb1b777ebb1af0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Device Admin 简单实践</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2e670bed7822fd4a08b614ef0551763/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringBoot&#43;Springcloud&#43;SpringBootAdmin 服务发现注册与服务监控完美整合</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>