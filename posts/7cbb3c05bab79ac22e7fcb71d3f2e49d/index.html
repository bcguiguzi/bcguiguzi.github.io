<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SqlAlchemyä½¿ç”¨æ•™ç¨‹(å…­) -- ORM è¡¨é—´å…³ç³»çš„å®šä¹‰ä¸CRUDæ“ä½œ - ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SqlAlchemyä½¿ç”¨æ•™ç¨‹(å…­) -- ORM è¡¨é—´å…³ç³»çš„å®šä¹‰ä¸CRUDæ“ä½œ" />
<meta property="og:description" content="SqlAlchemyä½¿ç”¨æ•™ç¨‹(ä¸€) åŸç†ä¸ç¯å¢ƒæ­å»ºSqlAlchemyä½¿ç”¨æ•™ç¨‹(äºŒ) å…¥é—¨ç¤ºä¾‹åŠç¼–ç¨‹æ­¥éª¤SqlAlchemyä½¿ç”¨æ•™ç¨‹(ä¸‰) CoreAPIè®¿é—®ä¸æ“ä½œæ•°æ®åº“è¯¦è§£SqlAlchemyä½¿ç”¨æ•™ç¨‹(å››) MetaData ä¸ SQL Express Language çš„ä½¿ç”¨SqlAlchemyä½¿ç”¨æ•™ç¨‹(äº”) ORM API ç¼–ç¨‹å…¥é—¨ æœ¬ç« å†…å®¹ï¼Œç¨å¾®æœ‰äº›å¤æ‚ï¼Œå»ºè®®è…¾å‡º2å°æ—¶ç©ºé—²æ—¶é—´ï¼Œå†²æ¯å’–å•¡æˆ–æ³¡æ¯èŒ¶ ğŸ˜ƒ , æ…¢æ…¢çœ‹ï¼Œåœ¨ç”µè„‘ä¸Šè·‘ä¸‹ä»£ç ï¼Œå¯ä»¥åŠ æ·±ç†è§£.
å…­ã€è¡¨é—´å…³ç³»çš„å®šä¹‰ä¸CRUDæ“ä½œ è¡¨é—´å…³ç³»ä¸»è¦åŒ…æ‹¬ï¼šä¸€å¯¹å¤šï¼Œä¸€å¯¹ä¸€ï¼Œå¤šå¯¹å¤šã€‚å…¶ä¸­ä¸€å¯¹å¤šå…³ç³»ä¸­ä¹Ÿéšå«äº†å¤šå¯¹ä¸€å…³ç³»ã€‚
è¡¨é—´å…³ç³»æ˜¯æ•°æ®åº“æ“ä½œä¸­çš„é‡è¦æŠ€æœ¯ç‚¹ï¼Œéå¸¸æœ‰å¿…è¦ç†è§£ä¸æŒæ¡ã€‚
1ã€ ä¸€å¯¹å¤šè¡¨é—´å…³ç³»çš„å®šä¹‰ ä¸€å¯¹å¤šè¡¨é—´å…³ç³»å®ç°è¯­æ³• ä»¥ä¸€å¯¹å¤šå…³ç³»ä¸ºä¾‹ï¼Œ
å­è¡¨ä¾§ï¼Œä¸çˆ¶è¡¨æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œçˆ¶è¡¨ä¾§ï¼Œå¯ä»¥åå‘æŸ¥è¯¢å­è¡¨æ•°æ®ï¼Œä¸å­è¡¨æ˜¯å¤šå¯¹ä¸€å…³ç³»ã€‚ class Parent(Base): __tablename__ = &#34;parent_table&#34; id: Mapped[int] = mapped_column(primary_key=True) children: Mapped[List[&#34;Child&#34;]] = relationship(back_populates=&#34;parent&#34;) class Child(Base): __tablename__ = &#34;child_table&#34; id: Mapped[int] = mapped_column(primary_key=True) parent_id: Mapped[int] = mapped_column(ForeignKey(&#34;parent_table.id&#34;)) parent: Mapped[&#34;Parent&#34;] = relationship(back_populates=&#34;children&#34;) è¯´æ˜ï¼š
1ï¼‰åœ¨å­è¡¨ä¸­æ·»åŠ å¤–é”®å­—æ®µï¼Œä»¥åŠrelationship()å¼•ç”¨ï¼Œ
2ï¼‰åœ¨çˆ¶è¡¨ä¸­æ·»åŠ relationship()å¼•ç”¨ï¼Œç”¨äºåå‘æŸ¥è¯¢ã€‚
ç¤ºä¾‹ä»£ç  çˆ¶è¡¨ï¼šcompany, å­è¡¨ person, è¡¨ç»“æ„ç±»å®šä¹‰å¦‚ä¸‹ã€‚
from sqlalchemy.orm import DeclarativeBase, Session from sqlalchemy." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/7cbb3c05bab79ac22e7fcb71d3f2e49d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-24T11:19:23+08:00" />
<meta property="article:modified_time" content="2024-01-24T11:19:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SqlAlchemyä½¿ç”¨æ•™ç¨‹(å…­) -- ORM è¡¨é—´å…³ç³»çš„å®šä¹‰ä¸CRUDæ“ä½œ</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/50/85/3CyvffIn_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" width="1000"></p> 
<blockquote> 
 <ul><li><a href="https://blog.csdn.net/captain5339/article/details/135561292">SqlAlchemyä½¿ç”¨æ•™ç¨‹(ä¸€) åŸç†ä¸ç¯å¢ƒæ­å»º</a></li><li><a href="https://blog.csdn.net/captain5339/article/details/135580682">SqlAlchemyä½¿ç”¨æ•™ç¨‹(äºŒ) å…¥é—¨ç¤ºä¾‹åŠç¼–ç¨‹æ­¥éª¤</a></li><li><a href="https://blog.csdn.net/captain5339/article/details/135582739">SqlAlchemyä½¿ç”¨æ•™ç¨‹(ä¸‰) CoreAPIè®¿é—®ä¸æ“ä½œæ•°æ®åº“è¯¦è§£</a></li><li><a href="https://blog.csdn.net/captain5339/article/details/135598914">SqlAlchemyä½¿ç”¨æ•™ç¨‹(å››) MetaData ä¸ SQL Express Language çš„ä½¿ç”¨</a></li><li><a href="https://blog.csdn.net/captain5339/article/details/135685624">SqlAlchemyä½¿ç”¨æ•™ç¨‹(äº”) ORM API ç¼–ç¨‹å…¥é—¨</a></li></ul> 
</blockquote> 
<blockquote> 
 <p>æœ¬ç« å†…å®¹ï¼Œç¨å¾®æœ‰äº›å¤æ‚ï¼Œå»ºè®®è…¾å‡º2å°æ—¶ç©ºé—²æ—¶é—´ï¼Œå†²æ¯å’–å•¡æˆ–æ³¡æ¯èŒ¶ ğŸ˜ƒ , æ…¢æ…¢çœ‹ï¼Œåœ¨ç”µè„‘ä¸Šè·‘ä¸‹ä»£ç ï¼Œå¯ä»¥åŠ æ·±ç†è§£.</p> 
</blockquote> 
<h2><a id="CRUD_9"></a>å…­ã€è¡¨é—´å…³ç³»çš„å®šä¹‰ä¸CRUDæ“ä½œ</h2> 
<p>è¡¨é—´å…³ç³»ä¸»è¦åŒ…æ‹¬ï¼šä¸€å¯¹å¤šï¼Œä¸€å¯¹ä¸€ï¼Œå¤šå¯¹å¤šã€‚å…¶ä¸­ä¸€å¯¹å¤šå…³ç³»ä¸­ä¹Ÿéšå«äº†å¤šå¯¹ä¸€å…³ç³»ã€‚<br> è¡¨é—´å…³ç³»æ˜¯æ•°æ®åº“æ“ä½œä¸­çš„é‡è¦æŠ€æœ¯ç‚¹ï¼Œéå¸¸æœ‰å¿…è¦ç†è§£ä¸æŒæ¡ã€‚</p> 
<h3><a id="1__13"></a>1ã€ ä¸€å¯¹å¤šè¡¨é—´å…³ç³»çš„å®šä¹‰</h3> 
<h4><a id="_14"></a>ä¸€å¯¹å¤šè¡¨é—´å…³ç³»å®ç°è¯­æ³•</h4> 
<p>ä»¥ä¸€å¯¹å¤šå…³ç³»ä¸ºä¾‹ï¼Œ</p> 
<ul><li>å­è¡¨ä¾§ï¼Œä¸çˆ¶è¡¨æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œ</li><li>çˆ¶è¡¨ä¾§ï¼Œå¯ä»¥åå‘æŸ¥è¯¢å­è¡¨æ•°æ®ï¼Œä¸å­è¡¨æ˜¯å¤šå¯¹ä¸€å…³ç³»ã€‚</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"parent_table"</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    children<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token string">"Child"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> relationship<span class="token punctuation">(</span>back_populates<span class="token operator">=</span><span class="token string">"parent"</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Child</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"child_table"</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    parent_id<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>ForeignKey<span class="token punctuation">(</span><span class="token string">"parent_table.id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    parent<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token string">"Parent"</span><span class="token punctuation">]</span> <span class="token operator">=</span> relationship<span class="token punctuation">(</span>back_populates<span class="token operator">=</span><span class="token string">"children"</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¯´æ˜ï¼š<br> 1ï¼‰åœ¨å­è¡¨ä¸­æ·»åŠ å¤–é”®å­—æ®µï¼Œä»¥åŠrelationship()å¼•ç”¨ï¼Œ<br> 2ï¼‰åœ¨çˆ¶è¡¨ä¸­æ·»åŠ relationship()å¼•ç”¨ï¼Œç”¨äºåå‘æŸ¥è¯¢ã€‚</p> 
<h4><a id="_39"></a>ç¤ºä¾‹ä»£ç </h4> 
<p>çˆ¶è¡¨ï¼šcompany, å­è¡¨ person, è¡¨ç»“æ„ç±»å®šä¹‰å¦‚ä¸‹ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> DeclarativeBase<span class="token punctuation">,</span> Session
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> Mapped<span class="token punctuation">,</span> mapped_column
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> relationship
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> ForeignKey
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> String<span class="token punctuation">,</span> Integer
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">(</span>DeclarativeBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">class</span> <span class="token class-name">Company</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"company"</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    company_name<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    persons<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token string">'Person'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> relationship<span class="token punctuation">(</span>
        back_populates<span class="token operator">=</span><span class="token string">"company"</span><span class="token punctuation">,</span> cascade<span class="token operator">=</span><span class="token string">"all, delete-orphan"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Company(id=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">, company_name=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>company_name<span class="token punctuation">}</span></span><span class="token string">)"</span></span>

<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"person"</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    age<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>Integer<span class="token punctuation">)</span>
    company_id<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>ForeignKey<span class="token punctuation">(</span><span class="token string">"company.id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    company<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token string">'Company'</span><span class="token punctuation">]</span> <span class="token operator">=</span> relationship<span class="token punctuation">(</span>back_populates<span class="token operator">=</span><span class="token string">"persons"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Person(id=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">, name=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">)"</span></span>
</code></pre> 
<p><strong>è¯´æ˜ï¼š</strong><br> 1ï¼‰ä»å­è¡¨è§†è§’çœ‹ï¼Œ1ä¸ªäººåªå±äº1ä¸ªCompany; ä½†1ä¸ªCompany å¯¹åº”å¤šä¸ªäººï¼Œå› æ­¤åœ¨çˆ¶è¡¨åˆ™ï¼Œrelationship() å·¦ä¾§çš„ç±»å‹æ³¨è§£ä¸º List[â€˜Personâ€™], ä¹Ÿå¯ä»¥ç”¨Set[â€˜Personâ€™]<br> 2ï¼‰çˆ¶è¡¨ä¸­æ·»åŠ åˆ é™¤ä¾èµ–ï¼Œcascade=â€œall, delete-orphanâ€ï¼Œå³å­è¡¨ä¸­ä¸å­˜åœ¨å¯¹çˆ¶è¡¨è®°å½•çš„å¼•ç”¨æ—¶ï¼Œæ‰èƒ½åˆ é™¤ï¼Œä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚<br> 3ï¼‰å½“å‰ç‰ˆæœ¬å¯èƒ½å­˜åœ¨bug, å®˜æ–¹æ–‡æ¡£ä¸­çš„ç¤ºä¾‹ä¸­æœ‰çš„å­—æ®µä½¿ç”¨ç®€åŒ–å†™æ³•ï¼ˆå³ä¾§æœªç»™å‡ºmapped_column())ï¼Œsqlite3è¿è¡Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†mysql, postgresqlåˆ›å»ºè¡¨æ—¶ä¼šä¸¢å¼ƒç®€åŒ–å†™æ³•çš„å­—æ®µï¼Œå¯¼è‡´åç»­insertç­‰æ“ä½œå¤±è´¥ã€‚ å› æ­¤è¯·ä¸¥æ ¼è¯·å‹¿é‡‡æœ‰ç®€åŒ–å†™æ³•ã€‚</p> 
<h4><a id="_80"></a>å¤šå¯¹ä¸€å…³ç³»çš„å®ç°è¯­æ³•</h4> 
<p>å½“ä¸éœ€è¦åå‘æŸ¥è¯¢æ—¶ï¼Œåˆ™çˆ¶è¡¨ä¸å­è¡¨å½¢æˆMany to One å¤šå¯¹ä¸€å…³ç³»ï¼Œ åœ¨çˆ¶è¡¨åˆ™æ·»åŠ å­è¡¨çš„å¤–é”®ä¸relationship()å¼•ç”¨ï¼Œå­è¡¨æ— é¡»åšé¢å¤–é…ç½®</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"parent_table"</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    child_id<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>ForeignKey<span class="token punctuation">(</span><span class="token string">"child_table.id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    child<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token string">"Child"</span><span class="token punctuation">]</span> <span class="token operator">=</span> relationship<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Child</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"child_table"</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>å¦‚æœå…è®¸ child_idç©ºå€¼ï¼Œåˆ™å°†æ”¹å­—æ®µçš„ç±»å‹æ³¨è§£ä¿®æ”¹ä¸º</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
child_id<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span>Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>ForeignKey<span class="token punctuation">(</span><span class="token string">"child_table.id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>å¯¹äº3.10+ç‰ˆæœ¬ï¼Œç±»å‹æ³¨è§£æ”¯æŒ | æ“ä½œç¬¦</p> 
<pre><code class="prism language-python">child_id<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span> <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>ForeignKey<span class="token punctuation">(</span><span class="token string">"child_table.id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
child<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span>Child <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">=</span> relationship<span class="token punctuation">(</span>back_populates<span class="token operator">=</span><span class="token string">"parents"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2__115"></a>2ã€ æ’å…¥æ•°æ®ä¸å¤šè¡¨è”åˆæŸ¥è¯¢</h3> 
<h4><a id="1_116"></a>1ï¼‰åœ¨æ•°æ®åº“åˆ›å»ºè¡¨</h4> 
<pre><code class="prism language-python"><span class="token comment"># åˆ›å»ºæ•°æ®åº“è¿æ¥å¼•æ“å¯¹è±¡</span>
engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span>
    <span class="token string">"mysql+mysqlconnector://root:Admin&amp;123@localhost:3306/testdb"</span><span class="token punctuation">)</span>
<span class="token comment"># å°†DDLè¯­å¥æ˜ å°„åˆ°æ•°æ®åº“è¡¨ï¼Œå¦‚æœæ•°æ®åº“è¡¨ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥è¡¨</span>
Base<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span>engine<span class="token punctuation">)</span>
<span class="token comment"># æ‰“å°åˆ›å»ºåˆ›å»ºçš„è¡¨</span>
Print<span class="token punctuation">(</span>Base<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>tables<span class="token punctuation">)</span> 
</code></pre> 
<h4><a id="2_128"></a>2ï¼‰æ’å…¥æ•°æ®</h4> 
<h5><a id="_129"></a>åŸºæœ¬æ­¥éª¤åŒ…æ‹¬ï¼š</h5> 
<p>(1)ä¸ºæµ‹è¯•æ–¹ä¾¿ï¼Œå…ˆå†™1ä¸ªget_or_create()å‡½æ•°ï¼Œå¦‚æœæ’å…¥å¯¹è±¡åœ¨æ•°æ®åº“ä¸­å·²å­˜åœ¨åˆ™ä¸æ’å…¥ï¼Œä»¥æ–¹ä¾¿è¿ç»­æµ‹è¯•ã€‚<br> (2)åˆ›å»ºsessionå¯¹è±¡<br> (3)å…ˆåˆ›å»ºçˆ¶è¡¨å¯¹è±¡å¹¶æ’å…¥<br> (4)åˆ›å»ºå­è¡¨å¯¹è±¡å¹¶æ’å…¥<br> (5)ç”¨å¤šè¡¨æŸ¥è¯¢æ–¹æ³•æ£€æŸ¥ç»“æœ</p> 
<h5><a id="Step1_create_or_create_136"></a>Step-1: è‡ªå®šä¹‰create_or_create()å‡½æ•°</h5> 
<p>å®˜æ–¹æä¾›çš„upsertæ–¹æ³•ä¸é€šç”¨ã€‚ä¸‹é¢å‡½æ•°æ˜¯é€šç”¨çš„ï¼Œ</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_or_create</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> model<span class="token punctuation">,</span> defaults<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›
    è¾“å…¥å‚æ•°ï¼š
        session: sqlalchemy session
        model: è‡ªå®šä¹‰çš„ORMç±»
        defaults: æœ‰é»˜è®¤å€¼çš„å­—æ®µ
        kwargs: å…¶ä»–å­—æ®µ(å¿…é¡»åŒ…å«ä¸»è¦å­—æ®µ)
    è¿”å›å€¼ï¼š
        instance: è¿”å›çš„å®ä¾‹
    """</span>
    instance <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> instance<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"instance already exists"</span><span class="token punctuation">,</span> instance<span class="token punctuation">)</span>
        <span class="token keyword">return</span> instance
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
                      <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ClauseElement<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> defaults<span class="token punctuation">:</span>
            params<span class="token punctuation">.</span>update<span class="token punctuation">(</span>defaults<span class="token punctuation">)</span>
        instance <span class="token operator">=</span> model<span class="token punctuation">(</span><span class="token operator">**</span>params<span class="token punctuation">)</span>
        session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
        session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"instance inserted"</span><span class="token punctuation">,</span> instance<span class="token punctuation">)</span>
        <span class="token keyword">return</span> instance
</code></pre> 
<h5><a id="Step2__166"></a>Step-2: å‘ä¸¤ä¸ªå…³è”è¡¨æ’å…¥æ•°æ®</h5> 
<p>ç”¨with è¯­å¥åˆ›å»ºsessionå¯¹è±¡ï¼Œæ’å…¥æ“ä½œé¡ºåºï¼Œå…ˆçˆ¶è¡¨å†å­è¡¨</p> 
<pre><code class="prism language-python"><span class="token keyword">with</span> Session<span class="token punctuation">(</span>engine<span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
    <span class="token comment"># æ’å…¥æ•°æ®</span>
    get_or_create<span class="token punctuation">(</span>session<span class="token punctuation">,</span> Company<span class="token punctuation">,</span> company_name<span class="token operator">=</span><span class="token string">"èœ€æ±‰"</span><span class="token punctuation">)</span>
    get_or_create<span class="token punctuation">(</span>session<span class="token punctuation">,</span> Company<span class="token punctuation">,</span> company_name<span class="token operator">=</span><span class="token string">"æ›¹é­"</span><span class="token punctuation">)</span>
    get_or_create<span class="token punctuation">(</span>session<span class="token punctuation">,</span> Company<span class="token punctuation">,</span> company_name<span class="token operator">=</span><span class="token string">"ä¸œå´"</span><span class="token punctuation">)</span>
    
    stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>Company<span class="token punctuation">)</span>
    results <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># insert data in person table</span>
    company_shu <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>select<span class="token punctuation">(</span>Company<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>
        Company<span class="token punctuation">.</span>company_name <span class="token operator">==</span> <span class="token string">"èœ€æ±‰"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    get_or_create<span class="token punctuation">(</span>session<span class="token punctuation">,</span> Person<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"åˆ˜å¤‡"</span><span class="token punctuation">,</span>
                  age<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> company<span class="token operator">=</span>company_shu<span class="token punctuation">)</span>
    get_or_create<span class="token punctuation">(</span>session<span class="token punctuation">,</span> Person<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"å…³ç¾½"</span><span class="token punctuation">,</span>
                  age<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span> company<span class="token operator">=</span>company_shu<span class="token punctuation">)</span>
    get_or_create<span class="token punctuation">(</span>session<span class="token punctuation">,</span> Person<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"å¼ é£"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">38</span><span class="token punctuation">,</span> company<span class="token operator">=</span>company_shu<span class="token punctuation">)</span>
    company_wei <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>select<span class="token punctuation">(</span>Company<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>
        Company<span class="token punctuation">.</span>company_name <span class="token operator">==</span> <span class="token string">"æ›¹é­"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    get_or_create<span class="token punctuation">(</span>session<span class="token punctuation">,</span> Person<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"å¼ è¾½"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span> company<span class="token operator">=</span>company_wei<span class="token punctuation">)</span>
    get_or_create<span class="token punctuation">(</span>session<span class="token punctuation">,</span> Person<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"æ›¹æ“"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">38</span><span class="token punctuation">,</span> company<span class="token operator">=</span>company_wei<span class="token punctuation">)</span>
    company_wu <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>select<span class="token punctuation">(</span>Company<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>
        Company<span class="token punctuation">.</span>company_name <span class="token operator">==</span> <span class="token string">"ä¸œå´"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    get_or_create<span class="token punctuation">(</span>session<span class="token punctuation">,</span> Person<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"å‘¨ç‘œ"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> company<span class="token operator">=</span>company_wu<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="3__197"></a>3) å¤šè¡¨è”åˆæŸ¥è¯¢</h4> 
<pre><code class="prism language-python">   <span class="token comment"># select with Join å¤šè¡¨æŸ¥è¯¢</span>
    stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>company<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>
        Company<span class="token punctuation">.</span>company_name <span class="token operator">==</span> <span class="token string">"èœ€æ±‰"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
    results <span class="token operator">=</span> session<span class="token punctuation">.</span>scalars<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
    <span class="token comment"># éå†ç»“æœ</span>
    <span class="token keyword">for</span> r <span class="token keyword">in</span> results<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>name<span class="token punctuation">,</span> r<span class="token punctuation">.</span>age<span class="token punctuation">,</span> r<span class="token punctuation">.</span>company<span class="token punctuation">.</span>company_name<span class="token punctuation">)</span>
</code></pre> 
<p>Output:</p> 
<pre><code class="prism language-python">instance inserted Company<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> company_name<span class="token operator">=</span>èœ€æ±‰<span class="token punctuation">)</span>
instance inserted Company<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> company_name<span class="token operator">=</span>æ›¹é­<span class="token punctuation">)</span>
instance inserted Company<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> company_name<span class="token operator">=</span>ä¸œå´<span class="token punctuation">)</span>
<span class="token punctuation">[</span>Company<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> company_name<span class="token operator">=</span>èœ€æ±‰<span class="token punctuation">)</span><span class="token punctuation">,</span> Company<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> company_name<span class="token operator">=</span>æ›¹é­<span class="token punctuation">)</span><span class="token punctuation">,</span> Company<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> company_name<span class="token operator">=</span>ä¸œå´<span class="token punctuation">)</span><span class="token punctuation">]</span>
instance inserted Person<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span>åˆ˜å¤‡<span class="token punctuation">)</span>
instance inserted Person<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>å…³ç¾½<span class="token punctuation">)</span>
instance inserted Person<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">=</span>å¼ é£<span class="token punctuation">)</span>
instance inserted Person<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">=</span>å¼ è¾½<span class="token punctuation">)</span>
instance inserted Person<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> name<span class="token operator">=</span>æ›¹æ“<span class="token punctuation">)</span>
instance inserted Person<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> name<span class="token operator">=</span>å‘¨ç‘œ<span class="token punctuation">)</span>
å¼ é£ <span class="token number">38</span> èœ€æ±‰
å…³ç¾½ <span class="token number">40</span> èœ€æ±‰
åˆ˜å¤‡ <span class="token number">42</span> èœ€æ±‰
</code></pre> 
<p><strong>åˆ é™¤æ•°æ®</strong><br> å½“åˆ é™¤çˆ¶è¡¨è®°å½•æ—¶ï¼Œå­è¡¨ä¸­åº”æ— å¯¹æ­¤æ•°æ®çš„å¼•ç”¨ï¼Œå¦åˆ™æ— æ³•åˆ é™¤ã€‚</p> 
<h3><a id="3__230"></a>3ã€ ä¸€å¯¹ä¸€å…³ç³»</h3> 
<p>ä»å¤–é”®è§’åº¦çœ‹ï¼Œä¸€å¯¹ä¸€å…³ç³»ä¹Ÿæ˜¯ä¸€å¯¹å¤šå…³ç³»ã€‚å®ç°æ—¶ï¼Œ</p> 
<ul><li>åœ¨çˆ¶è¡¨ä¸­æ”¶é›†å­è¡¨æ•°æ®æ—¶ï¼Œç±»å‹æ³¨è§£ä¸ä½¿ç”¨é›†åˆç±»å‹å³å¯ã€‚</li><li>å­è¡¨ä¸­relationship()æ–¹æ³•ä¸­æ·»åŠ single_parent=True.</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"parent_table"</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
child<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token string">"Child"</span><span class="token punctuation">]</span> <span class="token operator">=</span> relationship<span class="token punctuation">(</span>back_populates<span class="token operator">=</span><span class="token string">"parent"</span><span class="token punctuation">)</span>   
    <span class="token comment"># ä¸€å¯¹å¤šæ—¶ï¼Œä½¿ç”¨child: Mapped[List["Child"]] </span>


<span class="token keyword">class</span> <span class="token class-name">Child</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"child_table"</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    parent_id<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>ForeignKey<span class="token punctuation">(</span><span class="token string">"parent_table.id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    parent<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token string">"Parent"</span><span class="token punctuation">]</span> <span class="token operator">=</span> relationship<span class="token punctuation">(</span>back_populates<span class="token operator">=</span><span class="token string">"child"</span>ï¼Œsingle_parent<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="4__251"></a>4ã€ å¤šå¯¹å¤šå…³ç³»</h3> 
<p>å¤šå¯¹å¤šå…³ç³»ç‰¹ç‚¹ï¼š<br> 1ï¼‰çˆ¶è¡¨ä¸å­è¡¨ï¼Œå­è¡¨ä¸çˆ¶è¡¨ä¹‹é—´å‡ä¸ºå¤šå¯¹å¤šå…³ç³»ã€‚<br> 2ï¼‰é€šå¸¸ä½¿ç”¨1å¼ ä¸­é—´è¡¨ï¼Œ ä¸çˆ¶è¡¨ã€å­è¡¨å‡å®ç°1å¯¹å¤šå…³ç³»ã€‚<br> ï¼ˆå½“ç„¶æœ‰çš„ORMæ¨¡å‹å°†ä¸­é—´è¡¨çš„åˆ›å»ºéšè—èµ·æ¥ï¼Œä½†åœ¨æ•°æ®åº“ä¸­è¿˜æ˜¯å¯ä»¥çœ‹åˆ°ï¼‰</p> 
<h4><a id="_257"></a>å¤šå¯¹å¤šå…³ç³»å®šä¹‰ç¤ºä¾‹</h4> 
<pre><code class="prism language-python"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations

<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> Column
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> Table
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> ForeignKey
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> Integer
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> Mapped
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> mapped_column
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> DeclarativeBase
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> relationship


<span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">(</span>DeclarativeBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="token comment"># note for a Core table, we use the sqlalchemy.Column construct,</span>
<span class="token comment"># not sqlalchemy.orm.mapped_column</span>
association_table <span class="token operator">=</span> Table<span class="token punctuation">(</span>
    <span class="token string">"association_table"</span><span class="token punctuation">,</span>
    Base<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">"left_id"</span><span class="token punctuation">,</span> ForeignKey<span class="token punctuation">(</span><span class="token string">"left_table.id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">"right_id"</span><span class="token punctuation">,</span> ForeignKey<span class="token punctuation">(</span><span class="token string">"right_table.id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"left_table"</span>

    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    children<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Child<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> relationship<span class="token punctuation">(</span>
        secondary<span class="token operator">=</span>association_table<span class="token punctuation">,</span> back_populates<span class="token operator">=</span><span class="token string">"parents"</span>
    <span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Child</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"right_table"</span>

    <span class="token builtin">id</span><span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> mapped_column<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    parents<span class="token punctuation">:</span> Mapped<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Parent<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> relationship<span class="token punctuation">(</span>
        secondary<span class="token operator">=</span>association_table<span class="token punctuation">,</span> back_populates<span class="token operator">=</span><span class="token string">"children"</span>
    <span class="token punctuation">)</span>
</code></pre> 
<p>å¤šå¯¹å¤šå…³ç³»çš„æŸ¥è¯¢ã€æ’å…¥æ“ä½œä¸ä¸€å¯¹å¤šæŸ¥è¯¢ç›¸ä¼¼ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯åˆ é™¤æ“ä½œã€‚</p> 
<h4><a id="_305"></a>ä»å¤šå¯¹å¤šå…³ç³»ä¸­åˆ é™¤æ•°æ®</h4> 
<p>ç”¨SQLæ¥å®ç°æ—¶ï¼Œéœ€è¦å…ˆä»çˆ¶è¡¨ä¸å­è¡¨åˆ é™¤æ•°æ®ï¼Œå†ä»ä¸­é—´è¡¨åˆ é™¤ã€‚ORM API å¯ä»¥è‡ªåŠ¨å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚ å¦‚è¦åˆ é™¤å­è¡¨çš„æŸæ¡è®°å½•ã€‚</p> 
<pre><code class="prism language-python">myparent<span class="token punctuation">.</span>children<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>somechild<span class="token punctuation">)</span>
</code></pre> 
<p>æ³¨ï¼šé€šè¿‡session.delete(somechild)æ—¶ï¼ŒMySqlå¯èƒ½ä¼šæŠ¥é”™ï¼Œæˆ‘é‡åˆ°çš„åŸå› æœ‰å¤šç§ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚<br> åŒæ ·ï¼Œå¦‚æœè¦åˆ é™¤çˆ¶è¡¨ä¸­çš„1æ¡è®°å½•ï¼š</p> 
<pre><code class="prism language-python">mychild<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>someparent<span class="token punctuation">)</span> 
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/38449228a87b07958a47682629d30c12/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">SqlAlchemyä½¿ç”¨æ•™ç¨‹(äº”) ORM API ç¼–ç¨‹å…¥é—¨</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/97fbc6809c414facc270559f6c7e0879/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Pythonå­¦ä¹ ä»0åˆ°1 day8 Pythonå¾ªç¯è¯­å¥</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>