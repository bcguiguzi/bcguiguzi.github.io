<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>王佩丰数据透视表（六到十一讲） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="王佩丰数据透视表（六到十一讲）" />
<meta property="og:description" content="动态引用数据源区域。
结合新建名称和offset函数，设置一个动态数据区域。
插入数据透视表时引用这个名称即可。
Gerpivotdata函数可以动态地引用数据透视表中的数据，默认是开启的。
举个例子，在透视表外引用单元格B5，会显示
即动态引用常熟区域的彩盒金额，此后如果常熟和彩盒的顺序改变了，该单元格也会动态调整，引用的数据仍然是常熟的彩盒。
这个动态引用功能可以在数据透视表工具栏的分析——选项处的生成Gerpivotdata处进行设置。
关闭此功能后再引用数据透视表中的数据就不会动态调整了，会引用固定位置的数据。
上面的Getpivotdata函数的第二个参数表示A3单元格所在的数据透视表，第一参数表示值字段，后面的参数表示字段和标签。
练习：通过结合数据有效性和Getpivotdata做出下面的结果。
先通过数据有效性建立序列，再在第四列中写上公式即可。
参数一后面&amp;&#34;&#34;将数值转为文本格式。
创建单页字段组合。
有时需要总结好几个工作表中的数据。
比如要对三个月的数据进行汇总。
顺序按下Alt加d加p，可以打开数据透视表和数据透视图向导。
默认设置数据源的第一列是透视表的行字段，其他列都是列字段，通过切换页字段可以显示不同工作表的数据。
不过这样做出来的透视表自由度小。
自定义页字段
向导中将创建单页字段改成自定义页字段。
多文件合并
现在有两个文件，南京和苏州的数据，每个文件有三个工作表。
方法和前面差不多，向导处选自定义页字段
得到的透视表中有城市和月份两个页字段。
在上面的创建单页字段和自定义页字段中，可以结合新建名称，这样创建的透视表是动态的。
比如将一个文件中的三个工作表中的数据都用offset新建名称
在相同中选定区域时直接使用。
若源数据发生增删，刷新透视表即可。
将源数据从左图调整成右图
通过左图的数据来创建单页字段，建好透视表后双击透视表的右下角即可。
根据外部文件创建透视表
打开属性，有编写sql语句的地方。通过sql语句可以获取指定数据。
select 日期,产品类别,金额 from [数据$]
表示从数据文件中获取指定的三列。
如果数据文件中有三个表
select * from [苏州$] union all select * from[无锡$] union all select * from [昆山$]
表示获取三张表中的所有数据。
可是表中没有城市这一列，而又需要使用到城市列，可以通过sql语句构建一个。
select &#34;苏州&#34; as 城市,* from [苏州$] union all select &#34;无锡&#34; as 城市,* from [无锡$] union all select &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/6ee6bf904f8be7acb04c487569314cb8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-24T15:03:35+08:00" />
<meta property="article:modified_time" content="2018-06-24T15:03:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">王佩丰数据透视表（六到十一讲）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>动态引用数据源区域。</p> 
<p>结合新建名称和offset函数，设置一个动态数据区域。</p> 
<p><img src="https://images2.imgbox.com/b9/7c/QiLNQSau_o.png" width="300" height="125" alt=""><br></p> 
<p>插入数据透视表时引用这个名称即可。</p> 
<p><br></p> 
<p>Gerpivotdata函数可以动态地引用数据透视表中的数据，默认是开启的。</p> 
<p><img src="https://images2.imgbox.com/b7/f3/w9wSoFMg_o.png" width="150" height="150" alt=""><br></p> 
<p>举个例子，在透视表外引用单元格B5，会显示</p> 
<p><img src="https://images2.imgbox.com/77/79/OYGpJP9d_o.png" alt=""><br></p> 
<p>即动态引用常熟区域的彩盒金额，此后如果常熟和彩盒的顺序改变了，该单元格也会动态调整，引用的数据仍然是常熟的彩盒。</p> 
<p>这个动态引用功能可以在数据透视表工具栏的分析——选项处的生成Gerpivotdata处进行设置。</p> 
<p>关闭此功能后再引用数据透视表中的数据就不会动态调整了，会引用固定位置的数据。</p> 
<p>上面的Getpivotdata函数的第二个参数表示A3单元格所在的数据透视表，第一参数表示值字段，后面的参数表示字段和标签。</p> 
<p>练习：通过结合数据有效性和Getpivotdata做出下面的结果。</p> 
<p><img src="https://images2.imgbox.com/f4/6f/l0uvnM1y_o.png" width="300" height="50" alt=""><br></p> 
<p>先通过数据有效性建立序列，再在第四列中写上公式即可。</p> 
<p><img src="https://images2.imgbox.com/8e/82/pWPw09It_o.png" alt=""><br></p> 
<p>参数一后面&amp;""将数值转为文本格式。</p> 
<p><br></p> 
<p>创建单页字段组合。</p> 
<p>有时需要总结好几个工作表中的数据。</p> 
<p><img src="https://images2.imgbox.com/17/41/6OH9m8He_o.png" alt="">比如要对三个月的数据进行汇总。<br></p> 
<p>顺序按下Alt加d加p，可以打开数据透视表和数据透视图向导。</p> 
<p><img src="https://images2.imgbox.com/b2/c8/Ez6GWrfw_o.png" width="550" height="200" alt=""><br></p> 
<p><img src="https://images2.imgbox.com/da/ca/JJXZSQSd_o.png" alt=""><br></p> 
<p>默认设置数据源的第一列是透视表的行字段，其他列都是列字段，通过切换页字段可以显示不同工作表的数据。</p> 
<p>不过这样做出来的透视表自由度小。</p> 
<p><br></p> 
<p>自定义页字段</p> 
<p>向导中将创建单页字段改成自定义页字段。</p> 
<p><img src="https://images2.imgbox.com/d1/67/6zxEe0Oy_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/ba/96/Ux4yglpJ_o.png" width="250" height="350" alt=""><br></p> 
<p><img src="https://images2.imgbox.com/33/2c/2Gkasaos_o.png" width="300" height="100" alt=""><br></p> 
<p><br></p> 
<p>多文件合并</p> 
<p>现在有两个文件，南京和苏州的数据，每个文件有三个工作表。</p> 
<p>方法和前面差不多，向导处选自定义页字段</p> 
<p><img src="https://images2.imgbox.com/e9/5a/dEsBDqgA_o.png" width="200" height="300" alt=""><img src="https://images2.imgbox.com/40/6c/XEfnzh6y_o.png" alt=""><br></p> 
<p>得到的透视表中有城市和月份两个页字段。</p> 
<p><img src="https://images2.imgbox.com/2a/8c/Nd8rux6y_o.png" width="300" height="150" alt=""><br></p> 
<p><br></p> 
<p>在上面的创建单页字段和自定义页字段中，可以结合新建名称，这样创建的透视表是动态的。</p> 
<p>比如将一个文件中的三个工作表中的数据都用offset新建名称</p> 
<p>在相同中选定区域时直接使用。</p> 
<p><img src="https://images2.imgbox.com/1a/ec/brQA8Y6T_o.png" width="300" height="80" alt=""><img src="https://images2.imgbox.com/ce/83/NK8XGnqe_o.png" width="200" height="300" alt=""><br></p> 
<p>若源数据发生增删，刷新透视表即可。</p> 
<p><br></p> 
<p>将源数据从左图调整成右图</p> 
<p><img src="https://images2.imgbox.com/8f/e5/bIUt36pv_o.png" width="550" height="150" alt=""><br></p> 
<p>通过左图的数据来创建单页字段，建好透视表后双击透视表的右下角即可。</p> 
<p><img src="https://images2.imgbox.com/40/37/H3boLHXG_o.png" alt=""><br></p> 
<p><img src="https://images2.imgbox.com/54/f0/xuzDES9v_o.png" alt=""><img src="https://images2.imgbox.com/ed/94/sstXsGGT_o.png" width="250" height="150" alt=""><br></p> 
<p><br></p> 
<p>根据外部文件创建透视表</p> 
<p><img src="https://images2.imgbox.com/7d/1a/RzwMrtDJ_o.png" alt=""><br></p> 
<p><img src="https://images2.imgbox.com/3d/c2/nxK6j1sr_o.png" width="500" height="200" alt=""><br></p> 
<p><img src="https://images2.imgbox.com/2d/a9/8QuHYnSV_o.png" width="150" height="200" alt=""><img src="https://images2.imgbox.com/95/cf/5zczLnkr_o.png" width="150" height="200" alt=""><br></p> 
<p>打开属性，有编写sql语句的地方。通过sql语句可以获取指定数据。</p> 
<p>select 日期,产品类别,金额 from [数据$]</p> 
<p>表示从数据文件中获取指定的三列。</p> 
<p>如果数据文件中有三个表</p> 
<p>select * from [苏州$] union all select * from[无锡$] union all select * from [昆山$]</p> 
<p>表示获取三张表中的所有数据。</p> 
<p>可是表中没有城市这一列，而又需要使用到城市列，可以通过sql语句构建一个。</p> 
<p>select "苏州" as 城市,* from [苏州$] union all select "无锡" as 城市,* from [无锡$] union all select "昆山" as 城市,* from [昆山$]</p> 
<p>通过这个语句建立的透视表就有了城市字段。</p> 
<p><img src="https://images2.imgbox.com/60/11/9y2zvB0p_o.png" alt=""><br></p> 
<p>将城市字段设置为列字段。</p> 
<p><img src="https://images2.imgbox.com/0c/9d/UAy8OpPG_o.png" alt=""><br></p> 
<p><br></p> 
<p>多个工作表的数据结构不相同，通过sql语句选择指定数据。</p> 
<p><img src="https://images2.imgbox.com/51/ed/t7znMqVP_o.png" width="400" height="100" alt=""><br></p> 
<p><br></p> 
<p>两个工作表差异很大时</p> 
<p><img src="https://images2.imgbox.com/22/15/rlSw15bD_o.png" alt=""><br></p> 
<p>左图是表一实际情况，右图是表二计划目标，做出下面这个效果，即将实际和计划进行比较。</p> 
<p><img src="https://images2.imgbox.com/d2/c5/EPH4tjGf_o.png" alt=""><br></p> 
<p>将表二的数据移植到表一，实际效果会是如图，新增了类型</p> 
<p><img src="https://images2.imgbox.com/5f/c3/PX7RYRIR_o.png" alt=""><br></p> 
<p>sql语句应该写成</p> 
<p>select "实际完成" as 类型,* from [销售数据$] union all select "计划完成" as 类型,null,null,null,null,null,null,所属区域,null,null,金额,null from [销售计划$]</p> 
<p>得到透视表后，将区域设置为列字段，类型设置为行字段，金额设置为值字段，通过计算项求出计划和实际的差额，最后再调整一下即可得到上面的效果。</p> 
<p><br></p> 
<p>上面那个例子只是给出了区域的计划销售额，这里还有个例子，给出了销售部门，产品类别和销售区域的计划金额。</p> 
<p><img src="https://images2.imgbox.com/3c/6e/6zucpMkn_o.png" alt=""><br></p> 
<p><img src="https://images2.imgbox.com/65/02/E4cBsK3M_o.png" alt=""><br></p> 
<p>要求做出下面这种效果</p> 
<p><img src="https://images2.imgbox.com/de/8b/mdjHeSya_o.png" width="550" height="250" alt=""><br></p> 
<p>结合两个数据表</p> 
<p><img src="https://images2.imgbox.com/71/fe/gX00q4W6_o.png" width="520" height="180" alt=""><br></p> 
<p>写出sql语句。</p> 
<p><img src="https://images2.imgbox.com/a3/0f/m4y6N9wD_o.png" alt=""><br></p> 
<p>创建好透视表之后，将指定的行列值字段放入即可，再通过计算项得出实际和计划的差额，再通过条件格式调整透视表格式，插入指定切片器即可。</p> 
<p><br></p> 
<p>跨文件创建透视表</p> 
<p>有三个数据文件，南京、苏州和销售计划，城市文件分为三个工作表</p> 
<p><img src="https://images2.imgbox.com/b7/4e/UnUAYSF2_o.png" alt=""><img src="https://images2.imgbox.com/f2/4e/b2FY7dtR_o.png" alt=""><br></p> 
<p>左图是城市的数据结构，右图是计划的数据结构。</p> 
<p><img src="https://images2.imgbox.com/17/e8/tT1rkvpo_o.png" width="450" height="100" alt=""><img src="https://images2.imgbox.com/56/61/94VJZ8e8_o.png" width="250" height="100" alt=""></p> 
<p>结合起来如图。</p> 
<p><img src="https://images2.imgbox.com/fa/f2/ZsBEkPq4_o.png" width="500" height="150" alt=""><br></p> 
<p>所以sql语句需要为城市文件新建三个列，为计划文件新建一个列。</p> 
<p><img src="https://images2.imgbox.com/02/65/aPXPKyBq_o.png" width="550" height="100" alt=""><br></p> 
<p>因为最终是根据sql语句中提供的文件地址来引用数据，所以源数据可以随意引用一个不相关数据。</p> 
<p>得到透视表后设定相关字段即可。</p> 
<p><img src="https://images2.imgbox.com/54/e1/NSjNbaX6_o.png" width="350" height="125" alt=""><br></p> 
<p><br></p> 
<p>关系型表合并</p> 
<p><img src="https://images2.imgbox.com/de/99/zib5ioa0_o.png" width="450" height="125" alt=""><img src="https://images2.imgbox.com/96/72/fhyhWehP_o.png" width="180" height="125" alt=""></p> 
<p>左图和右图就是关系型表，通过产品类型和品名关联，总金额通过左图的数量乘右图的单价得出。</p> 
<p>通过sql语句联结两个表</p> 
<p>select [数据$].*,[产品信息$].产品单价 from [数据$] left join [产品信息$] on [数据$].产品类别 = [产品信息$].品名<br></p> 
<p>获得数据透视表后通过计算字段，将单价和数量相乘，得出销量。</p> 
<p><img src="https://images2.imgbox.com/23/2e/LrVpULMI_o.png" width="400" height="150" alt=""><br></p> 
<p>sql语句可以使用缩写</p> 
<p><img src="https://images2.imgbox.com/08/a7/TU8561iy_o.png" alt=""><br></p> 
<p><br></p> 
<p>现在有三个关联表，分别是数据，产品信息，促销信息，通过产品类型和品名关联。</p> 
<p>sql语句如下：</p> 
<p></p> 
<p>select [数据$].*,[产品信息$].产品单价,[促销信息$].折扣 from [数据$],[产品信息$],[促销信息$] where [数据$].产品类别 = [产品信息$].品名, [数据$].产品类别=[促销信息$].品名</p> 
<p>此语句将数据工作表的所有数据和另外两个工作表的产品单价和折扣列结合在一起。</p> 
<p><img src="https://images2.imgbox.com/9f/77/QAwhnfjS_o.png" width="450" height="125" alt=""><br></p> 
<p><br></p> 
<p>使用Microsoft query工具</p> 
<p>在工具栏点击数据——自其他来源——来自Microsoft query，选择excel file，打开指定的文件</p> 
<p><img src="https://images2.imgbox.com/d2/9b/psyZRwYp_o.png" width="200" height="200" alt="">记得在选项处勾上系统表。<br></p> 
<p>添加表到query中</p> 
<p><img src="https://images2.imgbox.com/c1/c0/XKNBatj0_o.png" width="120" height="120" alt=""><br></p> 
<p>选择数据，将数据导入文件做成透视表。</p> 
<p><img src="https://images2.imgbox.com/d2/65/LZ6UxeHQ_o.png" width="200" height="200" alt=""><img src="https://images2.imgbox.com/58/df/vyE0vfMq_o.png" alt=""><img src="https://images2.imgbox.com/2e/5b/rXhgdUWo_o.png" width="150" height="150" alt=""><br></p> 
<p><br></p> 
<p>数据文件中有三个城市的数据，做出以下透视图。</p> 
<p><img src="https://images2.imgbox.com/9b/5f/xByDKfoa_o.png" alt=""><br></p> 
<p>sql语句：</p> 
<p>select "昆山" as 城市,* from [昆山$] where (数量&lt;20) union all select "苏州" as 城市,* from [苏州$] where (数量&lt;20) union all select "无锡" as 城市,* from [无锡$] where (数量&lt;20)<br></p> 
<p>通过where语句筛选出数据中数量小于20的数据。</p> 
<p>将指定字段放到透视表中即可。</p> 
<p><br></p> 
<p>使用Microsoft query工具结合两个关系型表，创建透视表。</p> 
<p><img src="https://images2.imgbox.com/6e/c2/ixScrlyd_o.png" width="200" height="100" alt=""><br></p> 
<p>将关联列连接起来，不连的话会得到一个笛卡尔积。</p> 
<p>选中数据中的全部和产品信息中的单价，创建透视表，新建一个字段计算销量 = 数量*单价</p> 
<p><img src="https://images2.imgbox.com/b4/2c/RUjy9HnR_o.png" width="450" height="150" alt=""><br></p> 
<p>query中还可以设置条件对数据进行过滤。</p> 
<p><br></p> 
<p>PowerPivot工具的使用，xlsx格式下才能使用。</p> 
<p>打开一个数据文件，添加到数据模型</p> 
<p><img src="https://images2.imgbox.com/8a/10/tVtrVNei_o.png" width="200" height="100" alt=""><br></p> 
<p>将数据加载到PowerPivot中</p> 
<p><img src="https://images2.imgbox.com/71/6e/GXLVuOir_o.png" width="550" height="200" alt="">、<br></p> 
<p>可以创建透视表。</p> 
<p><img src="https://images2.imgbox.com/65/ac/KvWGZlTg_o.png" width="120" height="200" alt=""><br></p> 
<p>如果源数据中有日期的话会自动创建年和季度和月</p> 
<p><img src="https://images2.imgbox.com/a6/ce/N7P4tvCi_o.png" alt=""><br></p> 
<p><br></p> 
<p>从excel文件中导入数据到Powerpivot</p> 
<p><img src="https://images2.imgbox.com/0f/17/OWVgEIii_o.png" width="350" height="150" alt=""><br></p> 
<p><img src="https://images2.imgbox.com/c7/64/4y5w6no8_o.png" width="400" height="125" alt=""><br></p> 
<p><br></p> 
<p>当数据文件中有多个关系型表时。</p> 
<p><img src="https://images2.imgbox.com/15/41/3MsKC6oh_o.png" width="300" height="125" alt=""><br></p> 
<p>导入含有关系型表的数据。</p> 
<p><img src="https://images2.imgbox.com/ae/27/QkCEfeGc_o.png" width="350" height="150" alt=""><br></p> 
<p>在关系图中连接数据表间的关系</p> 
<p><img src="https://images2.imgbox.com/de/c7/mTMpIzXH_o.png" width="350" height="300" alt=""><br></p> 
<p>新建透视表，设置好行列标签</p> 
<p><img src="https://images2.imgbox.com/53/42/yoGUHM75_o.png" width="380" height="120" alt=""><br></p> 
<p><br></p> 
<p>通过新建度量值计算出总金额</p> 
<p><img src="https://images2.imgbox.com/ae/e9/UH7zWIiA_o.png" width="450" height="200" alt=""><br></p> 
<p><img src="https://images2.imgbox.com/08/6d/A29diMGM_o.png" width="500" height="120" alt=""><br></p> 
<p><br></p> 
<p>另一种方法计算金额</p> 
<p>重新调整表间关系</p> 
<p><img src="https://images2.imgbox.com/cb/ef/ROSOlAXE_o.png" width="250" height="200" alt=""><br></p> 
<p>在数据工作表中添加三个新列，将产品信息的产品单价和促销信息的折扣列关联过来，最后计算出金额</p> 
<p><img src="https://images2.imgbox.com/32/a8/41vhlhF0_o.png" alt=""><br></p> 
<p><img src="https://images2.imgbox.com/f4/0e/igYNqPBO_o.png" alt=""><br></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f488510f1e76735556bb70bab8adfadd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">王佩丰excel2010基础教程学习笔记（第一讲到第五讲）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/17b9a8967ec43a49faeaf38f7f697301/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">利用python进行数据分析学习笔记1(pandas入门)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>