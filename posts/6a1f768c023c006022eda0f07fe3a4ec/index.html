<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DHCP简介与部署 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="DHCP简介与部署" />
<meta property="og:description" content="一、DHCP简介 1、什么是DHCP？
DHCP是一个自动分配IP地址的服务器，它可一避免IP冲突，提高IP地址的利用率。
2、DHCP原理
（1）客户端广播发送DHCP discover数据包，请求IP地址，这里的请求中还包含客户端的MAC地址。
（2）服务端响应DHCP offer包，发送一个IP地址，但是没有网关、DNS等参数。是以单播形式发送给客户端。
（3）客户端发送DHCP request广播包，确认使用这个IP地址。广播
（4）服务器发送DHCP ACK广播包，里面包含，网卡的详细参数，比如DNS、子网掩码、网关等。单播
（5）客户端发送DHCP request广播包，请求继续使用这个IP，这是在IP租约到50%时发送的。如服务器无响应，则会在87.5%时在发送一次请求，如还无响应，客户端就会释放这个IP地址。
3、什么是DHCP攻击？
DHCP是自动分配IP地址的，只要有人向它发送DHCP discover广播包，它就会从地址池中取出一个IP地址而不加验证给发送者，这就会使得黑客利用这一漏洞，不停的伪造MAC地址发送给DHCP服务器请求IP地址，直到地址池里的IP地址耗光，使得有的主机断网。防止这种攻击手段，可以在交换机端口绑定MAC地址。
还有就是黑客可以在自己的电脑中搭建DHCP服务器，只要有人发出请求DHCP discover广播包获取IP地址，如果黑客的DHCP服务器抢先收到客户端发出的请求，黑客的DHCP服务器就会把自己设置的IP地址发动给客户端，那么客户端就会优先接受这个IP地址。可以让DHCP服务端的端口发送offer广播包，其它主机的端口不允许发送此包。
当然也可以使用企业级交换机，因为我们平常用的是傻瓜式的交换机，没有企业级的交换机功能多。
4、在没有DHCP服务器或者是DHCP服务器无响应时，主机会自己分配一个169.254.x.x/16这个网段的IP地址，这时全球统一的无效IP地址，仅用于临时内网的通信。
二、DHCP部署
本实验是在vmwar虚拟机里部署的，使用的是一个win7和win2008R搭建的，这两个主机在同一个网段。还有就是在部署前还要把win2008r配置静态IP地址（在使用这一网段时请把VMware里自带的DHCP关掉，否者会造成实验失败。如果实验没成功也有可能是防火墙没关掉。）
1、这是win7的初始化界面，里面的IP地址是169.254.x.x/16网段的，前面已经讲过了，在这里我们可以看成是没有获取到IP地址的。
2、接下来我们在windows Server 2008 r里面安装DHCP服务器。打开服务管理器——角色——添加角色。
3、下一步。
4、选择DHCP服务器，下一步。
5、下一步。这里的IP地址就是我们在win2008r上设置的静态IP。
6、这里的父域是我随便设的，首选DNS服务器可以是运营商给你公司的，备用服务器可设可不设，最好设置。这里的首选与备选我选择的是电信的和谷歌的。下一步。
7、这里的WINS服务器已经过时了，可以选择不需要，但不排除一些公司使用这一服务器。下一步。
8、作用域里面的名称是我随便设的。起始地址与结束地址就是地址池，就是DHCP服务器从其抽出分配给主机的IP地址。在下面就是IP地址租约，这里我设置的是8天。
9、这里我选择的是禁用。因为是实验，用不到我就禁用了。下一不。
10、检查一下是否是你设置的信息，再点击安装。
11、安装成功。
12、打开DHCP服务器。
13、打开IPv4——作用域——地址池，可以看到我们设置的IP地址范围，
14、下一个是地址租用，也就是IP地址租期到期时间。
15、保留地址。
16、这里是设置的DNS和备用的DNS，还有DNS域名。
17、这里的筛选器是用来给主机是否分配IP地址的，可用可不用。
18、设置允许MAC为这个值的主机可以分配IP地址。这一步我就不做了。
19、拒绝与之相反，这一步我也不做了。
20、在win7运行以下命令，作用是释放IP。
21、重新获取IP，这就是我们在DHCP服务器地址池中获取的IP，这里的IP地址是我设置的保留地址，如果我在保留地址中不设置win7的MAC地址，就不会分配这个IP地址，而是从地址池中选取。
在20、21步中，当然也可以用其它方法。在网络共享中心——更改适配器设置——本地连接——右键禁用——右键启用，就可以刷新IP地址。
22、还有就是服务器备份，把服务器备份到移动介质里面，防止DHCP服务器崩溃没有备份。
23、还有就是可以建立多个作用域，分配多分网段，这就涉及到了DHCP中继技术。中继技术就是设立一个DHCP relay充当一个中间人，来保持客户端与服务器之间的通信。客户端与Relay之间是广播形式通信，DHCP服务器与Relay是单播形式通信。
结束" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/6a1f768c023c006022eda0f07fe3a4ec/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-22T10:00:49+08:00" />
<meta property="article:modified_time" content="2020-08-22T10:00:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DHCP简介与部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="DHCP_0"></a>一、DHCP简介</h2> 
<p>1、什么是DHCP？<br>         DHCP是一个自动分配IP地址的服务器，它可一避免IP冲突，提高IP地址的利用率。</p> 
<p>2、DHCP原理<br> （1）客户端广播发送DHCP discover数据包，请求IP地址，这里的请求中还包含客户端的MAC地址。<br> （2）服务端响应DHCP offer包，发送一个IP地址，但是没有网关、DNS等参数。是以单播形式发送给客户端。<br> （3）客户端发送DHCP request广播包，确认使用这个IP地址。广播<br> （4）服务器发送DHCP ACK广播包，里面包含，网卡的详细参数，比如DNS、子网掩码、网关等。单播<br> （5）客户端发送DHCP request广播包，请求继续使用这个IP，这是在IP租约到50%时发送的。如服务器无响应，则会在87.5%时在发送一次请求，如还无响应，客户端就会释放这个IP地址。</p> 
<p>3、什么是DHCP攻击？<br>         DHCP是自动分配IP地址的，只要有人向它发送DHCP discover广播包，它就会从地址池中取出一个IP地址而不加验证给发送者，这就会使得黑客利用这一漏洞，不停的伪造MAC地址发送给DHCP服务器请求IP地址，直到地址池里的IP地址耗光，使得有的主机断网。防止这种攻击手段，可以在交换机端口绑定MAC地址。<br>         还有就是黑客可以在自己的电脑中搭建DHCP服务器，只要有人发出请求DHCP discover广播包获取IP地址，如果黑客的DHCP服务器抢先收到客户端发出的请求，黑客的DHCP服务器就会把自己设置的IP地址发动给客户端，那么客户端就会优先接受这个IP地址。可以让DHCP服务端的端口发送offer广播包，其它主机的端口不允许发送此包。<br>         当然也可以使用企业级交换机，因为我们平常用的是傻瓜式的交换机，没有企业级的交换机功能多。</p> 
<p>4、在没有DHCP服务器或者是DHCP服务器无响应时，主机会自己分配一个169.254.x.x/16这个网段的IP地址，这时全球统一的无效IP地址，仅用于临时内网的通信。</p> 
<p>二、DHCP部署<br>         本实验是在vmwar虚拟机里部署的，使用的是一个win7和win2008R搭建的，这两个主机在同一个网段。还有就是在部署前还要把win2008r配置静态IP地址（在使用这一网段时请把VMware里自带的DHCP关掉，否者会造成实验失败。如果实验没成功也有可能是防火墙没关掉。）<br><br> 1、这是win7的初始化界面，里面的IP地址是169.254.x.x/16网段的，前面已经讲过了，在这里我们可以看成是没有获取到IP地址的。<br> <img src="https://images2.imgbox.com/5a/d6/VPO4Cp2g_o.png" alt="在这里插入图片描述"><br><br> 2、接下来我们在windows Server 2008 r里面安装DHCP服务器。打开服务管理器——角色——添加角色。<img src="https://images2.imgbox.com/78/7a/tugAHmrf_o.png" alt="在这里插入图片描述"><br><br> 3、下一步。<br> <img src="https://images2.imgbox.com/3d/2e/GlaIZWWc_o.png" alt="在这里插入图片描述"><br><br> 4、选择DHCP服务器，下一步。<br> <img src="https://images2.imgbox.com/ca/10/VcgaImMm_o.png" alt="在这里插入图片描述"><br><br> 5、下一步。这里的IP地址就是我们在win2008r上设置的静态IP。<br> <img src="https://images2.imgbox.com/30/81/9qgzmUCt_o.png" alt="在这里插入图片描述"><br><br> 6、这里的父域是我随便设的，首选DNS服务器可以是运营商给你公司的，备用服务器可设可不设，最好设置。这里的首选与备选我选择的是电信的和谷歌的。下一步。<br> <img src="https://images2.imgbox.com/a3/7a/mQJMLegG_o.png" alt="在这里插入图片描述"><br><br> 7、这里的WINS服务器已经过时了，可以选择不需要，但不排除一些公司使用这一服务器。下一步。<br> <img src="https://images2.imgbox.com/14/78/yoUK9nqD_o.png" alt="在这里插入图片描述"><br><br> 8、作用域里面的名称是我随便设的。起始地址与结束地址就是地址池，就是DHCP服务器从其抽出分配给主机的IP地址。在下面就是IP地址租约，这里我设置的是8天。<br> <img src="https://images2.imgbox.com/7f/59/QxjNSYY0_o.png" alt="在这里插入图片描述"><br><br> 9、这里我选择的是禁用。因为是实验，用不到我就禁用了。下一不。<br> <img src="https://images2.imgbox.com/84/a4/IePT2MpC_o.png" alt="在这里插入图片描述"><br><br> 10、检查一下是否是你设置的信息，再点击安装。<br> <img src="https://images2.imgbox.com/3e/4b/4vkeWlO6_o.png" alt="在这里插入图片描述"><br><br> 11、安装成功。<br> <img src="https://images2.imgbox.com/2a/8d/bc17LIzl_o.png" alt="在这里插入图片描述"><br><br> 12、打开DHCP服务器。</p> 
<p><img src="https://images2.imgbox.com/f8/8f/ZqbFvfFe_o.png" alt="在这里插入图片描述"><br><br> 13、打开IPv4——作用域——地址池，可以看到我们设置的IP地址范围，</p> 
<p><img src="https://images2.imgbox.com/86/f9/iApk5uKf_o.png" alt="在这里插入图片描述"><br><br> 14、下一个是地址租用，也就是IP地址租期到期时间。<br> <img src="https://images2.imgbox.com/84/b4/bJGM0FS9_o.png" alt="在这里插入图片描述"><br><br> 15、保留地址。<br> <img src="https://images2.imgbox.com/0c/02/nx27Bzbn_o.png" alt="在这里插入图片描述"><br><br> <img src="https://images2.imgbox.com/b7/76/V70z5PVG_o.png" alt="在这里插入图片描述"><br><br> 16、这里是设置的DNS和备用的DNS，还有DNS域名。<br> <img src="https://images2.imgbox.com/eb/9a/DmaYdpNc_o.png" alt="在这里插入图片描述"><br><br> 17、这里的筛选器是用来给主机是否分配IP地址的，可用可不用。<br> <img src="https://images2.imgbox.com/e3/91/2wdJ8DaX_o.png" alt="在这里插入图片描述"><br><br> 18、设置允许MAC为这个值的主机可以分配IP地址。这一步我就不做了。<br> <img src="https://images2.imgbox.com/87/f1/x3qnBV3I_o.png" alt="在这里插入图片描述"><br><br> 19、拒绝与之相反，这一步我也不做了。<br> <img src="https://images2.imgbox.com/17/f0/ZX0SrRSJ_o.png" alt="在这里插入图片描述"><br><br> 20、在win7运行以下命令，作用是释放IP。<br> <img src="https://images2.imgbox.com/5f/7d/pW1b9zg5_o.png" alt="在这里插入图片描述"><br><br> 21、重新获取IP，这就是我们在DHCP服务器地址池中获取的IP，这里的IP地址是我设置的保留地址，如果我在保留地址中不设置win7的MAC地址，就不会分配这个IP地址，而是从地址池中选取。</p> 
<p><img src="https://images2.imgbox.com/8b/98/qfqwdURD_o.png" alt="在这里插入图片描述"><br>         在20、21步中，当然也可以用其它方法。在网络共享中心——更改适配器设置——本地连接——右键禁用——右键启用，就可以刷新IP地址。<br> <br><br> 22、还有就是服务器备份，把服务器备份到移动介质里面，防止DHCP服务器崩溃没有备份。<br> <img src="https://images2.imgbox.com/ae/f5/KS9FhVxQ_o.png" alt="在这里插入图片描述"><br><br> 23、还有就是可以建立多个作用域，分配多分网段，这就涉及到了DHCP中继技术。中继技术就是设立一个DHCP relay充当一个中间人，来保持客户端与服务器之间的通信。客户端与Relay之间是广播形式通信，DHCP服务器与Relay是单播形式通信。</p> 
<p><em>结束</em></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/10442c2793aff996b5297be6f6894f31/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RAID技术详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/270854c4b4da1915a75a77a265bde857/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">效率 | zotero和endnote互相导入</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>