<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在vs中通过函数检测是否内存泄漏 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在vs中通过函数检测是否内存泄漏" />
<meta property="og:description" content="1. 判断方法 在程序vs编写代码，在想要追踪的方法结尾，使用_CrtDumpMemoryLeaks()函数可以检测是否内存泄漏。推荐在main函数结尾使用，追踪范围更大。
#include &lt;iostream&gt; int main() { char* c1 = (char*)malloc(15); delete c1; char* c = (char*)malloc(15); char* c3 = (char*)malloc(15); _CrtDumpMemoryLeaks(); } 通过f5调试执行完成后，在输出窗口，注意是输出窗口，不是控制台窗口,看到如下提示就表示有内存泄漏了。
Detected memory leaks! Dumping objects -&gt; {153} normal block at 0x00F04D68, 15 bytes long. Data: &lt; &gt; CD CD CD CD CD CD CD CD CD CD CD CD CD CD CD {152} normal block at 0x00F092F0, 15 bytes long. Data: &lt; &gt; CD CD CD CD CD CD CD CD CD CD CD CD CD CD CD Object dump complete." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/61596875cd6c94603ad6f69e82f75093/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-06T16:04:55+08:00" />
<meta property="article:modified_time" content="2020-05-06T16:04:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在vs中通过函数检测是否内存泄漏</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="1__1"></a>1. 判断方法</h4> 
<blockquote> 
 <p>在程序vs编写代码，在想要追踪的方法结尾，使用_CrtDumpMemoryLeaks()函数可以检测是否内存泄漏。推荐在main函数结尾使用，追踪范围更大。</p> 
</blockquote> 
<pre><code>#include &lt;iostream&gt;
int main()
{
	char* c1 = (char*)malloc(15);
	delete c1;
	char* c = (char*)malloc(15);
	char* c3 = (char*)malloc(15);
	_CrtDumpMemoryLeaks();
}
</code></pre> 
<blockquote> 
 <p>通过f5调试执行完成后，在输出窗口，注意是输出窗口，不是控制台窗口,看到如下提示就表示有内存泄漏了。</p> 
</blockquote> 
<pre><code>Detected memory leaks!
Dumping objects -&gt;
{153} normal block at 0x00F04D68, 15 bytes long.
 Data: &lt;               &gt; CD CD CD CD CD CD CD CD CD CD CD CD CD CD CD 
{152} normal block at 0x00F092F0, 15 bytes long.
 Data: &lt;               &gt; CD CD CD CD CD CD CD CD CD CD CD CD CD CD CD 
Object dump complete.
</code></pre> 
<h4><a id="2__24"></a>2. 上述内容涵义(从第三行开始看起)</h4> 
<blockquote> 
 <p>内存分配编号（在大括号内）。 <br> 块类型（普通、客户端或 CRT）。<br> 十六进制形式的内存位置。 <br> 以字节为单位的块大小。 <br> 前 16 字节的内容（亦为十六进制）</p> 
</blockquote> 
<h4><a id="3__31"></a>3. 如何定位哪里内存泄漏？</h4> 
<h4><a id="31__CrtSetBreakAllocf5_32"></a>3.1 通过_CrtSetBreakAlloc()函数，把内存分配编号作为参数，就会在f5执行时停止在问题位置。</h4> 
<pre><code>#include &lt;iostream&gt;
int main()
{
	_CrtSetBreakAlloc(152);
	_CrtSetBreakAlloc(153);
	char* c1 = (char*)malloc(15);
	delete c1;
	char* c = (char*)malloc(15);
	char* c3 = (char*)malloc(15);
	_CrtDumpMemoryLeaks();
}
</code></pre> 
<h4><a id="32__CrtSetDbgFlag_46"></a>3.2 通过_CrtSetDbgFlag()函数定位文件和位置</h4> 
<pre><code>#include &lt;iostream&gt;
#define new new(_CLIENT_BLOCK, __FILE__, __LINE__) 

int main()
{
	_CrtSetDbgFlag(_CrtSetDbgFlag(_CRTDBG_REPORT_FLAG) | _CRTDBG_LEAK_CHECK_DF);
	int* p = new int;
	_CrtDumpMemoryLeaks();
}
</code></pre> 
<p>看到类似如下内容</p> 
<blockquote> 
 <p>Detected memory leaks!<br> Dumping objects -&gt;<br> C:\Users\12250\source\repos\OnlyForTest\OnlyForTest2\main.cpp(17) : {151} client block at 0x00B7C270, subtype 0, 4 bytes long.<br> Data: &lt; &gt; CD CD CD CD<br> Object dump complete.</p> 
</blockquote> 
<p>就表示是在我的解决方案“OnlyForTest”下的项目“OnlyForTest2”下的main.cpp文件第17行产生内存泄漏了。</p> 
<p><font color="red" size="5">最后, 觉得文章对你有用的话,给个下面的三连(点赞,收藏,打赏)吧!</font></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6936ee7fa44f57aa90f2d27a4f2f2084/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">初识Wayland（X、Mir）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/edf803626765b6ef0779da31a568444c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">树莓派4B安装散热片和小风扇以及亚克力外壳安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>