<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ClickHouseV20.10 详细集群部署方案 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ClickHouseV20.10 详细集群部署方案" />
<meta property="og:description" content="基本介绍：
ClickHouse 来自俄罗斯最大的搜索公司Yandex，配置文件中可以看到Yandex的样子，于2016年开源。 ClickHouse是面向OLAP的分布式列式DBMS，OLAP（在线联机分析）性能优秀，市场反应非常强烈。 面向列的数据库更适合于OLAP方案（大量查询场景，处理速度至少提升100倍），高逼格的ClickHouse在SSD上性能表现更佳。
官网地址：https://clickhouse.tech 源码地址：GitHub - ClickHouse/ClickHouse: ClickHouse® is a free analytics DBMS for big data
主要特性：
真正的面向列的DBMS实时数据更新SQL语法支持多核并行处理数据高效压缩分布式处理数据复制完整性丰富的索引集群式管理可直接读取MySQL数据适合于在线实时查询支持近似预估计算 目前缺点：
不支持二级索引不支持事物缺乏全面的UPDATE|DELETE的实现 应用场景：
海量数据分析、报表和监控 一、先来说一下，ClickHouse为啥快
ClickHouse有多少CPU，吃多少资源，所以飞快；ClickHouse不支持事务，不存在隔离级别。这里要额外说一下，有人觉得，你一个数据库都不支持事务，不支持ACID还玩个毛。ClickHouse的定位是分析性数据库，而不是严格的关系型数据库。又有人要问了，数据都不一致，统计个毛。举个例子，汽车的油表是100%准确么？为了获得一个100%准确的值，难道每次测量你都要停车检查么？统计数据的意义在于用大量的数据看规律，看趋势，而不是100%准确。IO方面，MySQL是行存储，ClickHouse是列存储，后者在count()这类操作天然有优势，同时，在IO方面，MySQL需要大量随机IO，ClickHouse基本是顺序IO。有人可能觉得上面的数据导入的时候，数据肯定缓存在内存里了，这个的确，但是ClickHouse基本上是顺序IO，用过就知道了，对IO基本没有太高要求，当然，磁盘越快，上层处理越快，但是99%的情况是，CPU先跑满了（数据库里太少见了，大多数都是IO不够用）。 环境配置描述：
服务器：CentOS Linux release 7.4.1708 (Core) * 5台 生产环境 安装依赖：
yum install -y curl pygpgme yum-utils coreutils epel-release Yum安装：
sudo yum -y install yum-utils sudo rpm --import https://repo.clickhouse.tech/CLICKHOUSE-KEY.GPG sudo yum-config-manager --add-repo https://repo.clickhouse.tech/rpm/stable/x86_64 yum -y install clickhouse-server clickhouse-client clickhouse-server-common clickhouse-compressor 运行clickhouse-server：
systemctl restart clickhouse-server.service 或者 /etc/init." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/0b0232e9b951cbb48c94b7084339fc98/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-07T16:41:24+08:00" />
<meta property="article:modified_time" content="2022-06-07T16:41:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ClickHouseV20.10 详细集群部署方案</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p><strong>基本介绍：</strong></p> 
<p>ClickHouse 来自俄罗斯最大的搜索公司Yandex，配置文件中可以看到Yandex的样子，于2016年开源。 ClickHouse是面向OLAP的分布式列式DBMS，OLAP（在线联机分析）性能优秀，市场反应非常强烈。 面向列的数据库更适合于OLAP方案（大量查询场景，处理速度至少提升100倍），高逼格的ClickHouse在SSD上性能表现更佳。</p> 
<p>官网地址：<a href="https://clickhouse.tech/" rel="nofollow" title="https://clickhouse.tech">https://clickhouse.tech</a> </p> 
<p>源码地址：<a href="https://github.com/ClickHouse/ClickHouse" title="GitHub - ClickHouse/ClickHouse: ClickHouse® is a free analytics DBMS for big data">GitHub - ClickHouse/ClickHouse: ClickHouse® is a free analytics DBMS for big data</a></p> 
<p><img alt="" height="464" src="https://images2.imgbox.com/ff/4a/DVZRRLDA_o.png" width="1154"></p> 
<p><strong>主要特性：</strong></p> 
<ul><li>真正的面向列的DBMS</li><li>实时数据更新</li><li>SQL语法支持</li><li>多核并行处理</li><li>数据高效压缩</li><li>分布式处理</li><li>数据复制完整性</li><li>丰富的索引</li><li>集群式管理</li><li>可直接读取MySQL数据</li><li>适合于在线实时查询</li><li>支持近似预估计算</li></ul> 
<p><strong>目前缺点：</strong></p> 
<ul><li>不支持二级索引</li><li>不支持事物</li><li>缺乏全面的UPDATE|DELETE的实现</li></ul> 
<p><strong>应用场景：</strong></p> 
<ul><li>海量数据分析、报表和监控</li></ul> 
<p><strong>一、先来说一下，ClickHouse为啥快</strong></p> 
<ol><li>ClickHouse有多少CPU，吃多少资源，所以飞快；</li><li>ClickHouse不支持事务，不存在隔离级别。这里要额外说一下，有人觉得，你一个数据库都不支持事务，不支持ACID还玩个毛。ClickHouse的定位是分析性数据库，而不是严格的关系型数据库。又有人要问了，数据都不一致，统计个毛。举个例子，汽车的油表是100%准确么？为了获得一个100%准确的值，难道每次测量你都要停车检查么？统计数据的意义在于用大量的数据看规律，看趋势，而不是100%准确。</li><li>IO方面，MySQL是行存储，ClickHouse是列存储，后者在count()这类操作天然有优势，同时，在IO方面，MySQL需要大量随机IO，ClickHouse基本是顺序IO。</li><li>有人可能觉得上面的数据导入的时候，数据肯定缓存在内存里了，这个的确，但是ClickHouse基本上是顺序IO，用过就知道了，对IO基本没有太高要求，当然，磁盘越快，上层处理越快，但是99%的情况是，CPU先跑满了（数据库里太少见了，大多数都是IO不够用）。</li></ol> 
<p><strong>环境配置描述：</strong></p> 
<p>服务器：CentOS Linux release 7.4.1708 (Core) * 5台 生产环境 </p> 
<p></p> 
<p><strong>安装依赖：</strong></p> 
<pre><code>yum install -y curl pygpgme yum-utils coreutils epel-release</code></pre> 
<p><strong>Yum安装：</strong></p> 
<pre><code>sudo yum -y install yum-utils
sudo rpm --import https://repo.clickhouse.tech/CLICKHOUSE-KEY.GPG
sudo yum-config-manager --add-repo https://repo.clickhouse.tech/rpm/stable/x86_64
yum -y install clickhouse-server clickhouse-client clickhouse-server-common clickhouse-compressor
</code></pre> 
<p></p> 
<p></p> 
<p><strong>运行clickhouse-server：</strong></p> 
<pre><code>systemctl restart clickhouse-server.service 
或者
/etc/init.d/clickhouse-server restart</code></pre> 
<p>/var/log/clickhouse-server/ 下有log 启动失败可以去看下原因</p> 
<p>用default用户登陆一下看看 </p> 
<pre><code>[root@clickhouse1 data]# clickhouse-client
ClickHouse client version 20.10.2.20 (official build).
Connecting to localhost:9000 as user default.
Connected to ClickHouse server version 20.10.2 revision 54441.

clickhouse1 :) </code></pre> 
<p>单机版就搭建完成了</p> 
<h3 id="cluster-deployment">集群部署</h3> 
<p>ClickHouse集群是一个同质集群。 设置步骤:</p> 
<ol><li>在群集的所有机器上安装ClickHouse服务端</li><li>在配置文件中设置群集配置</li><li>在每个实例上创建本地表</li><li>创建一个<a href="https://clickhouse.tech/docs/zh/engines/table-engines/special/distributed/" rel="nofollow" title="分布式表">分布式表</a></li><li>复制在多主机模式下运行。数据可以加载到任何副本中，然后系统自动将其与其他实例同步。复制是异步的，因此在给定时刻，并非所有副本都可能包含最近插入的数据。至少应该有一个副本允许数据摄入。另一些则会在重新激活后同步数据并修复一致性。请注意，这种方法允许最近插入的数据丢失的可能性很低。</li></ol> 
<p><strong>集群版需要多配置一个文件</strong></p> 
<p><strong>其中需要配置clickhouse和zookeeper macros</strong></p> 
<p><br> #默认路径为/etc/metrika.xml，但是在config可以配置路径</p> 
<p><strong>配置 metrika.xml：</strong></p> 
<pre><code>&lt;yandex&gt;
	&lt;!-- /etc/clickhouse-server/config.xml 中配置的remote_servers的incl属性值，--&gt;
    &lt;clickhouse_remote_servers&gt;
	&lt;!-- 5分片1备份 --&gt;
        &lt;perftest_5shards_1replicas&gt;
		&lt;!-- 数据分片1  --&gt;
            &lt;shard&gt;
                &lt;internal_replication&gt;true&lt;/internal_replication&gt;
                &lt;replica&gt;
                    &lt;host&gt;clickhouse1&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
            &lt;!-- 数据分片2  --&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;internal_replication&gt;true&lt;/internal_replication&gt;
                    &lt;host&gt;clickhouse2&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
            &lt;!-- 数据分片3  --&gt;
            &lt;shard&gt;
                &lt;internal_replication&gt;true&lt;/internal_replication&gt;
                &lt;replica&gt;
                    &lt;host&gt;clickhouse3&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
			 &lt;!-- 数据分片4  --&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;clickhouse4&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
			 &lt;!-- 数据分片5  --&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;clickhouse5&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/perftest_5shards_1replicas&gt;
    &lt;/clickhouse_remote_servers&gt;
    &lt;!--zookeeper相关配置--&gt;
    &lt;zookeeper-servers&gt;
        &lt;node index="1"&gt;
            &lt;host&gt;master1&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
        &lt;node index="2"&gt;
            &lt;host&gt;master2&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
        &lt;node index="3"&gt;
            &lt;host&gt;core1&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
    &lt;/zookeeper-servers&gt;
    &lt;macros&gt;
        &lt;replica&gt;clickhouse1&lt;/replica&gt;
    &lt;/macros&gt;
    &lt;networks&gt;
        &lt;ip&gt;::/0&lt;/ip&gt;
    &lt;/networks&gt;
    &lt;clickhouse_compression&gt;
        &lt;case&gt;
            &lt;min_part_size&gt;10000000000&lt;/min_part_size&gt;
            &lt;min_part_size_ratio&gt;0.01&lt;/min_part_size_ratio&gt;
            &lt;method&gt;lz4&lt;/method&gt;
        &lt;/case&gt;
    &lt;/clickhouse_compression&gt;
&lt;/yandex&gt;
</code></pre> 
<p></p> 
<p><strong>启动服务：</strong></p> 
<pre><code>/etc/init.d/clickhouse-server start
不过我按这种常规方式启动没有成功 
nohup   clickhouse-server --config-file=/etc/clickhouse-server/config.xml &amp; 
这样指定文件才成功</code></pre> 
<p><strong>查看集群：</strong></p> 
<pre><code>clickhouse-client

select * from system.clusters;


┌─cluster────────────────┬─shard_num─┬─shard_weight─┬─replica_num─┬─host_name───┬─host_address─┬─port─┬─is_local─┬─user────┬─default_database─┬─errors_count─┬─estimated_recovery_time─┐

│ report_shards_replicas │ 1 │ 1 │ 1 │ 192.168.1.1 │ 192.168.1.1 │ 9000 │ 1 │ default │ │ 0 │ 0 │

│ report_shards_replicas │ 1 │ 1 │ 2 │ 192.168.1.2 │ 192.168.1.2 │ 9000 │ 0 │ default │ │ 0 │ 0 │

│ report_shards_replicas │ 2 │ 1 │ 1 │ 192.168.1.2 │ 192.168.1.2 │ 9000 │ 0 │ default │ │ 0 │ 0 │

│ report_shards_replicas │ 2 │ 1 │ 2 │ 192.168.1.3 │ 192.168.1.3 │ 9000 │ 0 │ default │ │ 0 │ 0 │

│ report_shards_replicas │ 3 │ 1 │ 1 │ 192.168.1.3 │ 192.168.1.3 │ 9000 │ 0 │ default │ │ 0 │ 0 │

│ report_shards_replicas │ 3 │ 1 │ 2 │ 192.168.1.1 │ 192.168.1.1 │ 9000 │ 1 │ default │ │ 0 │ 0 │

└─────────────────────── ┴───────────┴──────────────┴─────────────┴─────────────┴──────────────┴──────┴──────────┴─────────┴──────────────────┴──────────────┴─────────────────────────┘


6 rows in set. Elapsed: 0.002 sec.</code></pre> 
<p>创建本地表，创建Distributed表。3台机器上都要创建，DDL不同步：</p> 
<pre><code>CREATE TABLE ck_local (UnixDate Date,Year UInt16) ENGINE = MergeTree(UnixDate, (Year, UnixDate), 8192);

CREATE TABLE ck_all AS ck_local ENGINE = Distributed(report_shards_replicas, default, ck_local, rand());</code></pre> 
<p><strong>插入数据：</strong></p> 
<pre><code>insert into ck_all (UnixDate,Year)values('2010-03-20',2010);

insert into ck_all (UnixDate,Year)values('2011-03-20',2011);

insert into ck_all (UnixDate,Year)values('2012-03-20',2012);</code></pre> 
<p>这样你的表就变成了分布式表 可以使用全部集群资源计算</p> 
<p>解决了搭建之后需要解决远程登录的问题 </p> 
<p>打开/etc/clickhouse-server/config.xml</p> 
<pre><code>    &lt;listen_host&gt;::1&lt;/listen_host&gt;
    &lt;listen_host&gt;127.0.0.1&lt;/listen_host&gt;</code></pre> 
<p>找到这一段 解开其中一个即可 注意观察一下 这一段有两段 一段已打开 是示例 一段已生效  修改已生效的即可  ipv6会和ipv4冲突 解开其中一个即可 修改成0.0.0.0 或者::</p> 
<p>同时去user.xml </p> 
<pre><code> &lt;ip&gt;::/0&lt;/ip&gt;</code></pre> 
<p>找到这一段 改成:: 不然你的账户只能本地登录</p> 
<p>然后解决基本的权限控制 </p> 
<p>需要在user.xml中配置一个admin账户，初始的default帐号拥有全部权限除了授权权限 因此需要配置admin帐号<br>  </p> 
<pre><code>&lt;?xml version="1.0"?&gt;
&lt;yandex&gt;
    &lt;!-- Profiles of settings. --&gt;
    &lt;profiles&gt;
        &lt;!-- Default settings. --&gt;
        &lt;default&gt;
            &lt;!-- Maximum memory usage for processing single query, in bytes. --&gt;
            &lt;max_memory_usage&gt;10000000000&lt;/max_memory_usage&gt;

            &lt;!-- Use cache of uncompressed blocks of data. Meaningful only for processing many of very short queries. --&gt;
            &lt;use_uncompressed_cache&gt;0&lt;/use_uncompressed_cache&gt;

            &lt;!-- How to choose between replicas during distributed query processing.
                 random - choose random replica from set of replicas with minimum number of errors
                 nearest_hostname - from set of replicas with minimum number of errors, choose replica
                  with minimum number of different symbols between replica's hostname and local hostname
                  (Hamming distance).
                 in_order - first live replica is chosen in specified order.
                 first_or_random - if first replica one has higher number of errors, pick a random one from replicas with minimum number of errors.
            --&gt;
            &lt;load_balancing&gt;random&lt;/load_balancing&gt;
        &lt;/default&gt;

        &lt;!-- Profile that allows only read queries. --&gt;
        &lt;readonly&gt;
            &lt;readonly&gt;1&lt;/readonly&gt;
        &lt;/readonly&gt;
    &lt;/profiles&gt;

    &lt;!-- Users and ACL. --&gt;
    &lt;users&gt;
      &lt;admin&gt;
        &lt;password&gt;pwd&lt;/password&gt;

        &lt;access_management&gt;1&lt;/access_management&gt;

        &lt;networks incl="networks" replace="replace"&gt;
                &lt;ip&gt;::/0&lt;/ip&gt;
        &lt;/networks&gt;

        &lt;profile&gt;default&lt;/profile&gt;

        &lt;quota&gt;default&lt;/quota&gt;

      &lt;/admin&gt;
&lt;/users&gt;
    &lt;users&gt;
        &lt;!-- If user name was not specified, 'default' user is used. --&gt;
        &lt;default&gt;
            &lt;!-- Password could be specified in plaintext or in SHA256 (in hex format).

                 If you want to specify password in plaintext (not recommended), place it in 'password' element.
                 Example: &lt;password&gt;qwerty&lt;/password&gt;.
                 Password could be empty.

                 If you want to specify SHA256, place it in 'password_sha256_hex' element.
                 Example: &lt;password_sha256_hex&gt;65e84be33532fb784c48129675f9eff3a682b27168c0ea744b2cf58ee02337c5&lt;/password_sha256_hex&gt;
                 Restrictions of SHA256: impossibility to connect to ClickHouse using MySQL JS client (as of July 2019).

                 If you want to specify double SHA1, place it in 'password_double_sha1_hex' element.
                 Example: &lt;password_double_sha1_hex&gt;e395796d6546b1b65db9d665cd43f0e858dd4303&lt;/password_double_sha1_hex&gt;

                 If you want to specify a previously defined LDAP server (see 'ldap_servers' in main config) for authentication, place its name in 'server' element inside 'ldap' element.
                 Example: &lt;ldap&gt;&lt;server&gt;my_ldap_server&lt;/server&gt;&lt;/ldap&gt;

                 How to generate decent password:
                 Execute: PASSWORD=$(base64 &lt; /dev/urandom | head -c8); echo "$PASSWORD"; echo -n "$PASSWORD" | sha256sum | tr -d '-'
                 In first line will be password and in second - corresponding SHA256.

                 How to generate double SHA1:
                 Execute: PASSWORD=$(base64 &lt; /dev/urandom | head -c8); echo "$PASSWORD"; echo -n "$PASSWORD" | sha1sum | tr -d '-' | xxd -r -p | sha1sum | tr -d '-'
                 In first line will be password and in second - corresponding double SHA1.
            --&gt;
            &lt;password&gt;&lt;/password&gt;

            &lt;!-- List of networks with open access.

                 To open access from everywhere, specify:
                    &lt;ip&gt;::/0&lt;/ip&gt;

                 To open access only from localhost, specify:
                    &lt;ip&gt;::1&lt;/ip&gt;
                    &lt;ip&gt;127.0.0.1&lt;/ip&gt;

                 Each element of list has one of the following forms:
                 &lt;ip&gt; IP-address or network mask. Examples: 213.180.204.3 or 10.0.0.1/8 or 10.0.0.1/255.255.255.0
                     2a02:6b8::3 or 2a02:6b8::3/64 or 2a02:6b8::3/ffff:ffff:ffff:ffff::.
                 &lt;host&gt; Hostname. Example: server01.yandex.ru.
                     To check access, DNS query is performed, and all received addresses compared to peer address.
                 &lt;host_regexp&gt; Regular expression for host names. Example, ^server\d\d-\d\d-\d\.yandex\.ru$
                     To check access, DNS PTR query is performed for peer address and then regexp is applied.
                     Then, for result of PTR query, another DNS query is performed and all received addresses compared to peer address.
                     Strongly recommended that regexp is ends with $
                 All results of DNS requests are cached till server restart.
            --&gt;
            &lt;networks incl="networks" replace="replace"&gt;
                &lt;ip&gt;::/0&lt;/ip&gt;
            &lt;/networks&gt;

            &lt;!-- Settings profile for user. --&gt;
            &lt;profile&gt;default&lt;/profile&gt;

            &lt;!-- Quota for user. --&gt;
            &lt;quota&gt;default&lt;/quota&gt;

            &lt;!-- User can create other users and grant rights to them. --&gt;
            &lt;!-- &lt;access_management&gt;1&lt;/access_management&gt; --&gt;
        &lt;/default&gt;
    &lt;/users&gt;

    &lt;!-- Quotas. --&gt;
    &lt;quotas&gt;
        &lt;!-- Name of quota. --&gt;
        &lt;default&gt;
            &lt;!-- Limits for time interval. You could specify many intervals with different limits. --&gt;
            &lt;interval&gt;
                &lt;!-- Length of interval. --&gt;
                &lt;duration&gt;3600&lt;/duration&gt;

                &lt;!-- No limits. Just calculate resource usage for time interval. --&gt;
                &lt;queries&gt;0&lt;/queries&gt;
                &lt;errors&gt;0&lt;/errors&gt;
                &lt;result_rows&gt;0&lt;/result_rows&gt;
                &lt;read_rows&gt;0&lt;/read_rows&gt;
                &lt;execution_time&gt;0&lt;/execution_time&gt;
            &lt;/interval&gt;
        &lt;/default&gt;
    &lt;/quotas&gt;
&lt;/yandex&gt;
</code></pre> 
<p>就是添加了这一段</p> 
<pre><code>
&lt;users&gt;
      &lt;admin&gt;  ## clickhouse自带default用户，但是该用户拥有所有权限且没有设置登陆密码和开启RBAC
        &lt;password&gt;pwd&lt;/password&gt;

        &lt;access_management&gt;1&lt;/access_management&gt;

        &lt;networks incl="networks" replace="replace"&gt;
                &lt;ip&gt;::/0&lt;/ip&gt;
        &lt;/networks&gt;

        &lt;profile&gt;default&lt;/profile&gt;

        &lt;quota&gt;default&lt;/quota&gt;

      &lt;/admin&gt;
&lt;/users&gt;</code></pre> 
<ul><li>access_management 默认为0，设置为1标识开启RBAC权限控制。</li><li>admin 配置的用户名</li><li>password 用户对应的密码</li><li>networks 运行访问的客户端ip、host</li><li>profile clickhouse角色</li><li>quota 配额，分配给该用户的资源</li></ul> 
<p>可以配置的配置项有这些 我这里不涉及控制资源配额</p> 
<p>同时在config.xml里配置存储位置</p> 
<pre><code>&lt;?xml version="1.0"?&gt;
&lt;!--
  NOTE: User and query level settings are set up in "users.xml" file.
  If you have accidentally specified user-level settings here, server won't start.
  You can either move the settings to the right place inside "users.xml" file
   or add &lt;skip_check_for_incorrect_settings&gt;1&lt;/skip_check_for_incorrect_settings&gt; here.
--&gt;
&lt;yandex&gt;
    &lt;logger&gt;
        &lt;!-- Possible levels: https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/Logger.h#L105 --&gt;
        &lt;level&gt;trace&lt;/level&gt;
        &lt;log&gt;/data/log/clickhouse-server/clickhouse-server.log&lt;/log&gt;
        &lt;errorlog&gt;/data/log/clickhouse-server/clickhouse-server.err.log&lt;/errorlog&gt;
        &lt;size&gt;1000M&lt;/size&gt;
        &lt;count&gt;10&lt;/count&gt;
        &lt;!-- &lt;console&gt;1&lt;/console&gt; --&gt; &lt;!-- Default behavior is autodetection (log to console if not daemon mode and is tty) --&gt;

        &lt;!-- Per level overrides (legacy):

        For example to suppress logging of the ConfigReloader you can use:
        NOTE: levels.logger is reserved, see below.
        --&gt;
        &lt;!--
        &lt;levels&gt;
          &lt;ConfigReloader&gt;none&lt;/ConfigReloader&gt;
        &lt;/levels&gt;
        --&gt;

        &lt;!-- Per level overrides:

        For example to suppress logging of the RBAC for default user you can use:
        (But please note that the logger name maybe changed from version to version, even after minor upgrade)
        --&gt;
        &lt;!--
        &lt;levels&gt;
          &lt;logger&gt;
            &lt;name&gt;ContextAccess (default)&lt;/name&gt;
            &lt;level&gt;none&lt;/level&gt;
          &lt;/logger&gt;
          &lt;logger&gt;
            &lt;name&gt;DatabaseOrdinary (test)&lt;/name&gt;
            &lt;level&gt;none&lt;/level&gt;
          &lt;/logger&gt;
        &lt;/levels&gt;
        --&gt;
    &lt;/logger&gt;

    &lt;send_crash_reports&gt;
        &lt;!-- Changing &lt;enabled&gt; to true allows sending crash reports to --&gt;
        &lt;!-- the ClickHouse core developers team via Sentry https://sentry.io --&gt;
        &lt;!-- Doing so at least in pre-production environments is highly appreciated --&gt;
        &lt;enabled&gt;false&lt;/enabled&gt;
        &lt;!-- Change &lt;anonymize&gt; to true if you don't feel comfortable attaching the server hostname to the crash report --&gt;
        &lt;anonymize&gt;false&lt;/anonymize&gt;
        &lt;!-- Default endpoint should be changed to different Sentry DSN only if you have --&gt;
        &lt;!-- some in-house engineers or hired consultants who're going to debug ClickHouse issues for you --&gt;
        &lt;endpoint&gt;https://6f33034cfe684dd7a3ab9875e57b1c8d@o388870.ingest.sentry.io/5226277&lt;/endpoint&gt;
    &lt;/send_crash_reports&gt;

    &lt;!--display_name&gt;production&lt;/display_name--&gt; &lt;!-- It is the name that will be shown in the client --&gt;
    &lt;http_port&gt;8123&lt;/http_port&gt;
    &lt;tcp_port&gt;9000&lt;/tcp_port&gt;
    &lt;mysql_port&gt;9004&lt;/mysql_port&gt;
    &lt;!-- For HTTPS and SSL over native protocol. --&gt;
    &lt;!--
    &lt;https_port&gt;8443&lt;/https_port&gt;
    &lt;tcp_port_secure&gt;9440&lt;/tcp_port_secure&gt;
    --&gt;
    &lt;!-- Used with https_port and tcp_port_secure. Full ssl options list: https://github.com/ClickHouse-Extras/poco/blob/master/NetSSL_OpenSSL/include/Poco/Net/SSLManager.h#L71 --&gt;
    &lt;openSSL&gt;
        &lt;server&gt; &lt;!-- Used for https server AND secure tcp port --&gt;
            &lt;!-- openssl req -subj "/CN=localhost" -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout /etc/clickhouse-server/server.key -out /etc/clickhouse-server/server.crt --&gt;
            &lt;certificateFile&gt;/etc/clickhouse-server/server.crt&lt;/certificateFile&gt;
            &lt;privateKeyFile&gt;/etc/clickhouse-server/server.key&lt;/privateKeyFile&gt;
            &lt;!-- openssl dhparam -out /etc/clickhouse-server/dhparam.pem 4096 --&gt;
            &lt;dhParamsFile&gt;/etc/clickhouse-server/dhparam.pem&lt;/dhParamsFile&gt;
            &lt;verificationMode&gt;none&lt;/verificationMode&gt;
            &lt;loadDefaultCAFile&gt;true&lt;/loadDefaultCAFile&gt;
            &lt;cacheSessions&gt;true&lt;/cacheSessions&gt;
            &lt;disableProtocols&gt;sslv2,sslv3&lt;/disableProtocols&gt;
            &lt;preferServerCiphers&gt;true&lt;/preferServerCiphers&gt;
        &lt;/server&gt;

        &lt;client&gt; &lt;!-- Used for connecting to https dictionary source and secured Zookeeper communication --&gt;
            &lt;loadDefaultCAFile&gt;true&lt;/loadDefaultCAFile&gt;
            &lt;cacheSessions&gt;true&lt;/cacheSessions&gt;
            &lt;disableProtocols&gt;sslv2,sslv3&lt;/disableProtocols&gt;
            &lt;preferServerCiphers&gt;true&lt;/preferServerCiphers&gt;
            &lt;!-- Use for self-signed: &lt;verificationMode&gt;none&lt;/verificationMode&gt; --&gt;
            &lt;invalidCertificateHandler&gt;
                &lt;!-- Use for self-signed: &lt;name&gt;AcceptCertificateHandler&lt;/name&gt; --&gt;
                &lt;name&gt;RejectCertificateHandler&lt;/name&gt;
            &lt;/invalidCertificateHandler&gt;
        &lt;/client&gt;
    &lt;/openSSL&gt;

    &lt;!-- Default root page on http[s] server. For example load UI from https://tabix.io/ when opening http://localhost:8123 --&gt;
    &lt;!--
    &lt;http_server_default_response&gt;&lt;![CDATA[&lt;html ng-app="SMI2"&gt;&lt;head&gt;&lt;base href="http://ui.tabix.io/"&gt;&lt;/head&gt;&lt;body&gt;&lt;div ui-view="" class="content-ui"&gt;&lt;/div&gt;&lt;script src="http://loader.tabix.io/master.js"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;]]&gt;&lt;/http_server_default_response&gt;
    --&gt;

    &lt;!-- Port for communication between replicas. Used for data exchange. --&gt;
    &lt;interserver_http_port&gt;9009&lt;/interserver_http_port&gt;

    &lt;!-- Hostname that is used by other replicas to request this server.
         If not specified, than it is determined analogous to 'hostname -f' command.
         This setting could be used to switch replication to another network interface.
      --&gt;
    &lt;!--
    &lt;interserver_http_host&gt;example.yandex.ru&lt;/interserver_http_host&gt;
    --&gt;

    &lt;!-- Listen specified host. use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere. --&gt;
    &lt;listen_host&gt;::1&lt;/listen_host&gt;
    &lt;!-- Same for hosts with disabled ipv6: --&gt;
    &lt;listen_host&gt;172.16.98.118&lt;/listen_host&gt;

    &lt;!-- Default values - try listen localhost on ipv4 and ipv6: --&gt;
    &lt;!-- &lt;listen_host&gt;::1&lt;/listen_host&gt; --&gt;
    &lt;!-- &lt;listen_host&gt;127.0.0.1&lt;/listen_host&gt; --&gt;
    &lt;!-- Don't exit if ipv6 or ipv4 unavailable, but listen_host with this protocol specified --&gt;
    &lt;!-- &lt;listen_try&gt;0&lt;/listen_try&gt; --&gt;

    &lt;!-- Allow listen on same address:port --&gt;
    &lt;!-- &lt;listen_reuse_port&gt;0&lt;/listen_reuse_port&gt; --&gt;

    &lt;!-- &lt;listen_backlog&gt;64&lt;/listen_backlog&gt; --&gt;

    &lt;max_connections&gt;4096&lt;/max_connections&gt;
    &lt;keep_alive_timeout&gt;3&lt;/keep_alive_timeout&gt;

    &lt;!-- Maximum number of concurrent queries. --&gt;
    &lt;max_concurrent_queries&gt;100&lt;/max_concurrent_queries&gt;

    &lt;!-- Maximum memory usage (resident set size) for server process.
         Zero value or unset means default. Default is "max_server_memory_usage_to_ram_ratio" of available physical RAM.
         If the value is larger than "max_server_memory_usage_to_ram_ratio" of available physical RAM, it will be cut down.

         The constraint is checked on query execution time.
         If a query tries to allocate memory and the current memory usage plus allocation is greater
          than specified threshold, exception will be thrown.

         It is not practical to set this constraint to small values like just a few gigabytes,
          because memory allocator will keep this amount of memory in caches and the server will deny service of queries.
      --&gt;
    &lt;max_server_memory_usage&gt;0&lt;/max_server_memory_usage&gt;

    &lt;!-- Maximum number of threads in the Global thread pool.
    This will default to a maximum of 10000 threads if not specified.
    This setting will be useful in scenarios where there are a large number
    of distributed queries that are running concurrently but are idling most
    of the time, in which case a higher number of threads might be required.
    --&gt;

    &lt;max_thread_pool_size&gt;10000&lt;/max_thread_pool_size&gt;

    &lt;!-- On memory constrained environments you may have to set this to value larger than 1.
      --&gt;
    &lt;max_server_memory_usage_to_ram_ratio&gt;0.9&lt;/max_server_memory_usage_to_ram_ratio&gt;

    &lt;!-- Simple server-wide memory profiler. Collect a stack trace at every peak allocation step (in bytes).
         Data will be stored in system.trace_log table with query_id = empty string.
         Zero means disabled.
      --&gt;
    &lt;total_memory_profiler_step&gt;4194304&lt;/total_memory_profiler_step&gt;

    &lt;!-- Collect random allocations and deallocations and write them into system.trace_log with 'MemorySample' trace_type.
         The probability is for every alloc/free regardless to the size of the allocation.
         Note that sampling happens only when the amount of untracked memory exceeds the untracked memory limit,
          which is 4 MiB by default but can be lowered if 'total_memory_profiler_step' is lowered.
         You may want to set 'total_memory_profiler_step' to 1 for extra fine grained sampling.
      --&gt;
    &lt;total_memory_tracker_sample_probability&gt;0&lt;/total_memory_tracker_sample_probability&gt;

    &lt;!-- Set limit on number of open files (default: maximum). This setting makes sense on Mac OS X because getrlimit() fails to retrieve
         correct maximum value. --&gt;
    &lt;!-- &lt;max_open_files&gt;262144&lt;/max_open_files&gt; --&gt;

    &lt;!-- Size of cache of uncompressed blocks of data, used in tables of MergeTree family.
         In bytes. Cache is single for server. Memory is allocated only on demand.
         Cache is used when 'use_uncompressed_cache' user setting turned on (off by default).
         Uncompressed cache is advantageous only for very short queries and in rare cases.
      --&gt;
    &lt;uncompressed_cache_size&gt;8589934592&lt;/uncompressed_cache_size&gt;

    &lt;!-- Approximate size of mark cache, used in tables of MergeTree family.
         In bytes. Cache is single for server. Memory is allocated only on demand.
         You should not lower this value.
      --&gt;
    &lt;mark_cache_size&gt;5368709120&lt;/mark_cache_size&gt;


    &lt;!-- Path to data directory, with trailing slash. --&gt;
    &lt;path&gt;/data/clickhouse/&lt;/path&gt;

    &lt;!-- Path to temporary data for processing hard queries. --&gt;
    &lt;tmp_path&gt;/data/clickhouse/tmp/&lt;/tmp_path&gt;

    &lt;!-- Policy from the &lt;storage_configuration&gt; for the temporary files.
         If not set &lt;tmp_path&gt; is used, otherwise &lt;tmp_path&gt; is ignored.

         Notes:
         - move_factor              is ignored
         - keep_free_space_bytes    is ignored
         - max_data_part_size_bytes is ignored
         - you must have exactly one volume in that policy
    --&gt;
    &lt;!-- &lt;tmp_policy&gt;tmp&lt;/tmp_policy&gt; --&gt;

    &lt;!-- Directory with user provided files that are accessible by 'file' table function. --&gt;
    &lt;user_files_path&gt;/data/clickhouse/user_files/&lt;/user_files_path&gt;
    &lt;access_control_path&gt;/data/clickhouse/control/&lt;/access_control_path&gt;
    &lt;!-- Sources to read users, roles, access rights, profiles of settings, quotas. --&gt;
    &lt;user_directories&gt;
        &lt;users_xml&gt;
            &lt;!-- Path to configuration file with predefined users. --&gt;
            &lt;path&gt;users.xml&lt;/path&gt;
        &lt;/users_xml&gt;
        &lt;local_directory&gt;
            &lt;!-- Path to folder where users created by SQL commands are stored. --&gt;
            &lt;path&gt;/data/clickhouse/access/&lt;/path&gt;
        &lt;/local_directory&gt;
    &lt;/user_directories&gt;

    &lt;!-- External user directories (LDAP). --&gt;
    &lt;ldap_servers&gt;
        &lt;!-- List LDAP servers with their connection parameters here to later use them as authenticators for dedicated users,
             who have 'ldap' authentication mechanism specified instead of 'password'.
             Parameters:
                host - LDAP server hostname or IP, this parameter is mandatory and cannot be empty.
                port - LDAP server port, default is 636 if enable_tls is set to true, 389 otherwise.
                auth_dn_prefix, auth_dn_suffix - prefix and suffix used to construct the DN to bind to.
                        Effectively, the resulting DN will be constructed as auth_dn_prefix + escape(user_name) + auth_dn_suffix string.
                        Note, that this implies that auth_dn_suffix should usually have comma ',' as its first non-space character.
                enable_tls - flag to trigger use of secure connection to the LDAP server.
                        Specify 'no' for plain text (ldap://) protocol (not recommended).
                        Specify 'yes' for LDAP over SSL/TLS (ldaps://) protocol (recommended, the default).
                        Specify 'starttls' for legacy StartTLS protocol (plain text (ldap://) protocol, upgraded to TLS).
                tls_minimum_protocol_version - the minimum protocol version of SSL/TLS.
                        Accepted values are: 'ssl2', 'ssl3', 'tls1.0', 'tls1.1', 'tls1.2' (the default).
                tls_require_cert - SSL/TLS peer certificate verification behavior.
                        Accepted values are: 'never', 'allow', 'try', 'demand' (the default).
                tls_cert_file - path to certificate file.
                tls_key_file - path to certificate key file.
                tls_ca_cert_file - path to CA certificate file.
                tls_ca_cert_dir - path to the directory containing CA certificates.
                tls_cipher_suite - allowed cipher suite.
             Example:
                &lt;my_ldap_server&gt;
                    &lt;host&gt;localhost&lt;/host&gt;
                    &lt;port&gt;636&lt;/port&gt;
                    &lt;auth_dn_prefix&gt;uid=&lt;/auth_dn_prefix&gt;
                    &lt;auth_dn_suffix&gt;,ou=users,dc=example,dc=com&lt;/auth_dn_suffix&gt;
                    &lt;enable_tls&gt;yes&lt;/enable_tls&gt;
                    &lt;tls_minimum_protocol_version&gt;tls1.2&lt;/tls_minimum_protocol_version&gt;
                    &lt;tls_require_cert&gt;demand&lt;/tls_require_cert&gt;
                    &lt;tls_cert_file&gt;/path/to/tls_cert_file&lt;/tls_cert_file&gt;
                    &lt;tls_key_file&gt;/path/to/tls_key_file&lt;/tls_key_file&gt;
                    &lt;tls_ca_cert_file&gt;/path/to/tls_ca_cert_file&lt;/tls_ca_cert_file&gt;
                    &lt;tls_ca_cert_dir&gt;/path/to/tls_ca_cert_dir&lt;/tls_ca_cert_dir&gt;
                    &lt;tls_cipher_suite&gt;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:AES256-GCM-SHA384&lt;/tls_cipher_suite&gt;
                &lt;/my_ldap_server&gt;
        --&gt;
    &lt;/ldap_servers&gt;

    &lt;!-- Default profile of settings. --&gt;
    &lt;default_profile&gt;default&lt;/default_profile&gt;

    &lt;!-- Comma-separated list of prefixes for user-defined settings. --&gt;
    &lt;custom_settings_prefixes&gt;&lt;/custom_settings_prefixes&gt;

    &lt;!-- System profile of settings. This settings are used by internal processes (Buffer storage, Distributed DDL worker and so on). --&gt;
    &lt;!-- &lt;system_profile&gt;default&lt;/system_profile&gt; --&gt;

    &lt;!-- Default database. --&gt;
    &lt;default_database&gt;default&lt;/default_database&gt;

    &lt;!-- Server time zone could be set here.

         Time zone is used when converting between String and DateTime types,
          when printing DateTime in text formats and parsing DateTime from text,
          it is used in date and time related functions, if specific time zone was not passed as an argument.

         Time zone is specified as identifier from IANA time zone database, like UTC or Africa/Abidjan.
         If not specified, system time zone at server startup is used.

         Please note, that server could display time zone alias instead of specified name.
         Example: W-SU is an alias for Europe/Moscow and Zulu is an alias for UTC.
    --&gt;
    &lt;!-- &lt;timezone&gt;Europe/Moscow&lt;/timezone&gt; --&gt;

    &lt;!-- You can specify umask here (see "man umask"). Server will apply it on startup.
         Number is always parsed as octal. Default umask is 027 (other users cannot read logs, data files, etc; group can only read).
    --&gt;
    &lt;!-- &lt;umask&gt;022&lt;/umask&gt; --&gt;

    &lt;!-- Perform mlockall after startup to lower first queries latency
          and to prevent clickhouse executable from being paged out under high IO load.
         Enabling this option is recommended but will lead to increased startup time for up to a few seconds.
    --&gt;
    &lt;mlock_executable&gt;true&lt;/mlock_executable&gt;

    &lt;!-- Reallocate memory for machine code ("text") using huge pages. Highly experimental. --&gt;
    &lt;remap_executable&gt;false&lt;/remap_executable&gt;

    &lt;!-- Configuration of clusters that could be used in Distributed tables.
         https://clickhouse.tech/docs/en/operations/table_engines/distributed/
      --&gt;
    &lt;remote_servers incl="clickhouse_remote_servers" &gt;
        &lt;!-- Test only shard config for testing distributed storage --&gt;
        &lt;test_shard_localhost&gt;
            &lt;!-- Inter-server per-cluster secret for Distributed queries
                 default: no secret (no authentication will be performed)

                 If set, then Distributed queries will be validated on shards, so at least:
                 - such cluster should exist on the shard,
                 - such cluster should have the same secret.

                 And also (and which is more important), the initial_user will
                 be used as current user for the query.

                 Right now the protocol is pretty simple and it only takes into account:
                 - cluster name
                 - query

                 Also it will be nice if the following will be implemented:
                 - source hostname (see interserver_http_host), but then it will depends from DNS,
                   it can use IP address instead, but then the you need to get correct on the initiator node.
                 - target hostname / ip address (same notes as for source hostname)
                 - time-based security tokens
            --&gt;
            &lt;!-- &lt;secret&gt;&lt;/secret&gt; --&gt;

            &lt;shard&gt;
                &lt;!-- Optional. Whether to write data to just one of the replicas. Default: false (write data to all replicas). --&gt;
                &lt;!-- &lt;internal_replication&gt;false&lt;/internal_replication&gt; --&gt;
                &lt;!-- Optional. Shard weight when writing data. Default: 1. --&gt;
                &lt;!-- &lt;weight&gt;1&lt;/weight&gt; --&gt;
                &lt;replica&gt;
                    &lt;host&gt;localhost&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                    &lt;!-- Optional. Priority of the replica for load_balancing. Default: 1 (less value has more priority). --&gt;
                    &lt;!-- &lt;priority&gt;1&lt;/priority&gt; --&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/test_shard_localhost&gt;
        &lt;test_cluster_two_shards_localhost&gt;
             &lt;shard&gt;
                 &lt;replica&gt;
                     &lt;host&gt;localhost&lt;/host&gt;
                     &lt;port&gt;9000&lt;/port&gt;
                 &lt;/replica&gt;
             &lt;/shard&gt;
             &lt;shard&gt;
                 &lt;replica&gt;
                     &lt;host&gt;localhost&lt;/host&gt;
                     &lt;port&gt;9000&lt;/port&gt;
                 &lt;/replica&gt;
             &lt;/shard&gt;
        &lt;/test_cluster_two_shards_localhost&gt;
        &lt;test_cluster_two_shards&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;127.0.0.1&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;127.0.0.2&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/test_cluster_two_shards&gt;
        &lt;test_shard_localhost_secure&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;localhost&lt;/host&gt;
                    &lt;port&gt;9440&lt;/port&gt;
                    &lt;secure&gt;1&lt;/secure&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/test_shard_localhost_secure&gt;
        &lt;test_unavailable_shard&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;localhost&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;localhost&lt;/host&gt;
                    &lt;port&gt;1&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/test_unavailable_shard&gt;
    &lt;/remote_servers&gt;

    &lt;!-- The list of hosts allowed to use in URL-related storage engines and table functions.
        If this section is not present in configuration, all hosts are allowed.
    --&gt;
    &lt;remote_url_allow_hosts&gt;
        &lt;!-- Host should be specified exactly as in URL. The name is checked before DNS resolution.
            Example: "yandex.ru", "yandex.ru." and "www.yandex.ru" are different hosts.
                    If port is explicitly specified in URL, the host:port is checked as a whole.
                    If host specified here without port, any port with this host allowed.
                    "yandex.ru" -&gt; "yandex.ru:443", "yandex.ru:80" etc. is allowed, but "yandex.ru:80" -&gt; only "yandex.ru:80" is allowed.
            If the host is specified as IP address, it is checked as specified in URL. Example: "[2a02:6b8:a::a]".
            If there are redirects and support for redirects is enabled, every redirect (the Location field) is checked.
        --&gt;

        &lt;!-- Regular expression can be specified. RE2 engine is used for regexps.
            Regexps are not aligned: don't forget to add ^ and $. Also don't forget to escape dot (.) metacharacter
            (forgetting to do so is a common source of error).
        --&gt;
    &lt;/remote_url_allow_hosts&gt;

    &lt;!-- If element has 'incl' attribute, then for it's value will be used corresponding substitution from another file.
         By default, path to file with substitutions is /etc/metrika.xml. It could be changed in config in 'include_from' element.
         Values for substitutions are specified in /yandex/name_of_substitution elements in that file.
      --&gt;

    &lt;!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.
         Optional. If you don't use replicated tables, you could omit that.

         See https://clickhouse.yandex/docs/en/table_engines/replication/
      --&gt;

    &lt;zookeeper incl="zookeeper-servers" optional="true" /&gt;

    &lt;!-- Substitutions for parameters of replicated tables.
          Optional. If you don't use replicated tables, you could omit that.

         See https://clickhouse.yandex/docs/en/table_engines/replication/#creating-replicated-tables
      --&gt;
    &lt;macros incl="macros" optional="true" /&gt;


    &lt;!-- Reloading interval for embedded dictionaries, in seconds. Default: 3600. --&gt;
    &lt;builtin_dictionaries_reload_interval&gt;3600&lt;/builtin_dictionaries_reload_interval&gt;


    &lt;!-- Maximum session timeout, in seconds. Default: 3600. --&gt;
    &lt;max_session_timeout&gt;3600&lt;/max_session_timeout&gt;

    &lt;!-- Default session timeout, in seconds. Default: 60. --&gt;
    &lt;default_session_timeout&gt;60&lt;/default_session_timeout&gt;

    &lt;!-- Sending data to Graphite for monitoring. Several sections can be defined. --&gt;
    &lt;!--
        interval - send every X second
        root_path - prefix for keys
        hostname_in_path - append hostname to root_path (default = true)
        metrics - send data from table system.metrics
        events - send data from table system.events
        asynchronous_metrics - send data from table system.asynchronous_metrics
    --&gt;
    &lt;!--
    &lt;graphite&gt;
        &lt;host&gt;localhost&lt;/host&gt;
        &lt;port&gt;42000&lt;/port&gt;
        &lt;timeout&gt;0.1&lt;/timeout&gt;
        &lt;interval&gt;60&lt;/interval&gt;
        &lt;root_path&gt;one_min&lt;/root_path&gt;
        &lt;hostname_in_path&gt;true&lt;/hostname_in_path&gt;

        &lt;metrics&gt;true&lt;/metrics&gt;
        &lt;events&gt;true&lt;/events&gt;
        &lt;events_cumulative&gt;false&lt;/events_cumulative&gt;
        &lt;asynchronous_metrics&gt;true&lt;/asynchronous_metrics&gt;
    &lt;/graphite&gt;
    &lt;graphite&gt;
        &lt;host&gt;localhost&lt;/host&gt;
        &lt;port&gt;42000&lt;/port&gt;
        &lt;timeout&gt;0.1&lt;/timeout&gt;
        &lt;interval&gt;1&lt;/interval&gt;
        &lt;root_path&gt;one_sec&lt;/root_path&gt;

        &lt;metrics&gt;true&lt;/metrics&gt;
        &lt;events&gt;true&lt;/events&gt;
        &lt;events_cumulative&gt;false&lt;/events_cumulative&gt;
        &lt;asynchronous_metrics&gt;false&lt;/asynchronous_metrics&gt;
    &lt;/graphite&gt;
    --&gt;

    &lt;!-- Serve endpoint for Prometheus monitoring. --&gt;
    &lt;!--
        endpoint - mertics path (relative to root, statring with "/")
        port - port to setup server. If not defined or 0 than http_port used
        metrics - send data from table system.metrics
        events - send data from table system.events
        asynchronous_metrics - send data from table system.asynchronous_metrics
        status_info - send data from different component from CH, ex: Dictionaries status
    --&gt;
    &lt;!--
    &lt;prometheus&gt;
        &lt;endpoint&gt;/metrics&lt;/endpoint&gt;
        &lt;port&gt;9363&lt;/port&gt;

        &lt;metrics&gt;true&lt;/metrics&gt;
        &lt;events&gt;true&lt;/events&gt;
        &lt;asynchronous_metrics&gt;true&lt;/asynchronous_metrics&gt;
        &lt;status_info&gt;true&lt;/status_info&gt;
    &lt;/prometheus&gt;
    --&gt;

    &lt;!-- Query log. Used only for queries with setting log_queries = 1. --&gt;
    &lt;query_log&gt;
        &lt;!-- What table to insert data. If table is not exist, it will be created.
             When query log structure is changed after system update,
              then old table will be renamed and new table will be created automatically.
        --&gt;
        &lt;database&gt;system&lt;/database&gt;
        &lt;table&gt;query_log&lt;/table&gt;
        &lt;!--
            PARTITION BY expr https://clickhouse.yandex/docs/en/table_engines/custom_partitioning_key/
            Example:
                event_date
                toMonday(event_date)
                toYYYYMM(event_date)
                toStartOfHour(event_time)
        --&gt;
        &lt;partition_by&gt;toYYYYMM(event_date)&lt;/partition_by&gt;

        &lt;!-- Instead of partition_by, you can provide full engine expression (starting with ENGINE = ) with parameters,
             Example: &lt;engine&gt;ENGINE = MergeTree PARTITION BY toYYYYMM(event_date) ORDER BY (event_date, event_time) SETTINGS index_granularity = 1024&lt;/engine&gt;
          --&gt;

        &lt;!-- Interval of flushing data. --&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;/flush_interval_milliseconds&gt;
    &lt;/query_log&gt;

    &lt;!-- Trace log. Stores stack traces collected by query profilers.
         See query_profiler_real_time_period_ns and query_profiler_cpu_time_period_ns settings. --&gt;
    &lt;trace_log&gt;
        &lt;database&gt;system&lt;/database&gt;
        &lt;table&gt;trace_log&lt;/table&gt;

        &lt;partition_by&gt;toYYYYMM(event_date)&lt;/partition_by&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;/flush_interval_milliseconds&gt;
    &lt;/trace_log&gt;

    &lt;!-- Query thread log. Has information about all threads participated in query execution.
         Used only for queries with setting log_query_threads = 1. --&gt;
    &lt;query_thread_log&gt;
        &lt;database&gt;system&lt;/database&gt;
        &lt;table&gt;query_thread_log&lt;/table&gt;
        &lt;partition_by&gt;toYYYYMM(event_date)&lt;/partition_by&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;/flush_interval_milliseconds&gt;
    &lt;/query_thread_log&gt;

    &lt;!-- Uncomment if use part log.
         Part log contains information about all actions with parts in MergeTree tables (creation, deletion, merges, downloads).
    &lt;part_log&gt;
        &lt;database&gt;system&lt;/database&gt;
        &lt;table&gt;part_log&lt;/table&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;/flush_interval_milliseconds&gt;
    &lt;/part_log&gt;
    --&gt;

    &lt;!-- Uncomment to write text log into table.
         Text log contains all information from usual server log but stores it in structured and efficient way.
         The level of the messages that goes to the table can be limited (&lt;level&gt;), if not specified all messages will go to the table.
    &lt;text_log&gt;
        &lt;database&gt;system&lt;/database&gt;
        &lt;table&gt;text_log&lt;/table&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;/flush_interval_milliseconds&gt;
        &lt;level&gt;&lt;/level&gt;
    &lt;/text_log&gt;
    --&gt;

    &lt;!-- Metric log contains rows with current values of ProfileEvents, CurrentMetrics collected with "collect_interval_milliseconds" interval. --&gt;
    &lt;metric_log&gt;
        &lt;database&gt;system&lt;/database&gt;
        &lt;table&gt;metric_log&lt;/table&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;/flush_interval_milliseconds&gt;
        &lt;collect_interval_milliseconds&gt;1000&lt;/collect_interval_milliseconds&gt;
    &lt;/metric_log&gt;

    &lt;!--
        Asynchronous metric log contains values of metrics from
        system.asynchronous_metrics.
    --&gt;
    &lt;asynchronous_metric_log&gt;
        &lt;database&gt;system&lt;/database&gt;
        &lt;table&gt;asynchronous_metric_log&lt;/table&gt;
        &lt;!--
            Asynchronous metrics are updated once a minute, so there is
            no need to flush more often.
        --&gt;
        &lt;flush_interval_milliseconds&gt;60000&lt;/flush_interval_milliseconds&gt;
    &lt;/asynchronous_metric_log&gt;

    &lt;!-- Crash log. Stores stack traces for fatal errors.
         This table is normally empty. --&gt;
    &lt;crash_log&gt;
        &lt;database&gt;system&lt;/database&gt;
        &lt;table&gt;crash_log&lt;/table&gt;

        &lt;partition_by /&gt;
        &lt;flush_interval_milliseconds&gt;1000&lt;/flush_interval_milliseconds&gt;
    &lt;/crash_log&gt;

    &lt;!-- Parameters for embedded dictionaries, used in Yandex.Metrica.
         See https://clickhouse.yandex/docs/en/dicts/internal_dicts/
    --&gt;

    &lt;!-- Path to file with region hierarchy. --&gt;
    &lt;!-- &lt;path_to_regions_hierarchy_file&gt;/opt/geo/regions_hierarchy.txt&lt;/path_to_regions_hierarchy_file&gt; --&gt;

    &lt;!-- Path to directory with files containing names of regions --&gt;
    &lt;!-- &lt;path_to_regions_names_files&gt;/opt/geo/&lt;/path_to_regions_names_files&gt; --&gt;


    &lt;!-- Configuration of external dictionaries. See:
         https://clickhouse.yandex/docs/en/dicts/external_dicts/
    --&gt;
    &lt;dictionaries_config&gt;*_dictionary.xml&lt;/dictionaries_config&gt;

    &lt;!-- Uncomment if you want data to be compressed 30-100% better.
         Don't do that if you just started using ClickHouse.
      --&gt;
    &lt;compression incl="clickhouse_compression"&gt;
    &lt;!--
        &lt;!- - Set of variants. Checked in order. Last matching case wins. If nothing matches, lz4 will be used. - -&gt;
        &lt;case&gt;

            &lt;!- - Conditions. All must be satisfied. Some conditions may be omitted. - -&gt;
            &lt;min_part_size&gt;10000000000&lt;/min_part_size&gt;        &lt;!- - Min part size in bytes. - -&gt;
            &lt;min_part_size_ratio&gt;0.01&lt;/min_part_size_ratio&gt;   &lt;!- - Min size of part relative to whole table size. - -&gt;

            &lt;!- - What compression method to use. - -&gt;
            &lt;method&gt;zstd&lt;/method&gt;
        &lt;/case&gt;
    --&gt;
    &lt;/compression&gt;

    &lt;!-- Allow to execute distributed DDL queries (CREATE, DROP, ALTER, RENAME) on cluster.
         Works only if ZooKeeper is enabled. Comment it if such functionality isn't required. --&gt;
    &lt;distributed_ddl&gt;
        &lt;!-- Path in ZooKeeper to queue with DDL queries --&gt;
        &lt;path&gt;/clickhouse/task_queue/ddl&lt;/path&gt;

        &lt;!-- Settings from this profile will be used to execute DDL queries --&gt;
        &lt;!-- &lt;profile&gt;default&lt;/profile&gt; --&gt;

        &lt;!-- Controls how much ON CLUSTER queries can be run simultaneously. --&gt;
        &lt;!-- &lt;pool_size&gt;1&lt;/pool_size&gt; --&gt;
    &lt;/distributed_ddl&gt;

    &lt;!-- Settings to fine tune MergeTree tables. See documentation in source code, in MergeTreeSettings.h --&gt;
    &lt;!--
    &lt;merge_tree&gt;
        &lt;max_suspicious_broken_parts&gt;5&lt;/max_suspicious_broken_parts&gt;
    &lt;/merge_tree&gt;
    --&gt;

    &lt;!-- Protection from accidental DROP.
         If size of a MergeTree table is greater than max_table_size_to_drop (in bytes) than table could not be dropped with any DROP query.
         If you want do delete one table and don't want to change clickhouse-server config, you could create special file &lt;clickhouse-path&gt;/flags/force_drop_table and make DROP once.
         By default max_table_size_to_drop is 50GB; max_table_size_to_drop=0 allows to DROP any tables.
         The same for max_partition_size_to_drop.
         Uncomment to disable protection.
    --&gt;
    &lt;!-- &lt;max_table_size_to_drop&gt;0&lt;/max_table_size_to_drop&gt; --&gt;
    &lt;!-- &lt;max_partition_size_to_drop&gt;0&lt;/max_partition_size_to_drop&gt; --&gt;

    &lt;!-- Example of parameters for GraphiteMergeTree table engine --&gt;
    &lt;graphite_rollup_example&gt;
        &lt;pattern&gt;
            &lt;regexp&gt;click_cost&lt;/regexp&gt;
            &lt;function&gt;any&lt;/function&gt;
            &lt;retention&gt;
                &lt;age&gt;0&lt;/age&gt;
                &lt;precision&gt;3600&lt;/precision&gt;
            &lt;/retention&gt;
            &lt;retention&gt;
                &lt;age&gt;86400&lt;/age&gt;
                &lt;precision&gt;60&lt;/precision&gt;
            &lt;/retention&gt;
        &lt;/pattern&gt;
        &lt;default&gt;
            &lt;function&gt;max&lt;/function&gt;
            &lt;retention&gt;
                &lt;age&gt;0&lt;/age&gt;
                &lt;precision&gt;60&lt;/precision&gt;
            &lt;/retention&gt;
            &lt;retention&gt;
                &lt;age&gt;3600&lt;/age&gt;
                &lt;precision&gt;300&lt;/precision&gt;
            &lt;/retention&gt;
            &lt;retention&gt;
                &lt;age&gt;86400&lt;/age&gt;
                &lt;precision&gt;3600&lt;/precision&gt;
            &lt;/retention&gt;
        &lt;/default&gt;
    &lt;/graphite_rollup_example&gt;

    &lt;!-- Directory in &lt;clickhouse-path&gt; containing schema files for various input formats.
         The directory will be created if it doesn't exist.
      --&gt;
    &lt;format_schema_path&gt;/data/clickhouse/format_schemas/&lt;/format_schema_path&gt;

    &lt;!-- Uncomment to use query masking rules.
        name - name for the rule (optional)
        regexp - RE2 compatible regular expression (mandatory)
        replace - substitution string for sensitive data (optional, by default - six asterisks)
    &lt;query_masking_rules&gt;
        &lt;rule&gt;
            &lt;name&gt;hide SSN&lt;/name&gt;
            &lt;regexp&gt;\b\d{3}-\d{2}-\d{4}\b&lt;/regexp&gt;
            &lt;replace&gt;000-00-0000&lt;/replace&gt;
        &lt;/rule&gt;
    &lt;/query_masking_rules&gt;
    --&gt;

    &lt;!-- Uncomment to use custom http handlers.
        rules are checked from top to bottom, first match runs the handler
            url - to match request URL, you can use 'regex:' prefix to use regex match(optional)
            methods - to match request method, you can use commas to separate multiple method matches(optional)
            headers - to match request headers, match each child element(child element name is header name), you can use 'regex:' prefix to use regex match(optional)
        handler is request handler
            type - supported types: static, dynamic_query_handler, predefined_query_handler
            query - use with predefined_query_handler type, executes query when the handler is called
            query_param_name - use with dynamic_query_handler type, extracts and executes the value corresponding to the &lt;query_param_name&gt; value in HTTP request params
            status - use with static type, response status code
            content_type - use with static type, response content-type
            response_content - use with static type, Response content sent to client, when using the prefix 'file://' or 'config://', find the content from the file or configuration send to client.

    &lt;http_handlers&gt;
        &lt;rule&gt;
            &lt;url&gt;/&lt;/url&gt;
            &lt;methods&gt;POST,GET&lt;/methods&gt;
            &lt;headers&gt;&lt;pragma&gt;no-cache&lt;/pragma&gt;&lt;/headers&gt;
            &lt;handler&gt;
                &lt;type&gt;dynamic_query_handler&lt;/type&gt;
                &lt;query_param_name&gt;query&lt;/query_param_name&gt;
            &lt;/handler&gt;
        &lt;/rule&gt;

        &lt;rule&gt;
            &lt;url&gt;/predefined_query&lt;/url&gt;
            &lt;methods&gt;POST,GET&lt;/methods&gt;
            &lt;handler&gt;
                &lt;type&gt;predefined_query_handler&lt;/type&gt;
                &lt;query&gt;SELECT * FROM system.settings&lt;/query&gt;
            &lt;/handler&gt;
        &lt;/rule&gt;

        &lt;rule&gt;
            &lt;handler&gt;
                &lt;type&gt;static&lt;/type&gt;
                &lt;status&gt;200&lt;/status&gt;
                &lt;content_type&gt;text/plain; charset=UTF-8&lt;/content_type&gt;
                &lt;response_content&gt;config://http_server_default_response&lt;/response_content&gt;
            &lt;/handler&gt;
        &lt;/rule&gt;
    &lt;/http_handlers&gt;
    --&gt;

    &lt;!-- Uncomment to disable ClickHouse internal DNS caching. --&gt;
    &lt;!-- &lt;disable_internal_dns_cache&gt;1&lt;/disable_internal_dns_cache&gt; --&gt;
&lt;/yandex&gt;
</code></pre> 
<p>就是插入了这段</p> 
<pre><code>## 用来存储创建的用户和角色
&lt;access_control_path&gt;/data/work/clickhouse/access/&lt;/access_control_path&gt;

## 此配置必须有 否则会报
## DB::Exception: Not found a storage to insert user</code></pre> 
<p>剩下的用户用sql的方式创建 </p> 
<h4>创建普通用户</h4> 
<p>普通用户是权限作用的实体，可以设置独立的密码和操作范围，业务人员通过登陆不同的账户来行使不同的数据权限。</p> 
<ul><li>create user</li></ul> 
<p>CREATE USER chanpin818  IDENTIFIED WITH PLAINTEXT_PASSWORD BY 'chanpin818'</p> 
<h4>权限管理</h4> 
<ul><li>授权</li></ul> 
<p>grant all on chanpin818.* to chanpin818 ;</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/47a0eefe065b4a2b94fc8f45a4e6c49a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">华为机考攻略(python)--查找排序【7题】(第二题*HJ14字符串排序)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f080a64b67d5a4ce528fec413357b5cb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">树莓派实现温控风扇智能降温</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>