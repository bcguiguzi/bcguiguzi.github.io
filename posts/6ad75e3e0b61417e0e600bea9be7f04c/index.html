<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vue中webSocket&#43;webRtc实现多人会议，webRtc实现 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Vue中webSocket&#43;webRtc实现多人会议，webRtc实现" />
<meta property="og:description" content="前提 已经搭建好websocket双端通信（可以先模拟），用于实时交换双方信息。交换的信息也就是所谓的信令。实现webRtc进行多人会议，屏幕共享、摄像头共享。
我这里定义的websocket信息格式如下
发给某个人，下面会用【消息格式one】指代
{ &#34;body&#34;: {}, &#34;code&#34;: &#34;10003&#34;,//自定义标识（我自定义区分消息来源用的） &#34;data&#34;: { &#34;description&#34;: { &#34;type&#34;: &#34;answer&#34;, &#34;sdp&#34;: &#34;v=0\r\no=- 700908093190320106 2 IN IP4...&#34; },//需要交换的信息 &#34;meetId&#34;: &#34;852229c8c454453da6e0b5e99a8407c8&#34;,//会议id &#34;pageNum&#34;: 0, &#34;pageSize&#34;: 0, &#34;receiveId&#34;: &#34;ed986a7b3dbb407e846f76fad909f07d&#34;,//接收人Id &#34;sendId&#34;: &#34;c0f1094a363949f88f618f5edb5ecaf8&#34;,//发送人Id &#34;type&#34;: &#34;answer&#34;//信息分类 }, &#34;msg&#34;: &#34;meetingMessage&#34;, &#34;success&#34;: true } 发给会议中所有人，下面会用【消息格式all】指代
{ &#34;body&#34;: {}, &#34;code&#34;: &#34;10003&#34;, &#34;data&#34;: { &#34;meetId&#34;: &#34;852229c8c454453da6e0b5e99a8407c8&#34;,//会议id &#34;pageNum&#34;: 0, &#34;pageSize&#34;: 0, &#34;sendId&#34;: &#34;c0f1094a363949f88f618f5edb5ecaf8&#34;,//发送人Id &#34;type&#34;: &#34;new&#34;//信息分类 }, &#34;msg&#34;: &#34;meetingMessage&#34;, &#34;success&#34;: true } 简单说明逻辑 当用户A进入会议时，向所有人发送【消息格式all】,通知有人加入了会议，然后其他人（取一人B代指）将主动与A取得联系。
B创建一个专门与A交流的webRtc连接（ new RTCPeerConnection(undefined)）。将打开的媒体流流加载到连接中B创建完这个webRtc连接后生成一个请求连接的信息通过【消息格式one】发给A，这里面有B的sdp信息，并且自己也存一份，发送建立连接请求webRtc中叫offer。然后A收到offer时，也创建一个专门与B交流的webRtc连接（ new RTCPeerConnection(undefined)）。然后将B的信息存下来，再生成自己的信息发给B，这里面有A的sdp信息，webRtc中这个过程叫应答answer。创建的webRtc连接的时候会使用一个监听器，能监听自己的candidate候选信息有没有制作完，这里面是ice的信息。A跟B都要监听，制作完后发给对方，对方再存到webRtc连接中，到此双方连接完成。当一方的媒体源改变时（关闭/打开 麦克风/摄像头/共享桌面），通知其他人连接过期，然后进行以上步骤进行重新连接（除了加入的媒体流不一样，其他一样） 代码参考 打开页面告诉其他人加入会议，这个调用的接口，后台用webSocket发给了其他人" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/6ad75e3e0b61417e0e600bea9be7f04c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-31T15:45:03+08:00" />
<meta property="article:modified_time" content="2024-01-31T15:45:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vue中webSocket&#43;webRtc实现多人会议，webRtc实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前提</h2> 
<p>已经搭建好<code>websocket</code>双端通信（可以先模拟），用于实时交换双方信息。交换的信息也就是所谓的信令。实现<code>webRtc</code>进行多人会议，屏幕共享、摄像头共享。</p> 
<p>我这里定义的websocket信息格式如下</p> 
<blockquote> 
 <p>发给某个人，下面会用【消息格式one】指代</p> 
</blockquote> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"body"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"code"</span><span class="token operator">:</span> <span class="token string">"10003"</span><span class="token punctuation">,</span><span class="token comment">//自定义标识（我自定义区分消息来源用的）</span>
    <span class="token string-property property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"description"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"answer"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"sdp"</span><span class="token operator">:</span> <span class="token string">"v=0\r\no=- 700908093190320106 2 IN IP4..."</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//需要交换的信息</span>
        <span class="token string-property property">"meetId"</span><span class="token operator">:</span> <span class="token string">"852229c8c454453da6e0b5e99a8407c8"</span><span class="token punctuation">,</span><span class="token comment">//会议id</span>
        <span class="token string-property property">"pageNum"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string-property property">"pageSize"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string-property property">"receiveId"</span><span class="token operator">:</span> <span class="token string">"ed986a7b3dbb407e846f76fad909f07d"</span><span class="token punctuation">,</span><span class="token comment">//接收人Id</span>
        <span class="token string-property property">"sendId"</span><span class="token operator">:</span> <span class="token string">"c0f1094a363949f88f618f5edb5ecaf8"</span><span class="token punctuation">,</span><span class="token comment">//发送人Id</span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"answer"</span><span class="token comment">//信息分类</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"msg"</span><span class="token operator">:</span> <span class="token string">"meetingMessage"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>发给会议中所有人，下面会用【消息格式all】指代</p> 
</blockquote> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"body"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"code"</span><span class="token operator">:</span> <span class="token string">"10003"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"meetId"</span><span class="token operator">:</span> <span class="token string">"852229c8c454453da6e0b5e99a8407c8"</span><span class="token punctuation">,</span><span class="token comment">//会议id</span>
        <span class="token string-property property">"pageNum"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string-property property">"pageSize"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string-property property">"sendId"</span><span class="token operator">:</span> <span class="token string">"c0f1094a363949f88f618f5edb5ecaf8"</span><span class="token punctuation">,</span><span class="token comment">//发送人Id</span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"new"</span><span class="token comment">//信息分类</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"msg"</span><span class="token operator">:</span> <span class="token string">"meetingMessage"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_43"></a>简单说明逻辑</h2> 
<p>当用户<code>A</code>进入会议时，向所有人发送【消息格式all】,通知有人加入了会议，然后其他人（取一人<code>B</code>代指）将主动与<code>A</code>取得联系。</p> 
<ul><li><code>B</code>创建一个专门与<code>A</code>交流的<code>webRtc</code>连接（<code> new RTCPeerConnection(undefined)</code>）。将打开的媒体流流加载到连接中</li><li><code>B</code>创建完这个<code>webRtc</code>连接后生成一个请求连接的信息通过【消息格式one】发给<code>A</code>，这里面有<code>B</code>的<code>sdp</code>信息，并且自己也存一份，发送建立连接请求<code>webRtc</code>中叫<code>offer</code>。</li><li>然后<code>A</code>收到<code>offer</code>时，也创建一个专门与<code>B</code>交流的<code>webRtc</code>连接（<code> new RTCPeerConnection(undefined)</code>）。然后将<code>B</code>的信息存下来，再生成自己的信息发给<code>B</code>，这里面有<code>A</code>的<code>sdp</code>信息，<code>webRtc</code>中这个过程叫应答<code>answer</code>。</li><li>创建的<code>webRtc</code>连接的时候会使用一个监听器，能监听自己的<code>candidate</code>候选信息有没有制作完，这里面是<code>ice</code>的信息。<code>A</code>跟<code>B</code>都要监听，制作完后发给对方，对方再存到<code>webRtc</code>连接中，到此双方连接完成。</li><li>当一方的媒体源改变时（关闭/打开 麦克风/摄像头/共享桌面），通知其他人连接过期，然后进行以上步骤进行重新连接（除了加入的媒体流不一样，其他一样）</li></ul> 
<h2><a id="_51"></a>代码参考</h2> 
<p>打开页面告诉其他人加入会议，这个调用的接口，后台用<code>webSocket</code>发给了其他人</p> 
<pre><code class="prism language-js"><span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">/**打开页面告诉其他人加入*/</span>
    meetingInfoApi<span class="token punctuation">.</span><span class="token function">sentMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'new'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">meetId</span><span class="token operator">:</span> props<span class="token punctuation">.</span>id<span class="token punctuation">,</span><span class="token comment">//这个是会议的id，我这是个组件，从父组件传过来的</span>
      <span class="token literal-property property">sendId</span><span class="token operator">:</span> data<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>value<span class="token punctuation">.</span>id<span class="token punctuation">,</span><span class="token comment">//这个是获取的登录人的id，作为唯一标识用</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>监听<code>webSocket</code>返回，我这里用了一个对象用来存跟会议中其他人沟通的<code>webRtc</code>连接，如果只是一对一，可以声明一个存连接的变量就行<br> 这个是声明的变量</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> cameraVideo <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//video标签的ref引用</span>

<span class="token keyword">const</span> connectList <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//用来存跟其他人连接的rtc连接</span>
<span class="token keyword">const</span> mediaStream <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//用来存媒体信息</span>
<span class="token keyword">const</span> usersList<span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//用来存其他用户信息</span>
</code></pre> 
<p>工具方法，看<code>connectList </code>中有没有请求连接人的专属连接，没有就创建一个</p> 
<pre><code class="prism language-js"> <span class="token comment">/**有用户请求连接，生成对应的本地连接保存下来，下次直接用*/</span>
<span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> connection <span class="token operator">=</span> data<span class="token punctuation">.</span>connectList<span class="token punctuation">.</span>value<span class="token operator">?.</span><span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>connection<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> cof <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">iceServers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 目前免费STUN 服务器</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">urls</span><span class="token operator">:</span> <span class="token string">'stun:stun.voipbuster.com '</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    connection<span class="token punctuation">.</span><span class="token function-variable function">ontrack</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      methods<span class="token punctuation">.</span><span class="token function">onAddStream</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"监听ice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function-variable function">onicecandidate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//生成完自己的候选信息后发给这个连接对应的人</span>
        meetingInfoApi<span class="token punctuation">.</span><span class="token function">sentMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"candidate"</span><span class="token punctuation">,</span>
          <span class="token literal-property property">meetId</span><span class="token operator">:</span> props<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
          <span class="token literal-property property">sendId</span><span class="token operator">:</span> data<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>value<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
          <span class="token literal-property property">receiveId</span><span class="token operator">:</span> userId<span class="token punctuation">,</span>
          <span class="token literal-property property">label</span><span class="token operator">:</span> event<span class="token punctuation">.</span>candidate<span class="token punctuation">.</span>sdpMLineIndex<span class="token punctuation">,</span>
          <span class="token literal-property property">sdpMid</span><span class="token operator">:</span> event<span class="token punctuation">.</span>candidate<span class="token punctuation">.</span>sdpMid<span class="token punctuation">,</span>
          <span class="token literal-property property">candidate</span><span class="token operator">:</span> event<span class="token punctuation">.</span>candidate<span class="token punctuation">.</span>candidate<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"End of candidates."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//加载媒体流</span>
    data<span class="token punctuation">.</span>mediaStream<span class="token punctuation">.</span>value<span class="token operator">?.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">track</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      connection<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>track<span class="token punctuation">,</span> data<span class="token punctuation">.</span>mediaStream<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>platformStream<span class="token punctuation">.</span>value<span class="token operator">?.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">track</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      connection<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>track<span class="token punctuation">,</span> data<span class="token punctuation">.</span>platformStream<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    data<span class="token punctuation">.</span>connectList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>userId<span class="token punctuation">]</span> <span class="token operator">=</span> connection<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> connection<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token comment">/**有媒体流传过来时在video中播放*/</span>
<span class="token function">onAddStream</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> userId</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>streams<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     	<span class="token comment">//之后会测试怎么传媒体标识，用来区分是桌面共享还是摄像头，然后显示在不同的位置</span>
        cameraVideo<span class="token punctuation">.</span>value<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> event<span class="token punctuation">.</span>streams<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>这里是监听<code>websocket</code>发送消息的，是服务器主动给前端发的</p> 
<pre><code class="prism language-js"><span class="token comment">//监听接收消息</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'receive'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>detail<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>success <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">"10003"</span> <span class="token operator">&amp;&amp;</span> props<span class="token punctuation">.</span>drawer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> connection <span class="token operator">=</span> methods<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">)</span>
    <span class="token comment">//用户列表增加一个人</span>
    <span class="token keyword">let</span> send <span class="token operator">=</span> data<span class="token punctuation">.</span>usersList<span class="token punctuation">.</span>value<span class="token operator">?.</span><span class="token punctuation">[</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>send<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      data<span class="token punctuation">.</span>usersList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendName<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>connection<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">/**有新用户加入，主动发送offer进行连接*/</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"new"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> offerOptions <span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">offerToReceiveAudio</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">offerToReceiveVideo</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        connection<span class="token punctuation">.</span><span class="token function">createOffer</span><span class="token punctuation">(</span>offerOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sessionDescription</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          connection<span class="token punctuation">.</span><span class="token function">setLocalDescription</span><span class="token punctuation">(</span>sessionDescription<span class="token punctuation">)</span>
          meetingInfoApi<span class="token punctuation">.</span><span class="token function">sentMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">meetId</span><span class="token operator">:</span> props<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
            <span class="token literal-property property">sendId</span><span class="token operator">:</span> data<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>value<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
            <span class="token literal-property property">receiveId</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'offer'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">description</span><span class="token operator">:</span> sessionDescription
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"offer"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**接收到offer，将对方sdp保存到对应的连接中，发送应答信息*/</span>
        connection<span class="token punctuation">.</span><span class="token function">setRemoteDescription</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RTCSessionDescription</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">createAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sessionDescription</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          connection<span class="token punctuation">.</span><span class="token function">setLocalDescription</span><span class="token punctuation">(</span>sessionDescription<span class="token punctuation">)</span>
          meetingInfoApi<span class="token punctuation">.</span><span class="token function">sentMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">meetId</span><span class="token operator">:</span> props<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
            <span class="token literal-property property">sendId</span><span class="token operator">:</span> data<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>value<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
            <span class="token literal-property property">receiveId</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'answer'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">description</span><span class="token operator">:</span> sessionDescription
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"answer"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**接收到应答信息，保存sdp在本地对应的连接中*/</span>
        connection<span class="token punctuation">.</span><span class="token function">setRemoteDescription</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RTCSessionDescription</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"candidate"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**接收到他人的候选信息，保存在本地对应的连接中*/</span>
        <span class="token keyword">const</span> candidate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCIceCandidate</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">sdpMid</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sdpMid<span class="token punctuation">,</span>
          <span class="token literal-property property">sdpMLineIndex</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>label<span class="token punctuation">,</span>
          <span class="token literal-property property">candidate</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>candidate<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">addIceCandidate</span><span class="token punctuation">(</span>candidate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"leave"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**有人离开，关闭他的连接*/</span>
        data<span class="token punctuation">.</span>connectList<span class="token punctuation">.</span>value<span class="token operator">?.</span><span class="token punctuation">[</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">delete</span> data<span class="token punctuation">.</span>usersList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">]</span>
        <span class="token keyword">delete</span> data<span class="token punctuation">.</span>connectList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"change"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**有人修改了媒体源，关闭他的连接*/</span>
        data<span class="token punctuation">.</span>connectList<span class="token punctuation">.</span>value<span class="token operator">?.</span><span class="token punctuation">[</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        data<span class="token punctuation">.</span>usersList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">]</span><span class="token punctuation">.</span>mediaStream <span class="token operator">=</span> <span class="token keyword">undefined</span>
        <span class="token keyword">delete</span> data<span class="token punctuation">.</span>connectList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sendId<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>下面是发送媒体示例</p> 
<p>当按钮状态发生变化时调用</p> 
<pre><code class="prism language-js"><span class="token function">mediaChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">let</span>  muteClose <span class="token operator">=</span> data<span class="token punctuation">.</span>muteClose<span class="token punctuation">.</span>value<span class="token comment">//麦克风</span>
	<span class="token keyword">let</span>  cameraClose <span class="token operator">=</span> data<span class="token punctuation">.</span>cameraClose<span class="token punctuation">.</span>value<span class="token comment">//摄像头</span>
	<span class="token keyword">let</span>  platformClose <span class="token operator">=</span> data<span class="token punctuation">.</span>platformClose<span class="token punctuation">.</span>value<span class="token comment">//桌面共享</span>
	
	<span class="token comment">//关闭所有连接</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>connectList<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> valueKey <span class="token keyword">in</span> data<span class="token punctuation">.</span>connectList<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	    data<span class="token punctuation">.</span>connectList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>valueKey<span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	  <span class="token punctuation">}</span>
	  data<span class="token punctuation">.</span>connectList<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	
	  meetingInfoApi<span class="token punctuation">.</span><span class="token function">sentMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'change'</span><span class="token punctuation">,</span>
	    <span class="token literal-property property">meetId</span><span class="token operator">:</span> props<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
	    <span class="token literal-property property">sendId</span><span class="token operator">:</span> data<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>value<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//关闭媒体</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>muteClose <span class="token operator">||</span> cameraClose<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>mediaStream<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	  data<span class="token punctuation">.</span>mediaStream<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">track</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	    track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  data<span class="token punctuation">.</span>mediaStream<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>platformClose <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>platformStream<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	  data<span class="token punctuation">.</span>platformStream<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">track</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	    track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  data<span class="token punctuation">.</span>platformStream<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>muteClose <span class="token operator">&amp;&amp;</span> cameraClose <span class="token operator">&amp;&amp;</span> platformClose<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>muteClose <span class="token operator">||</span> <span class="token operator">!</span>cameraClose<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>mediaStream<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	    methods<span class="token punctuation">.</span><span class="token function">getMedia</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	  <span class="token punctuation">}</span>
	  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>platformClose <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>platformStream<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	    methods<span class="token punctuation">.</span><span class="token function">getDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	  <span class="token punctuation">}</span>
	  <span class="token comment">//只要有一个没有关闭，就通知所有人进行重新连接</span>
	  meetingInfoApi<span class="token punctuation">.</span><span class="token function">sentMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'new'</span><span class="token punctuation">,</span>
	    <span class="token literal-property property">meetId</span><span class="token operator">:</span> props<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
	    <span class="token literal-property property">sendId</span><span class="token operator">:</span> data<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>value<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>打开麦克风/摄像头</p> 
<pre><code class="prism language-js"><span class="token function">getMedia</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">let</span> muteClose <span class="token operator">=</span> data<span class="token punctuation">.</span>muteClose<span class="token punctuation">.</span>value
   <span class="token keyword">let</span> cameraClose <span class="token operator">=</span> data<span class="token punctuation">.</span>cameraClose<span class="token punctuation">.</span>value
   <span class="token keyword">let</span> cof <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
     <span class="token literal-property property">video</span><span class="token operator">:</span> cameraClose <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> data<span class="token punctuation">.</span>enumerateDevicesVideoCheck<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">exact</span><span class="token operator">:</span> data<span class="token punctuation">.</span>enumerateDevicesVideoCheck<span class="token punctuation">.</span>value<span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
     <span class="token literal-property property">audio</span><span class="token operator">:</span> muteClose <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> data<span class="token punctuation">.</span>enumerateDevicesAudioInputCheck<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">exact</span><span class="token operator">:</span> data<span class="token punctuation">.</span>enumerateDevicesAudioInputCheck<span class="token punctuation">.</span>value<span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span>
   navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>cof<span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">stream</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
         data<span class="token punctuation">.</span>mediaStream<span class="token punctuation">.</span>value <span class="token operator">=</span> stream<span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">无法获取摄像头/麦克风：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>打开屏幕共享</p> 
<pre><code class="prism language-js"> <span class="token function">getDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getDisplayMedia</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">video</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">audio</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">stream</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      data<span class="token punctuation">.</span>platformStream<span class="token punctuation">.</span>value <span class="token operator">=</span> stream<span class="token punctuation">;</span>
      cameraVideo<span class="token punctuation">.</span>value<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> data<span class="token punctuation">.</span>platformStream<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">无法获取屏幕共享：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p><strong>根据官方的描述，对等端建立连接后任意一方进行<code>addTrack</code>时，另一方是可以通过<code>onTrack</code>监听到的，但是我在实际使用中并没有监听到，如果可以的话，就不用频繁的关闭建立连接，还要再研究下</strong><br> <img src="https://images2.imgbox.com/4f/55/1OF17Y07_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d8093cfce099dae9b5b060aa66d41397/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python代码画动态烟花源码,烟花代码编程python复制</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/75b0c276cebdc926a70a1489f8bdd90e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JAVA项目日志管理（包含各种类型日志解决方案，超详细）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>