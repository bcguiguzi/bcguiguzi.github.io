<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C#中网口数据（TCP/IP）发送与接收的主动模式与被动模式解析 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C#中网口数据（TCP/IP）发送与接收的主动模式与被动模式解析" />
<meta property="og:description" content="在C#中，进行网络数据传输时，我们常常需要通过串口（网口）来进行数据的发送与接收。在串口通信中，有两种主要的通信模式：主动模式和被动模式。本文将详细阐述这两种模式之间的区别，以及在实际应用中的不同场景和优势。
1.主动模式与被动模式的区别 1.1主动模式（Active Mode） 在主动模式下，通信双方中的主动方（通常为主机）负责发起数据传输请求，而被动方（通常为从机）则处于被动接收的状态。
特点
主动方负责发起连接和数据传输，控制权在主动方手中。被动方只需响应主动方的请求，无需主动发起通信。通常适用于客户端-服务器架构。 优势
易于管理和控制，因为主动方可以决定何时发送数据。在某些应用场景中，如实时监控系统，可以确保数据的实时性和准确性。 局限性与适用性
局限性：主动模式下，如果主动方发送数据过快，而被动方处理数据较慢，可能导致数据丢失或缓冲区溢出。适用性：适用于客户端需要周期性获取数据的应用场景，如远程监控、数据采集等。 1.2 被动模式（Passive Mode） 在被动模式下，通信双方中的被动方（通常为主机）负责等待数据传输请求，而主动方（通常为从机）则负责发起请求。
特点
被动方负责等待并接收数据，控制权在被动方手中。主动方在需要发送数据时，主动发起请求，但需等待被动方的响应。通常适用于点对点通信。 优势
适用于从机数量较多的场景，因为每个从机仅需响应来自主机的请求。可以有效避免数据冲突和网络拥塞，因为从机不会同时发送数据。 局限性与适用性
局限性：被动模式下，如果从机数量较多，主机可能会面临较大的响应压力。适用性：适用于从机数量较多，且通信较为简单的应用场景，如家居自动化、小型局域网等。 2.主动模式与被动模式的应用实例 2.1 主动模式（Active Mode） 在主动模式下，客户端负责发起网络连接。客户端知道服务器的IP地址和端口，因此它会向这些信息发起TCP连接。客户端会主动向服务器发送数据，并等待服务器响应。
客户端代码
using System; using System.Net.Sockets; using System.Text; using System.Threading; class TcpClientExample { public void SendReceiveData(string serverIp, int serverPort) { try { TcpClient client = new TcpClient(serverIp, serverPort); NetworkStream stream = client.GetStream(); byte[] data = Encoding.ASCII.GetBytes(&#34;Hello, Server!&#34;); stream.Write(data, 0, data.Length); byte[] buffer = new byte[1024]; int read = stream." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/8c2cfa3104b51d197558b3c50d737843/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-15T20:06:22+08:00" />
<meta property="article:modified_time" content="2024-03-15T20:06:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C#中网口数据（TCP/IP）发送与接收的主动模式与被动模式解析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在C#中，进行网络数据传输时，我们常常需要通过串口（网口）来进行数据的发送与接收。在串口通信中，有两种主要的通信模式：主动模式和被动模式。本文将详细阐述这两种模式之间的区别，以及在实际应用中的不同场景和优势。</p> 
<h2><a id="1_2"></a>1.主动模式与被动模式的区别</h2> 
<h3><a id="11Active_Mode_4"></a>1.1主动模式（Active Mode）</h3> 
<p>在主动模式下，通信双方中的主动方（通常为主机）负责发起数据传输请求，而被动方（通常为从机）则处于被动接收的状态。<br> <strong>特点</strong></p> 
<ul><li>主动方负责发起连接和数据传输，控制权在主动方手中。</li><li>被动方只需响应主动方的请求，无需主动发起通信。</li><li>通常适用于客户端-服务器架构。</li></ul> 
<p><strong>优势</strong></p> 
<ul><li>易于管理和控制，因为主动方可以决定何时发送数据。</li><li>在某些应用场景中，如实时监控系统，可以确保数据的实时性和准确性。</li></ul> 
<p><strong>局限性与适用性</strong></p> 
<ul><li>局限性：主动模式下，如果主动方发送数据过快，而被动方处理数据较慢，可能导致数据丢失或缓冲区溢出。</li><li>适用性：适用于客户端需要周期性获取数据的应用场景，如远程监控、数据采集等。</li></ul> 
<h3><a id="12_Passive_Mode_21"></a>1.2 被动模式（Passive Mode）</h3> 
<p>在被动模式下，通信双方中的被动方（通常为主机）负责等待数据传输请求，而主动方（通常为从机）则负责发起请求。<br> <strong>特点</strong></p> 
<ul><li>被动方负责等待并接收数据，控制权在被动方手中。</li><li>主动方在需要发送数据时，主动发起请求，但需等待被动方的响应。</li><li>通常适用于点对点通信。</li></ul> 
<p><strong>优势</strong></p> 
<ul><li>适用于从机数量较多的场景，因为每个从机仅需响应来自主机的请求。</li><li>可以有效避免数据冲突和网络拥塞，因为从机不会同时发送数据。</li></ul> 
<p><strong>局限性与适用性</strong></p> 
<ul><li>局限性：被动模式下，如果从机数量较多，主机可能会面临较大的响应压力。</li><li>适用性：适用于从机数量较多，且通信较为简单的应用场景，如家居自动化、小型局域网等。</li></ul> 
<h2><a id="2_37"></a>2.主动模式与被动模式的应用实例</h2> 
<h3><a id="21_Active_Mode_39"></a>2.1 主动模式（Active Mode）</h3> 
<p>在主动模式下，客户端负责发起网络连接。客户端知道服务器的IP地址和端口，因此它会向这些信息发起TCP连接。客户端会主动向服务器发送数据，并等待服务器响应。<br> <strong>客户端代码</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Sockets</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">TcpClientExample</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SendReceiveData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> serverIp<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> serverPort<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">TcpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TcpClient</span><span class="token punctuation">(</span>serverIp<span class="token punctuation">,</span> serverPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">NetworkStream</span> stream <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> data <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"Hello, Server!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stream<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> read <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> receivedData <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Received data from server: "</span> <span class="token operator">+</span> receivedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SocketException</span> socketException<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"SocketException "</span> <span class="token operator">+</span> socketException<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>服务器代码</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Sockets</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">TcpServerExample</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">TcpListener</span> tcpListener<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Thread</span> tcpListenerThread<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StartServer</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> port<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        tcpListenerThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">ListenForIncomingRequests</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tcpListenerThread<span class="token punctuation">.</span>IsBackground <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        tcpListenerThread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ListenForIncomingRequests</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> port<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            tcpListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TcpListener</span><span class="token punctuation">(</span>IPAddress<span class="token punctuation">.</span>Any<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tcpListener<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Byte<span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">TcpClient</span> client <span class="token operator">=</span> tcpListener<span class="token punctuation">.</span><span class="token function">AcceptTcpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">NetworkStream</span> stream <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name"><span class="token keyword">int</span></span> length<span class="token punctuation">;</span>
                        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>length <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{<!-- --></span>
                            <span class="token class-name"><span class="token keyword">var</span></span> incomingData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
                            Array<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> incomingData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name"><span class="token keyword">var</span></span> clientMessage <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>incomingData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Received data from client: "</span> <span class="token operator">+</span> clientMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> responseData <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"Received your message!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            stream<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>responseData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> responseData<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SocketException</span> socketException<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"SocketException "</span> <span class="token operator">+</span> socketException<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2_2_Passive_Mode_125"></a>2. 2 被动模式（Passive Mode）</h3> 
<p>在被动模式下，服务器被动地监听特定的端口，等待客户端发起连接。当服务器收到客户端的连接请求后，服务器会接受连接并开始通信。在这种模式下，服务器不会主动向客户端发送数据，而是等待客户端发送数据给它。</p> 
<p><strong>服务器代码</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Sockets</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">TcpServerExample</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">TcpListener</span> tcpListener<span class="token punctuation">;</span>
    <span class="token comment">//private Thread tcpListenerThread;</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ListenForIncomingRequests</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> port<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                tcpListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TcpListener</span><span class="token punctuation">(</span>IPAddress<span class="token punctuation">.</span>Any<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
                tcpListener<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Byte<span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">TcpClient</span> client <span class="token operator">=</span> tcpListener<span class="token punctuation">.</span><span class="token function">AcceptTcpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">NetworkStream</span> stream <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{<!-- --></span>
                            <span class="token class-name"><span class="token keyword">int</span></span> length<span class="token punctuation">;</span>
                            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>length <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                            <span class="token punctuation">{<!-- --></span>
                                <span class="token class-name"><span class="token keyword">var</span></span> incomingData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
                                Array<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> incomingData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token class-name"><span class="token keyword">var</span></span> clientMessage <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>incomingData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Received data from client: "</span> <span class="token operator">+</span> clientMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> responseData <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"Received your message!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                stream<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>responseData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> responseData<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SocketException</span> socketException<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"SocketException "</span> <span class="token operator">+</span> socketException<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>客户端代码</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Sockets</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TcpClientExample</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SendReceiveData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> serverIp<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> serverPort<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">TcpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TcpClient</span><span class="token punctuation">(</span>serverIp<span class="token punctuation">,</span> serverPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">NetworkStream</span> stream <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> data <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"Hello, Server!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stream<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> read <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> receivedData <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Received data from server: "</span> <span class="token operator">+</span> receivedData<span class="token punctuation">)</span><span class="token punctuation">;</span>

            client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SocketException</span> socketException<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"SocketException "</span> <span class="token operator">+</span> socketException<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="3__209"></a>3. 总结</h2> 
<ul><li><strong>主动模式：</strong> 客户端主动发起连接，服务器被动等待连接。客户端知道服务器的IP地址和端口，并向这些信息发起TCP连接。</li><li><strong>被动模式：</strong> 服务器被动监听端口，等待客户端发起连接。服务器在接收到客户端的连接请求后，接受连接并进行数据交换。</li></ul> 
<p>在实际应用中，根据需求选择合适的模式。例如，一个简单的聊天应用程序通常使用主动模式，因为客户端需要主动向服务器发送消息。而一个网页服务器通常使用被动模式，因为它监听来自不同客户端的请求，而不是主动发送数据。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/feaed15038b0e762ab223cacd0493a50/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TCP机械臂控制</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/54a9163c2da84c0618e4381c38b13d74/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构（二）顺序表和链表</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>