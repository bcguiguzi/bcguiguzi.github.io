<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【转】证书安装指引（腾讯云） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【转】证书安装指引（腾讯云）" />
<meta property="og:description" content="下载得到的 www.domain.com.zip 文件，解压获得3个文件夹，分别是Apache、IIS、Nginx 服务器的证书文件，
下面提供了4类服务器证书安装方法的示例：
1. Apache 2.x 证书部署 1.1 获取证书 Apache文件夹内获得证书文件 1_root_bundle.crt，2_www.domain.com_cert.crt 和私钥文件 3_www.domain.com.key,
1_root_bundle.crt 文件包括一段证书代码 “-----BEGIN CERTIFICATE-----”和“-----END CERTIFICATE-----”,
2_www.domain.com_cert.crt 文件包括一段证书代码 “-----BEGIN CERTIFICATE-----”和“-----END CERTIFICATE-----”,
3_www.domain.com.key 文件包括一段私钥代码“-----BEGIN RSA PRIVATE KEY-----”和“-----END RSA PRIVATE KEY-----”。
1.2 证书安装 编辑Apache根目录下 conf/httpd.conf 文件，
找到 #LoadModule ssl_module modules/mod_ssl.so 和 #Include conf/extra/httpd-ssl.conf，去掉前面的#号注释；
编辑Apache根目录下 conf/extra/httpd-ssl.conf 文件，修改如下内容：
&lt;VirtualHost www.domain.com:443&gt; DocumentRoot &#34;/var/www/html&#34; ServerName www.domain.com SSLEngine on SSLCertificateFile /usr/local/apache/conf/2_www.domain.com_cert.crt SSLCertificateKeyFile /usr/local/apache/conf/3_www.domain.com.key SSLCertificateChainFile /usr/local/apache/conf/1_root_bundle.crt &lt;/VirtualHost&gt; 配置完成后，重新启动 Apache 就可以使用https://www.domain.com来访问了。
注：
配置文件参数说明SSLEngine on启用SSL功能SSLCertificateFile证书文件SSLCertificateKeyFile私钥文件SSLCertificateChainFile证书链文件 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/eb8beff9ed0696a87658a04d94ed53d7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-09-07T11:52:00+08:00" />
<meta property="article:modified_time" content="2017-09-07T11:52:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【转】证书安装指引（腾讯云）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p>下载得到的 www.domain.com.zip 文件，解压获得3个文件夹，分别是Apache、IIS、Nginx 服务器的证书文件，<br>下面提供了4类服务器证书安装方法的示例：</p> 
 <h4 id="1.-apache-2.x-.E8.AF.81.E4.B9.A6.E9.83.A8.E7.BD.B2">1. Apache 2.x 证书部署</h4> 
 <h5 id="1.1-.E8.8E.B7.E5.8F.96.E8.AF.81.E4.B9.A6">1.1 获取证书</h5> 
 <p>Apache文件夹内获得证书文件 1_root_bundle.crt，2_www.domain.com_cert.crt 和私钥文件 3_www.domain.com.key,<br>1_root_bundle.crt 文件包括一段证书代码 “-----BEGIN CERTIFICATE-----”和“-----END CERTIFICATE-----”,<br>2_www.domain.com_cert.crt 文件包括一段证书代码 “-----BEGIN CERTIFICATE-----”和“-----END CERTIFICATE-----”,<br>3_www.domain.com.key 文件包括一段私钥代码“-----BEGIN RSA PRIVATE KEY-----”和“-----END RSA PRIVATE KEY-----”。</p> 
 <h5 id="1.2-.E8.AF.81.E4.B9.A6.E5.AE.89.E8.A3.85">1.2 证书安装</h5> 
 <p>编辑Apache根目录下 conf/httpd.conf 文件，<br>找到 <code>#LoadModule ssl_module modules/mod_ssl.so</code> 和 <code>#Include conf/extra/httpd-ssl.conf</code>，去掉前面的<code>#</code>号注释；<br>编辑Apache根目录下 conf/extra/httpd-ssl.conf 文件，修改如下内容：</p> 
 <div class="markdown-code J-markdownCode"> 
  <div class="markdown-code-bd J-codeBox"> 
   <div class="cnblogs_Highlighter"> 
    <pre><code class="language-javascript">&lt;VirtualHost www.domain.com:443&gt;
    DocumentRoot "/var/www/html"
    ServerName www.domain.com
    SSLEngine on
    SSLCertificateFile /usr/local/apache/conf/2_www.domain.com_cert.crt
    SSLCertificateKeyFile /usr/local/apache/conf/3_www.domain.com.key
    SSLCertificateChainFile /usr/local/apache/conf/1_root_bundle.crt
&lt;/VirtualHost&gt;
</code></pre> 
   </div> 
   <p>　　</p> 
  </div> 
 </div> 
 <p>配置完成后，重新启动 Apache 就可以使用<code>https://www.domain.com</code>来访问了。</p> 
 <p>注：</p> 
 <table><thead><tr><th>配置文件参数</th><th>说明</th></tr></thead><tbody><tr><td>SSLEngine on</td><td>启用SSL功能</td></tr><tr><td>SSLCertificateFile</td><td>证书文件</td></tr><tr><td>SSLCertificateKeyFile</td><td>私钥文件</td></tr><tr><td>SSLCertificateChainFile</td><td>证书链文件</td></tr></tbody></table> 
 <h4 id="2.-nginx-.E8.AF.81.E4.B9.A6.E9.83.A8.E7.BD.B2">2. Nginx 证书部署</h4> 
 <h5 id="2.1-.E8.8E.B7.E5.8F.96.E8.AF.81.E4.B9.A6">2.1 获取证书</h5> 
 <p>Nginx文件夹内获得SSL证书文件 1_www.domain.com_bundle.crt 和私钥文件 2_www.domain.com.key,<br>1_www.domain.com_bundle.crt 文件包括两段证书代码 “-----BEGIN CERTIFICATE-----”和“-----END CERTIFICATE-----”,<br>2_www.domain.com.key 文件包括一段私钥代码“-----BEGIN RSA PRIVATE KEY-----”和“-----END RSA PRIVATE KEY-----”。</p> 
 <h5 id="2.2-.E8.AF.81.E4.B9.A6.E5.AE.89.E8.A3.85">2.2 证书安装</h5> 
 <p>将域名 www.domain.com 的证书文件1_www.domain.com_bundle.crt 、私钥文件2_www.domain.com.key保存到同一个目录，例如/usr/local/nginx/conf目录下。<br>更新Nginx根目录下 conf/nginx.conf 文件如下：</p> 
 <div class="markdown-code J-markdownCode"> 
  <div class="markdown-code-bd J-codeBox"> 
   <div class="cnblogs_Highlighter"> 
    <pre><code class="language-javascript">server {
        listen 443;
        server_name www.domain.com; #填写绑定证书的域名
        ssl on;
        ssl_certificate 1_www.domain.com_bundle.crt;
        ssl_certificate_key 2_www.domain.com.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #按照这个协议配置
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;#按照这个套件配置
        ssl_prefer_server_ciphers on;
        location / {
            root   html; #站点目录
            index  index.html index.htm;
        }
    }
</code></pre> 
   </div> 
   <p>　　</p> 
  </div> 
 </div> 
 <p>配置完成后，先用<code>bin/nginx –t</code>来测试下配置是否有误，正确无误的话，重启nginx。就可以使 <code>https://www.domain.com</code> 来访问了。</p> 
 <p>注：</p> 
 <table><thead><tr><th>配置文件参数</th><th>说明</th></tr></thead><tbody><tr><td>listen 443</td><td>SSL访问端口号为443</td></tr><tr><td>ssl on</td><td>启用SSL功能</td></tr><tr><td>ssl_certificate</td><td>证书文件</td></tr><tr><td>ssl_certificate_key</td><td>私钥文件</td></tr><tr><td>ssl_protocols</td><td>使用的协议</td></tr><tr><td>ssl_ciphers</td><td>配置加密套件，写法遵循openssl标准</td></tr></tbody></table> 
 <h5 id="2.3-.E4.BD.BF.E7.94.A8.E5.85.A8.E7.AB.99.E5.8A.A0.E5.AF.86.EF.BC.8Chttp.E8.87.AA.E5.8A.A8.E8.B7.B3.E8.BD.AChttps.EF.BC.88.E5.8F.AF.E9.80.89.EF.BC.89">2.3 使用全站加密，http自动跳转https（可选）</h5> 
 <p>对于用户不知道网站可以进行https访问的情况下，让服务器自动把http的请求重定向到https。<br>在服务器这边的话配置的话，可以在页面里加js脚本，也可以在后端程序里写重定向，当然也可以在web服务器来实现跳转。Nginx是支持rewrite的（只要在编译的时候没有去掉pcre）<br>在http的server里增加<code>rewrite ^(.*) https://$host$1 permanent;</code><br>这样就可以实现80进来的请求，重定向为https了。</p> 
 <h4 id="3.-iis-.E8.AF.81.E4.B9.A6.E9.83.A8.E7.BD.B2">3. IIS 证书部署</h4> 
 <h5 id="3.1-.E8.8E.B7.E5.8F.96.E8.AF.81.E4.B9.A6">3.1 获取证书</h5> 
 <p>IIS文件夹内获得SSL证书文件 www.domain.com.pfx。</p> 
 <h5 id="3.2-.E8.AF.81.E4.B9.A6.E5.AE.89.E8.A3.85">3.2 证书安装</h5> 
 <p>1、打开IIS服务管理器，点击计算机名称，双击‘服务器证书’<br><img src="https://images2.imgbox.com/be/9b/GPn9UwkL_o.png" alt="3.2.1"></p> 
 <p>2、双击打开服务器证书后，点击右则的导入<br><img src="https://images2.imgbox.com/d1/4f/EUJhCBAB_o.png" alt="3.2.2"></p> 
 <p>3、选择证书文件，如果输入申请证书时有填写私钥密码需要输入密码，否则输入文件夹中密码文件keystorePass.txt的密码内容，点击确定。<a href="https://cloud.tencent.com/doc/product/400/4461" rel="nofollow">参考私钥密码指引</a><br><img src="https://images2.imgbox.com/e6/36/JP5nS4aC_o.png" alt="3.2.3"></p> 
 <p>4、点击网站下的站点名称，点击右则的绑定<br><img src="https://images2.imgbox.com/ea/b4/rS4xdCUB_o.png" alt="3.2.4"></p> 
 <p>5、打开网站绑定界面后，点击添加<br><img src="https://images2.imgbox.com/53/ad/AjdcJJC1_o.png" alt="3.2.5"></p> 
 <p>6、添加网站绑定内容：选择类型为https，端口443和指定对应的SSL证书，点击确定<br><img src="https://images2.imgbox.com/4f/ce/f1bt9UEs_o.png" alt="3.2.6"></p> 
 <p>7、添加完成后，网站绑定界面将会看到刚刚添加的内容<br><img src="https://images2.imgbox.com/ff/b9/joSUWHAR_o.png" alt="3.2.7"></p> 
 <h4 id="4.-tomcat-.E8.AF.81.E4.B9.A6.E9.83.A8.E7.BD.B2">4. Tomcat 证书部署</h4> 
 <h5 id="4.1-.E8.8E.B7.E5.8F.96.E8.AF.81.E4.B9.A6">4.1 获取证书</h5> 
 <p>如果申请证书时有填写私钥密码，下载可获得Tomcat文件夹，其中有密钥库 www.domain.com.jks；<br>如果没有填写私钥密码，证书下载包的Tomcat文件夹中包括密钥库文件www.domain.com.jks 与密钥库密码文件keystorePass.txt<br>当用户选择粘贴CSR时，不提供Tomcat证书文件的下载，需要用户手动转换格式生成,操作方法如下：</p> 
 <blockquote> 
  <p>可以通过 Nginx 文件夹内证书文件和私钥文件生成jks格式证书<br>转换工具：<a href="https://www.trustasia.com/tools/cert-converter.htm" rel="nofollow">https://www.trustasia.com/tools/cert-converter.htm</a><br>使用工具时注意填写 密钥库密码 ，安装证书时配置文件中需要填写。</p> 
 </blockquote> 
 <h5 id="4.2-.E8.AF.81.E4.B9.A6.E5.AE.89.E8.A3.85">4.2 证书安装</h5> 
 <p>配置SSL连接器，将<code>www.domain.com.jks</code>文件存放到conf目录下，然后配置同目录下的<code>server.xml</code>文件：</p> 
 <div class="markdown-code J-markdownCode"> 
  <div class="markdown-code-bd J-codeBox"> 
   <div class="cnblogs_Highlighter"> 
    <pre><code class="language-csharp">&lt;Connector port="443" protocol="HTTP/1.1" SSLEnabled="true"
    maxThreads="150" scheme="https" secure="true"
    keystoreFile="conf/www.domain.com.jks"
    keystorePass="changeit"
    clientAuth="false" sslProtocol="TLS" /&gt;
</code></pre> 
   </div> 
   <p>　　</p> 
  </div> 
 </div> 
 <p>注：</p> 
 <table><thead><tr><th>配置文件参数</th><th>说明</th></tr></thead><tbody><tr><td>clientAuth</td><td>如果设为true，表示Tomcat要求所有的SSL客户出示安全证书，对SSL客户进行身份验证</td></tr><tr><td>keystoreFile</td><td>指定keystore文件的存放位置，可以指定绝对路径，也可以指定相对于&lt;catalina_home&gt; （Tomcat安装目录）环境变量的相对路径。如果此项没有设定，默认情况下，Tomcat将从当前操作系统用户的用户目录下读取名为 “.keystore”的文件。</td></tr><tr><td>keystorePass</td><td>密钥库密码，指定keystore的密码。（如果申请证书时有填写私钥密码，密钥库密码即私钥密码，否则填写密钥库密码文件中的密码）</td></tr><tr><td>sslProtocol</td><td>指定套接字（Socket）使用的加密/解密协议，默认值为TLS</td></tr></tbody></table> 
 <h5 id="4.3-http.E8.87.AA.E5.8A.A8.E8.B7.B3.E8.BD.AChttps.E7.9A.84.E5.AE.89.E5.85.A8.E9.85.8D.E7.BD.AE">4.3 http自动跳转https的安全配置</h5> 
 <p>到conf目录下的web.xml。在<code>&lt;/welcome-file-list&gt;</code>后面，<code>&lt;/web-app&gt;</code>，也就是倒数第二段里，加上这样一段</p> 
 <div class="markdown-code J-markdownCode"> 
  <div class="markdown-code-bd J-codeBox"> 
   <div class="cnblogs_Highlighter"> 
    <pre><code class="language-csharp">&lt;login-config&gt;
    &lt;!-- Authorization setting for SSL --&gt;
    &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
    &lt;realm-name&gt;Client Cert Users-only Area&lt;/realm-name&gt;
    &lt;/login-config&gt;
    &lt;security-constraint&gt;
    &lt;!-- Authorization setting for SSL --&gt;
    &lt;web-resource-collection&gt;
    &lt;web-resource-name&gt;SSL&lt;/web-resource-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;user-data-constraint&gt;
    &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;
    &lt;/security-constraint&gt;
</code></pre> 
   </div> 
   <p>　　</p> 
  </div> 
 </div> 
 <p>这步目的是让非ssl的connector跳转到ssl的connector去。所以还需要前往server.xml进行配置：</p> 
 <div class="markdown-code J-markdownCode"> 
  <div class="markdown-code-bd J-codeBox"> 
   <div class="cnblogs_Highlighter"> 
    <pre><code class="language-csharp">&lt;Connector port="8080" protocol="HTTP/1.1"
    connectionTimeout="20000"
    redirectPort="443" /&gt;
</code></pre> 
   </div> 
   <p>　　</p> 
  </div> 
 </div> 
 <p>redirectPort改成ssl的connector的端口443，重启后便会生效。</p> 
</div> 
<p>转载于:https://www.cnblogs.com/sunlyk/p/7488978.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f2a801989dd421ef20153cdf13ced0bf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">华为AR路由器QOS限速命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ae216554a5f0c9159266429630d484e4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">iCloud 与  iAd---iOS</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>