<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux ftp 服务器 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux ftp 服务器" />
<meta property="og:description" content="Linux搭建FTP服务器 - 知乎 (zhihu.com)
Linux 部署ftp服务_linux搭建ftp服务器-CSDN博客
Linux下搭建FTP服务器的方法 | 《Linux就该这么学》 (linuxprobe.com)
Linux系统ftp服务设置_linux ftp配置-CSDN博客
用户验证FTP实验_vsftp 验证-CSDN博客
一、概念简介 vsftpd（very secure FTP daemon）是Linux下的一款小巧轻快、安全易用的FTP服务器软件，本次实验介绍如何在Linux上安装并配置vsftpd。
FTP（File Transfer Protocol）是一种文件传输协议，基于客户端/服务器架构，支持以下两种工作模式：
主动模式：客户端向FTP服务器发送端口信息，由服务器主动连接该端口。被动模式：FTP服务器开启并发送端口信息给客户端，由客户端连接该端口，服务器被动接受连接。 FTP支持以下三种认证模式：
匿名用户模式：任何人无需密码验证就可以直接登录到FTP服务器，这种模式最不安全，一般只用来保存不重要的公开文件，不推荐在生产环境中使用。本地用户模式：通过Linux系统本地账号进行验证的模式，相较于匿名用户模式更安全。虚拟用户模式：FTP服务器的专有用户，虚拟用户只能访问Linux系统为其提供的FTP服务，而不能访问Linux系统的其它资源，进一步增强了FTP服务器的安全性。 二、实验过程 步骤一：安装vsftpd
1、运行以下命令安装vsftpd。
yum install -y vsftpd 2、运行以下命名查看是否安装成功。
rpm -qa | grep vsftpd 3、运行以下命令查看FTP服务是否开机自启动。
systemctl list-unit-files | grep vsftpd 4、运行以下命令设置FTP服务开机自启动。
systemctl enable vsftpd.service 5、运行以下命令查看FTP服务监听的端口。
netstat -antup | grep ftp 如下图所示，表示FTP服务已启动，监听的端口号为21，此时，vsftpd默认已开启本地用户模式，还需要继续进行配置才能正常使用FTP服务。
6、运行以下命名查看FTP服务运行状态。
service vsftpd status ftp的配置文件主要有三个，位于/etc/vsftpd/目录下，分别是：
ftpusers 该文件用来指定那些用户不能访问ftp服务器。如果要root 登陆，这里面把root用户#注销 user_list 该文件用来指示的默认账户在默认情况下也不能访问ftp vsftpd.conf vsftpd的主配置文件 步骤二：配置vsftpd
为保证数据安全，本文主要介绍被动模式下，使用本地用户访问FTP服务器的配置方法。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/1ae9ddfe767ab88e6aaa7517fa24181c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-15T11:47:42+08:00" />
<meta property="article:modified_time" content="2023-12-15T11:47:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux ftp 服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><a href="https://zhuanlan.zhihu.com/p/624591322?utm_id=0" rel="nofollow" title="Linux搭建FTP服务器 - 知乎 (zhihu.com)">Linux搭建FTP服务器 - 知乎 (zhihu.com)</a></p> 
<p><a href="https://blog.csdn.net/qq_60271706/article/details/131600167" title="Linux 部署ftp服务_linux搭建ftp服务器-CSDN博客">Linux 部署ftp服务_linux搭建ftp服务器-CSDN博客</a></p> 
<p><a href="https://www.linuxprobe.com/linux-ftpserver.html" rel="nofollow" title="Linux下搭建FTP服务器的方法 | 《Linux就该这么学》 (linuxprobe.com)">Linux下搭建FTP服务器的方法 | 《Linux就该这么学》 (linuxprobe.com)</a></p> 
<p><a href="https://blog.csdn.net/2301_78160271/article/details/131087532" title="Linux系统ftp服务设置_linux ftp配置-CSDN博客">Linux系统ftp服务设置_linux ftp配置-CSDN博客</a></p> 
<p><a href="https://blog.csdn.net/2302_77582029/article/details/130994970" title="用户验证FTP实验_vsftp 验证-CSDN博客">用户验证FTP实验_vsftp 验证-CSDN博客</a></p> 
<p></p> 
<h4><strong>一、概念简介</strong></h4> 
<p>vsftpd（very secure FTP daemon）是Linux下的一款小巧轻快、安全易用的FTP服务器软件，本次实验介绍如何在Linux上安装并配置vsftpd。</p> 
<p>FTP（File Transfer Protocol）是一种文件传输协议，基于客户端/服务器架构，支持以下两种工作模式：</p> 
<ul><li>主动模式：客户端向FTP服务器发送端口信息，由服务器主动连接该端口。</li><li>被动模式：FTP服务器开启并发送端口信息给客户端，由客户端连接该端口，服务器被动接受连接。</li></ul> 
<p><img alt="" height="269" src="https://images2.imgbox.com/61/71/hEzMXrmQ_o.png" width="971"> FTP支持以下三种认证模式：</p> 
<ul><li>匿名用户模式：任何人无需密码验证就可以直接登录到FTP服务器，这种模式最不安全，一般只用来保存不重要的公开文件，不推荐在生产环境中使用。</li><li>本地用户模式：通过Linux系统本地账号进行验证的模式，相较于匿名用户模式更安全。</li><li>虚拟用户模式：FTP服务器的专有用户，虚拟用户只能访问Linux系统为其提供的FTP服务，而不能访问Linux系统的其它资源，进一步增强了FTP服务器的安全性。 </li></ul> 
<h4>二、实验过程</h4> 
<p><strong>步骤一：安装vsftpd</strong></p> 
<p>1、运行以下命令安装vsftpd。</p> 
<pre><code>yum install -y vsftpd</code></pre> 
<p>2、运行以下命名查看是否安装成功。</p> 
<pre><code>rpm -qa | grep vsftpd</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="85" src="https://images2.imgbox.com/6d/06/MBPMSYyN_o.png" width="532"></p> 
<p>3、运行以下命令查看FTP服务是否开机自启动。</p> 
<pre><code>systemctl list-unit-files | grep vsftpd</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="125" src="https://images2.imgbox.com/0f/f9/aL0nGHH8_o.png" width="865"></p> 
<p>4、运行以下命令设置FTP服务开机自启动。</p> 
<pre><code>systemctl enable vsftpd.service</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="120" src="https://images2.imgbox.com/21/f1/CbEhBkVV_o.png" width="953"></p> 
<p>5、运行以下命令查看FTP服务监听的端口。</p> 
<pre><code>netstat -antup | grep ftp</code></pre> 
<p>如下图所示，表示FTP服务已启动，监听的端口号为21，此时，vsftpd默认已开启本地用户模式，还需要继续进行配置才能正常使用FTP服务。</p> 
<p></p> 
<p class="img-center"><img alt="" height="78" src="https://images2.imgbox.com/18/9b/dnFNN4TQ_o.png" width="1020"></p> 
<p>6、运行以下命名查看FTP服务运行状态。</p> 
<pre><code>service vsftpd status</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="241" src="https://images2.imgbox.com/26/91/fezbBM1Q_o.png" width="720"></p> 
<p>ftp的配置文件主要有三个，位于/etc/vsftpd/目录下，分别是：</p> 
<blockquote> 
 <pre>ftpusers 该文件用来指定那些用户不能访问ftp服务器。<strong>如果要root 登陆，这里面把root用户#注销</strong>
user_list 该文件用来指示的默认账户在默认情况下也不能访问ftp
vsftpd.conf vsftpd的主配置文件</pre> 
</blockquote> 
<p></p> 
<p><strong>步骤二：配置vsftpd</strong></p> 
<p>为保证数据安全，本文主要介绍<strong>被动模式</strong>下，使用<strong>本地用户</strong>访问FTP服务器的配置方法。</p> 
<p>1、运行以下命令为FTP服务创建一个Linux用户，本示例中，该用户名为ftptest。</p> 
<pre><code>adduser ftptest</code></pre> 
<p>2、运行以下命令修改ftptest用户的密码，运行命令后，根据命令行提示完成FTP用户的密码修改。（备注：此处修改密码为python@123）。</p> 
<pre><code>passwd ftptest</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="150" src="https://images2.imgbox.com/74/6a/0asbdM2K_o.png" width="570"></p> 
<p>3、运行以下命令创建一个供FTP服务使用的文件目录。</p> 
<pre><code>mkdir /var/ftp/test</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="147" src="https://images2.imgbox.com/8c/a6/zJuPMyMU_o.png" width="809"></p> 
<p>4、运行以下命令，创建测试文件，该测试文件用于FTP客户端访问FTP服务器时使用。</p> 
<pre><code>touch /var/ftp/test/testfile.txt</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="125" src="https://images2.imgbox.com/76/f1/zDd5pUK1_o.png" width="687"></p> 
<p>5、运行以下命令，通过vim编辑器在testfile.txt中写入点内容。</p> 
<pre><code>vim /var/ftp/test/testfile.txt </code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="173" src="https://images2.imgbox.com/e0/7e/h2OwovhU_o.png" width="726"></p> 
<p></p> 
<p class="img-center"><img alt="" height="85" src="https://images2.imgbox.com/05/9d/aTLolb8d_o.png" width="804"></p> 
<p>6、运行以下命令更改/var/ftp/test目录的拥有者为ftptest。</p> 
<pre><code>chown -R ftptest:ftptest /var/ftp/test</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="134" src="https://images2.imgbox.com/76/56/XDNvZoOW_o.png" width="876"></p> 
<p>7、修改vsftpd.conf配置文件。</p> 
<p>a.运行以下命令，打开vsftpd的配置文件。</p> 
<p>如果您在安装vsftpd时，使用的是<code>apt install vsftpd</code>安装命令，则配置文件路径为/etc/vsftpd.conf。</p> 
<pre><code>vim /etc/vsftpd/vsftpd.conf</code></pre> 
<p>b.按i进入编辑模式。</p> 
<p>c.配置FTP服务器为<strong>被动模式</strong>。具体的配置参数如下：</p> 
<pre><code># 关闭匿名用户登录
anonymous_enable=NO 

anon_upload_enable=YES            #允许匿名用户上传文件，取消注释
anon_mkdir_write_enable=YES     #允许匿名用户创建目录，需取消注释
anon_other_write_enable=YES      #允许匿名删除、重命名、覆盖等操作，需添加
 
anon_root=/var/ftp/pub       
#anon_root 针对匿名用户(如果不设置默认为此目录，可以进行修改，修改之后修改给它权限)
anon_umask=000				# 文件所属组拥有读写权限

# 使用本地用户登录
local_enable=YES

# 本地用户FTP访问目录，如果不配做默认就是本地用户的家目录，然后用户登陆之后，ftp:ip 默认指向该目录
local_root=/var/ftp/test
anon_root=/var/www/html/  # 虚拟用户访问目录 anonymous用户，即匿名用户访问的主目录  

# 允许登陆用户有写权限；属于全局设置，默认值为YES
write_enable=YES

local_umask=022

dirmessage_enable=YES

xferlog_enable=YES

xferlog_std_format=YES

# 监听IPv4 sockets
listen=YES

# 关闭监听IPv6 sockets
listen_ipv6=NO

pam_service_name=vsftpd # 指定pam认证文件，可修改 

# userlist_enable=YES 和 userlist_deny=YES 
# 这一组值就是把user_list作为黑名单使用，user_list文件中的用户都被拒绝登录FTP
userlist_enable=YES # 是否启用user_list列表文件
userlist_deny=YES # 是否禁用user_list中的用户
userlist_file=/etc/vsftpd/user_list # 默认就是/etc/vsftpd/user_list


# 全部用户被限制在主目录
chroot_local_user=YES

# 启用例外用户名单
chroot_list_enable=YES

# 指定例外用户列表文件，列表中用户不被锁定在主目录。
chroot_list_file=/etc/vsftpd/chroot_list

# 启用被动模式
pasv_enable=YES 
# 允许被限制的用户主目录具有写权限
allow_writeable_chroot=YES

# 被动模式下FTP服务器IP
pasv_address=192.168.100.20 

# 被动模式下，数据传输最小端口50000，最大端口51000，例如：50000～51000
pasv_min_port=50000
pasv_max_port=51000

guest_enable=YES					 # 开启虚拟用户模式
guest_username=FTP				 # 指定虚拟用户账号映射到本地账号FTP
user_config_dir=/etc/vsftpd/vuser_conf	 # 指定虚拟用户的权限配置目录</code></pre> 
<blockquote> 
 <p><strong>常用的全局配置项</strong><br> -listen=YES：是否以独立运行的方式监听服务<br> -listen_address=192.168.168.129：设置监听的IP地址<br> -listen_port=21：设置监听FTP服务的端口号<br> -write_enable=YES：是否启用写入权限<br> -download_enable＝YES：是否允许下载文件<br> -userlist_enable=YES：是否启用user_list列表文件<br> -userlist_deny=YES：是否禁用user_list中的用户<br> -max_clients=0：限制并发客户端连接数<br> -max_per_ip=0：限制同一IP地址的并发连接数<br><strong>常用的匿名FTP配置项</strong><br> -anonymous_enable=YES：启用匿名访问(默认已有该项，不再输入这行)<br> -anon_umask=022：匿名用户所上传文件的权限掩码<br> -anon_root=/var/ftp：匿名用户的FTP根目录<br> -anon_upload_enable=YES：允许上传文件(若无全局参数write_enable=YES则不能生效)<br> -anon_mkdir_write_enable=YES：允许创建目录<br> -anon_other_write_enable=YES：开放其他写入权<br> -anon_max_rate=0：限制最大传输速率（字节/秒</p> 
</blockquote> 
<p><strong>这里比较注意的是，本地用户登陆模式下，关于local_root配置的路径，要注意用户的权限问题，否则无权访问或者无数据</strong></p> 
<p><img alt="" height="197" src="https://images2.imgbox.com/cf/9e/Lcs1o3yG_o.png" width="472"></p> 
<p><img alt="" height="264" src="https://images2.imgbox.com/68/c8/NAdLLbw2_o.png" width="541"></p> 
<p>(d.按Esc退出编辑模式，然后输入:wq并回车以保存并关闭文件。</p> 
<p>8、创建chroot_list文件，并在文件中写入例外用户名单。</p> 
<p>a.运行以下命令，创建chroot_list文件</p> 
<pre><code>vim /etc/vsftpd/chroot_list</code></pre> 
<p>b.按i进入编辑模式。</p> 
<p>c.输入例外用户名单。此名单中的用户不会被锁定在主目录，可以访问其他目录。</p> 
<p>d.按Esc退出编辑模式，然后输入:wq并回车以保存并关闭文件。</p> 
<p><strong>（备注：</strong>没有例外用户时，也必须创建chroot_list文件，内容可为空）</p> 
<p></p> 
<p class="img-center"><img alt="" height="164" src="https://images2.imgbox.com/f8/8e/9aWG12Ab_o.png" width="644"></p> 
<p>9、运行以下命令重启vsftpd服务。</p> 
<pre><code>systemctl restart vsftpd.service</code></pre> 
<p>10、关闭防火墙，用于FTP测试，否则FTP连接会被防火墙拦截；</p> 
<pre><code># 查看防火墙状态 
systemctl status firewalld</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="222" src="https://images2.imgbox.com/d3/59/aRnrhcHl_o.png" width="720"></p> 
<pre><code># 关闭防火墙 
systemctl stop firewalld</code></pre> 
<p></p> 
<p class="img-center"><img alt="" height="228" src="https://images2.imgbox.com/5d/16/T4NZ4IwR_o.png" width="720"></p> 
<pre><code># 开启防火墙
systemctl start firewalld

# 重启防火墙
systemctl restart firewalld</code></pre> 
<p>11、FTP下载，上传测试，如下。</p> 
<p><strong>方式1：ftp://192.168.100.20连接FTP服务器，用户名：ftptest ；密码：python@123</strong></p> 
<p></p> 
<p class="img-center"><img alt="" height="278" src="https://images2.imgbox.com/c6/5c/WwOBTE0F_o.png" width="720"></p> 
<p></p> 
<p class="img-center"><img alt="" height="348" src="https://images2.imgbox.com/15/c0/IIOtaAhn_o.png" width="720"></p> 
<p></p> 
<p class="img-center"><img alt="" height="355" src="https://images2.imgbox.com/51/88/tqfF0XrZ_o.png" width="720"></p> 
<p><strong>方式2：使用WinSCP客户端连接FTP服务器，用户名：ftptest ；密码：python@123</strong></p> 
<p></p> 
<p class="img-center"><img alt="" height="465" src="https://images2.imgbox.com/d9/50/JU43w06m_o.png" width="720"></p> 
<p></p> 
<p class="img-center"><img alt="" height="463" src="https://images2.imgbox.com/08/9b/DHsZ3aMQ_o.png" width="720"></p> 
<p></p> 
<p>以下是一些文件的位置约定：</p> 
<p>/usr/in/vsftpd —- VSFTPD的主程序</p> 
<p>/etc/rc.d/init.d/vsftpd —- 启动脚本</p> 
<p>/etc/vsftpd/vsftpd.conf —- 主配置文件</p> 
<p>/etc/pam.d/vsftpd —- PAM认证文件</p> 
<p>/etc/vsftpd.ftpusers —- 禁止使用VSFTPD的用户列表文件</p> 
<p>/etc/vsftpd.user_list —- 禁止或允许使用VSFTPD的用户列表文件</p> 
<p>/var/ftp —- 匿名用户主目录</p> 
<p>/var/ftp/pub —- 匿名用户的下载目录</p> 
<p>如果要更改默认下载目录，修改/etc/vsftpd/vsftpd.conf，加入如下三行：</p> 
<p>local_root=/</p> 
<p>chroot_local_user=YES</p> 
<p>anon_root=/</p> 
<p>local_root表示使用本地用户登录到ftp时的默认目录</p> 
<p>anon_root表示匿名用户登录到ftp时的默认目录</p> 
<p>上面的chroot_list_file是设定锁定登陆用户在其home目录的列表，要在chroot_list_enable=YES情况下才生效。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6ad746ce3940620eaa507bf9bd0fd8d2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HTTP 414错误：请求URI过长，如何避免</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/05ef0fe051060771c6b42ed2570a55dd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用户验证FTP实验</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>