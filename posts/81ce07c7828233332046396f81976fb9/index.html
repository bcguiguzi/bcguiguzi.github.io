<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>TCP/IP——传输层与应用层 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="TCP/IP——传输层与应用层" />
<meta property="og:description" content="今天整理一下传输层与应用层的一些重要的内容。
一、传输层 TCP
1、tcp报文格式：
源端口：标识哪个应用程序发送。
目的端口：标识哪个应用程序接收。
序号字段：本报文段所发送的数据的第一个字节的序号。
确认号：上次以成功接收到的数据字节序号加1，只有ACK为一时，这个字段才有效。
首部长度：最大60字节，最小是20字节。即段起始到数据起始的长度。
保留：必须填0。
URG：代表这个数据是否需要紧急传输。
ACK：ACK=1,确认号有效；ACK=0，确认号无效。
PSH：若PSH=1，就立刻把报文段交给应用进程。
RST：若RST=1，说明tcp连接有问题，需要释放连接，然后重新连接。
SYN：若SYN=1，说明这是一个连接请求或连接接受请求。
FIN：若FIN=1，说明这是一个释放连接的请求。
window：TCP的流量控制，这个值是接收端正期望接收的字节数。窗口最大为65535字节。
检验字段：在计算检验和时，要在TCP报文段的前面加上12字节的伪首部。
紧急指针：只有URG=1时，这个字段才有效。指出在本报文段中紧急数据共有多少个字节（紧急数据放在本报文段数据的最前面）。
选项字段：选项表结束，无操作，最大报文段长度，窗口扩大因子，时间戳等。
填充字段：用来补位，让整个首部长度是4字节的整数倍。
TCP负载：可变。
2、三次握手与四次挥手。
（1）三次握手：
第一次握手：客户端发送SYN报文，进入SYN_SENT状态。
第二次握手：服务器接收到这个报文，回复一个ACK报文，还会发送SYN报文，进入SYN_RCVD 的状态。
第三次握手：客户端收到ACK报文，会回复服务器一个ACK报文。服务器收到这个报文，双方进入连接状态。
（2）四次挥手：
第一次挥手：客户端发送FIN报文，进入FIN_WAIT1状态。
第二次挥手：服务器收到这个报文，回复一个ACK报文。服务端进入CLOSE_WAIT状态，客户端收到服务端的确认后，进入FIN_WAIT2状态。
第三次挥手：服务器发送FIN报文，进入LAST_ACK 的状态。
第四次挥手：客户端收到这个报文，回复ACK报文，客户端处于TIME_WAI 状态等待2MSL后，客户端才进入CLOSED状态。服务器收到这个报文后，就会处于进入CLOSED状态。
注：MSL报文段最大生存时间。等待2MSL是为了防止ACK丢失，还有就是在等待2MSL时间内，客户端的IP地址加上端口与服务器的IP地址加上端口不能在使用。
注：四次挥手无论是客户端先断开连接还是服务器断开连接都可以，不影响四次挥手。
3、tcp如何保证可靠传输
（1）三次握手
（2）合理分片
（3）超时重发
（4）确认应答
（5）校验和
（6）对失序数据重新排序
（7）丢弃重复数据
（8）流量控制，tcp连接的每一方都有一个缓冲区，因为有的主机发的快，有的发的满，为了防止快的主机让慢的主机出现缓冲区溢出。
（9）拥塞控制，当网络拥塞就减少数据发送。
TCP粘包/拆包
拆包：一个完整的业务会被tcp拆分多个包
粘包：把多个小包封装成一个包
原因：
1、应用程序写入数据的字节大于套接字发送缓冲区的大小
2、MSS大小的tcp分段；mss=tcp报文长度-tcp首部长度
3、以太网的payioad大于MTU进行ip分片
解决方案：
1、消息定长
2、在包尾进行特殊字符分割
3、将消息分为消息头和消息尾
4、使用其它复杂协议，rtmp协议。
UDP
udp报文格式
发送进程：标识哪个进程发的。2字节
接收进程：标识哪个进程收的。2字节
Length：UDP首部加上UDP数据的字节数，最小为8。2字节
Checksum：覆盖UDP首部和UDP数据，是可选的。2字节
data：udp负载，可选。变长
TCP与UDP对比
三、应用层 URI：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/81ce07c7828233332046396f81976fb9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-18T17:07:08+08:00" />
<meta property="article:modified_time" content="2020-09-18T17:07:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">TCP/IP——传输层与应用层</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>       今天整理一下传输层与应用层的一些重要的内容。<br></p> 
<h3><a id="_2"></a>一、传输层</h3> 
<p>       <strong>TCP</strong></p> 
<p>1、tcp报文格式：<br> <img src="https://images2.imgbox.com/60/aa/BKjJsvSL_o.png" alt="在这里插入图片描述"><br> <br><br>        源端口：标识哪个应用程序发送。<br>        目的端口：标识哪个应用程序接收。<br>        序号字段：本报文段所发送的数据的第一个字节的序号。<br>        确认号：上次以成功接收到的数据字节序号加1，只有ACK为一时，这个字段才有效。<br>        首部长度：最大60字节，最小是20字节。即段起始到数据起始的长度。<br>        保留：必须填0。<br>        URG：代表这个数据是否需要紧急传输。<br>        ACK：ACK=1,确认号有效；ACK=0，确认号无效。<br>        PSH：若PSH=1，就立刻把报文段交给应用进程。<br>        RST：若RST=1，说明tcp连接有问题，需要释放连接，然后重新连接。<br>        SYN：若SYN=1，说明这是一个连接请求或连接接受请求。<br>        FIN：若FIN=1，说明这是一个释放连接的请求。<br>        window：TCP的流量控制，这个值是接收端正期望接收的字节数。窗口最大为65535字节。<br>        检验字段：在计算检验和时，要在TCP报文段的前面加上12字节的伪首部。<br>        紧急指针：只有URG=1时，这个字段才有效。指出在本报文段中紧急数据共有多少个字节（紧急数据放在本报文段数据的最前面）。<br>        选项字段：选项表结束，无操作，最大报文段长度，窗口扩大因子，时间戳等。<br>        填充字段：用来补位，让整个首部长度是4字节的整数倍。<br>        TCP负载：可变。<br> <br><br> 2、三次握手与四次挥手。<br> （1）三次握手：<br>        第一次握手：客户端发送SYN报文，进入SYN_SENT状态。<br>        第二次握手：服务器接收到这个报文，回复一个ACK报文，还会发送SYN报文，进入SYN_RCVD 的状态。<br>        第三次握手：客户端收到ACK报文，会回复服务器一个ACK报文。服务器收到这个报文，双方进入连接状态。<br> （2）四次挥手：<br>        第一次挥手：客户端发送FIN报文，进入FIN_WAIT1状态。<br>        第二次挥手：服务器收到这个报文，回复一个ACK报文。服务端进入CLOSE_WAIT状态，客户端收到服务端的确认后，进入FIN_WAIT2状态。<br>        第三次挥手：服务器发送FIN报文，进入LAST_ACK 的状态。<br>        第四次挥手：客户端收到这个报文，回复ACK报文，客户端处于TIME_WAI 状态等待2MSL后，客户端才进入CLOSED状态。服务器收到这个报文后，就会处于进入CLOSED状态。<br>        注：MSL报文段最大生存时间。等待2MSL是为了防止ACK丢失，还有就是在等待2MSL时间内，客户端的IP地址加上端口与服务器的IP地址加上端口不能在使用。<br>        注：四次挥手无论是客户端先断开连接还是服务器断开连接都可以，不影响四次挥手。<br><br> 3、tcp如何保证可靠传输<br> （1）三次握手<br> （2）合理分片<br> （3）超时重发<br> （4）确认应答<br> （5）校验和<br> （6）对失序数据重新排序<br> （7）丢弃重复数据<br> （8）流量控制，tcp连接的每一方都有一个缓冲区，因为有的主机发的快，有的发的满，为了防止快的主机让慢的主机出现缓冲区溢出。<br> （9）拥塞控制，当网络拥塞就减少数据发送。<br><br>        <strong>TCP粘包/拆包</strong><br><br>        拆包：一个完整的业务会被tcp拆分多个包<br>        粘包：把多个小包封装成一个包</p> 
<p>       原因：<br>               1、应用程序写入数据的字节大于套接字发送缓冲区的大小<br>               2、MSS大小的tcp分段；mss=tcp报文长度-tcp首部长度<br>               3、以太网的payioad大于MTU进行ip分片<br>        解决方案：<br>               1、消息定长<br>               2、在包尾进行特殊字符分割<br>               3、将消息分为消息头和消息尾<br>               4、使用其它复杂协议，rtmp协议。</p> 
<p>       <strong>UDP</strong><br><br> udp报文格式<br> <img src="https://images2.imgbox.com/e3/09/QN397scJ_o.png" alt="在这里插入图片描述"><br><br>        发送进程：标识哪个进程发的。2字节<br>        接收进程：标识哪个进程收的。2字节<br>        Length：UDP首部加上UDP数据的字节数，最小为8。2字节<br>        Checksum：覆盖UDP首部和UDP数据，是可选的。2字节<br>        data：udp负载，可选。变长<br> <br><br>        <strong>TCP与UDP对比</strong><br><br> <img src="https://images2.imgbox.com/f7/4b/WqRFXqnq_o.png" alt="在这里插入图片描述"><br> <br></p> 
<h3><a id="_77"></a>三、应用层</h3> 
<p>       URI：<br>                统一资源标识符,用来唯一标识一个资源.<br>        URL：<br>                统一资源定位器,可以用来标识一个资源，还可以用来定位这个资源。<br><br>        <strong>一次完整的http请求</strong><br><br>        1、域名解析。<br>        2、tcp3次握手。<br>        3、建立连接后，发送http请求。<br>        4、服务器响应，浏览器得到html。<br>        5、浏览器解析html，并请求htnl中的资源。<br>        6、浏览器对页面渲染，呈现给客户。<br><br>        <strong>http与https对比</strong><br><br> <img src="https://images2.imgbox.com/1d/39/aEXQIoEh_o.png" alt="在这里插入图片描述"><br><br> <img src="https://images2.imgbox.com/3b/7f/0kJC795Z_o.png" alt="在这里插入图片描述">       注：短连接：浏览器和服务器每进行一次HTTP操作，就建立一次连接，但任务结束就中断连接。<br>        长连接：浏览器和服务器进行多次HTTP操作，就第一次需要建立连接，之后的每次会话就不再建立新的连接，还使用第一次会话的连接。<br> <br><br>        <strong>get与post区别</strong><br></p> 
<p><img src="https://images2.imgbox.com/24/57/6GOSReGO_o.png" alt="在这里插入图片描述"><br><br>        注：幂等是无论是一次请求还是多次请求某一个资源时，返回的结果时一样的。<br>        注：GET产生一个TCP数据包，浏览器会把http header和data一并发送出去，服务器响应200(返回数据); POST产生两个TCP数据包，浏览器先发送header，服务器响应100 continue，浏览器再发送data，服务器响应200 ok(返回数据)。</p> 
<br> 
<p>常见状态码：<br> 200成功<br> 403收到请求，拒绝服务<br> 404资源不存在<br> 500服务器发生错误</p> 
<br> 
<p>       <strong>目前先整理这么多，有时间在多写点。</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/12ce7e4fa53c0d16ef56437639279ae6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue提示 ： Named Route ‘test‘ has a default child route. When navigating to this named route (:to=“{nam</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4baa2a40b005af2243f8db557995d593/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">学习无霍尔传感器的BLDC方波调速</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>