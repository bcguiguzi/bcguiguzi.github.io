<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€AIå¤§æ¨¡å‹åº”ç”¨å¼€å‘ã€‘ã€LangChainç³»åˆ—ã€‘3. ä¸€æ–‡äº†è§£LangChainçš„è®°å¿†æ¨¡å—ï¼ˆç†è®ºå®æˆ˜&#43;ç»†èŠ‚ï¼‰ - ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ã€AIå¤§æ¨¡å‹åº”ç”¨å¼€å‘ã€‘ã€LangChainç³»åˆ—ã€‘3. ä¸€æ–‡äº†è§£LangChainçš„è®°å¿†æ¨¡å—ï¼ˆç†è®ºå®æˆ˜&#43;ç»†èŠ‚ï¼‰" />
<meta property="og:description" content="å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ã€åŒå­¦å°å¼ ã€‘ã€‚æŒç»­å­¦ä¹ ï¼ŒæŒç»­å¹²è´§è¾“å‡ºï¼Œå…³æ³¨æˆ‘ï¼Œè·Ÿæˆ‘ä¸€èµ·å­¦AIå¤§æ¨¡å‹æŠ€èƒ½ã€‚
å¤§å¤šæ•°LLMåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªä¼šè¯æ¥å£ã€‚ä¼šè¯çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†æ˜¯èƒ½å¤Ÿå‚è€ƒä¼šè¯æ—©æœŸçš„ä¿¡æ¯ï¼ˆä¸Šæ–‡ä¿¡æ¯ï¼‰ã€‚è¿™ç§å­˜å‚¨è¿‡å»äº’åŠ¨ä¿¡æ¯çš„èƒ½åŠ›å°±ç§°ä¸ºâ€œè®°å¿†ï¼ˆMemoryï¼‰â€ã€‚LangChainæä¾›äº†è®¸å¤šç”¨äºå‘ç³»ç»Ÿæ·»åŠ Memoryçš„å°è£…ã€‚
ç›®å‰ LangChain ä¸­å¤§å¤šæ•°çš„Memoryå°è£…è¿˜éƒ½æ˜¯æµ‹è¯•ç‰ˆæœ¬ã€‚æˆç†Ÿçš„Memoryä¸»è¦æ˜¯ChatMessageHistoryã€‚
0. è®¤è¯†Memory Memoryï¼Œé€šä¿—çš„è®²ï¼Œå°±æ˜¯è®°å½•å¯¹è¯çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œåœ¨æœ‰éœ€è¦çš„æ—¶å€™è¡¥å……åˆ°ç”¨æˆ·çš„æé—®ä¸­å»ã€‚çœ‹ä¸Šå›¾ï¼Œç®€å•è¯´ä¸‹Memoryçš„ä½¿ç”¨æµç¨‹ï¼š
å½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªé—®é¢˜ï¼Œé¦–å…ˆä»Memoryä¸­è¯»å–ç›¸å…³çš„ä¸Šæ–‡ä¿¡æ¯ï¼ˆå†å²å¯¹è¯ä¿¡æ¯ï¼‰ï¼Œç„¶åç»„è£…æˆä¸€ä¸ªPromptï¼Œè°ƒç”¨å¤§æ¨¡å‹ï¼Œå¤§æ¨¡å‹çš„å›å¤ä½œä¸ºå†å²å¯¹è¯ä¿¡æ¯ä¿å­˜åœ¨Memoryä¸­ï¼Œä¾›ä¹‹åçš„å¯¹è¯ä½¿ç”¨ã€‚ ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹LangChainçš„Memoryåˆ°åº•é•¿ä»€ä¹ˆæ ·ã€‚
0. å¯¹è¯ä¸Šä¸‹æ–‡ConversationBufferMemory è¿™æ˜¯æœ€ç®€å•çš„Memoryå½¢å¼ï¼Œä¿å­˜å½¢å¼ç±»ä¼¼æ˜¯chat messageçš„æ•°ç»„ã€‚
ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š
save_context å¯ä»¥ä¿å­˜ä¿¡æ¯åˆ°memoryä¸­load_memory_variables è·å–memoryä¸­çš„ä¿¡æ¯chat_memory.add_user_messageå’Œchat_memory.add_ai_message ä¹Ÿå¯ä»¥ç”¨æ¥ä¿å­˜ä¿¡æ¯åˆ°memoryä¸­ from langchain.memory import ConversationBufferMemory, ConversationBufferWindowMemory history = ConversationBufferMemory() history.save_context({&#34;input&#34;: &#34;ä½ å¥½å•Š&#34;}, {&#34;output&#34;: &#34;ä½ ä¹Ÿå¥½å•Š&#34;}) print(history.load_memory_variables({})) history.save_context({&#34;input&#34;: &#34;ä½ å†å¥½å•Š&#34;}, {&#34;output&#34;: &#34;ä½ åˆå¥½å•Š&#34;}) print(history.load_memory_variables({})) history.chat_memory.add_user_message(&#34;ä½ åœ¨å¹²å˜›&#34;) history.chat_memory.add_ai_message(&#34;æˆ‘åœ¨å­¦ä¹ &#34;) print(history.load_memory_variables({})) ## æˆ–è€…ç›´æ¥ä½¿ç”¨ ChatMessageHistory æ·»åŠ memoryï¼Œæ•ˆæœä¸€æ · # from langchain.memory import ChatMessageHistory # chat_history = ChatMessageHistory() # chat_history.add_user_message(&#34;ä½ åœ¨å¹²å˜›&#34;) # chat_history.add_ai_message(&#34;æˆ‘åœ¨å­¦ä¹ &#34;) # print(history.load_memory_variables({})) è¿è¡Œç»“æœï¼š
ä¸Šé¢çš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°è¿”å›çš„ä¿¡æ¯æ°¸è¿œéƒ½æ˜¯ä»¥â€œhistoryâ€å¼€å¤´çš„ï¼Œæ€ä¹ˆä¿®æ”¹è¿™ä¸ªkeyå‘¢ï¼Ÿåªéœ€è¦ä¿®æ”¹ä¸‹é¢ä¸€å¥ï¼Œå¡«å…¥ memory_key å‚æ•°ã€‚
history = ConversationBufferMemory(memory_key=&#34;chat_history_with_åŒå­¦å°å¼ &#34;) è¿è¡Œç»“æœï¼š
è¿”å›çš„ç»“æœè¿˜æœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼Œé‚£å°±æ˜¯å®ƒç›®å‰è¿”å›çš„æ˜¯ä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œè¿™æ˜¯å¯ä»¥ç›´æ¥ç»™LLMså¯¹è¯è¾“å…¥çš„ã€‚ä½†å¯¹äºChatModelså¯¹è¯ï¼Œå®ƒæ¥æ”¶çš„å‚æ•°æ˜¯Chat Messagesæ•°ç»„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜å‚æ•°return_messages=Trueï¼Œè®©è¿™ä¸ªmemoryçš„è¿”å›å˜æˆChat Messagesæ•°ç»„ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/2788defe5a86d8e11438792fa307eb83/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-07T06:30:00+08:00" />
<meta property="article:modified_time" content="2024-02-07T06:30:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€AIå¤§æ¨¡å‹åº”ç”¨å¼€å‘ã€‘ã€LangChainç³»åˆ—ã€‘3. ä¸€æ–‡äº†è§£LangChainçš„è®°å¿†æ¨¡å—ï¼ˆç†è®ºå®æˆ˜&#43;ç»†èŠ‚ï¼‰</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p><strong>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ã€åŒå­¦å°å¼ ã€‘ã€‚æŒç»­å­¦ä¹ ï¼ŒæŒç»­å¹²è´§è¾“å‡ºï¼Œå…³æ³¨æˆ‘ï¼Œè·Ÿæˆ‘ä¸€èµ·å­¦AIå¤§æ¨¡å‹æŠ€èƒ½ã€‚</strong></p> 
</blockquote> 
<p>å¤§å¤šæ•°LLMåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªä¼šè¯æ¥å£ã€‚ä¼šè¯çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†æ˜¯èƒ½å¤Ÿå‚è€ƒä¼šè¯æ—©æœŸçš„ä¿¡æ¯ï¼ˆä¸Šæ–‡ä¿¡æ¯ï¼‰ã€‚è¿™ç§å­˜å‚¨è¿‡å»äº’åŠ¨ä¿¡æ¯çš„èƒ½åŠ›å°±ç§°ä¸ºâ€œè®°å¿†ï¼ˆMemoryï¼‰â€ã€‚LangChainæä¾›äº†è®¸å¤šç”¨äºå‘ç³»ç»Ÿæ·»åŠ Memoryçš„å°è£…ã€‚</p> 
<blockquote> 
 <p>ç›®å‰ LangChain ä¸­å¤§å¤šæ•°çš„Memoryå°è£…è¿˜éƒ½æ˜¯æµ‹è¯•ç‰ˆæœ¬ã€‚æˆç†Ÿçš„Memoryä¸»è¦æ˜¯<code>ChatMessageHistory</code>ã€‚</p> 
</blockquote> 
<h3><a id="0_Memory_8"></a>0. è®¤è¯†Memory</h3> 
<p><img src="https://images2.imgbox.com/e0/b4/SOUiRR7g_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>Memoryï¼Œé€šä¿—çš„è®²ï¼Œå°±æ˜¯è®°å½•å¯¹è¯çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œåœ¨æœ‰éœ€è¦çš„æ—¶å€™è¡¥å……åˆ°ç”¨æˆ·çš„æé—®ä¸­å»ã€‚çœ‹ä¸Šå›¾ï¼Œç®€å•è¯´ä¸‹Memoryçš„ä½¿ç”¨æµç¨‹ï¼š</p> 
<ul><li>å½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªé—®é¢˜ï¼Œé¦–å…ˆä»Memoryä¸­è¯»å–ç›¸å…³çš„ä¸Šæ–‡ä¿¡æ¯ï¼ˆå†å²å¯¹è¯ä¿¡æ¯ï¼‰ï¼Œç„¶åç»„è£…æˆä¸€ä¸ªPromptï¼Œè°ƒç”¨å¤§æ¨¡å‹ï¼Œå¤§æ¨¡å‹çš„å›å¤ä½œä¸ºå†å²å¯¹è¯ä¿¡æ¯ä¿å­˜åœ¨Memoryä¸­ï¼Œä¾›ä¹‹åçš„å¯¹è¯ä½¿ç”¨ã€‚</li></ul> 
<p>ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹LangChainçš„Memoryåˆ°åº•é•¿ä»€ä¹ˆæ ·ã€‚</p> 
<h3><a id="0_ConversationBufferMemory_16"></a>0. å¯¹è¯ä¸Šä¸‹æ–‡<code>ConversationBufferMemory</code></h3> 
<p>è¿™æ˜¯æœ€ç®€å•çš„Memoryå½¢å¼ï¼Œä¿å­˜å½¢å¼ç±»ä¼¼æ˜¯chat messageçš„æ•°ç»„ã€‚<br> ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p> 
<ul><li><code>save_context</code> å¯ä»¥ä¿å­˜ä¿¡æ¯åˆ°memoryä¸­</li><li><code>load_memory_variables</code> è·å–memoryä¸­çš„ä¿¡æ¯</li><li><code>chat_memory.add_user_message</code>å’Œ<code>chat_memory.add_ai_message</code> ä¹Ÿå¯ä»¥ç”¨æ¥ä¿å­˜ä¿¡æ¯åˆ°memoryä¸­</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>memory <span class="token keyword">import</span> ConversationBufferMemory<span class="token punctuation">,</span> ConversationBufferWindowMemory

history <span class="token operator">=</span> ConversationBufferMemory<span class="token punctuation">(</span><span class="token punctuation">)</span>
history<span class="token punctuation">.</span>save_context<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"ä½ å¥½å•Š"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token string">"ä½ ä¹Ÿå¥½å•Š"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>load_memory_variables<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

history<span class="token punctuation">.</span>save_context<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"ä½ å†å¥½å•Š"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token string">"ä½ åˆå¥½å•Š"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>load_memory_variables<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

history<span class="token punctuation">.</span>chat_memory<span class="token punctuation">.</span>add_user_message<span class="token punctuation">(</span><span class="token string">"ä½ åœ¨å¹²å˜›"</span><span class="token punctuation">)</span>
history<span class="token punctuation">.</span>chat_memory<span class="token punctuation">.</span>add_ai_message<span class="token punctuation">(</span><span class="token string">"æˆ‘åœ¨å­¦ä¹ "</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>load_memory_variables<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">## æˆ–è€…ç›´æ¥ä½¿ç”¨ ChatMessageHistory æ·»åŠ memoryï¼Œæ•ˆæœä¸€æ ·</span>
<span class="token comment"># from langchain.memory import ChatMessageHistory</span>
<span class="token comment"># chat_history = ChatMessageHistory()</span>
<span class="token comment"># chat_history.add_user_message("ä½ åœ¨å¹²å˜›")</span>
<span class="token comment"># chat_history.add_ai_message("æˆ‘åœ¨å­¦ä¹ ")</span>
<span class="token comment"># print(history.load_memory_variables({}))</span>
</code></pre> 
<p>è¿è¡Œç»“æœï¼š</p> 
<p><img src="https://images2.imgbox.com/51/98/q4i3kKr5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ä¸Šé¢çš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°è¿”å›çš„ä¿¡æ¯æ°¸è¿œéƒ½æ˜¯ä»¥â€œhistoryâ€å¼€å¤´çš„ï¼Œæ€ä¹ˆä¿®æ”¹è¿™ä¸ªkeyå‘¢ï¼Ÿåªéœ€è¦ä¿®æ”¹ä¸‹é¢ä¸€å¥ï¼Œå¡«å…¥ <code>memory_key</code> å‚æ•°ã€‚</p> 
<pre><code class="prism language-python">history <span class="token operator">=</span> ConversationBufferMemory<span class="token punctuation">(</span>memory_key<span class="token operator">=</span><span class="token string">"chat_history_with_åŒå­¦å°å¼ "</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¿è¡Œç»“æœï¼š</p> 
<p><img src="https://images2.imgbox.com/12/62/e9nE00ag_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> è¿”å›çš„ç»“æœè¿˜æœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼Œé‚£å°±æ˜¯å®ƒç›®å‰è¿”å›çš„æ˜¯ä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œè¿™æ˜¯å¯ä»¥ç›´æ¥ç»™LLMså¯¹è¯è¾“å…¥çš„ã€‚ä½†å¯¹äºChatModelså¯¹è¯ï¼Œå®ƒæ¥æ”¶çš„å‚æ•°æ˜¯Chat Messagesæ•°ç»„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜å‚æ•°<code>return_messages=True</code>ï¼Œè®©è¿™ä¸ªmemoryçš„è¿”å›å˜æˆChat Messagesæ•°ç»„ã€‚</p> 
<pre><code class="prism language-python">history <span class="token operator">=</span> ConversationBufferMemory<span class="token punctuation">(</span>memory_key<span class="token operator">=</span><span class="token string">"chat_history_with_åŒå­¦å°å¼ "</span><span class="token punctuation">,</span> return_messages<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¿”å›ç»“æœï¼š</p> 
<p><img src="https://images2.imgbox.com/30/00/lm9A2ImJ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="1_kConversationBufferWindowMemory_68"></a>1. åªä¿ç•™kä¸ªçª—å£çš„ä¸Šä¸‹æ–‡ï¼š<code>ConversationBufferWindowMemory</code></h3> 
<p>ConversationBufferWindowMemoryå…è®¸ç”¨æˆ·è®¾ç½®ä¸€ä¸ªKå‚æ•°ï¼Œæ¥é™å®šæ¯æ¬¡ä»è®°å¿†ä¸­è¯»å–æœ€è¿‘çš„Kæ¡è®°å¿†ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>memory <span class="token keyword">import</span> ConversationBufferWindowMemory

window <span class="token operator">=</span> ConversationBufferWindowMemory<span class="token punctuation">(</span>k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span>save_context<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"ç¬¬ä¸€è½®é—®"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token string">"ç¬¬ä¸€è½®ç­”"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span>save_context<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"ç¬¬äºŒè½®é—®"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token string">"ç¬¬äºŒè½®ç­”"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span>save_context<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"ç¬¬ä¸‰è½®é—®"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token string">"ç¬¬ä¸‰è½®ç­”"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>load_memory_variables<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¿è¡Œç»“æœï¼š</p> 
<p><img src="https://images2.imgbox.com/e2/1a/hHwKVTBf_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" width="400"></p> 
<h3><a id="2__Token_ConversationTokenBufferMemory_86"></a>2. é€šè¿‡ Token æ•°æ§åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦ï¼š<code>ConversationTokenBufferMemory</code></h3> 
<p>ConversationTokenBufferMemoryå…è®¸ç”¨æˆ·æŒ‡å®šæœ€å¤§çš„tokené•¿åº¦ï¼Œä½¿å¾—ä»è®°å¿†ä¸­å–ä¸Šæ–‡æ—¶ä¸ä¼šè¶…è¿‡tokené™åˆ¶ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>memory <span class="token keyword">import</span> ConversationTokenBufferMemory
memory <span class="token operator">=</span> ConversationTokenBufferMemory<span class="token punctuation">(</span>
    llm<span class="token operator">=</span>llm<span class="token punctuation">,</span>
    max_token_limit<span class="token operator">=</span><span class="token number">45</span>
<span class="token punctuation">)</span>
memory<span class="token punctuation">.</span>save_context<span class="token punctuation">(</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"ä½ å¥½å•Š"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token string">"ä½ å¥½ï¼Œæˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹ã€‚"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
memory<span class="token punctuation">.</span>save_context<span class="token punctuation">(</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"ä½ ä¼šå¹²ä»€ä¹ˆ"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token string">"æˆ‘ä»€ä¹ˆéƒ½ä¼š"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>memory<span class="token punctuation">.</span>load_memory_variables<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7d/df/DggVlkFX_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" width="600"></p> 
<h3><a id="3__105"></a>3. æ›´å¤šè®°å¿†ç±»å‹</h3> 
<ul><li> <p>ConversationSummaryMemory: å¯¹ä¸Šä¸‹æ–‡åšæ‘˜è¦</p> </li><li> <p>ConversationSummaryBufferMemory: ä¿å­˜ Token æ•°é™åˆ¶å†…çš„ä¸Šä¸‹æ–‡ï¼Œå¯¹æ›´æ—©çš„åšæ‘˜è¦</p> </li><li> <p>VectorStoreRetrieverMemory: å°† Memory å­˜å‚¨åœ¨å‘é‡æ•°æ®åº“ä¸­ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥æ£€ç´¢å›æœ€ç›¸å…³çš„éƒ¨åˆ†</p> </li><li> <p>ConversationEntityMemoryï¼šä¿å­˜ä¸€äº›å®ä½“ä¿¡æ¯ï¼Œä¾‹å¦‚ä»è¾“å…¥ä¸­æ‰¾å‡ºä¸€ä¸ªäººåï¼Œä¿å­˜è¿™ä¸ªäººçš„ä¿¡æ¯ã€‚</p> </li></ul> 
<p><img src="https://images2.imgbox.com/8e/be/v2lMMQ2o_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" width="600"></p> 
<h3><a id="4__116"></a>4. æ€»è®¡</h3> 
<p>æœ¬æ–‡æˆ‘ä»¬å­¦ä¹ äº† LangChain çš„ Memory è®°å¿†æ¨¡å—ï¼Œå¯ä»¥çœ‹åˆ°å®ƒé‡Œé¢å°è£…äº†å¾ˆå¤šçš„è®°å¿†ç±»å‹ï¼Œåœ¨é¡¹ç›®ä¸­å¯ä»¥æŒ‰éœ€é€‰ç”¨ã€‚ä½†æ˜¯ä¹Ÿåº”è¯¥è®¤è¯†åˆ°ï¼Œç›®å‰LangChainçš„è®°å¿†æ¨¡å—è¿˜ä¸æˆç†Ÿï¼Œæ˜¯æµ‹è¯•ç‰ˆæœ¬ã€‚LangChainçš„å¿«é€Ÿè¿­ä»£ï¼Œéœ€è¦æˆ‘ä»¬æ—¶åˆ»å…³æ³¨å®ƒçš„å˜åŒ–ã€‚</p> 
<blockquote> 
 <p><strong>å¦‚æœè§‰å¾—æœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œéº»çƒ¦ç‚¹ä¸ªèµå’Œå…³æ³¨å‘— ~~~</strong></p> 
</blockquote> 
<hr> 
<blockquote> 
 <ul><li>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯åŒå­¦å°å¼ </li><li>æ¬¢è¿ <strong>ç‚¹èµ + å…³æ³¨</strong> ğŸ‘ï¼Œä¿ƒä½¿æˆ‘<strong>æŒç»­å­¦ä¹ </strong>ï¼Œ<strong>æŒç»­å¹²è´§è¾“å‡º</strong>ã€‚</li><li>+v: <strong>jasper_8017</strong> ä¸€èµ·äº¤æµğŸ’¬ï¼Œä¸€èµ·è¿›æ­¥ğŸ’ªã€‚</li><li>å¾®ä¿¡å…¬ä¼—å·ä¹Ÿå¯æœã€åŒå­¦å°å¼ ã€‘ ğŸ™</li><li><strong><mark>è¸©å‘ä¸æ˜“ï¼Œæ„Ÿè°¢å…³æ³¨å’Œå›´è§‚</mark></strong></li></ul> 
</blockquote> 
<p><strong><mark>æœ¬ç«™æ–‡ç« ä¸€è§ˆï¼š</mark></strong></p> 
<p><img src="https://images2.imgbox.com/3a/a8/KYvnWxY3_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8889bc409c3f24c655fa09b8911fbac7/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Unixäº”ç§I/Oæ¨¡å‹ï¼ˆé˜»å¡ã€éé˜»å¡ã€å¤šè·¯å¤ç”¨ã€ä¿¡å·é©±åŠ¨ã€å¼‚æ­¥ï¼‰</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/44aa77e9f0aa328d25b6f436732fe89e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Nexus3ä¹‹åœ¨Windowä¸­æ­å»ºMavenç§æœ</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>