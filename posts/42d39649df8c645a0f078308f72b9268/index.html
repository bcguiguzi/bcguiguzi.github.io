<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深入浅出 Linux Vsftpd 创建多虚拟用户教程 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="深入浅出 Linux Vsftpd 创建多虚拟用户教程" />
<meta property="og:description" content="Vsftpd 是一款轻量级并有着安全与简易等特性的FTP服务器程序，破受欢迎。在 Linux 中一旦配置好 Vsftpd 环境就可以一劳永逸，任意的迁移到类似的服务器之上，因此我们对配置过程做个系统的了解也是有必要的。
本文的任务是创建两个虚拟账户，第一个账户（bugxm_admin）拥有可读写指定目录文件、不可登陆系统权限，第二个（bugxm_general）只拥有只读被绑定目录中文件的权限，依然不能登陆系统。新建一个虚拟用户并且合理分配权限、绑定目录，这和IDC商的虚拟主机效果是一样的。臭虫小明为了方便，直接采用的 Root 账户操作。
1、安装 Vsftpd 程序，为了方便我们采用以下方式进行自动安装
yum install -y vsftpd
2、创建“bugxm_admin”与“bugxm_general”这两个账户，密码暂定为“123456”，其中奇数行表示账号，偶数行表示密码。
vi /etc/vsftpd/vm_user.txt
bugxm_admin
123456
bugxm_general
123456
2-1、创建 Vsftpd 认证文件
db_load -T -t hash -f /etc/vsftpd/vm_user.txt /etc/vsftpd/vm_user.db
注： 执行上条命令若提示：“bash： db_load： command not found”，请安装“db4-utils”，具体操作如下
yum install -y db4 db4-utils
注：如果出现“db_load： unexpected end of input data or key/data pair、db_load： odd number of key/data pairs”提示，请在 vm_user.txt 最后一行添加空行，即回车一下。
3、编辑虚拟用户需要用到的PAM认证配置文件
rm -f /etc/pam.d/vsftpd
vi /etc/pam.d/vsftpd
3-1、PAM认证配置文件输入以下内容
auth required pam_userdb." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/42d39649df8c645a0f078308f72b9268/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-06-27T17:19:13+08:00" />
<meta property="article:modified_time" content="2012-06-27T17:19:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深入浅出 Linux Vsftpd 创建多虚拟用户教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="content" class="content text-content clearfix"> 
 <p>Vsftpd 是一款轻量级并有着安全与简易等特性的FTP服务器程序，破受欢迎。在 Linux 中一旦配置好 Vsftpd  环境就可以一劳永逸，任意的迁移到类似的服务器之上，因此我们对配置过程做个系统的了解也是有必要的。</p> 
 <p>本文的任务是创建两个虚拟账户，第一个账户（bugxm_admin）拥有可读写指定目录文件、不可登陆系统权限，第二个（bugxm_general）只拥有只读被绑定目录中文件的权限，依然不能登陆系统。新建一个虚拟用户并且合理分配权限、绑定目录，这和IDC商的虚拟主机效果是一样的。臭虫<a title="小明" target="_blank" href="http://www.bugxm.com/system/linux/534.html" rel="nofollow noopener noreferrer">小明</a>为了方便，直接采用的  Root 账户操作。</p> 
 <p>1、安装 Vsftpd 程序，为了方便我们采用以下方式进行自动安装</p> 
 <p>yum install -y vsftpd</p> 
 <p>2、创建“bugxm_admin”与“bugxm_general”这两个账户，密码暂定为“123456”，其中奇数行表示账号，偶数行表示密码。</p> 
 <p>vi /etc/vsftpd/vm_user.txt</p> 
 <p>bugxm_admin</p> 
 <p>123456</p> 
 <p>bugxm_general</p> 
 <p>123456</p> 
 <p>2-1、创建 Vsftpd 认证文件</p> 
 <p>db_load -T -t hash -f /etc/vsftpd/vm_user.txt /etc/vsftpd/vm_user.db</p> 
 <p>注： 执行上条命令若提示：“bash： db_load： command not found”，请安装“db4-utils”，具体操作如下</p> 
 <p>yum install -y db4 db4-utils</p> 
 <p>注：如果出现“db_load： unexpected end of input data or key/data pair、db_load： odd  number of key/data pairs”提示，请在 vm_user.txt 最后一行添加空行，即回车一下。</p> 
 <p>3、编辑虚拟用户需要用到的PAM认证配置文件</p> 
 <p>rm -f /etc/pam.d/vsftpd</p> 
 <p>vi /etc/pam.d/vsftpd</p> 
 <p>3-1、PAM认证配置文件输入以下内容</p> 
 <p>auth required pam_userdb.so db=/etc/vsftpd/vm_user</p> 
 <p>account required pam_userdb.so db=/etc/vsftpd/vm_user</p> 
 <p>4、给 bugxm_admin、bugxm_general 这两个账户增加属性，控制访问目录、权限等，首先创建 bugxm_admin 账户</p> 
 <p>mkdir /etc/vsftpd/users</p> 
 <p>vi /etc/vsftpd/users/bugxm_admin</p> 
 <p>4-1、输入以下内容</p> 
 <p>local_root=/data/htdocs/bugxm_admin</p> 
 <p>write_enable=YES</p> 
 <p>anon_umask=022</p> 
 <p>anon_world_readable_only=NO</p> 
 <p>anon_upload_enable=YES</p> 
 <p>anon_mkdir_write_enable=YES</p> 
 <p>anon_other_write_enable=YES</p> 
 <p>4-2、以下是对上面这步操作的注释补充</p> 
 <p>local_root=/data/htdocs/bugxm_admin #根目录绑定</p> 
 <p>write_enable=YES #表示拥有可写权限</p> 
 <p>anon_umask=022 #上传文件的权限，022表示文件夹755、文件644权限</p> 
 <p>anon_world_readable_only=NO #表示用户具有下载权限</p> 
 <p>anon_upload_enable=YES #表示用户有权限上传文件</p> 
 <p>anon_mkdir_write_enable=YES #表示用户具有创建和删除目录的权限</p> 
 <p>anon_other_write_enable=YES #表示用户具有文件改名和删除文件的权限</p> 
 <p>4-3、创建 bugxm_general 用户</p> 
 <p>vi /etc/vsftpd/users/bugxm_general</p> 
 <p>4-4、输入以下内容</p> 
 <p>local_root=/data0/htdocs/bugxm_general</p> 
 <p>anon_world_readable_only=NO</p> 
 <p>5、两个用户创建完成之后，开始配置 Vsftpd。</p> 
 <p>vi /etc/vsftpd/vsftpd.conf</p> 
 <p>5-1、为安全考虑，我们配置不允许匿名访问。</p> 
 <p>默认：anonymous_enable=YES</p> 
 <p>改成：anonymous_enable=NO</p> 
 <p>5-2、YES 表示用户不能离开被我们指定的上级的任何目录。</p> 
 <p>默认：#chroot_list_enable=YES</p> 
 <p>改成：chroot_list_enable=YES</p> 
 <p>5-3、允许用户使用ASCII上传文件。</p> 
 <p>默认：#ascii_upload_enable=YES</p> 
 <p>改成：ascii_upload_enable=YES</p> 
 <p>5-4、允许用户使用ASCII下载文件。</p> 
 <p>默认：#ascii_download_enable=YES</p> 
 <p>改成：ascii_download_enable=YES</p> 
 <p>5-5、在末尾添加以下内容</p> 
 <p>guest_enable=YES</p> 
 <p>guest_username=ftp</p> 
 <p>user_config_dir=/etc/vsftpd/users</p> 
 <p>6、重新启动 Vsftpd （service vsftpd restart），出现了 500 OOPS： could not open chroot（）  list file:/etc/vsftpd/chroot_list 错误，执行以下操作就可以解决问题。</p> 
 <p>touch /etc/vsftpd/chroot_list</p> 
 <p>service vsftpd restart</p> 
 <p>Shutting down vsftpd： ［ OK ］</p> 
 <p>Starting vsftpd for vsftpd： ［ OK ］</p> 
 <p>6-1、用软件连接 ftp 服务器时，出现了以下问题，防火墙开启 21 端口就能得到解决。</p> 
 <p>状态： 正在连接 192.168.182.128:21.</p> 
 <p>错误： 连接超时</p> 
 <p>错误： 无法连接到服务器</p> 
 <p>状态： 正在等待重试。</p> 
 <p>6-2、在防火墙中开启 21 端口</p> 
 <p>vi /etc/sysconfig/iptables</p> 
 <p>任意位置添加以下内容</p> 
 <p>-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 21-j  ACCEPT</p> 
 <p>重启防火墙</p> 
 <p>/sbin/service iptables restart</p> 
 <p>6-3、再次连接时出现了不能切换目录错误“500 OOPS： cannot change  directory:/data/htdocs/bugxm_admin”，执行以下操作即可解决。</p> 
 <p>setsebool -P ftpd_disable_trans 1</p> 
 <p>service vsftpd restart</p> 
 <p>6-4、终于连接上了！</p> 
 <p>状态： 读取目录列表。</p> 
 <p>命令： PORT 192，168，182，1，38，172</p> 
 <p>响应： 200 PORT command successful. Consider using PASV.</p> 
 <p>命令： LIST</p> 
 <p>响应： 150 Here comes the directory listing.</p> 
 <p>响应： 226 Directory send OK.</p> 
 <p>状态： 列出目录成功</p> 
 <p>6-5、登陆 bugxm_admin 账户试试能否上传文件，臭虫小明这里上传文件还存在权限问题。</p> 
 <p>4上传错误：553 Could not create file.</p> 
 <p>解决方法：</p> 
 <p>chmod 770 -R /data/htdocs</p> 
 <p>chown root:ftp -R /data/htdocs</p> 
 <p>6-6、再次上传，正确了。</p> 
 <p>28状态： 正在连接 192.168.182.128:21.</p> 
 <p>状态： 连接建立，等待欢迎消息。</p> 
 <p>响应： 220 （vsFTPd 2.0.5）</p> 
 <p>命令： USER bugxm_admin</p> 
 <p>响应： 331 Please specify the password.</p> 
 <p>命令： PASS ******</p> 
 <p>响应： 230 Login successful.</p> 
 <p>命令： OPTS UTF8 ON</p> 
 <p>响应： 200 Always in UTF8 mode.</p> 
 <p>状态： 已连接</p> 
 <p>状态： 开始上传 E：\Users\Desktop\index.htm</p> 
 <p>命令： CWD /</p> 
 <p>响应： 250 Directory successfully changed.</p> 
 <p>命令： TYPE I</p> 
 <p>响应： 200 Switching to Binary mode.</p> 
 <p>命令： PORT 192，168，182，1，40，46</p> 
 <p>响应： 200 PORT command successful. Consider using PASV.</p> 
 <p>命令： STOR index.htm</p> 
 <p>响应： 150 Ok to send data.</p> 
 <p>响应： 226 File receive OK.</p> 
 <p>状态： 文件传输成功，传输了 35，250 字节 （用时1 秒）</p> 
 <p>状态： 读取目录列表。</p> 
 <p>命令： PORT 192，168，182，1，40，47</p> 
 <p>响应： 200 PORT command successful. Consider using PASV.</p> 
 <p>命令： LIST</p> 
 <p>响应： 150 Here comes the directory listing.</p> 
 <p>响应： 226 Directory send OK.</p> 
 <p>状态： 列出目录成功</p> 
 <p>6-7、试试另外一个账号是不是实现了仅有下载权限需求。</p> 
 <p>状态： 正在连接 192.168.182.128:21.</p> 
 <p>状态： 连接建立，等待欢迎消息。</p> 
 <p>响应： 220 （vsFTPd 2.0.5）</p> 
 <p>命令： USER bugxm_admin</p> 
 <p>响应： 331 Please specify the password.</p> 
 <p>命令： PASS ******</p> 
 <p>响应： 230 Login successful.</p> 
 <p>命令： OPTS UTF8 ON</p> 
 <p>响应： 200 Always in UTF8 mode.</p> 
 <p>状态： 已连接</p> 
 <p>状态： 开始上传 E：\Users\Desktop\index.htm</p> 
 <p>命令： CWD /</p> 
 <p>响应： 250 Directory successfully changed.</p> 
 <p>命令： TYPE I</p> 
 <p>响应： 200 Switching to Binary mode.</p> 
 <p>命令： PORT 192，168，182，1，40，46</p> 
 <p>响应： 200 PORT command successful. Consider using PASV.</p> 
 <p>命令： STOR index.htm</p> 
 <p>响应： 150 Ok to send data.</p> 
 <p>响应： 226 File receive OK.</p> 
 <p>状态： 文件传输成功，传输了 35，250 字节 （用时1 秒）</p> 
 <p>状态： 读取目录列表。</p> 
 <p>命令： PORT 192，168，182，1，40，47</p> 
 <p>响应： 200 PORT command successful. Consider using PASV.</p> 
 <p>命令： LIST</p> 
 <p>响应： 150 Here comes the directory listing.</p> 
 <p>响应： 226 Directory send OK.</p> 
 <p>状态： 列出目录成功</p> 
 <p>状态： 已从服务器断开</p> 
 <p>状态： 正在连接 192.168.182.128:21.</p> 
 <p>状态： 连接建立，等待欢迎消息。</p> 
 <p>响应： 220 （vsFTPd 2.0.5）</p> 
 <p>命令： USER bugxm_general</p> 
 <p>响应： 331 Please specify the password.</p> 
 <p>命令： PASS ******</p> 
 <p>响应： 230 Login successful.</p> 
 <p>命令： SYST</p> 
 <p>响应： 215 UNIX Type： L8</p> 
 <p>命令： FEAT</p> 
 <p>响应： 211-Features：</p> 
 <p>响应： EPRT</p> 
 <p>响应： EPSV</p> 
 <p>响应： MDTM</p> 
 <p>响应： PASV</p> 
 <p>响应： REST STREAM</p> 
 <p>响应： SIZE</p> 
 <p>响应： TVFS</p> 
 <p>响应： UTF8</p> 
 <p>响应： 211 End</p> 
 <p>命令： OPTS UTF8 ON</p> 
 <p>响应： 200 Always in UTF8 mode.</p> 
 <p>状态： 已连接</p> 
 <p>状态： 读取目录列表。</p> 
 <p>命令： PWD</p> 
 <p>响应： 257 “/”</p> 
 <p>命令： TYPE I</p> 
 <p>响应： 200 Switching to Binary mode.</p> 
 <p>命令： PORT 192，168，182，1，40，56</p> 
 <p>响应： 200 PORT command successful. Consider using PASV.</p> 
 <p>命令： LIST</p> 
 <p>响应： 150 Here comes the directory listing.</p> 
 <p>响应： 226 Directory send OK.</p> 
 <p>状态： 列出目录成功</p> 
 <p>状态： 已从服务器断开</p> 
 <p>状态： 正在连接 192.168.182.128:21.</p> 
 <p>状态： 连接建立，等待欢迎消息。</p> 
 <p>响应： 220 （vsFTPd 2.0.5）</p> 
 <p>命令： USER bugxm_general</p> 
 <p>响应： 331 Please specify the password.</p> 
 <p>命令： PASS ******</p> 
 <p>响应： 230 Login successful.</p> 
 <p>命令： OPTS UTF8 ON</p> 
 <p>响应： 200 Always in UTF8 mode.</p> 
 <p>状态： 已连接</p> 
 <p>状态： 开始上传 E：\Users\Desktop\index.htm</p> 
 <p>命令： CWD /</p> 
 <p>响应： 250 Directory successfully changed.</p> 
 <p>命令： PWD</p> 
 <p>响应： 257 “/”</p> 
 <p>命令： TYPE I</p> 
 <p>响应： 200 Switching to Binary mode.</p> 
 <p>命令： PORT 192，168，182，1，40，59</p> 
 <p>响应： 200 PORT command successful. Consider using PASV.</p> 
 <p>命令： STOR index.htm</p> 
 <p>响应： 550 Permission denied.</p> 
 <p>错误： 严重文件传输错误</p> 
 <p>总结：Vsftpd  整个配置过程实际上比较简单，但初次配置总会遇到各种不解的难题，如果稍微耐心一些，这些问题都很容易得到解决。转载请注明出处<a title="http://www.bugxm.com/system/linux/534.html" target="_blank" href="http://www.bugxm.com/system/linux/534.html" rel="nofollow noopener noreferrer">http://www.bugxm.com/system/linux/534.html</a>，谢谢。</p> 
</div> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bcf875c06c7473599709edd7347bad10/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于窗口操作的函数：MoveWindow、SetWindowPos和DeferWindowPos</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bf7c6efaf6ab3290bfecfd1f9e9c9dd6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android应用程序的生命周期</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>