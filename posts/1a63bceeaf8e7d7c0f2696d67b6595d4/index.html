<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>“淘宝” 开放平台接口设计思路|开放平台接口接入流程教程 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="“淘宝” 开放平台接口设计思路|开放平台接口接入流程教程" />
<meta property="og:description" content="最近对接的开放平台有点多，像淘宝、京东、快手、抖音等电商平台的开放平台基本对接了个遍，什么是CRUD BODY也许就是这样的吧！！！
虽然对接各大开放平台没啥技术含量，但咱也得学点东西不是，不能白对接哈！经过这几天的整理，脑子里大概有了个开放平台接口的设计套路，故整理成文章方便有需要的时间去实现自己的开放平台接口。
开放平台比较关注的几个点：
易用性：接口设计要简洁，请求参数要见名知意，使服务商能快速接收，为用户提供服务
安全性：开放平台接口是暴露在外网，必须保证用户数据的安全
稳定性：开放平台接口是给上游的服务商使用，必须保证稳定为服务商应用提供服务
...
服务商应用 开放平台可以分为几大部分：
接入指南：帮助服务商接入开放平台
接口文档：帮助服务商的开发人员，实现业务功能
应用：服务商应用在开放平台的身份标示
服务商接入开放平台的首要步骤就是创建应用，有了服务商应用平台内部就能辨别服务商的身份，这样就能很方便的做限流、权限控制等。
基本属性 服务商应用一般有appid、appsecret、授权回调地址这三个基本的属性：
appid: 服务商应用的唯一标识
appsecret：服务商应用的密钥签名、验证身份时用到
授权回调地址：授权时会用到
授权认证 授权不是开放平台对服务商应用的授权 ，而是需要开放平台的客户（用户）对服务商应用的授予，比如ERP应用，也就是淘宝的店铺商家对应用进行授权，使其能够拉取到店铺的订单来完成订单履约。
淘宝授权页
所以授权需要三个角色才能完成：
开放平台
提供授权页面，引导客户完成服务商应用的授权
客户完成授权后，跳转到服务商应用提供的授权回调地址同时带上授权信息
客户：在开放平台提供的授权页面中，完成对服务商应用的授权
服务商应用：接收开放平台回调的授权信息，完成务商应用与客户的绑定关系、保存授权信息
当然也可以使用appid &#43; appsecret 直接认证服务商应用的身份，这种适合没有第三方的时候，数据都是属于开放平台的，跟客户没有半点关系，也就不存在需要客户授权的问题。
OAuth2授权机制 OAuth2是一套授权标准，现在互联网做授权基本都用它，如github登陆 、微信公众号授权等都是基于OAuth2的应用。
授权流程
请求参数 请求参数分两类：系统参数、业务参数：
系统参数：每次API调用都必需携带的参数
业务参数：开放平台根据不同的业务，提供的参数。
业务参数根据业务来定，先说系统参数一般包含：
appid：服务商应用唯一标识
appsecret: 服务商应用密钥
timestamp：时间戳
sign：请求签名
系统参数使用url参数传递
业务参数 业务参数是调用开放平台接口时传递的请求参数，如一次订单查询接口，要实现按订单状态的维度查询订单，那么订单查询接口就需要接收status参数，然后去查库后返回订单数据。
业务参数的载体，常用的如：application/json、application/x-www-form-urlencode等。
业务参数使用post请求参数的方式传递，同时也需要参与签名，后面说签名会提到
请求签名 对请求签名的目的就是防止数据被篡改，常见的md5、sha都可以用来做为签名算法，理论上只要保证双方能够生成签名和验签就行，像支付宝这类高安全级别的应用就是使用的非对称加密，双方各生成一对私钥和公钥，然后交换公钥用于验签即可。
生成签名的方式自行定义，这里列举一个常见的签名生成方式：
sign = appsecret &#43; appid &#43; timestamp &#43; 业务参数（排序后） &#43; appsecret
伪代码
String appid = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/1a63bceeaf8e7d7c0f2696d67b6595d4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-26T10:58:03+08:00" />
<meta property="article:modified_time" content="2023-10-26T10:58:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">“淘宝” 开放平台接口设计思路|开放平台接口接入流程教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近对接的开放平台有点多，像淘宝、京东、快手、抖音等电商平台的开放平台基本对接了个遍，什么是<code>CRUD BODY</code>也许就是这样的吧！！！</p> 
<p>虽然对接各大开放平台没啥技术含量，但咱也得学点东西不是，不能白对接哈！经过这几天的整理，脑子里大概有了个开放平台接口的设计套路，故整理成文章方便有需要的时间去实现自己的开放平台接口。<img alt="" height="299" src="https://images2.imgbox.com/da/f7/hFU6znFG_o.png" width="588"></p> 
<p>开放平台比较关注的几个点：</p> 
<ul><li> <p>易用性：接口设计要简洁，请求参数要见名知意，使服务商能快速接收，为用户提供服务</p> </li><li> <p>安全性：开放平台接口是暴露在外网，必须保证用户数据的安全</p> </li><li> <p>稳定性：<a class="link-info" href="http://o0b.cn/tinale" rel="nofollow" title="开放平台接口">开放平台接口</a>是给上游的服务商使用，必须保证稳定为服务商应用提供服务</p> </li><li> <p>...</p> </li></ul> 
<h4>服务商应用</h4> 
<p>开放平台可以分为几大部分：</p> 
<ol><li> <p>接入指南：帮助服务商接入开放平台</p> </li><li> <p>接口文档：帮助服务商的开发人员，实现业务功能</p> </li><li> <p>应用：服务商应用在开放平台的身份标示</p> </li></ol> 
<p>服务商接入开放平台的首要步骤就是创建应用，有了服务商应用平台内部就能辨别服务商的身份，这样就能很方便的做限流、权限控制等。</p> 
<h5>基本属性</h5> 
<p>服务商应用一般有appid、appsecret、授权回调地址这三个基本的属性：</p> 
<ul><li> <p>appid: 服务商应用的唯一标识</p> </li><li> <p>appsecret：服务商应用的密钥签名、验证身份时用到</p> </li><li> <p>授权回调地址：授权时会用到</p> </li></ul> 
<h4>授权认证</h4> 
<p>授权不是开放平台对服务商应用的授权 ，而是需要开放平台的客户（用户）对服务商应用的授予，比如ERP应用，也就是淘宝的店铺商家对应用进行授权，使其能够拉取到店铺的订单来完成订单履约。</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="495" src="https://images2.imgbox.com/67/3d/YnKWkTbu_o.png" width="978"></p> 
<p>淘宝授权页</p> 
<p>所以授权需要三个角色才能完成：</p> 
<ul><li> <p>开放平台</p> 
  <ul><li> <p>提供授权页面，引导客户完成服务商应用的授权</p> </li><li> <p>客户完成授权后，跳转到服务商应用提供的<code>授权回调地址</code>同时带上授权信息</p> </li></ul></li><li> <p>客户：在开放平台提供的授权页面中，完成对服务商应用的授权</p> </li><li> <p>服务商应用：接收开放平台回调的授权信息，完成务商应用与客户的绑定关系、保存授权信息</p> </li></ul> 
<blockquote> 
 <p>当然也可以使用appid + appsecret 直接认证服务商应用的身份，这种适合没有第三方的时候，数据都是属于开放平台的，跟客户没有半点关系，也就不存在需要客户授权的问题。</p> 
</blockquote> 
<h5><code>OAuth2</code>授权机制</h5> 
<p><code>OAuth2</code>是一套授权标准，现在互联网做授权基本都用它，如<code>github</code>登陆 、<code>微信公众号授权</code>等都是基于<code>OAuth2</code>的应用。</p> 
<blockquote> 
 <p></p> 
</blockquote> 
<p></p> 
<p class="img-center"><img alt="图片" height="560" src="https://images2.imgbox.com/86/50/TNuaV6ii_o.png" width="839"></p> 
<p>授权流程</p> 
<h4>请求参数</h4> 
<p>请求参数分两类：<code>系统参数</code>、<code>业务参数</code>：</p> 
<ul><li> <p>系统参数：每次API调用都必需携带的参数</p> </li><li> <p>业务参数：开放平台根据不同的业务，提供的参数。</p> </li></ul> 
<p>业务参数根据业务来定，先说系统参数一般包含：</p> 
<ul><li> <p>appid：服务商应用唯一标识</p> </li><li> <p>appsecret: 服务商应用密钥</p> </li><li> <p>timestamp：时间戳</p> </li><li> <p>sign：请求签名</p> </li></ul> 
<blockquote> 
 <p>系统参数使用url参数传递</p> 
</blockquote> 
<h5>业务参数</h5> 
<p>业务参数是调用开放平台接口时传递的请求参数，如一次订单查询接口，要实现按<code>订单状态的维度</code>查询订单，那么订单查询接口就需要接收<code>status</code>参数，然后去查库后返回订单数据。</p> 
<p>业务参数的载体，常用的如：<code>application/json</code>、<code>application/x-www-form-urlencode</code>等。</p> 
<blockquote> 
 <p>业务参数使用post请求参数的方式传递，同时也需要参与签名，后面说签名会提到</p> 
</blockquote> 
<h4>请求签名</h4> 
<p>对请求签名的目的就是防止数据被篡改，常见的<code>md5</code>、<code>sha</code>都可以用来做为签名算法，理论上只要保证双方能够生成签名和验签就行，像支付宝这类高安全级别的应用就是使用的<code>非对称加密</code>，双方各生成一对私钥和公钥，然后交换公钥用于验签即可。</p> 
<p>生成签名的方式自行定义，这里列举一个常见的签名生成方式：</p> 
<blockquote> 
 <p>sign = appsecret + appid + timestamp + 业务参数（排序后） + appsecret</p> 
</blockquote> 
<p><strong>伪代码</strong></p> 
<pre><code>String appid = "abcd";
String appsecret = "12345";
Long timestamp = 948758686
//有序map，按key的值排序
Map&lt;String, Object&gt; requestBody = new TreeMap&lt;&gt;();
requestBody.put("a", 1);
requestBody.put("b",21);
requestBody.put("c", 2);
//转换成json字符串
String jsonBody = JSON.toJSONString(requestBody);
String sign  = DigestUtils.md5hex(appsecret + appid + timestamp + jsonBody + appsecret);
</code></pre> 
<h4>验签</h4> 
<p>验签步骤与生成签名的步骤类似，仿代码如下：</p> 
<pre><code>String appid = request.getParameter("appid");
String appsecret = request.getParameter("appsecret");
Long timestamp = request.getParameter("timestamp");
//拿出请求的业务参数，转成TreeMap
Map&lt;String, Object&gt; requestBody = new TreeMap&lt;&gt;(JSON.parseObject("post请求参数"));
//转换成json字符串
String jsonBody = JSON.toJSONString(requestBody);
String sign  = DigestUtils.md5hex(appsecret + appid + timestamp + jsonBody + appsecret);
String originSign =  request.getParameter("sign");
if(Objects.equals(sign ,originSign )){
  //验证签名成功
}else{
  //验证签名失败
}
</code></pre> 
<h4>总结</h4> 
<p>以上就是开放平台接口设计的一些思路，其实也是对接开放平台多了， 对那些开放平台对接的一些基本的套路的一些整理，希望有朝一日能用上。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd279725200904b26fcd74ffbedee275/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">BAT批处理：文件批量查找与复制</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f824679f973d27f47a86e9ba19862cf0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">相似歌曲（YOJ2.0中的题）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>