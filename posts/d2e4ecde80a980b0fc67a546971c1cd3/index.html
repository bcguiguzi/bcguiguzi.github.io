<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Msg 3059 This BACKUP or RESTORE command is not supported on a database mirror or secondary replica - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Msg 3059 This BACKUP or RESTORE command is not supported on a database mirror or secondary replica" />
<meta property="og:description" content="配置好 2012 AlwaysOn High availability Group就想体验一下在辅助数据库做备份的新功能。在辅助服务器备份，这样可以减轻主服务器的负载（非常好的一项改进，以前Databasemirroring辅助数据库是不可以访问的）。
但是备份的时候却报错：
Backup databasetesttodisk =&#39;c:\test.bak&#39;
Msg 3059, Level 16, State 1, Line 2
This BACKUP or RESTORE command is not supported ona database mirror or secondary replica.
Msg 3013, Level 16, State 1, Line 2
BACKUP DATABASE is terminating abnormally.
查了一下微软的网站才发现在辅助服务器备份有限制和局限性的：
·辅助副本只完全支持 BACKUP LOG。BACKUP DATABASE仅支持数据库、文件或文件组的仅复制完整备份。辅助副本不支持差异备份。
注意
仅复制备份不影响日志链。同样，仅复制备份也不清除差异位图。
·若要备份辅助数据库，辅助副本必须能够与主副本进行通信，并且状态必须为 SYNCHRONIZED或 SYNCHRONIZING。
·配置可用性组以支持辅助副本备份只会为要执行备份的位置创建备份首选项。
将脚本修改为Copy_Only选项备份成功：
backup databasetesttodisk =&#39;c:\test.bak&#39;withcopy_only
Processed 328 pages for database &#39;test&#39;, file&#39;test&#39; on file 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/d2e4ecde80a980b0fc67a546971c1cd3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-08-21T16:56:00+08:00" />
<meta property="article:modified_time" content="2012-08-21T16:56:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Msg 3059 This BACKUP or RESTORE command is not supported on a database mirror or secondary replica</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-size:14px;">配置好<span style="font-family:Calibri;font-size:14px;"> 2012 AlwaysOn High availability Group就想体验一下</span></span><span style="font-size:14px;"><span style="background:#FFFF00;">在辅助数据库做备份的新功能。在辅助服务器备份，</span>这样可以减轻主服务器的负载（非常好的一项改进，以前<span style="font-family:Calibri;">Databasemirroring</span>辅助数据库是不可以访问的）。</span></p> 
<p><span style="font-family:Calibri;font-size:14px;"></span></p> 
<p><span style="font-size:14px;">但是备份的时候却报错：</span></p> 
<p><span style="color:#0000FF;"></span></p> 
<p><span style="color:#0000FF;">Backup</span> <span style="color:#0000FF;">database</span><span style="color:#008080;">test</span><span style="color:#0000FF;">to</span><span style="color:#0000FF;">disk</span> <span style="color:#808080;">=</span><span style="color:#FF0000;">'c:\test.bak'</span></p> 
<p></p> 
<p>Msg 3059, Level 16, State 1, Line 2</p> 
<p>This BACKUP or RESTORE command is not supported ona database mirror or secondary replica.</p> 
<p>Msg 3013, Level 16, State 1, Line 2</p> 
<p>BACKUP DATABASE is terminating abnormally.</p> 
<p><span style="font-family:Calibri;font-size:14px;"></span></p> 
<p><span style="font-size:14px;">查了一下微软的网站才发现在辅助服务器备份有限制和局限性的：</span></p> 
<p><span style="font-size:14px;"></span></p> 
<p><span style="color:#000000;">·</span><span style="color:#000000;">辅助副本只完全支持</span><span style="color:#000000;"> BACKUP LOG</span><span style="color:#000000;">。</span><span style="color:#000000;">BACKUP DATABASE</span><span style="color:#000000;">仅支持数据库、文件或文件组的仅复制完整备份。</span><span style="color:#000000;">辅助副本不支持差异备份。</span></p> 
<table border="1" cellspacing="0" cellpadding="0" width="100%"><tbody><tr><td style="background:rgb(252,254,197);"> <p><strong><span style="color:#000000;">注意</span></strong></p> </td></tr><tr><td style="background:rgb(252,254,197);"> <p><span style="color:#000000;">仅复制备份不影响日志链。</span><span style="color:#000000;">同样，仅复制备份也不清除差异位图。</span></p> </td></tr></tbody></table> 
<p><span style="color:#000000;">·</span><span style="color:#000000;">若要备份辅助数据库，辅助副本必须能够与主副本进行通信，并且状态必须为</span><span style="color:#000000;"> SYNCHRONIZED</span><span style="color:#000000;">或</span><span style="color:#000000;"> SYNCHRONIZING</span><span style="color:#000000;">。</span></p> 
<p><span style="color:#000000;">·</span><span style="color:#000000;">配置可用性组以支持辅助副本备份只会为要执行备份的位置创建备份首选项。</span></p> 
<p><span style="font-family:Calibri;font-size:14px;"></span></p> 
<p><span style="font-size:14px;">将脚本修改为<span style="font-family:Calibri;">Copy_Only</span>选项备份成功：</span></p> 
<p></p> 
<p><span style="color:#0000FF;">backup</span> <span style="color:#0000FF;">database</span><span style="color:#008080;">test</span><span style="color:#0000FF;">to</span><span style="color:#0000FF;">disk</span> <span style="color:#808080;">=</span><span style="color:#FF0000;">'c:\test.bak'</span><span style="color:#0000FF;">with</span><span style="color:#0000FF;">copy_only</span></p> 
<p><span style="font-family:Calibri;font-size:14px;"></span></p> 
<p>Processed 328 pages for database 'test', file'test' on file 1.</p> 
<p>Processed 1 pages for database 'test', file'test_log' on file 1.</p> 
<p>BACKUP DATABASE successfully processed 329 pages in0.140 seconds (18.327 MB/sec).</p> 
<p></p> 
<p>备份日志不需要Copy_Only选项：</p> 
<p></p> 
<p><span style="color:#0000FF;">Backup</span> <span style="color:#FF00FF;">log</span> <span style="color:#008080;"> test</span> <span style="color:#0000FF;">to</span> <span style="color:#0000FF;">disk</span><span style="color:#808080;">=</span><span style="color:#FF0000;">'c:\test.trn'</span></p> 
<p></p> 
<p>参考：<a href="http://msdn.microsoft.com/zh-cn/library/hh710053.aspx" rel="nofollow"><span style="color:#0000ff;">http://msdn.microsoft.com/zh-cn/library/hh710053.aspx</span></a></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c87abc0d0927cf8413e5000caba193cc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">android  java开发 第一天 之熟悉eclipse adt</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/31f8dbcf9f7f6318ed6ddf3a94c37887/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">锂电池的并联</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>