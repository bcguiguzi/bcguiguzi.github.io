<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android通用的搜索框 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android通用的搜索框" />
<meta property="og:description" content="之前项目总会遇到很多搜索框类的功能，虽然不是很复杂，不过每次都要去自己处理数据，并且去处理搜索框的变化，写起来也比较麻烦，今天来做一个比较简单的通用搜索栏。
先看下效果图:
没什么特别的,只是今天要做的就是简单的把搜索框的内容封装一下.
一、分析功能 先考虑一下,搜索框一般都是由一个搜索图标(一般都是一个放大镜),一个输入框和一个清除按钮组成.然后会通过监听输入框的变化去处理清除按钮的显示和隐藏并且去过滤相关的数据.最后去刷新适配器,显示过滤后的数据.基本上搜索框的功能都大同小异. 有了上边的分析,我们可以去提取出一个通用的搜索框布局,然后写一个自定义ViewGroup去处理相关的页面显示等问题.
二、具体实现 先来写一些自定的属性,方便之后使用,新建一个attr文件并定义自定义属性如下:
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt; &lt;resources&gt; &lt;!--搜索图标左边margin--&gt; &lt;attr name=&#34;SearchBarIconMarginLeft&#34; format=&#34;dimension&#34;/&gt; &lt;!--搜索图标右边margin--&gt; &lt;attr name=&#34;SearchBarIconMarginRight&#34; format=&#34;dimension&#34;/&gt; &lt;!--搜索图标--&gt; &lt;attr name=&#34;SearchBarIconSrc&#34; format=&#34;reference&#34;/&gt; &lt;!--清除图标左边margin--&gt; &lt;attr name=&#34;ClearIconMarginLeft&#34; format=&#34;dimension&#34;/&gt; &lt;!--清除图标右边margin--&gt; &lt;attr name=&#34;ClearIconMarginRight&#34; format=&#34;dimension&#34;/&gt; &lt;!--清除图标--&gt; &lt;attr name=&#34;ClearIconSrc&#34; format=&#34;reference&#34;/&gt; &lt;!--搜索文字大小--&gt; &lt;attr name=&#34;SearchTextSize&#34; format=&#34;dimension&#34;/&gt; &lt;!--搜索文字颜色--&gt; &lt;attr name=&#34;SearchTextColor&#34; format=&#34;color&#34;/&gt; &lt;declare-styleable name=&#34;CommolySearchView&#34;&gt; &lt;attr name=&#34;SearchBarIconMarginLeft&#34;/&gt; &lt;attr name=&#34;SearchBarIconMarginRight&#34;/&gt; &lt;attr name=&#34;SearchBarIconSrc&#34;/&gt; &lt;attr name=&#34;ClearIconMarginLeft&#34;/&gt; &lt;attr name=&#34;ClearIconMarginRight&#34;/&gt; &lt;attr name=&#34;ClearIconSrc&#34;/&gt; &lt;attr name=&#34;SearchTextSize&#34;/&gt; &lt;attr name=&#34;SearchTextColor&#34;/&gt; &lt;/declare-styleable&gt; &lt;/resources&gt; 然后写一下搜索栏的布局searchview_layout.xml:
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt; &lt;LinearLayout xmlns:android=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/0df13ef8797749c3d8aff9b435e5e0d1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-06-02T10:31:41+08:00" />
<meta property="article:modified_time" content="2016-06-02T10:31:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android通用的搜索框</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>之前项目总会遇到很多搜索框类的功能，虽然不是很复杂，不过每次都要去自己处理数据，并且去处理搜索框的变化，写起来也比较麻烦，今天来做一个比较简单的通用搜索栏。</p> 
<p>先看下效果图:</p> 
<p><img src="https://images2.imgbox.com/e7/3e/hU6z4zFv_o.gif" alt="简单效果图" title=""></p> 
<p>没什么特别的,只是今天要做的就是简单的把搜索框的内容封装一下.</p> 
<hr> 
<h4 id="一分析功能">一、分析功能</h4> 
<p>先考虑一下,搜索框一般都是由一个搜索图标(一般都是一个放大镜),一个输入框和一个清除按钮组成.然后会通过监听输入框的变化去处理清除按钮的显示和隐藏并且去过滤相关的数据.最后去刷新适配器,显示过滤后的数据.基本上搜索框的功能都大同小异. <br> 有了上边的分析,我们可以去提取出一个通用的搜索框布局,然后写一个自定义ViewGroup去处理相关的页面显示等问题.</p> 
<hr> 
<h4 id="二具体实现">二、具体实现</h4> 
<p>先来写一些自定的属性,方便之后使用,新建一个attr文件并定义自定义属性如下:</p> 
<pre class="prettyprint"><code class="language-java hljs ">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;
&lt;resources&gt;
    &lt;!--搜索图标左边margin--&gt;
    &lt;attr name=<span class="hljs-string">"SearchBarIconMarginLeft"</span> format=<span class="hljs-string">"dimension"</span>/&gt;
    &lt;!--搜索图标右边margin--&gt;
    &lt;attr name=<span class="hljs-string">"SearchBarIconMarginRight"</span> format=<span class="hljs-string">"dimension"</span>/&gt;
    &lt;!--搜索图标--&gt;
    &lt;attr name=<span class="hljs-string">"SearchBarIconSrc"</span> format=<span class="hljs-string">"reference"</span>/&gt;
    &lt;!--清除图标左边margin--&gt;
    &lt;attr name=<span class="hljs-string">"ClearIconMarginLeft"</span> format=<span class="hljs-string">"dimension"</span>/&gt;
    &lt;!--清除图标右边margin--&gt;
    &lt;attr name=<span class="hljs-string">"ClearIconMarginRight"</span> format=<span class="hljs-string">"dimension"</span>/&gt;
    &lt;!--清除图标--&gt;
    &lt;attr name=<span class="hljs-string">"ClearIconSrc"</span> format=<span class="hljs-string">"reference"</span>/&gt;
    &lt;!--搜索文字大小--&gt;
    &lt;attr name=<span class="hljs-string">"SearchTextSize"</span> format=<span class="hljs-string">"dimension"</span>/&gt;
    &lt;!--搜索文字颜色--&gt;
    &lt;attr name=<span class="hljs-string">"SearchTextColor"</span> format=<span class="hljs-string">"color"</span>/&gt;
    &lt;declare-styleable name=<span class="hljs-string">"CommolySearchView"</span>&gt;
        &lt;attr name=<span class="hljs-string">"SearchBarIconMarginLeft"</span>/&gt;
        &lt;attr name=<span class="hljs-string">"SearchBarIconMarginRight"</span>/&gt;
        &lt;attr name=<span class="hljs-string">"SearchBarIconSrc"</span>/&gt;
        &lt;attr name=<span class="hljs-string">"ClearIconMarginLeft"</span>/&gt;
        &lt;attr name=<span class="hljs-string">"ClearIconMarginRight"</span>/&gt;
        &lt;attr name=<span class="hljs-string">"ClearIconSrc"</span>/&gt;
        &lt;attr name=<span class="hljs-string">"SearchTextSize"</span>/&gt;
        &lt;attr name=<span class="hljs-string">"SearchTextColor"</span>/&gt;
    &lt;/declare-styleable&gt;

&lt;/resources&gt;</code></pre> 
<p>然后写一下搜索栏的布局searchview_layout.xml:</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
              <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
              <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
              <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center_vertical"</span>
        <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"horizontal"</span>
        &gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/iv_search_icon"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_gravity</span>=<span class="hljs-value">"center_vertical"</span>
            <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@mipmap/search_bar_icon"</span>
            <span class="hljs-attribute">android:layout_marginRight</span>=<span class="hljs-value">"8dp"</span>
            /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">EditText
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/et_search"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"0dp"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
            <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@null"</span>
            <span class="hljs-attribute">android:singleLine</span>=<span class="hljs-value">"true"</span>
            /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/iv_search_clear"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_gravity</span>=<span class="hljs-value">"center_vertical"</span>
            <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@mipmap/search_clear_icon"</span>
            <span class="hljs-attribute">android:visibility</span>=<span class="hljs-value">"gone"</span>
            /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span></code></pre> 
<p>布局很简单,就是一个搜索图标加上一个输入框和一个清除图标,下边来写一下具体的实现,建立一个CommolySearchView继承自LinearLayout即可,先来定义一些属性,获取自定义属性并且绑定布局文件.代码如下:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-javadoc">/**
 * Created by junweiliu on 16/5/31.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommolySearchView</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">LinearLayout</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * 上下文
     */</span>
    <span class="hljs-keyword">private</span> Context mContext;
    <span class="hljs-javadoc">/**
     * 编辑框
     */</span>
    <span class="hljs-keyword">private</span> EditText mEditText;
    <span class="hljs-javadoc">/**
     * 清除按钮
     */</span>
    <span class="hljs-keyword">private</span> ImageView mClearImg;
    <span class="hljs-javadoc">/**
     * 搜索图标
     */</span>
    <span class="hljs-keyword">private</span> ImageView mSearchBarImg;
    <span class="hljs-javadoc">/**
     * 适配器
     */</span>
    <span class="hljs-keyword">private</span> BaseAdapter mAdapter;
    <span class="hljs-javadoc">/**
     * 数据源
     */</span>
    <span class="hljs-keyword">private</span> List&lt;T&gt; mDatas = <span class="hljs-keyword">new</span> ArrayList&lt;T&gt;();
    <span class="hljs-javadoc">/**
     * 数据源副本
     */</span>
    <span class="hljs-keyword">private</span> List&lt;T&gt; mDupDatas = <span class="hljs-keyword">new</span> ArrayList&lt;T&gt;();

    <span class="hljs-javadoc">/**
     * 筛选后的数据源
     */</span>
    <span class="hljs-keyword">private</span> List&lt;T&gt; mFilterDatas = <span class="hljs-keyword">new</span> ArrayList&lt;T&gt;();
    <span class="hljs-javadoc">/**
     * 筛选后的数据源副本
     */</span>
    <span class="hljs-keyword">private</span> List&lt;T&gt; mDupFilterDatas = <span class="hljs-keyword">new</span> ArrayList&lt;T&gt;();
    <span class="hljs-javadoc">/**
     * 搜索图标
     */</span>
    <span class="hljs-keyword">private</span> Bitmap mSearchIcon;
    <span class="hljs-javadoc">/**
     * 搜索框距离左边边距
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mSearchIconMarginLeft;
    <span class="hljs-javadoc">/**
     * 搜索框距离右边边距
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mSearchIconMarginRight;
    <span class="hljs-javadoc">/**
     * 清除图标
     */</span>
    <span class="hljs-keyword">private</span> Bitmap mClearIcon;
    <span class="hljs-javadoc">/**
     * 清除图标距离左边边距
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mClearIconMarginLeft;
    <span class="hljs-javadoc">/**
     * 清除图标距离右边边距
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mClearIconMarginRight;
    <span class="hljs-javadoc">/**
     * 搜索文字大小
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mSearchTextSize;
    <span class="hljs-javadoc">/**
     * 搜索文字颜色
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mSearchTextColor;

    <span class="hljs-keyword">public</span> <span class="hljs-title">CommolySearchView</span>(Context context) {
        <span class="hljs-keyword">this</span>(context, <span class="hljs-keyword">null</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">CommolySearchView</span>(Context context, AttributeSet attrs) {
        <span class="hljs-keyword">this</span>(context, attrs, <span class="hljs-number">0</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">CommolySearchView</span>(Context context, AttributeSet attrs, <span class="hljs-keyword">int</span> defStyleAttr) {
        <span class="hljs-keyword">super</span>(context, attrs, defStyleAttr);
        mContext = context;
        <span class="hljs-comment">// 自定义属性</span>
        TypedArray ta = context.obtainStyledAttributes(attrs, R.styleable.CommolySearchView);
        Drawable searchD = ta.getDrawable(R.styleable.CommolySearchView_SearchBarIconSrc);
        mSearchIcon = drawableToBitamp(searchD);
        mSearchIconMarginLeft = px2dip(context, ta.getDimensionPixelOffset(R.styleable.CommolySearchView_SearchBarIconMarginLeft, <span class="hljs-number">0</span>));
        mSearchIconMarginRight = px2dip(context, ta.getDimensionPixelOffset(R.styleable.CommolySearchView_SearchBarIconMarginRight, <span class="hljs-number">0</span>));
        Drawable clearD = ta.getDrawable(R.styleable.CommolySearchView_ClearIconSrc);
        mClearIcon = drawableToBitamp(clearD);
        mClearIconMarginLeft = px2dip(context, ta.getDimensionPixelOffset(R.styleable.CommolySearchView_ClearIconMarginLeft, <span class="hljs-number">0</span>));
        mClearIconMarginRight = px2dip(context, ta.getDimensionPixelOffset(R.styleable.CommolySearchView_ClearIconMarginRight, <span class="hljs-number">0</span>));
        mSearchTextSize = px2sp(context, ta.getDimensionPixelOffset(R.styleable.CommolySearchView_SearchTextSize, <span class="hljs-number">0</span>));
        mSearchTextColor = ta.getColor(R.styleable.CommolySearchView_SearchTextColor, <span class="hljs-number">0</span>);
        ta.recycle();
        <span class="hljs-comment">// 绑定布局文件</span>
        LayoutInflater.from(context).inflate(R.layout.searchview_layout, <span class="hljs-keyword">this</span>);
        initView();
    }    </code></pre> 
<p>可以看到我们使用了泛型,目的是为了处理不同的数据源类型,接下来需要初始化控件,看一下initView方法:</p> 
<pre class="prettyprint"><code class="language-java hljs ">    <span class="hljs-javadoc">/**
     * 初始化控件
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span>() {
        mEditText = (EditText) findViewById(R.id.et_search);
        mClearImg = (ImageView) findViewById(R.id.iv_search_clear);
        mSearchBarImg = (ImageView) findViewById(R.id.iv_search_icon);
        <span class="hljs-comment">// 处理自定义属性</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != mSearchIconMarginLeft || <span class="hljs-number">0</span> != mSearchIconMarginRight) {
            mSearchBarImg.setPadding(mSearchIconMarginLeft, <span class="hljs-number">0</span>, mSearchIconMarginRight, <span class="hljs-number">0</span>);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != mClearIconMarginLeft || <span class="hljs-number">0</span> != mClearIconMarginRight) {
            mClearImg.setPadding(mClearIconMarginLeft, <span class="hljs-number">0</span>, mClearIconMarginRight, <span class="hljs-number">0</span>);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mSearchIcon) {
            mSearchBarImg.setImageBitmap(mSearchIcon);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mClearIcon) {
            mClearImg.setImageBitmap(mClearIcon);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != mSearchTextSize) {
            mEditText.setTextSize(mSearchTextSize);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != mSearchTextColor) {
            mEditText.setTextColor(mSearchTextColor);
        }
        <span class="hljs-comment">// 清空按钮处理事件</span>
        mClearImg.setOnClickListener(<span class="hljs-keyword">new</span> OnClickListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View view) {

            }
        });
        <span class="hljs-comment">// 搜索栏处理事件</span>
        mEditText.addTextChangedListener(<span class="hljs-keyword">new</span> TextWatcher() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">beforeTextChanged</span>(CharSequence charSequence, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> i1, <span class="hljs-keyword">int</span> i2) {

            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onTextChanged</span>(CharSequence charSequence, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> i1, <span class="hljs-keyword">int</span> i2) {

            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterTextChanged</span>(Editable editable) {

            }
        });
    }</code></pre> 
<p>这样初始化控件的任务也完成了,下面就是处理具体逻辑的部分,我们打算在CommonlySearchView完成清除按钮的显示隐藏,编辑框内容的处理,对适配器进行刷新的功能,具体数据的筛选工作,使用一个回调接口,由使用者去进行筛选,只需要获取筛选后的数据即可,然后通过筛选后的数据,去刷新适配器来完成要实现的功能.所以要对外提供一些方法,来获取到适配器,及一些数据源.</p> 
<pre class="prettyprint"><code class="language-java hljs ">   <span class="hljs-javadoc">/**
     * 设置数据源
     *
     *<span class="hljs-javadoctag"> @param</span> datas
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDatas</span>(List&lt;T&gt; datas) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == datas) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mDatas) {
            mDatas.clear();
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mDupDatas) {
            mDupDatas.clear();
        }
        mDatas = datas;
        mDupDatas.addAll(mDatas);
    }

    <span class="hljs-javadoc">/**
     * 设置适配器
     *
     *<span class="hljs-javadoctag"> @param</span> adapter
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAdapter</span>(BaseAdapter adapter) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == adapter) {
            <span class="hljs-keyword">return</span>;
        }
        mAdapter = adapter;
    }</code></pre> 
<p>获取到适配器及数据源,并且做了相关数据备份工作.</p> 
<p>接着要提供一个回调接口来得到筛选后的数据.</p> 
<pre class="prettyprint"><code class="language-java hljs ">    <span class="hljs-javadoc">/**
     * 回调接口
     *
     *<span class="hljs-javadoctag"> @param</span> &lt;T&gt;
     */</span>
    interface SearchDatas&lt;T&gt; {
        <span class="hljs-javadoc">/**
         * 参数一:全部数据,参数二:筛选后的数据,参数三:输入的内容
         *
         *<span class="hljs-javadoctag"> @param</span> datas
         *<span class="hljs-javadoctag"> @param</span> filterdatas
         *<span class="hljs-javadoctag"> @param</span> inputstr
         *<span class="hljs-javadoctag"> @return</span> 筛选后的数据
         */</span>
        List&lt;T&gt; filterDatas(List&lt;T&gt; datas, List&lt;T&gt; filterdatas, String inputstr);
    }

    <span class="hljs-javadoc">/**
     * 回调
     */</span>
    <span class="hljs-keyword">private</span> SearchDatas&lt;T&gt; mListener;

    <span class="hljs-javadoc">/**
     * 设置回调
     *
     *<span class="hljs-javadoctag"> @param</span> listener
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSearchDataListener</span>(SearchDatas&lt;T&gt; listener) {
        mListener = listener;

    }
</code></pre> 
<p>同样需要对外提供一个方法,以便使用者获取到筛选后的数据去做相关操作.</p> 
<pre class="prettyprint"><code class="language-java hljs ">    <span class="hljs-javadoc">/**
     * 获取筛选后的数据
     *
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-keyword">public</span> List&lt;T&gt; <span class="hljs-title">getFilterDatas</span>() {
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">null</span> != mDupFilterDatas &amp;&amp; mDupFilterDatas.size() &gt; <span class="hljs-number">0</span>) ? mDupFilterDatas : mDupDatas;
    }</code></pre> 
<p>得到数据之后,就是在输入框和清除按钮的监听方法中去做相关处理就可以了,完整代码如下:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.commonlysearchview;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.res.TypedArray;
<span class="hljs-keyword">import</span> android.graphics.Bitmap;
<span class="hljs-keyword">import</span> android.graphics.Canvas;
<span class="hljs-keyword">import</span> android.graphics.drawable.BitmapDrawable;
<span class="hljs-keyword">import</span> android.graphics.drawable.Drawable;
<span class="hljs-keyword">import</span> android.text.Editable;
<span class="hljs-keyword">import</span> android.text.TextWatcher;
<span class="hljs-keyword">import</span> android.util.AttributeSet;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.LayoutInflater;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.BaseAdapter;
<span class="hljs-keyword">import</span> android.widget.Button;
<span class="hljs-keyword">import</span> android.widget.EditText;
<span class="hljs-keyword">import</span> android.widget.ImageView;
<span class="hljs-keyword">import</span> android.widget.LinearLayout;
<span class="hljs-keyword">import</span> android.widget.ListView;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-javadoc">/**
 * Created by junweiliu on 16/5/31.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommolySearchView</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">LinearLayout</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * 上下文
     */</span>
    <span class="hljs-keyword">private</span> Context mContext;
    <span class="hljs-javadoc">/**
     * 编辑框
     */</span>
    <span class="hljs-keyword">private</span> EditText mEditText;
    <span class="hljs-javadoc">/**
     * 清除按钮
     */</span>
    <span class="hljs-keyword">private</span> ImageView mClearImg;
    <span class="hljs-javadoc">/**
     * 搜索图标
     */</span>
    <span class="hljs-keyword">private</span> ImageView mSearchBarImg;
    <span class="hljs-javadoc">/**
     * 适配器
     */</span>
    <span class="hljs-keyword">private</span> BaseAdapter mAdapter;
    <span class="hljs-javadoc">/**
     * 数据源
     */</span>
    <span class="hljs-keyword">private</span> List&lt;T&gt; mDatas = <span class="hljs-keyword">new</span> ArrayList&lt;T&gt;();
    <span class="hljs-javadoc">/**
     * 数据源副本
     */</span>
    <span class="hljs-keyword">private</span> List&lt;T&gt; mDupDatas = <span class="hljs-keyword">new</span> ArrayList&lt;T&gt;();

    <span class="hljs-javadoc">/**
     * 筛选后的数据源
     */</span>
    <span class="hljs-keyword">private</span> List&lt;T&gt; mFilterDatas = <span class="hljs-keyword">new</span> ArrayList&lt;T&gt;();
    <span class="hljs-javadoc">/**
     * 筛选后的数据源副本
     */</span>
    <span class="hljs-keyword">private</span> List&lt;T&gt; mDupFilterDatas = <span class="hljs-keyword">new</span> ArrayList&lt;T&gt;();
    <span class="hljs-javadoc">/**
     * 搜索图标
     */</span>
    <span class="hljs-keyword">private</span> Bitmap mSearchIcon;
    <span class="hljs-javadoc">/**
     * 搜索框距离左边边距
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mSearchIconMarginLeft;
    <span class="hljs-javadoc">/**
     * 搜索框距离右边边距
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mSearchIconMarginRight;
    <span class="hljs-javadoc">/**
     * 清除图标
     */</span>
    <span class="hljs-keyword">private</span> Bitmap mClearIcon;
    <span class="hljs-javadoc">/**
     * 清除图标距离左边边距
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mClearIconMarginLeft;
    <span class="hljs-javadoc">/**
     * 清除图标距离右边边距
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mClearIconMarginRight;
    <span class="hljs-javadoc">/**
     * 搜索文字大小
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mSearchTextSize;
    <span class="hljs-javadoc">/**
     * 搜索文字颜色
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mSearchTextColor;

    <span class="hljs-javadoc">/**
     * 回调接口
     *
     *<span class="hljs-javadoctag"> @param</span> &lt;T&gt;
     */</span>
    interface SearchDatas&lt;T&gt; {
        <span class="hljs-javadoc">/**
         * 参数一:全部数据,参数二:筛选后的数据,参数三:输入的内容
         *
         *<span class="hljs-javadoctag"> @param</span> datas
         *<span class="hljs-javadoctag"> @param</span> filterdatas
         *<span class="hljs-javadoctag"> @param</span> inputstr
         *<span class="hljs-javadoctag"> @return</span>
         */</span>
        List&lt;T&gt; filterDatas(List&lt;T&gt; datas, List&lt;T&gt; filterdatas, String inputstr);
    }

    <span class="hljs-javadoc">/**
     * 回调
     */</span>
    <span class="hljs-keyword">private</span> SearchDatas&lt;T&gt; mListener;

    <span class="hljs-javadoc">/**
     * 设置回调
     *
     *<span class="hljs-javadoctag"> @param</span> listener
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSearchDataListener</span>(SearchDatas&lt;T&gt; listener) {
        mListener = listener;

    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">CommolySearchView</span>(Context context) {
        <span class="hljs-keyword">this</span>(context, <span class="hljs-keyword">null</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">CommolySearchView</span>(Context context, AttributeSet attrs) {
        <span class="hljs-keyword">this</span>(context, attrs, <span class="hljs-number">0</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">CommolySearchView</span>(Context context, AttributeSet attrs, <span class="hljs-keyword">int</span> defStyleAttr) {
        <span class="hljs-keyword">super</span>(context, attrs, defStyleAttr);
        mContext = context;
        <span class="hljs-comment">// 自定义属性</span>
        TypedArray ta = context.obtainStyledAttributes(attrs, R.styleable.CommolySearchView);
        Drawable searchD = ta.getDrawable(R.styleable.CommolySearchView_SearchBarIconSrc);
        mSearchIcon = drawableToBitamp(searchD);
        mSearchIconMarginLeft = px2dip(context, ta.getDimensionPixelOffset(R.styleable.CommolySearchView_SearchBarIconMarginLeft, <span class="hljs-number">0</span>));
        mSearchIconMarginRight = px2dip(context, ta.getDimensionPixelOffset(R.styleable.CommolySearchView_SearchBarIconMarginRight, <span class="hljs-number">0</span>));
        Drawable clearD = ta.getDrawable(R.styleable.CommolySearchView_ClearIconSrc);
        mClearIcon = drawableToBitamp(clearD);
        mClearIconMarginLeft = px2dip(context, ta.getDimensionPixelOffset(R.styleable.CommolySearchView_ClearIconMarginLeft, <span class="hljs-number">0</span>));
        mClearIconMarginRight = px2dip(context, ta.getDimensionPixelOffset(R.styleable.CommolySearchView_ClearIconMarginRight, <span class="hljs-number">0</span>));
        mSearchTextSize = px2sp(context, ta.getDimensionPixelOffset(R.styleable.CommolySearchView_SearchTextSize, <span class="hljs-number">0</span>));
        mSearchTextColor = ta.getColor(R.styleable.CommolySearchView_SearchTextColor, <span class="hljs-number">0</span>);
        ta.recycle();
        <span class="hljs-comment">// 绑定布局文件</span>
        LayoutInflater.from(context).inflate(R.layout.searchview_layout, <span class="hljs-keyword">this</span>);
        initView();
    }

    <span class="hljs-javadoc">/**
     * 初始化控件
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span>() {
        mEditText = (EditText) findViewById(R.id.et_search);
        mClearImg = (ImageView) findViewById(R.id.iv_search_clear);
        mSearchBarImg = (ImageView) findViewById(R.id.iv_search_icon);
        <span class="hljs-comment">// 处理自定义属性</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != mSearchIconMarginLeft || <span class="hljs-number">0</span> != mSearchIconMarginRight) {
            mSearchBarImg.setPadding(mSearchIconMarginLeft, <span class="hljs-number">0</span>, mSearchIconMarginRight, <span class="hljs-number">0</span>);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != mClearIconMarginLeft || <span class="hljs-number">0</span> != mClearIconMarginRight) {
            mClearImg.setPadding(mClearIconMarginLeft, <span class="hljs-number">0</span>, mClearIconMarginRight, <span class="hljs-number">0</span>);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mSearchIcon) {
            mSearchBarImg.setImageBitmap(mSearchIcon);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mClearIcon) {
            mClearImg.setImageBitmap(mClearIcon);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != mSearchTextSize) {
            mEditText.setTextSize(mSearchTextSize);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != mSearchTextColor) {
            mEditText.setTextColor(mSearchTextColor);
        }
        <span class="hljs-comment">// 清空按钮处理事件</span>
        mClearImg.setOnClickListener(<span class="hljs-keyword">new</span> OnClickListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View view) {
                mEditText.setText(<span class="hljs-string">""</span>);
                mClearImg.setVisibility(View.GONE);
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mDatas) {
                    mDatas.clear();
                }
                mDatas.addAll(mDupDatas);
                mAdapter.notifyDataSetChanged();
                reSetDatas();
            }
        });
        <span class="hljs-comment">// 搜索栏处理事件</span>
        mEditText.addTextChangedListener(<span class="hljs-keyword">new</span> TextWatcher() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">beforeTextChanged</span>(CharSequence charSequence, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> i1, <span class="hljs-keyword">int</span> i2) {

            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onTextChanged</span>(CharSequence charSequence, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> i1, <span class="hljs-keyword">int</span> i2) {
                <span class="hljs-comment">// 获取筛选后的数据</span>
                mFilterDatas = mListener.filterDatas(mDupDatas, mFilterDatas, charSequence.toString());
                <span class="hljs-keyword">if</span> (charSequence.toString().length() &gt; <span class="hljs-number">0</span> &amp;&amp; !charSequence.toString().equals(<span class="hljs-string">""</span>)) {
                    mClearImg.setVisibility(View.VISIBLE);
                } <span class="hljs-keyword">else</span> {
                    mClearImg.setVisibility(View.GONE);
                }
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mDatas) {
                    mDatas.clear();
                }
                mDatas.addAll(mFilterDatas);
                mAdapter.notifyDataSetChanged();
                reSetDatas();
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterTextChanged</span>(Editable editable) {

            }
        });
    }

    <span class="hljs-javadoc">/**
     * 获取筛选后的数据
     *
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-keyword">public</span> List&lt;T&gt; <span class="hljs-title">getFilterDatas</span>() {
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">null</span> != mDupFilterDatas &amp;&amp; mDupFilterDatas.size() &gt; <span class="hljs-number">0</span>) ? mDupFilterDatas : mDupDatas;
    }


    <span class="hljs-javadoc">/**
     * 重置数据
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">reSetDatas</span>() {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mFilterDatas) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mDupFilterDatas) {
                mDupFilterDatas.clear();
                mDupFilterDatas.addAll(mFilterDatas);
            }
            mFilterDatas.clear();
        }
    }

    <span class="hljs-javadoc">/**
     * 设置数据源
     *
     *<span class="hljs-javadoctag"> @param</span> datas
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDatas</span>(List&lt;T&gt; datas) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == datas) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mDatas) {
            mDatas.clear();
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != mDupDatas) {
            mDupDatas.clear();
        }
        mDatas = datas;
        mDupDatas.addAll(mDatas);
    }

    <span class="hljs-javadoc">/**
     * 设置适配器
     *
     *<span class="hljs-javadoctag"> @param</span> adapter
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAdapter</span>(BaseAdapter adapter) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == adapter) {
            <span class="hljs-keyword">return</span>;
        }
        mAdapter = adapter;
    }

    <span class="hljs-javadoc">/**
     * drawable转bitmap
     *
     *<span class="hljs-javadoctag"> @param</span> drawable
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-keyword">private</span> Bitmap <span class="hljs-title">drawableToBitamp</span>(Drawable drawable) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == drawable) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
        <span class="hljs-keyword">if</span> (drawable <span class="hljs-keyword">instanceof</span> BitmapDrawable) {
            BitmapDrawable bd = (BitmapDrawable) drawable;
            <span class="hljs-keyword">return</span> bd.getBitmap();
        }
        <span class="hljs-keyword">int</span> w = drawable.getIntrinsicWidth();
        <span class="hljs-keyword">int</span> h = drawable.getIntrinsicHeight();
        Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);
        Canvas canvas = <span class="hljs-keyword">new</span> Canvas(bitmap);
        drawable.setBounds(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h);
        drawable.draw(canvas);
        <span class="hljs-keyword">return</span> bitmap;
    }

    <span class="hljs-javadoc">/**
     * 将px值转换为dip或dp值，保证尺寸大小不变
     *
     *<span class="hljs-javadoctag"> @param</span> pxValue
     *<span class="hljs-javadoctag"> @return</span>
     *<span class="hljs-javadoctag"> @param</span>（DisplayMetrics类中属性density）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">px2dip</span>(Context context, <span class="hljs-keyword">float</span> pxValue) {
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> scale = context.getResources().getDisplayMetrics().density;
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) (pxValue / scale + <span class="hljs-number">0.5</span>f);
    }


    <span class="hljs-javadoc">/**
     * 将px值转换为sp值，保证文字大小不变
     *
     *<span class="hljs-javadoctag"> @param</span> pxValue
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">px2sp</span>(Context context, <span class="hljs-keyword">float</span> pxValue) {
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> fontScale = context.getResources().getDisplayMetrics().scaledDensity;
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) (pxValue / fontScale + <span class="hljs-number">0.5</span>f);
    }
}
</code></pre> 
<hr> 
<h4 id="三完整代码及使用">三、完整代码及使用</h4> 
<p>换一个复杂点的listview来使用一下.很简单,就是普通的Listview绑定数据,我们结合CommolySearchView来使用一下.</p> 
<p>实体Bean <br> SanGuoBean:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.commonlysearchview.bean;

<span class="hljs-javadoc">/**
 * Created by junweiliu on 16/6/1.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SanGuoBean</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * 名称
     */</span>
    <span class="hljs-keyword">private</span> String sgName;
    <span class="hljs-javadoc">/**
     * 描述
     */</span>
    <span class="hljs-keyword">private</span> String sgDescribe;
    <span class="hljs-javadoc">/**
     * 头像
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> sgHeadBp;
    <span class="hljs-javadoc">/**
     * 字
     */</span>
    <span class="hljs-keyword">private</span> String sgPetName;

    <span class="hljs-keyword">public</span> <span class="hljs-title">SanGuoBean</span>() {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">SanGuoBean</span>(String sgName, String sgDescribe, <span class="hljs-keyword">int</span> sgHeadBp, String sgPetName) {
        <span class="hljs-keyword">this</span>.sgName = sgName;
        <span class="hljs-keyword">this</span>.sgDescribe = sgDescribe;
        <span class="hljs-keyword">this</span>.sgHeadBp = sgHeadBp;
        <span class="hljs-keyword">this</span>.sgPetName = sgPetName;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">getSgName</span>() {
        <span class="hljs-keyword">return</span> sgName;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSgName</span>(String sgName) {
        <span class="hljs-keyword">this</span>.sgName = sgName;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">getSgDescribe</span>() {
        <span class="hljs-keyword">return</span> sgDescribe;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSgDescribe</span>(String sgDescribe) {
        <span class="hljs-keyword">this</span>.sgDescribe = sgDescribe;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getSgHeadBp</span>() {
        <span class="hljs-keyword">return</span> sgHeadBp;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSgHeadBp</span>(<span class="hljs-keyword">int</span> sgHeadBp) {
        <span class="hljs-keyword">this</span>.sgHeadBp = sgHeadBp;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title">getSgPetName</span>() {
        <span class="hljs-keyword">return</span> sgPetName;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSgPetName</span>(String sgPetName) {
        <span class="hljs-keyword">this</span>.sgPetName = sgPetName;
    }
}</code></pre> 
<p>适配器每项布局文件sg_item:</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
              <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
              <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
              <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center_vertical"</span>
              <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"horizontal"</span>
              <span class="hljs-attribute">android:padding</span>=<span class="hljs-value">"6dp"</span>
    &gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/iv_sghead"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"80dp"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"80dp"</span>
        <span class="hljs-attribute">android:scaleType</span>=<span class="hljs-value">"fitXY"</span>
        <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@mipmap/ic_launcher"</span>
        /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"0dp"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_marginLeft</span>=<span class="hljs-value">"8dp"</span>
        <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
        <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span>
        &gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/tv_sgname"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"16sp"</span>
            /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/tv_sgpetname"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_marginTop</span>=<span class="hljs-value">"2dp"</span>
            <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"12sp"</span>
            /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/tv_sgdes"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_marginTop</span>=<span class="hljs-value">"2dp"</span>
            <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"12sp"</span>
            /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span></code></pre> 
<p>适配器SGAdapter:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.commonlysearchview.adapter;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.view.LayoutInflater;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.view.ViewGroup;
<span class="hljs-keyword">import</span> android.widget.BaseAdapter;
<span class="hljs-keyword">import</span> android.widget.ImageView;
<span class="hljs-keyword">import</span> android.widget.TextView;

<span class="hljs-keyword">import</span> com.example.junweiliu.commonlysearchview.R;
<span class="hljs-keyword">import</span> com.example.junweiliu.commonlysearchview.bean.SanGuoBean;
<span class="hljs-keyword">import</span> com.example.junweiliu.commonlysearchview.bean.SearchBean;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-javadoc">/**
 * Created by junweiliu on 16/6/1.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SGAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseAdapter</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * 上下文
     */</span>
    <span class="hljs-keyword">private</span> Context mContext;

    <span class="hljs-javadoc">/**
     * 数据源
     */</span>
    <span class="hljs-keyword">private</span> List&lt;SanGuoBean&gt; mDatas;


    <span class="hljs-javadoc">/**
     * 构造函数
     *
     *<span class="hljs-javadoctag"> @param</span> context
     *<span class="hljs-javadoctag"> @param</span> datas
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title">SGAdapter</span>(Context context, List&lt;SanGuoBean&gt; datas) {
        mContext = context;
        mDatas = datas;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getCount</span>() {
        <span class="hljs-keyword">return</span> mDatas.size();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title">getItem</span>(<span class="hljs-keyword">int</span> i) {
        <span class="hljs-keyword">return</span> mDatas.get(i);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getItemId</span>(<span class="hljs-keyword">int</span> i) {
        <span class="hljs-keyword">return</span> i;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> View <span class="hljs-title">getView</span>(<span class="hljs-keyword">int</span> position, View view, ViewGroup viewGroup) {
        ViewHolder vh = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == view) {
            vh = <span class="hljs-keyword">new</span> ViewHolder();
            LayoutInflater mInflater = LayoutInflater.from(mContext);
            view = mInflater.inflate(R.layout.sg_item, <span class="hljs-keyword">null</span>);
            vh.mNameTv = (TextView) view.findViewById(R.id.tv_sgname);
            vh.mPetNmaeTv = (TextView) view.findViewById(R.id.tv_sgpetname);
            vh.mDesTv = (TextView) view.findViewById(R.id.tv_sgdes);
            vh.mHeadImg = (ImageView) view.findViewById(R.id.iv_sghead);
            view.setTag(vh);
        } <span class="hljs-keyword">else</span> {
            vh = (ViewHolder) view.getTag();
        }
        SanGuoBean bean = (SanGuoBean) getItem(position);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> != bean) {
            vh.mNameTv.setText(bean.getSgName());
            vh.mDesTv.setText(bean.getSgDescribe());
            vh.mPetNmaeTv.setText(bean.getSgPetName());
            vh.mHeadImg.setImageResource(bean.getSgHeadBp());
        }
        <span class="hljs-keyword">return</span> view;
    }


    <span class="hljs-javadoc">/**
     * vh
     */</span>
    class ViewHolder {
        <span class="hljs-javadoc">/**
         * 姓名
         */</span>
        TextView mNameTv;
        <span class="hljs-javadoc">/**
         * 描述
         */</span>
        TextView mDesTv;
        <span class="hljs-javadoc">/**
         * 字
         */</span>
        TextView mPetNmaeTv;
        <span class="hljs-javadoc">/**
         * 头像
         */</span>
        ImageView mHeadImg;
    }
}
</code></pre> 
<p>MainActivity布局文件activity_main:</p> 
<pre class="prettyprint"><code class="language-java hljs ">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;
&lt;LinearLayout
    xmlns:android=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    xmlns:search=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span>
    xmlns:tools=<span class="hljs-string">"http://schemas.android.com/tools"</span>
    android:layout_width=<span class="hljs-string">"match_parent"</span>
    android:layout_height=<span class="hljs-string">"match_parent"</span>
    android:orientation=<span class="hljs-string">"vertical"</span>
    tools:context=<span class="hljs-string">"com.example.junweiliu.commonlysearchview.MainActivity"</span>&gt;


    &lt;com.example.junweiliu.commonlysearchview.CommolySearchView
        android:id=<span class="hljs-string">"@+id/csv_show"</span>
        android:layout_width=<span class="hljs-string">"match_parent"</span>
        android:layout_height=<span class="hljs-string">"40dp"</span>
        android:layout_margin=<span class="hljs-string">"8dip"</span>
        android:background=<span class="hljs-string">"@drawable/login_et_bg"</span>
        search:SearchTextColor=<span class="hljs-string">"#ff0000"</span>
        search:SearchTextSize=<span class="hljs-string">"14sp"</span>
        &gt;
    &lt;/com.example.junweiliu.commonlysearchview.CommolySearchView&gt;


    &lt;ListView
        android:id=<span class="hljs-string">"@+id/lv_show"</span>
        android:layout_width=<span class="hljs-string">"match_parent"</span>
        android:layout_height=<span class="hljs-string">"match_parent"</span>
        &gt;
    &lt;/ListView&gt;

&lt;/LinearLayout&gt;
</code></pre> 
<p>MainActivity:</p> 
<pre class="prettyprint"><code class="language-java hljs "><span class="hljs-keyword">package</span> com.example.junweiliu.commonlysearchview;

<span class="hljs-keyword">import</span> android.app.Activity;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.AdapterView;
<span class="hljs-keyword">import</span> android.widget.ListView;
<span class="hljs-keyword">import</span> android.widget.Toast;

<span class="hljs-keyword">import</span> com.example.junweiliu.commonlysearchview.adapter.SGAdapter;
<span class="hljs-keyword">import</span> com.example.junweiliu.commonlysearchview.adapter.SearchAdapter;
<span class="hljs-keyword">import</span> com.example.junweiliu.commonlysearchview.bean.SanGuoBean;
<span class="hljs-keyword">import</span> com.example.junweiliu.commonlysearchview.bean.SearchBean;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;


<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Activity</span> {<!-- --></span>
    <span class="hljs-javadoc">/**
     * TAG
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = <span class="hljs-string">"MainActivity"</span>;
    <span class="hljs-javadoc">/**
     * 数据显示listview
     */</span>
    <span class="hljs-keyword">private</span> ListView mListView;
    <span class="hljs-javadoc">/**
     * 适配器
     */</span>
    <span class="hljs-keyword">private</span> SearchAdapter adapter;
    <span class="hljs-javadoc">/**
     * 三国通用搜索框
     */</span>
    <span class="hljs-keyword">private</span> CommolySearchView&lt;SanGuoBean&gt; mSGCommolySearchView;
    <span class="hljs-javadoc">/**
     * 三国数据源
     */</span>
    <span class="hljs-keyword">private</span> List&lt;SanGuoBean&gt; mSGDatas;
    <span class="hljs-javadoc">/**
     * 三国适配器
     */</span>
    <span class="hljs-keyword">private</span> SGAdapter sgAdapter;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        initDataI();
        initViewI();
    }
    <span class="hljs-javadoc">/**
     * 初始化数据
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initDataI</span>() {
        mSGDatas = <span class="hljs-keyword">new</span> ArrayList&lt;SanGuoBean&gt;();
        SanGuoBean sgbean1 = <span class="hljs-keyword">new</span> SanGuoBean();
        sgbean1.setSgName(<span class="hljs-string">"刘备"</span>);
        sgbean1.setSgPetName(<span class="hljs-string">"玄德"</span>);
        sgbean1.setSgHeadBp(R.drawable.lb);
        sgbean1.setSgDescribe(<span class="hljs-string">"刘备（161年－223年6月10日），字玄德，东汉末年幽州涿郡涿县（今河北省涿州市）人"</span>);
        SanGuoBean sgbean2 = <span class="hljs-keyword">new</span> SanGuoBean();
        sgbean2.setSgName(<span class="hljs-string">"关羽"</span>);
        sgbean2.setSgPetName(<span class="hljs-string">"云长"</span>);
        sgbean2.setSgHeadBp(R.drawable.gy);
        sgbean2.setSgDescribe(<span class="hljs-string">"关羽（？－220年），本字长生，后改字云长，河东郡解良（今山西运城）人"</span>);
        SanGuoBean sgbean3 = <span class="hljs-keyword">new</span> SanGuoBean();
        sgbean3.setSgName(<span class="hljs-string">"张飞"</span>);
        sgbean3.setSgPetName(<span class="hljs-string">"翼德"</span>);
        sgbean3.setSgHeadBp(R.drawable.zf);
        sgbean3.setSgDescribe(<span class="hljs-string">"张飞（？－221年），字益德[1]  ，幽州涿郡（今河北省保定市涿州市）人氏"</span>);
        SanGuoBean sgbean4 = <span class="hljs-keyword">new</span> SanGuoBean();
        sgbean4.setSgName(<span class="hljs-string">"赵云"</span>);
        sgbean4.setSgPetName(<span class="hljs-string">"子龙"</span>);
        sgbean4.setSgHeadBp(R.drawable.zy);
        sgbean4.setSgDescribe(<span class="hljs-string">"赵云（？－229年），字子龙，常山真定（今河北省正定）人"</span>);
        SanGuoBean sgbean5 = <span class="hljs-keyword">new</span> SanGuoBean();
        sgbean5.setSgName(<span class="hljs-string">"马超"</span>);
        sgbean5.setSgPetName(<span class="hljs-string">"孟起"</span>);
        sgbean5.setSgHeadBp(R.drawable.mc);
        sgbean5.setSgDescribe(<span class="hljs-string">"马超（176年－222年），字孟起，司隶部扶风郡茂陵（今陕西兴平）人"</span>);
        SanGuoBean sgbean6 = <span class="hljs-keyword">new</span> SanGuoBean();
        sgbean6.setSgName(<span class="hljs-string">"黄忠"</span>);
        sgbean6.setSgPetName(<span class="hljs-string">"汉升"</span>);
        sgbean6.setSgHeadBp(R.drawable.hz);
        sgbean6.setSgDescribe(<span class="hljs-string">"黄忠（？－220年），字汉升（一作“汉叔”[1]  ），南阳（今河南南阳）人"</span>);
        SanGuoBean sgbean7 = <span class="hljs-keyword">new</span> SanGuoBean();
        sgbean7.setSgName(<span class="hljs-string">"张辽"</span>);
        sgbean7.setSgPetName(<span class="hljs-string">"文远"</span>);
        sgbean7.setSgHeadBp(R.drawable.zl);
        sgbean7.setSgDescribe(<span class="hljs-string">"张辽（169年－222年），字文远，雁门马邑（今山西朔州）人"</span>);
        mSGDatas.add(sgbean1);
        mSGDatas.add(sgbean2);
        mSGDatas.add(sgbean3);
        mSGDatas.add(sgbean4);
        mSGDatas.add(sgbean5);
        mSGDatas.add(sgbean6);
        mSGDatas.add(sgbean7);

    }

    <span class="hljs-javadoc">/**
     * 初始化控件
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initViewI</span>() {
        mSGCommolySearchView = (CommolySearchView) findViewById(R.id.csv_show);
        mListView = (ListView) findViewById(R.id.lv_show);
        sgAdapter = <span class="hljs-keyword">new</span> SGAdapter(<span class="hljs-keyword">this</span>, mSGDatas);
        mListView.setAdapter(sgAdapter);
        <span class="hljs-comment">// 设置数据源</span>
        mSGCommolySearchView.setDatas(mSGDatas);
        <span class="hljs-comment">// 设置适配器</span>
        mSGCommolySearchView.setAdapter(sgAdapter);
        <span class="hljs-comment">// 设置筛选数据</span>
        mSGCommolySearchView.setSearchDataListener(<span class="hljs-keyword">new</span> CommolySearchView.SearchDatas&lt;SanGuoBean&gt;() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> List&lt;SanGuoBean&gt; <span class="hljs-title">filterDatas</span>(List&lt;SanGuoBean&gt; datas, List&lt;SanGuoBean&gt; filterdatas, String inputstr) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; datas.size(); i++) {
                    <span class="hljs-comment">// 筛选条件</span>
                    <span class="hljs-keyword">if</span> ((datas.get(i).getSgDescribe()).contains(inputstr) || datas.get(i).getSgName().contains(inputstr) || datas.get(i).getSgPetName().contains(inputstr)) {
                        filterdatas.add(datas.get(i));
                    }
                }
                <span class="hljs-keyword">return</span> filterdatas;
            }
        });
        mListView.setOnItemClickListener(<span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; adapterView, View view, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">long</span> l) {
                Toast.makeText(MainActivity.<span class="hljs-keyword">this</span>, mSGCommolySearchView.getFilterDatas().get(i).getSgName() + <span class="hljs-string">"字"</span> + mSGCommolySearchView.getFilterDatas().get(i).getSgPetName() + <span class="hljs-string">"\n"</span> + mSGCommolySearchView.getFilterDatas().get(i).getSgDescribe(), Toast.LENGTH_SHORT).show();
            }
        });

    }
}
</code></pre> 
<p>效果图如下:</p> 
<p><img src="https://images2.imgbox.com/6a/39/zMvzN6iD_o.gif" alt="最终效果图" title=""></p> 
<p><a href="http://download.csdn.net/detail/u013904672/9538599">下载地址</a></p> 
<h4 id="进一步优化与封装">进一步优化与封装</h4> 
<p>进一步的优化和封装请看我的另一篇博客<a href="http://blog.csdn.net/u013904672/article/details/68485262">Android通用搜索页的分析与封装</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b89c44a06ef4c4aa0c85afc19c660b8b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">问题解决：安装完ruby却提示[/usr/bin/ruby: No such file or directory]</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9b23825bd7b95b2826c28273041cf337/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">拨号上网和宽带区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>