<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>IP网段去重复去包含 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="IP网段去重复去包含" />
<meta property="og:description" content="需求：内部资产盘点（漏洞）扫描
问题：公司大了，内网网段“剪不断理还乱”…，拿到上千个网段信息，在扫描前需要去重复和去包含关系，防止重复扫描和提升扫描效率
解决：python脚本，有个处理网段的库灰常好用IPy库实现。（自己尝试通过网络掩码位数写了写逻辑去重，也是不那么得手。（安装 pip install IPy）
处理脚本：
#去ip段的重叠、包含等 from IPy import IP file = &#39;hostnetmask.txt.py&#39; #需要去重复的ip网段文件（按行） def ipuniq(): dlist = [] with open(file,&#39;r&#39;) as ff: for x in ff.readlines(): x = x.strip() with open(file, &#39;r&#39;) as f: for i in f.readlines(): i = i.strip() if i != x: if IP(i) in IP(x): # 判断网段是否包含 print(&#39;{} &gt;&gt;&gt;&gt;&gt; {}&#39;.format(i,x)) dlist.append(i) dlist.sort() data = [] print(&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;去重复后的网段&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#39;) with open(file,&#39;r&#39;) as df: for n in df." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/3d92c74d7ecf0e03f94e56c8dadcbe24/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-22T15:44:18+08:00" />
<meta property="article:modified_time" content="2023-12-22T15:44:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">IP网段去重复去包含</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>需求</strong>：内部资产盘点（漏洞）扫描<br> <strong>问题</strong>：公司大了，内网网段“剪不断理还乱”…，拿到上千个网段信息，在扫描前需要去重复和去包含关系，防止重复扫描和提升扫描效率<br> <strong>解决</strong>：python脚本，有个处理网段的库灰常好用IPy库实现。（自己尝试通过网络掩码位数写了写逻辑去重，也是不那么得手。（安装 pip install IPy）</p> 
<p>处理脚本：</p> 
<pre><code class="prism language-python"><span class="token comment">#去ip段的重叠、包含等</span>
<span class="token keyword">from</span> IPy <span class="token keyword">import</span> IP
<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token string">'hostnetmask.txt.py'</span>     <span class="token comment">#需要去重复的ip网段文件（按行）</span>
<span class="token keyword">def</span> <span class="token function">ipuniq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ff<span class="token punctuation">:</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> ff<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> x<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    i <span class="token operator">=</span> i<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> i <span class="token operator">!=</span> x<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> IP<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">in</span> IP<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># 判断网段是否包含</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{} &gt;&gt;&gt;&gt;&gt; {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
                            dlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        dlist<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;去重复后的网段&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;'</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> df<span class="token punctuation">:</span>
            <span class="token keyword">for</span> n <span class="token keyword">in</span> df<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                n <span class="token operator">=</span> n<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> n <span class="token keyword">not</span> <span class="token keyword">in</span> dlist<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
                    data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>     <span class="token comment">#打印去重叠后的网段</span>
</code></pre> 
<p>文件内容eg：<br> cat hostnetmask.txt.py<br> 10.19.33.0/24<br> 10.19.32.0/24</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f3c5819461d6c27ae2a7760ec703d848/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">凯斯西储大学轴承数据解读</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b75508f5986c1e5eab5bf4f2746040b3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java 多线程之自定义线程池（ThreadPool）使用方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>