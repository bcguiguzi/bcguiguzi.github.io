<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YModem协议总结 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="YModem协议总结" />
<meta property="og:description" content="《YModem协议总结》 目录 第1章 YModem协议简介 4 1.1 基本介绍 4
1.2 YModem基本介绍 4
第2章 YModem传输协议 5 2.1 起始帧的数据格式 5
2.2 数据帧的数据格式 5
2.3 结束帧数据结构 6
2.4 文件传输过程 6
2.5 CRC的计算 7
附录A 附录 8 A.1 附录 8
第1章 YModem协议简介 1.1基本介绍 最常用的几种通信传输协议有：XModem、YModem、ZModem等。
XModem是最早的协议之一，几乎所有的通讯程序支持的文件传输协议，它传输128字节信息块。 YModem协议是XModem的改进协议，它最用于调制解调器之间的文件传输的协议，具有快速，稳定传输的优点。它的传输速度比XModem快，这是由于它可以一次传输1024字节的信息块，同时它还支持传输多个文件，也就是常说的批文件传输。
ZModem速度快于XModem和YModem，而且可以更好地断开后恢复传输。
如今，XModem基本已经被淘汰，最常用的就是YModem与ZModem。
1.2YModem基本介绍 YModem分成YModem-1K与YModem-g。
YModem-1K用1024字节信息块传输取代标准的128字节传输，数据的发送回使用CRC校验，保证数据传输的正确性。它每传输一个信息块数据时，就会等待接收端回应ACK信号，接收到回应后，才会继续传输下一个信息块，保证数据已经全部接收。
YModem-g传输形式与YModem-1K差不多，但是它去掉了数据的CRC校验码，同时在发送完一个数据块信息后，它不会等待接收端的ACK信号，而直接传输下一个数据块。正是它没有涉及错误校验，才使得它的传输速度比YModem-1K来得快。一般都会选择YModem-1K传输，平时所说的YModem也是指的是YModem-1K。
第2章 YModem传输协议 2.1起始帧的数据格式 YModem的起始帧并不直接传输文件的数据，而是将文件名与文件的大小放在数据帧中传输，它的帧长=3字节数据首部&#43;128字节数据&#43;2字节CRC16校验码=33字节。它的数据结构如下：
SOH 00 FF filename[ ] filezise[ ] NUL[ ] CRCH CRCL
其中SOH=0x01，表示这个数据帧中包含着128字节的数据部分； 在SOH后面的00 FF，00表示数据帧序号，因为是起始帧，所以它的帧序为00，至于FF，它是帧序的取反； filename[ ]就是文件名，如文件名foo.c，它在数据帧中存放格式为：66 6F 6F 2E 63 00，一定要在文件名最后跟上一个00，表示文件名结束； filesize[ ]就是文件大小，如上面的foo." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/30a278fdfd020caf570f50f695f0f34e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-26T23:05:12+08:00" />
<meta property="article:modified_time" content="2023-10-26T23:05:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YModem协议总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="YModem_0"></a>《YModem协议总结》</h2> 
<hr> 
<h2><a id="_2"></a>目录</h2> 
<h4><a id="1_YModem%094_3"></a>第1章 YModem协议简介 4</h4> 
<p>1.1 基本介绍 4<br> 1.2 YModem基本介绍 4</p> 
<h4><a id="2_YModem%095_6"></a>第2章 YModem传输协议 5</h4> 
<p>2.1 起始帧的数据格式 5<br> 2.2 数据帧的数据格式 5<br> 2.3 结束帧数据结构 6<br> 2.4 文件传输过程 6<br> 2.5 CRC的计算 7</p> 
<h2><a id="A_%098_12"></a>附录A 附录 8</h2> 
<p>A.1 附录 8</p> 
<hr> 
<h2><a id="1_YModem_16"></a>第1章 YModem协议简介</h2> 
<h3><a id="11_17"></a>1.1基本介绍</h3> 
<p>最常用的几种通信传输协议有：XModem、YModem、ZModem等。<br> XModem是最早的协议之一，几乎所有的通讯程序支持的文件传输协议，它传输128字节信息块。 <br> YModem协议是XModem的改进协议，它最用于调制解调器之间的文件传输的协议，具有快速，稳定传输的优点。它的传输速度比XModem快，这是由于它可以一次传输1024字节的信息块，同时它还支持传输多个文件，也就是常说的批文件传输。<br> ZModem速度快于XModem和YModem，而且可以更好地断开后恢复传输。<br> 如今，XModem基本已经被淘汰，最常用的就是YModem与ZModem。</p> 
<h3><a id="12YModem_24"></a>1.2YModem基本介绍</h3> 
<p>YModem分成YModem-1K与YModem-g。<br> YModem-1K用1024字节信息块传输取代标准的128字节传输，数据的发送回使用CRC校验，保证数据传输的正确性。它每传输一个信息块数据时，就会等待接收端回应ACK信号，接收到回应后，才会继续传输下一个信息块，保证数据已经全部接收。<br> YModem-g传输形式与YModem-1K差不多，但是它去掉了数据的CRC校验码，同时在发送完一个数据块信息后，它不会等待接收端的ACK信号，而直接传输下一个数据块。正是它没有涉及错误校验，才使得它的传输速度比YModem-1K来得快。一般都会选择YModem-1K传输，平时所说的YModem也是指的是YModem-1K。</p> 
<hr> 
<h2><a id="2_YModem_30"></a>第2章 YModem传输协议</h2> 
<h3><a id="21_31"></a>2.1起始帧的数据格式</h3> 
<p>YModem的起始帧并不直接传输文件的数据，而是将文件名与文件的大小放在数据帧中传输，它的帧长=3字节数据首部+128字节数据+2字节CRC16校验码=33字节。它的数据结构如下：<br> <strong>SOH 00 FF filename[ ] filezise[ ] NUL[ ] CRCH CRCL</strong></p> 
<pre><code>其中SOH=0x01，表示这个数据帧中包含着128字节的数据部分；
在SOH后面的00 FF，00表示数据帧序号，因为是起始帧，所以它的帧序为00，至于FF，它是帧序的取反；
filename[ ]就是文件名，如文件名foo.c，它在数据帧中存放格式为：66 6F 6F 2E 63 00，一定要在文件名最后跟上一个00，表示文件名结束；
filesize[ ]就是文件大小，如上面的foo.c的大小为1KByte，即1024Byte，需要先将它转化成16进制，即0x400，所以它在数据帧的存放格式 为：34 30 30 00，即“400”，同样的文件大小最后需要跟上00，表示结束；
NUL[ ]表示剩下的字节都用00填充，数据部分大小为128字节，除去文件名与文件大小占用的空间外，剩余的字节全部用00填充；
CRCH CRCL分别表示16位CRC校验码的高8位与低8位。
</code></pre> 
<h3><a id="22_42"></a>2.2数据帧的数据格式</h3> 
<p>YModem的数据帧中会预留1024字节空间用来传输文件数据，它跟起始帧接收差不多，如下：<br> <strong>STX 01 FE data[1024] CRCH CRCL</strong></p> 
<pre><code>其中STX=0x02，表示这帧数据帧后面包含着1024字节的数据部分；
STX后面的01 FE，01表示第一帧数据帧，FE则是它的取反；
data[1024]表示存放着1024字节的文件数据；
CRCH与CRCL是CRC16检验码的高8位与低8位。
</code></pre> 
<p>如果文件数据的最后剩余的数据在128~1024之前，则还是使用STX的1024字节传输，但是剩余空间全部用0x1A填充，如下结构：<br> <strong>STX [num] [~num] data[ ] 1A …1A CRCH CRCL</strong><br> 有一种特殊的情况：如果文件大小小于等于128字节或者文件数据最后剩余的数据小于128字节，则YModem会选择SOH数据帧用128字节来传输数据，如果数据不满128字节，剩余的数据用0x1A填充这是数据正的结构就变成了：<br> 文件大小小于128字节：<br> <strong>SOH 01 FE data[ ] 1A …1A CRCH CRCL</strong><br> 文件最后剩余数据小于128字节：<br> <strong>SOH [num] [~~num] data[ ] 1A…1A CRCH CRCL</strong></p> 
<h3><a id="23_59"></a>2.3结束帧数据结构</h3> 
<p>YModem的结束帧数据也采用SOH的128字节数据帧，它的结构如下：<br> <strong>SOH 00 FF NUL[128] CRCH CRCL</strong></p> 
<pre><code>结束帧同样以SOH开头，表示后面跟着128字节大小的数据；
结束帧的帧序也认为是00 FF；
结束帧的128字节的数据部分不存放任何信息，即NUL[128]全部用00填充。
</code></pre> 
<h3><a id="24_68"></a>2.4文件传输过程</h3> 
<p>文件的传输过程，以具体的例子说明。把foo.c，大小为4196Byte（0x1064）的文件作为传输的对象，则它的传输过程如下：</p> 
<pre><code>发送端                                        接收端
 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    C
SOH 00 FF "foo.c" "1064'' NUL[118] CRC CRC &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    ACK
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;     C
STX 01 FE data[1024] CRC CRC&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    ACK
STX 02 FD data[1024] CRC CRC&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    ACK
STX 03 FC data[1024] CRC CRC&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    ACK
STX 04 FB data[1024] CRC CRC&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    ACK
SOH 05 FA data[100]  1A[28] CRC CRC&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    ACK
EOT &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    NAK
EOT&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    ACK
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    C
SOH 00 FF NUL[128] CRC CRC &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;    ACK
</code></pre> 
<p>YModem的传输过程就是上面所示。但是上面传输过程中存在许多通信信号，它们的数值与意义如下表所示：</p> 
<table><thead><tr><th>符号</th><th>数值</th><th>含义</th></tr></thead><tbody><tr><td>SOH</td><td>0x01</td><td>128字节数据包</td></tr><tr><td>STX</td><td>0x02</td><td>1024字节数据包</td></tr><tr><td>EOT</td><td>0x04</td><td>结束传输</td></tr><tr><td>ACK</td><td>0x06</td><td>回应</td></tr><tr><td>NAK</td><td>0x15</td><td>不回应</td></tr><tr><td>CA</td><td>0x18</td><td>传输中止</td></tr><tr><td>C</td><td>0x43</td><td>请求数据包</td></tr></tbody></table> 
<p>还是有几点需要说明下：<br> 1）EOT信号由发送端发送<br> 2）CA中止传输信号也有发送端发送<br> 3）C的含义：开始传输时发送C请求起始帧数据，然后再发送C请求文件数据帧，最后有发送一次C请求结束帧！</p> 
<h3><a id="25CRC_110"></a>2.5CRC的计算</h3> 
<p>YModem的采用的是CRC16-CCITT欧洲版本的CRC校验，它的生成多项式为：x16+x12+x5+1。</p> 
<hr> 
<h2><a id="A__114"></a>附录A 附录</h2> 
<h3><a id="A1_115"></a>A.1附录</h3>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6b93a0ec645985610de49507a1977d02/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ROS学习记录2018.7.10</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b1ca6aa378429ae30990301014d15962/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">FreeRTOS学习2018.6.27</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>