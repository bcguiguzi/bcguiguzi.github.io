<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>UUID介绍 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="UUID介绍" />
<meta property="og:description" content="UUID Universally Unique Identifier：通用唯一识别码
使用某种规则，不是某种中心化的自增方式，来保证这个识别码的全局唯一性
生成规则： RFC4122来进行定义。
根据生日悖论，若每秒产生 10 亿笔 UUID，100 年后只产生一次重复的概率是 50%。如果地球上每个人都各有 6 亿笔 UUID，发生一次重复的概率是 50%。产生重复UUID 并造成错误的情况非常低，是故大可不必考虑此问题。
最早被用于阿波罗网络计算系统(Apollo Network Computing System) 和微软的 Windows 平台，如今 OpenStack 也广泛的使用它来标志计算、存储和网络等资源
GUID ：
微软按照 UUID 的规则实现的一套方法。目的：保证全局唯一性。微软已经使用 GUID 在 Windows 的 COM，ActiveX 等技术上了。注意： UUID 本质是有多种版本的，GUID 也是在不同的使用场景实现的是不同的 UUID 版本，比如 COM 是使用 UUID 版本1 进行实现的 1、构成： 长度：128bit 16字节，换算成16进制数（32个16进制）加上中间杠隔开
格式：xxxx xxxx-xxxx-Mxxx-Nxxx-xxxx xxxx xxxx(8-4-4-4-12)
M：UUID版本，1，2，3，4，5
N：8、5、a、b
可变因子
时间戳时钟序列节点信息(机器)—MAC地址 1.1、时间戳 Timestamp
60bit 无符号数
version为1：1582-10-15 00:00:000000000 到当前UTC时间，每隔100纳秒加1对于无法获取UTC时间的系统，统一采用localtime。（实际上一个系统时区相同就可以了）。time_low：0-31bit，32bittime_mid: 32-47bit,16bittime_hi_and_version: 包含两部分，version和time_h1 version 占用 bit 数为4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/438de50f9b032a88fd3f9a9540e5a3c5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-03T10:43:40+08:00" />
<meta property="article:modified_time" content="2022-11-03T10:43:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">UUID介绍</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="UUID_0"></a>UUID</h2> 
<blockquote> 
 <p>Universally Unique Identifier：通用唯一识别码</p> 
 <p>使用某种规则，<mark>不是某种中心化的自增方式</mark>，来保证这个识别码的全局唯一性</p> 
 <p>生成规则： RFC4122来进行定义。</p> 
 <p><em>根据生日悖论，若每秒产生 10 亿笔 UUID，100 年后只产生一次重复的概率是 50%。如果地球上每个人都各有 6 亿笔 UUID，发生一次重复的概率是 50%。产生重复UUID 并造成错误的情况非常低，是故大可不必考虑此问题。</em></p> 
 <p>最早被用于阿波罗网络计算系统(Apollo Network Computing System) 和微软的 Windows 平台，如今 OpenStack 也广泛的使用它来标志计算、存储和网络等资源</p> 
 <p>GUID ：</p> 
 <ul><li>微软按照 UUID 的规则实现的一套方法。</li><li>目的：保证全局唯一性。</li><li>微软已经使用 GUID 在 Windows 的 COM，ActiveX 等技术上了。</li><li>注意： 
   <ul><li>UUID 本质是有多种版本的，</li><li>GUID 也是在不同的使用场景实现的是不同的 UUID 版本，</li><li>比如 COM 是使用 UUID 版本1 进行实现的</li></ul> </li></ul> 
</blockquote> 
<h3><a id="1_22"></a>1、构成：</h3> 
<blockquote> 
 <p>长度：128bit 16字节，换算成16进制数（32个16进制）加上中间杠隔开</p> 
 <p>格式：xxxx xxxx-xxxx-Mxxx-Nxxx-xxxx xxxx xxxx(8-4-4-4-12)</p> 
 <p>M：UUID版本，1，2，3，4，5</p> 
 <p>N：8、5、a、b</p> 
 <p>可变因子</p> 
 <ul><li>时间戳</li><li>时钟序列</li><li>节点信息(机器)—<mark>MAC地址</mark></li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/88/07/HChRV72O_o.png" alt="image-20221103094726459"></p> 
<h4><a id="11_40"></a>1.1、时间戳</h4> 
<blockquote> 
 <p>Timestamp</p> 
 <p>60bit 无符号数</p> 
</blockquote> 
<ul><li>version为1：1582-10-15 00:00:000000000 到当前UTC时间，每隔100纳秒加1</li><li>对于无法获取UTC时间的系统，统一采用<code>localtime</code>。（实际上一个系统时区相同就可以了）。</li><li>time_low：0-31bit，32bit</li><li>time_mid: 32-47bit,16bit</li><li>time_hi_and_version: 包含两部分，version和time_h1 
  <ul><li>version 占用 bit 数为4. 代表它最多可以支持31个版本（2^4 -1）</li><li>time_hi：剩余的12bit，一共是16bit</li></ul> </li></ul> 
<h4><a id="12clock_sequence_54"></a>1.2、时钟序列(clock sequence)</h4> 
<ul><li>如果计算 UUID 的机器进行了时间调整，或者是<code>nodeId</code>变化了（主机更换网卡），和其他的机器冲突了。那么这个时候，就需要有个变量因子进行变化来保证再次生成的 UUID 的唯一性。</li><li><code>Clock Sequence</code>的变化算法很简单，当时间调整，或者<code>nodeId</code>变化的时候，直接使用一个随机数/在原先的<code>Clock Sequence</code>值上面自增加一也是可以的。</li><li>共14bit</li><li>clock_seq_low：0-7bit 共8bit</li><li><code>clock_seq_hi_and_reserved</code>包含两个部分： 
  <ul><li><code>clock_seq_hi</code>： 8～13 bit 共6个bit，</li><li><code>reserved</code>：2bit，<code>reserved</code> 一般设置为10。</li></ul> </li><li>发生时间回调或者更换网卡时： 
  <ul><li>如果之前的 clock sequence 存在，则增大 clock sequence 的值</li><li>如果之前不存在 clock sequence，则随机生成一个 clock sequence</li></ul> </li></ul> 
<h4><a id="13node___67"></a>1.3、<code>node</code> - 节点信息(机器)</h4> 
<ul><li>Node 是一个 48 bits 的无符号数，</li><li>对于 version 为 1 的 UUID，它选取 IEEE 802 MAC 地址，即网卡的 MAC 地址。</li><li>当系统有多块网卡时，任何一块有效的网卡都可被做 Node 数据；</li><li>对于没有网卡的系统，取值为随机数。</li><li>不同的主机在任何时刻生成的 UUID 均不相同。</li></ul> 
<h3><a id="2_75"></a>2、版本：</h3> 
<blockquote> 
 <p>统共有5个版本</p> 
 <p>结构均相同。</p> 
 <p>这个结构是按照版本1进行定义的，只是在其他版本中，版本1中的几个变量因子都进行了变化。</p> 
</blockquote> 
<h4><a id="version1_83"></a>version1:</h4> 
<ul><li>严格按照时间戳+时钟序列+节点信息组成变量因子</li><li>一些分布式系统场景下是能严格保证全局唯一</li><li>twitter 的 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Ftwitter%2Fsnowflake" rel="nofollow">snowflake</a> 可以看作是是 UUID 版本1 的简化版。</li><li>算法： 
  <ol><li>从数据表读取(读取需加锁)曾经被用于生成 UUID 的 timestamp, clock sequence 和 node 等信息</li><li>获取当前的 timestamp</li><li>获取当前的 node 信息</li><li>如果第 1 步读取信息失败，或者读取的 node 与当前的 node 不一致，生成一个随机的 clock sequence</li><li>如果 timestamp 比当前的 timestamp 小，clock sequence 调大</li><li>把当前 timestamp，node 和 clock sequence 存入数据表</li><li>根据当前的 timestamp，node 和 clock sequence 生成 UUID，细节如下： 
    <ul><li>time_low 为 timestamp[28:59]</li><li>time_mid 为 timestamp[12:27]</li><li>time_hi_and_version[4:15] 为 timestamp[0]…timestamp[11]</li><li>time_hi_and_version[0:3] 为 0001</li><li>clock_seq_low 为 clock_sequence[6:13]</li><li>clock_seq_hi_and_reserved[2:7] 为 clock_sequence[0:5]</li><li>clock_seq_hi_and_reserved[0:1] 为 10</li><li>node 为 MAC[0:47]</li></ul> </li></ol> </li></ul> 
<h4><a id="version2_105"></a>version2:</h4> 
<ul><li>基本和版本1一致，</li><li>主要多DCE(IBM 的一套分布式计算环境)</li><li>参考：https://pubs.opengroup.org/onlinepubs/9668899/chap1.htm</li><li>把时间戳的前4位置换为POSIX的UID或GID。</li><li>很少使用</li></ul> 
<h4><a id="version3_113"></a>version3:</h4> 
<ul><li> <p>变量因子：基于name和namespace 的hash</p> </li><li> <p>hash算法：md5</p> </li><li> <p>其中的name 和namespace 基本上和我们很多语言的命名空间，类名一样，它的基本要求就是，name + namespace 才是唯一确定hash串的标准</p> </li><li> <p>一样的namespace + name 使用相同的hash算法（比如version3的md5）计算出来的结果必须是一样的，但是不同的 namespace 中的同样的 name 生成的结果是不一样的。</p> <pre><code class="prism language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">nameUUIDFromBytes</span><span class="token punctuation">(</span><span class="token string">"myString"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//version为3</span>
</code></pre> </li></ul> 
<h4><a id="version4_127"></a>version4：</h4> 
<ul><li> <p>变量因子：随机/伪随机</p> </li><li> <p>jdk1.8默认使用</p> </li><li> <p>timestamp，clock sequence, node都是随机或者伪随机的</p> <pre><code class="prism language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li></ul> 
<h4><a id="version5_139"></a>version5:</h4> 
<ul><li>变量因子：基于name和namespace 的hash</li><li>hash算法：sha1</li><li>同三</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f6221126ff1837f5c413d965412e1e9e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Doxygen&#43;Graphviz&#43;Ubuntu20.04安装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9fccf6d762463e0e25765173faf0edcb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Pangolin&#43;Ubuntu20.04安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>