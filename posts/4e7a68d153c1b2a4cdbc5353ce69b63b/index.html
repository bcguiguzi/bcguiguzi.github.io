<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Excel·VBA定量装箱、凑数值金额、组合求和问题 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Excel·VBA定量装箱、凑数值金额、组合求和问题" />
<meta property="og:description" content="如图：对图中A-C列数据，根据C列数量按照一定的取值范围，组成一个分组装箱，要求如下：
1，每箱数量最好凑足50，否则为47-56之间；
2，图中每行数据不得拆分；
3，按顺序对分组装箱结果进行编号，如D列中BS0001；
4，生成分组装箱结果（包含B-C列数据），以及单独生成最终无法装箱的数据
目录 实现方法1实现方法2实现方法33种实现方法生成结果、对比、耗时 装箱结果整理编号无序编号有序 本问题本质上是组合求和问题，调用了combin_arr1函数，代码详见《Excel·VBA数组组合函数、组合求和》（如需使用代码需复制）
实现方法1 代码思路：持续不断组合
1，对数据读取为字典，行号为键数量为值；
2，对行号数组从2-N依次进行组合，判断是否符合取值范围；
3，对符合取值范围的行号组合，在res数组对应行号中写入装箱编号，并在字典中删除该行号
4，删除行号后，跳出后续循环遍历，并重复步骤2-3，直至无法删除行号，即没有符合范围的行号组合
5，在D列写入对应的装箱编号
注意：由于步骤4需要跳出循环，所以无法使用for…each遍历组合数组，否则报错该数组被固定或暂时锁定
Sub 装箱问题1() Dim arr, dict As Object, i&amp;, j&amp;, temp_sum, res, w&amp;, dc&amp;, brr, r&amp;, c&amp; target = 50: trr = Array(47, 56) &#39;目标值，范围 Set dict = CreateObject(&#34;scripting.dictionary&#34;): tm = Timer With Worksheets(&#34;数据&#34;) &#39;读取数据 arr = .[a1].CurrentRegion: ReDim res(1 To UBound(arr)): res(1) = &#34;箱号&#34; For i = 2 To UBound(arr) If arr(i, 3) = target Then w = w &#43; 1: res(i) = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/4e7a68d153c1b2a4cdbc5353ce69b63b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-01T16:59:02+08:00" />
<meta property="article:modified_time" content="2023-08-01T16:59:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Excel·VBA定量装箱、凑数值金额、组合求和问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/a9/5c/nZ3wneP4_o.jpg" alt="在这里插入图片描述"><br> 如图：对图中A-C列数据，根据C列数量按照一定的取值范围，组成一个分组装箱，要求如下：<br> 1，每箱数量最好凑足50，否则为47-56之间；<br> 2，图中每行数据不得拆分；<br> 3，按顺序对分组装箱结果进行编号，如D列中BS0001；<br> 4，生成分组装箱结果（包含B-C列数据），以及单独生成最终无法装箱的数据</p> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#1_11" rel="nofollow">实现方法1</a></li><li><a href="#2_63" rel="nofollow">实现方法2</a></li><li><a href="#3_106" rel="nofollow">实现方法3</a></li><li><ul><li><a href="#3_156" rel="nofollow">3种实现方法生成结果、对比、耗时</a></li></ul> 
   </li><li><a href="#_166" rel="nofollow">装箱结果整理</a></li><li><ul><li><a href="#_167" rel="nofollow">编号无序</a></li><li><a href="#_215" rel="nofollow">编号有序</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>本问题本质上是<strong>组合求和问题</strong>，调用了<strong>combin_arr1函数</strong>，代码详见<a href="https://blog.csdn.net/hhhhh_51/article/details/124577302">《Excel·VBA数组组合函数、组合求和》</a>（如需使用代码需复制）</p> 
<h3><a id="1_11"></a>实现方法1</h3> 
<p><strong>代码思路：持续不断组合</strong><br> 1，对数据读取为字典，行号为键数量为值；<br> 2，对行号数组从2-N依次进行组合，判断是否符合取值范围；<br> 3，对符合取值范围的行号组合，在res数组对应行号中写入装箱编号，并在字典中删除该行号<br> 4，删除行号后，跳出后续循环遍历，并重复步骤2-3，直至无法删除行号，即没有符合范围的行号组合<br> 5，在D列写入对应的装箱编号<br> <strong>注意</strong>：由于步骤4需要跳出循环，所以无法使用for…each遍历组合数组，否则报错<font color="red" size="4">该数组被固定或暂时锁定</font></p> 
<pre><code class="prism language-vbnet"><span class="token keyword">Sub</span> 装箱问题<span class="token number">1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> arr<span class="token punctuation">,</span> dict <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> i<span class="token operator">&amp;</span><span class="token punctuation">,</span> j<span class="token operator">&amp;</span><span class="token punctuation">,</span> temp_sum<span class="token punctuation">,</span> res<span class="token punctuation">,</span> w<span class="token operator">&amp;</span><span class="token punctuation">,</span> dc<span class="token operator">&amp;</span><span class="token punctuation">,</span> brr<span class="token punctuation">,</span> r<span class="token operator">&amp;</span><span class="token punctuation">,</span> c<span class="token operator">&amp;</span>
    target <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">:</span> trr <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">)</span>  <span class="token comment">'目标值，范围</span>
    <span class="token keyword">Set</span> dict <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">"scripting.dictionary"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> tm <span class="token operator">=</span> <span class="token keyword">Timer</span>
    <span class="token keyword">With</span> Worksheets<span class="token punctuation">(</span><span class="token string">"数据"</span><span class="token punctuation">)</span>  <span class="token comment">'读取数据</span>
        arr <span class="token operator">=</span> .[a1].CurrentRegion<span class="token punctuation">:</span> <span class="token keyword">ReDim</span> res<span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"箱号"</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
            <span class="token keyword">If</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> target <span class="token keyword">Then</span>
                w <span class="token operator">=</span> w <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"BS"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"000"</span><span class="token punctuation">)</span>
            <span class="token keyword">Else</span>
                dict<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Next</span>
        dc <span class="token operator">=</span> dict.Count
        <span class="token keyword">Do</span>    <span class="token comment">'2层do方便有符合目标值时跳出，并继续组合</span>
            <span class="token keyword">Do</span>
                <span class="token keyword">For</span> j <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> dc
                    brr <span class="token operator">=</span> combin_arr1<span class="token punctuation">(</span>dict.keys<span class="token punctuation">,</span> j<span class="token punctuation">)</span>
                    <span class="token keyword">For</span> r <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>brr<span class="token punctuation">)</span>
                        temp_sum <span class="token operator">=</span> <span class="token number">0</span>
                        <span class="token keyword">For</span> c <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>brr<span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span>
                            temp_sum <span class="token operator">=</span> temp_sum <span class="token operator">+</span> dict<span class="token punctuation">(</span>brr<span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">Next</span>
                        <span class="token keyword">If</span> temp_sum <span class="token operator">&gt;=</span> trr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">And</span> temp_sum <span class="token operator">&lt;=</span> trr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                            w <span class="token operator">=</span> w <span class="token operator">+</span> <span class="token number">1</span>
                            <span class="token keyword">For</span> c <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>brr<span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                res<span class="token punctuation">(</span>brr<span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"BS"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"000"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> dict.Remove brr<span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>  <span class="token comment">'写入箱号，删除行号</span>
                            <span class="token keyword">Next</span>
                            <span class="token keyword">Exit</span> <span class="token keyword">Do</span>
                        <span class="token keyword">End</span> <span class="token keyword">If</span>
                    <span class="token keyword">Next</span>
                <span class="token keyword">Next</span>
                <span class="token keyword">If</span> dc <span class="token operator">=</span> dict.Count <span class="token keyword">Then</span> <span class="token keyword">Exit</span> <span class="token keyword">Do</span>  <span class="token comment">'无组合符合目标值，跳出</span>
            <span class="token keyword">Loop</span> <span class="token keyword">Until</span> dc <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">If</span> dc <span class="token operator">=</span> dict.Count <span class="token keyword">Then</span> <span class="token keyword">Exit</span> <span class="token keyword">Do</span>
            dc <span class="token operator">=</span> dict.Count
        <span class="token keyword">Loop</span> <span class="token keyword">Until</span> dc <span class="token operator">=</span> <span class="token number">0</span>
        .[d1].Resize<span class="token punctuation">(</span><span class="token function">UBound</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> WorksheetFunction.Transpose<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token function">Debug</span>.<span class="token function">Print</span> <span class="token string">"组合完成，累计用时"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token keyword">Timer</span> <span class="token operator">-</span> tm<span class="token punctuation">,</span> <span class="token string">"0.00"</span><span class="token punctuation">)</span>  <span class="token comment">'耗时</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> 
<h3><a id="2_63"></a>实现方法2</h3> 
<p><strong>代码思路：遍历组合，跳过重复行号</strong><br> 与实现方法2类似，<font color="red" size="4">但步骤4不同</font>，在字典删除行号后，继续遍历组合，并判断每个组合中是否存在被删除的行号，如果存在则跳过本组合，直至无法删除行号，或剩余行号无法支持下一轮递增元素个数进行组合</p> 
<pre><code class="prism language-vbnet"><span class="token keyword">Sub</span> 装箱问题<span class="token number">2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> arr<span class="token punctuation">,</span> dict <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> i<span class="token operator">&amp;</span><span class="token punctuation">,</span> j<span class="token operator">&amp;</span><span class="token punctuation">,</span> temp_sum<span class="token punctuation">,</span> res<span class="token punctuation">,</span> w<span class="token operator">&amp;</span><span class="token punctuation">,</span> dc<span class="token operator">&amp;</span><span class="token punctuation">,</span> brr<span class="token punctuation">,</span> r<span class="token operator">&amp;</span><span class="token punctuation">,</span> c<span class="token operator">&amp;</span>
    target <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">:</span> trr <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">)</span>  <span class="token comment">'目标值，范围</span>
    <span class="token keyword">Set</span> dict <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">"scripting.dictionary"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> tm <span class="token operator">=</span> <span class="token keyword">Timer</span>
    <span class="token keyword">With</span> Worksheets<span class="token punctuation">(</span><span class="token string">"数据"</span><span class="token punctuation">)</span>  <span class="token comment">'读取数据</span>
        arr <span class="token operator">=</span> .[a1].CurrentRegion<span class="token punctuation">:</span> <span class="token keyword">ReDim</span> res<span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"箱号"</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
            <span class="token keyword">If</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> target <span class="token keyword">Then</span>
                w <span class="token operator">=</span> w <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"BS"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"000"</span><span class="token punctuation">)</span>
            <span class="token keyword">Else</span>
                dict<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Next</span>
        <span class="token keyword">For</span> j <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> dict.Count
            <span class="token keyword">If</span> j <span class="token operator">&gt;</span> dict.Count <span class="token keyword">Then</span> <span class="token keyword">Exit</span> <span class="token keyword">For</span>  <span class="token comment">'所剩元素不足，结束</span>
            brr <span class="token operator">=</span> combin_arr1<span class="token punctuation">(</span>dict.keys<span class="token punctuation">,</span> j<span class="token punctuation">)</span>
            <span class="token keyword">For Each</span> b <span class="token keyword">In</span> brr
                temp_sum <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">For Each</span> bb <span class="token keyword">In</span> b
                    <span class="token keyword">If</span> <span class="token keyword">Not</span> dict.Exists<span class="token punctuation">(</span>bb<span class="token punctuation">)</span> <span class="token keyword">Then</span>
                        temp_sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">Exit</span> <span class="token keyword">For</span>  <span class="token comment">'重复跳过</span>
                    <span class="token keyword">Else</span>
                        temp_sum <span class="token operator">=</span> temp_sum <span class="token operator">+</span> dict<span class="token punctuation">(</span>bb<span class="token punctuation">)</span>
                    <span class="token keyword">End</span> <span class="token keyword">If</span>
                <span class="token keyword">Next</span>
                <span class="token keyword">If</span> temp_sum <span class="token operator">&gt;=</span> trr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">And</span> temp_sum <span class="token operator">&lt;=</span> trr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                    w <span class="token operator">=</span> w <span class="token operator">+</span> <span class="token number">1</span>
                    <span class="token keyword">For Each</span> bb <span class="token keyword">In</span> b
                        res<span class="token punctuation">(</span>bb<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"BS"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"000"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> dict.Remove bb  <span class="token comment">'写入箱号，删除行号</span>
                    <span class="token keyword">Next</span>
                <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">Next</span>
        <span class="token keyword">Next</span>
        .[d1].Resize<span class="token punctuation">(</span><span class="token function">UBound</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> WorksheetFunction.Transpose<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token function">Debug</span>.<span class="token function">Print</span> <span class="token string">"组合完成，累计用时"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token keyword">Timer</span> <span class="token operator">-</span> tm<span class="token punctuation">,</span> <span class="token string">"0.00"</span><span class="token punctuation">)</span>  <span class="token comment">'耗时</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> 
<h3><a id="3_106"></a>实现方法3</h3> 
<p>实现方法1和实现方法2，都没有满足要求中“<strong>每箱数量最好凑足50</strong>”，仅对每行数量优先判断是否等于50，对于后续组合中都是符合范围即可<br> 因此，对实现方法2添加1个for循环，第1遍组合满足target，第2遍组合满足目标值trr范围</p> 
<pre><code class="prism language-vbnet"><span class="token keyword">Sub</span> 装箱问题<span class="token number">3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> arr<span class="token punctuation">,</span> dict <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> i<span class="token operator">&amp;</span><span class="token punctuation">,</span> j<span class="token operator">&amp;</span><span class="token punctuation">,</span> temp_sum<span class="token punctuation">,</span> res<span class="token punctuation">,</span> w<span class="token operator">&amp;</span><span class="token punctuation">,</span> dc<span class="token operator">&amp;</span><span class="token punctuation">,</span> brr<span class="token punctuation">,</span> r<span class="token operator">&amp;</span><span class="token punctuation">,</span> c<span class="token operator">&amp;</span>
    target <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">:</span> trr <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">)</span>  <span class="token comment">'目标值，范围</span>
    <span class="token keyword">Set</span> dict <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">"scripting.dictionary"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> tm <span class="token operator">=</span> <span class="token keyword">Timer</span>
    <span class="token keyword">With</span> Worksheets<span class="token punctuation">(</span><span class="token string">"数据"</span><span class="token punctuation">)</span>  <span class="token comment">'读取数据</span>
        arr <span class="token operator">=</span> .[a1].CurrentRegion<span class="token punctuation">:</span> <span class="token keyword">ReDim</span> res<span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"箱号"</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
            <span class="token keyword">If</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> target <span class="token keyword">Then</span>
                w <span class="token operator">=</span> w <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"BS"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"000"</span><span class="token punctuation">)</span>
            <span class="token keyword">Else</span>
                dict<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Next</span>
        <span class="token keyword">For</span> n <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token number">2</span>  <span class="token comment">'第1遍组合满足target，第2遍组合满足目标值trr范围</span>
            <span class="token keyword">For</span> j <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> dict.Count
                <span class="token keyword">If</span> j <span class="token operator">&gt;</span> dict.Count <span class="token keyword">Then</span> <span class="token keyword">Exit</span> <span class="token keyword">For</span>  <span class="token comment">'所剩元素不足，结束</span>
                brr <span class="token operator">=</span> combin_arr1<span class="token punctuation">(</span>dict.keys<span class="token punctuation">,</span> j<span class="token punctuation">)</span>
                <span class="token keyword">For Each</span> b <span class="token keyword">In</span> brr
                    temp_sum <span class="token operator">=</span> <span class="token number">0</span>
                    <span class="token keyword">For Each</span> bb <span class="token keyword">In</span> b
                        <span class="token keyword">If</span> <span class="token keyword">Not</span> dict.Exists<span class="token punctuation">(</span>bb<span class="token punctuation">)</span> <span class="token keyword">Then</span>
                            temp_sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">Exit</span> <span class="token keyword">For</span>  <span class="token comment">'重复跳过</span>
                        <span class="token keyword">Else</span>
                            temp_sum <span class="token operator">=</span> temp_sum <span class="token operator">+</span> dict<span class="token punctuation">(</span>bb<span class="token punctuation">)</span>
                        <span class="token keyword">End</span> <span class="token keyword">If</span>
                    <span class="token keyword">Next</span>
                    <span class="token keyword">If</span> n <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">And</span> temp_sum <span class="token operator">=</span> target <span class="token keyword">Then</span>
                        w <span class="token operator">=</span> w <span class="token operator">+</span> <span class="token number">1</span>
                        <span class="token keyword">For Each</span> bb <span class="token keyword">In</span> b
                            res<span class="token punctuation">(</span>bb<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"BS"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"000"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> dict.Remove bb  <span class="token comment">'写入箱号，删除行号</span>
                        <span class="token keyword">Next</span>
                    <span class="token keyword">ElseIf</span> n <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">And</span> temp_sum <span class="token operator">&gt;=</span> trr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">And</span> temp_sum <span class="token operator">&lt;=</span> trr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                        w <span class="token operator">=</span> w <span class="token operator">+</span> <span class="token number">1</span>
                        <span class="token keyword">For Each</span> bb <span class="token keyword">In</span> b
                            res<span class="token punctuation">(</span>bb<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"BS"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"000"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> dict.Remove bb  <span class="token comment">'写入箱号，删除行号</span>
                        <span class="token keyword">Next</span>
                    <span class="token keyword">End</span> <span class="token keyword">If</span>
                <span class="token keyword">Next</span>
            <span class="token keyword">Next</span>
        <span class="token keyword">Next</span>
        .[d1].Resize<span class="token punctuation">(</span><span class="token function">UBound</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> WorksheetFunction.Transpose<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token function">Debug</span>.<span class="token function">Print</span> <span class="token string">"组合完成，累计用时"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token keyword">Timer</span> <span class="token operator">-</span> tm<span class="token punctuation">,</span> <span class="token string">"0.00"</span><span class="token punctuation">)</span>  <span class="token comment">'耗时</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> 
<h4><a id="3_156"></a>3种实现方法生成结果、对比、耗时</h4> 
<p>图中C列中的数量为1-50范围内的随机数，D列即为结果<br> 分别对3种方法生成结果进行统计、对比：<br> 方法1、2生成结果完全相同，数量分布不集中；方法3最终装箱的箱数也更少，且数量集中在50，但剩余行数多<br> 400行数据测试，方法1、2剩余4行，方法3剩余15行<br> <img src="https://images2.imgbox.com/53/ee/tBQdbey5_o.jpg" alt="在这里插入图片描述"><br> 3种方法代码运行速度，分别测试300行、400行数据的耗时秒数<br> 方法3对比方法2需要多生成、遍历一遍组合，由于组合数成指数递增，因此其400行相比300行耗时大幅增加，且电脑内存最高占用6G。如果要使用方法3且数据量较大，最好还是分段运行代码，避免耗时过久<br> <img src="https://images2.imgbox.com/36/a0/wac2SnYn_o.jpg" alt="在这里插入图片描述"></p> 
<h3><a id="_166"></a>装箱结果整理</h3> 
<h4><a id="_167"></a>编号无序</h4> 
<p>字典以箱号为键，值为数组</p> 
<pre><code class="prism language-vbnet"><span class="token keyword">Sub</span> 装箱结果输出<span class="token number">1</span>无序<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> arr<span class="token punctuation">,</span> dict <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> i<span class="token operator">&amp;</span><span class="token punctuation">,</span> j<span class="token operator">&amp;</span><span class="token punctuation">,</span> r<span class="token operator">&amp;</span><span class="token punctuation">,</span> c<span class="token operator">&amp;</span><span class="token punctuation">,</span> max_c<span class="token operator">&amp;</span><span class="token punctuation">,</span> rng <span class="token keyword">As</span> Range<span class="token punctuation">,</span> xh<span class="token punctuation">,</span> dw<span class="token punctuation">,</span> sl
    <span class="token keyword">Set</span> dict <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">"scripting.dictionary"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> tm <span class="token operator">=</span> <span class="token keyword">Timer</span>
    <span class="token keyword">With</span> Worksheets<span class="token punctuation">(</span><span class="token string">"数据"</span><span class="token punctuation">)</span>  <span class="token comment">'读取数据</span>
        arr <span class="token operator">=</span> .[a1].CurrentRegion<span class="token punctuation">:</span> <span class="token keyword">ReDim</span> res<span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token number">10</span><span class="token punctuation">)</span>
        res<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"箱号"</span><span class="token punctuation">:</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">Set</span> rng <span class="token operator">=</span> .Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>.Resize<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">'表头</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
            <span class="token keyword">If</span> <span class="token function">Len</span><span class="token punctuation">(</span>arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                xh <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span> dw <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> sl <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
                <span class="token keyword">If</span> <span class="token keyword">Not</span> dict.Exists<span class="token punctuation">(</span>xh<span class="token punctuation">)</span> <span class="token keyword">Then</span>
                    r <span class="token operator">=</span> r <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">:</span> dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> sl<span class="token punctuation">)</span>  <span class="token comment">'箱号对应的行列号，数量合计</span>
                    res<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> xh    <span class="token comment">'箱号、单位号、数量赋值</span>
                    res<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> dw
                    res<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> sl
                <span class="token keyword">Else</span>
                    c <span class="token operator">=</span> dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> hj <span class="token operator">=</span> dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> sl  <span class="token comment">'数量合计</span>
                    dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> hj<span class="token punctuation">)</span>
                    res<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> dw  <span class="token comment">'单位号、数量赋值</span>
                    res<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> sl
                    max_c <span class="token operator">=</span> WorksheetFunction.<span class="token function">Max</span><span class="token punctuation">(</span>max_c<span class="token punctuation">,</span> c<span class="token punctuation">)</span>  <span class="token comment">'最大列数</span>
                <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">Else</span>
                <span class="token keyword">Set</span> rng <span class="token operator">=</span> Union<span class="token punctuation">(</span>rng<span class="token punctuation">,</span> .Cells<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>.Resize<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Next</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token keyword">With</span> Worksheets<span class="token punctuation">(</span><span class="token string">"结果"</span><span class="token punctuation">)</span>  <span class="token comment">'写入结果</span>
        r <span class="token operator">=</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> max_c <span class="token operator">=</span> max_c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_c<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"总件数"</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> r
            <span class="token keyword">If</span> <span class="token function">Len</span><span class="token punctuation">(</span>res<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">Then</span>
                res<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"数量"</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span>i<span class="token punctuation">,</span> max_c<span class="token punctuation">)</span> <span class="token operator">=</span> dict<span class="token punctuation">(</span>res<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Next</span>
        <span class="token keyword">For</span> j <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> max_c <span class="token operator">-</span> <span class="token number">1</span>
            res<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"单位号"</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">Next</span>
        .[a1].Resize<span class="token punctuation">(</span>r<span class="token punctuation">,</span> max_c<span class="token punctuation">)</span> <span class="token operator">=</span> res
        <span class="token keyword">If</span> <span class="token keyword">Not</span> rng <span class="token keyword">Is</span> <span class="token keyword">Nothing</span> <span class="token keyword">Then</span> rng.Copy .Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_c <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">'无法装箱</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token function">Debug</span>.<span class="token function">Print</span> <span class="token string">"累计用时"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token keyword">Timer</span> <span class="token operator">-</span> tm<span class="token punctuation">,</span> <span class="token string">"0.00"</span><span class="token punctuation">)</span>  <span class="token comment">'耗时</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> 
<p>生成结果：对方法2生成数据（即本文图1）进行整理<br> <img src="https://images2.imgbox.com/99/63/LJf2yXPO_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="_215"></a>编号有序</h4> 
<p>字典嵌套字典，代码速度较无序版稍慢<br> 为保证编号有序，以下代码使用了<strong>一维数组排序</strong>，调用了bubble_sort函数，代码详见<a href="https://blog.csdn.net/hhhhh_51/article/details/124333750">《Excel·VBA数组冒泡排序函数》</a>（如需使用代码需复制）</p> 
<pre><code class="prism language-vbnet"><span class="token keyword">Sub</span> 装箱结果输出<span class="token number">2</span>有序<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> arr<span class="token punctuation">,</span> dict <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> i<span class="token operator">&amp;</span><span class="token punctuation">,</span> j<span class="token operator">&amp;</span><span class="token punctuation">,</span> r<span class="token operator">&amp;</span><span class="token punctuation">,</span> c<span class="token operator">&amp;</span><span class="token punctuation">,</span> max_c<span class="token operator">&amp;</span><span class="token punctuation">,</span> rng <span class="token keyword">As</span> Range<span class="token punctuation">,</span> xh<span class="token punctuation">,</span> dw<span class="token punctuation">,</span> sl
    <span class="token keyword">Set</span> dict <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">"scripting.dictionary"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> tm <span class="token operator">=</span> <span class="token keyword">Timer</span>
    <span class="token keyword">With</span> Worksheets<span class="token punctuation">(</span><span class="token string">"数据"</span><span class="token punctuation">)</span>  <span class="token comment">'读取数据</span>
        arr <span class="token operator">=</span> .[a1].CurrentRegion<span class="token punctuation">:</span> <span class="token keyword">ReDim</span> res<span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token number">10</span><span class="token punctuation">)</span>
        res<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"箱号"</span><span class="token punctuation">:</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">Set</span> rng <span class="token operator">=</span> .Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>.Resize<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">'表头</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> <span class="token function">UBound</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
            <span class="token keyword">If</span> <span class="token function">Len</span><span class="token punctuation">(</span>arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                xh <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span> dw <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> sl <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
                <span class="token keyword">If</span> <span class="token keyword">Not</span> dict.Exists<span class="token punctuation">(</span>xh<span class="token punctuation">)</span> <span class="token keyword">Then</span>
                    <span class="token keyword">Set</span> dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span> <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">"scripting.dictionary"</span><span class="token punctuation">)</span>
                <span class="token keyword">End</span> <span class="token keyword">If</span>
                dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span>dw<span class="token punctuation">)</span> <span class="token operator">=</span> dict<span class="token punctuation">(</span>xh<span class="token punctuation">)</span><span class="token punctuation">(</span>dw<span class="token punctuation">)</span> <span class="token operator">+</span> sl
            <span class="token keyword">Else</span>
                <span class="token keyword">Set</span> rng <span class="token operator">=</span> Union<span class="token punctuation">(</span>rng<span class="token punctuation">,</span> .Cells<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>.Resize<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Next</span>
        krr <span class="token operator">=</span> bubble_sort<span class="token punctuation">(</span>dict.keys<span class="token punctuation">)</span>  <span class="token comment">'有序箱号</span>
        <span class="token keyword">For Each</span> k <span class="token keyword">In</span> krr
            r <span class="token operator">=</span> r <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">:</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span>r<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">=</span> k
            <span class="token keyword">For Each</span> kk <span class="token keyword">In</span> dict<span class="token punctuation">(</span>k<span class="token punctuation">)</span>.keys
                c <span class="token operator">=</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span>r<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">=</span> kk<span class="token punctuation">:</span> res<span class="token punctuation">(</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">=</span> dict<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">(</span>kk<span class="token punctuation">)</span>
            <span class="token keyword">Next</span>
            max_c <span class="token operator">=</span> WorksheetFunction.<span class="token function">Max</span><span class="token punctuation">(</span>max_c<span class="token punctuation">,</span> c<span class="token punctuation">)</span>  <span class="token comment">'最大列数</span>
        <span class="token keyword">Next</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token keyword">With</span> Worksheets<span class="token punctuation">(</span><span class="token string">"结果"</span><span class="token punctuation">)</span>  <span class="token comment">'写入结果</span>
        r <span class="token operator">=</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> max_c <span class="token operator">=</span> max_c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> res<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_c<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"总件数"</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> r
            <span class="token keyword">If</span> <span class="token function">Len</span><span class="token punctuation">(</span>res<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">Then</span>
                res<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"数量"</span>
                res<span class="token punctuation">(</span>i<span class="token punctuation">,</span> max_c<span class="token punctuation">)</span> <span class="token operator">=</span> WorksheetFunction.sum<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>res<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>.items<span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Next</span>
        <span class="token keyword">For</span> j <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> max_c <span class="token operator">-</span> <span class="token number">1</span>
            res<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"单位号"</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">Next</span>
        .[a1].Resize<span class="token punctuation">(</span>r<span class="token punctuation">,</span> max_c<span class="token punctuation">)</span> <span class="token operator">=</span> res
        <span class="token keyword">If</span> <span class="token keyword">Not</span> rng <span class="token keyword">Is</span> <span class="token keyword">Nothing</span> <span class="token keyword">Then</span> rng.Copy .Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_c <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">'无法装箱</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token function">Debug</span>.<span class="token function">Print</span> <span class="token string">"累计用时"</span> <span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token keyword">Timer</span> <span class="token operator">-</span> tm<span class="token punctuation">,</span> <span class="token string">"0.00"</span><span class="token punctuation">)</span>  <span class="token comment">'耗时</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> 
<p>生成结果：对方法2生成数据（即本文图1）进行整理<br> <img src="https://images2.imgbox.com/2e/36/KrBNeUHq_o.jpg" alt="在这里插入图片描述"><br> <strong>附件：</strong><a href="https://download.csdn.net/download/hhhhh_51/88140821">《Excel·VBA定量装箱、凑数值金额、组合求和问题（附件）》</a></p> 
<p><strong>扩展阅读：</strong><a href="https://club.excelhome.net/thread-1668486-1-1.html" rel="nofollow">《excelhome-一个装箱难题》</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a187bd58e70670b4d431af8dedd9aacd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vxe-table 获取滚动高度、还原滚动条位置、展开树形表格</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9f8bfe345cbf50c3d3a2c507ee5c2a62/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Scala项目找不到或无法加载主类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>