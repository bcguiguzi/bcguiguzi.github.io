<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Prometheus&#43;Grafana学习(三) 监控windows下的mysql - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Prometheus&#43;Grafana学习(三) 监控windows下的mysql" />
<meta property="og:description" content="文章目录 一、安装Grafana和Prometheus二、安装Mysqld_exporter1.下载2.安装windows版mysqld_exporter3.测试使用mysqld_exporter 三、配置Prometheus1.修改配置文件2.重启prometheus3.查看prometheus 三、配置Grafana 一、安装Grafana和Prometheus 略，参考：https://blog.csdn.net/u011943534/article/details/122452337
二、安装Mysqld_exporter MySQL版本需要在5.5以上。
Mysqld_exporter用于收集MySQL性能信息。
官方源码和文档地址：https://github.com/prometheus/mysqld_exporter
使用版本：0.13.0，在github的tag中下载。
1.下载 下载地址：https://github.com/prometheus/mysqld_exporter/releases/download/v0.13.0/mysqld_exporter-0.13.0.windows-amd64.zip
2.安装windows版mysqld_exporter 前提是机器上已经安装了MySQL，安装过程与linux下大概一致。
(1)解压 tar zvxf mysqld_exporter-0.13.0.linux-amd64.tar.gz (2)登录mysql为exporter创建账号并授权 创建数据库用户 CREATE USER &#39;exporter&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;exporter&#39;; GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO &#39;exporter&#39;@&#39;localhost&#39;; ALTER USER exporter@localhost IDENTIFIED WITH mysql_native_password BY &#39;exporter&#39;; flush privileges; (3)创建MySQL配置文件exporter.ini，配置免密码连接数据库 编辑内容： [client] user=exporter password=exporter (4)启动exporter客户端 mysqld_exporter.exe --config.my-cnf=exporter.ini 其他参数 # 选择采集innodb --collect.info_schema.innodb_cmp # innodb存储引擎状态 --collect.engine_innodb_status # 指定配置文件 --config.my-cnf=&#34;.my.cnf&#34; 3.测试使用mysqld_exporter 访问： http://IP:9104/metrics
三、配置Prometheus 1.修改配置文件 在之前配置的mysql8." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/74f7e43d09e5e4f92a479d84d27a3bb1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-13T20:24:57+08:00" />
<meta property="article:modified_time" content="2022-01-13T20:24:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Prometheus&#43;Grafana学习(三) 监控windows下的mysql</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#GrafanaPrometheus_2" rel="nofollow">一、安装Grafana和Prometheus</a></li><li><a href="#Mysqld_exporter_6" rel="nofollow">二、安装Mysqld_exporter</a></li><li><ul><li><a href="#1_11" rel="nofollow">1.下载</a></li><li><a href="#2windowsmysqld_exporter_14" rel="nofollow">2.安装windows版mysqld_exporter</a></li><li><a href="#3mysqld_exporter_44" rel="nofollow">3.测试使用mysqld_exporter</a></li></ul> 
  </li><li><a href="#Prometheus_47" rel="nofollow">三、配置Prometheus</a></li><li><ul><li><a href="#1_48" rel="nofollow">1.修改配置文件</a></li><li><a href="#2prometheus_73" rel="nofollow">2.重启prometheus</a></li><li><a href="#3prometheus_83" rel="nofollow">3.查看prometheus</a></li></ul> 
  </li><li><a href="#Grafana_93" rel="nofollow">三、配置Grafana</a></li></ul> 
</div> 
<p></p> 
<h2><a id="GrafanaPrometheus_2"></a>一、安装Grafana和Prometheus</h2> 
<p>略，参考：<a href="https://blog.csdn.net/u011943534/article/details/122452337">https://blog.csdn.net/u011943534/article/details/122452337</a></p> 
<h2><a id="Mysqld_exporter_6"></a>二、安装Mysqld_exporter</h2> 
<p>MySQL版本需要在5.5以上。<br> Mysqld_exporter用于收集MySQL性能信息。<br> 官方源码和文档地址：<a href="https://github.com/prometheus/mysqld_exporter">https://github.com/prometheus/mysqld_exporter</a><br> 使用版本：<code>0.13.0</code>，在github的tag中下载。</p> 
<h3><a id="1_11"></a>1.下载</h3> 
<p>下载地址：<a href="https://github.com/prometheus/mysqld_exporter/releases/download/v0.13.0/mysqld_exporter-0.13.0.windows-amd64.zip">https://github.com/prometheus/mysqld_exporter/releases/download/v0.13.0/mysqld_exporter-0.13.0.windows-amd64.zip</a></p> 
<h3><a id="2windowsmysqld_exporter_14"></a>2.安装windows版mysqld_exporter</h3> 
<p>前提是机器上已经安装了MySQL，安装过程与linux下大概一致。</p> 
<pre><code class="prism language-bash"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>解压
<span class="token function">tar</span> zvxf mysqld_exporter-0.13.0.linux-amd64.tar.gz

<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>登录mysql为exporter创建账号并授权
创建数据库用户
CREATE <span class="token environment constant">USER</span> <span class="token string">'exporter'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'exporter'</span><span class="token punctuation">;</span>
GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO <span class="token string">'exporter'</span>@<span class="token string">'localhost'</span><span class="token punctuation">;</span>
ALTER <span class="token environment constant">USER</span> exporter@localhost IDENTIFIED WITH mysql_native_password BY <span class="token string">'exporter'</span><span class="token punctuation">;</span>
flush privileges<span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>创建MySQL配置文件exporter.ini，配置免密码连接数据库
编辑内容：
<span class="token punctuation">[</span>client<span class="token punctuation">]</span>
<span class="token assign-left variable">user</span><span class="token operator">=</span>exporter
<span class="token assign-left variable">password</span><span class="token operator">=</span>exporter

<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>启动exporter客户端
mysqld_exporter.exe --config.my-cnf<span class="token operator">=</span>exporter.ini
其他参数
  <span class="token comment"># 选择采集innodb</span>
--collect.info_schema.innodb_cmp
<span class="token comment"># innodb存储引擎状态</span>
--collect.engine_innodb_status
<span class="token comment"># 指定配置文件</span>
--config.my-cnf<span class="token operator">=</span><span class="token string">".my.cnf"</span>
</code></pre> 
<h3><a id="3mysqld_exporter_44"></a>3.测试使用mysqld_exporter</h3> 
<p>访问： http://IP:9104/metrics<br> <img src="https://images2.imgbox.com/61/2c/9oACblwo_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Prometheus_47"></a>三、配置Prometheus</h2> 
<h3><a id="1_48"></a>1.修改配置文件</h3> 
<p>在之前配置的mysql8.x中添加windows下的mysqld_exporter地址192.168.100.88:9104。</p> 
<pre><code class="prism language-bash"><span class="token function">cat</span> prometheus.yaml
添加一个job_name:mysql8.x，targets的IP配置为上一步装好的mysqld_exporter
如下：

scrape_configs:
<span class="token comment"># 可随意指定</span>
- job_name: <span class="token string">'spring'</span>
  <span class="token comment"># 多久采集一次数据</span>
  scrape_interval: 15s
  <span class="token comment"># 采集时的超时时间</span>
  scrape_timeout: 10s
  <span class="token comment"># 采集的路径</span>
  metrics_path: <span class="token string">'/demo/actuator/prometheus'</span>
  <span class="token comment"># 采集服务的地址，设置成Springboot应用所在服务器的具体地址</span>
  static_configs:
  - targets: <span class="token punctuation">[</span><span class="token string">'192.168.100.88:7901'</span><span class="token punctuation">]</span>
- job_name: <span class="token string">'mysql8.x'</span>
  <span class="token comment">#静态添加node</span>
  static_configs:
  - targets: <span class="token punctuation">[</span><span class="token string">'172.16.10.169:9104'</span>, <span class="token string">'192.168.100.88:9104'</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="2prometheus_73"></a>2.重启prometheus</h3> 
<pre><code class="prism language-bash">docker <span class="token function">ps</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f4/62/maklHk1S_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">docker restart 78738bfedc5b
</code></pre> 
<h3><a id="3prometheus_83"></a>3.查看prometheus</h3> 
<p>访问http://IP:9090/targets，查看targets，发现mysql已经加入<br> <img src="https://images2.imgbox.com/87/bf/a0HQy2R1_o.png" alt="在这里插入图片描述"><br> 随便测试一个指标：</p> 
<pre><code class="prism language-bash">go_memstats_heap_alloc_bytes
</code></pre> 
<p><img src="https://images2.imgbox.com/25/0d/YcbW4IZd_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Grafana_93"></a>三、配置Grafana</h2> 
<p>使用linux的mysql配置时导入的JSON就可以。<br> 刷新页面，会发现多了windows下的mysql<br> <img src="https://images2.imgbox.com/29/9d/irJjBoyj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ab/aa/Srd1EXW7_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0d4ca3284976d52600c02d5cf5411838/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">浅谈游戏业务遭遇攻击的防护措施</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bd8e2590c9ff970bb69c6e042f9ff443/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">nodejs 本地安装VS全局安装 生产依赖VS开发依赖</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>