<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据结构/C&#43;&#43;：红黑树 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据结构/C&#43;&#43;：红黑树" />
<meta property="og:description" content="数据结构/C&#43;&#43;：红黑树 概念实现基本结构插入uncle为红色节点uncle为黑色节点 总代码展示 概念 红黑树是一种二叉搜索树，一般的二叉搜索会发生不平衡现象，导致搜索效率下降，于是学者们开始探索如何让二叉搜索树保持平衡，这种树叫做自平衡二叉搜索树。起初学者发明了AVL树，其通过一定算法保持了二叉搜索树的严格平衡，不久后Rudolf Bayer发明了红黑树，红黑树的平衡是较为宽泛的，为了保持平衡，红黑树付出的代价比AVL树更小。因此红黑树被更为广泛的使用，比如Java，C&#43;&#43;，python中，使用的自平衡二叉搜索树都是红黑树，而不是AVL树。
如果想了解AVL树，可以看这篇博客：[数据结构/C&#43;&#43;：AVL树]
红黑树的要求如下：
红黑树中，最长路径的长度不会超过最短路径的两倍
先解释一下路径的概念：从根走到nullptr。
有不少人认为路径是从根走到叶子节点，这是不正确的。
红黑树用了五条规则来限制一棵树，从而达到以上要求：
每个节点不是红色就是黑色根节点一定是黑色不可以出现连续的红色节点（黑色可以连续出现） 每一条路径都包含相同数目的黑色节点nullptr视为黑色节点 只要满足以上五个条件，那么这棵树就是一颗红黑树，而且满足最长路径的长度不会超过最短路径的两倍。为什么呢？
五条规则中，我标红了3，4两条规则：
不可以出现连续的红色节点（黑色可以连续出现） 每一条路径都包含相同数目的黑色节点 由于每一条路径都必须包含相同数目的黑色节点，现在我们假设一棵红黑树，所有路径的黑色节点数目都是x，那么最短的路径长度就是全为黑色节点，长度为x。
如果想让一条路径变长，那么就只能插入更多的红色节点（因为黑色节点数目相同），但是红色节点又不能连续出现，所以只能是黑红黑红黑红黑红黑红......这样排列，一个黑节点匹配一个红节点，因此最长路径的长度就是黑色节点的两倍2x。
可以发现，红黑树通过这两条核心规则，保证了二叉搜索树的平衡。
比如以下就是一颗红黑树：
其最短路径为最左侧的路径，长度为2，即两个黑节点。
其最长路径为最右侧的路径，长度为4，即一红一黑排列。
要注意的是：不是所有的红黑树都会出现以上的全黑路径，或者一红一黑路径的，这只是极端情况。
接下来我们通过实现红黑树，来了解红黑树是如何自平衡的：
实现 基本结构 首先我们要在节点中加入一个成员来表示节点的颜色，颜色有红黑和黑色两种状态，这里我使用枚举来区分两者：
enum Colour { RED, BLACK }; 在某些红黑树的实现中，使用bool值来表示红黑颜色，这也是可以的，但是本博客以枚举来表示颜色。
节点类：
template&lt;class K, class V&gt; struct RBTreeNode { RBTreeNode* _left; RBTreeNode* _right; RBTreeNode* _parent; pair&lt;K, V&gt; _kv; Colour _col; }; _left：左子树
_right：右子树
_parent：父节点
_kv：节点存储的值
_col：该节点的颜色
节点类还需要一个构造函数进行初始化，现在的问题就是：新的节点要初始化为什么颜色？
先来考虑一下：插入红色节点和插入黑色节点，谁对红黑树影响大？
对于一棵红黑树，其所有路径的黑色节点数目都相同，如果我们在某一条路径末尾插入了黑色节点，那么整棵树的所有其它路径都会少一个黑节点。而插入红色节点只影响当前路径，所以新节点应该是红色节点。
构造函数：
RBTreeNode(const pair&lt;K, V&gt;&amp; kv) : _left(nullptr) , _right(nullptr) , _parent(nullptr) , _kv(kv) , _col(RED)//初始化为红节点 {} 接着就是红黑树本体，类中只存储一个根节点_root：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/462ce08319170efc9efa5c427464570e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-17T14:05:51+08:00" />
<meta property="article:modified_time" content="2024-03-17T14:05:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据结构/C&#43;&#43;：红黑树</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>数据结构/C++：红黑树</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">概念</a></li><li><a href="#_41" rel="nofollow">实现</a></li><li><ul><li><a href="#_42" rel="nofollow">基本结构</a></li><li><a href="#_98" rel="nofollow">插入</a></li><li><ul><li><a href="#uncle_222" rel="nofollow">uncle为红色节点</a></li><li><a href="#uncle_320" rel="nofollow">uncle为黑色节点</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_546" rel="nofollow">总代码展示</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h3><a id="_2"></a>概念</h3> 
<p>红黑树是一种二叉搜索树，一般的二叉搜索会发生不平衡现象，导致搜索效率下降，于是学者们开始探索如何让二叉搜索树保持平衡，这种树叫做<mark>自平衡二叉搜索树</mark>。起初学者发明了AVL树，其通过一定算法保持了二叉搜索树的<mark>严格平衡</mark>，不久后Rudolf Bayer发明了红黑树，<mark>红黑树的平衡是较为宽泛的，为了保持平衡，红黑树付出的代价比AVL树更小</mark>。因此红黑树被更为广泛的使用，比如Java，C++，python中，使用的自平衡二叉搜索树都是红黑树，而不是AVL树。</p> 
<p>如果想了解AVL树，可以看这篇博客：[<a href="https://blog.csdn.net/fsdfafsdsd/article/details/136465708">数据结构/C++：AVL树</a>]</p> 
<p>红黑树的要求如下：</p> 
<blockquote> 
 <p>红黑树中，最长路径的长度不会超过最短路径的两倍</p> 
</blockquote> 
<p>先解释一下<code>路径</code>的概念：<font color="red">从根走到<code>nullptr</code></font>。<br> 有不少人认为路径是从根走到叶子节点，这是不正确的。</p> 
<p>红黑树用了五条规则来限制一棵树，从而达到以上要求：</p> 
<blockquote> 
 <ol><li>每个节点不是红色就是黑色</li><li>根节点一定是黑色</li><li><font color="red">不可以出现连续的红色节点</font>（黑色可以连续出现）</li><li><font color="red"> 每一条路径都包含相同数目的黑色节点</font></li><li><code>nullptr</code>视为黑色节点</li></ol> 
</blockquote> 
<p>只要满足以上五个条件，那么这棵树就是一颗红黑树，而且满足<mark>最长路径的长度不会超过最短路径的两倍</mark>。为什么呢？</p> 
<p>五条规则中，我标红了3，4两条规则：</p> 
<blockquote> 
 <ol start="3"><li><font color="red">不可以出现连续的红色节点</font>（黑色可以连续出现）</li><li><font color="red"> 每一条路径都包含相同数目的黑色节点</font></li></ol> 
</blockquote> 
<p>由于每一条路径都必须包含相同数目的黑色节点，现在我们假设一棵红黑树，所有路径的黑色节点数目都是<code>x</code>，那么<mark>最短的路径长度就是全为黑色节点</mark>，长度为<code>x</code>。<br> 如果想让一条路径变长，那么就只能插入更多的红色节点（因为黑色节点数目相同），但是红色节点又不能连续出现，所以只能是<code>黑红黑红黑红黑红黑红......</code>这样排列，一个黑节点匹配一个红节点，因此<mark>最长路径的长度就是黑色节点的两倍<code>2x</code></mark>。<br> 可以发现，红黑树通过这两条核心规则，保证了二叉搜索树的平衡。</p> 
<p>比如以下就是一颗红黑树：<br> <img src="https://images2.imgbox.com/cb/06/sAxUCtYk_o.png" alt="在这里插入图片描述"></p> 
<p>其最短路径为最左侧的路径，长度为2，即两个黑节点。<br> 其最长路径为最右侧的路径，长度为4，即一红一黑排列。</p> 
<p>要注意的是：<font color="red">不是所有的红黑树都会出现以上的全黑路径，或者一红一黑路径的，这只是极端情况</font>。</p> 
<p>接下来我们通过实现红黑树，来了解红黑树是如何自平衡的：</p> 
<hr> 
<h3><a id="_41"></a>实现</h3> 
<h4><a id="_42"></a>基本结构</h4> 
<p>首先我们要在节点中加入一个成员来表示节点的颜色，颜色有红黑和黑色两种状态，这里我使用枚举来区分两者：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">enum</span> <span class="token class-name">Colour</span>
<span class="token punctuation">{<!-- --></span>
    RED<span class="token punctuation">,</span>
    BLACK
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>在某些红黑树的实现中，使用<code>bool</code>值来表示红黑颜色，这也是可以的，但是本博客以枚举来表示颜色。</p> 
<p>节点类：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span>
<span class="token punctuation">{<!-- --></span>
    RBTreeNode<span class="token operator">*</span> _left<span class="token punctuation">;</span>
    RBTreeNode<span class="token operator">*</span> _right<span class="token punctuation">;</span>
    RBTreeNode<span class="token operator">*</span> _parent<span class="token punctuation">;</span>
    pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> _kv<span class="token punctuation">;</span>
    Colour _col<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p><code>_left</code>：左子树<br> <code>_right</code>：右子树<br> <code>_parent</code>：父节点<br> <code>_kv</code>：节点存储的值<br> <code>_col</code>：该节点的颜色</p> 
</blockquote> 
<p>节点类还需要一个构造函数进行初始化，现在的问题就是：新的节点要初始化为什么颜色？<br> 先来考虑一下：插入红色节点和插入黑色节点，谁对红黑树影响大？<br> 对于一棵红黑树，其所有路径的黑色节点数目都相同，如果我们<mark>在某一条路径末尾插入了黑色节点，那么整棵树的所有其它路径都会少一个黑节点</mark>。而插入红色节点只影响当前路径，所以<mark>新节点应该是红色节点</mark>。</p> 
<p>构造函数：</p> 
<pre><code class="prism language-cpp"><span class="token function">RBTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">_left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token function">_right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token function">_parent</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token function">_kv</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token function">_col</span><span class="token punctuation">(</span>RED<span class="token punctuation">)</span><span class="token comment">//初始化为红节点</span>
<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>接着就是红黑树本体，类中只存储一个根节点<code>_root</code>：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>现在我们有了红黑树的基本结构，接下来就实现它的插入操作：</p> 
<hr> 
<h4><a id="_98"></a>插入</h4> 
<p>那么我们先写出当基本的二叉搜索树的插入代码逻辑，既然要插入，那么就要先找到合适的位置插入，代码如下：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//保持根为黑节点</span>
    <span class="token punctuation">}</span>

    Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
    Node<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
            cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
            cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
        parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>

    cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
   
   <span class="token comment">//调整红黑树</span>
   <span class="token comment">//......</span>
   <span class="token comment">//......</span>
   <span class="token comment">//......</span>
   
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>接下来，我先解析以上代码的逻辑：</p> 
<blockquote> 
 <pre><code class="prism language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	_root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//保持根为黑节点</span>
<span class="token punctuation">}</span>
</code></pre> 
 <p>如果我们插入节点时，根节点<code>_root</code>为空，说明当前整棵树都为空，那么我们直接插入值作为根节点即可，但是<mark>根节点必须是黑色节点</mark>，而我们新插入的节点是红色，所以要将其调整为黑色节点。</p> 
 <hr> 
 <pre><code class="prism language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
 <p>以上代码，是在找到合适的插入位置，当<code>key</code>大于当前节点<code>cur-&gt;_kv.first &lt; kv.first</code>，那么<code>cur</code>就向左寻找，反之向右寻找。如果当前节点值等于<code>key</code>，那么说明该节点已经存在，返回<code>false</code>代表插入失败。当我们的<code>cur</code>为空指针，说明已经找到了插入的节点，此时跳出循环进行插入。</p> 
 <hr> 
 <pre><code class="prism language-cpp">cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
	parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
<span class="token keyword">else</span>
	parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>

cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
</code></pre> 
 <p>到达此处，说明前面已经找到插入的位置了，而<code>parent</code>节点就是插入位置的父亲节点。根据<code>key</code>的大小，来判断插入到左边还是右边，插入完成后，再让新节点的<code>_parent</code>指向<code>parent</code>。</p> 
</blockquote> 
<p>至此我们就完成了插入操作，接下来就要根据不同情况对红黑树进行调整。</p> 
<hr> 
<p>对于红黑树的插入，我们需要关注新节点的父亲<code>parent</code>，祖父<code>grandfather</code>，叔叔<code>uncle</code>三个节点：<br> <img src="https://images2.imgbox.com/a9/ea/FTdsap9V_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <ol><li>先根据父亲节点的颜色，来判断是否需要调整</li></ol> 
</blockquote> 
<blockquote> 
 <p>父亲节点为黑色：<br> <img src="https://images2.imgbox.com/6d/dd/1X9mWC2w_o.png" alt="在这里插入图片描述"><br> 新插入的节点默认为红色，所以新插入节点不会影响路径上黑色节点的数目，而<code>parent</code>是黑节点，我们也没有出现连续的红色节点，所以这种情况无需任何调整，直接插入就可以。</p> 
</blockquote> 
<blockquote> 
 <p>父亲节点为红色：<br> <img src="https://images2.imgbox.com/75/4f/nNnUYMAU_o.png" alt="在这里插入图片描述"><br> 如果父亲节点为红色，我们就会出现连续的红色节点，这时我们就需要进行调整了</p> 
</blockquote> 
<p>以上两种情况总结为：</p> 
<blockquote> 
 <p>当<code>parent</code>为黑色，直接插入<br> 当<code>parent</code>为红色，插入后需要进行调整</p> 
</blockquote> 
<p>当<code>parent</code>为红色，我们就需要再根据<code>uncle</code>的颜色，将插入分类两类：<code>uncle为红色</code>以及<code>uncle为黑色</code>。<br> <img src="https://images2.imgbox.com/6e/95/AQwio8aB_o.png" alt="在这里插入图片描述"><br> 值得注意的是：<mark>由于<code>parent</code>是红色节点，此时的<code>grandfather</code>一定是黑色节点</mark>，因为不能出现连续红色节点<br> 这两种情况的操作不同，我们先看到<code>uncle为红色</code>的情况：</p> 
<hr> 
<h5><a id="uncle_222"></a>uncle为红色节点</h5> 
<blockquote> 
 <p>当<code>uncle</code>节点为红色，此时需要进行变色</p> 
</blockquote> 
<p>变色如下：<br> <img src="https://images2.imgbox.com/35/e7/AG5p423w_o.png" alt="在这里插入图片描述"></p> 
<p>由于新插入了红色的<code>cur</code>节点，此时<code>parent</code>与<code>cur</code>出现了连续的红色节点，于是我们将<code>parent</code>改为黑色。但是此时以<code>parent</code>为根的所有路径就会多出一个黑节点，于是把<code>grandfather</code>变为红色，来抵消这个新增的黑节点。但是此时以<code>uncle</code>为根的路径又会少一个黑节点，于是把<code>uncle</code>变黑。</p> 
<p>但是我们<mark>将<code>grandfather</code>变为了红色，这有可能会影响到上一层节点</mark>，比如这样：<br> <img src="https://images2.imgbox.com/e0/dc/qoif3IZA_o.png" alt="在这里插入图片描述"><br> 我们把<code>grandfather</code>变红之后，又出现了两个红色节点相连的情况，所以我们要写一个while循环，来反复向上检查。</p> 
<p>当前代码如下：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span><span class="token comment">//只有parent为红，才更新 (parent可能不存在)</span>
<span class="token punctuation">{<!-- --></span>
    Node<span class="token operator">*</span> grandfather <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

        <span class="token comment">//uncle存在且为红节点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
            grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

            cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
            parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token comment">//uncle为黑节点 </span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//其它处理</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

        <span class="token comment">//uncle存在且为红节点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
            grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

            cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
            parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token comment">//uncle为黑节点 </span>
        <span class="token punctuation">{<!-- --></span>
        	<span class="token comment">//其它处理</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//在循环内部不判断root情况，统一处理</span>
</code></pre> 
<p>代码解析：</p> 
<blockquote> 
 <pre><code class="prism language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
</code></pre> 
 <p>该代码用于检测<code>cur</code>的<code>parent</code>的颜色，通过我们前面的推导，<mark>如果<code>parent</code>为红色才需要调整，因此进入循环的条件之一是<code>parent</code>为红色</mark>。另外的<code>parent</code>有可能为<code>nullptr</code>，此时我们要避免访问空指针，所以空指针也不能进循环</p> 
 <hr> 
 <pre><code class="prism language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>  <span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
</code></pre> 
 <p>这一段代码是在检测<code>parent </code>节点是<code>grandfather</code>的左子树还是右子树，这将涉及到我们如何找<code>uncle</code>以及下一种情况的调整，此时我们要分类讨论。当<code>parent == grandfather-&gt;_left</code>成立，那么<code>uncle</code>就是<code>grandfather</code>的右子树：<code>Node* uncle = grandfather-&gt;_right;</code>，反之就是左子树</p> 
 <hr> 
 <pre><code class="prism language-cp">if (uncle &amp;&amp; uncle-&gt;_col == RED)
{
	parent-&gt;_col = uncle-&gt;_col = BLACK;
	grandfather-&gt;_col = RED;

	cur = grandfather;
	parent = cur-&gt;_parent;
}      
</code></pre> 
 <p>我们找到<code>uncle</code>后，如果<code>uncle</code>是红色，那么直接进行变色操作，把<code>parent</code>和<code>uncle</code>的颜色变为黑色，<code>grandfather</code>变为红色。<br> 随后由于我们的变色操作可能会影响上一层，此时调整节点，进入下一次<code>while</code>循环</p> 
 <hr> 
 <p>在整个<code>while</code>循环外侧，还有一句代码：</p> 
 <pre><code class="prism language-cpp">_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
</code></pre> 
 <p>这是因为我们在先前的while循环中，有可能出现对<code>_root</code>节点的操作，导致<code>_root</code>的颜色改变，而<code>_root</code>需要保持黑色。如果我们在循环内部，每一次都检测<code>_root</code>有点麻烦了，于是我们直接在每一次调整完节点后，把<code>_root</code>强行矫正为黑色</p> 
</blockquote> 
<p>至此我们就讨论完了<code>uncle</code>为红色节点的情况，接下来我们就讨论<code>uncle</code>为黑色节点：</p> 
<hr> 
<h5><a id="uncle_320"></a>uncle为黑色节点</h5> 
<p>由于红黑树中，<code>nullptr</code>也算作黑色节点，所以<code>uncle</code>为黑色分为以下两种情况：</p> 
<blockquote> 
 <ol><li><code>uncle</code>为空指针</li><li><code>uncle</code>不为空指针</li></ol> 
</blockquote> 
<p>图示如下：<br> <img src="https://images2.imgbox.com/d2/40/Rbd0zolg_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><mark>如果 <code>uncle</code>为空指针，那么<code>cur</code>一定是新插入的节点</mark>。</p> 
</blockquote> 
<p>因为如果<code>cur</code>不是新插入的节点，那么<code>cur</code>和<code>parent</code>一定有一个原先是黑色节点，不然会出现连续的红色节点。但是如果<code>cur</code>和<code>parent</code>有一个是黑色节点，那么<code>grandfather</code>的左子树就比右子树多出一个黑节点，这就违背了红黑树规则。<mark>无论怎样，原先的树都不可能符合规则，所以<code>cur</code>一定是新插入的节点，破坏了规则</mark>。</p> 
<blockquote> 
 <p><mark>如果 <code>uncle</code>不为空指针，那么<code>cur</code>一定是从黑色节点变成的红色节点（不是新插入的）</mark>。</p> 
</blockquote> 
<p>因为如果<code>uncle</code>存在，那么<code>grandfather</code>的右子树就存在一个黑节点，而<code>parent</code>是红节点，所以<code>cur</code>和<code>parent</code>的右子树中都至少有一个黑节点，才能保证每一条路径黑节点数目相同。<mark>因此<code>cur</code>原先一定是黑节点，是因为<code>cur</code>下层插入了新节点，然后通过<code>while</code>循环向上走，影响到了当前层</mark>。</p> 
<p>对于这种<code>uncle</code>为黑色的情况，我们需要通过<mark>旋转+变色</mark>来维持红黑树。</p> 
<p>旋转又分为单旋和双旋：</p> 
<blockquote> 
 <p>当<code>cur</code>与<code>parent</code>的关系和<code>parent</code>与<code>grandfather</code>的关系一致时，需要进行单旋</p> 
</blockquote> 
<p>比如我们刚刚的情况：<br> <img src="https://images2.imgbox.com/91/d7/MbpDBGOm_o.png" alt="在这里插入图片描述"><br> <code>cur</code>是<code>parent</code>的左子树，<code>parent</code>是<code>grandfather</code>的左子树，关系一致。<br> 我们需要对其进行右单旋+变色：<br> <img src="https://images2.imgbox.com/a9/44/64Q7SKpW_o.png" alt="在这里插入图片描述"><br> 这个旋转的算法在此我就不过多讲解了，可以去AVL树的博客中了解。我重点讲解一下变色和旋转的合理性：</p> 
<blockquote> 
 <p>一次插入过程中，走到这一步，说明前面一定经过了<code>uncle</code>为红色的情况，而<mark>对<code>uncle</code>为红色的情况进行变色并不会对任何路径的黑色节点数目造成影响，因此目前还是符合黑色节点数目相同规则的</mark>。<br> 同为<code>parent</code>的子树，以<code>cur</code>和<code>C</code>为根的路径，黑节点数目相同<br> 同为<code>grandfather</code>的子树，以<code>parent</code>和<code>uncle</code>为根的路径黑节点数目相同<br> 而<code>parent</code>是红色节点，<mark>所以<code>cur</code>，<code>C</code>以及<code>uncle</code>为根的路径，黑节点数目都相同</mark></p> 
 <hr> 
 <p>进行单旋，会把<code>c</code>树交给<code>grandfather</code>做子树，而<code>c</code>与<code>uncle</code>为根的路径黑节点数目相同，不违背规则（旋转的合理性）</p> 
 <hr> 
 <p>旋转后，<code>parent</code>作新根，<code>grandfather</code>与<code>cur</code>作为左右子树<code>grandfather</code>为根的路径，整体上就会比以<code>cur</code>为根的路径多出一个黑节点(即<code>grandfather</code>本身)<br> 因此，将<code>grandfather</code>改为红节点，来平衡<code>parent</code>左右子树的黑节点<br> 而红色节点不能连续出现，再把<code>parent</code>改为黑节点</p> 
</blockquote> 
<blockquote> 
 <p>当<code>cur</code>与<code>parent</code>的关系和<code>parent</code>与<code>grandfather</code>的关系不一致时，需要进行双旋</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/35/34/tfn61nEg_o.png" alt="在这里插入图片描述"><br> 以上结构中，<code>cur</code>是<code>parent</code>的左子树，<code>parent</code>是<code>grandfather</code>的右子树，关系不一致，要进行双旋。<br> 同样的，讲解一下变色和旋转的合理性：</p> 
<blockquote> 
 <p>一次插入过程中，走到这一步，说明前面一定经过了<code>uncle</code>为红色的情况，而<mark>对<code>uncle</code>为红色的情况进行变色并不会对任何路径的黑色节点数目造成影响，因此目前还是符合黑色节点数目相同规则的</mark>。<br> 同为<code>parent</code>的子树，以<code>cur</code>和<code>A</code>为根的路径，黑节点数目相同<br> 同为<code>cur</code>的子树，以<code>B</code>和<code>C</code>为根的路径，黑节点数目相同<br> 由于<code>cur</code>是红节点，所以以<code>A</code>，<code>B</code>，<code>C</code>为根的路径，黑节点数目相同<br> 相同的手段，由于<code>parent</code>是红节点，所以<code>A</code>与<code>uncle</code>为根的路径的黑节点数目相同<br> <mark>因此<code>A</code>，<code>B</code>，<code>C</code>，<code>uncle</code>为根的路径，黑节点数目都相同</mark></p> 
 <hr> 
 <p>进行双旋，会把<code>C</code>子树交给<code>grandfather</code>做子树，而<code>C</code>与<code>uncle</code>黑节点数目相同，不违背规则也会把B交给<code>parent</code>做子树<br> <code>A</code>与<code>B</code>黑节点数目相同，不违背规则<br> 旋转后，<code>cur</code>作新根，<code>grandfather</code>与<code>parent</code>作为左右子树<code>grandfather</code>为根的路径，整体上就会比以<code>parent</code>为根的路径多出一个黑节点(<code>grandfather</code>本身)<br> 因此，将<code>grandfather</code>改为红节点，来平衡<code>cur</code>左右子树的黑节点而红色节点不能连续出现，再把<code>cur</code>改为黑节点</p> 
</blockquote> 
<p>以上单旋和双旋的变色，看似复杂，其实<mark>最后都是把新根的颜色变为黑色，新根的左右子树变为红色</mark>。由于<mark>我们旋转后，新根都是黑节点，所以不会影响上层，可以直接跳出循环</mark>。</p> 
<p>代码如下：</p> 
<p>当<code>parent == grandfather-&gt;_left</code>：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">else</span><span class="token comment">//uncle为黑节点 (旋转)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//右单旋</span>
        parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//变色</span>
        grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span><span class="token comment">//变色</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//左右双旋 - 左单旋</span>
        <span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//左右双旋 - 右单旋</span>

        cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//变色</span>
        grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span><span class="token comment">//变色</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//旋转后一定平衡</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>当<code>parent == grandfather-&gt;_right</code>：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">else</span><span class="token comment">//uncle为黑节点 (旋转)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//左单旋</span>
        parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//变色</span>
        grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span><span class="token comment">//变色</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//右左双旋 - 右单旋</span>
        <span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//右左双旋 - 左单旋</span>

        cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//变色</span>
        grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span><span class="token comment">//变色</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//旋转后一定平衡</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>insert</code>总代码：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//保持根为黑节点</span>
    <span class="token punctuation">}</span>

    Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
    Node<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
            cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
            cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
        parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>

    cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span><span class="token comment">//只有parent为红，才更新 (parent可能不存在)</span>
    <span class="token punctuation">{<!-- --></span>
        Node<span class="token operator">*</span> grandfather <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

            <span class="token comment">//uncle存在且为红节点</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

                cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
                parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token comment">//uncle不存在或为黑节点 (旋转)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                    grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>


                    cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                    grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//旋转后一定平衡</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

            <span class="token comment">//uncle存在且为红节点</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

                cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
                parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token comment">//uncle不存在或为黑节点 (旋转)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                    grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                    grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//旋转后一定平衡</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    _root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//在循环内部不判断root情况，统一处理</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h3><a id="_546"></a>总代码展示</h3> 
<p>红黑树总代码：<br> <code>RBTree.h</code>：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">enum</span> <span class="token class-name">Colour</span>
<span class="token punctuation">{<!-- --></span>
    RED<span class="token punctuation">,</span>
    BLACK
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span>
<span class="token punctuation">{<!-- --></span>
    RBTreeNode<span class="token operator">*</span> _left<span class="token punctuation">;</span>
    RBTreeNode<span class="token operator">*</span> _right<span class="token punctuation">;</span>
    RBTreeNode<span class="token operator">*</span> _parent<span class="token punctuation">;</span>
    pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> _kv<span class="token punctuation">;</span>
    Colour _col<span class="token punctuation">;</span>

    <span class="token function">RBTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">_left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
        <span class="token punctuation">,</span> <span class="token function">_right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
        <span class="token punctuation">,</span> <span class="token function">_parent</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
        <span class="token punctuation">,</span> <span class="token function">_kv</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span>
        <span class="token punctuation">,</span> <span class="token function">_col</span><span class="token punctuation">(</span>RED<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">bool</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            _root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
            _root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//保持根为黑节点</span>
        <span class="token punctuation">}</span>

        Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
        Node<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
                cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
                cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
            parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>

        cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span><span class="token comment">//只有parent为红，才更新 (parent可能不存在)</span>
        <span class="token punctuation">{<!-- --></span>
            Node<span class="token operator">*</span> grandfather <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

                <span class="token comment">//uncle存在且为红节点</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                    grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

                    cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
                    parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token comment">//uncle不存在或为黑节点 (旋转)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                        grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                        grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//旋转后一定平衡</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

                <span class="token comment">//uncle存在且为红节点</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                    grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

                    cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
                    parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token comment">//uncle不存在或为黑节点 (旋转)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                        grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
                        grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//旋转后一定平衡</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        _root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//在循环内部不判断root情况，统一处理</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//左单旋</span>
    <span class="token keyword">void</span> <span class="token function">RotateL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
        Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

        parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subRL<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>subRL<span class="token punctuation">)</span>
            subRL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

        subR<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> parent<span class="token punctuation">;</span>
        Node<span class="token operator">*</span> ppNode <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
        parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subR<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            _root <span class="token operator">=</span> subR<span class="token punctuation">;</span>
            subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ppNode<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
                ppNode<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subR<span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                ppNode<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subR<span class="token punctuation">;</span>

            subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> ppNode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//右单旋</span>
    <span class="token keyword">void</span> <span class="token function">RotateR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
        Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

        parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subLR<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>subLR<span class="token punctuation">)</span>
            subLR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

        subL<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> parent<span class="token punctuation">;</span>
        Node<span class="token operator">*</span> ppNode <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
        parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subL<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            _root <span class="token operator">=</span> subL<span class="token punctuation">;</span>
            subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ppNode<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
                ppNode<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subL<span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                ppNode<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subL<span class="token punctuation">;</span>

            subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> ppNode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    size_t <span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">_Size</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    size_t <span class="token function">_Size</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">_Size</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">_Size</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Node<span class="token operator">*</span> <span class="token function">Find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> key<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> key<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> cur<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//中序</span>
    <span class="token keyword">void</span> <span class="token function">InOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">_InOrder</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"end"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> <span class="token function">Height</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">_Height</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">//中序</span>
    <span class="token keyword">void</span> <span class="token function">_InOrder</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token function">_InOrder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">" - "</span><span class="token punctuation">;</span>

        <span class="token function">_InOrder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//求高度</span>
    <span class="token keyword">int</span> <span class="token function">_Height</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f39b0ce58311b8bbf116a0c199e234dc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一套为中小电商企业构建的、开源的、简单实用的ERP系统需要接入的电商API接口以及实现的功能模块分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a48c8c9e7946fe5e440a9a3319c8e5d7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【go语言开发】性能分析工具pprof使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>