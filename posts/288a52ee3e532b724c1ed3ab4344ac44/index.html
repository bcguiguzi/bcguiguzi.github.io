<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux 网卡 Bonding 配置 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux 网卡 Bonding 配置" />
<meta property="og:description" content="一、bonding技术 简介
bonding(绑定)是一种将n个物理网卡在系统内部抽象(绑定)成一个逻辑网卡的技术，能够提升网络吞吐量、实现网络冗余、负载等功能，有很多优势。
Linux 系统下支持网络 Bonding,也叫 channel Bonding,它允许你将 2 个或者更多的网卡绑定到一起,成为一个新的逻辑网卡,从而实现故障切换或者负载均衡的功能,具体情况要取决于 mode 参数的具体配置。
Linux系统bonding技术是内核层面实现的，它是一个内核模块(驱动)。使用它需要系统有这个模块, 我们可以modinfo命令查看下这个模块的信息, 一般来说都支持。
modinfo bonding bonding的七种工作模式
bonding技术提供了七种工作模式，在使用的时候需要指定一种，每种有各自的优缺点.
balance-rr (mode=0) 默认, 有高可用 (容错) 和负载均衡的功能, 需要交换机的配置，每块网卡轮询发包 (流量分发比较均衡).
active-backup (mode=1) 只有高可用 (容错) 功能, 不需要交换机配置, 这种模式只有一块网卡工作, 对外只有一个mac地址。缺点是端口利用率比较低
balance-xor (mode=2) 不常用
broadcast (mode=3) 不常用
802.3ad (mode=4) IEEE 802.3ad 动态链路聚合，需要交换机配置，没用过
balance-tlb (mode=5) 不常用
balance-alb (mode=6) 有高可用 ( 容错 )和负载均衡的功能，不需要交换机配置 (流量分发到每个接口不是特别均衡)
详细说明请参考网络上其他资料，了解每种模式的特点根据自己的选择就行, 一般会用到0、1、4、6这几种模式。
二、RHEL6 下的 Bonding 配置: 在所有的 RHEL 版本下,目前都不支持在 NetworkManager 服务协作下实现 Bonding 配置.所以要么直接关闭 NetworkManager 服务,并取消其开机启动,要么在所有涉及 Bonding 的网卡配置文件中(包含ethx 或者 bondY),显式地添加一行:NM_CONTROLLED=no" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/288a52ee3e532b724c1ed3ab4344ac44/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-26T21:05:11+08:00" />
<meta property="article:modified_time" content="2021-10-26T21:05:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux 网卡 Bonding 配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="bonding_2"></a>一、bonding技术</h2> 
<p><strong>简介</strong><br>  <br>  bonding(绑定)是一种将n个物理网卡在系统内部抽象(绑定)成一个逻辑网卡的技术，能够提升网络吞吐量、实现网络冗余、负载等功能，有很多优势。<br>  Linux 系统下支持网络 Bonding,也叫 channel Bonding,它允许你将 2 个或者更多的网卡绑定到一起,成为一个新的逻辑网卡,从而实现故障切换或者负载均衡的功能,具体情况要取决于 mode 参数的具体配置。<br>  Linux系统bonding技术是内核层面实现的，它是一个内核模块(驱动)。使用它需要系统有这个模块, 我们可以modinfo命令查看下这个模块的信息, 一般来说都支持。</p> 
<pre><code class="prism language-bash">modinfo bonding
</code></pre> 
<p><strong>bonding的七种工作模式</strong></p> 
<p>bonding技术提供了七种工作模式，在使用的时候需要指定一种，每种有各自的优缺点.</p> 
<p>balance-rr (mode=0) 默认, 有高可用 (容错) 和负载均衡的功能, 需要交换机的配置，每块网卡轮询发包 (流量分发比较均衡).<br> active-backup (mode=1) 只有高可用 (容错) 功能, 不需要交换机配置, 这种模式只有一块网卡工作, 对外只有一个mac地址。缺点是端口利用率比较低<br> balance-xor (mode=2) 不常用<br> broadcast (mode=3) 不常用<br> 802.3ad (mode=4) IEEE 802.3ad 动态链路聚合，需要交换机配置，没用过<br> balance-tlb (mode=5) 不常用<br> balance-alb (mode=6) 有高可用 ( 容错 )和负载均衡的功能，不需要交换机配置 (流量分发到每个接口不是特别均衡)</p> 
<p>详细说明请参考网络上其他资料，了解每种模式的特点根据自己的选择就行, 一般会用到0、1、4、6这几种模式。</p> 
<h2><a id="RHEL6__Bonding__28"></a>二、RHEL6 下的 Bonding 配置:</h2> 
<p>在所有的 RHEL 版本下,目前都不支持在 NetworkManager 服务协作下实现 Bonding 配置.所以要么直接关闭 NetworkManager 服务,并取消其开机启动,要么在所有涉及 Bonding 的网卡配置文件中(包含ethx 或者 bondY),显式地添加一行:NM_CONTROLLED=no</p> 
<p>要配置网卡 Bonding,你必须在/etc/sysconfig/network-scripts/目录下建立逻辑网卡的配置文件 ifcfg-bondX,一般 X 从 0 开始,依次增加.具体的文件内容根据参与 Bonding 的网卡类型的不同又有所差别,以最最常见的 Ethernet 为例,配置文件大致是这样的:</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>bond0
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.0.1
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no
<span class="token assign-left variable">BONDING_OPTS</span><span class="token operator">=</span><span class="token string">"bonding parameters separated by spaces"</span> 
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>no
</code></pre> 
<p>BONDING_OPTS 这一行填写你需要的 Bonding 模式,比如 BONDING_OPTS=“miimon=100 mode=1” ,下面也会介绍几种常见的配置方式和它代表的意义,这里暂时不展开说明.为了方便称呼,我们把Bongding 后的逻辑网卡 bondX 称为主网卡(Master),参与 Bonding 的物理网卡 ethY 称为子网卡(Slave)。</p> 
<p>主网卡配置文件创建完毕以后,子网卡的配置文件也需要做相应的改变,主要是添加 MASTER=和SLAVE=这两项参数,我们假设 2 张子网卡为 eth0 和 eth1,那么他们的配置文件大致的样子会是这样子:</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>ethX
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">MASTER</span><span class="token operator">=</span>bond0
<span class="token assign-left variable">SLAVE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>no
</code></pre> 
<p>像这样,分别修改 ifcfg-eth0 和 ifcfg-eth1 配置文件,DEVICE=ethX 中的 X 用相应的值代替.然后我们重启网络服务。</p> 
<pre><code class="prism language-bash"><span class="token function">service</span> network restart
</code></pre> 
<p>这样子,子网卡为 eth0 和 eth1,主网卡为 bond0,模式为 mode 1 的网络 Bonding 就完成了。</p> 
<h5><a id="rhel6_bonding__67"></a>rhel6 bonding 实例展示</h5> 
<p>系统: rhel6<br> 网卡: eth2、eth3<br> bond0：10.200.100.90<br> 负载模式: mode1（active-backup） # 这里的负载模式为1，也就是主备模式.</p> 
<p>1、关闭和停止NetworkManager服务</p> 
<pre><code class="prism language-bash"><span class="token function">service</span>  NetworkManager stop
<span class="token function">chkconfig</span> NetworkManager off
</code></pre> 
<p>ps: 如果有装的话关闭它，如果报错说明没有装这个，那就不用管</p> 
<p>2、加载bonding模块</p> 
<pre><code class="prism language-bash">modprobe --first-time bonding
</code></pre> 
<p>3、创建基于bond0接口的配置文件</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@rhel6.6 network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-bond0</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>bond0
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">10.200</span>.100.90
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>no
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no
<span class="token assign-left variable">BONDING_OPTS</span><span class="token operator">=</span><span class="token string">"mode=1 miimon=200"</span>
</code></pre> 
<p>4、SLAVE网卡的配置文件</p> 
<p>两种子网卡的配置文件如下：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@rhel6.6 network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-eth2</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eth2
<span class="token comment">#HWADDR=14:58:D0:5A:0F:76</span>
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>no
<span class="token comment">#UUID=3b718bed-e8d4-4b64-afdb-455c8c3ccf91</span>
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token comment">#NM_CONTROLLED=yes</span>
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">MASTER</span><span class="token operator">=</span>bond0
<span class="token assign-left variable">SLAVE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no
<span class="token punctuation">[</span>root@rhel6.6 network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-eth3</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eth3
<span class="token comment">#HWADDR=14:58:D0:5A:0F:77</span>
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>no
<span class="token comment">#UUID=988835c2-8bfa-4788-9e8d-e898f68458f0</span>
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token comment">#NM_CONTROLLED=yes</span>
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">MASTER</span><span class="token operator">=</span>bond0
<span class="token assign-left variable">SLAVE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no
</code></pre> 
<p>5、bonding信息查看</p> 
<p>重启网络服务器后bonding生效</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@rhel6.6 network-scripts<span class="token punctuation">]</span><span class="token comment"># ip a</span>
<span class="token number">4</span>: eth2: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq master bond0 state UP qlen <span class="token number">1000</span>
    link/ether c4:34:6b:ac:5c:9e brd ff:ff:ff:ff:ff:ff
<span class="token number">5</span>: eth3: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq master bond0 state UP qlen <span class="token number">1000</span>
    link/infiniband a0:00:03:00:fe:80:00:00:00:00:00:00:00:02:c9:03:00:0a:6f:ba brd 00:ff:ff:ff:ff:12:40:1b:ff:ff:00:00:00:00:00:00:ff:ff:ff:ff
<span class="token number">10</span>: bond0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,MASTER,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP 
    link/ether c4:34:6b:ac:5c:9e brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">10.200</span>.100.90/24 brd <span class="token number">10.212</span>.225.255 scope global bond0
    inet6 fe80::c634:6bff:feac:5c9e/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token punctuation">[</span>root@rhel6.6 network-scripts<span class="token punctuation">]</span><span class="token comment"># cat /proc/net/bonding/bond0</span>
Ethernet Channel Bonding Driver: v3.6.0 <span class="token punctuation">(</span>September <span class="token number">26</span>, <span class="token number">2009</span><span class="token punctuation">)</span>

Bonding Mode: fault-tolerance <span class="token punctuation">(</span>active-backup<span class="token punctuation">)</span>			<span class="token comment"># bond0接口采用mode1</span>
Primary Slave: None
Currently Active Slave: eth2
MII Status: up
MII Polling Interval <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>: <span class="token number">200</span>
Up Delay <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>: <span class="token number">0</span>
Down Delay <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>: <span class="token number">0</span>

Slave Interface: eth2
MII Status: up
Speed: <span class="token number">1000</span> Mbps
Duplex: full
Link Failure Count: <span class="token number">0</span>
Permanent HW addr: c4:34:6b:ac:5c:9e
Slave queue ID: <span class="token number">0</span>

Slave Interface: eth3
MII Status: up
Speed: <span class="token number">1000</span> Mbps
Duplex: full
Link Failure Count: <span class="token number">0</span>
Permanent HW addr: c4:34:6b:ac:5c:9f
Slave queue ID: <span class="token number">0</span>
</code></pre> 
<p>进行高可用测试，拔掉其中的一条网线看丢包和延时情况, 然后在插回网线(模拟故障恢复)，再看丢包和延时的情况.</p> 
<h2><a id="RedHat7bonding_177"></a>三、RedHat7配置bonding</h2> 
<p>系统: Red Hat Enterprise Linux Server release 7.6 (Maipo)<br> 网卡: eno3、eno4<br> bonding：bond0<br> 负载模式: mode1（active-backup）</p> 
<p>服务器上两张物理网卡eno3和eno4, 通过绑定成一个逻辑网卡bond0，bonding模式选择mode1</p> 
<p>注: ip地址配置在bond0上, 物理网卡不需要配置ip地址.</p> 
<p>1、关闭和停止NetworkManager服务</p> 
<p>RedHat7默认安装了NetworkManager，在配置前先关掉NetworkManager服务，否则可能会对bonding或造成问题。</p> 
<pre><code class="prism language-bash">systemctl stop NetworkManager.service     <span class="token comment"># 停止NetworkManager服务</span>
systemctl disable NetworkManager.service  <span class="token comment"># 禁止开机启动NetworkManager服务</span>
</code></pre> 
<p>2、加载bonding模块</p> 
<pre><code class="prism language-bash">modprobe --first-time bonding
</code></pre> 
<p>没有提示说明加载成功, 如果出现modprobe: ERROR: could not insert ‘bonding’: Module already in kernel说明你已经加载了这个模块, 就不用管了</p> 
<p>你也可以使用lsmod | grep bonding查看模块是否被加载</p> 
<pre><code class="prism language-bash">lsmod <span class="token operator">|</span> <span class="token function">grep</span> bonding
bonding               <span class="token number">152656</span>  <span class="token number">0</span> 
</code></pre> 
<p>3、创建基于bond0接口的配置文件</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@ReHat7.6 network-scripts<span class="token punctuation">]</span><span class="token comment"># cat ifcfg-bond0</span>
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>bond0
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">10.211</span>.100.10
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>no
<span class="token assign-left variable">BONDING_OPTS</span><span class="token operator">=</span><span class="token string">"mode=1 miimon=200"</span>
</code></pre> 
<p>上面的BONDING_OPTS=“mode=1 miimon=200” 表示这里配置的工作模式是mode1, miimon表示监视网络链接的频度 (毫秒), 我们设置的是100毫秒, 根据你的需求也可以指定mode成其它的负载模式。</p> 
<p>4、修改eno3、eno4子接口的配置文件</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@ReHat7.6 <span class="token punctuation">]</span><span class="token comment"># cat ifcfg-eno3</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>eno3
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eno3
<span class="token assign-left variable">BROWSER_ONLY</span><span class="token operator">=</span>no
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">MASTER</span><span class="token operator">=</span>bond0
<span class="token assign-left variable">SLAVE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">UESCTL</span><span class="token operator">=</span>no
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>no
<span class="token punctuation">[</span>root@ReHat7.6 <span class="token punctuation">]</span><span class="token comment"># cat ifcfg-eno4</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>eno4
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eno4
<span class="token assign-left variable">BROWSER_ONLY</span><span class="token operator">=</span>no
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>none
<span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">MASTER</span><span class="token operator">=</span>bond0
<span class="token assign-left variable">SLAVE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">UESCTL</span><span class="token operator">=</span>no
<span class="token assign-left variable">NM_CONTROLLED</span><span class="token operator">=</span>no
</code></pre> 
<p>5、查看bonding信息</p> 
<p>重启网络服务</p> 
<pre><code class="prism language-bash">systemctl restart network
</code></pre> 
<p>查看bond0的接口状态信息 ( 如果报错说明没做成功，很有可能是bond0接口没起来)</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@ReHat7.6 network-scripts<span class="token punctuation">]</span><span class="token comment"># cat /proc/net/bonding/bond0</span>
Ethernet Channel Bonding Driver: v3.7.1 <span class="token punctuation">(</span>April <span class="token number">27</span>, <span class="token number">2011</span><span class="token punctuation">)</span>

Bonding Mode: fault-tolerance <span class="token punctuation">(</span>active-backup<span class="token punctuation">)</span>		// 绑定模式: 主备模式<span class="token punctuation">(</span>mode <span class="token number">1</span><span class="token punctuation">)</span>
Primary Slave: None
Currently Active Slave: eno4			// 当前活动接口
MII Status: up							// 接口状态: up<span class="token punctuation">(</span>MII是Media Independent Interface简称, 接口的意思<span class="token punctuation">)</span>
MII Polling Interval <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>: <span class="token number">200</span>		 	// 接口轮询的时间隔<span class="token punctuation">(</span>这里是200ms<span class="token punctuation">)</span>
Up Delay <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>: <span class="token number">0</span>
Down Delay <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>: <span class="token number">0</span>

Slave Interface: eno3					// Slave 接口，也就是受bond管控的接口
MII Status: up							// 接口状态: up<span class="token punctuation">(</span>MII是Media Independent Interface简称, 接口的意思<span class="token punctuation">)</span>
Speed: <span class="token number">1000</span> Mbps                         // 端口的速率是1000 Mpbs
Duplex: full							// 全双工
Link Failure Count: <span class="token number">0</span>					// 链接失败次数: <span class="token number">0</span>
Permanent HW addr: <span class="token number">74</span>:46:a0:f4:9f:c2     // 永久的MAC地址
Slave queue ID: <span class="token number">0</span>

Slave Interface: eno4
MII Status: up
Speed: <span class="token number">1000</span> Mbps
Duplex: full
Link Failure Count: <span class="token number">0</span>
Permanent HW addr: <span class="token number">74</span>:46:a0:f4:9f:c3
Slave queue ID: <span class="token number">0</span>
<span class="token punctuation">[</span>root@ReHat7.6 ~<span class="token punctuation">]</span><span class="token comment"># ip a</span>
<span class="token number">1</span>: eno3: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq master bond0 state UP group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">74</span>:46:a0:f4:9f:c2 brd ff:ff:ff:ff:ff:ff
<span class="token number">2</span>: eno4: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc mq master bond0 state UP group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">74</span>:46:a0:f4:9f:c2 brd ff:ff:ff:ff:ff:ff
<span class="token number">3</span>: bond0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,MASTER,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">74</span>:46:a0:f4:9f:c2 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">10.211</span>.100.10/24 brd <span class="token number">10.211</span>.139.255 scope global bond0
       valid_lft forever preferred_lft forever
</code></pre> 
<h2><a id="Bonding_ifenslave_305"></a>四、Bonding命令行管理工具 ifenslave</h2> 
<p>ifslave 可以绑定、分离和切换活动网卡，同样ifslave的使用需要内核支持bonding。</p> 
<pre><code class="prism language-bash"> modprobe bonding      // 加载内核模块  
 ifenslave bond0 eth0 eth1      // 绑定网卡
 <span class="token function">ifconfig</span> bond0 <span class="token number">192.168</span>.0.1 netmask <span class="token number">255.255</span>.0.0    // 配置IP
 ifenslave -c bond0 eth1      // 切换活动网卡到eth1
 ifenslave -d bond0 eth1     // 从bond0中移除eth1
</code></pre> 
<p>高可用测试中（插拔网线）发现：在mode=6模式下丢包1个, 恢复网络时( 网络插回去 ) 丢包在5-6个左右，说明高可用功能正常但恢复的时候丢包会比较多<br> 测试mode=1模式下丢包1个，恢复网络时( 网线插回去 ) 基本上没有丢包，说明高可用功能和恢复的时候都正常<br> mode6这种负载模式除了故障恢复的时候有丢包之外其它都挺好的，如果能够忽略这点的话可以这种模式；而mode1故障的切换和恢复都很快，基本没丢包和延时。但端口利用率比较低，因为这种主备的模式只有一张网卡在工作。</p> 
<p>参考：<br> http://blog.chinaunix.net/uid-31410005-id-5818605.html<br> https://www.cnblogs.com/dkblog/p/3613407.html<br> https://www.cnblogs.com/huangweimin/articles/6527058.html<br> https://www.cnblogs.com/dkblog/p/3613407.htmlLinux</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ead2baebff2c4e1d41404e0b15042a00/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">图形化渗透测试工具 -- GUI_Tools</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fc6e7f8316619e8fda4e47c735d18cd1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">GIT更新流程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>