<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>makefile 中c/c&#43;&#43;混编编译遇到的问题 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="makefile 中c/c&#43;&#43;混编编译遇到的问题" />
<meta property="og:description" content="makefile 中c/c&#43;&#43;混编编译遇到的问题 前提：三个文件server.c client.c wrapper.c，c风格编写的，server.c包含了c&#43;&#43;11的内容。mac os下面编译。
其中server.c包含了c&#43;&#43;11的内容，其他部分使用c风格的方式写的，为了以后扩展写了makefile编译，其中遇到了很多问题，花了很长时间来解决，记录如下：
编译命令是gcc/g&#43;&#43;，有clang的warning报错
clang: warning: treating ‘c’ input as ‘c&#43;&#43;’ when in C&#43;&#43; mode, this behavior is deprecated [-Wdeprecated]
一直以为gcc g&#43;&#43;没安装等等路径等有问题，导致有问题，实际上因为现在的操作系统，gcc g&#43;&#43;都是别名，真正连接的是clang，这个没问题
可以使用gcc -v clang -v查看下
这个warning本身是因为c&#43;&#43;程序用c编译，把.c改为.cpp即可解决
g&#43;&#43;的-std11的参数被忽略，导致程序编译不过
g&#43;&#43; wrapper.cpp server.cpp -std=c&#43;&#43;11 -o server 执行后server可以编译成功
但如下makefile编译不过
```bash CC = g&#43;&#43; CFLAGS = -std=c&#43;&#43;11 source = wrapper.cpp server.cpp sourcec = client.cpp objects = server.o wrapper.o objectc = client.o server:$(objects) $(CC) -std=c&#43;&#43;11 $(source) -o server -Wall -g 编译的时候指令显示如下：（少了std=c&#43;&#43;11，多了-c） c&#43;&#43; -c -o server." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/55d20755cb7fb4c74b1d4447ccd52629/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-07T19:37:37+08:00" />
<meta property="article:modified_time" content="2021-03-07T19:37:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">makefile 中c/c&#43;&#43;混编编译遇到的问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="makefile_cc_0"></a>makefile 中c/c++混编编译遇到的问题</h4> 
<p>前提：三个文件server.c client.c wrapper.c，c风格编写的，server.c包含了c++11的内容。mac os下面编译。<br> 其中server.c包含了c++11的内容，其他部分使用c风格的方式写的，为了以后扩展写了makefile编译，其中遇到了很多问题，花了很长时间来解决，记录如下：</p> 
<ol><li> <p>编译命令是gcc/g++，有clang的warning报错<br> clang: warning: treating ‘c’ input as ‘c++’ when in C++ mode, this behavior is deprecated [-Wdeprecated]</p> <p>一直以为gcc g++没安装等等路径等有问题，导致有问题，实际上因为现在的操作系统，gcc g++都是别名，真正连接的是clang，这个没问题<br> 可以使用gcc -v clang -v查看下<br> <img src="https://images2.imgbox.com/68/20/BeAeZD1o_o.png" alt="在这里插入图片描述"><br> 这个warning本身是因为c++程序用c编译，把.c改为.cpp即可解决</p> </li><li> <p>g++的-std11的参数被忽略，导致程序编译不过<br> g++ wrapper.cpp server.cpp -std=c++11 -o server 执行后server可以编译成功<br> 但如下makefile编译不过</p> </li></ol> 
<pre><code>```bash
CC = g++
CFLAGS = -std=c++11
source = wrapper.cpp server.cpp 
sourcec = client.cpp
objects = server.o wrapper.o
objectc = client.o
server:$(objects)
	$(CC)  -std=c++11 $(source) -o server -Wall -g 
编译的时候指令显示如下：（少了std=c++11，多了-c）
c++    -c -o server.o server.cpp
server.cpp:42:25: error: expected expression
        std::thread thr([count, &amp;buf, cfd](){
```

问题出在依赖objects此处改为依赖为source即可解决
或者改成如下：
</code></pre> 
<pre><code class="prism language-bash"><span class="token variable"><span class="token variable">$(</span>objects<span class="token variable">)</span></span><span class="token keyword">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">source</span><span class="token variable">)</span></span>
	<span class="token variable"><span class="token variable">$(</span>CC<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>CFLAGS<span class="token variable">)</span></span> -c  <span class="token variable"><span class="token variable">$(</span><span class="token function">source</span><span class="token variable">)</span></span> 

server:<span class="token variable"><span class="token variable">$(</span>objects<span class="token variable">)</span></span>
	<span class="token variable"><span class="token variable">$(</span>CC<span class="token variable">)</span></span>   <span class="token variable"><span class="token variable">$(</span>objects<span class="token variable">)</span></span> -o server -Wall -g 
</code></pre> 
<pre><code>让执行程序依赖.o,.cpp编译成.o

gcc的简单使用可以参考https://www.cnblogs.com/testlife007/p/6555404.html
</code></pre> 
<p>附录是最终的makefile</p> 
<pre><code class="prism language-bash">CC <span class="token operator">=</span> g++
CFLAGS <span class="token operator">=</span> -std<span class="token operator">=</span>c++11
<span class="token function">source</span> <span class="token operator">=</span> wrapper.cpp server.cpp 
sourcec <span class="token operator">=</span> client.cpp
objects <span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>patsubst %.cpp, %.o, <span class="token punctuation">$(</span>source<span class="token variable">)</span></span><span class="token punctuation">)</span>
objectc <span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>patsubst %.cpp, %.o, <span class="token punctuation">$(</span>sourcec<span class="token variable">)</span></span><span class="token punctuation">)</span>
headers <span class="token operator">=</span> ./head
all:server cli

<span class="token variable"><span class="token variable">$(</span>objects<span class="token variable">)</span></span><span class="token keyword">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">source</span><span class="token variable">)</span></span>
	<span class="token variable"><span class="token variable">$(</span>CC<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>CFLAGS<span class="token variable">)</span></span> -c  <span class="token variable"><span class="token variable">$(</span><span class="token function">source</span><span class="token variable">)</span></span> -I<span class="token variable"><span class="token variable">$(</span>headers<span class="token variable">)</span></span>

server:<span class="token variable"><span class="token variable">$(</span>objects<span class="token variable">)</span></span>
	<span class="token variable"><span class="token variable">$(</span>CC<span class="token variable">)</span></span>   <span class="token variable"><span class="token variable">$(</span>objects<span class="token variable">)</span></span> -o server -Wall -g 
	
cli:<span class="token variable"><span class="token variable">$(</span>objectc<span class="token variable">)</span></span>
	<span class="token variable"><span class="token variable">$(</span>CC<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>CFLAGS<span class="token variable">)</span></span> client.cpp -o cli -Wall -g

.PHONY:clean
clean:
	- <span class="token function">rm</span> server cli  server <span class="token variable"><span class="token variable">$(</span>object<span class="token variable">)</span></span>
	<span class="token function">rm</span>  -rf *.dSYM
	<span class="token function">rm</span> *.o

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/70dcec5b98ead3a36a2acc9fdc3e645c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python爬虫爬取糗事百科视频</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f476136930687daf7c3269455d3f8954/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">tp6实现商城后台登录功能</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>