<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Caused by: java.lang.SecurityException - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Caused by: java.lang.SecurityException" />
<meta property="og:description" content="01-02 03:56:52.751 6767 7344 E SurfaceFlinger: Permission Denial: can&#39;t access SurfaceFlinger pid=30533, uid=1000
01-02 03:56:52.753 30533 30533 D AndroidRuntime: Shutting down VM
01-02 03:56:52.757 30533 30533 E AndroidRuntime: *** FATAL EXCEPTION IN SYSTEM PROCESS: main
01-02 03:56:52.757 30533 30533 E AndroidRuntime: java.lang.RuntimeException: Error receiving broadcast Intent { act=android.intent.action.USER_SWITCHED flg=0x50000010 (has extras) } in com.android.server.accessibility.AccessibilityManagerService$2@5f50865
01-02 03:56:52.757 30533 30533 E AndroidRuntime: at android.app.LoadedApk$ReceiverDispatcher$Args.run(LoadedApk.java:1172)
01-02 03:56:52.757 30533 30533 E AndroidRuntime: at android." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/dbdd2e14a7d1e190f666b8d58b0de061/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-12-29T11:53:03+08:00" />
<meta property="article:modified_time" content="2017-12-29T11:53:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Caused by: java.lang.SecurityException</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>01-02 03:56:52.751  6767  7344 E SurfaceFlinger: Permission Denial: can't access SurfaceFlinger pid=30533, uid=1000<br>01-02 03:56:52.753 30533 30533 D AndroidRuntime: Shutting down VM<br></p> 
<p><br></p> 
<p>01-02 03:56:52.757 30533 30533 E AndroidRuntime: *** FATAL EXCEPTION IN SYSTEM PROCESS: main<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: java.lang.RuntimeException: Error receiving broadcast Intent { act=android.intent.action.USER_SWITCHED flg=0x50000010 (has extras) } in com.android.server.accessibility.AccessibilityManagerService$2@5f50865<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at android.app.LoadedApk$ReceiverDispatcher$Args.run(LoadedApk.java:1172)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at android.os.Handler.handleCallback(Handler.java:836)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at android.os.Handler.dispatchMessage(Handler.java:103)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at android.os.Looper.loop(Looper.java:203)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.server.SystemServer.run(SystemServer.java:436)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.server.SystemServer.main(SystemServer.java:290)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at java.lang.reflect.Method.invoke(Native Method)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:1063)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:924)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: Caused by: java.lang.SecurityException<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at android.os.BinderProxy.transactNative(Native Method)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at android.os.BinderProxy.transact(Binder.java:622)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.server.accessibility.DisplayAdjustmentUtils.setDaltonizerMode(DisplayAdjustmentUtils.java:160)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.server.accessibility.DisplayAdjustmentUtils.applyAdjustments(DisplayAdjustmentUtils.java:107)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.server.accessibility.AccessibilityManagerService.updateDisplayColorAdjustmentSettingsLocked(AccessibilityManagerService.java:1769)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.server.accessibility.AccessibilityManagerService.onUserStateChangedLocked(AccessibilityManagerService.java:1454)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.server.accessibility.AccessibilityManagerService.switchUser(AccessibilityManagerService.java:915)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.server.accessibility.AccessibilityManagerService.-wrap26(AccessibilityManagerService.java)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at com.android.server.accessibility.AccessibilityManagerService$2.onReceive(AccessibilityManagerService.java:383)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>at android.app.LoadedApk$ReceiverDispatcher$Args.run(LoadedApk.java:1162)<br>01-02 03:56:52.757 30533 30533 E AndroidRuntime: <span style="white-space:pre;"> </span>... 8 more<br></p> 
<p><br></p> 
<p><br></p> 
<p>AccessibilityManagerService   接收到广播    android.intent.action.USER_SWITCHED <br></p> 
<p>调用</p> 
<p></p> 
<pre style="background-color:rgb(255,255,255);font-family:'宋体';font-size:10.5pt;"><span style="color:rgb(0,0,128);"><strong>private static void </strong></span>setDaltonizerMode(<span style="color:rgb(0,0,128);"><strong>int </strong></span>mode) {
    <span style="color:rgb(0,0,128);"><strong>try </strong></span>{
        <span style="color:rgb(0,0,128);"><strong>final </strong></span>IBinder flinger = ServiceManager.<span style="font-style:italic;">getService</span>(<span style="color:rgb(0,128,0);"><strong>"SurfaceFlinger"</strong></span>);
        <span style="color:rgb(0,0,128);"><strong>if </strong></span>(flinger != <span style="color:rgb(0,0,128);"><strong>null</strong></span>) {
            <span style="color:rgb(0,0,128);"><strong>final </strong></span>Parcel data = Parcel.<span style="font-style:italic;">obtain</span>();
            data.writeInterfaceToken(<span style="color:rgb(0,128,0);"><strong>"android.ui.ISurfaceComposer"</strong></span>);
            data.writeInt(mode);
            flinger.transact(<span style="color:rgb(0,0,255);">1014</span>, data, <span style="color:rgb(0,0,128);"><strong>null</strong></span>, <span style="color:rgb(0,0,255);">0</span>);
            data.recycle();
        }
    } <span style="color:rgb(0,0,128);"><strong>catch </strong></span>(RemoteException ex) {
        Slog.<span style="font-style:italic;">e</span>(<span style="color:rgb(102,14,122);"><strong><em>LOG_TAG</em></strong></span>, <span style="color:rgb(0,128,0);"><strong>"Failed to set Daltonizer mode"</strong></span>, ex);
    }
}</pre> 
<pre style="background-color:rgb(255,255,255);font-family:'宋体';font-size:10.5pt;"></pre> 
<pre style="background-color:rgb(255,255,255);font-family:'宋体';font-size:10.5pt;">仅接着调用 setDaltonizerMode ，这个函数binder 调用 SurfaceFlinger ,相当客户端调用transact  </pre> 
<pre style="background-color:rgb(255,255,255);font-family:'宋体';font-size:10.5pt;"></pre> 
<pre style="background-color:rgb(255,255,255);font-family:'宋体';font-size:10.5pt;">frameworks\base\core\java\android\os\Binder.java 中</pre> 
<pre style="background-color:rgb(255,255,255);font-family:'宋体';font-size:10.5pt;">BinderProxy.transact -&gt;</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">transactNative -&gt;</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">frameworks/base/core/jni/android_util_Binder.cpp </pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">{"transactNative",      "(ILandroid/os/Parcel;Landroid/os/Parcel;I)Z", (void*)android_os_BinderProxy_transact},
</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">--&gt;</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">调用</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">status_t err = target-&gt;transact(code, *data, reply, flags);
</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';"></pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">返回结果</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">signalExceptionForError(env, obj, err, true /*canThrowRemoteException*/, data-&gt;dataSize()){
</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';"></pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">        case PERMISSION_DENIED:
            jniThrowException(env, "java/lang/SecurityException", NULL);
            break;
</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';"></pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">}</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">--&gt;</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">frameworks/native/services/surfaceflinger/SurfaceFlinger.cpp
</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';"></pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">status_t SurfaceFlinger::onTransact(
    uint32_t code, const Parcel&amp; data, Parcel* reply, uint32_t flags)
{
    switch (code) {
        case CREATE_CONNECTION:
        case CREATE_DISPLAY:
        case SET_TRANSACTION_STATE:
        case BOOT_FINISHED:
        case CLEAR_ANIMATION_FRAME_STATS:
        case GET_ANIMATION_FRAME_STATS:
        case SET_POWER_MODE:
        case GET_HDR_CAPABILITIES:
        {
            // codes that require permission check
            IPCThreadState* ipc = IPCThreadState::self();
            const int pid = ipc-&gt;getCallingPid();
            const int uid = ipc-&gt;getCallingUid();
            if ((uid != AID_GRAPHICS &amp;&amp; uid != AID_SYSTEM) &amp;&amp;
                    !PermissionCache::checkPermission(sAccessSurfaceFlinger, pid, uid)) {
                ALOGE("Permission Denial: "
                        "can't access SurfaceFlinger pid=%d, uid=%d", pid, uid);
                return PERMISSION_DENIED;
            }
            break;
        }
</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';"></pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">    status_t err = BnSurfaceComposer::onTransact(code, data, reply, flags);
    if (err == UNKNOWN_TRANSACTION || err == PERMISSION_DENIED) {
        CHECK_INTERFACE(ISurfaceComposer, data, reply);
        if (CC_UNLIKELY(!PermissionCache::checkCallingPermission(sHardwareTest))) {
            IPCThreadState* ipc = IPCThreadState::self();
            const int pid = ipc-&gt;getCallingPid();
            const int uid = ipc-&gt;getCallingUid();
            ALOGE("Permission Denial: "
                    "can't access SurfaceFlinger pid=%d, uid=%d", pid, uid);
            return PERMISSION_DENIED;
        }
        int n;
</pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';"></pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';">}</pre> 
<p></p> 
<p>服务端放回堆栈：</p> 
<p>05-02 12:41:04.750136   803  3040 W Binder  : Outgoing transactions from this process must be FLAG_ONEWAY<br>05-02 12:41:04.750136   803  3040 W Binder  : java.lang.Throwable<br>05-02 12:41:04.750136   803  3040 W Binder  : <span style="white-space:pre;"> </span>at android.os.BinderProxy.transact(Binder.java:752)<br>05-02 12:41:04.750136   803  3040 W Binder  : <span style="white-space:pre;"> </span>at android.app.assist.AssistStructure$ParcelTransferReader.fetchData(AssistStructure.java:407)<br>05-02 12:41:04.750136   803  3040 W Binder  : <span style="white-space:pre;"> </span>at android.app.assist.AssistStructure$ParcelTransferReader.go(AssistStructure.java:343)<br>05-02 12:41:04.750136   803  3040 W Binder  : <span style="white-space:pre;"> </span>at android.app.assist.AssistStructure.ensureData(AssistStructure.java:2100)<br>05-02 12:41:04.750136   803  3040 W Binder  : <span style="white-space:pre;"> </span>at com.android.server.autofill.Session$1.send(Session.java:227)<br>05-02 12:41:04.750136   803  3040 W Binder  : <span style="white-space:pre;"> </span>at com.android.server.am.ActivityManagerService.reportAssistContextExtras(ActivityManagerService.java:13805)<br>05-02 12:41:04.750136   803  3040 W Binder  : <span style="white-space:pre;"> </span>at android.app.IActivityManager$Stub.onTransact(IActivityManager.java:2472)<br>05-02 12:41:04.750136   803  3040 W Binder  : <span style="white-space:pre;"> </span>at com.android.server.am.ActivityManagerService.onTransact(ActivityManagerService.java:3241)<br>05-02 12:41:04.750136   803  3040 W Binder  : <span style="white-space:pre;"> </span>at android.os.Binder.execTransact(Binder.java:697)<br></p> 
<p><br></p> 
<p><br></p> 
<p>客户端调用堆栈：</p> 
<p>05-02 12:44:54.842527 15153 12463 W Monkey  : // Build Time: 1524579696000<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // java.lang.NullPointerException: Attempt to read from field 'android.service.autofill.FillRequest com.android.server.autofill.RemoteFillService$PendingFillRequest.mRequest' on a null object reference<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at android.os.Parcel.readException(Parcel.java:2010)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at android.os.Parcel.readException(Parcel.java:1950)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at android.app.IActivityManager$Stub$Proxy.reportAssistContextExtras(IActivityManager.java:7673)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at android.app.ActivityThread.handleRequestAssistContextExtras(ActivityThread.java:3070)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1832)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at android.os.Handler.dispatchMessage(Handler.java:106)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at android.os.Looper.loop(Looper.java:164)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at android.app.ActivityThread.main(ActivityThread.java:6565)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at java.lang.reflect.Method.invoke(Native Method)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:438)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <span style="white-space:pre;"> </span>at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:857)<br>05-02 12:44:54.843386 15153 12463 W Monkey  : // <br></p> 
<p><br></p> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';"></pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';"></pre> 
<pre style="background-color:rgb(255,255,255);font-size:10.5pt;font-family:'宋体';"></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/18a44f50ccaad18126e7245e4bcfb303/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安卓使用友盟推送问题总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a32dce17462d941697c96dbf06feea61/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">win10系统安装mscomm32.ocx控件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>