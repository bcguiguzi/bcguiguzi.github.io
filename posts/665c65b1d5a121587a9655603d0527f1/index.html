<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux虚拟机网卡bond配置 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux虚拟机网卡bond配置" />
<meta property="og:description" content=" 文章目录 前言一、bond概述1、bond概念2、bond优点 二、bond模式1、mode=0 (round-robin)2、mode=1 (active-backup)3、mode=2（XOR）4、mode=3（broadcast）5、mode=4（802.3ad）6、mode=5（balance-tlb）7、mode=6（balance-alb） 三、案例操作1、添加网卡2、修改网卡的配置文件3、添加配置文件4、关闭NetworkManager服务5、重启网络6、获取状态7、开启httpd服务访问网页8、关闭网卡查询数据流向关闭ens33关闭ens37 前言 我们日常访问网络的时候可能会出现信号不佳、网络丢失等问题，所以一张网卡访问网络的时候可能会出现问题。就像手机的双卡双待模式，虚拟机的网卡也可以使用多张网卡，一般常见的服务器都有2~4张网卡来进行网络服务的运行。
一、bond概述 1、bond概念 bond是将多块物理网卡虚拟为一块逻辑网卡，使多块网卡看起来像一块网卡，通过主从的配置来讲进行网络的运行维护
2、bond优点 linux系统下配置bond，通过网卡绑定可增加服务器可靠性，同时可增加网络带宽，提供稳定的网络服务
二、bond模式 网卡bonding模式共有0、1、2、3、4、5、6共7种，其中mode1、5、6不需要要交换机设置，mode0、2、3、4需要交换机设置
1、mode=0 (round-robin) 轮询策略，数据包在每个slave网卡上都进行数据传输，以逐包形式在两个物理网卡上转发数据。这种模式提供了数据的负载均衡和容错能力。
2、mode=1 (active-backup) 主备策略，只有一个slave被激活，只有当active的slave的接口down时，才会激活其它slave接口。主备模式下发生一次故障切换，在新激活的slave接口上会发送一个或者多个gratuitous ARP。主salve接口上以及配置在接口上的所有VLAN接口都会发送gratuitous ARP，需要在这些接口上配置了至少一个IP地址。VLAN接口上发送的的gratuitous ARP将会附上适当的VLAN id。本模式提供容错能力。
3、mode=2（XOR） 基于所选择的hash策略，本模式也提供负载均衡和容错能力
4、mode=3（broadcast） 广播策略，向所有的slave接口发送数据包，本模式提供容错能力
5、mode=4（802.3ad） 动态链路聚合，根据802.3ad标准利用所有的slave建立聚合链路。slave接口的出口取决于传输的hash策略，默认策略是简单的XOR策略，而hash策略则可以通xmit_hash_policy选项配置。
前提：每个slave网卡支持ethtool获取速率和双工状态
6、mode=5（balance-tlb） 自适应传输负载均衡：根据每个slave的负载(相对速度)决定从哪个接口发送数据包，从当前接口接收数据包。如果接收的slave接口故障，其它slave接口将接管它的mac地址继续接收。
前提：每个slave网卡支持ethtool获取速率。
7、mode=6（balance-alb） 自适应负载均衡：
前提：每个slave网卡支持ethtool获取速率
每个slave网卡支持启用时重新设置硬件地址 三、案例操作 将两张网卡绑定配置成一张虚拟网卡
1、添加网卡 2、修改网卡的配置文件 3、添加配置文件 4、关闭NetworkManager服务 5、重启网络 6、获取状态 7、开启httpd服务访问网页 使用ab命令来进行压力测试，模拟有多个IP登录并访问网页
8、关闭网卡查询数据流向 可以通过sar命令进行数据流向的查询
关闭ens33 关闭ens37 " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/665c65b1d5a121587a9655603d0527f1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-13T16:27:15+08:00" />
<meta property="article:modified_time" content="2022-05-13T16:27:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux虚拟机网卡bond配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_7" rel="nofollow">前言</a></li><li><a href="#bond_13" rel="nofollow">一、bond概述</a></li><li><ul><li><a href="#1bond_14" rel="nofollow">1、bond概念</a></li><li><a href="#2bond_16" rel="nofollow">2、bond优点</a></li></ul> 
  </li><li><a href="#bond_19" rel="nofollow">二、bond模式</a></li><li><ul><li><a href="#1mode0__roundrobin_22" rel="nofollow">1、mode=0 (round-robin)</a></li><li><a href="#2mode1__activebackup_26" rel="nofollow">2、mode=1 (active-backup)</a></li><li><a href="#3mode2XOR_30" rel="nofollow">3、mode=2（XOR）</a></li><li><a href="#4mode3broadcast_34" rel="nofollow">4、mode=3（broadcast）</a></li><li><a href="#5mode48023ad_38" rel="nofollow">5、mode=4（802.3ad）</a></li><li><a href="#6mode5balancetlb_43" rel="nofollow">6、mode=5（balance-tlb）</a></li><li><a href="#7mode6balancealb_49" rel="nofollow">7、mode=6（balance-alb）</a></li></ul> 
  </li><li><a href="#_57" rel="nofollow">三、案例操作</a></li><li><ul><li><a href="#1_59" rel="nofollow">1、添加网卡</a></li><li><a href="#2_61" rel="nofollow">2、修改网卡的配置文件</a></li><li><a href="#3_65" rel="nofollow">3、添加配置文件</a></li><li><a href="#4NetworkManager_67" rel="nofollow">4、关闭NetworkManager服务</a></li><li><a href="#5_69" rel="nofollow">5、重启网络</a></li><li><a href="#6_71" rel="nofollow">6、获取状态</a></li><li><a href="#7httpd_74" rel="nofollow">7、开启httpd服务访问网页</a></li><li><a href="#8_77" rel="nofollow">8、关闭网卡查询数据流向</a></li><li><ul><li><a href="#ens33_79" rel="nofollow">关闭ens33</a></li><li><a href="#ens37_81" rel="nofollow">关闭ens37</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_7"></a>前言</h2> 
<p>我们日常访问网络的时候可能会出现信号不佳、网络丢失等问题，所以一张网卡访问网络的时候可能会出现问题。就像手机的双卡双待模式，虚拟机的网卡也可以使用多张网卡，一般常见的服务器都有2~4张网卡来进行网络服务的运行。</p> 
<hr> 
<h2><a id="bond_13"></a>一、bond概述</h2> 
<h3><a id="1bond_14"></a>1、bond概念</h3> 
<p>bond是将多块物理网卡虚拟为一块逻辑网卡，使多块网卡看起来像一块网卡，通过主从的配置来讲进行网络的运行维护</p> 
<h3><a id="2bond_16"></a>2、bond优点</h3> 
<p>linux系统下配置bond，通过网卡绑定可增加服务器可靠性，同时可增加网络带宽，提供稳定的网络服务</p> 
<h2><a id="bond_19"></a>二、bond模式</h2> 
<p>网卡bonding模式共有0、1、2、3、4、5、6共7种，其中mode1、5、6不需要要交换机设置，mode0、2、3、4需要交换机设置</p> 
<h3><a id="1mode0__roundrobin_22"></a>1、mode=0 (round-robin)</h3> 
<p>轮询策略，数据包在每个slave网卡上都进行数据传输，以逐包形式在两个物理网卡上转发数据。这种模式提供了数据的负载均衡和容错能力。</p> 
<h3><a id="2mode1__activebackup_26"></a>2、mode=1 (active-backup)</h3> 
<p>主备策略，只有一个slave被激活，只有当active的slave的接口down时，才会激活其它slave接口。主备模式下发生一次故障切换，在新激活的slave接口上会发送一个或者多个gratuitous ARP。主salve接口上以及配置在接口上的所有VLAN接口都会发送gratuitous ARP，需要在这些接口上配置了至少一个IP地址。VLAN接口上发送的的gratuitous ARP将会附上适当的VLAN id。本模式提供容错能力。</p> 
<h3><a id="3mode2XOR_30"></a>3、mode=2（XOR）</h3> 
<p>基于所选择的hash策略，本模式也提供负载均衡和容错能力</p> 
<h3><a id="4mode3broadcast_34"></a>4、mode=3（broadcast）</h3> 
<p>广播策略，向所有的slave接口发送数据包，本模式提供容错能力</p> 
<h3><a id="5mode48023ad_38"></a>5、mode=4（802.3ad）</h3> 
<p>动态链路聚合，根据802.3ad标准利用所有的slave建立聚合链路。slave接口的出口取决于传输的hash策略，默认策略是简单的XOR策略，而hash策略则可以通xmit_hash_policy选项配置。</p> 
<p>前提：每个slave网卡支持ethtool获取速率和双工状态</p> 
<h3><a id="6mode5balancetlb_43"></a>6、mode=5（balance-tlb）</h3> 
<p>自适应传输负载均衡：根据每个slave的负载(相对速度)决定从哪个接口发送数据包，从当前接口接收数据包。如果接收的slave接口故障，其它slave接口将接管它的mac地址继续接收。</p> 
<p>前提：每个slave网卡支持ethtool获取速率。</p> 
<h3><a id="7mode6balancealb_49"></a>7、mode=6（balance-alb）</h3> 
<p>自适应负载均衡：</p> 
<p>前提：每个slave网卡支持ethtool获取速率</p> 
<pre><code>      每个slave网卡支持启用时重新设置硬件地址
</code></pre> 
<hr> 
<h2><a id="_57"></a>三、案例操作</h2> 
<p>将两张网卡绑定配置成一张虚拟网卡</p> 
<h3><a id="1_59"></a>1、添加网卡</h3> 
<p><img src="https://images2.imgbox.com/0e/a3/euj9U9Of_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_61"></a>2、修改网卡的配置文件</h3> 
<p><img src="https://images2.imgbox.com/2d/a1/akmSq8QU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/28/13/sHzbRxfA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c5/4a/XVWorZQY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_65"></a>3、添加配置文件</h3> 
<p><img src="https://images2.imgbox.com/b5/5e/VOlPSGK9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4NetworkManager_67"></a>4、关闭NetworkManager服务</h3> 
<p><img src="https://images2.imgbox.com/43/05/aFygldXQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_69"></a>5、重启网络</h3> 
<p><img src="https://images2.imgbox.com/57/92/XuzJw2LT_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6_71"></a>6、获取状态</h3> 
<p><img src="https://images2.imgbox.com/a1/7e/jfmqtpPH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cf/56/YYXrhdFW_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7httpd_74"></a>7、开启httpd服务访问网页</h3> 
<p>使用ab命令来进行压力测试，模拟有多个IP登录并访问网页<br> <img src="https://images2.imgbox.com/15/60/FXlbtotR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="8_77"></a>8、关闭网卡查询数据流向</h3> 
<p>可以通过sar命令进行数据流向的查询</p> 
<h4><a id="ens33_79"></a>关闭ens33</h4> 
<p><img src="https://images2.imgbox.com/f8/d8/poSJP4xK_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="ens37_81"></a>关闭ens37</h4> 
<p><img src="https://images2.imgbox.com/5d/7b/PhQ5963u_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/37f26a25d61bc8f900b3effba4d030d1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vmware安装配置CentOS完整过程--linux环境配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f01d0bf21d6c9b85baee97d2735de2f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">win7下cuda8.0安装跑gpu版tensorflow</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>