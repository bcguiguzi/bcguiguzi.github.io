<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>clickhouse笔记01--快速部署clickhouse - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="clickhouse笔记01--快速部署clickhouse" />
<meta property="og:description" content="clickhouse笔记01--快速部署clickhouse 1 介绍2 部署测试2.1 准备配置2.2 启动服务2.3 测试 3 注意事项4 说明 1 介绍 ClickHouse是一个用于联机分析(OLAP)的列式数据库管理系统(DBMS)，当前已经被很多大公司使用。
Clickhouse 是一款真正的列式数据库管理系统，具备数据压缩、数据的磁盘存储、多核心并行处理、多服务器分布式处理、支持SQL、向量引擎、实时的数据更新、索引、适合在线查询、支持近似计算、Adaptive Join Algorithm、支持数据复制和数据完整性、角色的访问控制 等特性。更多介绍信息可以参考 clickhouse 官方文档
笔者也是初次使用 clickhouse，因此将其部署方法和注意事项贴在此处，以方便有需要的小伙伴学习。
2 部署测试 2.1 准备配置 在 clickhouse 稳定版本安装包 准备最新稳定安装包，笔者准备的为 22.2.2.1 版本.
1) 下载安装包 clickhouse-client-22.2.2.1.tgz clickhouse-common-static-22.2.2.1.tgz clickhouse-common-static-dbg-22.2.2.1.tgz clickhouse-server-22.2.2.1.tgz 2）解压安装包 tar -xzvf &#34;clickhouse-common-static-22.2.2.1.tgz&#34; sudo &#34;clickhouse-common-static-22.2.2.1/install/doinst.sh&#34; tar -xzvf &#34;clickhouse-common-static-dbg-22.2.2.1.tgz&#34; sudo &#34;clickhouse-common-static-dbg-22.2.2.1/install/doinst.sh&#34; tar -xzvf &#34;clickhouse-server-22.2.2.1.tgz&#34; sudo &#34;clickhouse-server-22.2.2.1/install/doinst.sh&#34; tar -xzvf &#34;clickhouse-client-22.2.2.1.tgz&#34; sudo &#34;clickhouse-client-22.2.2.1/install/doinst.sh&#34; 3) vim /etc/clickhouse-server/config.xml 注释掉 listen_host 即可, 若为 ipv6 就注释第一个，若为 ipv4 就注释第二个，不注释掉的话只能在本机访问了 &lt;listen_host&gt;::&lt;/listen_host&gt; &lt;listen_host&gt;0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/f6a740b7b3003b85aba4f43ec80a5c51/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-10T11:08:19+08:00" />
<meta property="article:modified_time" content="2022-07-10T11:08:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">clickhouse笔记01--快速部署clickhouse</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>clickhouse笔记01--快速部署clickhouse</h4> 
 <ul><li><a href="#1__2" rel="nofollow">1 介绍</a></li><li><a href="#2__8" rel="nofollow">2 部署测试</a></li><li><ul><li><a href="#21__9" rel="nofollow">2.1 准备配置</a></li><li><a href="#22__38" rel="nofollow">2.2 启动服务</a></li><li><a href="#23__67" rel="nofollow">2.3 测试</a></li></ul> 
  </li><li><a href="#3__162" rel="nofollow">3 注意事项</a></li><li><a href="#4__166" rel="nofollow">4 说明</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__2"></a>1 介绍</h2> 
<p>ClickHouse是一个用于联机分析(OLAP)的列式数据库管理系统(DBMS)，当前已经被很多大公司使用。<br> Clickhouse 是一款真正的列式数据库管理系统，具备数据压缩、数据的磁盘存储、多核心并行处理、多服务器分布式处理、支持SQL、向量引擎、实时的数据更新、索引、适合在线查询、支持近似计算、Adaptive Join Algorithm、支持数据复制和数据完整性、角色的访问控制 等特性。更多介绍信息可以参考 <a href="https://clickhouse.com/docs/zh/" rel="nofollow">clickhouse 官方文档</a></p> 
<p>笔者也是初次使用 clickhouse，因此将其部署方法和注意事项贴在此处，以方便有需要的小伙伴学习。</p> 
<h2><a id="2__8"></a>2 部署测试</h2> 
<h3><a id="21__9"></a>2.1 准备配置</h3> 
<p>在 <a href="https://repo.clickhouse.com/tgz/stable/" rel="nofollow">clickhouse 稳定版本安装包</a> 准备最新稳定安装包，笔者准备的为 22.2.2.1 版本.</p> 
<pre><code class="prism language-bash"><span class="token number">1</span><span class="token punctuation">)</span> 下载安装包
clickhouse-client-22.2.2.1.tgz  
clickhouse-common-static-22.2.2.1.tgz  
clickhouse-common-static-dbg-22.2.2.1.tgz  
clickhouse-server-22.2.2.1.tgz

<span class="token number">2</span>）解压安装包
<span class="token function">tar</span> -xzvf <span class="token string">"clickhouse-common-static-22.2.2.1.tgz"</span>
<span class="token function">sudo</span> <span class="token string">"clickhouse-common-static-22.2.2.1/install/doinst.sh"</span>

<span class="token function">tar</span> -xzvf <span class="token string">"clickhouse-common-static-dbg-22.2.2.1.tgz"</span>
<span class="token function">sudo</span> <span class="token string">"clickhouse-common-static-dbg-22.2.2.1/install/doinst.sh"</span>

<span class="token function">tar</span> -xzvf <span class="token string">"clickhouse-server-22.2.2.1.tgz"</span>
<span class="token function">sudo</span> <span class="token string">"clickhouse-server-22.2.2.1/install/doinst.sh"</span>

<span class="token function">tar</span> -xzvf <span class="token string">"clickhouse-client-22.2.2.1.tgz"</span>
<span class="token function">sudo</span> <span class="token string">"clickhouse-client-22.2.2.1/install/doinst.sh"</span>

<span class="token number">3</span><span class="token punctuation">)</span> <span class="token function">vim</span> /etc/clickhouse-server/config.xml 
注释掉 listen_host 即可, 若为 ipv6 就注释第一个，若为 ipv4 就注释第二个，不注释掉的话只能在本机访问了

<span class="token operator">&lt;</span>listen_host<span class="token operator">&gt;</span>::<span class="token operator">&lt;</span>/listen_host<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>listen_host<span class="token operator">&gt;</span><span class="token number">0.0</span>.0.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/listen_host<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="22__38"></a>2.2 启动服务</h3> 
<pre><code class="prism language-bash"><span class="token comment"># /etc/init.d/clickhouse-server start</span>
<span class="token comment"># /etc/init.d/clickhouse-server status</span>
Now there is no clickhouse-server process.

执行命令后，发现服务并未启动，查看 /etc/init.d/clickhouse-server 后发现该服务使用 clickhouse 用户启动，因此需要新建该用户，创建先关文件夹，并授权给 clickhouse 用户

创建clickhouse,此处直接把密码也设置为clickhouse
<span class="token comment"># adduser --home /home/clickhouse clickhouse </span>
创建核心目录
<span class="token comment"># mkdir  -p /var/lib/clickhouse</span>
<span class="token comment"># chown clickhouse:clickhouse -R /var/lib/clickhouse </span>
<span class="token comment"># mkdir -p /var/log/clickhouse-server</span>
<span class="token comment"># chown clickhouse:clickhouse -R /var/log/clickhouse-server</span>

再次执行命令发现服务正常启动：
<span class="token comment"># /etc/init.d/clickhouse-server start</span>
<span class="token comment"># /etc/init.d/clickhouse-server status</span>
/var/run/clickhouse-server/clickhouse-server.pid <span class="token function">file</span> exists and contains pid <span class="token operator">=</span> <span class="token number">67486</span>.
The process with pid <span class="token operator">=</span> <span class="token number">67486</span> is running.
</code></pre> 
<p>1 动服务后，您可以使用命令行客户端连接到它: clickhouse-client<br> <img src="https://images2.imgbox.com/65/66/NqdrJlZw_o.png" alt="在这里插入图片描述"><br> 2 也可以通过 curl http://192.168.2.136:8123 来查看服务是否ok，curl 返回 Ok.<br> 3 也可以直接通过 mysql客户端连接 clickhouse， mysql -udefault -h192.168.2.136 -P9004<br> 连接后就像平时查看sql 数据库一样访问数据即可。</p> 
<h3><a id="23__67"></a>2.3 测试</h3> 
<ol><li>下载数据集(4.5Gb)<pre><code class="prism language-bash"><span class="token function">wget</span> http://prod.publicdata.landregistry.gov.uk.s3-website-eu-west-1.amazonaws.com/pp-complete.csv
</code></pre> </li><li>创建表<pre><code class="prism language-bash">$ clickhouse-cliet
<span class="token builtin class-name">:</span><span class="token punctuation">)</span> use default<span class="token punctuation">;</span>
<span class="token builtin class-name">:</span><span class="token punctuation">)</span> 
CREATE TABLE uk_price_paid
<span class="token punctuation">(</span>
    price UInt32,
    <span class="token function">date</span> Date,
    postcode1 LowCardinality<span class="token punctuation">(</span>String<span class="token punctuation">)</span>,
    postcode2 LowCardinality<span class="token punctuation">(</span>String<span class="token punctuation">)</span>,
    <span class="token builtin class-name">type</span> Enum8<span class="token punctuation">(</span><span class="token string">'terraced'</span> <span class="token operator">=</span> <span class="token number">1</span>, <span class="token string">'semi-detached'</span> <span class="token operator">=</span> <span class="token number">2</span>, <span class="token string">'detached'</span> <span class="token operator">=</span> <span class="token number">3</span>, <span class="token string">'flat'</span> <span class="token operator">=</span> <span class="token number">4</span>, <span class="token string">'other'</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>,
    is_new UInt8,
    duration Enum8<span class="token punctuation">(</span><span class="token string">'freehold'</span> <span class="token operator">=</span> <span class="token number">1</span>, <span class="token string">'leasehold'</span> <span class="token operator">=</span> <span class="token number">2</span>, <span class="token string">'unknown'</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>,
    addr1 String,
    addr2 String,
    street LowCardinality<span class="token punctuation">(</span>String<span class="token punctuation">)</span>,
    locality LowCardinality<span class="token punctuation">(</span>String<span class="token punctuation">)</span>,
    town LowCardinality<span class="token punctuation">(</span>String<span class="token punctuation">)</span>,
    district LowCardinality<span class="token punctuation">(</span>String<span class="token punctuation">)</span>,
    county LowCardinality<span class="token punctuation">(</span>String<span class="token punctuation">)</span>,
    category UInt8
<span class="token punctuation">)</span> ENGINE <span class="token operator">=</span> MergeTree ORDER BY <span class="token punctuation">(</span>postcode1, postcode2, addr1, addr2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li></ol> 
<ol start="3"><li>预处理 &amp; 导入数据<pre><code class="prism language-bash">clickhouse-local --input-format CSV --structure <span class="token string">'
    uuid String,
    price UInt32,
    time DateTime,
    postcode String,
    a String,
    b String,
    c String,
    addr1 String,
    addr2 String,
    street String,
    locality String,
    town String,
    district String,
    county String,
    d String,
    e String
'</span> --query <span class="token string">"
    WITH splitByChar(' ', postcode) AS p
    SELECT
        price,
        toDate(time) AS date,
        p[1] AS postcode1,
        p[2] AS postcode2,
        transform(a, ['T', 'S', 'D', 'F', 'O'], ['terraced', 'semi-detached', 'detached', 'flat', 'other']) AS type,
        b = 'Y' AS is_new,
        transform(c, ['F', 'L', 'U'], ['freehold', 'leasehold', 'unknown']) AS duration,
        addr1,
        addr2,
        street,
        locality,
        town,
        district,
        county,
        d = 'B' AS category
    FROM table"</span> --date_time_input_format best_effort <span class="token operator">&lt;</span> pp-complete.csv <span class="token operator">|</span> clickhouse-client --query <span class="token string">"INSERT INTO uk_price_paid FORMAT TSV"</span>
</code></pre> </li></ol> 
<ol start="4"><li>验证数据<pre><code class="prism language-bash"><span class="token number">4.1</span> 查看数据条数
<span class="token builtin class-name">:</span><span class="token punctuation">)</span> SELECT count<span class="token punctuation">(</span><span class="token punctuation">)</span> FROM uk_price_paid<span class="token punctuation">;</span>

SELECT count<span class="token punctuation">(</span><span class="token punctuation">)</span>
FROM uk_price_paid
Query id: 828475ce-ad80-45de-8ed2-4c9f6fd8e871
┌──count<span class="token punctuation">(</span><span class="token punctuation">)</span>─┐
│ <span class="token number">27265985</span> │
└──────────┘
<span class="token number">1</span> rows <span class="token keyword">in</span> set. Elapsed: <span class="token number">0.004</span> sec.

<span class="token number">4.2</span> 查看占用存储大小
<span class="token builtin class-name">:</span><span class="token punctuation">)</span> SELECT formatReadableSize<span class="token punctuation">(</span>total_bytes<span class="token punctuation">)</span> FROM system.tables WHERE name <span class="token operator">=</span> <span class="token string">'uk_price_paid'</span><span class="token punctuation">;</span>

SELECT formatReadableSize<span class="token punctuation">(</span>total_bytes<span class="token punctuation">)</span>
FROM system.tables
WHERE name <span class="token operator">=</span> <span class="token string">'uk_price_paid'</span>
Query id: 04d2a185-0989-4649-86a5-e38e6edac861
┌─formatReadableSize<span class="token punctuation">(</span>total_bytes<span class="token punctuation">)</span>─┐
│ <span class="token number">292.80</span> MiB                      │
└─────────────────────────────────┘
<span class="token number">1</span> rows <span class="token keyword">in</span> set. Elapsed: <span class="token number">0.019</span> sec.
</code></pre> 针对该数据集更多测试参考： <a href="https://clickhouse.com/docs/zh/getting-started/example-datasets/uk-price-paid" rel="nofollow">快速上手/示例数据集/K Property Price Paid</a></li></ol> 
<h2><a id="3__162"></a>3 注意事项</h2> 
<ol><li>必须新建 clickhouse 用户，并创建相关目录，配置clickhouse权限，否则无法正常启动。</li><li>需要在 /etc/clickhouse-server/config.xml 中开启 &lt;listen_host&gt;0.0.0.0或者::&lt;/listen_host&gt;, 否则只能本机访问。</li></ol> 
<h2><a id="4__166"></a>4 说明</h2> 
<p>软件环境：<br> Ubuntu 21.04 Desktop<br> clickhouse 22.2.2.1<br> 参考文档：<br> <a href="https://clickhouse.com/docs/zh/" rel="nofollow">clickhouse 官方文档</a><br> <a href="https://repo.clickhouse.com/tgz/stable/" rel="nofollow">clickhouse 稳定版本安装包</a><br> <a href="https://blog.csdn.net/weixin_44586883/article/details/122367734">ClickHouse安装部署【非常详细】</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/706d9c3d283c85d3b72adb3dbf515e6a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RNA-seq入门实战（一）遇到的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fc2805509ce2f77ba44532b2ffd30f6a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">cloudcompare插件编写教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>