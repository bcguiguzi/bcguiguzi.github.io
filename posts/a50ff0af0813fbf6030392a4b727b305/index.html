<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 从硬件到应用：一步一步向上爬 6 -- 编写APP测试框架层硬件服务(完) - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 从硬件到应用：一步一步向上爬 6 -- 编写APP测试框架层硬件服务(完)" />
<meta property="og:description" content="创建Android Application工程：使用Eclipse的Android插件ADT创建Android工程，工程名称为Gpio，创建完成后将工程目录拷贝到packages/apps/文件夹下，并删除工程目录下的gen文件夹，不删除的话会造成类重复的错误。
src/com/android/gpio/Gpio.java：
package com.android.gpio; import com.android.gpio.R; import android.app.Activity; import android.os.ServiceManager; import android.os.Bundle; import android.os.IGpioService; import android.os.RemoteException; import android.util.Log; import android.view.View; import android.view.View.OnClickListener; import android.widget.Button; public class Gpio extends Activity implements OnClickListener { private final static String LOG_TAG = &#34;com.android.Gpio&#34;; private IGpioService gpioService = null; private Button setButton = null; private Button clearButton = null; /** Called when the activity is first created. */ @Override public void onCreate(Bundle savedInstanceState) { super." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/a50ff0af0813fbf6030392a4b727b305/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-12-22T22:32:38+08:00" />
<meta property="article:modified_time" content="2014-12-22T22:32:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 从硬件到应用：一步一步向上爬 6 -- 编写APP测试框架层硬件服务(完)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>       创建Android Application工程：使用Eclipse的Android插件ADT创建Android工程，工程名称为Gpio，创建完成后将工程目录拷贝到packages/apps/文件夹下，并删除工程目录下的gen文件夹，不删除的话会造成类重复的错误。</p> 
<p>src/com/android/gpio/Gpio.java：</p> 
<p></p> 
<pre><code class="language-javascript">package com.android.gpio;  
import com.android.gpio.R;  
import android.app.Activity;  
import android.os.ServiceManager;  
import android.os.Bundle;  
import android.os.IGpioService;  
import android.os.RemoteException;  
import android.util.Log;  
import android.view.View;  
import android.view.View.OnClickListener;  
import android.widget.Button;  

public class Gpio extends Activity implements OnClickListener {  
private final static String LOG_TAG = "com.android.Gpio";  
private IGpioService gpioService = null;  

private Button setButton = null;  
private Button clearButton = null;  
  
/** Called when the activity is first created. */  
@Override  
public void onCreate(Bundle savedInstanceState) {  
	super.onCreate(savedInstanceState);  
	setContentView(R.layout.main);  

	gpioService = IGpioService.Stub.asInterface(  
	ServiceManager.getService("gpio"));  

	setButton = (Button)findViewById(R.id.button_set);  
	clearButton = (Button)findViewById(R.id.button_clear);  

	setButton.setOnClickListener(this);  
	clearButton.setOnClickListener(this);  
}  
  
@Override  
public void onClick(View v) {  
	if(v.equals(setButton)) {   
	try{
		int val='1';
		gpioService.setVal(val);
	} catch (RemoteException e){
		Log.e(LOG_TAG,"setting value");	
	}	
	} 
	else if(v.equals(clearButton)) {
	try{
		int val='0';
		gpioService.setVal(val);
	   } catch (RemoteException e){
		Log.e(LOG_TAG,"setting value");	
	   }	
	   }  
	}  
}  </code></pre>布局res/layout/main.xml： 
<p></p> 
<p></p> 
<pre><code class="language-javascript">&lt;?xml version="1.0" encoding="utf-8"?&gt;  
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
   android:orientation="vertical"  
   android:layout_width="fill_parent"  
   android:layout_height="fill_parent"&gt;  

   &lt;Button
       android:id="@+id/button_clear"
       android:layout_width="match_parent"
       android:layout_height="wrap_content"
       android:text="@string/clear"
       android:textStyle="bold"
       android:layout_marginTop="140dp"/&gt;
   &lt;Button
       android:id="@+id/button_set"
       android:layout_width="match_parent"
       android:layout_height="wrap_content"
       android:text="@string/set"
       android:textStyle="bold" 
       android:layout_marginTop="0dp"/&gt;
&lt;/LinearLayout&gt;  </code></pre>字符串res/values/strings.xml： 
<p></p> 
<p></p> 
<pre><code class="language-javascript">&lt;?xml version="1.0" encoding="utf-8"?&gt;  
&lt;resources&gt;  
   &lt;string name="app_name"&gt;GPIO&lt;/string&gt;  
   &lt;string name="set"&gt;Set&lt;/string&gt;  
   &lt;string name="clear"&gt;Clear&lt;/string&gt;  
&lt;/resources&gt;  </code></pre> 
<span style="font-family:宋体">AndroidManifest.xml：</span> 
<p></p> 
<p></p> 
<pre><code class="language-javascript">&lt;?xml version="1.0" encoding="utf-8"?&gt;  
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"  
  package="com.android.gpio"  
  android:versionCode="1"  
  android:versionName="1.0"&gt;  
  &lt;application android:icon="@drawable/ic_launcher" android:label="@string/app_name"&gt;  
    &lt;activity android:name=".Gpio"  
              android:label="@string/app_name"&gt;  
        &lt;intent-filter&gt;  
            &lt;action android:name="android.intent.action.MAIN" /&gt;  
            &lt;category android:name="android.intent.category.LAUNCHER" /&gt;  
        &lt;/intent-filter&gt;  
    &lt;/activity&gt;  
  &lt;/application&gt;  
&lt;/manifest&gt;   </code></pre>编辑工程目录下Android.mk： 
<p></p> 
<p></p> 
<pre><code class="language-javascript">LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)
LOCAL_MODULE_TAGS := optional
LOCAL_SRC_FILES := $(call all-subdir-java-files)
LOCAL_PACKAGE_NAME := Gpio
LOCAL_CERTIFICATE := platform
include $(BUILD_PACKAGE)
include $(call all-makefiles-under,$(LOCAL_PATH))</code></pre>编辑build/target/product/generic_no_telephony.mk： 
<p></p> 
<p>在PRODUCT_PACKAGES := \ 后加入Gpio \</p> 
<p>编译工程会生成Gpio.apk</p> 
<p></p> 
<pre><code class="language-javascript">make TARGET_PRODUCT=am335xevm_sk -j8 OMAPES=4.x </code></pre>到这一步一切准备工作都已就绪，开始更新目标板am335evm的文件系统：(左为host，右为evm) 
<p></p> 
<pre><code class="language-javascript">out/target/product/am335xevm_sk/system/app/Gpio.apk                 ==&gt;   rootfs/

out/target/product/am335xevm_sk/system/framework/services.jar       ==&gt;   rootfs/system/framework/

out/target/product/am335xevm_sk/system/framework/framework.jar      ==&gt;   rootfs/system/framework/

out/target/product/am335xevm_sk/obj/lib/libandroid_servers.so       ==&gt;   rootfs/system/lib/

out/target/product/am335xevm_sk/obj/lib/gpio.default.so             ==&gt;   rootfs/system/lib/hw/</code></pre> 
<p>确保rootfs下 ueventd.rc 已经添加：(<a target="_blank" href="http://blog.csdn.net/wu20093346/article/details/41871513" rel="noopener noreferrer">Android 从硬件到应用：一步一步向上爬 3 -- 硬件抽象层访问硬件驱动 </a> 提到)<br> </p> 
<p></p> 
<pre><code class="language-javascript">/dev/AdrIO                0666   root       root</code></pre>启动，安装Gpio.apk，打开GPIO： 
<p></p> 
<p>现象：</p> 
<pre><code class="language-javascript">点击"Set"按钮：     D1灯亮    

点击"Clear"按钮：   D1灯灭
</code></pre> 
<p align="center"><img src="https://images2.imgbox.com/60/b5/eDgytczo_o.png" alt=""></p> 
<p>可见编写的APP通过调用硬件服务已经成功操作了AM335寄存器，改变AM335X_GPIO_LED4的电平，通过N沟MOS器件控制LED D1的亮灭。<br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/60cb47cd2d85059fbf690885a241eb0f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">StringUtils.isEmpty和StringUtils.isBlank用法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bf0cf32cfc3530152030e765481a4646/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android复制文件,文件夹</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>