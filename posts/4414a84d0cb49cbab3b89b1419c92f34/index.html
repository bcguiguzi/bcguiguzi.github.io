<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【电子技术】眼图的基本概念和原理（1） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【电子技术】眼图的基本概念和原理（1）" />
<meta property="og:description" content="1 眼图概述 1.1 串行数据的传输 由于通讯技术发展的需要，对数据带宽的需求日益增加，使得电子系统从传统的并行总线转为串行总线。串行信号种类繁多，如 PCI Express、SPI、USB 、SATA等，其传输信号类型时刻在增加。为何串行总线目前应用越来越广泛呢？相比并行数据传输，串行 数据传输的整体特点如下：
1 信号线的数量减少，成本降低
2 消除了并行数据之间传输的延迟问题
3 时钟是嵌入到数据中的，数据和时钟之间的传输延迟也同样消除了
4 传输线的 PCB 设计也更容易些
5 信号完整性测试也更容易
实际中，描述串行数据的常用单位是：波特率和 UI。串行数据传输示例如下：
图1 串行数据传输示例
例 如，比特率为 3.125Gb/s 的信号表示为每秒传送的数据比特位是 3.125G 比特，对应的一个单位间隔即为 1UI。1UI表示一个比特位的宽度，它是波特率的倒数，即 1UI=1/（3.125Gb/s）=320ps。现在比较常见的串行信号码形是 NRZ 码，因此在一般的情况下对于串行数据信号，我们的工作均是针对 NRZ 码进行的。
1.2 眼图的形成原理 眼图，是由于示波器的余辉作用，将扫描所得的每一个码元波形重叠在一起，从而形成眼图。眼图中包含了丰富的信息，从眼图上可以观察出码间串扰和噪声的影响，体现了 数字信号整体的特征，从而可以估计系统优劣程度，因而眼图分析是高速互连系统信号完 整性分析的核心。另外也可以用此图形对接收滤波器的特性加以调整，以减小码间串扰，改善系统的传输性能。
目前，一般均可以用示波器观测到信号的眼图，其具体的操作方法为：将示波器跨接 在接收滤波器的输出端，然后调整示波器扫描周期，使示波器水平扫描周期与接收码元的周期同步，这时示波器屏幕上看到的图形就称为眼图。示波器一般测量的信 号是一些位或某一段时间的波形，更多的反映的是细节信息，而眼图则反映的是链路上传输的所有数字 信号的整体特征，两者对比如下图所示：
图2 示波器中的信号与眼图
如果示波器的整个显示屏幕宽度为 100ns，则表示在示波器的有效频宽、取样率及记忆体配合下，得到了100ns下的波形资料。但是，对于一个系统而言，分析这么短的时间内的信号并不具有代表性，例如信号在每一百万位元会出现一次突波（Spike），但在这 100ns时间内，突波出现的机率很小，因此会错过某些重要的信息。如果要衡量整个系统的性能， 这么短的时间内测量得到的数据显然是不够的。设想，如果可以以重复叠加的方式，将新的信号不断的加入显示屏幕中，但却仍然记录着前次的波形，只要累积时间 够久，就可以 形成眼图，从而可以了解到整个系统的性能，如串扰、噪声以及其他的一些参数，为整个系统性能的改善提供依据。 分析实际眼图，再结合理论，一个完整的眼图应该包含从“000”到“111”的所有状态组，且每一个状态组发生的次数要尽量一致，否则有些信息将无法呈现在屏幕上，八种状态形成的眼图如下所示：
图3 眼图形成示意图
由上述的理论分析，结合示波器实际眼图的生成原理，可以知道一般在示波器上观测到的眼图与理论分析得到的眼图大致接近（无串扰等影响），如下所示：
图4 示波器实际观测到的眼图
如果这八种状态组中缺失某种状态，得到的眼图会不完整，如下所示：
图5 示波器观测到的不完整的眼图
通过眼图可以反映出数字系统传输的总体性能，可是怎么样才能正确的掌握其判断方 法呢？这里有必要对眼图中所涉及到的各个参数进行定义，了解了各个参数以后，其判断 方法很简单。
1.3 眼图参数定义 通过上述对眼图形成理论的分析，我们可以知道眼图中通常显示的是 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/4414a84d0cb49cbab3b89b1419c92f34/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-31T18:08:35+08:00" />
<meta property="article:modified_time" content="2022-03-31T18:08:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【电子技术】眼图的基本概念和原理（1）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3><strong>1 眼图概述</strong></h3> 
<h4><strong>1.1 串行数据的传输</strong></h4> 
<p>由于通讯技术发展的需要，对数据带宽的需求日益增加，使得电子系统从传统的并行总线转为串行总线。串行信号种类繁多，如 PCI <a href="https://so.csdn.net/so/search?from=pc_blog_highlight&amp;q=Express" title="Express">Express</a>、SPI、USB 、SATA等，其传输信号类型时刻在增加。为何串行总线目前应用越来越广泛呢？相比并行数据传输，串行 数据传输的整体特点如下：</p> 
<p>1 信号线的数量减少，成本降低</p> 
<p>2 消除了并行数据之间传输的延迟问题</p> 
<p>3 时钟是嵌入到数据中的，数据和时钟之间的传输延迟也同样消除了</p> 
<p>4 传输线的 PCB 设计也更容易些</p> 
<p>5 信号完整性测试也更容易</p> 
<p>实际中，描述串行数据的常用单位是：波特率和 UI。串行数据传输示例如下：</p> 
<p><img alt="" height="227" src="https://images2.imgbox.com/d9/98/qtq25dVh_o.png" width="547"></p> 
<p>                                        图1 串行数据传输示例</p> 
<p>例 如，比特率为 3.125Gb/s 的信号表示为每秒传送的数据比特位是 3.125G 比特，对应的一个单位间隔即为 1UI。1UI表示一个比特位的宽度，它是波特率的倒数，即 1UI=1/（3.125Gb/s）=320ps。现在比较常见的串行信号码形是 NRZ 码，因此在一般的情况下对于串行数据信号，我们的工作均是针对 NRZ 码进行的。</p> 
<h4><strong>1.2 眼图的形成原理</strong></h4> 
<p>眼图，<span style="color:#4da8ee;">是由于示波器的余辉作用，将扫描所得的每一个码元波形重叠在一起，从而形成眼图</span>。眼<strong><span style="color:#fe2c24;">图中包含了丰富的信息，从眼图上可以观察出码间串扰和噪声的影响，体现了 数字信号整体的特征，从而可以估计系统优劣程度，因而眼图分析是高速互连系统信号完 整性分析的核心。另外也可以用此图形对接收滤波器的特性加以调整，以减小码间串扰，改善系统的传输性能。</span></strong></p> 
<p>目前，一般均可以用示波器观测到信号的眼图，其具体的操作方法为：将示波器跨接 在接收滤波器的输出端，然后调整示波器扫描周期，使示波器水平扫描周期与接收码元的周期同步，这时示波器屏幕上看到的图形就称为眼图。示波器一般测量的信 号是一些位或某一段时间的波形，更多的反映的是细节信息，而眼图则反映的是链路上传输的所有数字 信号的整体特征，两者对比如下图所示：</p> 
<p class="img-center"><img alt="" height="286" src="https://images2.imgbox.com/16/7b/cKD6Bvd7_o.png" width="403"></p> 
<p style="text-align:center;">         图2 示波器中的信号与眼图</p> 
<p>如果示波器的整个显示屏幕宽度为 100ns，则表示在示波器的有效频宽、取样率及记忆体配合下，得到了100ns下的波形资料。但是，对于一个系统而言，分析这么短的时间内的信号并不具有代表性，例如信号在每一百万位元会出现一次突波（Spike），但在这 100ns时间内，突波出现的机率很小，因此会错过某些重要的信息。如果要衡量整个系统的性能， 这么短的时间内测量得到的数据显然是不够的。<strong><span style="color:#956fe7;">设想，如果可以以重复叠加的方式，将新的信号不断的加入显示屏幕中，但却仍然记录着前次的波形，只要累积时间 够久，就可以 形成眼图</span></strong>，从而可以了解到整个系统的性能，如串扰、噪声以及其他的一些参数，为整个系统性能的改善提供依据。 分析实际眼图，再结合理论，一个完整的眼图应该包含从“000”到“111”的所有状态组，且每一个状态组发生的次数要尽量一致，否则有些信息将无法呈现在屏幕上，八种状态形成的眼图如下所示：</p> 
<p><img alt="" src="https://images2.imgbox.com/ba/f4/5ALw7QAJ_o.png"></p> 
<p>                                                      图3 眼图形成示意图</p> 
<p>由上述的理论分析，结合示波器实际眼图的生成原理，可以知道一般在示波器上观测到的眼图与理论分析得到的眼图大致接近（无串扰等影响），如下所示：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d7/b0/XrUpJqbn_o.png"></p> 
<p>                                                图4 示波器实际观测到的眼图</p> 
<p>如果这八种状态组中缺失某种状态，得到的眼图会不完整，如下所示：</p> 
<p class="img-center"><img alt="" height="263" src="https://images2.imgbox.com/74/5e/Voiha2bv_o.png" width="434"></p> 
<p>                                               图5 示波器观测到的不完整的眼图</p> 
<p>通过眼图可以反映出数字系统传输的总体性能，可是怎么样才能正确的掌握其判断方 法呢？这里有必要对眼图中所涉及到的各个参数进行定义，了解了各个参数以后，其判断 方法很简单。</p> 
<h4><strong>1.3 眼图参数定义</strong></h4> 
<p>通过上述对眼图形成理论的分析，我们可以知道眼图中通常显示的是 1.25UI 的时间窗 口，眼图的形状各种各样，通过眼图的形状特点可以快速地判断信号的质量。因此，这里 有必要好好理解下眼图的相关参数，从而可以根据这些参数来判别眼图的好坏，从而可以 衡量系统的性能。眼图相关的参数有很多，如眼高、眼宽、眼幅度、眼交叉比、“1”电平， “0”电平，消光比，Q 因子，平均功率等，各个参数如下图中所示：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c4/28/jhPVEWJm_o.png"></p> 
<p>                                                           图6 眼图各个参数</p> 
<p>眼图中的“1”电平（Ptop）与“0”（Pbase）电平即是表示逻辑为 1 或 0 的电压位准值，实际中选取眼图中间的 20%UI 部分向垂直轴投影做直方图，直方图的中心值分别为“1”电平 和“0”电平。</p> 
<p>眼幅度表示“1”电平信号分布与“0”电平信号分布平均数之差，其测量是通过在眼图中 央位置附近区域（通常为零点交叉时间之间距离的 20%）分布振幅值进行的。</p> 
<p>眼宽反映信号的总抖动，即是眼图在水平轴所开的大小，其定义为两上缘与下缘交汇 的点（Crossing Point）间的时间差。交叉点之间的时间是基于信号中的两个零交叉点处的直方图平均数计算而来，每个分布的标准偏差是从两个平均数之间的差值相减而来。 眼高即是眼图在垂直轴所开的大小，它是信噪比测量，与眼图振幅非常相似。</p> 
<p>下面详细介绍如消光比等一些复杂的概念，以帮忙理解眼图的性能。</p> 
<p>（1）消光比（Extinction Ratio） 消光比定义为眼图中“1”电平与“0”电平的统计平均的比值，其计算公式可以是如下的三种：</p> 
<p><img alt="" src="https://images2.imgbox.com/aa/70/RbpUICSS_o.png"></p> 
<p>消光比在光通信发射源的量测上是相当重要的参数，它的大小决定了通信信号的品质。消光比越大，代表在接收机端会有越好的逻辑鉴别率；消光比越小，表示信号较易受到干扰，系统误码率会上升。</p> 
<p>消光比直接影响光接收机的灵敏度，从提高接收机灵敏度的角度希望消光比尽可能大，有利于减少功率代价。但是，消光比也不是越大越好，如果消光比太大会使激光器的 图案相关抖动增加。因此，一般建议实际消光比与最低要求消光比大 0.5~1.5dB。</p> 
<p>（2） 眼交叉比 眼图交叉比，是测量交叉点振幅与信号“1”及“0”位准之关系，因此不同交叉比例关系可传递不同信号位准。一般标准的信号其交叉比为 50%，即表示信号“1”及“0”各 占一半的位准。为了测量其相关比率，使用如下图所示的统计方式。交叉位准是依据交叉点垂直统计的中心窗口而计算出来的平均值，其比例方程式如下（其中的 1及 0 位准是取 眼图中间的 20%为其平均值，即从 40%~60%中作换算）：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4c/f7/whVCjQgI_o.png"></p> 
<p>                                                 图7 眼图信号交叉点比例关系</p> 
<p>随着交叉点比例关系的不同，表示不同的信号 1 或 0 传递质量的能耐。如下图所示， 左边图形为不同交叉比例关系的眼图，对应到右边相关的 1 及 0 脉冲信号。同时也可以了解到在不同脉冲信号时间的宽度与图交叉比例的关系。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/3e/bd/EAJqsz9x_o.png"></p> 
<p>                                               图8 不同眼交叉比与脉冲信号的关系</p> 
<p>对 于一般的信号而言，平均分布信号位准 1 及 0 是最常见的。一般要求眼图交叉比为50%，即以相同的信号脉冲 1 与 0 长度为标准，来作相关参数的验证。因此，根据眼交叉比关系的分布，可以有效地测量因不同 1 及 0 信号位准的偏差所造成的相对振幅损失分析。 例如，眼交叉比过大，即传递过多 1 位准信号，将会依此交叉比关系来验证信号误码、屏蔽及其极限值。眼交叉比过小，即传递过多 0 位准信号，一般容易造成接收端信号不易从其中抽取频率，导致无法同步，进而产生同步损失。</p> 
<p>（3）信号上升时间与下降时间</p> 
<p>一般测量上升及下降时间是以眼图占 20%～80%的部分为主，其中上升时间如下图，分别以左侧交叉点左侧(20%)至右侧(80%)两块水平区间作此传递信号上升斜率时间之换 算，计算公式如下：</p> 
<p>上升时间 平均（80%时间位准）-平均（20%时间位准）</p> 
<p class="img-center"><img alt="" height="262" src="https://images2.imgbox.com/6f/0c/4SO1QMWd_o.png" width="407"></p> 
<p>                                                     图9 眼图信号上升时间</p> 
<p>我们知道，时间位准 20%及 80%是与信号位准 1 及 0 有着相关性的。当然，如果上升 时间愈短，即愈能表现出眼图中间的白色区块，即代表可传递的信号及容忍误码比率较好。 而对于眼图下降时间如下图所示，分别以右侧交叉点左侧(80%)至右侧(20%)两块水平区间 作此信号传递下降斜率时间之换算，计算公式如下：</p> 
<p>下降时间 平均（20%时间位准）-平均（80%时间位准）</p> 
<p class="img-center"><img alt="" height="261" src="https://images2.imgbox.com/b5/07/g5GInGFR_o.png" width="416"></p> 
<p>                                                图10 眼图信号下降时间</p> 
<p>如同上升时间一般，如果下降时间愈短，亦愈能表现出眼图中间的白色区块，可以传递的信号及容忍误码比率愈好。</p> 
<p>（4）Q 因子（Q Factor）</p> 
<p>Q 因子是用于测量眼图信噪比的参数，它的定义是接收机在最佳判决门限下信号功率 和噪声功率的比值，可适用于各种信号格式和速率的数字信号，其计算公式如下：</p> 
<p><img alt="" src="https://images2.imgbox.com/6a/c1/zHWJT2OK_o.png"></p> 
<p>（5）平均功率 通过眼图反映的平均功率，即是整个数据流的平均值。与眼图振幅测量不同，平均功率则是直方图的平均值。如果数据编码正常工作，平均功率应为总眼图振幅的 50%。</p> 
<p>（6）抖动 抖动是在高速数据传输线中导致误码的定时噪声。如果系统的数据速率提高，在几秒内测得的抖动幅度会大体不变，但在位周期的几分之一时间内测量时，它会随着数据速率成比例提高，进而导致误码。因此，在系统中尽可能的减少这种相关抖动，提升系统总体性能。</p> 
<p>抖动，描述了信号的水平波动，即信号的某特定时刻相对于其理想时间位置上的短期偏离，示意图如下：</p> 
<p class="img-center"><img alt="" height="147" src="https://images2.imgbox.com/38/ad/nMtsPORd_o.png" width="467"></p> 
<p>                                                            图11 抖动示意图</p> 
<p>示波器观测到的抖动如下图所示。图中为抖动大的眼图的交点，其直方图是一个像素宽的交点块投射到时间轴上的投影。理想情况下应该为一个点，但由于码元的水平波动，导致其形成了一个区域。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c0/59/4uqTUeFe_o.png"></p> 
<p>                                                         图12 抖动的眼图交点</p> 
<p>器件生成的固有抖动称为抖动输出。其主要来源可以分为两个：随机抖动(RJ)和确定性抖动(DJ)，其中确定性抖动(Deterministic Jitter)又可以分为周期性抖动（Periodic Jitter）、占空比失真（Duty Cycle Distortion）、码间干扰（Inter-Symbol Interference）和串扰。DCD源自时钟周期中的不对称性。ISI 源自由于数据相关效应和色散导致的边沿响应变化。PJ源自周期来源的电磁捡拾，如电源馈通。串扰是由捡拾其它信号导致的。DJ 的主要特点是， 其峰到峰值具有上下限。DCD 和 ISI 称为有界相关抖动，Pj 和串扰称为不相关有界抖动，而 RJ 称为不相关无界抖动。另外，抖动分布是 RJ和 DJ 概率密度函数的卷积。</p> 
<p>分析抖动以及其具体产生原因将有助于在系统设计时尽可能的减少抖动产生的影响，并保证系统 BER 低于某个最大值，同时可以确定抖动对 BER 的影响，并保证系统 BER 低于某个最大值，通常是10^-12</p> 
<p>抖动的形成原因直观的表示如下图：</p> 
<p><img alt="" src="https://images2.imgbox.com/30/2f/P1mVZgfo_o.png"></p> 
<p>                                                  图13 抖动形成原因</p> 
<p><strong>1.4 眼图与误码率 BER</strong></p> 
<p>在 数字电路系统中，发送端发送出多个比特的数据，由于多种因素的影响，接收端可能会接收到一些错误的比特（即误码）。错误的比特数与总的比特数之比称为误码 率，即Bit Error Ratio，简称 BER。误码率是描述数字电路系统性能的最重要的参数。在 GHz 比 特率的通信电路系统中（比如 Fibre Channel、PCIe、SONET、SATA），通常要求 BER 小于或等于10^12。误码率较大时，通信系统的效率低、性能不稳定。影响误码率的因素包括抖动、噪声、信道的损耗、信号的比特率等。</p> 
<p>在误 码率（BER）的测试中，码型发生器会生成数十亿个数据比特，并将这些数据比特发送给输入设备，然后在输出端接收这些数据比特。然后，误码分析仪将接收到 的数据与发送的原始数据一位一位进行对比，确定哪些码接收错误，随后会给出一段时间内内计 算得到的 BER。考虑误码率测试的需要，我们以下面的实际测试眼图为参考，以生成 BER图，参考眼图如下所示：</p> 
<p><img alt="" src="https://images2.imgbox.com/80/10/WiuE5HP4_o.png"></p> 
<p>                                      图14 参考眼图</p> 
<p>BER 图是样点时间位置 BER(t)的函数，称为 BERT 扫描图或浴缸曲线。简而言之，它 是在相对于参考时钟给定的额定取样时间的不同时间 t 上测得的 BER。参考时钟可以是信 号发射机时钟，也可以是从接收的信号中恢复的时钟，具体取决于测试的系统。以上述的 眼图为参考，眼睛张开度与误码率的关系以及其 BER 图如下：</p> 
<p><img alt="" src="https://images2.imgbox.com/b1/1c/UEqbegxk_o.png"></p> 
<p>                                 图15 眼睛张开度与误码率的关系</p> 
<p><img alt="" src="https://images2.imgbox.com/7d/3b/EDSlNwAA_o.png"></p> 
<p>                                 图16 BER(T)扫描或浴缸曲线</p> 
<p>上述两图中，BER 图与眼图时间轴相同，两侧与眼图边沿相对应，样点位于中心。BER 一定时，曲线之间的距离是该 BER 上的眼图张开程度。在样点接近交点时，抖动会导致 BER 提高到最大 0.5。</p> 
<p><strong>1.5 眼图与系统性能</strong></p> 
<p>当接收信号同时受到码间串扰和噪声的影响时，系统性能的定量分析较为困难，一般可以利用示波器，通过观察接收信号的“眼图”对系统性能进行定性的、可视的估计。由眼图可以观察出符号间干扰和噪声的影响，具体描述如下：</p> 
<p><img alt="" src="https://images2.imgbox.com/03/ca/lMkflKOh_o.png"></p> 
<p>                                            图17 眼图与系统性能的关系</p> 
<p>眼图对于展示数字信号传输系统的性能提供了很多有用的信息：可以从中看出码间串扰的大小和噪声的强弱，有助于直观地了解码间串扰和噪声的影响，评价一个基带 系统的性能优劣；可以指示接收滤波器的调整，以减小码间串扰，如： 眼图的“眼睛”张开的大小反映着码间串扰的强弱。“眼睛”张的越大，且眼图越端正，表示码间串扰越小；反之表示码间串扰越大。当存在噪声时，噪声将叠加在 信号上，观察到的眼图的线迹会变得模糊不清。若同时存在码间串扰 ，“眼睛”将张开得更小。与 无码间串扰时的眼图相比，原来清晰端正的细线迹，变成了比较模糊的带状线，而且不很端正。噪声越大，线迹越宽，越模糊；码间串扰越大，眼图越不端正。</p> 
<p><img alt="" src="https://images2.imgbox.com/ed/66/B24p6fbi_o.png"></p> 
<p>                                               图18 眼图与信号质量</p> 
<p>理论分析得到如下几条结论，在实际应用中要以此为参考，从眼图中对系统性能作一评价：</p> 
<p>（1）最佳抽样时刻应 在 “眼睛” 张开最大的时刻。</p> 
<p>（2）对定时误差的灵敏度可由眼图斜边的斜率决定。斜率越大，对定时误差就越灵敏。</p> 
<p>（3）在抽样时刻上，眼图上下两分支阴影区的垂直高度，表示最大信号畸变。</p> 
<p>（4）眼图中央的横轴位置应对应判决门限电平。</p> 
<p>（5）在抽样时刻，上下两分支离门限最近的一根线迹至门限的距离表示各相应电平的噪声容限，噪声瞬时值超过它就可能发生错误判决。</p> 
<p>（6）对于利用信号过零点取平均来得到定时信息的接收系统，眼图倾斜分支与横轴 相交的区域的大小表示零点位置的变动范围，这个变动范围的大小对提取定时信息有重要</p> 
<p>的影响。 通过以上的分析可以知道，眼图可以完美的衡量系统的性能，那么，如何才能够获得</p> 
<p>“张开”的眼图呢？以下从几个方面考虑：</p> 
<p>（1）考虑 PCB 走线长度：短走线并非始终能够满足，短走线意味着低损耗</p> 
<p>（2）考虑 PCB 走线宽度：宽走线可以降低趋肤效应</p> 
<p>（3）减小板材的介电常数：降低介电损耗(Dielectric Loss)，但将增加成本</p> 
<p>（4）信号预加重和均衡处理：通过对跳变位预加重(Pre-Emphasis)处理，补偿线路上因信号跳变产生的针对高频分量的损耗。</p> 
<h3><strong>2 眼图的生成方法探讨</strong></h3> 
<p>一 般而言，生成眼图需要通过测量大量的数据，然后再从其中恢复得到。示波器测量 眼图中，经过前期的数据采集，其内存中可以获得完整的数据记录。然后，利用硬件或者 软件对时钟进行恢复或提取得到同步时钟信号，用此时钟信号与数据记录中的数据同步到 每个比特，此时时钟信号与数据信号在相位上是对齐的。通过恢复时钟的触发，把数据流 中捕获的多个 1 UI(单位间隔，相当于一个时钟周期)的信号重叠起来，也即将每个比特的 数据波形重叠，最后得到眼图。</p> 
<p>力科公司提供的示波器资料中，描述了目前用到的两种眼图的测量方法，即传统眼图 测量方法与现代眼图测量方法，详细介绍如下：</p> 
<h4><strong>2.1 传统眼图测量方法</strong></h4> 
<p>示波器中传统的眼图测量方法就是同步触发一次，叠加一次，然后再触发再叠加。每 触发一次，眼图上增加一个 UI，每个 UI 的数据是相对于触发点排列的，因此是“Single-Bit Eye”，其形成过程如下图所示：</p> 
<p><img alt="" src="https://images2.imgbox.com/91/04/ooryEPV2_o.png"></p> 
<p>                                                图19 传统眼图形成方法</p> 
<p>传统的同步触发原理，也就是说如何使每个 UI 的数据相对于触发点对齐排列，有两种方法，如下：</p> 
<p>(1) 在被测电路板上找到和串行数据同步的时钟，将此时钟作为示波器的触发源，且时钟的边沿作为触发的条件。来一个时钟边沿则触发一次，从而使每个 UI 的数据相对于触发排列，实现同步触发。</p> 
<p>(2) 一般传输的串行数据信号中混合数据信号与时钟信号，将待测的串行信号同时输入到示波器的输入通道和硬件时钟恢复电路(CDR)通道，硬件CDR 恢复出串行数据里内嵌的时钟，以恢复出的时钟信号作为示波器的触发源，利用时钟边沿实现触发，从而使每个UI的数据相对于触发排列，实现同步触发。用传统的眼图测量方法，我们可以得到整个系统的眼图，从而可以评估系统的性能。但是，对于现代系统的评估而言，它还存在如下的缺陷：</p> 
<p>(1) 效率比较低。如果需要测量高速信号，则需要测量大量的数据，如 1 百万个 UI 的 眼图，触发时间花费较长。</p> 
<p>(2) 器件触发抖动影响。由于每次触发只能叠加一个 UI，形成 1 百万个 UI 的眼图就需要触发 1 百万次，这样不断触发的过程中必然将示波器本身的触发抖动也引入到了眼图上。</p> 
<p>对于高速信号来说，这种抖动是不可忽略的。</p> 
<p>(3)CDR 抖动的影响。传统的眼图测量方法利用硬件CDR原理，但是这种同步方法引入了硬件CDR 抖动，对眼图测量误差较大。</p> 
<p>(4)硬件 CDR 只能侦测连续串行信号才能正常工作，如果被测信号不是连续的，譬如两段连续比特位之间有一段低电平，硬件 CDR 就不能恢复出正确的时钟。因此，传统测 量方法的工作原理决定了它不能对间歇性的串行信号做眼图。</p> 
<p>(5) 由于传统的方法需要及时的时钟信号才会正常的工作，对于保存的波形数据等，由 于没有办法恢复时钟信号，也就不能在这些保存的数据的基础上形成眼图。还有，不能对运算后的波形做眼图，这限制了应用范围。</p> 
<h4><strong>2.2现代眼图测量方法</strong></h4> 
<p>考虑到传统眼图测量方法的缺陷，我们这里详细阐述现代眼图的测量方法。现代眼图测量方法主要利用软件来实现，首先捕获一组连续比特位的信号，然后用软件PLL方法（软件算法）恢复出时钟，最后利用恢复出的时钟和捕获到的信号按比特位切割，切割一次， 叠加一次，最终将捕获到的一组数据的每个比特位都叠加在一起，这样就形成了眼图，以下是其形成方法的示意图。</p> 
<p><img alt="" src="https://images2.imgbox.com/ef/e5/DN1qqsDR_o.png"></p> 
<p>                                            图20 现代眼图形成方法</p> 
<p>相比较传统的眼图测量方法而言，现代眼图测量方法的优势体现在如下的几个方面：</p> 
<p>(1)形成眼图的效率非常高，准确度也较高。一次捕获大量数据后，再用处理器可以在很短的时间内形成眼图，这样可以找到一些违反规则的偶然事件。</p> 
<p>(2)触发抖动影响很小。通过触发一次捕获的大量数据就能形成大量数据的眼图，触发 一次的抖动在大量的数据形成的眼图中，可以看作为零。</p> 
<p>(3) 时钟恢复抖动为 0。现代方法利用软件 PLL 方法进行时钟恢复，它不需要外部的时 钟信号。而传统的方法用硬件电路来恢复时钟，这种额外的电子器件给时钟信号和数据比特之间的定时增加了某些额外的噪声或者抖动。软件锁相环以数学方式对信 号应用相同类 型的时钟恢复滤波器和门，而不是通过硬件应用。因此，它可以在不增加抖动的情况下恢复时钟，其抖动也为零。</p> 
<p>(4)现代方法只是利用软件进行时钟的恢复，因此只要从大量数据中提取到时钟信号就 可以将眼图恢复出来。因此，该方法可以对局部放大之后的波形做眼图，可以对历史保存的波形做眼图，并且可以有一些高级眼图分析功能，相比传统眼图生成方法，其具有很大的优势。 通过以上对眼图形成原理和方法的分析，我们知道眼图形成电路原理与数字示波器采集信号原理类似，只是没有数字示波器设计那么复杂，因此，在本文以下的章节中，先主要讲解数字示波器的形成原理，再结合实际将眼图形成的电路框架构建出来。</p> 
<h3><strong>3 数字示波器原理</strong></h3> 
<p>一般而言，我们可以从实时示波器、采样示波器等仪器中观测到眼图，因此我们可以 根据数字示波器中眼图的实现方法来构建眼图的形成构架，以期利用现有的知识，通过改变或者改进电路原理来达到眼图的设计。</p> 
<p>数字示波器主要包括信号调理电路、采集和存储部分电路、触发电路、软件处理及显 示部分，其基本的电路框图如下所示。</p> 
<p><img alt="" src="https://images2.imgbox.com/db/76/siGT6Zml_o.png"></p> 
<p>                                    图21 数字示波器基本电路框图</p> 
<p>通过数字示波器的原理框图可以知道，模拟信号必须先经过信号调理电路，将模拟信号进行适当的衰减或者放大，使信号能够较理想的输入到 ADC 中进行模数转换。经过调理的信号送到 ADC 中，经过控制器控制 ADC 进行信号的采样，同时经过调理的信号可以 送到触发电路。经过 ADC 转换后的信号为数字信号，保存到存储器中，随后利用软件对这些数据进行处理，比如采用正弦内插算法进行波形的重建，重建后的波形可以进行各种 各样的参数测量、信号运算和分析等，最终的结果可以直接显示到屏幕上，参考体系结构如下图所示：</p> 
<p><img alt="" src="https://images2.imgbox.com/8a/72/Y1p9aykP_o.png"></p> 
<p>                                   图22 数字示波器参考体系结构</p> 
<p>通过以上对数字示波器的分析，许多因素可以影响到数字示波器的测试精度，在实际中有必要掌握各个指标的含义，数字示波器的指标列写如下：</p> 
<p>（1）最大取样速率</p> 
<p>定义：单位时间内完成的完整 AD 转换的最高次数。</p> 
<p>最大取样速率主要由 AD 转换器的最高转换速率来决定，最大取样速率愈高，仪器捕捉信号的能力愈强。</p> 
<p>（2）存储带宽 存储带宽与取样速率密切相关，根据取样定理，如果取样速率大于或者等于信号最高频率分量的 2 倍，便可重现原信号波形。实际上，在实时数字存储示波器的设计中，为保证显示小型的分辨率，往往要求增加更多的取样点，一般一个周期取 4~10 个点。</p> 
<p>（3）分辨率 分辨率用于反映存储信号波形细节的综合特性，它包括垂直分辨率与水平分辨率。垂直分辨率与 AD 转换器的分辨率相对应，水平分辨率由存储器的容量来决定。</p> 
<p>（4）存储容量 存储容量又称为记录长度，用于记录一帧波形数据占有的存储容量来表示，存储容量与水平分辨率在数值上互为倒数关系。存储容量愈大，水平分辨率就愈高。</p> 
<h4><strong>3.1 实时示波器</strong></h4> 
<p>实时示波器有时也称为“单次”示波器，它在每个触发事件上捕获一个完整波形。也 就是说，它在一个连续记录中捕获大量的数据点。为了更好的理解这种数据采集类型，我 们将实时示波器假设为一个速度极快的模数转换器(ADC)，其中采样速率决定采样间隔， 存储器深度决定要显示的点数。为了捕获任何波形，ADC 采样速率要明显快于输入波形的 频率，至少要满足采样定理。</p> 
<p>实时示波器中，可以根据数据本身的特性来实现信号的触发功能，并且通常输入波形 的幅度达到一个特定阈值时，触发就会发生。示波器此时开始以异步速率 (与输入波形的数据速率没有任何关联) 将模拟波形转换为数字数据点。该转换速率即采样速率，它通常源于一个内部时钟信号。示波器对输入波形的幅度进行采样，并将这个幅度值存储到存储 器中，然后继续下一个采样。触发的主要工作是为输入数据提供一个水平时间参考点，具体数据采集原理如下图所示：</p> 
<p><img alt="" src="https://images2.imgbox.com/ee/0b/XULdJr6B_o.png"></p> 
<p>                                              图23 实时示波器波形采集原理</p> 
<p>根据实时示波器的原理，可以知道实时示波器的采样率主要由 ADC 的采样率决定。 在满足采样准则的条件下，ADC 的采样率理论上至少为信号最高频率的 2 倍，实际中一般 为 3~5 倍以上，采集到的数据才不会出现混叠现象。</p> 
<p>利用实时示波器可以查看眼图。使用软件恢复时钟或由用户提供的外部显式时钟可以 构建这些“实时眼图”或“单次”眼图。实时示波器按照恢复时钟周期的间隔分割单一的 长捕获波形，并把这些比特叠加在一起来重新创建眼图。</p> 
<h4><strong>3.2 采样示波器</strong></h4> 
<p>采样示波器，即等效时间采样的方法采用从重复性信号的不同的周期取得采样点来重 建这个重复性信号的波形，它仅测量采样瞬间波形的瞬时幅度，这样就提高了示波器的时间分辨率。与实时示波器不同，采样示波器的一次触发只对输入信号采样一次，下次触发进会增加一个小小的延迟，然后进行采样。为了填满一个完整的波形记录，就需要进行多次触发。测量带宽由采样器的频率响应决定，测量带宽可以达到很高。</p> 
<p>采样示波器的触发和随后的采样与实时示波器有着明显的差别。最重要的是，采样示 波器为了执行操作需要一个显式触发，这个触发需要与输入数据同步。显式触发通常由用户提供，但有时也可以使用硬件时钟恢复模块来获得触发。采样过程为：一 个触发事件发起第一次采样，然后示波器重新调整并等待下一个触发事件。重新调整的时间约为 25 µ s。下一个触发事件发起第二次采样，并在对第二个数据点采样之前添加一个极小的增量延迟。该增量延迟时间由时基设置和采样点数确定。采样示波器原理如下图所 示，重复该过 程直到获得完整的波形。</p> 
<p><img alt="" src="https://images2.imgbox.com/11/a5/yAMelTYm_o.png"></p> 
<p>                                                     图24 等效时间采样示波器原理</p> 
<p>采样示波器也可以查看眼图。眼图模式要求使用一个同步时钟信号来进行触发，在每个触发事件处 (允许重新调整时间)，示波器对数据进行采样并在整个屏幕上显示所有可能 的 1 和 0 组合的合并结果。触发可以使用全速率时钟和分速率时钟，但是如果码型长度是时钟分割比率的偶倍数，则眼图会丢失部分组合从而变得不完整。此外，如果使用数据作为其自身的触发条件，则眼图可以完整地显示出来，但是示波器只能由数据 码型的上升沿进行触发。为了进行精确的眼图测量应该避免这种情况，尽量采用时钟信号触发的方式，下图则显示眼图的触发过程。</p> 
<p><img alt="" src="https://images2.imgbox.com/fb/a6/VuwqKOwy_o.png"></p> 
<p>                                                图25 采样示波器眼图触发过程</p> 
<h3><strong>4 眼图系统模块</strong></h3> 
<p>前面介绍了眼图的基本概念、眼图的形成方法以及示波器的原理等知识，可以了解到 一般眼图测试针对的主要是串行信号，其数据传输速率可以达到几十 GHz 左右。因此，这 么高的数据速率，眼图系统的设计采用等效采样示波器眼图的形成原理更加适合。通过对 等效采样示波器眼图形成原理的探讨，结合眼图形成的原理，可以知道一个眼图系统大致 应该包括信号调理模块、触发模块、信号采集与存储模块、时钟恢复模块、数据处理及显 示模块等，其基本的原理框图如下，一种为硬件实现时钟恢复，一种为软件实现时钟恢复， 但是基本原理相似。</p> 
<p><img alt="" src="https://images2.imgbox.com/f9/98/MFh492Uz_o.png"></p> 
<p>                                        图26 硬件时钟恢复方案</p> 
<p>硬件时钟恢复方案中，利用专用时钟恢复芯片就可以实现，避免了自己设置锁相环的 麻烦。对于信号的采样部分，为了同步时钟与数据信号，ADC 只对时钟恢复后的数据进行 采样，将之存储在 RAM 中，这样就可以实现利用时钟上升沿对信号触发的目的。上图中 的触发信号产生模块，主要是实现通过操作面板的调节，从而调节信号触发电平，以及对 时基的控制，以便于在界面上实现波形的显示，与时钟信号上升沿触发信号无关。</p> 
<p><img alt="" src="https://images2.imgbox.com/2f/93/YXLFn4jl_o.png"></p> 
<p>                                       图27 软件时钟恢复方案</p> 
<p>软件时钟恢复方案中，只需要采集大量的数据，然后在控制器中用特殊的算法，将时钟信号提取出来，再用此时钟信号对捕获到的信号按比特位切割，切割一次，叠加一次， 最终将捕获到的一组数据的每个比特位都叠加在一起，这样就形成了眼图。这里的触发信号产生模块与硬件时钟恢复方案中的功用一致，不再赘述。</p> 
<p>上述的两个方案中，触发信号可以由本身信号提供，也可以由外界提供。根据所测眼图的相关参数，再用统计方法分析抖动、频谱分析、绘制直方图、绘制浴盆曲线等。通过对以上两个方案的整体分析，整个系统比较庞大，需要将它细分为各个子模块， 这样对于原理的了解将更为清楚。</p> 
<h4><strong>4.1 信号调理</strong></h4> 
<p>对于电信号眼图的信号调理电路来说，主要是实现原始串行数据信号的衰减或者放 大，像示波器前端处理电路一样，使用衰减器或者程控放大器实现信号的调理。在输入 ADC 之前，必须将信号限制在 ADC 允许输入电压范围之内，并且尽可能的实现满量程采样， 减小误差。同时，经过调理的信号要实现触发的功能，需要将之输入到触发电路中来实现。 在信号调理的过程中，可以实现滤波器的选择，以期得到稳定的数据信号，以供后续电路 的信号处理，其大致信号处理框图如下所示：</p> 
<p><img alt="" src="https://images2.imgbox.com/8b/67/2EM4d2zh_o.png"></p> 
<p>                                        图28 信号调理电路框图</p> 
<p>上述电路框图中，信号放大部分首先应该实现固定增益的放大，然后再利用控制器对 信号实现程控增益的放大。对于后续的低通滤波模块，应该设置几个档位的 LPF，以实现对不同信号的处理。</p> 
<p>现阶段，电眼图已经满足不了实际应用的需要，在电眼图的基础上要实现光信号眼图 的观测。像光功率计一样，如果要实现光信号的眼图测量，需要将之转化为电信号，通过测量电信号的参数来反映光信号的性能。因此，这里需要用到光电转换器 件，将信号转化为相应的电流信号。然后，再经过电流—电压变换与衰减、放大等处理，以适合ADC 采样与触发电路的触发。</p> 
<h4><strong>4.2 时钟恢复</strong></h4> 
<p>时钟恢复是眼图形成的关键，其基本的功能为：</p> 
<p>（1）从接收到的数据流中恢复出原采样时钟信号</p> 
<p>（2）利用恢复的时钟信号来衡量输入信号的时间、幅度等级等性能</p> 
<p>（3）在输入信号的时间和幅度等特性基础上重新生成数据流，并且与恢复的时钟信号或重新生成的系统时钟同步。现在的宽带示波器一般提供多种时钟恢复方式供选择，其基本介绍如下：</p> 
<p>（1）黄金锁相环（Golden PLL)：一般支持一级或二级 PLL，参数可以随意设置，适合于测试串行信号。</p> 
<p>（2）外时钟恢复方式：适合于源同步信号的测试（如 HDMI)。</p> 
<p>（3）<strong>相位内插器（（phase interpolator，简称 PI））</strong>恢复时钟，如在 PCI Express 测试中。</p> 
<p>测试高速串行数据信号的眼图与抖动的仪器都使用了基于锁相环的时钟恢复方法。依照目前查阅的资料，时钟恢复模块主要分为硬件时钟恢复与软件时钟恢复，前者主要依靠硬件PLL来实现，后者主要利用软件 PLL来实现，其实现原理相似。</p> 
<p><strong>4.2.1 硬件时钟恢复</strong></p> 
<p>硬件 PLL，即锁相环包括鉴相器（phase detector）、环路滤波器（loopfilter）、压控振荡器（voltage controlled oscillator，简称 VCO）三个基本部分组成，其基本的原理框图如 下所示：</p> 
<p><img alt="" src="https://images2.imgbox.com/da/48/0bjPTGAf_o.png"></p> 
<p>                                              图29 锁相环原理框图</p> 
<p>锁相环对于时钟恢复的重要性可以体现在以下几个方面：</p> 
<p>（1）完全集成的，并且不需要外部的参考时钟信号</p> 
<p>（2）确保时钟信号与数据同步</p> 
<p>（3）对时钟信号提供监视功能，当锁相环失锁时提供警报</p> 
<p>（4）优化误码率——调整关于数据信号的时钟相位    举例说明 PLL 带宽对眼图测试的影响：</p> 
<p>为测量某 2.5Gbps 信号，我们分别设置不同的 PLL 带宽，以观测 PLL 带宽对眼图抖 动的影响，如下图所示：</p> 
<p><img alt="" src="https://images2.imgbox.com/82/91/4ZAy1agF_o.png"></p> 
<p>                  图30 示波器在不同 PLL 带宽的条件下测量同一信号的眼图</p> 
<p>由上述测量结果可以知道，<strong>PLL 带宽越高，眼图越清晰，抖动越小</strong>。但是，在 PLL 带宽很大的情况下测试得到的眼图，它是系统的真实反映吗？待测试电路的收发器 RX 端 接收到的、真实的眼图和抖动是什么样呢？因此，我们在测试时必须把示波器的 CDR 参数设置得和待测试电路 RX 端的 CDR 参数完全一致，这样示波器的测量结果才具备参考价 值。</p> 
<p>上述得到在不同带宽下 PLL 对眼图测试抖动的影响，那么，不同阶数的 PLL 对眼图测试有没有影响呢？下图所示为一阶 PLL 与二阶 PLL 在滚降特性方面的对比：</p> 
<p><img alt="" src="https://images2.imgbox.com/41/da/hXk3NX3B_o.png"></p> 
<p>      图31 不同阶数 PLL 的滚降特性</p> 
<p>从上图可以看出，二阶 PLL 有更加陡峭的滚降系数。下图为两者在眼图测试中的影响。</p> 
<p><img alt="" src="https://images2.imgbox.com/f6/c0/rR3KMTR3_o.png"></p> 
<p>             图32 示波器在不同 PLL 设置时测量同一信号的眼图</p> 
<p>从上图 CDR 使用一阶 PLL 或二阶 PLL 的眼图测量结果可以看出，使用二阶 PLL 得到的眼图非常清晰、抖动更小。<strong>二阶 PLL 可以更大程度的减小低频抖动，通常用于带有扩频时钟（SSC）的串行数据信号</strong>，比如计算机主板上的 SATA 和 PCIe。</p> 
<p>综上所述，时钟恢复模块的锁相环（PLL）带宽决定着输入数据中有多少抖动可以传输到恢复的时钟内。PLL 带宽越宽传输到恢复时钟内的抖动就越多，从而会减少眼图中显示的抖动量。这是因为用以触发测量的时钟信号会跟踪数据信号中显示的抖动。较窄的 PLL 带宽会使时钟信号更加干净，产生的眼图也将更精确地显示出输入数据中真实的抖动情况。在测量眼图时，PLL 带宽可以成为有效的高通滤波器。</p> 
<p>在进行眼图测量时使用正确的 PLL 带宽非常重要，各种测量标准都规定了 PLL 需要的确切带宽，下面简要列举了这些标准：</p> 
<p><img alt="" src="https://images2.imgbox.com/66/2d/YTsRFncF_o.png"></p> 
<p>                                          图33 CDR PLL 带宽的各种标准</p> 
<p>4.2.2 软件时钟恢复</p> 
<p>...................</p> 
<p>其他参考：<a href="https://max.book118.com/html/2016/1207/69266135.shtm" rel="nofollow" title="眼图形成及其原理总结.doc">眼图形成及其原理总结.doc</a></p> 
<h3>5 . 多眼图 </h3> 
<p> </p> 
<p><img alt="" height="492" src="https://images2.imgbox.com/05/9b/Vc6iaDUz_o.png" width="837"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d2421da4f5f4ea327b92e0b6b9e5d7d9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">read: Transport endpoint is not connected</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ef9b1bf663eafd9e5221c874d8b5a715/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JAVA线程池的使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>