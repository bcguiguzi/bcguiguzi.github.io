<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>openCV实现拖拽虚拟方块 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="openCV实现拖拽虚拟方块" />
<meta property="og:description" content="一、项目效果： 二、核心流程： openCV读取视频流、在每一帧图片上画一个矩形。使用mediapipe获取手指关键点坐标。根据手指坐标位置和矩形的坐标位置，判断手指点是否在矩形上，如果在则矩形跟随手指移动。 三、代码流程： 环境准备：
python: 3.8.8 opencv: 4.2.0.32 mediapipe: 0.8.10.1 注： opencv版本过高或过低可能出现一些如摄像头打不开、闪退等问题，python版本影响opencv可选择的版本。pip install mediapipe 后可能导致openCV无法正常使用，卸了重新下载，习惯了就好。 1. 读取摄像头视频，画矩形： import cv2 import time import numpy as np # 调用摄像头 0 默认摄像头 cap = cv2.VideoCapture(0) # 初始方块数据 x = 100 y = 100 w = 100 h = 100 # 读取一帧帧照片 while True: # 返回frame图片 rec,frame = cap.read() # 镜像 frame = cv2.flip(frame,1) # 画矩形 cv2.rectangle(frame, (x, y), (x &#43; w, y &#43; h), (255, 0, 255), -1) # 显示画面 cv2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/761daf713ca12c48aeaece5641629adc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-16T21:13:41+08:00" />
<meta property="article:modified_time" content="2024-03-16T21:13:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">openCV实现拖拽虚拟方块</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、项目效果：</h2> 
<p><img src="https://images2.imgbox.com/9b/79/acE2TT50_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="_5"></a>二、核心流程：</h2> 
<ol><li><code>openCV</code>读取视频流、在每一帧图片上画一个矩形。</li><li>使用<code>mediapipe</code>获取手指关键点坐标。</li><li>根据手指坐标位置和矩形的坐标位置，判断手指点是否在矩形上，如果在则矩形跟随手指移动。</li></ol> 
<h2><a id="_10"></a>三、代码流程：</h2> 
<p>环境准备：</p> 
<pre><code class="prism language-sh">python: <span class="token number">3.8</span>.8
opencv: <span class="token number">4.2</span>.0.32
mediapipe: <span class="token number">0.8</span>.10.1
</code></pre> 
<h3><a id="_17"></a>注：</h3> 
<ul><li><code>opencv</code>版本过高或过低可能出现一些如摄像头打不开、闪退等问题，<code>python</code>版本影响<code>opencv</code>可选择的版本。</li><li><code>pip install mediapipe</code> 后可能导致<code>openCV</code>无法正常使用，卸了重新下载，习惯了就好。</li></ul> 
<h3><a id="1__22"></a>1. 读取摄像头视频，画矩形：</h3> 
<pre><code class="prism language-py"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> time
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
 
 
<span class="token comment"># 调用摄像头 0 默认摄像头 </span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
 
<span class="token comment"># 初始方块数据</span>
x <span class="token operator">=</span> <span class="token number">100</span>
y <span class="token operator">=</span> <span class="token number">100</span>
w <span class="token operator">=</span> <span class="token number">100</span>
h <span class="token operator">=</span> <span class="token number">100</span>
 
<span class="token comment"># 读取一帧帧照片</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 返回frame图片</span>
    rec<span class="token punctuation">,</span>frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 镜像</span>
    frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>frame<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 画矩形 </span>
    cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
 
    <span class="token comment"># 显示画面</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span>frame<span class="token punctuation">)</span>
    
    <span class="token comment"># 退出条件</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    
cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre> 
<p>运行这段代码，摄像头打开，我们会惊讶地看到自己英俊的脸庞，且左上角有个<code>100*100</code>的紫色矩形。</p> 
<h3><a id="2_mediapipe_61"></a>2. 导入mediapipe处理手指坐标</h3> 
<pre><code class="prism language-sh">pip <span class="token function">install</span> mediapipe
</code></pre> 
<p><strong>此时可能出现一些问题，比如<code>openCV</code>突然用不了了，没关系，卸载了重新下</strong></p> 
<p><code>mediapipe</code>详细信息：<a href="https://google.github.io/mediapipe/solutions/hands" rel="nofollow">Hands - mediapipe (google.github.io)</a></p> 
<p><img src="https://images2.imgbox.com/5e/54/CkPkk0Q9_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/8a/7a/EVNcOLgg_o.png" alt="在这里插入图片描述"></p> 
<p>简单来说，它会返回给我们21个手指关键点的坐标，即它在视频画面的位置比例( 0~1 )，我们乘以对应画面的宽高，就能得到手指对应的坐标了。</p> 
<p>本次用到食指和中指指尖，也就是8号和12号。</p> 
<h4><a id="21__79"></a>2.1 配置一些基础信息：</h4> 
<pre><code class="prism language-py"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> time
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> mediapipe <span class="token keyword">as</span> mp
 
 
mp_drawing <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>drawing_utils
mp_drawing_styles <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>drawing_styles
mp_hands <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>hands
 
hands <span class="token operator">=</span>  mp_hands<span class="token punctuation">.</span>Hands<span class="token punctuation">(</span>
    static_image_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    max_num_hands<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
    min_detection_confidence<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="22__96"></a>2.2 在处理每一帧图像时，加入：</h4> 
<pre><code class="prism language-py">frame<span class="token punctuation">.</span>flags<span class="token punctuation">.</span>writeable <span class="token operator">=</span> <span class="token boolean">False</span>
    frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
    <span class="token comment"># 返回结果</span>
    results <span class="token operator">=</span> hands<span class="token punctuation">.</span>process<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
 
    frame<span class="token punctuation">.</span>flags<span class="token punctuation">.</span>writeable <span class="token operator">=</span> <span class="token boolean">True</span>
    frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2BGR<span class="token punctuation">)</span>
</code></pre> 
<p>当我们在视频流中读取每一帧图片时，将其从<code>BGR</code>转为<code>RGB</code>供给<code>mediapipe</code>生成的<code>hands</code>对象读取，它会返回这张图片中手指关键点的信息，我们只需要继续对其作画，画在每一帧图片上。</p> 
<pre><code class="prism language-py"><span class="token comment"># 如果结果不为空</span>
    <span class="token keyword">if</span> results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
 
        <span class="token comment"># 遍历双手(根据读取顺序，一只只手遍历、画画)</span>
        <span class="token keyword">for</span> hand_landmarks <span class="token keyword">in</span> results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
            mp_drawing<span class="token punctuation">.</span>draw_landmarks<span class="token punctuation">(</span>
                frame<span class="token punctuation">,</span>
                hand_landmarks<span class="token punctuation">,</span>
                mp_hands<span class="token punctuation">.</span>HAND_CONNECTIONS<span class="token punctuation">,</span>
                mp_drawing_styles<span class="token punctuation">.</span>get_default_hand_landmarks_style<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                mp_drawing_styles<span class="token punctuation">.</span>get_default_hand_connections_style<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="23__120"></a>2.3 至此步骤完整代码</h4> 
<pre><code class="prism language-py"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> time
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> mediapipe <span class="token keyword">as</span> mp
 
 
mp_drawing <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>drawing_utils
mp_drawing_styles <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>drawing_styles
mp_hands <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>hands
 
hands <span class="token operator">=</span>  mp_hands<span class="token punctuation">.</span>Hands<span class="token punctuation">(</span>
    static_image_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    max_num_hands<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
    min_detection_confidence<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
 
 
<span class="token comment"># 调用摄像头 0 默认摄像头 </span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
 
<span class="token comment"># 方块初始数组</span>
x <span class="token operator">=</span> <span class="token number">100</span>
y <span class="token operator">=</span> <span class="token number">100</span>
w <span class="token operator">=</span> <span class="token number">100</span>
h <span class="token operator">=</span> <span class="token number">100</span>
 
 
<span class="token comment"># 读取一帧帧照片</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 返回frame图片</span>
    rec<span class="token punctuation">,</span>frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 镜像</span>
    frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>frame<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    
    
    frame<span class="token punctuation">.</span>flags<span class="token punctuation">.</span>writeable <span class="token operator">=</span> <span class="token boolean">False</span>
    frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
    <span class="token comment"># 返回结果</span>
    results <span class="token operator">=</span> hands<span class="token punctuation">.</span>process<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
 
    frame<span class="token punctuation">.</span>flags<span class="token punctuation">.</span>writeable <span class="token operator">=</span> <span class="token boolean">True</span>
    frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2BGR<span class="token punctuation">)</span>
    
    
    <span class="token comment"># 如果结果不为空</span>
    <span class="token keyword">if</span> results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
 
        <span class="token comment"># 遍历双手(根据读取顺序，一只只手遍历、画画)</span>
        <span class="token comment"># results.multi_hand_landmarks n双手</span>
        <span class="token comment"># hand_landmarks 每只手上21个点信息</span>
        <span class="token keyword">for</span> hand_landmarks <span class="token keyword">in</span> results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
            mp_drawing<span class="token punctuation">.</span>draw_landmarks<span class="token punctuation">(</span>
                frame<span class="token punctuation">,</span>
                hand_landmarks<span class="token punctuation">,</span>
                mp_hands<span class="token punctuation">.</span>HAND_CONNECTIONS<span class="token punctuation">,</span>
                mp_drawing_styles<span class="token punctuation">.</span>get_default_hand_landmarks_style<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                mp_drawing_styles<span class="token punctuation">.</span>get_default_hand_connections_style<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    
    <span class="token comment"># 画矩形 </span>
    cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
 
    <span class="token comment"># 显示画面</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span>frame<span class="token punctuation">)</span>
    
    <span class="token comment"># 退出条件</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    
cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre> 
<p>此时我们运行看一下还挺有意思的：</p> 
<p><img src="https://images2.imgbox.com/f2/c8/QYhSbacx_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="3__201"></a>3. 位置计算</h3> 
<p>我们这个实验要求拖动方块，那肯定也有不拖动的时候，因此不妨根据上一步获取<code>食指(8)</code>和<code>中指(12)</code>指尖的位置，如果这俩离得近，我们就在他与方块重合的时候，根据手指的位置改变方块的坐标。</p> 
<p><img src="https://images2.imgbox.com/28/a6/2v4CNHD7_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_207"></a>完整代码：</h2> 
<h3><a id="_209"></a>首先配置环境</h3> 
<p><img src="https://images2.imgbox.com/d0/a6/RA13QqBt_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_214"></a>代码</h3> 
<pre><code class="prism language-py"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> time
<span class="token keyword">import</span> math
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> mediapipe <span class="token keyword">as</span> mp
 
<span class="token comment"># mediapipe配置</span>
mp_drawing <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>drawing_utils
mp_drawing_styles <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>drawing_styles
mp_hands <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>hands
hands <span class="token operator">=</span>  mp_hands<span class="token punctuation">.</span>Hands<span class="token punctuation">(</span>
    static_image_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    max_num_hands<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
    min_detection_confidence<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
 
 
<span class="token comment"># 调用摄像头 0 默认摄像头 </span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
 
<span class="token comment"># cv2.namedWindow("frame", 0)</span>
<span class="token comment"># cv2.resizeWindow("frame", 960, 640)</span>
 
 
<span class="token comment"># 获取画面宽度、高度</span>
width <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_WIDTH<span class="token punctuation">)</span><span class="token punctuation">)</span>
height <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
 
 
<span class="token comment"># 方块初始数组</span>
x <span class="token operator">=</span> <span class="token number">100</span>
y <span class="token operator">=</span> <span class="token number">100</span>
w <span class="token operator">=</span> <span class="token number">100</span>
h <span class="token operator">=</span> <span class="token number">100</span>
 
L1 <span class="token operator">=</span> <span class="token number">0</span>
L2 <span class="token operator">=</span> <span class="token number">0</span>
 
on_square <span class="token operator">=</span> <span class="token boolean">False</span>
square_color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
 
<span class="token comment"># 读取一帧帧照片</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 返回frame图片</span>
    rec<span class="token punctuation">,</span>frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 镜像</span>
    frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>frame<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    
    
    frame<span class="token punctuation">.</span>flags<span class="token punctuation">.</span>writeable <span class="token operator">=</span> <span class="token boolean">False</span>
    frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
    <span class="token comment"># 返回结果</span>
    results <span class="token operator">=</span> hands<span class="token punctuation">.</span>process<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
 
    frame<span class="token punctuation">.</span>flags<span class="token punctuation">.</span>writeable <span class="token operator">=</span> <span class="token boolean">True</span>
    frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2BGR<span class="token punctuation">)</span>
    
    
    <span class="token comment"># 如果结果不为空</span>
    <span class="token keyword">if</span> results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
 
 
        <span class="token comment"># 遍历双手(根据读取顺序，一只只手遍历、画画)</span>
        <span class="token comment"># results.multi_hand_landmarks n双手</span>
        <span class="token comment"># hand_landmarks 每只手上21个点信息</span>
        <span class="token keyword">for</span> hand_landmarks <span class="token keyword">in</span> results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>
            mp_drawing<span class="token punctuation">.</span>draw_landmarks<span class="token punctuation">(</span>
                frame<span class="token punctuation">,</span>
                hand_landmarks<span class="token punctuation">,</span>
                mp_hands<span class="token punctuation">.</span>HAND_CONNECTIONS<span class="token punctuation">,</span>
                mp_drawing_styles<span class="token punctuation">.</span>get_default_hand_landmarks_style<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                mp_drawing_styles<span class="token punctuation">.</span>get_default_hand_connections_style<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 记录手指每个点的x y 坐标</span>
            x_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            y_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> landmark <span class="token keyword">in</span> hand_landmarks<span class="token punctuation">.</span>landmark<span class="token punctuation">:</span>
                x_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
                y_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
                
            
            <span class="token comment"># 获取食指指尖</span>
            index_finger_x<span class="token punctuation">,</span> index_finger_y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x_list<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> width<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>y_list<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> height<span class="token punctuation">)</span>
 
            <span class="token comment"># 获取中指</span>
            middle_finger_x<span class="token punctuation">,</span>middle_finger_y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x_list<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">*</span> width<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y_list<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">*</span> height<span class="token punctuation">)</span>
 
 
            <span class="token comment"># 计算两指尖距离</span>
            finger_distance <span class="token operator">=</span> math<span class="token punctuation">.</span>hypot<span class="token punctuation">(</span><span class="token punctuation">(</span>middle_finger_x <span class="token operator">-</span> index_finger_x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>middle_finger_y <span class="token operator">-</span> index_finger_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
 
            <span class="token comment"># 如果双指合并(两之间距离近)</span>
            <span class="token keyword">if</span> finger_distance <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">:</span>
 
                <span class="token comment"># X坐标范围 Y坐标范围</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>index_finger_x <span class="token operator">&gt;</span> x <span class="token keyword">and</span> index_finger_x <span class="token operator">&lt;</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>
                        index_finger_y <span class="token operator">&gt;</span> y <span class="token keyword">and</span> index_finger_y <span class="token operator">&lt;</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
 
                    <span class="token keyword">if</span> on_square <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
                        L1 <span class="token operator">=</span> index_finger_x <span class="token operator">-</span> x
                        L2 <span class="token operator">=</span> index_finger_y <span class="token operator">-</span> y
                        square_color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
                        on_square <span class="token operator">=</span> <span class="token boolean">True</span>
 
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 双指不合并/分开</span>
                on_square <span class="token operator">=</span> <span class="token boolean">False</span>
                square_color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
 
            <span class="token comment"># 更新坐标</span>
            <span class="token keyword">if</span> on_square<span class="token punctuation">:</span>
                x <span class="token operator">=</span> index_finger_x <span class="token operator">-</span> L1
                y <span class="token operator">=</span> index_finger_y <span class="token operator">-</span> L2
            
            
 
    <span class="token comment"># 图像融合 使方块不遮挡视频图片</span>
    overlay <span class="token operator">=</span> frame<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> square_color<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>addWeighted<span class="token punctuation">(</span>overlay<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> frame<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    
 
    <span class="token comment"># 显示画面</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span>frame<span class="token punctuation">)</span>
    
    <span class="token comment"># 退出条件</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    
cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bf9cb302a48492c300a6705b804c4ad3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PyTorch学习笔记之基础函数篇（十四）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1a68e57d40abe5bc673243f328072c0e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MATLAB是什么，它主要用于什么？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>