<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在树莓派4B上使用C&#43;&#43;和OpenCV - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在树莓派4B上使用C&#43;&#43;和OpenCV" />
<meta property="og:description" content="目录
前言
树莓派上的C&#43;&#43;
OpenCV的安装
Ⅰ下载opencv（命令窗口）
Ⅱ安装依赖包
Ⅲ配置安装路径并编译
Ⅳ配置OpenCV环境
程序运行验证
Ⅰ创建cpp文件
Ⅱ编写cpp文件
Ⅲ使用g&#43;&#43;编译：
Ⅳ运行
参考资料与致谢
前言 本人最近在重温C&#43;&#43;，由于之前使用树莓派&#43;Python&#43;OpenCV做了一些项目，所以想将Python换成C&#43;&#43;实现一遍。写这篇文章的目的有两个，一是可以记录自己的学习过程，防止以后用到忘记而花费大量时间踩坑；二是可以帮助有同样想法的人避免踩坑。
树莓派上的C&#43;&#43; 树莓派自带C&#43;&#43;的编译g&#43;&#43;，如没有，可以采用下面命令安装。
sudo apt-get install g&#43;&#43; OpenCV的安装 Ⅰ下载opencv（命令窗口） git clone https://github.com/opencv/opencv.git Ⅱ安装依赖包 sudo apt-get install cmake sudo apt-get install build-essential libgtk2.0-dev libavcodec-dev libavformat-dev libjpeg-dev libswscale-dev libtiff5-dev sudo apt-get install libgtk2.0-dev sudo apt-get install pkg-config Ⅲ配置安装路径并编译 ①打开OpenCV安装的路径，我的是/home/pi/opencv.
cd /home/pi/opencv ②编译，时间很长，耐心等待（OpenCV4默认不生成.pc文件，这里设置一下才行，免得后面再补）
mkdir build cd build cmake -DCMAKE_BUILD_TYPE=Release -DOPENCV_GENERATE_PKGCONFIG=ON -DCMAKE_INSTALL_PREFIX=/usr/local .. sudo make sudo make install Ⅳ配置OpenCV环境 ①在/etc/ld." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/5c075083e927c084747b49c6227351c4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-19T17:38:25+08:00" />
<meta property="article:modified_time" content="2022-11-19T17:38:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在树莓派4B上使用C&#43;&#43;和OpenCV</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
<p id="%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E7%9A%84C%2B%2B-toc" style="margin-left:0px;"><a href="#%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E7%9A%84C%2B%2B" rel="nofollow">树莓派上的C++</a></p> 
<p id="OpenCV%E7%9A%84%E5%AE%89%E8%A3%85-toc" style="margin-left:0px;"><a href="#OpenCV%E7%9A%84%E5%AE%89%E8%A3%85" rel="nofollow">OpenCV的安装</a></p> 
<p id="%E2%85%A0%E4%B8%8B%E8%BD%BDopencv%EF%BC%88%E5%91%BD%E4%BB%A4%E7%AA%97%E5%8F%A3%EF%BC%89-toc" style="margin-left:40px;"><a href="#%E2%85%A0%E4%B8%8B%E8%BD%BDopencv%EF%BC%88%E5%91%BD%E4%BB%A4%E7%AA%97%E5%8F%A3%EF%BC%89" rel="nofollow">Ⅰ下载opencv（命令窗口）</a></p> 
<p id="%E2%85%A1%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85-toc" style="margin-left:40px;"><a href="#%E2%85%A1%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85" rel="nofollow">Ⅱ安装依赖包</a></p> 
<p id="%E2%85%A2%E9%85%8D%E7%BD%AE%E5%AE%89%E8%A3%85%E8%B7%AF%E5%BE%84%E5%B9%B6%E7%BC%96%E8%AF%91-toc" style="margin-left:40px;"><a href="#%E2%85%A2%E9%85%8D%E7%BD%AE%E5%AE%89%E8%A3%85%E8%B7%AF%E5%BE%84%E5%B9%B6%E7%BC%96%E8%AF%91" rel="nofollow">Ⅲ配置安装路径并编译</a></p> 
<p id="%E2%85%A3%E9%85%8D%E7%BD%AEOpenCV%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px;"><a href="#%E2%85%A3%E9%85%8D%E7%BD%AEOpenCV%E7%8E%AF%E5%A2%83" rel="nofollow">Ⅳ配置OpenCV环境</a></p> 
<p id="%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E9%AA%8C%E8%AF%81-toc" style="margin-left:0px;"><a href="#%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E9%AA%8C%E8%AF%81" rel="nofollow">程序运行验证</a></p> 
<p id="%E2%85%A0%E5%88%9B%E5%BB%BAcpp%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E2%85%A0%E5%88%9B%E5%BB%BAcpp%E6%96%87%E4%BB%B6" rel="nofollow">Ⅰ创建cpp文件</a></p> 
<p id="%E2%85%A1%E7%BC%96%E5%86%99cpp%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E2%85%A1%E7%BC%96%E5%86%99cpp%E6%96%87%E4%BB%B6" rel="nofollow">Ⅱ编写cpp文件</a></p> 
<p id="%E2%85%A2%E4%BD%BF%E7%94%A8g%2B%2B%E7%BC%96%E8%AF%91%EF%BC%9A-toc" style="margin-left:40px;"><a href="#%E2%85%A2%E4%BD%BF%E7%94%A8g%2B%2B%E7%BC%96%E8%AF%91%EF%BC%9A" rel="nofollow">Ⅲ使用g++编译：</a></p> 
<p id="%E2%85%A3%E8%BF%90%E8%A1%8C-toc" style="margin-left:40px;"><a href="#%E2%85%A3%E8%BF%90%E8%A1%8C" rel="nofollow">Ⅳ运行</a></p> 
<p id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99%E4%B8%8E%E8%87%B4%E8%B0%A2-toc" style="margin-left:0px;"><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99%E4%B8%8E%E8%87%B4%E8%B0%A2" rel="nofollow">参考资料与致谢</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E5%89%8D%E8%A8%80">前言</h2> 
<p>本人最近在重温C++，由于之前使用树莓派+Python+OpenCV做了一些项目，所以想将Python换成C++实现一遍。写这篇文章的目的有两个，一是可以记录自己的学习过程，防止以后用到忘记而花费大量时间踩坑；二是可以帮助有同样想法的人避免踩坑。</p> 
<h2 id="%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E7%9A%84C%2B%2B">树莓派上的C++</h2> 
<p>树莓派自带C++的编译g++，如没有，可以采用下面命令安装。</p> 
<pre><code class="hljs">sudo apt-get install g++</code></pre> 
<h2 id="OpenCV%E7%9A%84%E5%AE%89%E8%A3%85">OpenCV的安装</h2> 
<h3 id="%E2%85%A0%E4%B8%8B%E8%BD%BDopencv%EF%BC%88%E5%91%BD%E4%BB%A4%E7%AA%97%E5%8F%A3%EF%BC%89">Ⅰ下载opencv（命令窗口）</h3> 
<pre><code class="hljs">git clone https://github.com/opencv/opencv.git</code></pre> 
<h3 id="%E2%85%A1%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85"><strong>Ⅱ安装依赖包</strong></h3> 
<pre><code class="hljs">sudo apt-get install cmake
sudo apt-get install build-essential libgtk2.0-dev libavcodec-dev libavformat-dev libjpeg-dev libswscale-dev libtiff5-dev
sudo apt-get install libgtk2.0-dev
sudo apt-get install pkg-config</code></pre> 
<h3 id="%E2%85%A2%E9%85%8D%E7%BD%AE%E5%AE%89%E8%A3%85%E8%B7%AF%E5%BE%84%E5%B9%B6%E7%BC%96%E8%AF%91">Ⅲ配置安装路径并编译</h3> 
<p>①打开OpenCV安装的路径，我的是/home/pi/opencv.</p> 
<pre><code class="hljs"> cd /home/pi/opencv</code></pre> 
<p>②编译，时间很长，耐心等待（OpenCV4默认不生成.pc文件，这里设置一下才行，免得后面再补）</p> 
<pre><code class="hljs">mkdir build
cd build
cmake -DCMAKE_BUILD_TYPE=Release -DOPENCV_GENERATE_PKGCONFIG=ON -DCMAKE_INSTALL_PREFIX=/usr/local ..
sudo make
sudo make install</code></pre> 
<h3 id="%E2%85%A3%E9%85%8D%E7%BD%AEOpenCV%E7%8E%AF%E5%A2%83">Ⅳ配置OpenCV环境</h3> 
<p>①在/etc/ld.so.conf.d/文件夹下新建一个opencv4.conf，里面写入/usr/local/lib.</p> 
<pre><code class="hljs">cd /etc/ld.so.conf.d/
sudo touch opencv4.conf
sudo sh -c 'echo "/usr/local/lib" &gt; opencv4.conf'</code></pre> 
<p>②更新pkg-config.</p> 
<pre><code class="hljs">sudo ldconfig</code></pre> 
<p>③复制opencv.pc文件到/usr/lib/pkgconfig/下，可能是在/usr/local/lib/pkgconfig/opencv4.pc，也可能在/usr/local/lib64/pkgconfig/opencv4.pc文件下，记住一定要<strong>去查看。</strong></p> 
<pre><code class="hljs">sudo cp -f /usr/local/lib64/pkgconfig/opencv4.pc  /usr/lib/pkgconfig/</code></pre> 
<pre><code>sudo cp -f /usr/local/lib/pkgconfig/opencv4.pc  /usr/lib/pkgconfig/</code></pre> 
<p>④添加环境变量</p> 
<p>方法一：</p> 
<pre><code class="hljs">sudo vim /etc/bash.bashrc</code></pre> 
<p>可能出现“sudo: vim：找不到命令”，安装即可。</p> 
<pre><code class="hljs">sudo apt-get install vim</code></pre> 
<p>在文件末尾添加：</p> 
<pre><code>PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/lib/pkgconfig
export PKG_CONFIG_PATH</code></pre> 
<p>方法二：</p> 
<pre><code class="hljs">sudo gedit /etc/bash.bashrc
</code></pre> 
<p>同样可能出现“sudo: gedit：找不到命令”，安装即可。</p> 
<pre><code class="hljs">sudo apt-get install gedit</code></pre> 
<p>在文件末尾添加：</p> 
<pre><code class="hljs">PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/lib/pkgconfig
export PKG_CONFIG_PATH</code></pre> 
<p>这样就安装好了，测试：</p> 
<pre><code class="hljs">pkg-config --modversion opencv4</code></pre> 
<p>出现4.6.0，安装成功！</p> 
<h2 id="%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E9%AA%8C%E8%AF%81">程序运行验证</h2> 
<h3 id="%E2%85%A0%E5%88%9B%E5%BB%BAcpp%E6%96%87%E4%BB%B6">Ⅰ创建cpp文件</h3> 
<pre><code class="hljs">cd</code></pre> 
<p>回到最初路径或者关闭重新打开。</p> 
<pre><code class="language-cpp">sudo gedit test.cpp</code></pre> 
<h3 id="%E2%85%A1%E7%BC%96%E5%86%99cpp%E6%96%87%E4%BB%B6">Ⅱ编写cpp文件</h3> 
<p>这是一个直接调用摄像头的程序，需要树莓派外接摄像头。</p> 
<pre><code class="language-cpp">#include &lt;opencv2/imgcodecs.hpp&gt;
#include &lt;opencv2/highgui.hpp&gt;
#include &lt;opencv2/imgproc.hpp&gt;
#include &lt;iostream&gt;

using namespace cv;
using namespace std;

int main()
{
	VideoCapture cap(0);
	Mat img;
	while (true)
	{
		cap.read(img);
		imshow("Image", img);
		waitKey(1);
	}
    return 0;
}</code></pre> 
<p>如果没有摄像头，也没有图片，这里提供一个绘图的程序。</p> 
<pre><code class="language-cpp">#include &lt;opencv2/imgcodecs.hpp&gt;
#include &lt;opencv2/highgui.hpp&gt;
#include &lt;opencv2/imgproc.hpp&gt;
#include &lt;iostream&gt;

using namespace cv;
using namespace std;

int main()
{
	Mat img(512, 512, CV_8UC3, Scalar(255, 255, 255));
	circle(img, Point(256, 256), 256, Scalar(0, 0, 255), FILLED);
	Rect roi(128, 128, 256, 256);
	rectangle(img, roi, Scalar(255, 255, 255), FILLED);
	line(img, Point(256, 128), Point(256, 256), Scalar(255, 255, 0), 3);
	putText(img, "I'am CV", Point(256, 128), FONT_HERSHEY_DUPLEX, 1, Scalar(0, 0, 0), 2);
	imshow("img", img);
	waitKey(0);
    return 0;
}</code></pre> 
<h3 id="%E2%85%A2%E4%BD%BF%E7%94%A8g%2B%2B%E7%BC%96%E8%AF%91%EF%BC%9A">Ⅲ使用g++编译：</h3> 
<pre><code class="language-cpp">g++ test.cpp -o test `pkg-config --cflags --libs opencv4`</code></pre> 
<p>这里可能会报错，c++ 中——fatal error: opencv2/opencv.hpp: No such file or directory #include ＜opencv2/opencv.hpp＞。</p> 
<p>这是因为OpenCV头文件的路径中多了一个opencv4：/usr/local/include/opencv4/opencv2</p> 
<p>可以将opencv2文件夹复制到/usr/include.</p> 
<pre><code class="language-cpp">\cp -rf /usr/include/opencv4/* /usr/include</code></pre> 
<h3 id="%E2%85%A3%E8%BF%90%E8%A1%8C">Ⅳ运行</h3> 
<pre><code class="language-cpp">sudo ./test</code></pre> 
<h2 id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99%E4%B8%8E%E8%87%B4%E8%B0%A2">参考资料与致谢</h2> 
<p>本文主要参考了两篇文章，感谢两位大佬！</p> 
<p><a href="https://blog.csdn.net/lkh999999/article/details/126029243?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166882452416800186517339%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=166882452416800186517339&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-4-126029243-null-null.142%5Ev65%5Econtrol,201%5Ev3%5Econtrol_1,213%5Ev2%5Et3_esquery_v2&amp;utm_term=%E6%A0%91%E8%8E%93%E6%B4%BEC%2B%2B&amp;spm=1018.2226.3001.4187" title="树莓派C++语言通过opencv调用csi摄像头显示图像_一坨小白菜的博客-CSDN博客">树莓派C++语言通过opencv调用csi摄像头显示图像_一坨小白菜的博客-CSDN博客</a></p> 
<p><a href="https://zhuanlan.zhihu.com/p/150807054" rel="nofollow" title="关于ArchLinux和manjaro在安装opencv时的过程与踩坑 - 知乎 (zhihu.com)">关于ArchLinux和manjaro在安装opencv时的过程与踩坑 - 知乎 (zhihu.com)</a></p> 
<p>行文潦草，如有错误欢迎指出！</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8076b87620bae44b9fd1df9a438f8b2f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Hive的查询基本操作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e0f877f3741d591dd1b514d4dca978a6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">求问题解答 HTTP Status 500 - java.lang.NullPointerException</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>