<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Python爬虫】Python 爬虫的学习和案例，一篇文章带你了解爬虫的密码 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Python爬虫】Python 爬虫的学习和案例，一篇文章带你了解爬虫的密码" />
<meta property="og:description" content="爬虫基础 我们可以把互联网比作一张大网，而爬虫（即网络爬虫）便是在网上爬行的蜘蛛。把网的节点比作一个个网页，爬虫爬到这就相当于访问了该页面，获取了其信息。可以把节点的连线比作网页与网页之间的链接关系，这样蜘蛛通过一个节点后，可以顺着节点连线继续爬行到下一个节点，即通过一个网页继续获取后续的网页，这样整个网的节点便可以被蜘蛛全部爬行到，网站的数据就可以被抓取下来了。
为什么学习爬虫 为了装x
爬虫概述 简单来说，爬虫就是获取网页并提取和保存信息的自动化程序
获取网页 爬虫首先要做的就是爬取网页，这里就是获取网页的源代码，源代码里包含了网页的部分有用信息，所以只要把源代码获取下来，就可以从中提取想要的信息了。
提取信息 获取网页源代码后，接下来就是分析网页源代码，从中提取我们想要的数据。
首先，最通用的方法就是采用正则表达式提取，这是一个万能的方法，但是在构造正则表达式时比较复杂且容易出错另外由于网页的结构有一定的规则，所以还有一些根据网页节点属性、CSS选择器或XPath来提取网页信息的库，如
BeautifulSoup，pyquery，lxml 等。使用这些库，我们可以高效快速地从中提取网页信息，如节点的属性、文本值等 提取信息是爬虫非常重要的部分，它可以使复杂的数据变得条理清晰，以便我们后续处理和分析数据。
保存数据 提取信息后，我们一般会将提取到的数据保存到某处以便后续使用。这里保存形式有多种多样，如可以简单保存为txt文本或 json 文本，也可以保存到数据库，如 MySQL 和 MongoDB 等，也可以保存至远程服务器，如借助SFTP进行操作等
自动化程序 说到自动化程序，意思是说爬虫可以代替人来完成这些操作。首先，我们手工当然可以提取到这些信息，但是当量特别大或者想快速获取大量数据的话，肯定还是要借助程序。爬虫就是代替我们来完成这份爬取工作的自动化程序，它可以在抓取过程中进行各种异常处理、错误重试等草垛，确保爬取持续高效的运行。
能爬取怎样的数据 在网页中我们能看到各种各样的信息，最常见的便是常规网页，它们对应着HTML代码，而最常抓取的便是HTML源代码
另外，可能有些网页返回的不是HTML代码，而是一个JSON字符串（其中API接口大多采用这样的形式），这种格式的数据方便传输和解析，它们同样可以抓取，而且数据提取更方便
此外，我们还可以看到各种二进制数据，如图片、视频和音频等。利用爬虫，我们可以将这些二进制数据抓取下来，最后保存成对应的文件名。
另外，还可以看到各种扩展名的文件，如CSS、JavaScript和配置文件等，这些其实也是最普通的文件，只要在浏览器里面可以访问到，就可以将其抓取下来
上述内容其实都对应各自的URL，是基于HTTP或HTTPS协议的，只要是这种数据，爬虫都可以抓取
对于爬虫来说，用于爬虫爬取速度过快，在爬取过程中可能遇到同一个IP访问过于频繁的问题，此时网站就会让我们输入验证码登录或者直接封锁IP，这样会给爬取带来机打的不便
使用代理隐藏真实的IP，让服务器误以为是代理服务器在请求自己。这样在爬取过程中通过不断更换代理，就不会被封锁，可以达到很好的爬取效果
urllib urllib urllib库，是Python内置的HTTP请求库，不需要额外安装，它包含如下四个模块
request ：它是最基本的HTTP请求模块，可以用来模拟发送请求。就像在浏览器里输入网址一样，只需要给库方法传入URL以及额外的参数，就可以模拟实现这个过程了
error ：异常处理模块，如果出翔请求错误，我们可以捕获这些异常，然后进行重试或其他操作以保证程序不会意外终止
parse ：一个工具模块，提供了许多URL处理方法，比如拆分，解析，合并等
rebotparser ：主要是用来识别网站的robots.txt文件，然后判断哪些网站不可以爬，用得比较少
发送请求 使用urllib的request模块，我们可以方便的实现请求发送并得到响应，
urlopen urllib.request模块提供了最基本的构造HTTP请求的方法，利用它可以模拟浏览器的一个请求发起过程，同时它还带有处理授权验证（authentication）、重定向（redirect）、浏览器Cookies以及其他内容
基本使用 import urllib.request response = urllib.request.urlopen(&#39;https://www.python.org&#39;) html = response.read().decode(&#39;utf-8&#39;) print(type(response)) # &lt;class &#39;http.client.HTTPResponse&#39;&gt; 它是一个HTTPResponse类型的对象，主要包含read、readinto、getheader、getheaders、fileno等方法，以及msg、version、status、reason、debuglevel、closed等属性
调用 read 方法可以得到返回的网页内容，调用 status 属性可以得到返回结果的状态码， 200 代表请求成功，404 代表网页未找到等。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/2e517033a928ac726e092a1e92ac6014/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-17T15:39:54+08:00" />
<meta property="article:modified_time" content="2023-05-17T15:39:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Python爬虫】Python 爬虫的学习和案例，一篇文章带你了解爬虫的密码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>爬虫基础</h2> 
<p>我们可以把互联网比作一张大网，而爬虫（即网络爬虫）便是在网上爬行的蜘蛛。把网的节点比作一个个网页，爬虫爬到这就相当于访问了该页面，获取了其信息。可以把节点的连线比作网页与网页之间的链接关系，这样蜘蛛通过一个节点后，可以顺着节点连线继续爬行到下一个节点，即通过一个网页继续获取后续的网页，这样整个网的节点便可以被蜘蛛全部爬行到，网站的数据就可以被抓取下来了。</p> 
<h3><a id="_3"></a>为什么学习爬虫</h3> 
<p>为了装x</p> 
<h3><a id="_6"></a>爬虫概述</h3> 
<p>简单来说，爬虫就是获取网页并提取和保存信息的自动化程序</p> 
<h4><a id="_9"></a>获取网页</h4> 
<p>爬虫首先要做的就是爬取网页，这里就是获取网页的源代码，源代码里包含了网页的部分有用信息，所以只要把源代码获取下来，就可以从中提取想要的信息了。</p> 
<h4><a id="_12"></a>提取信息</h4> 
<p>获取网页源代码后，接下来就是分析网页源代码，从中提取我们想要的数据。</p> 
<ul><li>首先，最通用的方法就是采用正则表达式提取，这是一个万能的方法，但是在构造正则表达式时比较复杂且容易出错</li><li>另外由于网页的结构有一定的规则，所以还有一些根据网页节点属性、CSS选择器或XPath来提取网页信息的库，如<br> BeautifulSoup，pyquery，lxml 等。使用这些库，我们可以高效快速地从中提取网页信息，如节点的属性、文本值等</li></ul> 
<p>提取信息是爬虫非常重要的部分，它可以使复杂的数据变得条理清晰，以便我们后续处理和分析数据。</p> 
<h4><a id="_21"></a>保存数据</h4> 
<p>提取信息后，我们一般会将提取到的数据保存到某处以便后续使用。这里保存形式有多种多样，如可以简单保存为txt文本或 json 文本，也可以保存到数据库，如 MySQL 和 MongoDB 等，也可以保存至远程服务器，如借助SFTP进行操作等</p> 
<h4><a id="_24"></a>自动化程序</h4> 
<p>说到自动化程序，意思是说爬虫可以代替人来完成这些操作。首先，我们手工当然可以提取到这些信息，但是当量特别大或者想快速获取大量数据的话，肯定还是要借助程序。爬虫就是代替我们来完成这份爬取工作的自动化程序，它可以在抓取过程中进行各种异常处理、错误重试等草垛，确保爬取持续高效的运行。</p> 
<h3><a id="_27"></a>能爬取怎样的数据</h3> 
<p>在网页中我们能看到各种各样的信息，最常见的便是常规网页，它们对应着HTML代码，而最常抓取的便是HTML源代码</p> 
<p>另外，可能有些网页返回的不是HTML代码，而是一个JSON字符串（其中API接口大多采用这样的形式），这种格式的数据方便传输和解析，它们同样可以抓取，而且数据提取更方便</p> 
<p>此外，我们还可以看到各种二进制数据，如图片、视频和音频等。利用爬虫，我们可以将这些二进制数据抓取下来，最后保存成对应的文件名。</p> 
<p>另外，还可以看到各种扩展名的文件，如CSS、JavaScript和配置文件等，这些其实也是最普通的文件，只要在浏览器里面可以访问到，就可以将其抓取下来</p> 
<p>上述内容其实都对应各自的URL，是基于HTTP或HTTPS协议的，只要是这种数据，爬虫都可以抓取</p> 
<p>对于爬虫来说，用于爬虫爬取速度过快，在爬取过程中可能遇到同一个IP访问过于频繁的问题，此时网站就会让我们输入验证码登录或者直接封锁IP，这样会给爬取带来机打的不便</p> 
<p>使用代理隐藏真实的IP，让服务器误以为是代理服务器在请求自己。这样在爬取过程中通过不断更换代理，就不会被封锁，可以达到很好的爬取效果</p> 
<h3><a id="urllib_42"></a>urllib</h3> 
<h4><a id="urllib_43"></a>urllib</h4> 
<p>urllib库，是Python内置的HTTP请求库，不需要额外安装，它包含如下四个模块</p> 
<p>request ：它是最基本的HTTP请求模块，可以用来模拟发送请求。就像在浏览器里输入网址一样，只需要给库方法传入URL以及额外的参数，就可以模拟实现这个过程了</p> 
<p>error ：异常处理模块，如果出翔请求错误，我们可以捕获这些异常，然后进行重试或其他操作以保证程序不会意外终止</p> 
<p>parse ：一个工具模块，提供了许多URL处理方法，比如拆分，解析，合并等</p> 
<p>rebotparser ：主要是用来识别网站的robots.txt文件，然后判断哪些网站不可以爬，用得比较少</p> 
<h4><a id="_54"></a>发送请求</h4> 
<p>使用urllib的request模块，我们可以方便的实现请求发送并得到响应，</p> 
<h4><a id="urlopen_57"></a>urlopen</h4> 
<p>urllib.request模块提供了最基本的构造HTTP请求的方法，利用它可以模拟浏览器的一个请求发起过程，同时它还带有处理授权验证（authentication）、重定向（redirect）、浏览器Cookies以及其他内容</p> 
<h4><a id="_60"></a>基本使用</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request  

response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'https://www.python.org'</span><span class="token punctuation">)</span>
html <span class="token operator">=</span> response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># &lt;class 'http.client.HTTPResponse'&gt;</span>
</code></pre> 
<p>它是一个HTTPResponse类型的对象，主要包含read、readinto、getheader、getheaders、fileno等方法，以及msg、version、status、reason、debuglevel、closed等属性</p> 
<p>调用 read 方法可以得到返回的网页内容，调用 status 属性可以得到返回结果的状态码， 200 代表请求成功，404 代表网页未找到等。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request  

response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'https://www.python.org'</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>getheaders<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>getheader<span class="token punctuation">(</span><span class="token string">'Server'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 得到以下结果</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">200</span>  
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Server'</span><span class="token punctuation">,</span> <span class="token string">'nginx'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'X-Frame-Options'</span><span class="token punctuation">,</span> <span class="token string">'SAMEORIGIN'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   
    <span class="token punctuation">(</span><span class="token string">'X-Clacks-Overhead'</span><span class="token punctuation">,</span> <span class="token string">'GNU Terry Pratchett'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">,</span> <span class="token string">'47397'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Accept-Ranges'</span><span class="token punctuation">,</span> <span class="token string">'bytes'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   
    <span class="token punctuation">(</span><span class="token string">'Date'</span><span class="token punctuation">,</span> <span class="token string">'Mon, 01 Aug 2016 09:57:31 GMT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Via'</span><span class="token punctuation">,</span> <span class="token string">'1.1 varnish'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Age'</span><span class="token punctuation">,</span> <span class="token string">'2473'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Connection'</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   
    <span class="token punctuation">(</span><span class="token string">'X-Served-By'</span><span class="token punctuation">,</span> <span class="token string">'cache-lcy1125-LCY'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'X-Cache'</span><span class="token punctuation">,</span> <span class="token string">'HIT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'X-Cache-Hits'</span><span class="token punctuation">,</span> <span class="token string">'23'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Vary'</span><span class="token punctuation">,</span> <span class="token string">'Cookie'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   
    <span class="token punctuation">(</span><span class="token string">'Strict-Transport-Security'</span><span class="token punctuation">,</span> <span class="token string">'max-age=63072000; includeSubDomains'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  
nginx
</code></pre> 
<p>前两个分别输出了相应的状态码和头信息，最后一个输出通过调用getheader方法并传递一个参数Server获取了响应头中的Server值，结果是Nginx，意思是服务器是用Nginx搭建的</p> 
<p>利用最基本的urlopen方法，可以完成最基本的简单网页的GET请求抓取</p> 
<h4><a id="_95"></a>参数</h4> 
<pre><code class="prism language-python">urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>timeout<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">,</span> cafile<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> capath<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> cadefault<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="1data_100"></a>1、data参数</h5> 
<p>data参数是可选的。如果要添加改参数，需要使用bytes方法将参数转化为字节流编码格式的内容，即bytes类型。另外，如果传递了这个参数，则它的请求方式就不再是GET请求，而是POST请求</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse  
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request  

data <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'word'</span><span class="token punctuation">:</span> <span class="token string">'hello'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>  
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/post'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre> 
<p>这里我们传递了一个参数 word，值是 hello。它需要被转码成 bytes（字节流）类型。其中转字节流采用了 bytes 方法，该方法的第一个参数需要是 str（字符串）类型，需要用 urllib.parse 模块里的 urlencode 方法来将参数字典转化为字符串；第二个参数指定编码格式，这里指定为 utf8。</p> 
<p>在这里请求的站点是 httpbin.org，它可以提供 HTTP 请求测试，本次我们请求的 URL 为：http://httpbin.org/post，这个链接可以用来测试 POST 请求，它可以输出 Request 的一些信息，其中就包含我们传递的 data 参数</p> 
<h5><a id="2timeout_115"></a>2、timeout参数</h5> 
<p>timeout参数用于设置超时时间，单位为秒，意思就是如果请求超出了设置的这个时间，还没有得到响应，就会抛出异常。如果不指定该参数，就会使用全局默认时间。它支持HTTP、HTTPS、FTP请求</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request  

response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/get'</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<pre><code class="prism language-python">During handling of the above exception<span class="token punctuation">,</span> another exception occurred<span class="token punctuation">:</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span> File <span class="token string">"/var/py/python/urllibtest.py"</span><span class="token punctuation">,</span> line <span class="token number">4</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span> response <span class="token operator">=</span>
urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/get'</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
urllib<span class="token punctuation">.</span>error<span class="token punctuation">.</span>URLError<span class="token punctuation">:</span> <span class="token operator">&lt;</span>urlopen error timed out<span class="token operator">&gt;</span>
</code></pre> 
<p>这里我们设置超时时间是1秒，程度一秒过后，服务器依然没有响应，于是抛出了URLError异常。该异常属于urllib.error模块，错误原因是超时。因此我们可以使用异常处理</p> 
<h5><a id="3_135"></a>3、其他参数</h5> 
<p>除了data参数和timeout参数外，还有context参数，它必须是ssl.SSLContext类型，用来指定SSL设置</p> 
<p>此外，cafile和capath这两个参数分别制定CA证书和它的路劲，这个在请求HTTPS链接时会有用</p> 
<h5><a id="4_141"></a>4、官方文档</h5> 
<blockquote> 
 <p>https://docs.python.org/3/library/urllib.request.html</p> 
</blockquote> 
<h4><a id="request_145"></a>request</h4> 
<p>urlopen方法可以实现最基本请求的发起，但这几个简单的参数并不足以构建一个完整的请求，如果请求中需要加入Headers等信息，就可以利用更强大的Request类来构建</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request  
  
request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span><span class="token string">'https://python.org'</span><span class="token punctuation">)</span>  
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>我们依然是用urlopen方法来发送这个请求，只不过这次该方法的参数不再是URL，而是一个Request类型的对象。通过构造这个数据结构，一方面我们可以将请求独立成一个对象，另一方面可更加丰富灵活地配置参数</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">urllib</span><span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> origin_req_host<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> unverifiable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>第一个参数url用于请求URL，这是必传参数，其他都是可选参数</li><li>第二个参数data如果要传，必须传bytes（字节流）类型的。如果它是字典，可以先用urllib.parse模块里的urlencode()编码</li><li>第三个参数headers是一个字典，它就是请求头，我们可以在构造请求时通过headers参数直接构造，也可以通过调用请求实例的add_headers()<br> 方法添加</li><li>添加请求头最常用的用法就是通过修改User-Agent来伪装浏览器，默认的User-Agent是Python-urllib，我们可以通过修改它来伪装浏览器。</li><li>第四个参数 origin_req_host 指的是请求方的 host 名称或者 IP 地址。</li><li>第五个参数unverifiable表示这个请求是否是无法验证的，默认为False，意思就是说用户没有足够的权限来选择接受这个请求的结果。例如，我们请求一个HTML文档中的图片，但是我们没有自动抓取图像的权限，这时unverifiable<br> 的值就是 True。</li><li>第六个参数method是一个字符串，用来指定请求使用的方法，比如GET、POST、PUT等</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span> parse  

url <span class="token operator">=</span> <span class="token string">'http://httpbin.org/post'</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)'</span><span class="token punctuation">,</span>
    <span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'httpbin.org'</span>  

 <span class="token operator">-</span> List item

<span class="token punctuation">}</span>
<span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Germey'</span><span class="token punctuation">}</span>
data <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

req <span class="token operator">=</span> request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">)</span>
response <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_189"></a>高级用法</h4> 
<p>Handler。简而言之，我们可以把它理解为各种处理器，有专门处理登录验证的，有处理Cookies的，有处理代理设置的。利用他们，我们几乎可以做到HTTP请求中所有的事情</p> 
<ul><li>urllib.request模块里的BaseHandler类，它是所有其他Handler的父类，它提供了最基本的方法，例如default_open、protocol_request等</li><li>HTTPDefaultErrorHandler 用于处理 HTTP 响应错误，错误都会抛出 HTTPError 类型的异常。</li><li>HTTPRedirectHandler 用于处理重定向。</li><li>HTTPCookieProcessor 用于处理 Cookies。</li><li>ProxyHandler 用于设置代理，默认代理为空。</li><li>HTTPPasswordMgr 用于管理密码，它维护了用户名密码的表。</li><li>HTTPBasicAuthHandler 用于管理认证，如果一个链接打开时需要认证，那么可以用它来解决认证问题。</li><li>官方文档：https://docs.python.org/3/library/urllib.request.html#urllib.request.BaseHandler</li></ul> 
<h5><a id="1_201"></a>1、验证</h5> 
<p>有些网站在打开时就会弹出提示框，直接提示输入用户名和密码，验证成功才能查看页面，如果要请求这样的页面，需要借助HTTPBasicAuthHandler就可以完成</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>request <span class="token keyword">import</span> HTTPPasswordMgrWithDefaultRealm<span class="token punctuation">,</span> HTTPBasicAuthHandler<span class="token punctuation">,</span> build_opener  
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>error <span class="token keyword">import</span> URLError  

username <span class="token operator">=</span> <span class="token string">'username'</span>  
password <span class="token operator">=</span> <span class="token string">'password'</span>  
url <span class="token operator">=</span> <span class="token string">'http://localhost:5000/'</span>  

p <span class="token operator">=</span> HTTPPasswordMgrWithDefaultRealm<span class="token punctuation">(</span><span class="token punctuation">)</span>  
p<span class="token punctuation">.</span>add_password<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span>  
auth_handler <span class="token operator">=</span> HTTPBasicAuthHandler<span class="token punctuation">(</span>p<span class="token punctuation">)</span>  
opener <span class="token operator">=</span> build_opener<span class="token punctuation">(</span>auth_handler<span class="token punctuation">)</span>  

<span class="token keyword">try</span><span class="token punctuation">:</span>  
    result <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>  
    html <span class="token operator">=</span> result<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>  
<span class="token keyword">except</span> URLError <span class="token keyword">as</span> e<span class="token punctuation">:</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
</code></pre> 
<p>这里首先实例化HTTPBasicAuthHandler对象，其参数是HTTPPasswordMgrWithDefaultRealm对象，它利用add_password方法添加进去用户名和密码，这样就建立了一个处理验证的Handler</p> 
<p>接下来利用Opener的open方法打开链接，就可以完成验证了。这里获取到的结果就是验证后的页面源码内容</p> 
<h5><a id="2_228"></a>2、代理</h5> 
<p>在做爬虫的时候，免不了要使用代理，如果要添加代理，可以</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>error <span class="token keyword">import</span> URLError  
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>request <span class="token keyword">import</span> ProxyHandler<span class="token punctuation">,</span> build_opener  

proxy_handler <span class="token operator">=</span> ProxyHandler<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>  
    <span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'http://127.0.0.1:9743'</span><span class="token punctuation">,</span>  
    <span class="token string">'https'</span><span class="token punctuation">:</span> <span class="token string">'https://127.0.0.1:9743'</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span>  
opener <span class="token operator">=</span> build_opener<span class="token punctuation">(</span>proxy_handler<span class="token punctuation">)</span>  
<span class="token keyword">try</span><span class="token punctuation">:</span>  
    response <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token keyword">except</span> URLError <span class="token keyword">as</span> e<span class="token punctuation">:</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
</code></pre> 
<p>这里我们在本地搭建了一个代理，它运行在9743端口上</p> 
<p>这里使用了ProxyHandler，其参数是一个字典，键名是协议类型（比如HTTP或者HTTPS等），键值是代理链接，可以添加多个代理</p> 
<p>然后，利用这个Handler及build_opener方法构造一个Opener，之后发送请求即可</p> 
<h5><a id="3Cookies_252"></a>3、Cookies</h5> 
<p>Cookies的处理就需要相关的Handler，将网站的Cookies获取下来的代码如下</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> http<span class="token punctuation">.</span>cookiejar<span class="token punctuation">,</span> urllib<span class="token punctuation">.</span>request  

cookie <span class="token operator">=</span> http<span class="token punctuation">.</span>cookiejar<span class="token punctuation">.</span>CookieJar<span class="token punctuation">(</span><span class="token punctuation">)</span>  
handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>HTTPCookieProcessor<span class="token punctuation">(</span>cookie<span class="token punctuation">)</span>  
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>  
response <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>  
<span class="token keyword">for</span> item <span class="token keyword">in</span> cookie<span class="token punctuation">:</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">"="</span><span class="token operator">+</span>item<span class="token punctuation">.</span>value<span class="token punctuation">)</span> 
</code></pre> 
<pre><code class="prism language-python">BAIDUID<span class="token operator">=</span><span class="token number">2E65A683F8A8BA3DF521469DF8EFF1E1</span><span class="token punctuation">:</span>FG<span class="token operator">=</span><span class="token number">1</span>  
BIDUPSID<span class="token operator">=</span><span class="token number">2E65A683F8A8BA3DF521469DF8EFF1E1</span>  
H_PS_PSSID<span class="token operator">=</span>20987_1421_18282_17949_21122_17001_21227_21189_21161_20927  
PSTM<span class="token operator">=</span><span class="token number">1474900615</span>  
BDSVRTM<span class="token operator">=</span><span class="token number">0</span>  
BD_HOME<span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p>首先，我们必须声明一个CookieJar对象。接下来，就需要利用HTTPCookisProcessor来构建一个Handler，最后利用build_opener方法构建出Opener，执行open函数即可</p> 
<pre><code class="prism language-python">filename <span class="token operator">=</span> <span class="token string">'cookies.txt'</span>  
cookie <span class="token operator">=</span> http<span class="token punctuation">.</span>cookiejar<span class="token punctuation">.</span>MozillaCookieJar<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>  
handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>HTTPCookieProcessor<span class="token punctuation">(</span>cookie<span class="token punctuation">)</span>  
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>  
response <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>  
cookie<span class="token punctuation">.</span>save<span class="token punctuation">(</span>ignore_discard<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> ignore_expires<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>这时CookieJar就需要换成MozillaCookieJar，它在生成文件时会用到，是CookieJar的子类，可以用来处理Cookies和文件相关的事件，比如读取和保存Cookies，可以将Cookies保存成Mozilla型浏览器的Cookies格式</p> 
<p>运行之后，可以生成一个cookies.txt文件</p> 
<p>另外，LWPCookieJar同样可以读取和保存Cookies，但是保存的格式和MozillaCookieJar不一样，它会保存成libwww-perl（LWP）格式的Cookies文件</p> 
<p>要保存成LWP格式的Cookies文件，可以在声明时改为</p> 
<pre><code class="prism language-python">cookie <span class="token operator">=</span> http<span class="token punctuation">.</span>cookiejar<span class="token punctuation">.</span>LWPCookieJar<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
</code></pre> 
<p>生成Cookies文件后，我们可以通过以下方法读取并利用</p> 
<pre><code class="prism language-python">cookie <span class="token operator">=</span> http<span class="token punctuation">.</span>cookiejar<span class="token punctuation">.</span>LWPCookieJar<span class="token punctuation">(</span><span class="token punctuation">)</span>  
cookie<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'cookies.txt'</span><span class="token punctuation">,</span> ignore_discard<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> ignore_expires<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  
handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>HTTPCookieProcessor<span class="token punctuation">(</span>cookie<span class="token punctuation">)</span>  
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>  
response <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里调用load方法来读取本地的Cookies 文件，获取到了Cookies的内容。不过前提是我们首先生成了LWPCookieJar格式的Cookies，并保存成文件，然后读取Cookies之后使用相同的方法构建Handler和Opener即可完成操作</p> 
<p>运行结果正常的话，会输出网页的源代码</p> 
<p>通过上面的方法，我们就可以实现大多数请求功能的设置了</p> 
<p>官方文档：https://docs.python.org/zh-cn/3/library/urllib.html</p> 
<h2><a id="requests_313"></a>requests</h2> 
<p>页面解析</p> 
<p>Python正则表达式</p> 
<h3><a id="BeautifulSoup_318"></a>BeautifulSoup</h3> 
<h4><a id="_319"></a>简介和安装</h4> 
<ul><li>Beautiful Soup是一个可以从HTML或XML文件中提取数据的Python库.它能够通过你喜欢的转换实现惯用的文档导航,查找,修改文档的方式.Beautiful Soup会帮你节省数小时甚至数天的工作时间.</li><li>环境安装</li><li>pip install bs4</li><li>pip install lxml</li></ul> 
<h4><a id="_326"></a>使用</h4> 
<p>1、将一段文档传入BeautifulSoup的构造方法，就能得到一个文档的对象，可以传入一段字符换或一个文件句柄</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token comment"># 本地文件</span>
soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 直接解析</span>
soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span><span class="token string">"&lt;html&gt;data&lt;/html&gt;"</span><span class="token punctuation">)</span> 
</code></pre> 
<p>然后BeautifulSoup会选择最合适的解析器来解析这段文档，如果手动指定解析器那么BeautifulSoup会选择指定的解析器来解析文档</p> 
<p>2、获取元素</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
html <span class="token operator">=</span> <span class="token string">'xxx'</span>
<span class="token comment"># 解析数据，以lxml的形式解析</span>
soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span> 

<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>prettify<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 格式化输出文档</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>title<span class="token punctuation">.</span>string<span class="token punctuation">)</span>  <span class="token comment"># 输出文档title节点文本内容</span>

<span class="token comment"># 提取标签</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>title<span class="token punctuation">)</span>  <span class="token comment"># &lt;title&gt; title &lt;/title&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;class 'bs4.element.Tag'&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>title<span class="token punctuation">.</span>string<span class="token punctuation">)</span> <span class="token comment"># title</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>head<span class="token punctuation">)</span>  <span class="token comment"># &lt;head&gt;&lt;title&gt;title&lt;/title&gt;&lt;/head&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>p<span class="token punctuation">)</span>  <span class="token comment"># &lt;p&gt; 这是p标签 &lt;/p&gt;</span>

<span class="token comment"># 获取信息</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>title<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># 获取节点名称， title</span>

<span class="token comment"># 获取属性</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span> <span class="token comment"># 返回标签属性(字典形式)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 返回类名</span>
<span class="token comment"># 也可以</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 返回类名</span>
<span class="token comment"># 有些属性的值是唯一的，返回字符串，有解属性可能有多个值（如class），返回列表</span>


<span class="token comment"># 获取文本</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>string<span class="token punctuation">)</span>  <span class="token comment"># 获取节点之间的文本（只能获取直系内容）</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取标签下所有文本内容</span>
 
<span class="token comment">#子节点</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>contents<span class="token punctuation">)</span>  <span class="token comment"># 获取节点内的所有内容（包括缩进，标签）</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>children<span class="token punctuation">)</span>  <span class="token comment"># 和上述一样</span>
 
 
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>parent<span class="token punctuation">)</span>  <span class="token comment"># 返回父节点（即a元素所在标签）</span>
 
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>c<span class="token punctuation">.</span>parents<span class="token punctuation">)</span>  <span class="token comment"># 返回所有的祖先节点</span>

<span class="token comment"># 兄弟节点</span>
<span class="token keyword">print</span><span class="token punctuation">(</span> soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>next_sibling<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>previous_sibling<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>next_siblings<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>previous_siblings<span class="token punctuation">)</span>
 
</code></pre> 
<p>3、方法选择器</p> 
<ul><li>find，返回第一个符合要求的元素</li><li>find_all，返回所有符合标签的元素</li></ul> 
<pre><code class="prism language-python">soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ul'</span><span class="token punctuation">)</span>  <span class="token comment"># 返回所有的ul标签</span>
soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ul'</span><span class="token punctuation">,</span> class_<span class="token operator">/</span><span class="token builtin">id</span><span class="token operator">/</span>attr<span class="token operator">=</span><span class="token string">'value'</span><span class="token punctuation">)</span>  <span class="token comment"># 返回所有符合标签的元素，name表示标签名，后面的表示筛选条件（因为class在Python中是一个关键字，所以使用class_</span>

soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'username'</span><span class="token punctuation">}</span>
soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'header'</span><span class="token punctuation">)</span>

<span class="token comment"># text参数可以用来匹配节点的文本，传入的形式可以是字符串，也可是正则表达式对象</span>
soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>text<span class="token operator">=</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'this'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre> 
<ul><li>select，select可以使用css选择器来选择元素</li></ul> 
<pre><code class="prism language-python">soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.header .ul&gt;li a'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>其他</li><li>find_parents 和 find_parent</li><li>find_next_siblings 和 find_next_sibling</li><li>find_previous_siblings 和 find_previous_sibling</li><li>find_all_next 和 find_next</li><li>find_all_previous 和 find_previous</li></ul> 
<h4><a id="Xpath_416"></a>Xpath</h4> 
<p>Xpath的选择功能十分强大，它提供了非常简洁明了的路径选择表达式。另外，它还提供了超过100个内建函数，用于字符串、数值、时间的匹配以及节点、序列的处理等。</p> 
<ul><li>官方文档：https://www.w3.org/TR/xpath/</li></ul> 
<h4><a id="Xpath__420"></a>Xpath 使用</h4> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree  <span class="token comment"># 导入相关库</span>

<span class="token comment"># 将本地的html文档中的源码数据加载到etree对象中</span>
etree<span class="token punctuation">.</span>pase<span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>

<span class="token comment"># 从互联网上获取的源码数据加载到该对象中</span>
etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span><span class="token string">'page_text'</span><span class="token punctuation">)</span> 
</code></pre> 
<h4><a id="Xpath__431"></a>Xpath 语法</h4> 
<p>选取节点</p> 
<table><thead><tr><th>表达式</th><th>描述</th></tr></thead><tbody><tr><td>nodename</td><td>选取此节点的所有子节点</td></tr><tr><td>/</td><td>从根节点选取</td></tr><tr><td>//</td><td>从匹配选择当前节点选择文档中的节点，不考虑他们的位置</td></tr><tr><td>.</td><td>选取当前节点</td></tr><tr><td>…</td><td>选取当前节点的父节点</td></tr><tr><td>@</td><td>选取属性</td></tr></tbody></table> 
<h5><a id="_442"></a>例：</h5> 
<table><thead><tr><th>表达式</th><th>描述</th></tr></thead><tbody><tr><td>路径表达式</td><td>选取 bookstore 元素的所有子节点。</td></tr><tr><td>/bookstore</td><td>选取根元素 bookstore。注释：假如路径起始于正斜杠( / )，则此路径始终代表到某元素的绝对路径！</td></tr><tr><td>bookstore/book</td><td>选取属于 bookstore 的子元素的所有 book 元素。</td></tr><tr><td>//book</td><td>选取所有 book 子元素，而不管它们在文档中的位置。</td></tr><tr><td>bookstore//book</td><td>选择属于 bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置。</td></tr><tr><td>//@lang</td><td>选取名为 lang 的所有属性。</td></tr></tbody></table> 
<h5><a id="_452"></a>指定特定节点</h5> 
<table><thead><tr><th>路径表达式</th><th>结果</th></tr></thead><tbody><tr><td>/bookstore/book[1]</td><td>选取属于 bookstore 子元素的第一个 book 元素。</td></tr><tr><td>/bookstore/book[last()]</td><td>选取属于 bookstore 子元素的最后一个 book 元素。</td></tr><tr><td>/bookstore/book[last()-1]</td><td>选取属于 bookstore 子元素的倒数第二个 book 元素。</td></tr><tr><td>/bookstore/book[position()&lt; 3]</td><td>选取最前面的两个属于 bookstore 元素的子元素的 book 元素。</td></tr><tr><td>//title[@lang]</td><td>选取所有拥有名为 lang 的属性的 title 元素。</td></tr><tr><td>//title[@lang=‘eng’]</td><td>选取所有 title 元素，且这些元素拥有值为 eng 的 lang 属性。</td></tr><tr><td>/bookstore/book[price&gt;35.00]</td><td>选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。</td></tr><tr><td>/bookstore/book[price&gt;35.00]/title</td><td>选取 bookstore 元素中的 book 元素的所有title元素，且其中的 price 元素的值须大于 35.00。。</td></tr></tbody></table> 
<h5><a id="_464"></a>选取未知节点</h5> 
<table><thead><tr><th>路径表达式</th><th>结果</th></tr></thead><tbody><tr><td>*</td><td>匹配任何元素节点。</td></tr><tr><td>@*</td><td>匹配任何属性节点。</td></tr><tr><td>node()</td><td>匹配任何类型的节点。</td></tr><tr><td>/bookstore/*</td><td>选取 bookstore 元素的所有子元素。</td></tr></tbody></table> 
<h5><a id="_472"></a>选取若干路径</h5> 
<table><thead><tr><th>路径表达式</th><th>结果</th></tr></thead><tbody><tr><td>//book/title</td><td>//book/price</td></tr><tr><td>//title</td><td>//price</td></tr><tr><td>/bookstore/book/title</td><td>//price</td></tr></tbody></table> 
<h5><a id="Xpath_479"></a>Xpath轴</h5> 
<table><thead><tr><th>轴名称</th><th>结果</th></tr></thead><tbody><tr><td>/ancestor</td><td>选取当前节点的所有先辈（父、祖父等）。</td></tr><tr><td>ancestor-or-self</td><td>选取当前节点的所有先辈（父、祖父等）以及当前节点本身。</td></tr><tr><td>attribute</td><td>选取当前节点的所有属性。</td></tr><tr><td>child</td><td>选取当前节点的所有子元素。</td></tr><tr><td>descendant</td><td>选取当前节点的所有后代元素（子、孙等）。</td></tr><tr><td>descendant-or-self</td><td>选取当前节点的所有后代元素（子、孙等）以及当前节点本身。</td></tr><tr><td>following</td><td>选取文档中当前节点的结束标签之后的所有节点。</td></tr><tr><td>namespace</td><td>选取当前节点的所有命名空间节点。</td></tr><tr><td>parent</td><td>选取当前节点的父节点。</td></tr><tr><td>preceding</td><td>选取文档中当前节点的开始标签之前的所有节点。</td></tr><tr><td>preceding-sibling</td><td>选取当前节点之前的所有同级节点。</td></tr><tr><td>self</td><td>选取当前节点。</td></tr></tbody></table> 
<h5><a id="_495"></a>获取内容</h5> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

html <span class="token operator">=</span> etree<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'./test.html'</span><span class="token punctuation">,</span> etree<span class="token punctuation">.</span>HTMLParser<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 获取文本内容（直系文本内容） /text()</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//li[@class="item"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 获取文本内容（所有文本内容）  //text()</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//li[@class="item"]//text()'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#  获取属性</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//li/a/@href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 获取a标签的href 属性</span>
</code></pre> 
<h5><a id="_512"></a>多条件匹配</h5> 
<p>1、属性多值匹配</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree  
text <span class="token operator">=</span> <span class="token triple-quoted-string string">'''  
&lt;li class="li li-first"&gt;122&lt;/li&gt; 
'''</span>  
html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>text<span class="token punctuation">)</span>

<span class="token comment"># 如果li标签的class属性有多个值，以下方法将不能获取到正确的元素</span>
result <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//li[@class="li"]/text()'</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># 输出 []</span>

<span class="token comment"># 想要通过一个属性获取到正确的元素，可以使用contains方法</span>
result <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//li[contains(@class, "li")]/text()'</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># 输出['122']</span>
</code></pre> 
<p>2、多属性匹配</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree  
text <span class="token operator">=</span> <span class="token triple-quoted-string string">'''  
&lt;li class="li li-first" name="item"&gt;123&lt;/li&gt;
'''</span>  
html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>text<span class="token punctuation">)</span> 

<span class="token comment"># 同时满足所有条件才能匹配到</span>
result <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//li[contains(@class, "li") and @name="item"]/text()'</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># 输出 ['123'] </span>
</code></pre> 
<h5><a id="Xpath_543"></a>Xpath运算符</h5> 
<table><thead><tr><th>运算符</th><th>描述</th><th>实例</th><th>返回值</th></tr></thead><tbody><tr><td></td><td></td><td>计算两个节点集</td><td>//book</td></tr><tr><td>+</td><td>加法</td><td>6 + 4</td><td>10</td></tr><tr><td>-</td><td>减法</td><td>6 - 4</td><td>2</td></tr><tr><td>*</td><td>乘法</td><td>6 * 4</td><td>24</td></tr><tr><td>div</td><td>除法</td><td>8 div 4</td><td>2</td></tr><tr><td>=</td><td>等于</td><td>price=9.80</td><td>如果 price 是 9.80，则返回 true。如果 price 是 9.90，则返回 false</td></tr><tr><td>!=</td><td>不等于</td><td>price!=9.80</td><td>如果 price 是 9.90，则返回 true。如果 price 是 9.80，则返回 false</td></tr><tr><td>&lt;</td><td>小于</td><td>price&lt;9.80</td><td>如果 price 是 9.00，则返回 true。如果 price 是 9.90，则返回 false。</td></tr><tr><td>&lt;=</td><td>小于或等于</td><td>price&lt;=9.80</td><td>如果 price 是 9.00，则返回 true。如果 price 是 9.90，则返回 false。</td></tr><tr><td>&gt;</td><td>大于</td><td>price&gt;9.80</td><td>如果 price 是 9.90，则返回 true。如果 price 是 9.80，则返回 false。</td></tr><tr><td>&gt;=</td><td>大于或等于</td><td>price&gt;=9.80</td><td>如果 price 是 9.90，则返回 true。如果 price 是 9.70，则返回 false。</td></tr><tr><td>or</td><td>或</td><td>price=9.80 or price=9.70</td><td>如果 price 是 9.80，则返回 true。如果 price 是 9.50，则返回 false。</td></tr><tr><td>and</td><td>与</td><td>price&gt;9.00 and price&lt;9.90</td><td>如果 price 是 9.80，则返回 true。如果 price 是 8.50，则返回 false。</td></tr><tr><td>mod</td><td>计算除法的余数</td><td>5 mod 2</td><td>1</td></tr></tbody></table> 
<h2><a id="_560"></a>数据存储</h2> 
<h3><a id="_561"></a>文件存储</h3> 
<h4><a id="txt_562"></a>txt文本存储</h4> 
<p>直接通过文件写入的方式存取数据文件操作（见Python笔记）</p> 
<h4><a id="JSON_565"></a>JSON文件存储</h4> 
<p>JSON，全称为 JavaScript Object Notation，也就是JavaScript对象标记，它通过对象和数组的组合来表示数据，构造简洁但是结构化程度非常高，是一种轻量级的数据交换格式。</p> 
<p>1、Python3中可以使用JSON模块来对JSON数据进行编解码，它包含了两个函数：</p> 
<ul><li>json.dumps()：对数据进行编码</li><li>json.loads()：对数据进行解码<br> <img src="https://images2.imgbox.com/0e/34/uzd5WRKt_o.png" alt="在这里插入图片描述"><br> 2、Python编码为JSON类型转换对应表</li></ul> 
<table><thead><tr><th>Pytho</th><th>JSON</th></tr></thead><tbody><tr><td>dict</td><td>object</td></tr><tr><td>list、tuple</td><td>array</td></tr><tr><td>str</td><td>string</td></tr><tr><td>int、float、int &amp; float-derived Enums</td><td>number</td></tr><tr><td>True</td><td>true</td></tr><tr><td>False</td><td>false</td></tr><tr><td>None</td><td>null</td></tr></tbody></table> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
 
<span class="token comment"># Python 字典类型转换为 JSON 对象</span>
data1 <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'no'</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'name'</span> <span class="token punctuation">:</span> <span class="token string">'Runoob'</span><span class="token punctuation">,</span>
    <span class="token string">'url'</span> <span class="token punctuation">:</span> <span class="token string">'http://www.runoob.com'</span>
<span class="token punctuation">}</span>
 
json_str <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data1<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"Python 原始数据："</span><span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>data1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"JSON 对象："</span><span class="token punctuation">,</span> json_str<span class="token punctuation">)</span>
 
<span class="token comment"># 将 JSON 对象转换为 Python 字典</span>
data2 <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"data2['name']: "</span><span class="token punctuation">,</span> data2<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"data2['url']: "</span><span class="token punctuation">,</span> data2<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment"># 中文写入文件</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment"># 如果没有ensure_ascii 参数，会默认将中文转换为Unicode字符</span>
</code></pre> 
<h4><a id="CSV_610"></a>CSV文件存储</h4> 
<p>CSV，全称为Comma-Separated Values，中文可以叫做都好分隔值或字符分隔值，其文件以纯文本形式存储表格数据。该文件是一个字符序列，可以由任意数目的记录组成，记录间以某种换行符分割。每条记录由字符组成，字段间的分隔符是其他字符或字符串，最常见的是逗号或制表符。不过所有记录都有完全相同的字符序列，相当于一个结构化表的纯文本形式。它比Excel文件更加简洁，XLS文本时电子表格，它包含了文本、数值、公式、和格式等内容，而CSV中不包含这些内容，就是特定字符分隔的纯文本，结构简单清晰。所以，有时候用CSV来保存数据是比较方便的。</p> 
<h4><a id="pandas_612"></a>也可以通过pandas库来进行存储和读取数据</h4> 
<h5><a id="_613"></a>文件写入</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> csv

<span class="token comment"># 打开文件，如果有中文需要指定字符编码</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>csvfile<span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span>  <span class="token comment"># 获得文件句柄, delimiter参数表示列与列之间的分隔符，没有次参数时分隔符为逗号</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 写入数据</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'10001'</span><span class="token punctuation">,</span> <span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'10002'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 可以使用writerows同时写入多行，此时的参数为二维列表</span>
     writer<span class="token punctuation">.</span>writerows<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'10001'</span><span class="token punctuation">,</span> <span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'10002'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<h5><a id="_629"></a>通过字典方式写入</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> csv

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>
<span class="token triple-quoted-string string">'''先定义三个字段，用filednames表示，然后将其传给DictWriter来初始化一个字典写入对象，接着可以调用writerheader方法写入头信息，然后调用writerow方法传入相应字典即可'''</span>
    filednames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">]</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span>csvfile<span class="token punctuation">,</span> filednames<span class="token operator">=</span>filednames<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'10001'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'10002'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_642"></a>文件读取</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> csv  

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span>  
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>  
    <span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>  
        <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_653"></a>数据库存储</h4> 
<ol><li>MySQL</li><li>MongoDB</li><li>Redis</li></ol> 
<h3><a id="Ajax_657"></a>Ajax数据和动态渲染</h3> 
<h4><a id="Ajax_658"></a>Ajax</h4> 
<p>有时候我们在用requests抓取网页的时候，得到的结果可能和在浏览器中看到的不一样，在浏览器中可以看到正常显示的页面数据，但是使用requests得到的结果并没有。这是因为requests获取的都是原始的HTML文档，而浏览器中的页面则是通过JavaScript处理数据后生成的结果，这些数据的来源有多重，可能是通过Ajax加载的，可能是包含在HTML文档中的，也可能是通过JavaScript和特定算法计算后生成的</p> 
<p>对于第一种情况，数据加载是一种异步加载方式，原始的网页最初不会包含某些数据，原始页面加载后，会再向服务器请求某个接口获取数据，然后数据才被处理从而呈现到网页上，这其实就是发送了一个Ajax请求</p> 
<h5><a id="Ajax_662"></a>Ajax</h5> 
<p>Ajax，全称Asynchronous JavaScript and XML，即异步的JavaScript和XML。</p> 
<h5><a id="Ajax_665"></a>Ajax分析方法</h5> 
<p>打开浏览器开发者工具，网络下面的XHR筛选</p> 
<h4><a id="_668"></a>动态渲染页面</h4> 
<p>JavaScript动态渲染的页面不止Ajax这一种，有些网页是由JavaScript生成的，并非原始HTML代码，这其中并不包含Ajax请求，例如淘宝这样的页面，即使是Ajax获取的数据，但是其Ajax接口含有很多加密参数，我们难以直接找出其规律，也很难直接找出去去规律，也很难分析Ajax来抓取</p> 
<p>为了解决这些问题，我们可以直接使用模拟浏览器运行的方式来实现，这样就可以做到在浏览器中看到什么样，抓取的源码就是什么样，可见即可爬。</p> 
<p>Python提供了很多模拟浏览器运行的库，如Selenium，Splash，PyV8，Ghost等。</p> 
<h4><a id="Selenium_676"></a>Selenium的使用</h4> 
<p>Selenium是一个自动化测试工具，利用它可以驱动浏览器执行特定的动作，如点击、下拉等操作，同时还可以获取浏览器当前呈现的页面的源代码。对于一些JavaScript动态渲染的页面来说，这种抓取方式非常有效。</p> 
<p>准备工作<br> 在开始之前，需要安装好Chrome浏览器并配置好ChromeDriver（两者版本需要一致，将ChromeDriver放到Python的Scripts目录下，其他操作系统需要配置环境变量），还需要安装好Python的Selenium库。</p> 
<h5><a id="_682"></a>开始使用</h5> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

<span class="token comment"># 打开浏览器, 传入的参数是驱动的路径</span>
wd <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token string">r'D:\Installation package\Chrome\chromedriver.exe'</span><span class="token punctuation">)</span>

<span class="token comment"># 浏览器打开某个网址</span>
wd<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>

<span class="token comment"># 关闭浏览器</span>
wd<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_696"></a>选择元素</h5> 
<ul><li>使用 find_elements 选择的是符合条件的 所有 元素， 如果没有符合条件的元素， 返回空列表</li><li>使用 find_element 选择的是符合条件的 第一个 元素， 如果没有符合条件的元素， 抛出<br> NoSuchElementException 异常</li></ul> 
<pre><code class="prism language-python">username <span class="token operator">=</span> wd<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>  <span class="token comment"># 通过 id</span>
header<span class="token operator">=</span> element<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'header'</span><span class="token punctuation">)</span>  <span class="token comment"># 通过 类名</span>
div <span class="token operator">=</span> wd<span class="token punctuation">.</span>find_element_by_tag_name<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>  <span class="token comment"># 通过标签名</span>
container <span class="token operator">=</span> wd<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">'.container'</span><span class="token punctuation">)</span>  <span class="token comment"># 通过css选择器</span>
footer <span class="token operator">=</span> wd<span class="token punctuation">.</span>find_elements_by_css_selector<span class="token punctuation">(</span><span class="token string">'.footer, #footer'</span><span class="token punctuation">)</span>

<span class="token comment"># 通过xpath选择</span>
div <span class="token operator">=</span> wd<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//div'</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>在我们进行网页操作的时候，有的元素不是可以立即出现的，可能需要加载一段时间，Selenium提供了一个周期性（每隔半秒钟）重新查找该元素的方案implicitly_wait，直到该元素找到。</li></ul> 
<pre><code class="prism language-python">wd<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># 参数用来指定最大等待时长</span>
</code></pre> 
<h5><a id="_718"></a>操作元素</h5> 
<p>1、点击元素</p> 
<ul><li>element.click()方法，点击元素的时候，浏览器点击的是该元素的中心点位置</li></ul> 
<p>2、输入框</p> 
<ul><li>element.send_key(需要输入的字符)在元素内输入文字</li><li>element.clear()清空文字</li></ul> 
<p>3、获取元素信息</p> 
<ul><li>element.text获取元素展示在页面上的文本内容</li><li>有时候元素的文本内容没有展示在页面上，或者没有完全展示在页面上。这时可以尝试使用<br> element.get_attribute(‘innerText’) ，或者<br> element.get_attribute(‘textContent’)</li><li>element.get_attribute(‘class’)获取元素属性class（可以更换为其他）的值</li></ul> 
<p>4、获取元素对应的HTML</p> 
<ul><li>element.get_attribute(‘outerHTML’)获取整个元素对应的HTML文本内容</li><li>element.get_attribute(‘innerHTML’)获取某个元素内部的HTML内容</li></ul> 
<p>5、获取输入框文字</p> 
<ul><li>element.get_attribute(‘value’)获取输入框中的内容</li></ul> 
<p>6、动作链（鼠标拖拽、键盘按键）</p> 
<ul><li>文档：https://seleniumpython.readthedocs.io/api.html#moduleselenium.webdriver.common.action_chains</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> ActionChains

browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>
browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'iframeResult'</span><span class="token punctuation">)</span>
source <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">'#draggable'</span><span class="token punctuation">)</span>
target <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">'#droppable'</span><span class="token punctuation">)</span>
actions <span class="token operator">=</span> ActionChains<span class="token punctuation">(</span>browser<span class="token punctuation">)</span>
actions<span class="token punctuation">.</span>drag_and_drop<span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span>  <span class="token comment"># 将source拖拽到target</span>
actions<span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 执行操作</span>
</code></pre> 
<p>7、执行JavaScript代码</p> 
<ul><li>wd.execute_script(‘js代码’)</li></ul> 
<p>8、 Cookies操作</p> 
<ul><li>wd.get_cookies()获取Cookies</li><li>wd.add_cookie()设置Cookies</li><li>wd.delete_all_cookies()删除Cookies</li></ul> 
<h5><a id="_773"></a>窗口操作</h5> 
<p>有时候，网页中会嵌入另一个网页（iframe元素），这时候按照之前的方法将不能选取到想要的元素，或者有时候点击一个链接浏览器会打开一个新的窗口</p> 
<ol><li>wd.switch_to.frame(frame_reference)参数可以是iframe元素的id或者name属性值，或者通过上述方法选取到的iframe对象</li><li>切换到原来的主HTML，wd.switch_to.default_content()，有时候我们切换到iframe界面操作完之后，还需要返回到原来的主界面进行操作</li><li>切换窗口，wd.switch_to.window(handle)</li></ol> 
<p>打开多个窗口，需要定位到最新打开的窗口</p> 
<pre><code class="prism language-python"><span class="token comment"># 获取打开的多个窗口句柄</span>
windows <span class="token operator">=</span> wd<span class="token punctuation">.</span>window_handles 
<span class="token comment"># 切换到当前最新打开的窗口</span>
wd<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>window<span class="token punctuation">(</span>windows<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>打开两个窗口，需要新打开的窗口</p> 
<pre><code class="prism language-python"><span class="token comment"># 获得打开的第一个窗口句柄</span>
window_1 <span class="token operator">=</span> wd<span class="token punctuation">.</span>current_window_handle
<span class="token comment"># 获得打开的所有的窗口句柄</span>
windows <span class="token operator">=</span> wd<span class="token punctuation">.</span>window_handles
<span class="token comment"># 切换到最新的窗口</span>
<span class="token keyword">for</span> current_window <span class="token keyword">in</span> windows<span class="token punctuation">:</span>
<span class="token keyword">if</span> current_window <span class="token operator">!=</span> window_1<span class="token punctuation">:</span>
wd<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>window<span class="token punctuation">(</span>current_window<span class="token punctuation">)</span> 
</code></pre> 
<p>返回之前的窗口</p> 
<pre><code class="prism language-python"><span class="token comment"># 保存当前窗口的句柄</span>
mainWindow <span class="token operator">=</span> wd<span class="token punctuation">.</span>current_window_handle
<span class="token comment"># 切换到之前的窗口</span>
wd<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>window<span class="token punctuation">(</span>mainWindow<span class="token punctuation">)</span> 
</code></pre> 
<ol start="4"><li>前进后退</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 返回</span>
wd<span class="token punctuation">.</span>back<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 前进</span>
wd<span class="token punctuation">.</span>forward<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h5><a id="select_819"></a>选择框（单选框，多选框，select）</h5> 
<ol><li>单选框radio和多选框checkbox使用选取元素之后点击的形式即可选取</li><li>select</li></ol> 
<p>select_by_value()通过value选择<br> select_by_index()取消选择<br> select_by_index()通过索引选择（索引从0开始）<br> deselect_by_index()取消选择<br> select_by_visible_text()通过可见文本选择<br> deselect_by_visible_text()取消选择<br> deselect_all()取消所有选择</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/61c9b1c03f6bfbf97c75ad0c63ecbcef/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Scratch 真题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3a7e9ecd9984aae941dd7b8102da393c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">springboot学习(八十三) springboot中自定义某个对象的JSON序列化反序列化方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>