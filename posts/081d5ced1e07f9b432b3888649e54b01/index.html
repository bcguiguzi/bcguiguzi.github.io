<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Backtrader 量化平台研究 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Backtrader 量化平台研究" />
<meta property="og:description" content="Backtrader 中国期货回测 Backtrader 简介 先说几句题外话，Backtrader 到底谁在用？一下内容转自backtrader官方网站中References部分：https://www.backtrader.com/home/references/who-is-using-it/
Who is using it
我简单说几点：
2家 Eurostoxx50 银行6家量化私募
不过这些都是很早以前的数据，还有一些做能源交易的对冲基金。
reddit里面有个algo trading 板块，里面有人提了backtrader到底有多火的问题？一下引用了部分：
No. There is not a list. This is actually outdated: the number of banks remains at 2 (there may be more, but I don’t know it), but there are more than 6 firms using it for internal purposes, including for example companies working in energy markets, due to the compensation feature which allows buying and selling different assets which compensate each other (this is probably not available in zipline) which allows to model using spot and futures prices (this is a particularity of energy markets to avoid having the actual goods delivered to you) The thing here is that one would have to define usage." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/081d5ced1e07f9b432b3888649e54b01/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-25T03:44:25+08:00" />
<meta property="article:modified_time" content="2020-06-25T03:44:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Backtrader 量化平台研究</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Backtrader__1"></a>Backtrader 中国期货回测</h2> 
<h3><a id="Backtrader__2"></a>Backtrader 简介</h3> 
<p>先说几句题外话，Backtrader 到底谁在用？一下内容转自backtrader官方网站中References部分：https://www.backtrader.com/home/references/who-is-using-it/<br> Who is using it<br> 我简单说几点：</p> 
<ol><li>2家 Eurostoxx50 银行</li><li>6家量化私募<br> 不过这些都是很早以前的数据，还有一些做能源交易的对冲基金。<br> reddit里面有个algo trading 板块，里面有人提了backtrader到底有多火的问题？一下引用了部分：<br> No. There is not a list. This is actually outdated: the number of banks remains at 2 (there may be more, but I don’t know it), but there are more than 6 firms using it for internal purposes, including for example companies working in energy markets, due to the compensation feature which allows buying and selling different assets which compensate each other (this is probably not available in zipline) which allows to model using spot and futures prices (this is a particularity of energy markets to avoid having the actual goods delivered to you)</li></ol> 
<p>The thing here is that one would have to define usage. I can for example quote what someone from one of those banks told me: “we use backtrader to quickly prototype our ideas and backtest them. If they prove to be what we expected and after further refinement, they will be rewritten in Java and put into our production system”</p> 
<p>This is actually the same scheme which one of the Quant firms (which I personally visited) used: prototyping in backtrader and production in Java.</p> 
<p>As you may imagine I don’t track the lifes of those using backtrader, so it may also be that some of the banks and companies decided to no longer use backtrader.</p> 
<p>I do also guess that some banks and quant firms use zipline following the same scheme.</p> 
<h3><a id="Backtrader__20"></a>Backtrader 螺纹钢回测</h3> 
<p>数据准备：这里用本地csv数据，数据频率是15分钟，全部历史（2009-03-27到2020-06-18）。<br> <img src="https://images2.imgbox.com/49/30/eU9TSkqe_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1f/db/x4eds22g_o.jpg" alt="在这里插入图片描述"><br> 跑的是sar策略，下面贴上部分代码</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># 引入python3.X的一些特性</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> <span class="token punctuation">(</span>absolute_import<span class="token punctuation">,</span> division<span class="token punctuation">,</span> print_function<span class="token punctuation">,</span>
                        unicode_literals<span class="token punctuation">)</span>
<span class="token keyword">import</span> datetime  <span class="token comment"># For datetime objects</span>
<span class="token keyword">import</span> backtrader <span class="token keyword">as</span> bt
<span class="token keyword">import</span> backtrader<span class="token punctuation">.</span>feeds <span class="token keyword">as</span> btfeeds
<span class="token keyword">import</span> backtrader<span class="token punctuation">.</span>indicators <span class="token keyword">as</span> btind
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">class</span> <span class="token class-name">Par_SAR</span><span class="token punctuation">(</span>bt<span class="token punctuation">.</span>Strategy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    params <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'period'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'af'</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'afmax'</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>dataclose <span class="token operator">=</span> self<span class="token punctuation">.</span>datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>close
        self<span class="token punctuation">.</span>pa_sar <span class="token operator">=</span> bt<span class="token punctuation">.</span>indicators<span class="token punctuation">.</span>PSAR<span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token triple-quoted-string string">'''
       隐藏了策略逻辑部分，有需要的朋友私信我
       '''</span>         
    <span class="token keyword">def</span> <span class="token function">stop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'period: %s, af: %s, afmax: %s, final_value: %.2f'</span> <span class="token operator">%</span>
                 <span class="token punctuation">(</span>self<span class="token punctuation">.</span>p<span class="token punctuation">.</span>period<span class="token punctuation">,</span> self<span class="token punctuation">.</span>p<span class="token punctuation">.</span>af<span class="token punctuation">,</span> self<span class="token punctuation">.</span>p<span class="token punctuation">.</span>afmax<span class="token punctuation">,</span> self<span class="token punctuation">.</span>broker<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># rb 15 min data </span>
    brf_min_bar <span class="token operator">=</span> bt<span class="token punctuation">.</span>feeds<span class="token punctuation">.</span>GenericCSVData<span class="token punctuation">(</span>
        dataname<span class="token operator">=</span><span class="token string">'E:/Quant/Backtrader/backtrader-master/China_Market/data/rb_15m.csv'</span><span class="token punctuation">,</span>
        timeframe<span class="token operator">=</span>bt<span class="token punctuation">.</span>TimeFrame<span class="token punctuation">.</span>Minutes<span class="token punctuation">,</span>
        <span class="token comment">#fromdate=datetime.datetime(2019, 5, 1),</span>
        <span class="token comment">#todate=datetime.datetime(2020, 6, 1),</span>
        nullvalue<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>
        dtformat<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        datetime<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
        time<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        high<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>
        low<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token builtin">open</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
        close<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>
        volume<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token comment"># openinterest=-1</span>
    <span class="token punctuation">)</span>
    <span class="token comment"># 2.2Add the Data Feed to Cerebro</span>
    cerebro<span class="token punctuation">.</span>adddata<span class="token punctuation">(</span>brf_min_bar<span class="token punctuation">)</span>
    <span class="token comment">#cerebro.resampledata(brf_min_bar, timeframe=bt.TimeFrame.Days)</span>

    <span class="token comment"># 3 Add strategy</span>
    cerebro<span class="token punctuation">.</span>addstrategy<span class="token punctuation">(</span>Par_SAR<span class="token punctuation">)</span>
    <span class="token comment"># 设置初始资本为100,000</span>
    cerebro<span class="token punctuation">.</span>broker<span class="token punctuation">.</span>setcash<span class="token punctuation">(</span><span class="token number">1000000.0</span><span class="token punctuation">)</span> 
    <span class="token comment">#每次固定交易数量</span>
    cerebro<span class="token punctuation">.</span>addsizer<span class="token punctuation">(</span>bt<span class="token punctuation">.</span>sizers<span class="token punctuation">.</span>FixedSize<span class="token punctuation">,</span> stake<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> 
    <span class="token comment"># 3 set futures commission</span>
    cerebro<span class="token punctuation">.</span>broker<span class="token punctuation">.</span>setcommission<span class="token punctuation">(</span>commission<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">,</span> margin<span class="token operator">=</span><span class="token number">2800.0</span><span class="token punctuation">,</span> mult<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'初始资金: %.2f'</span> <span class="token operator">%</span> cerebro<span class="token punctuation">.</span>broker<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    cerebro<span class="token punctuation">.</span>addanalyzer<span class="token punctuation">(</span>bt<span class="token punctuation">.</span>analyzers<span class="token punctuation">.</span>SharpeRatio<span class="token punctuation">,</span> _name <span class="token operator">=</span> <span class="token string">'SharpeRatio'</span><span class="token punctuation">)</span>
    cerebro<span class="token punctuation">.</span>addanalyzer<span class="token punctuation">(</span>bt<span class="token punctuation">.</span>analyzers<span class="token punctuation">.</span>DrawDown<span class="token punctuation">,</span> _name<span class="token operator">=</span><span class="token string">'DW'</span><span class="token punctuation">)</span>
    results <span class="token operator">=</span> cerebro<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    strat <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'最终资金: %.2f'</span> <span class="token operator">%</span> cerebro<span class="token punctuation">.</span>broker<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'夏普比率:'</span><span class="token punctuation">,</span> strat<span class="token punctuation">.</span>analyzers<span class="token punctuation">.</span>SharpeRatio<span class="token punctuation">.</span>get_analysis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'回撤指标:'</span><span class="token punctuation">,</span> strat<span class="token punctuation">.</span>analyzers<span class="token punctuation">.</span>DW<span class="token punctuation">.</span>get_analysis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 4. Run</span>
    cerebro<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cerebro<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>iplot<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>style<span class="token operator">=</span><span class="token string">'candlestick'</span><span class="token punctuation">,</span>numfigs<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="Backtrader__96"></a>Backtrader 策略绩效报告</h3> 
<p><img src="https://images2.imgbox.com/10/b6/MTmWUT8b_o.jpg" alt="在这里插入图片描述"><br> 图片太大我就不一一展示出来<br> <img src="https://images2.imgbox.com/63/9a/TbinRg8H_o.jpg" alt="在这里插入图片描述"><br> 看下策略近期表现，也就是第八幅图：<br> <img src="https://images2.imgbox.com/ae/93/7PMf3bGv_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e24550634b921073534948b12c944e4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微信小程序之scroll-view组件下拉刷新</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/57ceee00589e3c36de65f607873616cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ICMP查询报文抓包分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>