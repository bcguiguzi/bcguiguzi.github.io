<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Selenium &amp; Other】使用quit()无法关闭窗口 &amp; 一键杀死进程 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Selenium &amp; Other】使用quit()无法关闭窗口 &amp; 一键杀死进程" />
<meta property="og:description" content="前言 有位读者留言，遇到了一件两难全的事儿。在关闭Python使用os模块执行cmd命令调用的chromedriver驱动打开的chrome浏览器时，有以下问题~
使用driver.quit()退出浏览器，chromedriver.exe进程退出，关闭没有窗口使用driver.close()退出浏览器，chromedriver.exe进程没有退出，窗口关闭 但是咱们这里全都要，下面就来解决它，顺便说一下关于杀死进程的事儿~
文章链接在这：
标题链接【Selenium】Selenium绕过检测 &amp; 隐藏特征【Selenium】Selenium绕过检测 &amp; 隐藏特征 问题在这：
解决方法如下：
先关闭窗口，再杀掉 chromedriver.exe 进程。 driver.close() driver.quit() 全文完~🎈🎈
下面且再吧啦一下吧🏹🏹
问题复现 这份代码贯穿全文，将用于多次示例。
执行以下代码，详情看动图
执行以下代码，会启动一个名为 chromedriver.exe的进程，通过任务管理器 可看到 # -*- coding: utf-8 -*- # Name: hide_features.py # Author: 小菜 # Date: 2022/8/29 15:43 # Description: import os from selenium import webdriver from selenium.webdriver.chrome.options import Options if __name__ == &#39;__main__&#39;: os.system(r&#39;start chrome --remote-debugging-port=9527 --user-data-dir=&#34;F:\selenium&#34;&#39;) options = Options() options.add_experimental_option(&#34;debuggerAddress&#34;, &#34;127.0.0.1:9527&#34;) driver = webdriver.Chrome(options=options) driver.get(&#39;https://bot.sannysoft.com/&#39;) # driver." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/0f9afb4ede614827471a1b775b2c3e11/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-22T11:01:30+08:00" />
<meta property="article:modified_time" content="2023-05-22T11:01:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Selenium &amp; Other】使用quit()无法关闭窗口 &amp; 一键杀死进程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<blockquote> 
 <p>有位读者留言，遇到了一件两难全的事儿。在关闭Python使用os模块执行cmd命令调用的chromedriver驱动打开的chrome浏览器时，有以下问题~</p> 
 <ul><li>使用<code>driver.quit()</code>退出浏览器，<code>chromedriver.exe</code>进程退出，关闭没有窗口</li><li>使用<code>driver.close()</code>退出浏览器，<code>chromedriver.exe</code>进程没有退出，窗口关闭</li></ul> 
</blockquote> 
<p>但是咱们这里全都要，下面就来解决它，顺便说一下关于杀死进程的事儿~</p> 
<p>文章链接在这：</p> 
<table><thead><tr><th>标题</th><th>链接</th></tr></thead><tbody><tr><td><strong>【Selenium】Selenium绕过检测 &amp; 隐藏特征</strong></td><td><strong><a href="https://blog.csdn.net/weixin_45081575/article/details/126585575">【Selenium】Selenium绕过检测 &amp; 隐藏特征</a></strong></td></tr></tbody></table> 
<p>问题在这：<br> <img src="https://images2.imgbox.com/ea/9b/gRFgudBI_o.png" alt=""></p> 
<p><strong>解决方法如下：</strong></p> 
<ul><li>先关闭窗口，再杀掉 <code>chromedriver.exe</code> 进程。</li></ul> 
<pre><code class="prism language-py">driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>全文完~🎈🎈<br> 下面且再吧啦一下吧🏹🏹</p> 
<hr> 
<h2><a id="_33"></a>问题复现</h2> 
<blockquote> 
 <p>这份代码贯穿全文，将用于多次示例。</p> 
</blockquote> 
<p>执行以下代码，详情看动图</p> 
<ul><li>执行以下代码，会启动一个名为 <code>chromedriver.exe</code>的进程，通过<code>任务管理器</code> 可看到</li></ul> 
<pre><code class="prism language-py"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># Name:         hide_features.py</span>
<span class="token comment"># Author:       小菜</span>
<span class="token comment"># Date:         2022/8/29 15:43</span>
<span class="token comment"># Description:</span>

<span class="token keyword">import</span> os
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>chrome<span class="token punctuation">.</span>options <span class="token keyword">import</span> Options

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">r'start chrome --remote-debugging-port=9527 --user-data-dir="F:\selenium"'</span><span class="token punctuation">)</span>
    options <span class="token operator">=</span> Options<span class="token punctuation">(</span><span class="token punctuation">)</span>
    options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">"debuggerAddress"</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1:9527"</span><span class="token punctuation">)</span>
    driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://bot.sannysoft.com/'</span><span class="token punctuation">)</span>
    <span class="token comment"># driver.quit()</span>
    driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>这个是 <code>drivrt.quit()</code> 的</p> 
<ul><li>可以看到，<code>chromedriver.exe</code> 进程退出了，但窗口没有关闭</li></ul> 
<p><img src="https://images2.imgbox.com/af/80/xgqEQlAM_o.gif" alt="请添加图片描述"></p> 
<p>这个是 <code>drivrt.close()</code> 的</p> 
<ul><li>可以看到，<code>chromedriver.exe</code> 进程没有退出，但窗口关闭了。</li></ul> 
<p><img src="https://images2.imgbox.com/01/38/zQmbVVIc_o.gif" alt="在这里插入图片描述"></p> 
<p>问题成功复现，下面解决它。</p> 
<hr> 
<h2><a id="_78"></a>解决方法</h2> 
<blockquote> 
 <p>全程注意打开 <code>任务管理器</code>，实时查看 <code>chromedriver.exe</code>进程的情况~</p> 
</blockquote> 
<p>这里准备两种解决方法，</p> 
<ol><li>通过Python</li><li>通过Windows系统的<code>taskkill</code>（终止进程命令</li></ol> 
<p>两种方法</p> 
<ul><li>直接杀死chrome进程</li><li>杀死置顶端口的进程</li></ul> 
<h3><a id="Python_90"></a>Python实现</h3> 
<p>跟一下 <code>driver.quit()</code>，看到以下源码，不管执行成功与否，最终都是执行了 <code>self.service.stop()</code></p> 
<pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">quit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Closes the browser and shuts down the ChromiumDriver executable
    that is started when starting the ChromiumDriver
    """</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        <span class="token comment"># We don't care about the message because something probably has gone wrong</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>service<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里我们改一下代码，将 <code>driver.quit()</code> 修改 成以下</p> 
<ul><li>先挂关闭浏览器，再停止<code>service</code>，可以达到杀死<code>chromedriver.exe</code>进程和关闭窗口的两全其美。</li></ul> 
<pre><code class="prism language-bash">driver.close<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver.service.stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后执行代码，看以下动图</p> 
<p><img src="https://images2.imgbox.com/74/e8/v7tCFLQ2_o.gif" alt=""></p> 
<p>完美解决问题~</p> 
<hr> 
<h3><a id="Windows_126"></a>Windows系统命令</h3> 
<blockquote> 
 <p>这里会用到两个Windows的命令，分别是 <code>netstat</code> 和 <code>taskkill</code></p> 
</blockquote> 
<p>可以通过以下链接获得更详细的介绍🎈</p> 
<table><thead><tr><th>命令</th><th>链接</th></tr></thead><tbody><tr><td><code>netstat</code></td><td><a href="https://docs.microsoft.com/zh-cn/windows-server/administration/windows-commands/netstat" rel="nofollow"><strong>https://docs.microsoft.com/zh-cn/windows-server/administration/windows-commands/netstat</strong></a></td></tr><tr><td><code>taskkill</code></td><td><a href="https://docs.microsoft.com/zh-cn/windows-server/administration/windows-commands/taskkill" rel="nofollow"><strong>https://docs.microsoft.com/zh-cn/windows-server/administration/windows-commands/taskkill</strong></a></td></tr></tbody></table> 
<p><strong>参数：</strong></p> 
<p><img src="https://images2.imgbox.com/a6/5e/btq04iBE_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="netstat_145"></a><code>netstat</code></h4> 
<blockquote> 
 <p>命令用于显示活动的TCP链接、正在使用的端口等~</p> 
</blockquote> 
<p>官方介绍截图如下：</p> 
<p><img src="https://images2.imgbox.com/77/e2/Lhcmtrz8_o.png" alt=""></p> 
<p>执行 <code>driver.close()</code> 的代码之后，<code>chromedriver.exe</code> 进程的状态还是 <code>正在运行</code>的，<br> 现在打开电脑的<code>cmd</code> 窗口，输入以下命令，然后回车</p> 
<pre><code class="prism language-bash"><span class="token function">netstat</span> -ano <span class="token operator">|</span> findstr <span class="token number">9527</span>
</code></pre> 
<p>代码释义( <code>查找所有活动的TCP连接中包含9527的连接</code>：</p> 
<ul><li><code>netstat -ano</code>：显示活动的TCP连接</li><li><code>findstr</code>：Windows系统命令，用于查找指定的包含的字符串</li><li><code>9527</code>：因为上面的代码中指定打开的端口是 <strong>9527</strong></li></ul> 
<p>运行如下图所示：</p> 
<p><img src="https://images2.imgbox.com/6b/cf/BnrPG3Vd_o.png" alt=""></p> 
<p>看到有两个TCP连接，这里后面跟的是它们的<code>PID</code>（Process Identification<br> 干掉任意下面那个状态为<code>CLOSE_WAIT</code> 的 <code>进程</code> 就可以结束 <code>chromedriver.exe</code> 进程啦🐱‍🏍</p> 
<p>接下来去干掉它！！！</p> 
<h4><a id="taskkill_172"></a><code>taskkill</code></h4> 
<blockquote> 
 <p>Windows系统自带命令，用于结束一个或多个进程~</p> 
</blockquote> 
<p>官方介绍截图如下：</p> 
<p><img src="https://images2.imgbox.com/e2/a4/08m6DP5I_o.png" alt=""></p> 
<p>上面我们知道了 活动的 TCP连接，这里来干了它。</p> 
<pre><code class="prism language-bash">taskkill /f /t /pid <span class="token number">2024</span>
</code></pre> 
<p>代码释义（强制结束 <code>pid</code>为<code>2024</code> 的进程，你需要改为你的进程 <code>pid</code>：</p> 
<ul><li><code>/f</code>：指定强制结束进程</li><li><code>/t</code>：结束指定进程以及由该进程启动的任何子进程</li><li><code>/pid &lt;processID&gt;</code>：指定要终止的进程的进程 ID。</li></ul> 
<p>运行如下图所示：</p> 
<ul><li>成功结束<code>chromederiver.exe</code>进程<img src="https://images2.imgbox.com/d8/8c/2JwuAPqq_o.png" alt=""></li></ul> 
<p>改写成 <code>Python</code>代码如下：</p> 
<ul><li>同样可以达到杀死<code>chromedriver.exe</code> 进程的目的~</li></ul> 
<pre><code class="prism language-py"><span class="token keyword">import</span> os
result <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'netstat -ano | findstr 9527 | findstr CLOSE_WAIT'</span><span class="token punctuation">)</span>
port <span class="token operator">=</span> result<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'      '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'taskkill /f -t /pid </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>port<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>但是！！！<br> 这个方法不是特别妙，有没有更妙的方法呢？答案是没有！不存在完美的方法🎃🎃</p> 
<hr> 
<h4><a id="tasklist_210"></a><code>tasklist</code></h4> 
<blockquote> 
 <p>显示本地计算机或远程计算机上当前正在运行的进程列表。</p> 
</blockquote> 
<p>官方介绍截图如下：<br> <img src="https://images2.imgbox.com/43/f3/g7IZcB0t_o.png" alt=""></p> 
<p>使用 <code>tasklist </code> 查看包含 <code>chromedriver.exe</code>的进程，然后再干掉它。</p> 
<ul><li>会存在误杀，你开启了两个窗口，端口分别是1234 和 9527，但不清楚哪个窗口对应哪个端口，所以可能会误杀~</li></ul> 
<pre><code class="prism language-bash">tasklist <span class="token operator">|</span> findstr chromedriver.exe
</code></pre> 
<p>如下图：</p> 
<ul><li>可以获取到它的 <code>PID</code>，后面去干掉对应的 <code>PID</code> 就完事了</li></ul> 
<p><img src="https://images2.imgbox.com/58/14/ptUBcb9H_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_231"></a>结合写法</h4> 
<p>如果进程存在就<strong>kill</strong> 了它</p> 
<pre><code class="prism language-bash">tasklist <span class="token operator">|</span> <span class="token function">find</span> /i <span class="token string">"chromedriver.exe"</span> <span class="token operator">&gt;</span> nul <span class="token operator">&amp;&amp;</span> taskkill /f /im <span class="token string">"chromedriver.exe"</span> <span class="token operator">&gt;</span> nul
</code></pre> 
<h2><a id="N_238"></a>关闭<code>N</code>个程序</h2> 
<blockquote> 
 <p>思路发散一下，可以关闭多个电脑程序，不局限于Selenium浏览器的使用。</p> 
</blockquote> 
<p><strong>杀死指定进程</strong></p> 
<ul><li><code>im</code>： 指定要终止的进程的映像名称</li></ul> 
<pre><code class="prism language-bash">taskkill /f /t /im chromedriver.exe
</code></pre> 
<p>如下所示：</p> 
<ul><li>杀死所有进程名为 <code>chromedriver.exe</code> 的进程<br> <img src="https://images2.imgbox.com/e8/05/NzRnHJPi_o.gif" alt=""></li></ul> 
<p><strong>一行命令杀死多个进程</strong></p> 
<ul><li>这里干掉了4个进程树，甚至还关闭 <code>cmd</code>窗口~</li><li>思路再发散一下，将平时经常会打开的程序都添加到这行代码里面去，然后编写成<code>.bat</code>批处理文件，一键执行关闭指定N个程序，实在不济，下面也还有个一键关闭所有程序的~</li></ul> 
<pre><code class="prism language-bash">taskkill /f /t /im msedge.exe /im wps.exe /im Typora.exe /im cmd.exe
</code></pre> 
<p>运行如下所示：<br> <img src="https://images2.imgbox.com/72/4f/rvr5RLqH_o.gif" alt=""></p> 
<p><strong>干掉所有程序</strong></p> 
<pre><code class="prism language-bash">taskkill /F /FI <span class="token string">"USERNAME eq 【您的用户名】"</span> /FI <span class="token string">"IMAGENAME ne explorer.exe"</span> /FI "IMAGENAME ne dwm.exe，
</code></pre> 
<p>代码释义：</p> 
<ul><li>意思是在此用户账户下筛选 explorer.exe（文件资源管理器）和 dwm.exe（桌面窗口管理器），将这两项强制终止进程，即可达到关闭所有程序的目的。</li></ul> 
<h2><a id="_272"></a>后话</h2> 
<p>see you.🐱‍🏍🐱‍🏍</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4a854c6e377acfe6a6bef3e98e106019/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">svc.fit(X=, y=, sample_weight=)理解这句代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e64c07ee11e047bdc63c762e76b24a67/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">表格树 element el-table</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>