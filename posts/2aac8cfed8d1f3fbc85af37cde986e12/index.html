<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DRM (Direct Rendering Manager) 的发展历史 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="DRM (Direct Rendering Manager) 的发展历史" />
<meta property="og:description" content="前言 了解 DRM 的发展历史，对于学习 DRM 驱动开发的人员来说，具有一定的帮助。
因此本人决定将 Wiki 上 Direct Rendering Manager 文章中的 History 章节翻译成中文，并重新组织语言形式，方便初学者阅读和理解。
正文 1999年，Precision Insight公司首次为 XFree86 4.0 Server 开发 DRI 显示框架，主要用于更好的适配 3dfx 公司的显卡。也就是在那时提交了第一版 DRM 代码，并以 kernel patch 的形式提交到了 Mesa3D 的 drm 仓库中。
当时的 mesa/drm 仓库其实是包含两部分代码的，一部分为 user space 代码（即后来的 libdrm），另一部分为 kernel space 代码（即后来的 drm 驱动）。
点击此处，查看 DRM 的第一版提交。需要注意的是，那个时候的 DRM 代码，主要以 buffer 管理为主，不包含 mode-setting 的部分。
同年晚些时候，该笔 patch 的 kernel 部分被 merge 到 kernel 2.3.18 主线中，当时的 drm 源码被放到了 /drivers/char/drm/ 目录下，作为字符设备来使用。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/2aac8cfed8d1f3fbc85af37cde986e12/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-01T21:16:28+08:00" />
<meta property="article:modified_time" content="2021-11-01T21:16:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DRM (Direct Rendering Manager) 的发展历史</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<h3><a name="t0"></a><br><a id="_0"></a><br> 前言</h3> 
<p></p> 
<p>了解 DRM 的发展历史，对于学习 DRM 驱动开发的人员来说，具有一定的帮助。<br> 因此本人决定将 Wiki 上 <a href="https://en.wikipedia.org/wiki/Direct_Rendering_Manager" rel="nofollow" title="Direct Rendering Manager">Direct Rendering Manager</a> 文章中的 <a href="https://en.wikipedia.org/wiki/Direct_Rendering_Manager#History" rel="nofollow" title="History">History</a> 章节翻译成中文，并重新组织语言形式，方便初学者阅读和理解。</p> 
<p></p> 
<h3><a name="t1"></a><br><a id="_4"></a><br> 正文</h3> 
<p></p> 
<p>1999年，Precision Insight公司首次为 XFree86 4.0 Server 开发 DRI 显示框架，主要用于更好的适配 3dfx 公司的显卡。也就是在那时提交了第一版 DRM 代码，并以 kernel patch 的形式提交到了 Mesa3D 的 drm 仓库中。</p> 
<p></p> 
<blockquote> 
 <p>当时的 mesa/drm 仓库其实是包含两部分代码的，一部分为 user space 代码（即后来的 libdrm），另一部分为 kernel space 代码（即后来的 drm 驱动）。<br><br><a href="https://cgit.freedesktop.org/mesa/drm/commit/?id=b6a28bfe98f2c89cfb91079bd3c7b63fb0144eb1" rel="nofollow" title="点击此处">点击此处</a>，查看 DRM 的第一版提交。需要注意的是，那个时候的 DRM 代码，主要以 buffer 管理为主，不包含 mode-setting 的部分。</p> 
</blockquote> 
<p></p> 
<p>同年晚些时候，该笔 patch 的 kernel 部分被 merge 到 kernel 2.3.18 主线中，当时的 drm 源码被放到了 <code>/drivers/char/drm/</code> 目录下，作为字符设备来使用。</p> 
<p></p> 
<blockquote> 
 <p><a href="https://repo.or.cz/w/davej-history.git/commit/9af6f6e4860e86507da2d470dd6a3bee34bf58c2" rel="nofollow" title="点击此处">点击此处</a>，查看该kernel提交。</p> 
</blockquote> 
<p></p> 
<p>在接下来的几年里，drm 驱动所支持的显卡数量不断在扩增。到2001年1月，<a class="hl hl-1" href="https://so.csdn.net/so/search?from=pc_blog_highlight&amp;q=Linux" title="Linux">Linux</a> 2.4.0 版本发布时，除了已经支持的 <em>3dfx Voodoo3</em> 显卡外，还支持 <em>Creative Labs GMX 2000</em>，<em>Intel i810</em>，<em>Matrox G200/G400</em> 和 <em>ATI Rage 128</em> 这些显卡。在后续的 Linux 2.4.x 系列版本中，随着 <em>ATI Radeon</em> 显卡，<em>SiS</em> 显卡, <em>Intel 830M</em> 以及再后来的集成显卡这些驱动的合入，DRM 所支持的显卡列表不断的被扩充。</p> 
<p></p> 
<blockquote> 
 <ul><li>Wiki: <a href="https://en.wikipedia.org/wiki/Direct_Rendering_Infrastructure" rel="nofollow" title="Direct Rendering Infrastructure (DRI)">Direct Rendering Infrastructure (DRI)</a></li><li>Wiki: <a href="https://en.wikipedia.org/wiki/XFree86" rel="nofollow" title="XFree86">XFree86</a></li><li>Wiki: <a href="https://en.wikipedia.org/wiki/3dfx_Interactive" rel="nofollow" title="3dfx">3dfx</a></li><li>Mesa 3D: <a href="http://cgit.freedesktop.org/mesa/drm/commit/?id=b6a28bfe98f2c89cfb91079bd3c7b63fb0144eb1" rel="nofollow" title="First DRI release of 3dfx driver">First DRI release of 3dfx driver</a></li><li>The History of Linux in GIT Repository: <a href="http://repo.or.cz/w/davej-history.git/commit/9af6f6e4860e86507da2d470dd6a3bee34bf58c2" rel="nofollow" title="Import 2.3.18pre1">Import 2.3.18pre1</a></li><li>Kernel.org: <a href="https://www.kernel.org/pub/linux/kernel/v2.4/linux-2.4.0.tar.gz" rel="nofollow" title="Linux 2.4.0 source code">Linux 2.4.0 source code</a></li></ul> 
</blockquote> 
<p></p> 
<p>在2004年的下半年，DRM 被分割成了2部分：<em>DRM Core</em> 和 <em>DRM Driver</em> ，并被 merge 到 kernel 2.6.11 主线版本中。该分割允许多个 DRM 驱动<strong>同时</strong>访问<strong>多个</strong>设备，为 <em>multi-GPU</em> 的支持开辟了道路，此次分割也被称为 <em><strong>DRM core/personality split</strong></em> 。</p> 
<p></p> 
<blockquote> 
 <ul><li>dri-devel (Mailing list): <a href="https://lwn.net/Articles/100839/" rel="nofollow" title="New proposed DRM interface design">New proposed DRM interface design</a></li><li>linux-kernel (Mailing list): <a href="https://lwn.net/Articles/117419/" rel="nofollow" title="drm core/personality split">drm core/personality split</a></li><li>linux-kernel (Mailing list): <a href="https://lkml.org/lkml/2005/1/12/6" rel="nofollow" title="Linux 2.6.11-rc1">Linux 2.6.11-rc1</a></li></ul> 
</blockquote> 
<p></p> 
<p>多年来，开发者们都一致认为，应该把所有 mode-setting 相关的代码放到 kernel 源码中去。但是显卡厂商却对此颇有争议，他们认为实现 mode-setting 操作的唯一途径，就是调用他们显卡厂商自己提供的 API，而这些 API 往往是被固化在显卡的 BIOS 中的，并且只能在 <em>X86 实模式</em> 下运行。这就导致 Linux kernel 根本无法调用这些显卡 API，因为 kernel 本身运行在 <em>X86 保护模式</em> 下。直到后来 Luc Verhaegen 和其它开发人员找到了一种新的方法，使用 natvie mode-setting 来代替 BIOS，这种局面才被打破。该方法证明了使用 kernel 的代码也可以完成 mode-setting 操作，这就为后来的 <em>Kernel Mode Setting</em> 代码奠定了基础。</p> 
<p></p> 
<blockquote> 
 <ul><li>Keith Packard: <a href="https://keithp.com/~keithp/talks/xarch_ols2004/xarch-ols2004-html/" rel="nofollow" title="The (Re)Architecture of the X Window System">The (Re)Architecture of the X Window System</a></li><li>Jon Smirl: <a href="https://blog.csdn.net/cyf15238622067/article/details/78603151" title="The State of Linux Graphics">The State of Linux Graphics</a></li><li>Keith Packard: <a href="https://keithp.com/blogs/kernel-mode-drivers/" rel="nofollow" title="kernel-mode-drivers">kernel-mode-drivers</a></li><li>Luc Verhaegen: <a href="https://people.freedesktop.org/~libv/X_and_Modesetting_-_Atrophy_illustrated_%28paper%29.pdf" rel="nofollow" title="X and Modesetting: Atrophy illustrated.">X and Modesetting: Atrophy illustrated.</a></li></ul> 
</blockquote> 
<p></p> 
<p>2007年5月，Jesse Barnes (来自 Intel) 发布了第一版 drm-modesetting API 提案，并在 Intel GPU i915 的 DRM 驱动中实现了 mode-setting 的操作。同年12月，Jerome Glisse 开始将 native mode-setting 代码添加到 ATI Radeon 显卡的 DRM 驱动中。2008年，该项任务的 API 和 driver 部分的工作仍在持续进行，但因为依赖 DRM 另一个重要组件 —— Memory Manager，而迟迟被延期，因为 mode-setting 需要依赖 Memory Manager 来管理 framebuffer。</p> 
<p></p> 
<blockquote> 
 <ul><li>Glisse, Jerome: <a href="https://jglisse.livejournal.com/852.html" rel="nofollow" title="Radeon kernel modesetting">Radeon kernel modesetting</a></li><li>Phoronix: <a href="https://www.phoronix.com/scan.php?page=article&amp;item=xorg_kms_2008&amp;num=1" rel="nofollow" title="The State of Kernel Mode-Setting">The State of Kernel Mode-Setting</a></li><li>Packard, Keith: <a href="https://keithp.com/blogs/X_output_status_july_2008/" rel="nofollow" title="X output status july 2008">X output status july 2008</a></li></ul> 
</blockquote> 
<p></p> 
<p>2008年10月，Linux kernel 2.6.27 进行了一次重大的源码重组，随后 DRM 也迎来了历史性的重大修改：DRM 的整套源码被放到了 <code>/drivers/gpu/drm/</code> 目录下，不同的GPU厂商代码也被放到了各自的子目录下，同时头文件也被移到了 <code>/include/drm</code> 目录下。</p> 
<p></p> 
<blockquote> 
 <p>drm重组修改：<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c0e09200dc0813972442e550a5905a132768e56c" rel="nofollow" title="drm: reorganise drm tree to be more future proof.">drm: reorganise drm tree to be more future proof.</a></p> 
</blockquote> 
<p></p> 
<p>随着显存管理的复杂性日益增加，开发人员也想出了多种方法来解决这类问题。最先出场的是 <em>Translation Table Maps (TTM)</em> 内存管理器，由 Thomas Hellstrom (Tungsten Graphics) 与 Eric Anholt (Intel) 和 Dave Airlie (Red Hat) 联合开发完成。在2007年11月，有人就提议将 TTM 纳入 kernel 2.6.25 主线版本中。在2008年5月，该提案又再一次被提及，可是最终还是被驳回了。取而代之的，是一种新的方案，叫做 <em>Graphics Execution Manager (GEM)</em>。GEM 最初是由 Intel 的 Keith Packard 和 Eric Anholt，为了解决 i915 drm driver 的内存管理问题，而开发的一种更加简单的内存管理方案。GEM 后来受到了广泛好评，并被 merge 到了 Linux kernel 2.6.28 版本中，于2008年12月正式发布。而在此期间，TTM 不得不苦苦等待，直到2009年9月，因为新的 Radeon KMS DRM driver 的要求，最终才被 merge 到 Linux 2.6.31 主线版本中。</p> 
<p></p> 
<blockquote> 
 <ul><li>LWN: <a href="https://lwn.net/Articles/257417/" rel="nofollow" title="Memory management for graphics processors">Memory management for graphics processors</a></li><li>LWN: <a href="https://lwn.net/Articles/283793/" rel="nofollow" title="GEM v. TTM">GEM v. TTM</a></li><li>LWN: <a href="https://lwn.net/Articles/283798/" rel="nofollow" title="GEM - the Graphics Execution Manager">GEM - the Graphics Execution Manager</a></li><li>Linux Kernel Newbies: <a href="https://kernelnewbies.org/Linux_2_6_28#The_GEM_Memory_Manager_for_GPU_memory" rel="nofollow" title="Linux 2.6.28 - The GEM Memory Manager for GPU memory">Linux 2.6.28 - The GEM Memory Manager for GPU memory</a></li><li>Kernel.org: <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ba4e7d973dd09b66912ac4c0856add8b0703a997" rel="nofollow" title="drm: Add the TTM GPU memory manager subsystem">drm: Add the TTM GPU memory manager subsystem</a></li></ul> 
</blockquote> 
<p></p> 
<p>有了内存管理来操作 buffer object，DRM 开发人员终于可以将早已完成的 mode-setting API 及相关动代码添加到 kernel 中了，这些 API 被称作 <em>Kernel Mode-setting (KMS)</em>，而实现这些 API 的驱动也被称之为 <em>KMS Drivers</em>。2009年3月，KMS 被合入到 Linux kernel 2.6.29 版本中，附带一起的还有 i915 KMS 驱动。从 libdrm 2.4.3 版本开始，KMS API 被导出到了用户空间，而Intel DDX 显卡驱动（位于用户空间的 X.Org 中）则是第一家使用 GEM 和 KMS APIs 的厂商驱动。2009年9月，Radeon KMS DRM 驱动被添加到了 Linux 2.6.31 发行版中，该驱动虽然使用的是 TTM 内存管理器，但是却向上层提供了与 GEM 相兼容的 API 和 ioctl。</p> 
<p></p> 
<blockquote> 
 <ul><li>Kernel.org: <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f453ba0460742ad027ae0c4c7d61e62817b3e7ef" rel="nofollow" title="DRM: add mode setting support">DRM: add mode setting support</a></li><li>Kernel.org: <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=79e539453b34e35f39299a899d263b0a1f1670bd" rel="nofollow" title="DRM: i915: add mode setting support">DRM: i915: add mode setting support</a></li><li>Kernel.org: <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=771fe6b912fca54f03e8a72eb63058b582775362" rel="nofollow" title="drm/radeon: introduce kernel modesetting for radeon hardware">drm/radeon: introduce kernel modesetting for radeon hardware</a></li><li>Linux Kernel Newbies: <a href="https://kernelnewbies.org/Linux_2_6_29#Kernel_Modesetting" rel="nofollow" title="Linux 2.6.29 - Kernel Modesetting">Linux 2.6.29 - Kernel Modesetting</a></li><li>Linux Kernel Newbies: <a href="https://kernelnewbies.org/Linux_2_6_31#ATI_Radeon_Kernel_Mode_Setting_support" rel="nofollow" title="Linux 2.6.31 - ATI Radeon Kernel Mode Setting support">Linux 2.6.31 - ATI Radeon Kernel Mode Setting support</a></li><li>dri-devel (Mailing list): <a href="https://lists.x.org/archives/xorg-announce/2008-December/000735.html" rel="nofollow" title="[ANNOUNCE] libdrm-2.4.3">[ANNOUNCE] libdrm-2.4.3</a></li><li>xorg-announce (Mailing list): <a href="https://lists.freedesktop.org/archives/xorg-announce/2008-October/000677.html" rel="nofollow" title="[ANNOUNCE] xf86-video-intel 2.5.0">[ANNOUNCE] xf86-video-intel 2.5.0</a></li><li>Phoronix: <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=NjY3Ng" rel="nofollow" title="A GEM-ified TTM Manager For Radeon">A GEM-ified TTM Manager For Radeon</a></li></ul> 
</blockquote> 
<p></p> 
<p>从2006年开始，nouveau 项目就开始在 Linux kernel 的非官方版本上开发用于免费使用的 NVIDIA DRM 驱动。在2010年，nouveau 项目的源代码被当作一款实验性的驱动 merge 到了 Linux2.6.33 版本中。在提交的过程中，该驱动也被转换成了 KMS 版本，同时使用 TTM 作为它的内存管理器。</p> 
<p></p> 
<blockquote> 
 <ul><li>Kernel.org: <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6ee738610f41b59733f63718f0bdbcba7d3a3f12" rel="nofollow" title="drm/nouveau: Add DRM driver for NVIDIA GPUs">drm/nouveau: Add DRM driver for NVIDIA GPUs</a></li><li>Linux Kernel Newbies: <a href="https://kernelnewbies.org/Linux_2_6_33#Nouveau.2C_a_driver_for_Nvidia_graphic_cards" rel="nofollow" title="Linux 2.6.33 - Nouveau, a driver for Nvidia graphic cards">Linux 2.6.33 - Nouveau, a driver for Nvidia graphic cards</a></li><li>Nouveau project: <a href="https://nouveau.freedesktop.org/wiki/Nouveau_Companion_40/" rel="nofollow" title="The irregular Nouveau Development Companion #40">The irregular Nouveau Development Companion #40</a></li></ul> 
</blockquote> 
<p></p> 
<p>KMS API (包括 GEM 在内) 是 DRM 开发过程中的一个重要里程碑，但是它并没有就此止步不前，而是在接下来的几年里不断的优化自己的 API。在 Linux 2.6.33 版本中，KMS 添加了 page flip 操作，用来与异步 VBLANK 事件进行同步，当时只有 i915 驱动支持该操作。后来在 Linux 2.6.38 发行版中， radeon 和 nouveau 驱动也都添加了对该操作的支持。该 page flip 对应的上层接口也被添加到了 libdrm 2.4.17 版本中。2011年初，在 Linux 2.6.39 发布周期内， <em>dumb buffer</em> 被添加到了 KMS API 中。所谓 “dumb buffer”，就是该 buffer 的操作不依赖于硬件或相关加速器，多用于简单 buffer 的应用场合，适合做 framebuffer 使用。它的目的是降低应用程序操作 DRM 的复杂度，比如 <em>Plymouth</em> 这种应用程序，本身使用场景就比较简单，无需使用 driver 所提供的特定 API 来完成 buffer 的操作。从 libdrm 2.4.25 版本开始，这个新特性就被添加进去了。同年晚些时候，KMS 又添加了一个新类型的 object，即 Plane。有些扫描引擎（即CRTC）本身附带硬件合成能力，这些负责硬件合成功能的模块往往被称为 HW overlay，而 Plane 就是用来抽象 overlay 硬件的。从 Linux 3.3 和 libdrm 2.4.30 版本开始，添加了对 Plane 的支持。在 Linux 3.5 和 libdrm 2.4.36 版本发布期间，另一个新增的重要元素，就是 generic object property —— 一种将常用参数添加到 KMS objects 中的方法。Property 的支持，对于那些需要完成特定行为或功能的 objects（如 CRTCs、planes）来说，是一种极其有效的操作方法。</p> 
<p></p> 
<blockquote> 
 <ul><li>Kernel.org: <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=d91d8a3f88059d93e34ac70d059153ec69a9ffc7" rel="nofollow" title="drm/kms: add page flipping ioctl">drm/kms: add page flipping ioctl</a></li><li>Kernel.org: <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ff72145badb834e8051719ea66e024784d000cb4" rel="nofollow" title="drm: dumb scanout create/mmap for intel/radeon (v3)">drm: dumb scanout create/mmap for intel/radeon (v3)</a></li><li>Kernel.org: <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=8cf5c9177151537e73ff1816540e4ba24b174391" rel="nofollow" title="drm: add plane support v3">drm: add plane support v3</a></li><li>Kernel.org: <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c543188afb7a83e66161c026dc6fd5eb38dc0b63" rel="nofollow" title="drm: add generic ioctls to get/set properties on any object">drm: add generic ioctls to get/set properties on any object</a></li><li>Linux Kernel Newbies: <a href="https://kernelnewbies.org/Linux_2_6_33#Graphic_improvements" rel="nofollow" title="Linux 2.6.33 - Graphic improvements">Linux 2.6.33 - Graphic improvements</a></li><li>Linux Kernel Newbies: <a href="https://kernelnewbies.org/Linux_2_6_38-DriversArch#Graphics" rel="nofollow" title="Linux 2.6.38 - Graphics">Linux 2.6.38 - Graphics</a></li><li>Linux Kernel Newbies: <a href="https://kernelnewbies.org/Linux_2_6_39-DriversArch#GRAPHICS" rel="nofollow" title="Linux 2.6.39-Graphics">Linux 2.6.39-Graphics</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2011-April/010031.html" rel="nofollow" title="[ANNOUNCE] libdrm 2.4.25">[ANNOUNCE] libdrm 2.4.25</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2011-April/010559.html" rel="nofollow" title="[RFC] drm: add overlays as first class KMS objects">[RFC] drm: add overlays as first class KMS objects</a></li><li>xorg-announce (Mailing list): <a href="https://lists.x.org/archives/xorg-announce/2012-June/001984.html" rel="nofollow" title="[ANNOUNCE] libdrm 2.4.36">[ANNOUNCE] libdrm 2.4.36</a></li><li>Linux GPU Driver Developer’s Guide: <a href="https://dri.freedesktop.org/docs/drm/gpu/drm-kms.html#dumb-buffer-objects" rel="nofollow" title="Dumb Buffer Objects">Dumb Buffer Objects</a></li></ul> 
</blockquote> 
<p></p> 
<p>2010年，Dave Airlie 开发出了可以在 DRM 驱动之间进行多 GPU 渲染的原型方案，因为 Airlie 当时想要模仿 NVIDIA Optimus 技术，所以它给自己的这项技术命名为 <strong>“PRIME”</strong>。2011年底，Airlie 恢复了他在 PRIME 上的工作，不过这次是基于 Linux 3.3 引入的一种新的 buffer 共享机制 —— DMA-BUF。DMA-BUF PRIME 基础框架最终于2012年3月完成，并被合入到 Linux 3.4 和 libdrm 2.4.34 版本中。后来在 Linux 3.5 版本发行期间，越来越多的 DRM 驱动实现了对 PRIME 的支持，其中包括 Intel i915 显卡驱动，AMD radeon 显卡驱动以及 NVIDIA nouveau 显卡驱动。</p> 
<p></p> 
<blockquote> 
 <ul><li>Wikipedia: <a href="https://en.wikipedia.org/wiki/Nvidia_Optimus" rel="nofollow" title="Nvidia Optimus">Nvidia Optimus</a></li><li>Airlie, Dave: <a href="https://airlied.livejournal.com/71734.html" rel="nofollow" title="GPU offloading - PRIME - proof of concept">GPU offloading - PRIME - proof of concept</a></li><li>Kernel.org: <a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=3248877ea1796915419fba7c89315fdbf00cb56a" rel="nofollow" title="drm: base prime/dma-buf support (v5)">drm: base prime/dma-buf support (v5)</a></li><li>Linux Kernel Newbies: <a href="http://kernelnewbies.org/Linux_3.4_DriverArch" rel="nofollow" title="Linux 3.4 DriverArch">Linux 3.4 DriverArch</a></li><li>Linux Kernel Newbies: <a href="http://kernelnewbies.org/Linux_3.5_DriverArch" rel="nofollow" title="Linux 3.5 DriverArch">Linux 3.5 DriverArch</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2012-March/020611.html" rel="nofollow" title="[PATCH] drm: base prime/dma-buf support (v5)">[PATCH] drm: base prime/dma-buf support (v5)</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/xorg-announce/2012-May/001948.html" rel="nofollow" title="[ANNOUNCE] libdrm 2.4.34">[ANNOUNCE] libdrm 2.4.34</a></li><li>Phoronix: <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=ODA1OQ" rel="nofollow" title="Proof Of Concept: Open-Source Multi-GPU Rendering!">Proof Of Concept: Open-Source Multi-GPU Rendering!</a></li><li>Phoronix: <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTA2MTM" rel="nofollow" title="DRM Base PRIME Support Part Of VGEM Work">DRM Base PRIME Support Part Of VGEM Work</a></li><li>Phoronix: <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTA3OTQ" rel="nofollow" title="Last Minute For Linux 3.4: DMA-BUF PRIME Support">Last Minute For Linux 3.4: DMA-BUF PRIME Support</a></li><li>Phoronix: <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTEwMjA" rel="nofollow" title="DMA-BUF PRIME Coming Together For Linux 3.5">DMA-BUF PRIME Coming Together For Linux 3.5</a></li></ul> 
</blockquote> 
<p></p> 
<p>近年来，DRM API 随着一些新的 feature 加入而不断的被扩展。在2013年，作为 GSoC 项目的一项开发计划，David Herrmann 开发出了 Multi-Render Nodes 的功能。他的这部分代码很快被 merge 到了 Linux 3.12 版本中，并作为实验性的功能被 i915、radeon 和 nouveau 驱动所支持。从 Linux 3.17 版本开始，该功能被默认开启使用。2014年，Matt Roper (Intel) 开发并提出了 Universal Plane（或者叫 Unified Plane）的概念，它将 framebuffer (primary plane)、overlay (secondary plane) 和 cursor (cursor plane) 这些 plane 都视为具有相同 API 的 objects，只是这些 objects 的 type 不一样而已。Universal Plane 的实现，具有更少、更通用的 ioctls，使得 DRM API 更加统一（译者注：这里的 universal plane，个人认为翻译成 “万能 plane ” 更贴切，因为它既可以是 primary，也可以是 overlay 或 cursor）。为了兼容旧的 API，DRM Core 将 universal plane 作为驱动的一个附加功能提供给上层使用。在 Linux3.15 和 libdrm 2.4.55 版本中，universal plane 首次亮相，部分驱动（如 Intel i915）也实现了对该功能的支持。</p> 
<p></p> 
<blockquote> 
 <ul><li>GSoC: <a href="https://en.wikipedia.org/wiki/Google_Summer_of_Code" rel="nofollow" title="The Google Summer of Code">The Google Summer of Code</a></li><li>Herrmann, David: <a href="http://dvdhrm.wordpress.com/2013/05/29/drm-render-and-modeset-nodes/" rel="nofollow" title="DRM Render- and Modeset-Nodes">DRM Render- and Modeset-Nodes</a></li><li>LWN: <a href="https://lwn.net/Articles/566122/" rel="nofollow" title="3.12 merge window, part 2">3.12 merge window, part 2</a></li><li>LWN: <a href="https://lwn.net/Articles/608434/" rel="nofollow" title="3.17 merge window, part 2">3.17 merge window, part 2</a></li><li>Kernel.org: <a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=1793126fcebd7c18834f95d43b55e387a8803aa8" rel="nofollow" title="drm: implement experimental render nodes">drm: implement experimental render nodes</a></li><li>Kernel.org: <a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=10ba50129ab0bdbc0ee712e50913d1c8db88c5f0" rel="nofollow" title="drm/i915: Support render nodes">drm/i915: Support render nodes</a></li><li>Kernel.org: <a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=f33bcab9e816c5bf56b74c3007790f2a256910eb" rel="nofollow" title="drm/radeon: Support render nodes">drm/radeon: Support render nodes</a></li><li>Kernel.org: <a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=7d7612582c15af8772c2fb2473d5fc7eebfefae2" rel="nofollow" title="drm/nouveau: Support render nodes">drm/nouveau: Support render nodes</a></li><li>dri-devel (Mailing list): <a href="http://lists.freedesktop.org/archives/dri-devel/2014-March/055222.html" rel="nofollow" title="[RFCv2 00/10] Universal plane support">[RFCv2 00/10] Universal plane support</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2014-July/064703.html" rel="nofollow" title="[ANNOUNCE] libdrm 2.4.55">[ANNOUNCE] libdrm 2.4.55</a></li><li>Phoronix: <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTY1MTg" rel="nofollow" title="Universal Plane Support Set For Linux 3.15">Universal Plane Support Set For Linux 3.15</a></li><li>Vetter, Daniel: <a href="https://blog.ffwll.ch/2014/08/neat-stuff-for-317.html" rel="nofollow" title="Neat stuff for 3.17">Neat stuff for 3.17</a></li></ul> 
</blockquote> 
<p></p> 
<p>近期 DRM API 最大的优化就是 atomic mode-setting API，它将原子操作的概念引入到了 mode-setting 和 page flip 操作中。Atomic API 的想法最早是在2012年提出的，Ville Syrjälä （Intel）接管了该 API 设计与实现的主要任务。在他的工作基础上，Rob Clark （TI）采用了同样的方式来实现 atomic page flip 操作。后来在2013年，mode-setting 和 page flip 这两个功能都被整合到同一个 ioctl 中，但是因为需要等待 universal plane 的功能完成，该 feature 一直等到2014年中旬才被合入主线版本。在2014年的下半年，为了让现有的 KMS 驱动转向新的 atomic 框架，Daniel Vetter （Intel）和其它 DRM 开发人员对 atomic 代码做了大量的优化。最终，这些修改都被合入到 Linux 3.19 和 Linux 4.0 发行版中，并且从 Linux 4.2 版本开始默认使用该功能。libdrm 从 2.4.62 版本开始支持这些新的 atomic API，许多驱动也都转而使用这些新的 API。到2018年，又有10个基于 atomic 框架的 DRM 新增驱动被添加到了 Linux kernel 中。</p> 
<p></p> 
<blockquote> 
 <ul><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2012-February/019165.html" rel="nofollow" title="[RFC] drm: atomic mode set API">[RFC] drm: atomic mode set API</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2012-May/023398.html" rel="nofollow" title="[RFC][PATCH 0/6] WIP: drm: Atomic mode setting idea">[RFC][PATCH 0/6] WIP: drm: Atomic mode setting idea</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2012-September/027506.html" rel="nofollow" title="[RFC 0/9] nuclear pageflip">[RFC 0/9] nuclear pageflip</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2013-October/046618.html" rel="nofollow" title="[RFCv1 00/12] Atomic/nuclear modeset/pageflip">[RFCv1 00/12] Atomic/nuclear modeset/pageflip</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2014-December/073956.html" rel="nofollow" title="[git pull] drm for 3.19-rc1">[git pull] drm for 3.19-rc1</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2015-February/077595.html" rel="nofollow" title="[git pull] drm pull for 3.20-rc1">[git pull] drm pull for 3.20-rc1</a></li><li>dri-devel (Mailing list): <a href="https://lists.freedesktop.org/archives/dri-devel/2015-June/085375.html" rel="nofollow" title="[ANNOUNCE] libdrm 2.4.62">[ANNOUNCE] libdrm 2.4.62</a></li><li>Vetter, Daniel: <a href="http://blog.ffwll.ch/2014/08/neat-stuff-for-317.html" rel="nofollow" title="Neat stuff for 3.17">Neat stuff for 3.17</a></li><li>Vetter, Daniel: <a href="https://blog.ffwll.ch/slides/lca-2016.pdf" rel="nofollow" title="Embrace the Atomic Display Age">Embrace the Atomic Display Age</a></li><li>Vetter, Daniel: <a href="http://blog.ffwll.ch/2014/11/atomic-modeset-support-for-kms-drivers.html" rel="nofollow" title="Atomic Modeset Support for KMS Drivers">Atomic Modeset Support for KMS Drivers</a></li><li>Vetter, Daniel: <a href="http://blog.ffwll.ch/2015/01/update-for-atomic-display-updates.html" rel="nofollow" title="Update for Atomic Display Updates">Update for Atomic Display Updates</a></li><li>Vetter, Daniel: <a href="http://blog.ffwll.ch/2016/06/awesome-atomic-advances.html" rel="nofollow" title="Awesome Atomic Advances">Awesome Atomic Advances</a></li><li>Stone, Daniel: <a href="https://www.collabora.com/news-and-blog/blog/2018/03/20/a-new-era-for-linux-low-level-graphics-part-1/" rel="nofollow" title="A new era for Linux’s low-level graphics - Part 1">A new era for Linux’s low-level graphics - Part 1</a></li><li>Linux Kernel Newbies: <a href="https://kernelnewbies.org/Linux_4.0-DriversArch#Graphics" rel="nofollow" title="Linux 4.0 - DriverArch - Graphics">Linux 4.0 - DriverArch - Graphics</a></li><li>Linux Kernel Newbies: <a href="https://kernelnewbies.org/Linux_4.2#Atomic_modesetting_API_enabled_by_default" rel="nofollow" title="Linux 4.2 - Atomic modesetting API enabled by default">Linux 4.2 - Atomic modesetting API enabled by default</a></li></ul> 
</blockquote> 
<p></p> 
<h3><a name="t2"></a><br><a id="_120"></a><br> 总结</h3> 
<p></p> 
<p>最后用一张图来总结一下 DRM 在历史上的重要事件：</p> 
<p></p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/e7/c2/LWAMjBco_o.png"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/51cf927570358587ed870fafc5b6aa59/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux图形栈-从X到Wayland</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/134cdcdb8a25153fb310096027d52150/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决 Win 10 输入法（仅桌面）的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>