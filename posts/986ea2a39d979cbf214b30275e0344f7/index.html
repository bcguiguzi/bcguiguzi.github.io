<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Logstash 配置文件中各种组件详解 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Logstash 配置文件中各种组件详解" />
<meta property="og:description" content="笔记主要源自#雪山飞胡#
文章目录 Logstash 前言Input PluginStdinFileHTTPTCPBeats Codec PluginPlainJson&amp;Json_linesMultiline Filter PluginDateGrok自定义grok pattern DissectMutateJsonGeoip Output PluginStdoutFileElasticsearch 补充 Logstash 前言 Logstash主要由三部分组成：input、filter、output。而filter就是过滤器插件，这个组件可以不要，但是这样子就不能体现出logtash的强大过滤功能了。
input{ 输入插件 } filter{ 过滤器插件 } outer{ 输出插件 } Input Plugin Stdin 交互式输入数据
stdin{}从控制台输入 ：
input{ stdin{ codec=&gt;&#34;plain&#34; tags=&gt;[&#34;test&#34;] type=&gt;&#34;std&#34; add_field=&gt;{&#34;key&#34;=&gt;&#34;value&#34;} } } output{ stdout{ codec=&gt;&#34;rubydebug&#34; } } codec类型为codec （请看下面Codec Plugin详解）type类型为string ,自定义该事件的类型,可用于后续判断tags类型为array ,自定义该事件的tag ,可用于后续判断add_field类型为hash ,为该事件添加字段 File 例 ：
input { file { path =&gt; [&#34;文件路径&#34;] start_position =&gt; &#34;beginning&#34; sincedb_path =&gt; &#34;/dev/null&#34; ignore_older =&gt; 0 } } 可选配置：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/986ea2a39d979cbf214b30275e0344f7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-11T15:38:44+08:00" />
<meta property="article:modified_time" content="2023-03-11T15:38:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Logstash 配置文件中各种组件详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><code>笔记主要源自#雪山飞胡#</code></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Logstash__10" rel="nofollow">Logstash 前言</a></li><li><a href="#Input_Plugin_37" rel="nofollow">Input Plugin</a></li><li><ul><li><a href="#Stdin_39" rel="nofollow">Stdin</a></li><li><a href="#File_66" rel="nofollow">File</a></li><li><a href="#HTTP_104" rel="nofollow">HTTP</a></li><li><a href="#TCP_114" rel="nofollow">TCP</a></li><li><a href="#Beats_127" rel="nofollow">Beats</a></li></ul> 
  </li><li><a href="#Codec_Plugin_144" rel="nofollow">Codec Plugin</a></li><li><ul><li><ul><li><a href="#Plain_158" rel="nofollow">Plain</a></li><li><a href="#JsonJson_lines_175" rel="nofollow">Json&amp;Json_lines</a></li><li><a href="#Multiline_181" rel="nofollow">Multiline</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Filter_Plugin_223" rel="nofollow">Filter Plugin</a></li><li><ul><li><a href="#Date_237" rel="nofollow">Date</a></li><li><a href="#Grok_264" rel="nofollow">Grok</a></li><li><ul><li><a href="#grok_pattern_292" rel="nofollow">自定义grok pattern</a></li></ul> 
   </li><li><a href="#Dissect_353" rel="nofollow">Dissect</a></li><li><a href="#Mutate_427" rel="nofollow">Mutate</a></li><li><a href="#Json_452" rel="nofollow">Json</a></li><li><a href="#Geoip_463" rel="nofollow">Geoip</a></li></ul> 
  </li><li><a href="#Output_Plugin_478" rel="nofollow">Output Plugin</a></li><li><ul><li><a href="#Stdout_480" rel="nofollow">Stdout</a></li><li><a href="#File_489" rel="nofollow">File</a></li><li><a href="#Elasticsearch_500" rel="nofollow">Elasticsearch</a></li></ul> 
  </li><li><a href="#_519" rel="nofollow">补充</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="Logstash__10"></a>Logstash 前言</h2> 
<p><strong>Logstash</strong>主要由三部分组成：<strong>input</strong>、<strong>filter</strong>、<strong>output</strong>。而filter就是过滤器插件，这个组件可以不要，但是这样子就不能体现出logtash的强大过滤功能了。</p> 
<pre><code class="prism language-r">input<span class="token punctuation">{<!-- --></span>

　　输入插件

<span class="token punctuation">}</span>

filter<span class="token punctuation">{<!-- --></span>

　　过滤器插件

<span class="token punctuation">}</span>

outer<span class="token punctuation">{<!-- --></span>

　　输出插件

<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c1/7d/GmtKo3tp_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Input_Plugin_37"></a>Input Plugin</h2> 
<h3><a id="Stdin_39"></a>Stdin</h3> 
<p>交互式输入数据<br> <code>stdin{}</code>从控制台输入 ：</p> 
<pre><code class="prism language-r">input<span class="token punctuation">{<!-- --></span>
	stdin<span class="token punctuation">{<!-- --></span>
		codec<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"plain"</span>
		tags<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token string">"test"</span><span class="token punctuation">]</span>
		type<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"std"</span>
		add_field<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token string">"key"</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"value"</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
output<span class="token punctuation">{<!-- --></span>
	stdout<span class="token punctuation">{<!-- --></span>
		codec<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"rubydebug"</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>codec类型为codec （请看下面Codec Plugin详解）</li><li>type类型为string ,自定义该事件的类型,可用于后续判断</li><li>tags类型为array ,自定义该事件的tag ,可用于后续判断</li><li>add_field类型为hash ,为该事件添加字段</li></ul> 
<h3><a id="File_66"></a>File</h3> 
<p>例 ：</p> 
<pre><code class="prism language-r">input <span class="token punctuation">{<!-- --></span>
    file <span class="token punctuation">{<!-- --></span>
        path <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">"文件路径"</span><span class="token punctuation">]</span>
        start_position <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"beginning"</span>
        sincedb_path <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"/dev/null"</span>
        ignore_older <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>可选配置：</p> 
<table><thead><tr><th align="center">配置项</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">path*</td><td align="center">数组类型，必选，用于知名读取的文件路径，基于glob匹配语法。</td></tr><tr><td align="center">exclude</td><td align="center">数组类型，排除不想监听的文件规则，基于glob匹配语法</td></tr><tr><td align="center">sincedb_path</td><td align="center">字符串类型，记录sinceddb文件路径，默认路径是当前用户的home文件夹</td></tr><tr><td align="center">start_position</td><td align="center">字符串类型，可以配置为beginning/end，是否从头读取文件</td></tr><tr><td align="center">stat_interval</td><td align="center">数值类型，单位为秒，定时检查文件是否有更新，默认是1秒</td></tr><tr><td align="center">discover_interval</td><td align="center">数值类型，单位为秒，定时检查是否有新文件待读取，默认是15秒</td></tr><tr><td align="center">ignore_older</td><td align="center">数值类型，单位为秒，扫描文件列表时，如果该文件上次更改时间超过设定的时长，则不做处理，但依然会监控是否有新内容，默认关闭</td></tr><tr><td align="center">close_older</td><td align="center">数值类型，单位为秒，如果监听的文件在超过该设定时间内没有新内容，会被关闭文件句柄，释放资源，但依然会监控是否有新内容，默认3600秒，即1小时</td></tr></tbody></table> 
<p>参数<code>path</code>模糊匹配 ：</p> 
<ul><li> <p><code>/var/log/*.log</code>：匹配<code>/var/log</code>目录下以<code>.log</code>结尾的所有文件</p> </li><li> <p><code>/var/log/**/*.log</code>：匹配<code>/var/log</code>所有子目录下以<code>.log</code>结尾的文件</p> </li><li> <p><code>/var/log/{app1,app2,app3}/*.log</code>：匹配/var/log目录下<code>app1，app2，app3</code>子目录中以<code>.log</code>结尾的文件</p> </li></ul> 
<p>参数<code>sincedb_path</code>通过<code>sincedb_path =&gt; "/dev/null"</code>可使文件每次都能从头开始读取(linux)<br> start_position：默认是从文件末尾开始解析（监控）<br> ignore_older：默认超过24小时的日志不解析，0表示不忽略任何过期日志</p> 
<h3><a id="HTTP_104"></a>HTTP</h3> 
<pre><code class="prism language-r">input <span class="token punctuation">{<!-- --></span>
  http <span class="token punctuation">{<!-- --></span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> 端口号
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="TCP_114"></a>TCP</h3> 
<pre><code class="prism language-r">input <span class="token punctuation">{<!-- --></span>
  tcp <span class="token punctuation">{<!-- --></span>
    mode <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"server"</span>
    host <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"0.0.0.0"</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> 端口号
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> json_lines
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Beats_127"></a>Beats</h3> 
<pre><code class="prism language-r"><span class="token comment"># 配置filebeat</span>
beats <span class="token punctuation">{<!-- --></span>
	type <span class="token operator">=</span><span class="token operator">&gt;</span> beats
    port <span class="token operator">=</span><span class="token operator">&gt;</span> 端口号
	<span class="token comment">#把当前不匹配行的数据添加到前面匹配行后面，直到新进的当前行匹配 ^\[ 正则为止。</span>
	codec <span class="token operator">=</span><span class="token operator">&gt;</span> multiline <span class="token punctuation">{<!-- --></span>
			pattern <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"^\["</span>
			negate <span class="token operator">=</span><span class="token operator">&gt;</span> true
			what <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"previous"</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Codec_Plugin_144"></a>Codec Plugin</h2> 
<p>编码插件（codec）可以在logstash输入或输出时处理不同类型的数据，同时，还可以更好更方便的与其他自定义格式的数据产品共存，比如：fluent、netflow、collectd等通用数据格式的其他产品。因此，logstash不只是一个input–&gt;filter–&gt;output的数据流，而且是一个input–&gt;decode–&gt;filter–&gt;encode–&gt;output的数据流。</p> 
<p>Codec Plugin<strong>作用于Input和Output Plugin</strong>，负责将数据在原始与Logstash Event之间转换，常见的codec有：</p> 
<ul><li>plain：读取原始内容，主要用于事件之间没有分隔的纯文本。</li><li>dots：将内容简化为点进行输出</li><li>rubydebug：将Logstash Events按照ruby格式输出，方便调试</li><li>line：处理带有换行符的内容</li><li>json：处理json格式的内容，如果数据为json格式，可直接使用该插件，从而省掉filter/grok的配置，降低过滤器的cpu消耗</li><li>multiline：处理多行数据的内容</li></ul> 
<h4><a id="Plain_158"></a>Plain</h4> 
<p>plain是最简单的编码插件，你输入什么信息，就返回什么信息</p> 
<pre><code class="prism language-r">input <span class="token punctuation">{<!-- --></span>
       	stdin <span class="token punctuation">{<!-- --></span> 
       		codec <span class="token operator">=</span><span class="token operator">&gt;</span> plain 
       	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

output <span class="token punctuation">{<!-- --></span>
	     stdout <span class="token punctuation">{<!-- --></span>
	        codec <span class="token operator">=</span><span class="token operator">&gt;</span> plain
	      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="JsonJson_lines_175"></a>Json&amp;Json_lines</h4> 
<p>有时候logstash采集的日志是JSON格式，那我们可以在input字段加入codec =&gt; json来进行解析，这样就可以根据具体内容生成字段，方便分析和储存。如果想让logstash输出为json格式，可以在output字段加入codec=&gt;json。</p> 
<h4><a id="Multiline_181"></a>Multiline</h4> 
<p>当一个Event的message由多行组成时，需要使用multiline，常见的情况是处理日志信息，如下所示：</p> 
<pre><code class="prism language-r">Exception <span class="token keyword">in</span> thread <span class="token string">"main"</span> java.lang.NullPointerException
	at com.example.myproject.Book.getTitle<span class="token punctuation">(</span>Book.java<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
	at com.example.myproject.Author.getBookTitles<span class="token punctuation">(</span>Author.java<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>
	at com.example.myproject.Bootstrap.main<span class="token punctuation">(</span>Bootstrap.java<span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span>
</code></pre> 
<table><thead><tr><th align="center">参数</th><th>说明</th></tr></thead><tbody><tr><td align="center">pattern</td><td>设置行匹配的正则表达式，可以使用grok</td></tr><tr><td align="center">what</td><td>可设置为previous或next。表示当与pattern匹配成功的时候，匹配行是归属上一个事件还是下一个事件</td></tr><tr><td align="center">negate</td><td>布尔值，表示是否对pattern的结果取反</td></tr></tbody></table> 
<p>例 ：</p> 
<pre><code class="prism language-r">input <span class="token punctuation">{<!-- --></span>
    file <span class="token punctuation">{<!-- --></span>
        path <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"/path/to/catalina.out"</span>
        start_position <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"beginning"</span>
        type <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"tomcat_log"</span>
        codec <span class="token operator">=</span><span class="token operator">&gt;</span> multiline <span class="token punctuation">{<!-- --></span>
            pattern <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"^%{MONTHDAY}[./-]%{MONTH}[./-]%{YEAR}"</span>
            negate <span class="token operator">=</span><span class="token operator">&gt;</span> true
            what <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"previous"</span>
            auto_flush_interval <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">10</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>pattern为正则表达式匹配</li><li>negate为布尔类型，true表示否定正则表达式，即不匹配正则表达式。false为匹配正则表达式。默认值为false</li><li>what表示如果正则匹配与否，事件属于上一个或者下一个事件。有两个值可选 - previous(上一个)或者next(下一个)</li><li>auto_flush_interval表示当多长时间没有新的数据，之前积累的多行数据转换为一个事件。这里的10表示10秒</li></ul> 
<blockquote> 
 <p>以上的配置可以解释为：不匹配pattern时间戳格式开头的行数据，都归属到上一个事件中，即在下一个匹配的时间戳出现之前的所有行的输出都属于同一个事件，从而达到合并多行的目的，同时等待10秒没有新数据产生，那么最后一个时间戳格式后的所有行数据就是最后一个事件。</p> 
</blockquote> 
<h2><a id="Filter_Plugin_223"></a>Filter Plugin</h2> 
<p><a href="https://blog.csdn.net/qq_29860591/article/details/103776428?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-1-103776428-blog-117676022.pc_relevant_antiscanv4&amp;spm=1001.2101.3001.4242.2&amp;utm_relevant_index=3">该博客讲解详细</a></p> 
<table><thead><tr><th align="center">插件名称</th><th>说明</th></tr></thead><tbody><tr><td align="center">date</td><td>日期解析</td></tr><tr><td align="center">grok</td><td>正则匹配解析</td></tr><tr><td align="center">dissect</td><td>分隔符解析</td></tr><tr><td align="center">mutate</td><td>对字段作处理，比如重命名、删除、替换</td></tr><tr><td align="center">json</td><td>按照json解析字段内容到指定字段中</td></tr><tr><td align="center">geoip</td><td>增加地理位置数据</td></tr><tr><td align="center">ruby</td><td>利用ruby代码来动态修改Logstash Event</td></tr></tbody></table> 
<h3><a id="Date_237"></a>Date</h3> 
<p>date插件可以将日期字符串解析为日期类型，然后替换@timestamp字段或者指定其他字段：</p> 
<pre><code class="prism language-r">filter <span class="token punctuation">{<!-- --></span>
	date <span class="token punctuation">{<!-- --></span>
		match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">"logdate"</span><span class="token punctuation">,</span> <span class="token string">"MM dd yyy HH:mm:ss"</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通过以上配置，我们可以将</p> 
<pre><code class="prism language-r"><span class="token punctuation">{<!-- --></span>
	<span class="token string">"logdate"</span><span class="token operator">:</span> <span class="token string">"Jan 01 2018 12:02:2018"</span>
	<span class="token string">"target"</span><span class="token operator">:</span> <span class="token string">"@timestamp"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>转换为：</p> 
<pre><code class="prism language-r"><span class="token punctuation">{<!-- --></span>
	<span class="token string">"@version"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"1"</span>
	<span class="token string">"host"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"..."</span>
	<span class="token string">"logdate"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Jan01 <span class="token number">2018</span> <span class="token number">12</span><span class="token operator">:</span><span class="token number">02</span><span class="token operator">:</span><span class="token number">08</span>
	<span class="token string">"@timestamp"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"2018-01-01T04:02:08.000Z"</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Grok_264"></a>Grok</h3> 
<p>grok语法：<br> 例子：<code>%{SYNTAX:SEMANTIC}</code><br> SYNTAX为grok pattern的名称，SEMANTIC为赋值字段名称。%{NUMBER:duration}可以匹配数值类型，但是grok匹配出的内容都是字符串类型，可以通过在最后指定为int或者float来强转类型：%{NUMBER:duration:int}</p> 
<p>grok插件用于解析日志内容，例如我们要将下面这一条日志解析成json数组。</p> 
<pre><code class="prism language-r"><span class="token number">83.149</span><span class="token number">.9</span><span class="token number">.216</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">/</span>May<span class="token operator">/</span><span class="token number">2015</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">03</span> <span class="token operator">+</span><span class="token number">0000</span><span class="token punctuation">]</span> <span class="token string">"GET /presentations/logstash-monitorama-2013/images/kibana-search.png HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">203023</span> <span class="token string">"http://semicomplete.com/presentations/logstash-monitorama-2013/"</span> <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36"</span>
</code></pre> 
<p>那么我们就可以这样来配置grok：</p> 
<pre><code class="prism language-r">%<span class="token punctuation">{<!-- --></span>IPORHOST<span class="token operator">:</span>clientip<span class="token punctuation">}</span> \<span class="token punctuation">[</span>%<span class="token punctuation">{<!-- --></span>HTTPDATE<span class="token operator">:</span>timestamp<span class="token punctuation">}</span>\<span class="token punctuation">]</span> <span class="token string">"%{WORD:verb} %{DATA:request} HTTP/%{NUMBER:httpversion}"</span> %<span class="token punctuation">{<!-- --></span>NUMBER<span class="token operator">:</span>response<span class="token operator">:</span>int<span class="token punctuation">}</span> <span class="token punctuation">(</span>?<span class="token operator">:</span><span class="token operator">-</span><span class="token operator">|</span>%<span class="token punctuation">{<!-- --></span>NUMBER<span class="token operator">:</span>bytes<span class="token operator">:</span>int<span class="token punctuation">}</span><span class="token punctuation">)</span> %<span class="token punctuation">{<!-- --></span>QS<span class="token operator">:</span>referrer<span class="token punctuation">}</span> %<span class="token punctuation">{<!-- --></span>QS<span class="token operator">:</span>agent<span class="token punctuation">}</span>
</code></pre> 
<ul><li> <p>%{IP:clientip} 匹配模式将获得的结果为：clientip: 83.149.9.216</p> </li><li> <p>%{HTTPDATE:timestamp} 匹配模式将获得的结果为：timestamp: 17/May/2015:10:05:03 +0000</p> </li><li> <p>%{QS:referrer} 匹配模式将获得的结果为：referrer: “GET /presentations/logstash-monitorama-2013/images/kibana-search.png HTTP/1.1”</p> </li></ul> 
<p><a href="https://github.com/logstash-plugins/logstash-patterns-core/blob/main/patterns/legacy/grok-patterns">grok内置pattern</a></p> 
<h4><a id="grok_pattern_292"></a>自定义grok pattern</h4> 
<p><strong>一</strong></p> 
<pre><code class="prism language-r">filter <span class="token punctuation">{<!-- --></span>
	grok <span class="token punctuation">{<!-- --></span>
		match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string">"message"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"%{SERVICE:service}"</span>
		<span class="token punctuation">}</span>
		pattern_definitions <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string">"SERVICE"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"[a-z0-9]{10,11}"</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>二</strong></p> 
<p>格式 ： <code>(?&lt;fieldName&gt;pattern)</code><br> fieldName ： 指定匹配要赋值的名称<br> pattern ： 匹配的正则表达式<br> 例 ：</p> 
<pre><code class="prism language-r"><span class="token punctuation">[</span><span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">08</span><span class="token operator">:</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">,</span><span class="token number">253</span><span class="token punctuation">]</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span><span class="token punctuation">[</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8080</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span>com.hh.test.logs.LogsApplication<span class="token punctuation">]</span><span class="token punctuation">[</span>code<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>msg<span class="token operator">:</span>测试录入错误日志<span class="token punctuation">,</span>param<span class="token operator">:</span><span class="token punctuation">{<!-- --></span>fdsafdsfdf<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> 
<p>指定grok表达式 ：</p> 
<pre><code class="prism language-r"><span class="token punctuation">(</span>?<span class="token operator">&lt;</span>date<span class="token operator">&gt;</span>\d<span class="token punctuation">{<!-- --></span><span class="token number">4</span><span class="token punctuation">}</span><span class="token operator">-</span>\d<span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span><span class="token operator">-</span>\d<span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span>\s\d<span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span><span class="token operator">:</span>\d<span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span><span class="token operator">:</span>\d<span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\d<span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\<span class="token punctuation">]</span>\<span class="token punctuation">[</span><span class="token punctuation">(</span>?<span class="token operator">&lt;</span>type<span class="token operator">&gt;</span><span class="token punctuation">[</span>A<span class="token operator">-</span>Z<span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span>\<span class="token punctuation">]</span>\<span class="token punctuation">[</span><span class="token punctuation">(</span>?<span class="token operator">&lt;</span>thread<span class="token operator">&gt;</span><span class="token punctuation">[</span>A<span class="token operator">-</span>z0<span class="token operator">-</span><span class="token number">9</span><span class="token operator">-</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">)</span>\<span class="token punctuation">]</span>\<span class="token punctuation">[</span><span class="token punctuation">(</span>?<span class="token operator">&lt;</span>class<span class="token operator">&gt;</span><span class="token punctuation">[</span>A<span class="token operator">-</span>z\.<span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">)</span>\<span class="token punctuation">]</span>\<span class="token punctuation">[</span>code<span class="token operator">:</span><span class="token punctuation">(</span>?<span class="token operator">&lt;</span>code<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>msg<span class="token operator">:</span><span class="token punctuation">(</span>?<span class="token operator">&lt;</span>msg<span class="token operator">&gt;</span>.<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>param<span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>?<span class="token operator">&lt;</span>param<span class="token operator">&gt;</span>.<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\<span class="token punctuation">]</span>
</code></pre> 
<p>返回结果</p> 
<pre><code class="prism language-r"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"date"</span><span class="token operator">:</span> <span class="token string">"2018-11-24 08:33:43,253"</span><span class="token punctuation">,</span>
  <span class="token string">"msg"</span><span class="token operator">:</span> <span class="token string">"测试录入错误日志"</span><span class="token punctuation">,</span>
  <span class="token string">"code"</span><span class="token operator">:</span> <span class="token string">"200"</span><span class="token punctuation">,</span>
  <span class="token string">"param"</span><span class="token operator">:</span> <span class="token string">"fdsafdsfdf"</span><span class="token punctuation">,</span>
  <span class="token string">"thread"</span><span class="token operator">:</span> <span class="token string">"http-nio-8080-exec-4"</span><span class="token punctuation">,</span>
  <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"ERROR"</span><span class="token punctuation">,</span>
  <span class="token string">"class"</span><span class="token operator">:</span> <span class="token string">"com.hh.test.logs.LogsApplication"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>grok删除不需要的数据 ：</p> 
<pre><code class="prism language-r">filter <span class="token punctuation">{<!-- --></span>       
	grok <span class="token punctuation">{<!-- --></span>           
	 match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"\s*%{TIMESTAMP_ISO8601}\s+(?&lt;Level&gt;(\S+)).*"</span><span class="token punctuation">]</span>   
	 <span class="token punctuation">}</span>

 	<span class="token keyword">if</span> <span class="token punctuation">[</span>Level<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"DEBUG"</span> <span class="token punctuation">{<!-- --></span>    drop <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>     <span class="token punctuation">}</span>        
 
	<span class="token keyword">if</span> <span class="token punctuation">[</span>Level<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"INFO"</span> <span class="token punctuation">{<!-- --></span>     drop <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>    <span class="token punctuation">}</span>
 
 <span class="token punctuation">}</span>
</code></pre> 
<p>Level 为grok 解析后字段的属性名称<br> 可在 Input Plugin 指定type值，然后在Filter Plugin根据type值动态保留所要的数据</p> 
<h3><a id="Dissect_353"></a>Dissect</h3> 
<p>源自<code>shark_西瓜甜</code><br> Dissect filter 是一种分割操作。与常规拆分操作不同，其中一个分隔符应用于整个字符串，此操作将一组分隔符应用于字符串值。</p> 
<p>Dissect不使用正则表达式，而且速度非常快。但是，如果文本的结构因行而异，那么Grok更适合。</p> 
<p>例 ：</p> 
<pre><code class="prism language-r">input <span class="token punctuation">{<!-- --></span> stdin <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span>

filter <span class="token punctuation">{<!-- --></span>
    dissect <span class="token punctuation">{<!-- --></span>
        mapping <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"message"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"%{ts} %{+ts} %{+ts} %{src} %{} %{prog}[%{pid}]: %{msg}"</span>
        <span class="token punctuation">}</span>
        convert_datatype <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
            pid <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"int"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

output <span class="token punctuation">{<!-- --></span> stdout <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<p>测试数据 ：</p> 
<pre><code class="prism language-r">%<span class="token punctuation">{<!-- --></span>ts<span class="token punctuation">}</span> %<span class="token punctuation">{<!-- --></span><span class="token operator">+</span>ts<span class="token punctuation">}</span> %<span class="token punctuation">{<!-- --></span><span class="token operator">+</span>ts<span class="token punctuation">}</span> %<span class="token punctuation">{<!-- --></span>src<span class="token punctuation">}</span> %<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token percent-operator operator">%{prog}[%</span><span class="token punctuation">{<!-- --></span>pid<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token operator">:</span> %<span class="token punctuation">{<!-- --></span>msg<span class="token punctuation">}</span>
hello world hello shark <span class="token number">123</span> logs <span class="token punctuation">[</span><span class="token number">456</span><span class="token punctuation">]</span><span class="token operator">:</span> hellohello
</code></pre> 
<p>返回结果 ：</p> 
<pre><code class="prism language-r"><span class="token punctuation">{<!-- --></span>
          <span class="token string">"host"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"es03"</span><span class="token punctuation">,</span>
    <span class="token string">"@timestamp"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">07</span>T14<span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">40.010</span>Z<span class="token punctuation">,</span>
       <span class="token string">"message"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"hello world hello shark 123 logs [456]: hellohello"</span><span class="token punctuation">,</span>
           <span class="token string">"src"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"shark"</span><span class="token punctuation">,</span>
           <span class="token string">"pid"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">456</span><span class="token punctuation">,</span>
      <span class="token string">"@version"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
          <span class="token string">"prog"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"logs "</span><span class="token punctuation">,</span>
            <span class="token string">"ts"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"hello world hello"</span><span class="token punctuation">,</span>
           <span class="token string">"msg"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"hellohello"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>dissect语法简单，因此它能处理的场景比较有限。它只能处理格式相似，且有分隔符的字符串。它的语法如下：</p> 
<ul><li>%{}里面是字段</li><li>两个%{}之间是分隔符。</li><li>%{+some_field} 表示把匹配到的内容追加到前一个字段中</li><li>%{+some_field/2} 表示带序号的追加,2 表示追加到第二个位置</li></ul> 
<p>追加字段 ：</p> 
<ul><li>对于文本 <code>1 2 3 go</code>, 这个 <code>%{+a/2} %{+a/1} %{+a/4} %{+a/3}</code> 将构建一个 <code>a =&gt; 2 1 go 3 </code>的键值。</li><li>对于文本 <code>1 2 3 go</code>, 这个<code> %{a} %{b} %{+a}</code> 将构建两个键值对: <code>a =&gt; 1 3 go, b =&gt; 2</code></li></ul> 
<p>跳过字段 ：</p> 
<ul><li><code>%{}</code> 是一个空的跳过字段。</li><li><code>%{?foo}</code> 是一个命名的跳过字段,就是把匹配到的内容先存到字段 foo<br> 中，但是不会出现在事件中，这种情况是让后面的某些模式使用其匹配到的值的。</li></ul> 
<p>间接字段 ：</p> 
<ul><li>对于字符串： <code>error: some_error, some_description</code></li><li>这个表达式 <code>error: %{?err}, %{&amp;err}</code>将会构建一个这样的键值对: <code>some_error =&gt; some_description</code></li></ul> 
<p><code>%{?err} </code>跳过<code>some_error</code>字段保存但是但是不会出现在事件中，<code>%{&amp;err}</code>又引用<code>%{err}</code><br> 所以最终<code> some_error =&gt; some_description</code></p> 
<h3><a id="Mutate_427"></a>Mutate</h3> 
<p>可以对字段进行各种操作，比如重命名、删除、替换、更新等，主要操作如下：</p> 
<ul><li>convert类型转换</li><li>gsub字符串替换</li><li>split、join、merge字符串切割、数组合并为字符串、数组合并为数组</li><li>rename字段重命名</li><li>update、replace字段内容更新或替换。它们都可以更新字段的内容，区别在于update只在字段存在时生效，而replace在字段不存在时会执行新增字段的操作</li><li>remove_field删除字段</li></ul> 
<p>例 ：</p> 
<pre><code class="prism language-r">mutate <span class="token punctuation">{<!-- --></span>
    convert <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token string">"age"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"integer"</span><span class="token punctuation">}</span>
    gsub <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token string">"birthday"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
        <span class="token string">"image"</span><span class="token punctuation">,</span> <span class="token string">"\/"</span><span class="token punctuation">,</span> <span class="token string">"_"</span>
    <span class="token punctuation">]</span>
    split <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token string">"hobities"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">","</span><span class="token punctuation">}</span>
    rename <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token string">"hobities"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"hobityList"</span><span class="token punctuation">}</span>
    replace <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token string">"icon"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"%{image}"</span><span class="token punctuation">}</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Json_452"></a>Json</h3> 
<p>将字段内容为json格式的数据解析出来。</p> 
<pre><code class="prism language-r">filter <span class="token punctuation">{<!-- --></span>
	json <span class="token punctuation">{<!-- --></span>
		source <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"message"</span>
		target <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"msg_json"</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Geoip_463"></a>Geoip</h3> 
<p>根据ip地址提供对应的地域信息，比如经纬度、城市名等，方便进行地理数据分析。</p> 
<pre><code class="prism language-r">filter <span class="token punctuation">{<!-- --></span>
    geoip <span class="token punctuation">{<!-- --></span>
        source <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"clientIp"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>clientIp : 指定IP的属性名</p> 
<h2><a id="Output_Plugin_478"></a>Output Plugin</h2> 
<h3><a id="Stdout_480"></a>Stdout</h3> 
<p>输出到控制台</p> 
<pre><code class="prism language-r">output <span class="token punctuation">{<!-- --></span>
    stdout <span class="token punctuation">{<!-- --></span>
        codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="File_489"></a>File</h3> 
<p>输出到文件，实现将分散在多地的文件统一到一处的需求，比如将所有web机器的web日志收集到1个文件中，从而方便查阅信息</p> 
<pre><code class="prism language-r">output <span class="token punctuation">{<!-- --></span>
    file <span class="token punctuation">{<!-- --></span>
        path <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"文件路径"</span>
        codec <span class="token operator">=</span><span class="token operator">&gt;</span> line <span class="token punctuation">{<!-- --></span>format <span class="token operator">=</span><span class="token operator">&gt;</span> %<span class="token punctuation">{<!-- --></span>message<span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Elasticsearch_500"></a>Elasticsearch</h3> 
<p>输出到elasticsearch</p> 
<pre><code class="prism language-r">output <span class="token punctuation">{<!-- --></span>
  elasticsearch <span class="token punctuation">{<!-- --></span>
    hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">"http://192.168.3.12:9200"</span><span class="token punctuation">]</span>
    index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"logstash-%{+YYYY.MM.dd}"</span>
    document_type <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"_doc"</span>
    user <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"用户名"</span>
    password <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"密码"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>hosts ：elasticsearch地址<br> index ： 设置插入的索引</p> 
<hr> 
<h2><a id="_519"></a>补充</h2> 
<p><strong>较复杂示例模板</strong> ：</p> 
<pre><code class="prism language-r">input <span class="token punctuation">{<!-- --></span>
   beats <span class="token punctuation">{<!-- --></span>
     type <span class="token operator">=</span><span class="token operator">&gt;</span> beats
     port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">5000</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
filter <span class="token punctuation">{<!-- --></span>
    multiline <span class="token punctuation">{<!-- --></span>
              patterns_dir <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"/Users/ArpitAggarwal/logstash/patterns"</span>
              pattern <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"\[%{TOMCAT_DATESTAMP}"</span>
              what <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"previous"</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"my_log"</span> and <span class="token string">"com.test.controller.log.LogController"</span> <span class="token keyword">in</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
        mutate <span class="token punctuation">{<!-- --></span>
                add_tag <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">"MY_LOG"</span> <span class="token punctuation">]</span>
               <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token string">"_grokparsefailure"</span> <span class="token keyword">in</span> <span class="token punctuation">[</span>tags<span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>
                  drop <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
       date <span class="token punctuation">{<!-- --></span>
             match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">"timestamp"</span><span class="token punctuation">,</span> <span class="token string">"UNIX_MS"</span> <span class="token punctuation">]</span>
             target <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"@timestamp"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            drop <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
output <span class="token punctuation">{<!-- --></span>
   stdout <span class="token punctuation">{<!-- --></span>
          codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug
   <span class="token punctuation">}</span>
   <span class="token keyword">if</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"my_log"</span>  <span class="token punctuation">{<!-- --></span>
                elasticsearch <span class="token punctuation">{<!-- --></span>
                           manage_template <span class="token operator">=</span><span class="token operator">&gt;</span> false
                           hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">"localhost:9201"</span><span class="token punctuation">]</span>
                 <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>logstash可以使用条件判断来控制filter的执行。官方说明见Accessing Event Data and Fields in the Configuration。支持的运算符包括：</p> 
<pre><code class="prism language-c">相等<span class="token operator">:</span> <span class="token operator">==</span><span class="token punctuation">,</span> <span class="token operator">!=</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token punctuation">,</span> <span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;=</span><span class="token punctuation">,</span> <span class="token operator">&gt;=</span>
正则<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">~</span><span class="token punctuation">(</span>匹配正则<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token operator">~</span><span class="token punctuation">(</span>不匹配正则<span class="token punctuation">)</span>
包含<span class="token operator">:</span> <span class="token function">in</span><span class="token punctuation">(</span>包含<span class="token punctuation">)</span><span class="token punctuation">,</span> not <span class="token function">in</span><span class="token punctuation">(</span>不包含<span class="token punctuation">)</span>
布尔操作<span class="token operator">:</span> <span class="token function">and</span><span class="token punctuation">(</span>与<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">or</span><span class="token punctuation">(</span>或<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">nand</span><span class="token punctuation">(</span>非与<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">xor</span><span class="token punctuation">(</span>非或<span class="token punctuation">)</span>
一元运算<span class="token operator">:</span> <span class="token operator">!</span><span class="token punctuation">(</span>取反<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>复合表达式<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>对复合表达式结果取反<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cdb7c9a47fe0d7565dc4a9929e4cc5cd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">KALI的MSF使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0c9eff3a794f9e88ad6d5cf02cdc00bf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2022.4Kali数据源的更新</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>