<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>二层转发的学习 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="二层转发的学习" />
<meta property="og:description" content="1、网络拓扑 二层即网络接入层/数据链路层，处理单段链路（局域网）上的端到端报文交互。局域网（Local Area Network， LAN）指在某一区域内由多台网络设备互联组成的网络。
pc1接入switch lan1口，pc2接入switch lan2口。pc1配置静态ip192.168.0.10，子网掩码为255.255.255.0pc2配置静态ip192.168.0.20，子网掩码为255.255.255.0 二层转发是基于 MAC 地址进行数据包的转发，本章以此拓扑为基础，通过 报文从 PC1 发出，如何被设备转发到 PC2，并且如何将 PC2 的报文转发回 PC1， 将其中所发生的过程通过一步一步的方式进行学习。
2、局域网互通 首先查看pc1 ping pc2发送了那些报文：
通过抓包查看只有ARP和ICMP两种报文，且都是跟IP相关的报文。
3、ICMP报文 Pc1发送 ICMP Echo Request请求 Pc2回复ICMP Echo Reply 当Pc1能正常收到Pc2的回复报文时，表示此时IP可达。
4、ARP报文 地址解析协议（Address Resolution Protocol），是根据 IP 地址获取物理地址的一个 TCP/IP 协议。报文格式如下：
ARP请求 字段
字节数
描述
硬件类型
2
1，Ethernet，即局域网为以太网
协议类型
2
0x0800,IPv4
硬件地址长度
1
6,以太网采用MAC编址
协议地址长度
1
4，IPv4长度为4
操作码
2
1,ARP请求
发送端MAC
6
PC1 MAC
发送端IP
4
PC1 IP
接收端MAC" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/6d90d3b747a9bb544213f5683aa6d2bb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-01T10:35:25+08:00" />
<meta property="article:modified_time" content="2023-12-01T10:35:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">二层转发的学习</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:0;text-align:center;"></h2> 
<h3 style="background-color:transparent;margin-left:0px;text-align:justify;">1、网络拓扑</h3> 
<p style="margin-left:0;text-align:justify;">二层即网络接入层/数据链路层，处理单段链路（局域网）上的端到端报文交互。局域网（Local Area Network， LAN）指在某一区域内由多台网络设备互联组成的网络。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c3/6c/npdxS4mr_o.png"></p> 
<ol><li style="text-align:justify;">pc1接入switch lan1口，pc2接入switch lan2口。</li><li style="text-align:justify;">pc1配置静态ip192.168.0.10，子网掩码为255.255.255.0</li><li style="text-align:justify;">pc2配置静态ip192.168.0.20，子网掩码为255.255.255.0</li></ol> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">二层转发是基于 MAC 地址进行数据包的转发，本章以此拓扑为基础，通过 报文从 PC1 发出，如何被设备转发到 PC2，并且如何将 PC2 的报文转发回 PC1， 将其中所发生的过程通过一步一步的方式进行学习。</p> 
<h3 style="margin-left:0;text-align:justify;">2、局域网互通</h3> 
<p style="margin-left:0;text-align:justify;">首先查看pc1 ping pc2发送了那些报文：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/9c/6f/UaSyanp3_o.png"></p> 
<p style="margin-left:0;text-align:justify;">通过抓包查看只有ARP和ICMP两种报文，且都是跟IP相关的报文。</p> 
<h3 style="background-color:transparent;margin-left:0px;text-align:justify;">3、ICMP报文</h3> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/5d/dd/MOefXrAm_o.jpg"></p> 
<ol><li style="text-align:justify;"><strong>Pc1发送 ICMP Echo Request请求</strong></li></ol> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/28/5c/P9GCYmCc_o.png"></p> 
<ol><li style="text-align:justify;"><strong>Pc2回复ICMP Echo Reply</strong></li></ol> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/28/9a/maaxSi9s_o.png"></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FF0000;">当Pc1能正常收到Pc2的回复报文时，表示此时IP可达。</span></p> 
<h3 style="background-color:transparent;margin-left:0px;text-align:justify;">4、ARP报文</h3> 
<p style="margin-left:0;text-align:justify;">地址解析协议（Address Resolution Protocol），是根据 IP 地址获取物理地址的一个 TCP/IP 协议。报文格式如下：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/33/81/sSz8zkoi_o.png"></p> 
<ol><li style="text-align:justify;"><strong>ARP请求</strong></li></ol> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/09/cb/dqI1J2d5_o.png"></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>字段</strong></p> </td><td style="border-color:#000000;vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>字节数</strong></p> </td><td style="border-color:#000000;vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>描述</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>硬件类型</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>2</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>1，Ethernet，即局域网为以太网</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>协议类型</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>2</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>0x0800,IPv4</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>硬件地址长度</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>1</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>6,以太网采用MAC编址</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>协议地址长度</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>1</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>4，IPv4长度为4</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>操作码</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>2</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>1,ARP请求</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>发送端MAC</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>6</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>PC1 MAC</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>发送端IP</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>4</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>PC1 IP</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>接收端MAC</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>6</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>PC2 MAC</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>接收端IP</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>4</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>PC2 IP</strong></p> </td></tr></tbody></table> 
<p style="margin-left:0;text-align:justify;"></p> 
<ol><li style="text-align:justify;"><strong>ARP响应</strong></li></ol> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/a8/b2/7pYVKqwa_o.png"></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>字段</strong></p> </td><td style="border-color:#000000;vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>字节数</strong></p> </td><td style="border-color:#000000;vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>描述</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>硬件类型</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>2</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>1，Ethernet，即局域网为以太网</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>协议类型</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>2</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>0x0800,IPv4</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>硬件地址长度</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>1</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>6,以太网采用MAC编址</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>协议地址长度</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>1</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>4，IPv4长度为4</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>操作码</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>2</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>2,ARP响应</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>发送端MAC</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>6</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>PC2 MAC</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>发送端IP</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>4</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>PC2 IP</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>接收端MAC</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>6</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>PC1 MAC</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;"><strong>接收端IP</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>4</strong></p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;"><strong>PC1 IP</strong></p> </td></tr></tbody></table> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FF0000;">同时，由抓包可知，ARP 报文的下层封装为 Ethernet II，即以太网协议</span></p> 
<h3 style="background-color:transparent;margin-left:0px;text-align:justify;">5、以太网帧</h3> 
<p style="margin-left:0;text-align:justify;">以太网协议是使用最为管饭的局域网技术协议，实现了二层数据链路的数据 传输和地址封装（MAC）。目前应用的帧格式常为 Ethernet II。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/9b/61/GVXI1Njl_o.png"></p> 
<ol><li style="text-align:justify;"><strong>常见Type（类型）取值</strong></li></ol> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>0x0800</strong></p> </td><td style="border-color:#000000;vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>IPv4协议</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>0x86DD</strong></p> </td><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>IPv6协议</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>0x0806</strong></p> </td><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>ARP地址解析协议</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>0x8863</strong></p> </td><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>以太网PPP发现阶段</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>0x8864</strong></p> </td><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>以太网PPP会话阶段</strong></p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>0x8100</strong></p> </td><td style="vertical-align:top;width:213.05pt;"> <p style="margin-left:0;text-align:center;"><strong>802.1Q</strong></p> </td></tr></tbody></table> 
<ol><li style="text-align:justify;"><strong>MAC</strong></li></ol> 
<p style="margin-left:0;text-align:justify;">MAC 地址由 48 位比特即 6 个字节来表示.</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/28/fd/lbVihdr1_o.png"></p> 
<ol><li style="text-align:justify;">I/G 为 0 则为单播地址，为 1 则为多播地址（组播、广播）。</li><li style="text-align:justify;">G/L 为 0 则为全局（全球分配）地址，为 1 则为本地地址（Local Address） 。</li><li style="text-align:justify;">OUI 为厂商标识 。</li><li style="text-align:justify;">广播 MAC：全为 1 的 MAC 地址（FF-FF-FF-FF-FF-FF）表示 LAN 上的所 有设备。</li></ol> 
<h3 style="background-color:transparent;margin-left:0px;text-align:justify;">6、IP报文</h3> 
<p style="margin-left:0;text-align:justify;">Internet Protocol 网际协议缩写为 IP，是 TCP/IP 协议族中最为核心的协议，拥有 V4 和 V6 两个版本，是网络设备互联互通的基础。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/4e/25/X1IBDwSg_o.png"></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FF0000;">IPv4</span><span style="background-color:#FF0000;">头部的最小长度为20字节，最大长度为60字节。</span></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/fb/56/QdyzBwpm_o.png"></p> 
<table align="center" border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">字段</p> </td><td style="border-color:#000000;vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">大小</p> </td><td style="border-color:#000000;vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">描述</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">版本</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">4bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">IP协议版本，IPv4和IPv6</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">IP头部长度</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">4bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">IP报文头部长度</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">区分服务tos</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">8bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">服务类型，一般不使用</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">总长度</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">16biits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">头部和数据的长度和</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">标识</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">16bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">维持的计数器</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">标志</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">3bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">DF、MF，即分片传输或数据未分片</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">片偏移</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">13bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">分片在原始报文中的相对位置</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">生存时间TTL</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">8bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">路由时-1，防止无效报文传输</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">协议</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">8bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">上层协议号，TCP 6,UDP 17,ICMP 1</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">首部校验和</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">16bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">头部信息校验和</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">发送端IP</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">32bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">数据包的发送端IP</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:142pt;"> <p style="margin-left:0;text-align:center;">接收端IP</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">32bits</p> </td><td style="vertical-align:top;width:142.05pt;"> <p style="margin-left:0;text-align:center;">数据包的接收端IP</p> </td></tr></tbody></table> 
<h3 style="background-color:transparent;margin-left:0px;text-align:justify;">7、ARP的意义</h3> 
<p style="margin-left:0;text-align:justify;">当了解了一次 ping 互通检查所涉及到协议报文之后，回过来想一想，为什 么在 ping 的时候，首先会抓到 ARP 报文，ARP 的意义在哪里？试想一下，作 为实现者应该怎么去做。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/cc/0a/HZ1y6FQR_o.png"></p> 
<p style="margin-left:0;text-align:justify;">前文讲道，网络实现中分层与封装是核心思想，对于收到的报文，本层处 理完之后，解封装去除头部，交予上层处理，对于发送的报文，本层收到数据 后，加上本层头部，传递给下层处理，那么，一步一步来构建 PC1 的报文。</p> 
<ol><li style="text-align:justify;">ICMP报文每个字段都能填写。</li></ol> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/21/82/q33SOA5F_o.png"></p> 
<ol><li style="text-align:justify;">ICMP 协议基于 IP 协议，于是交给 IP 层处理，由于所有的信息已 知，IP 层也可以完成报文头部的封装。</li></ol> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/bf/41/2FAJ1o3N_o.png"></p> 
<p style="margin-left:0;text-align:justify;">3））IP 层封装完后，交予下层 MAC 层处理，MAC 层进行报文头部封 装，需要目的 MAC 和源 MAC，此时，源 MAC 从本机可得，目的 MAC 成为 未知。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/3a/e0/sZ4qr4eU_o.png"></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FF0000;">所以需要ARP协议，来获取目的IP的MAC地址，来实现整个报文的封装，将报文发送出去。</span></p> 
<h3 style="margin-left:0;text-align:justify;">8、ARP表</h3> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FF0000;">凡是需要自行封装报文的网络设备，均会存储 MAC 与 IP 的对应关系，称为 ARP 表。</span></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/b9/ec/0tjtbz5Z_o.png"></p> 
<p style="margin-left:0;text-align:justify;">通过命令 arp -a查看当前主机下的所有arp表项。</p> 
<h3 style="margin-left:0;text-align:justify;">9、MAC地址表</h3> 
<p style="margin-left:0;text-align:justify;">既然是二层转发，那么网络设备即是工作在网络参考模型的二层，即对 MAC 层进行处理，依靠 MAC 地址来进行报文的转发。</p> 
<p style="margin-left:0;text-align:justify;"><strong>MAC地址表的字段有</strong></p> 
<ol><li style="text-align:justify;">Hash</li></ol> 
<p style="margin-left:0;text-align:justify;">表示表项在整个mac地址表中的hash索引，方便快速找到。</p> 
<ol><li style="text-align:justify;">Port</li></ol> 
<p style="margin-left:0;text-align:justify;">表示报文接受对应的端口。</p> 
<ol><li style="text-align:justify;">Vid</li></ol> 
<p style="margin-left:0;text-align:justify;">表示报文对应的vlan id，可能来自于端口的pvid，也可能来自于报文本身。</p> 
<ol><li style="text-align:justify;">Age</li></ol> 
<p style="margin-left:0;text-align:justify;">表示表项的老化时间。</p> 
<ol><li style="text-align:justify;">mac-address</li></ol> 
<p style="margin-left:0;text-align:justify;">表示由接受报文的源MAC提供。</p> 
<h3 style="margin-left:0;text-align:justify;">10、vlan</h3> 
<p style="margin-left:0;text-align:justify;">VLAN（Virtual Local Area Network，虚拟局域网）是一种将局域网划分为多个逻辑上独立的虚拟局域网的技术。通过使用 VLAN 技术，可以将一个物理上的局域网划分成多个逻辑上的子网，不同的子网之间彼此隔离，就好像它们是连接到不同的交换机端口一样。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">VLAN 的主要作用包括：</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<ol><li style="text-align:justify;">隔离流量：不同 VLAN 中的数据包不会直接在交换机上进行转发，这样可以隔离广播、组播等网络流量，提高网络的安全性和性能。</li><li style="text-align:justify;">灵活管理：通过 VLAN 可以根据业务需求对网络进行逻辑上的划分，而无需重新布线和调整物理连接。</li><li style="text-align:justify;">安全性：VLAN 可以帮助实现安全策略，限制不同 VLAN 中的设备相互访问，从而提高网络安全性。</li></ol> 
<p style="margin-left:0;text-align:justify;"><strong><span style="color:#FF0000;">Vlan</span><span style="color:#FF0000;">的核心功能就是数据转发的出入规则。</span></strong></p> 
<h3 style="margin-left:0;text-align:justify;">11、广播</h3> 
<p style="margin-left:0;text-align:justify;">广播工作在 OSI 七层模型中的数据链路层。</p> 
<p style="margin-left:0;text-align:justify;">广播会将报文发送到整个二层网络中所有的端口，包含发送端口本身。</p> 
<h3 style="margin-left:0;text-align:justify;">12、泛洪</h3> 
<p style="margin-left:0;text-align:justify;">对于单播报文的泛洪以及直接端口转发。二层转发根据MAC表来实现转发， 根据报文中的目的 MAC，在转发表中查找出接口。如果找不到出接口，则将报 文发送到该接口之外的所有其它接口，称之为泛洪；如果找到出接口则直接端口 转发。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="color:#FF0000;">根据目的MAC地址，在MAC地址表中查询对应的接口，如果不存在就将数据转发给所有接口，宁可全发错发，也不愿意不发。</span></strong></p> 
<h3 style="margin-left:0;text-align:justify;">13、二层ping的流程</h3> 
<h4 style="background-color:transparent;margin-left:0px;text-align:justify;">1）选择网卡</h4> 
<p style="margin-left:0;text-align:justify;">通过目标ip在本地路由表中选择一个最合适的网卡来发送数据。</p> 
<p style="margin-left:0;text-align:justify;">根据目的ip和本地路由表中的子网掩码计算得到最合适的网卡。</p> 
<p style="margin-left:0;text-align:justify;">如果有多个合适的网卡优先选择子网掩码最大的网卡。</p> 
<p style="margin-left:0;text-align:justify;">如果都没有就会选择本地路由表中的缺省路由<span style="color:#FF0000;">（0.0.0.0，下一条（网关）192.168.80.1,网卡192.168.81.93）</span>。</p> 
<p style="margin-left:0;text-align:justify;">在链路上表示是局域网。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c1/87/tqJeKQsL_o.png"></p> 
<ol><li style="text-align:justify;"> <h4 style="margin-left:0;text-align:justify;">2）查看本地arp表</h4> <p style="margin-left:0;text-align:justify;">在本地arp表中查询是否有目的ip的mac映射。</p> <p style="margin-left:0;text-align:justify;">如果有则直接进行第四步。</p> <p style="margin-left:0;text-align:justify;">如果没有，就封装arp请求报文，内容为硬件类型为1(以太网类型)，协议类型为0x0800(IPv4)，MAC地址长度6，IP地址长度4，操作码为1(arp请求)，源mac、ip，目的mac（全0）、ip。</p> <p style="margin-left:0;text-align:justify;">因为arp的下层封装为以太网，所以还需要封装以太网帧头，内容为目的mac地址全f，源mac地址，类型0x0806(arp)。</p> <h4 style="margin-left:0;text-align:justify;">3）封装报文</h4> <p style="margin-left:0;text-align:justify;">封装imcp头，内容为type 0,code 8,校验和，标识（一般为进程号），序列号(消息发送顺序)，时间戳。</p> <p style="margin-left:0;text-align:justify;">封装IP头，封装以太网帧头。</p> <h4 style="margin-left:0;text-align:justify;">4）解报文</h4> <p style="margin-left:0;text-align:justify;">接收端收到从端口转发的报文后，检查以太网帧头的目的mac，如果是自己就接受，不是就丢弃，如何拆解ip头，得到icmp报文，然后解析数据，再执行第四步，但code要修改为0.</p> <h4 style="margin-left:0;text-align:justify;">5）发送端收到回复</h4> <p style="margin-left:0;text-align:justify;">发送端收到报文后会检查一下是否是发给自己的，是的话ping完成。</p> </li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a8cc164082054156237b35c136ce2232/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">huggingface HF_HOME 更换缓存目录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5df5d9f7b849bdc68b1e3252dd864adc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Flutter-使用setState来实现动态UI刷新实现UI交互</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>