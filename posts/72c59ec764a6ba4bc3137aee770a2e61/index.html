<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>自定义View:仿抖音直播点赞效果 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="自定义View:仿抖音直播点赞效果" />
<meta property="og:description" content="目录
一、效果图
1、第一版本：在屏幕底部开始显示 2、第二版本：点击任意位置都可以显示
3、第三版本：给任意控件添加点赞效果
二、代码
1、第一版本代码 源码：
示例：
2、第二版本代码
源码（主要是增加了ontouchEvent的处理还有修改贝塞尔四个点的坐标范围）：
示例：
3、第三版本代码（主要是增加了ontouchlistener）
源码：
示例：
一、效果图 1、第一版本：在屏幕底部开始显示 2、第二版本：点击任意位置都可以显示 3、第三版本：给任意控件添加点赞效果 二、代码 1、第一版本代码 源码： package com.example.lovelayout; import android.animation.Animator; import android.animation.AnimatorListenerAdapter; import android.animation.AnimatorSet; import android.animation.ObjectAnimator; import android.animation.TypeEvaluator; import android.animation.ValueAnimator; import android.content.Context; import android.graphics.PointF; import android.graphics.drawable.Drawable; import android.util.AttributeSet; import android.view.ViewGroup; import android.widget.ImageView; import android.widget.RelativeLayout; import java.util.Random; import androidx.core.content.ContextCompat; public class MyLoveLayout extends RelativeLayout { private int[] imgResId; private Random random; private int mWidth; private int mHeight; private int drawableWidth; private int drawableHeight; public MyLoveLayout(Context context) { this(context, null); } public MyLoveLayout(Context context, AttributeSet attrs) { this(context, attrs, 0); } public MyLoveLayout(Context context, AttributeSet attrs, int defStyleAttr) { super(context, attrs, defStyleAttr); imgResId = new int[]{R." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/72c59ec764a6ba4bc3137aee770a2e61/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-13T19:47:45+08:00" />
<meta property="article:modified_time" content="2021-09-13T19:47:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">自定义View:仿抖音直播点赞效果</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E6%95%88%E6%9E%9C%E5%9B%BE-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E6%95%88%E6%9E%9C%E5%9B%BE" rel="nofollow" title="一、效果图">一、效果图</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%201%E3%80%81%E7%AC%AC%E4%B8%80%E7%89%88%E6%9C%AC%EF%BC%9A%E5%9C%A8%E5%B1%8F%E5%B9%95%E5%BA%95%E9%83%A8%E5%BC%80%E5%A7%8B%E6%98%BE%E7%A4%BA%C2%A0-toc" style="margin-left:40px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%201%E3%80%81%E7%AC%AC%E4%B8%80%E7%89%88%E6%9C%AC%EF%BC%9A%E5%9C%A8%E5%B1%8F%E5%B9%95%E5%BA%95%E9%83%A8%E5%BC%80%E5%A7%8B%E6%98%BE%E7%A4%BA%C2%A0" rel="nofollow" title="        1、第一版本：在屏幕底部开始显示 ">        1、第一版本：在屏幕底部开始显示 </a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A02%E3%80%81%E7%AC%AC%E4%BA%8C%E7%89%88%E6%9C%AC%EF%BC%9A%E7%82%B9%E5%87%BB%E4%BB%BB%E6%84%8F%E4%BD%8D%E7%BD%AE%E9%83%BD%E5%8F%AF%E4%BB%A5%E6%98%BE%E7%A4%BA-toc" style="margin-left:40px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A02%E3%80%81%E7%AC%AC%E4%BA%8C%E7%89%88%E6%9C%AC%EF%BC%9A%E7%82%B9%E5%87%BB%E4%BB%BB%E6%84%8F%E4%BD%8D%E7%BD%AE%E9%83%BD%E5%8F%AF%E4%BB%A5%E6%98%BE%E7%A4%BA" rel="nofollow" title="        2、第二版本：点击任意位置都可以显示">        2、第二版本：点击任意位置都可以显示</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%203%E3%80%81%E7%AC%AC%E4%B8%89%E7%89%88%E6%9C%AC%EF%BC%9A%E7%BB%99%E4%BB%BB%E6%84%8F%E6%8E%A7%E4%BB%B6%E6%B7%BB%E5%8A%A0%E7%82%B9%E8%B5%9E%E6%95%88%E6%9E%9C-toc" style="margin-left:40px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%203%E3%80%81%E7%AC%AC%E4%B8%89%E7%89%88%E6%9C%AC%EF%BC%9A%E7%BB%99%E4%BB%BB%E6%84%8F%E6%8E%A7%E4%BB%B6%E6%B7%BB%E5%8A%A0%E7%82%B9%E8%B5%9E%E6%95%88%E6%9E%9C" rel="nofollow" title="        3、第三版本：给任意控件添加点赞效果">        3、第三版本：给任意控件添加点赞效果</a></p> 
<p id="%C2%A0%E4%BA%8C%E3%80%81%E4%BB%A3%E7%A0%81-toc" style="margin-left:0px;"><a href="#%C2%A0%E4%BA%8C%E3%80%81%E4%BB%A3%E7%A0%81" rel="nofollow" title=" 二、代码"> 二、代码</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A01%E3%80%81%E7%AC%AC%E4%B8%80%E7%89%88%E6%9C%AC%E4%BB%A3%E7%A0%81%C2%A0%20%C2%A0%C2%A0-toc" style="margin-left:40px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A01%E3%80%81%E7%AC%AC%E4%B8%80%E7%89%88%E6%9C%AC%E4%BB%A3%E7%A0%81%C2%A0%20%C2%A0%C2%A0" rel="nofollow" title="        1、第一版本代码    ">        1、第一版本代码    </a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%BA%90%E7%A0%81%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%BA%90%E7%A0%81%EF%BC%9A" rel="nofollow" title="        源码：">        源码：</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E7%A4%BA%E4%BE%8B%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E7%A4%BA%E4%BE%8B%EF%BC%9A" rel="nofollow" title="        示例：">        示例：</a></p> 
<p id="2%E3%80%81%E7%AC%AC%E4%BA%8C%E7%89%88%E6%9C%AC%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E7%AC%AC%E4%BA%8C%E7%89%88%E6%9C%AC%E4%BB%A3%E7%A0%81" rel="nofollow" title="2、第二版本代码">2、第二版本代码</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%BA%90%E7%A0%81%EF%BC%88%E4%B8%BB%E8%A6%81%E6%98%AF%E5%A2%9E%E5%8A%A0%E4%BA%86ontouchEvent%E7%9A%84%E5%A4%84%E7%90%86%E8%BF%98%E6%9C%89%E4%BF%AE%E6%94%B9%E8%B4%9D%E5%A1%9E%E5%B0%94%E5%9B%9B%E4%B8%AA%E7%82%B9%E7%9A%84%E5%9D%90%E6%A0%87%E8%8C%83%E5%9B%B4%EF%BC%89%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%BA%90%E7%A0%81%EF%BC%88%E4%B8%BB%E8%A6%81%E6%98%AF%E5%A2%9E%E5%8A%A0%E4%BA%86ontouchEvent%E7%9A%84%E5%A4%84%E7%90%86%E8%BF%98%E6%9C%89%E4%BF%AE%E6%94%B9%E8%B4%9D%E5%A1%9E%E5%B0%94%E5%9B%9B%E4%B8%AA%E7%82%B9%E7%9A%84%E5%9D%90%E6%A0%87%E8%8C%83%E5%9B%B4%EF%BC%89%EF%BC%9A" rel="nofollow" title="        源码（主要是增加了ontouchEvent的处理还有修改贝塞尔四个点的坐标范围）：">        源码（主要是增加了ontouchEvent的处理还有修改贝塞尔四个点的坐标范围）：</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E7%A4%BA%E4%BE%8B%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E7%A4%BA%E4%BE%8B%EF%BC%9A" rel="nofollow" title="        示例：">        示例：</a></p> 
<p id="3%E3%80%81%E7%AC%AC%E4%B8%89%E7%89%88%E6%9C%AC%E4%BB%A3%E7%A0%81%EF%BC%88%E4%B8%BB%E8%A6%81%E6%98%AF%E5%A2%9E%E5%8A%A0%E4%BA%86ontouchlistener%EF%BC%89-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E7%AC%AC%E4%B8%89%E7%89%88%E6%9C%AC%E4%BB%A3%E7%A0%81%EF%BC%88%E4%B8%BB%E8%A6%81%E6%98%AF%E5%A2%9E%E5%8A%A0%E4%BA%86ontouchlistener%EF%BC%89" rel="nofollow" title="3、第三版本代码（主要是增加了ontouchlistener）">3、第三版本代码（主要是增加了ontouchlistener）</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E6%BA%90%E7%A0%81%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E6%BA%90%E7%A0%81%EF%BC%9A" rel="nofollow" title="        源码：">        源码：</a></p> 
<p style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E7%A4%BA%E4%BE%8B%EF%BC%9A" rel="nofollow" title="        示例：">        示例：</a></p> 
<hr id="hr-toc"> 
<h2 id="%E4%B8%80%E3%80%81%E6%95%88%E6%9E%9C%E5%9B%BE">一、效果图</h2> 
<h3 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%201%E3%80%81%E7%AC%AC%E4%B8%80%E7%89%88%E6%9C%AC%EF%BC%9A%E5%9C%A8%E5%B1%8F%E5%B9%95%E5%BA%95%E9%83%A8%E5%BC%80%E5%A7%8B%E6%98%BE%E7%A4%BA%C2%A0">        1、第一版本：在屏幕底部开始显示 </h3> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/15/9d/92OUfwOQ_o.gif"></p> 
<h3 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A02%E3%80%81%E7%AC%AC%E4%BA%8C%E7%89%88%E6%9C%AC%EF%BC%9A%E7%82%B9%E5%87%BB%E4%BB%BB%E6%84%8F%E4%BD%8D%E7%BD%AE%E9%83%BD%E5%8F%AF%E4%BB%A5%E6%98%BE%E7%A4%BA">        2、第二版本：点击任意位置都可以显示</h3> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c9/5d/OzHpDM3r_o.gif"></p> 
<h3 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%203%E3%80%81%E7%AC%AC%E4%B8%89%E7%89%88%E6%9C%AC%EF%BC%9A%E7%BB%99%E4%BB%BB%E6%84%8F%E6%8E%A7%E4%BB%B6%E6%B7%BB%E5%8A%A0%E7%82%B9%E8%B5%9E%E6%95%88%E6%9E%9C">        3、第三版本：给任意控件添加点赞效果</h3> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/eb/48/4AxBfX4c_o.gif"></p> 
<p></p> 
<h2 id="%C2%A0%E4%BA%8C%E3%80%81%E4%BB%A3%E7%A0%81"> 二、代码</h2> 
<h3 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A01%E3%80%81%E7%AC%AC%E4%B8%80%E7%89%88%E6%9C%AC%E4%BB%A3%E7%A0%81%C2%A0%20%C2%A0%C2%A0">        1、第一版本代码    </h3> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%BA%90%E7%A0%81%EF%BC%9A">        源码：</h4> 
<pre><code>package com.example.lovelayout;

import android.animation.Animator;
import android.animation.AnimatorListenerAdapter;
import android.animation.AnimatorSet;
import android.animation.ObjectAnimator;
import android.animation.TypeEvaluator;
import android.animation.ValueAnimator;
import android.content.Context;
import android.graphics.PointF;
import android.graphics.drawable.Drawable;
import android.util.AttributeSet;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.RelativeLayout;

import java.util.Random;

import androidx.core.content.ContextCompat;

public class MyLoveLayout extends RelativeLayout {
    private int[] imgResId;
    private Random random;
    private int mWidth;
    private int mHeight;
    private int drawableWidth;
    private int drawableHeight;

    public MyLoveLayout(Context context) {
        this(context, null);
    }

    public MyLoveLayout(Context context, AttributeSet attrs) {
        this(context, attrs, 0);
    }

    public MyLoveLayout(Context context, AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        imgResId = new int[]{R.drawable.off, R.drawable.on};
        random = new Random();
        Drawable drawable = ContextCompat.getDrawable(context, R.drawable.on);
        drawableWidth = drawable.getIntrinsicWidth();
        drawableHeight = drawable.getIntrinsicHeight();
    }

    @Override
    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        super.onMeasure(widthMeasureSpec, heightMeasureSpec);
        mWidth = MeasureSpec.getSize(widthMeasureSpec);
        mHeight = MeasureSpec.getSize(heightMeasureSpec);
    }

    //添加图片
    public void addView() {
        ImageView loveImg = new ImageView(getContext());
        loveImg.setImageResource(imgResId[random.nextInt(imgResId.length)]);
        RelativeLayout.LayoutParams params = new RelativeLayout.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);
        params.addRule(CENTER_HORIZONTAL);
        params.addRule(ALIGN_PARENT_BOTTOM);
        loveImg.setLayoutParams(params);
        addView(loveImg);
        //开始动画
        startAni(loveImg);
    }

    private void startAni(ImageView loveImg) {
        //透明度、缩放动画
        ObjectAnimator alphaAni = ObjectAnimator.ofFloat(loveImg, "Alpha", 0f, 1f);
        ObjectAnimator scaleXAni = ObjectAnimator.ofFloat(loveImg, "ScaleX", 0.2f, 1f);
        alphaAni.setDuration(500);
        scaleXAni.setDuration(500);

        //贝塞尔路径动画
        ValueAnimator bizerAni = getBizerPathAni(loveImg);

        AnimatorSet aniSet = new AnimatorSet();
        aniSet.play(alphaAni).with(scaleXAni).before(bizerAni);
        aniSet.start();
    }

    private ValueAnimator getBizerPathAni(final ImageView loveImg) {
        //point0 point3 起始点和终点 point1 point2 控制点
        PointF point0 = new PointF(mWidth / 2 - drawableWidth / 2, mHeight - drawableHeight);//左上角
        PointF point1 = new PointF(random.nextInt(mWidth - drawableWidth), random.nextInt(mHeight / 2)+ mHeight / 2);
        PointF point2 = new PointF(random.nextInt(mWidth - drawableWidth), random.nextInt(mHeight / 2) );
        PointF point3 = new PointF(random.nextInt(mWidth - drawableWidth), 0);

        final ValueAnimator bizerPathAni = ValueAnimator.ofObject(new MyEvalutator(point0, point3), point1, point2);
        bizerPathAni.setDuration(3000);
        bizerPathAni.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
            @Override
            public void onAnimationUpdate(ValueAnimator animation) {
                PointF bizerPoint = (PointF) animation.getAnimatedValue();
                //改变imageview的坐标
                loveImg.setX(bizerPoint.x);
                loveImg.setY(bizerPoint.y);
                float t = animation.getAnimatedFraction();
                //设置透明度，慢慢消失
                loveImg.setAlpha(1.3f - t);
            }
        });
        bizerPathAni.addListener(new AnimatorListenerAdapter() {
            @Override
            public void onAnimationEnd(Animator animation) {
                removeView(loveImg);
            }
        });
        return bizerPathAni;
    }

    private class MyEvalutator implements TypeEvaluator&lt;PointF&gt; {
        private PointF point0;//起点
        private PointF point3;//终点
        private PointF pointBizer;

        public MyEvalutator(PointF point0, PointF point3) {
            this.point0 = point0;
            this.point3 = point3;
            pointBizer = new PointF();
        }

        @Override
        public PointF evaluate(float t, PointF point1, PointF point2) {
            //三次贝塞尔曲线
            pointBizer.x = (float) (point0.x * Math.pow(1 - t, 3) + 3 * point1.x * t * Math.pow(1 - t, 2)
                    + 3 * point2.x * t * t * (1 - t) + point3.x * Math.pow(t, 3));

            pointBizer.y = (float) (point0.y * Math.pow(1 - t, 3) + 3 * point1.y * t * Math.pow(1 - t, 2)
                    + 3 * point2.y * t * t * (1 - t) + point3.y * Math.pow(t, 3));
            return pointBizer;
        }
    }


}
</code></pre> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E7%A4%BA%E4%BE%8B%EF%BC%9A">        示例：</h4> 
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;com.example.lovelayout.MyLoveLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/loveLayout"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity"&gt;

    &lt;Button
        android:id="@+id/btn"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="点击" /&gt;

&lt;/com.example.lovelayout.MyLoveLayout&gt;</code></pre> 
<pre><code>package com.example.lovelayout;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.view.View;
import android.widget.Button;

public class MainActivity extends AppCompatActivity {
    MyLoveLayout loveLayout;
    Button btn;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        loveLayout = (MyLoveLayout) findViewById(R.id.loveLayout);
        btn = (Button) findViewById(R.id.btn);
        btn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                loveLayout.addView();
            }
        });
    }
}
</code></pre> 
<p></p> 
<h3 id="2%E3%80%81%E7%AC%AC%E4%BA%8C%E7%89%88%E6%9C%AC%E4%BB%A3%E7%A0%81">2、第二版本代码</h3> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%BA%90%E7%A0%81%EF%BC%88%E4%B8%BB%E8%A6%81%E6%98%AF%E5%A2%9E%E5%8A%A0%E4%BA%86ontouchEvent%E7%9A%84%E5%A4%84%E7%90%86%E8%BF%98%E6%9C%89%E4%BF%AE%E6%94%B9%E8%B4%9D%E5%A1%9E%E5%B0%94%E5%9B%9B%E4%B8%AA%E7%82%B9%E7%9A%84%E5%9D%90%E6%A0%87%E8%8C%83%E5%9B%B4%EF%BC%89%EF%BC%9A">        源码（主要是增加了ontouchEvent的处理还有修改贝塞尔四个点的坐标范围）：</h4> 
<pre>package com.example.lovelayout;

import android.animation.Animator;
import android.animation.AnimatorListenerAdapter;
import android.animation.AnimatorSet;
import android.animation.ObjectAnimator;
import android.animation.TypeEvaluator;
import android.animation.ValueAnimator;
import android.content.Context;
import android.graphics.PointF;
import android.graphics.drawable.Drawable;
import android.util.AttributeSet;
import android.view.MotionEvent;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.RelativeLayout;

import java.util.Random;

import androidx.core.content.ContextCompat;

public class MyLoveLayout extends RelativeLayout {
    private int[] imgResId;
    private Random random;
    private int mWidth;
    private int mHeight;
    private int drawableWidth;
    private int drawableHeight;
    private PointF downPoint;//手指按下的点

    public MyLoveLayout(Context context) {
        this(context, null);
    }

    public MyLoveLayout(Context context, AttributeSet attrs) {
        this(context, attrs, 0);
    }

    public MyLoveLayout(Context context, AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        imgResId = new int[]{R.drawable.off, R.drawable.on};
        random = new Random();
        Drawable drawable = ContextCompat.getDrawable(context, R.drawable.on);
        drawableWidth = drawable.getIntrinsicWidth();
        drawableHeight = drawable.getIntrinsicHeight();
        downPoint=new PointF();
    }

    @Override
    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        super.onMeasure(widthMeasureSpec, heightMeasureSpec);
        mWidth = MeasureSpec.getSize(widthMeasureSpec);
        mHeight = MeasureSpec.getSize(heightMeasureSpec);
    }

    //添加图片
    private void addView() {
        ImageView loveImg = new ImageView(getContext());
        loveImg.setImageResource(imgResId[random.nextInt(imgResId.length)]);
        RelativeLayout.LayoutParams params = new RelativeLayout.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);
        loveImg.setLayoutParams(params);
        loveImg.setX(downPoint.x-drawableWidth/2);
        loveImg.setY(downPoint.y-drawableHeight/2);
        addView(loveImg);
        //开始动画
        startAni(loveImg);
    }

    private void startAni(ImageView loveImg) {
        //透明度、缩放动画
        ObjectAnimator alphaAni = ObjectAnimator.ofFloat(loveImg, "Alpha", 0f, 1f);
        ObjectAnimator scaleXAni = ObjectAnimator.ofFloat(loveImg, "ScaleX", 0.2f, 1f);
        alphaAni.setDuration(100);
        scaleXAni.setDuration(100);

        //贝塞尔路径动画
        ValueAnimator bizerAni = getBizerPathAni(loveImg);

        AnimatorSet aniSet = new AnimatorSet();
        aniSet.play(alphaAni).with(scaleXAni).before(bizerAni);
        aniSet.start();
    }

    private ValueAnimator getBizerPathAni(final ImageView loveImg) {
        //point0 point3 起始点和终点 point1 point2 控制点
        PointF point0 = new PointF(downPoint.x-drawableWidth/2, downPoint.y - drawableHeight/2);//左上角
        PointF point1 = new PointF(random.nextInt(mWidth - drawableWidth),random.nextInt((int) ((mHeight-downPoint.y) / 2)) +(mHeight-downPoint.y) / 2 );
        PointF point2 = new PointF(random.nextInt(mWidth - drawableWidth), random.nextInt((int) ((mHeight-downPoint.y) / 2)));
        PointF point3 = new PointF(random.nextInt(mWidth - drawableWidth), 0);

        final ValueAnimator bizerPathAni = ValueAnimator.ofObject(new MyEvalutator(point0, point3), point1, point2);
        bizerPathAni.setDuration(3000);
        bizerPathAni.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
            @Override
            public void onAnimationUpdate(ValueAnimator animation) {
                PointF bizerPoint = (PointF) animation.getAnimatedValue();
                //改变imageview的坐标
                loveImg.setX(bizerPoint.x);
                loveImg.setY(bizerPoint.y);
                float t = animation.getAnimatedFraction();
                //设置透明度，慢慢消失
                loveImg.setAlpha(1.3f - t);
            }
        });
        bizerPathAni.addListener(new AnimatorListenerAdapter() {
            @Override
            public void onAnimationEnd(Animator animation) {
                removeView(loveImg);
            }
        });
        return bizerPathAni;
    }

    private class MyEvalutator implements TypeEvaluator&lt;PointF&gt; {
        private PointF point0;//起点
        private PointF point3;//终点
        private PointF pointBizer;

        public MyEvalutator(PointF point0, PointF point3) {
            this.point0 = point0;
            this.point3 = point3;
            pointBizer = new PointF();
        }

        @Override
        public PointF evaluate(float t, PointF point1, PointF point2) {
            //三次贝塞尔曲线
            pointBizer.x = (float) (point0.x * Math.pow(1 - t, 3) + 3 * point1.x * t * Math.pow(1 - t, 2)
                    + 3 * point2.x * t * t * (1 - t) + point3.x * Math.pow(t, 3));

            pointBizer.y = (float) (point0.y * Math.pow(1 - t, 3) + 3 * point1.y * t * Math.pow(1 - t, 2)
                    + 3 * point2.y * t * t * (1 - t) + point3.y * Math.pow(t, 3));
            return pointBizer;
        }
    }

    @Override
    public boolean onTouchEvent(MotionEvent event) {
        switch (event.getAction()) {
            case MotionEvent.ACTION_DOWN:
                downPoint.x = event.getX();
                downPoint.y = event.getY();
                addView();
                break;
        }
        return super.onTouchEvent(event);
    }
}
</pre> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E7%A4%BA%E4%BE%8B%EF%BC%9A">        示例：</h4> 
<pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;com.example.lovelayout.MyLoveLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:id="@+id/loveLayout"
    tools:context=".MainActivity"&gt;


&lt;/com.example.lovelayout.MyLoveLayout&gt;</pre> 
<pre><code>package com.example.lovelayout;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.view.View;
import android.widget.Button;

public class MainActivity extends AppCompatActivity {
    MyLoveLayout loveLayout;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        loveLayout = (MyLoveLayout) findViewById(R.id.loveLayout);
    }
}
</code></pre> 
<h3 id="3%E3%80%81%E7%AC%AC%E4%B8%89%E7%89%88%E6%9C%AC%E4%BB%A3%E7%A0%81%EF%BC%88%E4%B8%BB%E8%A6%81%E6%98%AF%E5%A2%9E%E5%8A%A0%E4%BA%86ontouchlistener%EF%BC%89">3、第三版本代码（主要是增加了ontouchlistener）</h3> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E6%BA%90%E7%A0%81%EF%BC%9A">        源码：</h4> 
<pre><code>package com.example.lovelayout;

import android.animation.Animator;
import android.animation.AnimatorListenerAdapter;
import android.animation.AnimatorSet;
import android.animation.ObjectAnimator;
import android.animation.TypeEvaluator;
import android.animation.ValueAnimator;
import android.content.Context;
import android.content.res.Resources;
import android.graphics.PointF;
import android.graphics.drawable.Drawable;
import android.util.AttributeSet;
import android.util.Log;
import android.util.TypedValue;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.RelativeLayout;

import java.util.Random;

import androidx.core.content.ContextCompat;

public class MyLoveLayout extends RelativeLayout {
    private static final String TAG="MyLoveLayout";
    private int[] imgResId;
    private Random random;
    private int mWidth;
    private int mHeight;
    private int drawableWidth;
    private int drawableHeight;
    private PointF downPoint;//手指按下的点

    public MyLoveLayout(Context context) {
        this(context, null);
    }

    public MyLoveLayout(Context context, AttributeSet attrs) {
        this(context, attrs, 0);
    }

    public MyLoveLayout(Context context, AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        imgResId = new int[]{R.drawable.off, R.drawable.on};
        random = new Random();
        Drawable drawable = ContextCompat.getDrawable(context, R.drawable.on);
        drawableWidth = drawable.getIntrinsicWidth();
        drawableHeight = drawable.getIntrinsicHeight();
        downPoint=new PointF();
    }

    @Override
    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        super.onMeasure(widthMeasureSpec, heightMeasureSpec);
        mWidth = MeasureSpec.getSize(widthMeasureSpec);
        mHeight = MeasureSpec.getSize(heightMeasureSpec);
    }

    //添加图片
    private void addView() {
        ImageView loveImg = new ImageView(getContext());
        loveImg.setImageResource(imgResId[random.nextInt(imgResId.length)]);
        RelativeLayout.LayoutParams params = new RelativeLayout.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);
        loveImg.setLayoutParams(params);
        loveImg.setX(downPoint.x-drawableWidth/2);
        loveImg.setY(downPoint.y-drawableHeight/2);
        addView(loveImg);
        //开始动画
        startAni(loveImg);
    }

    private void startAni(ImageView loveImg) {
        //透明度、缩放动画
        ObjectAnimator alphaAni = ObjectAnimator.ofFloat(loveImg, "Alpha", 0f, 1f);
        ObjectAnimator scaleXAni = ObjectAnimator.ofFloat(loveImg, "ScaleX", 0.2f, 1f);
        alphaAni.setDuration(100);
        scaleXAni.setDuration(100);

        //贝塞尔路径动画
        ValueAnimator bizerAni = getBizerPathAni(loveImg);

        AnimatorSet aniSet = new AnimatorSet();
        aniSet.play(alphaAni).with(scaleXAni).before(bizerAni);
        aniSet.start();
    }

    private ValueAnimator getBizerPathAni(final ImageView loveImg) {
        //point0 point3 起始点和终点 point1 point2 控制点
        PointF point0 = new PointF(downPoint.x-drawableWidth/2, downPoint.y - drawableHeight/2);//左上角
        PointF point1 = new PointF(random.nextInt(mWidth - drawableWidth),random.nextInt((int) ((mHeight-downPoint.y) / 2)) +(mHeight-downPoint.y) / 2 );
        PointF point2 = new PointF(random.nextInt(mWidth - drawableWidth), random.nextInt((int) ((mHeight-downPoint.y) / 2)));
        PointF point3 = new PointF(random.nextInt(mWidth - drawableWidth), 0);

        final ValueAnimator bizerPathAni = ValueAnimator.ofObject(new MyEvalutator(point0, point3), point1, point2);
        bizerPathAni.setDuration(3000);
        bizerPathAni.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
            @Override
            public void onAnimationUpdate(ValueAnimator animation) {
                PointF bizerPoint = (PointF) animation.getAnimatedValue();
                //改变imageview的坐标
                loveImg.setX(bizerPoint.x);
                loveImg.setY(bizerPoint.y);
                float t = animation.getAnimatedFraction();
                //设置透明度，慢慢消失
                loveImg.setAlpha(1.3f - t);
            }
        });
        bizerPathAni.addListener(new AnimatorListenerAdapter() {
            @Override
            public void onAnimationEnd(Animator animation) {
                removeView(loveImg);
            }
        });
        return bizerPathAni;
    }

    private class MyEvalutator implements TypeEvaluator&lt;PointF&gt; {
        private PointF point0;//起点
        private PointF point3;//终点
        private PointF pointBizer;

        public MyEvalutator(PointF point0, PointF point3) {
            this.point0 = point0;
            this.point3 = point3;
            pointBizer = new PointF();
        }

        @Override
        public PointF evaluate(float t, PointF point1, PointF point2) {
            //三次贝塞尔曲线
            pointBizer.x = (float) (point0.x * Math.pow(1 - t, 3) + 3 * point1.x * t * Math.pow(1 - t, 2)
                    + 3 * point2.x * t * t * (1 - t) + point3.x * Math.pow(t, 3));

            pointBizer.y = (float) (point0.y * Math.pow(1 - t, 3) + 3 * point1.y * t * Math.pow(1 - t, 2)
                    + 3 * point2.y * t * t * (1 - t) + point3.y * Math.pow(t, 3));
            return pointBizer;
        }
    }

    @Override
    public boolean onTouchEvent(MotionEvent event) {
//        switch (event.getAction()) {
//            case MotionEvent.ACTION_DOWN:
//                downPoint.x = event.getX();
//                downPoint.y = event.getY();
//                addView();
//                break;
//        }
        return super.onTouchEvent(event);
    }

    //增加view的触摸监听事件
    public void attachView(View view) {
        view.setOnTouchListener(new OnTouchListener() {
            @Override
            public boolean onTouch(View v, MotionEvent event) {
                switch (event.getAction()) {
                    case MotionEvent.ACTION_DOWN:
                        downPoint.x = event.getRawX();
                        //这里要减去状态栏的高度，否则高度不对，如果有ActionBar,这里也要记得减掉
                        downPoint.y = event.getRawY()-getStatusBarHeight();
                        addView();
                        break;
                }
                return true;
            }
        });
    }

    //获取状态栏高度
    private int getStatusBarHeight() {
        int height=0;
        Resources resources=getContext().getResources();
        int resId = resources.getIdentifier("status_bar_height", "dimen", "android");
        if (resId &gt; 0) {
            height = resources.getDimensionPixelOffset(resId);
        }
        height=(int) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,height,resources.getDisplayMetrics());
        return height;
    }
}
</code></pre> 
<h4>        示例：</h4> 
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;com.example.lovelayout.MyLoveLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:id="@+id/loveLayout"
    tools:context=".MainActivity"&gt;

    &lt;ImageView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_alignParentRight="true"
        android:layout_marginTop="500dp"
        android:background="@drawable/on"
        android:id="@+id/img" /&gt;

    &lt;Button
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:id="@+id/button"
        android:layout_centerInParent="true"
        android:text="点我" /&gt;

&lt;/com.example.lovelayout.MyLoveLayout&gt;</code></pre> 
<pre><code>package com.example.lovelayout;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;

public class MainActivity extends AppCompatActivity {
    MyLoveLayout loveLayout;
    ImageView img;
    Button button;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        loveLayout = (MyLoveLayout) findViewById(R.id.loveLayout);
        img = (ImageView) findViewById(R.id.img);
        button = (Button) findViewById(R.id.button);
        loveLayout.attachView(button);
        loveLayout.attachView(img);

    }
}
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/878f9a450ef696418b8ad7bf11b5fb2e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Latext参考文献引用顺序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/23296ae5a9f94eee72b96b9a21ba645c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MYSQL使用的索引不合适，指定索引</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>