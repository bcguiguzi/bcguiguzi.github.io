<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Windows/Linux环境下安装并使用Libreoffice(SpingBoot 整合Libreoffice)&amp;Linux字体库新增字体 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Windows/Linux环境下安装并使用Libreoffice(SpingBoot 整合Libreoffice)&amp;Linux字体库新增字体" />
<meta property="og:description" content="现有功能需求需将word模板转成pdf的方式，进行在线预览或打印，实现这个需求有几种当时，如下：
1、使用jacob：word模板需要创建书签，以替换书签的方式来填充数据。然后转成pdf的格式。使用简单方便，但是只能在windows环境下使用，不能在linux环境使用
2、使用aspose.words：通过创建word模板的一个域的标识，来替换相应的数据，具体百度，也是使用特别方便的一个组件，基本上手就能用，能在windows和Linux下使用，可惜是商用的，项目需要发布上线的话还是先获取版权的好，个人使用的话倒是没所谓。
3、使用POI：word模板需要创建特殊的标识，如：{name}，来标识需要替换的数据位置，操作word文档简单，可在windows和Linux下使用，但是使用POI将word转成pdf时，会出现pdf与word模板格式不一致的问题，格式会错乱。
综上考虑实现word转pdf，并能在Linux环境下使用，采用POI&#43;Libreoffice的方式实现，其中POI实现替换word模板中特殊标识去替换数据，使用Libreoffice是将替换好的word文档转成pdf，转成的pdf格式和word模板的一致。
文末附上实现的代码案例，使用Libreoffice需先本机安装
windows环境下安装Libreoffice 准备好安装包，双击安装 安装好的目录如下：program
安装完后需要编写一个 Libreoffice的启动脚本 Libreoffice的启动脚本命名为：startLibreOffice.bat
脚本位置随意，调用的时候需要用到，配置文件写明位置即可
编辑脚本如下：其中E:\Install\program\soffice.exe为我的Libreoffice安装路径文件启动位置，个人安装目录不同自行修改
taskkill /f /fi &#34;IMAGENAME eq soffice.exe&#34; taskkill /f /fi &#34;IMAGENAME eq soffice.bin&#34; ping -n 5 127.0.0.1 E:\grFile\Install\program\soffice.exe -headless -nologo -nofirststartwizard -accept=&#34;socket,host=127.0.0.1,port=8100;urp;&#34; echo &#34;start complete&#34; exit 到此，windows环境下Libreoffice安装完毕
遇到个问题，多次试验，安装的文件名尽量不要使用中文以及含空格的文件名
linux环境下安装Libreoffice 准备好Linux版本的安装包，上传到linux服务器上 将Libreoffice的安装包上传到 /opt 目录下
打指令
1.	cd /opt 2.	tar -zxvf LibreOffice_5.3.6_Linux_x86-64_rpm.tar.gz 解压到当前路径 3.	sudo yum install ./LibreOffice_5.3.6_Linux_x86-64_rpm/RPMS/*.rpm 安装 4.	cd /opt/libreoffice5.3/program,这里就是程序目录了 开始调试是否安装完成，运行以下指令
/opt/libreoffice5.3/program/soffice.bin -headless --nologo --nofirststartwizard --accept=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/202c1a5a7aa6303cf59fa3a96cd0c66a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-19T17:27:21+08:00" />
<meta property="article:modified_time" content="2021-03-19T17:27:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Windows/Linux环境下安装并使用Libreoffice(SpingBoot 整合Libreoffice)&amp;Linux字体库新增字体</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>现有功能需求需将word模板转成pdf的方式，进行在线预览或打印，实现这个需求有几种当时，如下：<br> 1、使用jacob：word模板需要创建书签，以替换书签的方式来填充数据。然后转成pdf的格式。使用简单方便，但是只能在windows环境下使用，不能在linux环境使用<br> 2、使用aspose.words：通过创建word模板的一个域的标识，来替换相应的数据，具体百度，也是使用特别方便的一个组件，基本上手就能用，能在windows和Linux下使用，可惜是商用的，项目需要发布上线的话还是先获取版权的好，个人使用的话倒是没所谓。<br> 3、使用POI：word模板需要创建特殊的标识，如：{name}，来标识需要替换的数据位置，操作word文档简单，可在windows和Linux下使用，但是使用POI将word转成pdf时，会出现pdf与word模板格式不一致的问题，格式会错乱。</p> 
</blockquote> 
<blockquote> 
 <p>综上考虑实现word转pdf，并能在Linux环境下使用，采用POI+Libreoffice的方式实现，其中POI实现替换word模板中特殊标识去替换数据，使用Libreoffice是将替换好的word文档转成pdf，转成的pdf格式和word模板的一致。</p> 
</blockquote> 
<blockquote> 
 <p>文末附上实现的代码案例，使用Libreoffice需先本机安装</p> 
</blockquote> 
<h2><a id="windowsLibreoffice_8"></a>windows环境下安装Libreoffice</h2> 
<h3><a id="_9"></a>准备好安装包，双击安装</h3> 
<p><img src="https://images2.imgbox.com/5f/9f/eHlsDCCE_o.png" alt="在这里插入图片描述"><br> 安装好的目录如下：program<br> <img src="https://images2.imgbox.com/f4/29/wpMpfqH6_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_Libreoffice_13"></a>安装完后需要编写一个 Libreoffice的启动脚本</h3> 
<blockquote> 
 <p>Libreoffice的启动脚本命名为：startLibreOffice.bat<br> 脚本位置随意，调用的时候需要用到，配置文件写明位置即可<br> 编辑脚本如下：其中E:\Install\program\soffice.exe为我的Libreoffice安装路径文件启动位置，个人安装目录不同自行修改</p> 
</blockquote> 
<pre><code class="prism language-java">taskkill <span class="token operator">/</span>f <span class="token operator">/</span>fi <span class="token string">"IMAGENAME eq soffice.exe"</span>
taskkill <span class="token operator">/</span>f <span class="token operator">/</span>fi <span class="token string">"IMAGENAME eq soffice.bin"</span>
ping <span class="token operator">-</span>n <span class="token number">5</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
E<span class="token operator">:</span>\grFile\Install\program\soffice<span class="token punctuation">.</span>exe <span class="token operator">-</span>headless <span class="token operator">-</span>nologo <span class="token operator">-</span>nofirststartwizard <span class="token operator">-</span>accept<span class="token operator">=</span><span class="token string">"socket,host=127.0.0.1,port=8100;urp;"</span>
echo <span class="token string">"start complete"</span>
exit
</code></pre> 
<blockquote> 
 <p>到此，windows环境下Libreoffice安装完毕<br> 遇到个问题，多次试验，安装的文件名尽量不要使用中文以及含空格的文件名</p> 
</blockquote> 
<h2><a id="linuxLibreoffice_29"></a>linux环境下安装Libreoffice</h2> 
<h3><a id="Linuxlinux_30"></a>准备好Linux版本的安装包，上传到linux服务器上</h3> 
<p><img src="https://images2.imgbox.com/88/54/JDtsJHmK_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>将Libreoffice的安装包上传到 /opt 目录下<br> 打指令</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token number">1.</span>	cd <span class="token operator">/</span>opt
<span class="token number">2.</span>	tar <span class="token operator">-</span>zxvf LibreOffice_5<span class="token punctuation">.</span><span class="token number">3.6</span>_Linux_x86<span class="token operator">-</span><span class="token number">64</span>_rpm<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz  解压到当前路径
<span class="token number">3.</span>	sudo yum install <span class="token punctuation">.</span>/LibreOffice_5<span class="token punctuation">.</span><span class="token number">3.6</span>_Linux_x86<span class="token operator">-</span><span class="token number">64</span>_rpm<span class="token operator">/</span>RPMS<span class="token comment">/*.rpm 安装
4.	cd /opt/libreoffice5.3/program,这里就是程序目录了
</span></code></pre> 
<blockquote> 
 <p>开始调试是否安装完成，运行以下指令</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token operator">/</span>opt<span class="token operator">/</span>libreoffice5<span class="token punctuation">.</span><span class="token number">3</span><span class="token operator">/</span>program<span class="token operator">/</span>soffice<span class="token punctuation">.</span>bin <span class="token operator">-</span>headless <span class="token operator">--</span>nologo <span class="token operator">--</span>nofirststartwizard <span class="token operator">--</span>accept<span class="token operator">=</span><span class="token string">"socket,host=127.0.0.1,port=8100;urp;"</span>
</code></pre> 
<pre><code class="prism language-java">运行上述命令<span class="token punctuation">,</span>报错一个解决一个<span class="token punctuation">,</span>直到成功为止
<span class="token number">1.</span>	执行sudo updatedb命令<span class="token punctuation">,</span>如果没有这个命令<span class="token punctuation">,</span>就需要先安装<span class="token punctuation">,</span> yum install mlocate
<span class="token number">2.</span>	报错找不到libcairo<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">2</span><span class="token operator">:</span> yum install cairo<span class="token operator">-</span>devel
<span class="token number">3.</span>	报错找不到libcups<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">2</span><span class="token operator">:</span> yum install libXinerama cups<span class="token operator">-</span>libs
<span class="token number">4.</span>	报错找不到libGL<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">:</span> yum install libGL
<span class="token number">5.</span>	报错找不到libSM<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span><span class="token operator">:</span> yum install libSM
<span class="token number">6.</span>	如果需要删除<span class="token punctuation">,</span>则yum remove libcairo<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">2</span>
可能有缺包情况<span class="token operator">:</span>lib<span class="token operator">*</span><span class="token punctuation">.</span>so<span class="token punctuation">.</span>*<span class="token punctuation">,</span>则直接yum install即可
记住要刷新缓存<span class="token operator">:</span>sudo updatedb
如果不能用<span class="token punctuation">,</span>就得安装下<span class="token operator">:</span> yum install mlocate
</code></pre> 
<blockquote> 
 <p>调试完成后，将Libreoffice放在后台运行，输入指令</p> 
</blockquote> 
<pre><code class="prism language-java">nohup <span class="token operator">/</span>opt<span class="token operator">/</span>libreoffice5<span class="token punctuation">.</span><span class="token number">3</span><span class="token operator">/</span>program<span class="token operator">/</span>soffice<span class="token punctuation">.</span>bin <span class="token operator">-</span>headless <span class="token operator">--</span>nologo <span class="token operator">--</span>nofirststartwizard <span class="token operator">--</span>accept<span class="token operator">=</span><span class="token string">"socket,host=127.0.0.1,port=8100;urp;"</span> <span class="token operator">&amp;</span>
</code></pre> 
<blockquote> 
 <p>运行后，查看是否运行，输入指令</p> 
</blockquote> 
<pre><code class="prism language-java">ps aux <span class="token operator">|</span> grep soffice
或者
netstat <span class="token operator">-</span>tnlp检查是否启动成功。
如果需要关闭<span class="token punctuation">,</span>则记下第二列的编码<span class="token punctuation">,</span>运行 kill <span class="token operator">-</span><span class="token number">9</span> 编码
</code></pre> 
<blockquote> 
 <p>到此，Linux环境下Libreoffice安装完毕<br> Linux环境下不需要写启动脚本，直接后台运行，挂掉了参考上面指令后台启动<br> 遇到个问题，多次试验，word转成pdf后，pdf的所有中文内容出现正方形的小框框。这个是因为Linux系统的字体库没有对应字体，需要另外新建字体库</p> 
</blockquote> 
<h3><a id="Linux_81"></a>Linux字体库新增字体</h3> 
<blockquote> 
 <p>可以将windows系统下的字体直接复制粘贴上传到Linux系统下<br> windows系统下的字体位置：C:\Windows\Fonts<br> 输入指令步骤如下：</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token number">1.</span>	yum <span class="token operator">-</span>y install fontconfig
<span class="token number">2.</span>	cd <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token punctuation">,</span>如果有fontconfig和fonts<span class="token punctuation">,</span>则说明安装成功
<span class="token number">3.</span>	打开这个fonts文件夹下<span class="token punctuation">,</span>新建一个叫chinese文件夹
<span class="token number">4.</span>	然后将准备好的字体文件全部拷进去（windows系统的可以）
<span class="token number">5.</span>	chmod <span class="token operator">-</span>R <span class="token number">755</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>fonts<span class="token operator">/</span>chinese<span class="token punctuation">,</span>给予该文件夹权限
<span class="token number">6.</span>	yum <span class="token operator">-</span>y install ttmkfdir
<span class="token number">7.</span>	ttmkfdir <span class="token operator">-</span>e <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>X11<span class="token operator">/</span>fonts<span class="token operator">/</span>encodings<span class="token operator">/</span>encodings<span class="token punctuation">.</span>dir
<span class="token number">8.</span>	vi <span class="token operator">/</span>etc<span class="token operator">/</span>fonts<span class="token operator">/</span>fonts<span class="token punctuation">.</span>conf<span class="token punctuation">,</span>进入这个配置文件<span class="token punctuation">,</span>
<span class="token number">9.</span>	在Font directory list配置项下<span class="token punctuation">,</span>添加<span class="token generics function"><span class="token punctuation">&lt;</span>dir<span class="token punctuation">&gt;</span></span><span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>fonts<span class="token operator">/</span>chinese<span class="token operator">&lt;</span><span class="token operator">/</span>dir<span class="token operator">&gt;</span>
<span class="token number">10.</span>	退出后执行<span class="token punctuation">[</span>fc<span class="token operator">-</span>cache<span class="token punctuation">]</span>刷新缓存
<span class="token number">11.</span>	此时重启下libreOffice比较保险
</code></pre> 
<blockquote> 
 <p>至此，Linux字体库新增字体完成</p> 
</blockquote> 
<h2><a id="_102"></a>环境安装完成，实现功能</h2> 
<h3><a id="maven_103"></a>maven导入依赖</h3> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 连接libreOffice驱动包 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
	<span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>artofsolving<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
	<span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>jodconverter<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
	<span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.2</span><span class="token number">.2</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
<span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
	<span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>openoffice<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
	<span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>bootstrap<span class="token operator">-</span>connector<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
	<span class="token generics function"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">0.1</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="applicationproperties_118"></a>application.properties配置信息</h3> 
<blockquote> 
 <p>windows环境下的配置信息<br> libreOffice5Bat为libreoffice的启动脚本位置，详情查看安装时的准备</p> 
</blockquote> 
<pre><code class="prism language-java">#libreOffice5
libreOffice5Bat<span class="token operator">=</span>E\<span class="token operator">:</span><span class="token operator">/</span>libreoffice<span class="token operator">/</span>startLibreOffice<span class="token punctuation">.</span>bat
libreOfficeTempPath<span class="token operator">=</span>E\<span class="token operator">:</span><span class="token operator">/</span>temp<span class="token operator">/</span>
libreOfficeUrl<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
libreOfficePort<span class="token operator">=</span><span class="token number">8100</span>
</code></pre> 
<blockquote> 
 <p>Linux环境下的配置信息</p> 
</blockquote> 
<pre><code class="prism language-java">#libreOffice5
libreOfficeTempPath<span class="token operator">=</span><span class="token operator">/</span>apps<span class="token operator">/</span>tmp<span class="token operator">/</span>
libreOfficeUrl<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
libreOfficePort<span class="token operator">=</span><span class="token number">8100</span>
</code></pre> 
<h3><a id="_137"></a>实现功能的工具类</h3> 
<h4><a id="word_138"></a>对word模板的操作类</h4> 
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>OutputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>xwpf<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span>XWPFDocument<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>xwpf<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span>XWPFParagraph<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>xwpf<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span>XWPFRun<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>xwpf<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span>XWPFTable<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>xwpf<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span>XWPFTableCell<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>xwpf<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span>XWPFTableRow<span class="token punctuation">;</span>

<span class="token comment">/**
 * 对word模板的操作，包含替换文本和列表向下扩展两种&lt;br&gt;
 * 本工具类的使用需要配合ExportWord.class，具体Demo看ExportWord类即可
 * @author 
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WordOperator</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/**
	 * 模板替换标签开头
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> String LABEL_STR <span class="token operator">=</span> <span class="token string">"{"</span><span class="token punctuation">;</span>
	<span class="token comment">/**
	 * 模板替换标签结尾
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> String LABEL_END <span class="token operator">=</span> <span class="token string">"}"</span><span class="token punctuation">;</span>
	<span class="token comment">/**
	 * 加载word对象
	 */</span>
	<span class="token keyword">private</span> XWPFDocument doc<span class="token punctuation">;</span>
	
	<span class="token comment">/**
	 * 构造方法，把模板文档加载进来&lt;br&gt;
	 * 		因为微软只提供XWPFRun对象替换文本，而它在切割段落文本的时候却是非常没有规律的，故而本方法要求模板必须遵循一定的规范来编写：&lt;br&gt;
	 * 		１．模板里除了标签外，其余地方禁止使用"{"和"}"字符串；&lt;br&gt;
	 * 		２．不允许出现"{}"这种写法，即标签必须包含key；
	 */</span>
	<span class="token keyword">public</span> <span class="token function">WordOperator</span><span class="token punctuation">(</span>InputStream is<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XWPFDocument</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 要替换标签的KV对
	 */</span>
	<span class="token keyword">private</span> Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> replaceMap<span class="token punctuation">;</span>
	
	<span class="token comment">/**
	 * 在word模板文档里，用{key}标签来表示要替换的内容，把key对应的value存储于replaceMap里，即可完成替换
	 */</span>
	<span class="token keyword">public</span> WordOperator <span class="token function">replaceText</span><span class="token punctuation">(</span>Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>replaceMap <span class="token operator">=</span> result<span class="token punctuation">;</span>
		<span class="token comment">// 替换文本内容的标签</span>
		List<span class="token generics function"><span class="token punctuation">&lt;</span>XWPFParagraph<span class="token punctuation">&gt;</span></span> paragraphList <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getParagraphs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">replaceText</span><span class="token punctuation">(</span>paragraphList<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 替换表格内部标签</span>
		List<span class="token generics function"><span class="token punctuation">&lt;</span>XWPFTable<span class="token punctuation">&gt;</span></span> tableList <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getTables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>XWPFTable table <span class="token operator">:</span> tableList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> table<span class="token punctuation">.</span><span class="token function">getNumberOfRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				XWPFTableRow row <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				List<span class="token generics function"><span class="token punctuation">&lt;</span>XWPFTableCell<span class="token punctuation">&gt;</span></span> tableCellList <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">getTableCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span>XWPFTableCell cell <span class="token operator">:</span> tableCellList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">replaceText</span><span class="token punctuation">(</span>cell<span class="token punctuation">.</span><span class="token function">getParagraphs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 把替换段落抽取出一个方法，在替换文本和替换表格里都可以调用
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">replaceText</span><span class="token punctuation">(</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>XWPFParagraph<span class="token punctuation">&gt;</span></span> paragraphList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> labelLen <span class="token operator">=</span> LABEL_STR<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 取出word模板里的全部段落，遍历</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paragraphList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			XWPFParagraph paragraph <span class="token operator">=</span> paragraphList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 拿出每一个段落，判断内容里是否包含字符串"{"和"}"，只有两者同时存在了才执行替换标签的逻辑</span>
			String paragraphText <span class="token operator">=</span> paragraph<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>paragraphText<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> paragraphText<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>LABEL_STR<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> paragraphText<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>LABEL_END<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 每一个段落分很多小段文本，官方API只能否通过XWPFRun对象执行替换文本功能</span>
				List<span class="token generics function"><span class="token punctuation">&lt;</span>XWPFRun<span class="token punctuation">&gt;</span></span> runList <span class="token operator">=</span> paragraph<span class="token punctuation">.</span><span class="token function">getRuns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 组装replaceMap的key</span>
				String key <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
				<span class="token comment">// 是否检测到有"{"字符串，有为true，没有为false</span>
				<span class="token keyword">boolean</span> include <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> runList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					XWPFRun run <span class="token operator">=</span> runList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
					String text <span class="token operator">=</span> run<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">//有些模板不太规范，可能存在大量空格无法识别，内容为null,空指针异常，跳过即可</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">continue</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 取出每一个小段里标签头和尾的角标</span>
					<span class="token keyword">int</span> labelStrIndex <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>LABEL_STR<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> labelEndIndex <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>LABEL_END<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 只有{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>labelStrIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> labelEndIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">// 例如有"aaa{bbb"，则aaa不动，{bbb去掉，同时把bbb累加到key里</span>
						String textBefore <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> labelStrIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
						String textAfter <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>labelStrIndex <span class="token operator">+</span> labelLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
						run<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>textBefore<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						key <span class="token operator">+=</span> textAfter<span class="token punctuation">;</span>
						include <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						<span class="token comment">// 只有}</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>labelStrIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> labelEndIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">// 例如有"aaa}bbb"，则aaa}去掉，bbb不动，同时把aaa累加到key里</span>
						String textBefore <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> labelEndIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
						String textAfter <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>labelEndIndex <span class="token operator">+</span> labelLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
						key <span class="token operator">+=</span> textBefore<span class="token punctuation">;</span>
						System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
						Object value <span class="token operator">=</span> replaceMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
						System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							value <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						key <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
						run<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>value <span class="token operator">+</span> textAfter<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						include <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
						<span class="token comment">// 两个都没有</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>labelStrIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> labelEndIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">// 例如有"aaa"，如果之前有{了，则把内容累加到key里，同时去掉内容；如果没有{，则说明是普通文本，跳过不管</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>include<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							key <span class="token operator">+=</span> text<span class="token punctuation">;</span>
							run<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// 两个都存在，这种情况比较复杂。经过多次试验，XWPFRun切割内容，只会同时各出现1次而已</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">// {在前，}在后</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>labelStrIndex <span class="token operator">&lt;</span> labelEndIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							<span class="token comment">// 例如有"aaa{bbb}ccc"，则aaa不动，{bbb}去掉同时进行替换，ccc保留（因为有规范，所以这是一个独立完整的标签，且bbb绝对有值）</span>
							String textBefore <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> labelStrIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
							String textMiddle <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>labelStrIndex <span class="token operator">+</span> labelLen<span class="token punctuation">,</span> labelEndIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
							String textAfter <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>labelEndIndex <span class="token operator">+</span> labelLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
							Object value <span class="token operator">=</span> replaceMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>textMiddle<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
								value <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
							run<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>textBefore <span class="token operator">+</span> value <span class="token operator">+</span> textAfter<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							key <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
							include <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
							<span class="token comment">// }在前，{在后</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
							<span class="token comment">// 例如有"aaa}bbb{ccc"，则aaa}去掉，且进行替换；bbb不动，{ccc去掉，累加到key里去</span>
							String textBefore <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> labelEndIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
							String textMiddle <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>labelEndIndex <span class="token operator">+</span> labelLen<span class="token punctuation">,</span> labelStrIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
							String textAfter <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>labelStrIndex <span class="token operator">+</span> labelLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
							key <span class="token operator">+=</span> textBefore<span class="token punctuation">;</span>
							Object value <span class="token operator">=</span> replaceMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
								value <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
							run<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>value <span class="token operator">+</span> textMiddle<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							key <span class="token operator">=</span> textAfter<span class="token punctuation">;</span>
							include <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 表格向下扩展数据行，因为POI对word格式支持较差，故我们做一些约定&lt;br&gt;
	 * 	１．约定表格要有一行模板行，用于扩展数据行的样式效仿；&lt;br&gt;
	 * 	２．模板表格里最好不要有合并行，如非常需要，则可以用隐藏单元格或设置白色边框的方式巧妙替代合并行；&lt;br&gt;
	 * 	３．模板行下方不允许出现其他行&lt;br&gt;
	 * @param tableIndex	表格角标，第1个表为0
	 * @param tempRow		模板行角标，第2行为1（模板行不是标题行，而是扩展数据行样式的效仿对象）
	 * @param isDelTempRow	true-删除模板行；false-不删除模板行
	 * @param rowlist		要插入的数据集合，格式为［行集合&lt;列集合&gt;，列集合的长度最好与模板行长度一致］
	 */</span>
	<span class="token keyword">public</span> WordOperator <span class="token function">insert2Table</span><span class="token punctuation">(</span><span class="token keyword">int</span> tableIndex<span class="token punctuation">,</span> <span class="token keyword">int</span> tmpRowIndex<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isDelTmpRow<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> rowlist<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 因为需要对rowlist进行添加操作，故而我们重新做一个变量，防止因为改变而产生问题</span>
		List<span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> dataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>rowlist<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 根据角标取出表格对像</span>
		XWPFTable table <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getTables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>tableIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 再根据行号获取模板行</span>
		XWPFTableRow tmpRow <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span>tmpRowIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 不知道是什么原因，最后一列数据会跑到模板行上一行，故而这里在最末添加一组数据，解决这个bug</span>
		dataList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 遍历数据集合</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> dataList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dataList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 计算数据行编号</span>
			<span class="token keyword">int</span> dataIndex <span class="token operator">=</span> tmpRowIndex <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
			<span class="token comment">// 按照模板行样式添加一行到数据行</span>
			table<span class="token punctuation">.</span><span class="token function">addRow</span><span class="token punctuation">(</span>tmpRow<span class="token punctuation">,</span> dataIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 取出这一行</span>
				XWPFTableRow row <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">getRow</span><span class="token punctuation">(</span>dataIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 取出这一行全部单元格</span>
				List<span class="token generics function"><span class="token punctuation">&lt;</span>XWPFTableCell<span class="token punctuation">&gt;</span></span> cellList <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">getTableCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 取出这一行对应的数据，数据与单元格角标位置是一致的，一一替换文本</span>
				List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> colList <span class="token operator">=</span> dataList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> cellList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">setCellText</span><span class="token punctuation">(</span>cellList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span> colList<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 删掉那一行为了bug而添加的空白行（因为空白行跑到模板行上一行，所以tmpRowIndex为该行角标）</span>
		table<span class="token punctuation">.</span><span class="token function">removeRow</span><span class="token punctuation">(</span>tmpRowIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 删除模版行（因为上面已经删除了空白行了，所以tmpRowIndex就变成了下一行模板行了）</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>isDelTmpRow<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			table<span class="token punctuation">.</span><span class="token function">removeRow</span><span class="token punctuation">(</span>tmpRowIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 替换单元格文本
	 * @param cell		单元格
	 * @param colList	替换文本的集合（角标越位了，就置空）
	 * @param j			单元格角标，也就是文本集合的角标
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">setCellText</span><span class="token punctuation">(</span>XWPFTableCell cell<span class="token punctuation">,</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> colList<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//　无论一个单元格被切割成多少个run，只需要修改第一个即可，改完就return掉了</span>
		List<span class="token generics function"><span class="token punctuation">&lt;</span>XWPFParagraph<span class="token punctuation">&gt;</span></span> paragraphs <span class="token operator">=</span> cell<span class="token punctuation">.</span><span class="token function">getParagraphs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>XWPFParagraph p <span class="token operator">:</span> paragraphs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			List<span class="token generics function"><span class="token punctuation">&lt;</span>XWPFRun<span class="token punctuation">&gt;</span></span> runs <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">getRuns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>XWPFRun r <span class="token operator">:</span> runs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
					r<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>colList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					r<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 给定输出流即可将word文档导出到
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span>OutputStream os<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		doc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>os<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="wordPOI_383"></a>导出word工具类（基于POI）</h4> 
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileInputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileOutputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>OutputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>UUID<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>ServletOutputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletRequest<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletResponse<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOUtils<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>openxml4j<span class="token punctuation">.</span>opc<span class="token punctuation">.</span>OPCPackage<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>xwpf<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span>XWPFDocument<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xmlbeans<span class="token punctuation">.</span>XmlOptions<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>openxmlformats<span class="token punctuation">.</span>schemas<span class="token punctuation">.</span>wordprocessingml<span class="token punctuation">.</span>x2006<span class="token punctuation">.</span>main<span class="token punctuation">.</span>CTBody<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>ClassPathResource<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMapping<span class="token punctuation">;</span>

<span class="token comment">/**
 * 导出word工具类（基于POI）
 * @author 
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExportWord</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">/**
	 * 举个例子
	 */</span>
	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"demo"</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 替换标签{aa}和{bb}</span>
			Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"aa"</span><span class="token punctuation">,</span> <span class="token string">"替换aa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bb"</span><span class="token punctuation">,</span> <span class="token string">"替换bb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 列表4列，从左向右装填数据，然后向下扩展两行数据行</span>
			List<span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> rwoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> l1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			l1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"a1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			l1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"b1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			l1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"c1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			l1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"d1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			rwoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>l1<span class="token punctuation">)</span><span class="token punctuation">;</span>
			List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> l2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			l2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"a2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			l2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"b2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			l2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"c2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			l2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"d2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			rwoList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>l2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 加载第1个模板，执行替换标签、给第1个表格扩展数据（第二行为模板行，扩展后删除模板行）</span>
			WordOperator wo <span class="token operator">=</span> ExportWord<span class="token punctuation">.</span><span class="token function">getWordOperator</span><span class="token punctuation">(</span><span class="token string">"demo/demo.docx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			wo<span class="token punctuation">.</span><span class="token function">replaceText</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert2Table</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> rwoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 加载第2个模板，执行第2个表格扩展数据（第二行为模板行，扩展后仍然保留模板行）</span>
			WordOperator wo2 <span class="token operator">=</span> ExportWord<span class="token punctuation">.</span><span class="token function">getWordOperator</span><span class="token punctuation">(</span><span class="token string">"demo/demo2.docx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			wo2<span class="token punctuation">.</span><span class="token function">insert2Table</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> rwoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 以下6个方法，任选1个调用：</span>
			<span class="token comment">// --&gt; 下载word</span>
			ExportWord<span class="token punctuation">.</span><span class="token function">download_word</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">"导出文件"</span><span class="token punctuation">,</span> wo<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// --&gt; 下载word（多个模板合并）</span>
			ExportWord<span class="token punctuation">.</span><span class="token function">download_word</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">"导出文件"</span><span class="token punctuation">,</span> wo<span class="token punctuation">,</span> wo2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// --&gt; 下载pdf</span>
			ExportWord<span class="token punctuation">.</span><span class="token function">download_pdf</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">"导出文件"</span><span class="token punctuation">,</span> wo<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// --&gt; 下载pdf（多个模板合并）</span>
			ExportWord<span class="token punctuation">.</span><span class="token function">download_pdf</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">"导出文件"</span><span class="token punctuation">,</span> wo<span class="token punctuation">,</span> wo2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// --&gt; 预览pdf</span>
			ExportWord<span class="token punctuation">.</span><span class="token function">preview_pdf</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">"导出文件"</span><span class="token punctuation">,</span> wo<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// --&gt; 预览pdf（多个模板合并）</span>
			ExportWord<span class="token punctuation">.</span><span class="token function">preview_pdf</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">"导出文件"</span><span class="token punctuation">,</span> wo<span class="token punctuation">,</span> wo2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 模板根路径
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> String FILE_PATH <span class="token operator">=</span> <span class="token string">"/dot/"</span><span class="token punctuation">;</span>
	
	<span class="token comment">/**
	 * 获取WordOperator对象
	 * @param templateName	word模板名字（必须放在/src/main/resources/dot下）
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> WordOperator <span class="token function">getWordOperator</span><span class="token punctuation">(</span>String templateName<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WordOperator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span> FILE_PATH <span class="token operator">+</span> templateName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 下载生成的word文档
	 * @param request		请求
	 * @param response		响应
	 * @param fileName		新文档名字（不带后缀名）
	 * @param wordOperator	文档操作对象
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">download_word</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> String fileName<span class="token punctuation">,</span> WordOperator wordOperator<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		ServletOutputStream os <span class="token operator">=</span> null<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 设置好响应头，然后将文件保存到输出流里即可</span>
			response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/vnd.openxmlformats-officedocument.wordprocessingml.document"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment;filename="</span> <span class="token operator">+</span> FileUtils<span class="token punctuation">.</span><span class="token function">encodeFileName</span><span class="token punctuation">(</span>FileUtils<span class="token punctuation">.</span><span class="token function">addRandom</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".docx"</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			os <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			wordOperator<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>os<span class="token punctuation">)</span><span class="token punctuation">;</span>
			os<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 关闭输出流</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>os <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 下载生成的word文档（多文件合并）
	 * @param request		请求
	 * @param response		响应
	 * @param fileName		新文档名字（不带后缀名）
	 * @param woList		文档操作对象集合（合并顺序）
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">download_word</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> String fileName<span class="token punctuation">,</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>WordOperator<span class="token punctuation">&gt;</span></span> woList<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		<span class="token function">download_word</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> woList<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WordOperator</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 下载生成的word文档（多文件合并）
	 * @param request		请求
	 * @param response		响应
	 * @param fileName		新文档名字（不带后缀名）
	 * @param woList		文档操作对象集合（合并顺序）
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">download_word</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> String fileName<span class="token punctuation">,</span> WordOperator<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> woList<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		ServletOutputStream os <span class="token operator">=</span> null<span class="token punctuation">;</span>
		List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> tempDocList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 设置响应头</span>
			response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/vnd.openxmlformats-officedocument.wordprocessingml.document"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment;filename="</span> <span class="token operator">+</span> FileUtils<span class="token punctuation">.</span><span class="token function">encodeFileName</span><span class="token punctuation">(</span>FileUtils<span class="token punctuation">.</span><span class="token function">addRandom</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".docx"</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			os <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 一个wo对应一份文档，循环保存下来</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>WordOperator wo <span class="token operator">:</span> woList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				String tempDoc <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".docx"</span><span class="token punctuation">;</span>
				wo<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				tempDocList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 然后把上面保存的文档合并起来</span>
			String tempDoc <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> <span class="token function">mergeDocx</span><span class="token punctuation">(</span>tempDocList<span class="token punctuation">)</span><span class="token punctuation">;</span>
			tempDocList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 将这份文档以流的形式保存到输出流中</span>
			IOUtils<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> os<span class="token punctuation">)</span><span class="token punctuation">;</span>
			os<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 关闭输出流</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>os <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 将全部临时文档删除掉</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>String tempDoc <span class="token operator">:</span> tempDocList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				FileUtils<span class="token punctuation">.</span><span class="token function">delFile</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 下载生成的pdf文档
	 * @param request		请求
	 * @param response		响应
	 * @param fileName		新文档名字（不带后缀名）
	 * @param wordOperator	文档操作对象
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">download_pdf</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> String fileName<span class="token punctuation">,</span> WordOperator wordOperator<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		ServletOutputStream os <span class="token operator">=</span> null<span class="token punctuation">;</span>
		String tempDoc <span class="token operator">=</span> null<span class="token punctuation">;</span>
		String tempPdf <span class="token operator">=</span> null<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 设置响应头</span>
			response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/vnd.openxmlformats-officedocument.wordprocessingml.document"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>MimeUtils<span class="token punctuation">.</span><span class="token function">getByExtension</span><span class="token punctuation">(</span><span class="token string">"pdf"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">";charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment;filename="</span> <span class="token operator">+</span> FileUtils<span class="token punctuation">.</span><span class="token function">encodeFileName</span><span class="token punctuation">(</span>FileUtils<span class="token punctuation">.</span><span class="token function">addRandom</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".pdf"</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 先将生成的word文档保存起来</span>
			tempDoc <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".docx"</span><span class="token punctuation">;</span>
			wordOperator<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 然后将word转成pdf保存起来</span>
			tempPdf <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".pdf"</span><span class="token punctuation">;</span>
			PDFUtils<span class="token punctuation">.</span><span class="token function">office2PDF</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">,</span> tempPdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 将这份文档以流的形式保存到输出流中</span>
			os <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			FileUtils<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>tempPdf<span class="token punctuation">)</span><span class="token punctuation">,</span> os<span class="token punctuation">)</span><span class="token punctuation">;</span>
			os<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 关闭输出流</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>os <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 将临时文档删除掉</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>tempDoc <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				FileUtils<span class="token punctuation">.</span><span class="token function">delFile</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 将临时文档删除掉</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>tempPdf <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				FileUtils<span class="token punctuation">.</span><span class="token function">delFile</span><span class="token punctuation">(</span>tempPdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 下载生成的pdf文档（多文件合并）
	 * @param request		请求
	 * @param response		响应
	 * @param fileName		新文档名字（不带后缀名）
	 * @param woList		文档操作对象集合（合并顺序）
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">download_pdf</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> String fileName<span class="token punctuation">,</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>WordOperator<span class="token punctuation">&gt;</span></span> woList<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		<span class="token function">download_pdf</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> woList<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WordOperator</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 下载生成的pdf文档（多文件合并）
	 * @param request		请求
	 * @param response		响应
	 * @param fileName		新文档名字（不带后缀名）
	 * @param woList		文档操作对象集合（合并顺序）
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">download_pdf</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> String fileName<span class="token punctuation">,</span> WordOperator<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> woList<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> tempDocList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ServletOutputStream os <span class="token operator">=</span> null<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 设置响应头</span>
			response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/vnd.openxmlformats-officedocument.wordprocessingml.document"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>MimeUtils<span class="token punctuation">.</span><span class="token function">getByExtension</span><span class="token punctuation">(</span><span class="token string">"pdf"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">";charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment;filename="</span> <span class="token operator">+</span> FileUtils<span class="token punctuation">.</span><span class="token function">encodeFileName</span><span class="token punctuation">(</span>FileUtils<span class="token punctuation">.</span><span class="token function">addRandom</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".pdf"</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 一个wo对应一份文档，循环保存下来</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>WordOperator wo <span class="token operator">:</span> woList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				String tempDoc <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".docx"</span><span class="token punctuation">;</span>
				wo<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				tempDocList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 然后把上面保存的文档合并起来</span>
			String tempDoc <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> <span class="token function">mergeDocx</span><span class="token punctuation">(</span>tempDocList<span class="token punctuation">)</span><span class="token punctuation">;</span>
			tempDocList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 再把这份合并好的文档转成pdf</span>
			String tempPdf <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".pdf"</span><span class="token punctuation">;</span>
			PDFUtils<span class="token punctuation">.</span><span class="token function">office2PDF</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">,</span> tempPdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			tempDocList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tempPdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 将这份文档以流的形式保存到输出流中</span>
			os <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			FileUtils<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>tempPdf<span class="token punctuation">)</span><span class="token punctuation">,</span> os<span class="token punctuation">)</span><span class="token punctuation">;</span>
			os<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 关闭输出流</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>os <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 将全部临时文档删除掉</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>String tempDoc <span class="token operator">:</span> tempDocList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				FileUtils<span class="token punctuation">.</span><span class="token function">delFile</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 预览生成的pdf文档
	 * @param request		请求
	 * @param response		响应
	 * @param fileName		新文档名字（不带后缀名）
	 * @param wordOperator	文档操作对象
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">preview_pdf</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> String fileName<span class="token punctuation">,</span> WordOperator wordOperator<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		String tempDoc <span class="token operator">=</span> null<span class="token punctuation">;</span>
		String tempPdf <span class="token operator">=</span> null<span class="token punctuation">;</span>
		ServletOutputStream os <span class="token operator">=</span> null<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 设置响应头</span>
			response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>MimeUtils<span class="token punctuation">.</span><span class="token function">getByExtension</span><span class="token punctuation">(</span><span class="token string">"pdf"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">";charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"inline;filename="</span> <span class="token operator">+</span> FileUtils<span class="token punctuation">.</span><span class="token function">encodeFileName</span><span class="token punctuation">(</span>FileUtils<span class="token punctuation">.</span><span class="token function">addRandom</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".pdf"</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 先将生成的word文档保存起来</span>
			tempDoc <span class="token operator">=</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".docx"</span><span class="token punctuation">;</span>
			wordOperator<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 然后将word转成pdf保存起来</span>
			tempPdf <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".pdf"</span><span class="token punctuation">;</span>
			PDFUtils<span class="token punctuation">.</span><span class="token function">office2PDF</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">,</span> tempPdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 将pdf文档以流的形式输送给response</span>
			os <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			File pdfFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>tempPdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			FileUtils<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span>pdfFile<span class="token punctuation">,</span> os<span class="token punctuation">)</span><span class="token punctuation">;</span>
			os<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 关闭输出流</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>os <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 将word和pdf两个临时文件删除掉</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>tempDoc <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				FileUtils<span class="token punctuation">.</span><span class="token function">delFile</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>tempPdf <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				FileUtils<span class="token punctuation">.</span><span class="token function">delFile</span><span class="token punctuation">(</span>tempPdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 预览生成的pdf文档（多文件合并）
	 * @param request		请求
	 * @param response		响应
	 * @param fileName		新文档名字（不带后缀名）
	 * @param woList		文档操作对象集合（合并顺序）
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">preview_pdf</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> String fileName<span class="token punctuation">,</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>WordOperator<span class="token punctuation">&gt;</span></span> woList<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		<span class="token function">preview_pdf</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> woList<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WordOperator</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 预览生成的pdf文档（多文件合并）
	 * @param request		请求
	 * @param response		响应
	 * @param fileName		新文档名字（不带后缀名）
	 * @param woList		文档操作对象集合（合并顺序）
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">preview_pdf</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">,</span> String fileName<span class="token punctuation">,</span> WordOperator<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> woList<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> tempDocList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ServletOutputStream os <span class="token operator">=</span> null<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 设置响应头</span>
			response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>MimeUtils<span class="token punctuation">.</span><span class="token function">getByExtension</span><span class="token punctuation">(</span><span class="token string">"pdf"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">";charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"inline; filename="</span> <span class="token operator">+</span> FileUtils<span class="token punctuation">.</span><span class="token function">encodeFileName</span><span class="token punctuation">(</span>FileUtils<span class="token punctuation">.</span><span class="token function">addRandom</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".pdf"</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 一个wo对应一份文档，循环保存下来</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>WordOperator wo <span class="token operator">:</span> woList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				String tempDoc <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".docx"</span><span class="token punctuation">;</span>
				wo<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				tempDocList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 然后把上面保存的文档合并起来</span>
			String tempDoc <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> <span class="token function">mergeDocx</span><span class="token punctuation">(</span>tempDocList<span class="token punctuation">)</span><span class="token punctuation">;</span>
			tempDocList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 再把这份合并好的文档转成pdf</span>
			String tempPdf <span class="token operator">=</span> <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".pdf"</span><span class="token punctuation">;</span>
			PDFUtils<span class="token punctuation">.</span><span class="token function">office2PDF</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">,</span> tempPdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			tempDocList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tempPdf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 将这份文档以流的形式保存到输出流中</span>
			os <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			FileUtils<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>tempPdf<span class="token punctuation">)</span><span class="token punctuation">,</span> os<span class="token punctuation">)</span><span class="token punctuation">;</span>
			os<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 关闭输出流</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>os <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 将全部临时文档删除掉</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>String tempDoc <span class="token operator">:</span> tempDocList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				FileUtils<span class="token punctuation">.</span><span class="token function">delFile</span><span class="token punctuation">(</span>tempDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 合并若干个文档（按顺序合并）
	 * @param fileNames	需要合并的几个word文档全路径
	 * @return 返回合并好的文档名称，位置在DICK下
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> String <span class="token function">mergeDocx</span><span class="token punctuation">(</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> fileNames<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		XmlOptions optionsOuter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		optionsOuter<span class="token punctuation">.</span><span class="token function">setSaveOuter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		CTBody firstCTBody <span class="token operator">=</span> null<span class="token punctuation">;</span>
		XWPFDocument firstXWPFDocument <span class="token operator">=</span> null<span class="token punctuation">;</span>
		String prefix <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> firstMainPart <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> addPart <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> sufix <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fileNames<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			String fileName <span class="token operator">=</span> fileNames<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			InputStream in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			OPCPackage srcPackage <span class="token operator">=</span> OPCPackage<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
			XWPFDocument srcDocument <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XWPFDocument</span><span class="token punctuation">(</span>srcPackage<span class="token punctuation">)</span><span class="token punctuation">;</span>
			CTBody srcBody <span class="token operator">=</span> srcDocument<span class="token punctuation">.</span><span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				firstXWPFDocument <span class="token operator">=</span> srcDocument<span class="token punctuation">;</span>
				firstCTBody <span class="token operator">=</span> srcBody<span class="token punctuation">;</span>
				String srcString <span class="token operator">=</span> srcBody<span class="token punctuation">.</span><span class="token function">xmlText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				prefix <span class="token operator">=</span> srcString<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> srcString<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"&gt;"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				firstMainPart <span class="token operator">=</span> srcString<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>srcString<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"&gt;"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> srcString<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"&lt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				sufix <span class="token operator">=</span> srcString<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>srcString<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"&lt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				String appendString <span class="token operator">=</span> srcBody<span class="token punctuation">.</span><span class="token function">xmlText</span><span class="token punctuation">(</span>optionsOuter<span class="token punctuation">)</span><span class="token punctuation">;</span>
				addPart <span class="token operator">+=</span> appendString<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>appendString<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"&gt;"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> appendString<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"&lt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		CTBody makeBody <span class="token operator">=</span> CTBody<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>prefix <span class="token operator">+</span> firstMainPart <span class="token operator">+</span> addPart <span class="token operator">+</span> sufix<span class="token punctuation">)</span><span class="token punctuation">;</span>
		firstCTBody<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>makeBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
		String tmpFileName <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".docx"</span><span class="token punctuation">;</span>
		OutputStream dest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"/"</span> <span class="token operator">+</span> tmpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		firstXWPFDocument<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> tmpFileName<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 创建当前项目绝对路径下的临时文件保存位置
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{<!-- --></span>
		File directory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//获取当前项目所在的绝对路径</span>
		String courseFile <span class="token operator">=</span> directory<span class="token punctuation">.</span><span class="token function">getCanonicalPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> 
		File file<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>courseFile<span class="token operator">+</span><span class="token string">"/temp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//创建临时文件保存位置</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			file<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		String path<span class="token operator">=</span>file<span class="token punctuation">.</span><span class="token function">getCanonicalPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> path<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="PDFlibreOffice_808"></a>PDF文档工具类（libreOffice）</h4> 
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ConnectException<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>artofsolving<span class="token punctuation">.</span>jodconverter<span class="token punctuation">.</span>DocumentConverter<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>artofsolving<span class="token punctuation">.</span>jodconverter<span class="token punctuation">.</span>openoffice<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>OpenOfficeConnection<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>artofsolving<span class="token punctuation">.</span>jodconverter<span class="token punctuation">.</span>openoffice<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>SocketOpenOfficeConnection<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>artofsolving<span class="token punctuation">.</span>jodconverter<span class="token punctuation">.</span>openoffice<span class="token punctuation">.</span>converter<span class="token punctuation">.</span>OpenOfficeDocumentConverter<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>grkj<span class="token punctuation">.</span>Global<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>grkj<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>StringUtils<span class="token punctuation">;</span>

<span class="token comment">/**
 * PDF文档工具类
 * @author 
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PDFUtils</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/**
	 * 连接libreOffice服务的地址和端口号
	 * 读取properties文件的配置信息
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> String LIBREOFFICE_URL <span class="token operator">=</span> Global<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token string">"libreOfficeUrl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> LIBREOFFICE_PORT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>Global<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token string">"libreOfficePort"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/**
	 * WORD转PDF方法
	 * @param sourceFile	要被转化的word文档路径（如E:\\1.docx）
	 * @param destFile		转成之后pdf文档存放路径（如E:\\1.pdf）
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">office2PDF</span><span class="token punctuation">(</span>String sourceFile<span class="token punctuation">,</span> String destFile<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			File inputFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>sourceFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
			File outputFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>destFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outputFile<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				outputFile<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			OpenOfficeConnection connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SocketOpenOfficeConnection</span><span class="token punctuation">(</span>LIBREOFFICE_URL<span class="token punctuation">,</span> LIBREOFFICE_PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>
			connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			DocumentConverter converter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OpenOfficeDocumentConverter</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
			converter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>inputFile<span class="token punctuation">,</span> outputFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
			connection<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ConnectException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 如果报错的是连接不上，则找到重启libreoffice5重启bat脚本，执行下</span>
				String libreOffice5Bat <span class="token operator">=</span> Global<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token string">"libreOffice5Bat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>libreOffice5Bat<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					String cmd <span class="token operator">=</span> <span class="token string">"cmd /k start "</span> <span class="token operator">+</span> libreOffice5Bat<span class="token punctuation">;</span>
					Runtime<span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 脚本里是先杀线程，过五秒，再启动程序，所以这里等六秒，再重新执行主逻辑</span>
					Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">office2PDF</span><span class="token punctuation">(</span>sourceFile<span class="token punctuation">,</span> destFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="demo_871"></a>demo</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/getPrintFile"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getDownLoadPrintFiles</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//需要替换掉模板里的特殊标识数据，key要和标识字符一致</span>
		Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span>mapper<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//word的操作类（POI）,替换特殊标识字符内容如：{name}</span>
		WordOperator op <span class="token operator">=</span> ExportWord<span class="token punctuation">.</span><span class="token function">getWordOperator</span><span class="token punctuation">(</span><span class="token string">"模板.docx"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceText</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
		<span class="token comment">//下载word文档</span>
		ExportWord<span class="token punctuation">.</span><span class="token function">download_word</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span><span class="token string">"模板"</span><span class="token punctuation">,</span> op<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//word的操作类（POI）,替换特殊标识字符内容如：{name}</span>
		WordOperator op <span class="token operator">=</span> ExportWord<span class="token punctuation">.</span><span class="token function">getWordOperator</span><span class="token punctuation">(</span><span class="token string">"模板.docx"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceText</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//转为pdf文档</span>
		ExportWord<span class="token punctuation">.</span><span class="token function">preview_pdf</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span><span class="token string">"模板"</span><span class="token punctuation">,</span> op<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/02eec3711fd7b55f69a1200f5f58fef8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">php 腾讯企业邮件发送,gitlab配置通过smtp发送邮件（QQ exmail腾讯企业为例）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0587eb5951d890d8be45f81357eb50c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java io ioexception,java.io.IOException</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>