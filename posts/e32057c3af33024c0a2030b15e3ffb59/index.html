<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用WDF开发驱动程序 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用WDF开发驱动程序" />
<meta property="og:description" content=" 使用WDF开发驱动程序 Windows驱动程序框架（WDF）驱动程序由基于框架的驱动程序所使用的Windows驱动程序框架对象定义的DriverEntry 例程和一组事件回调函数组成。 创建WDF驱动程序时，执行操作： 使用框架驱动程序对象来表示驱动程序
驱动程序的DriverEntry 例程必须调用WdfDriverCreate以创建表示驱动程序的框架驱动程序对象。
WdfDriverCreate方法还会注册驱动程序的EvtDriverDeviceadd回调函数即插即用，该函数（PnP）管理器报告驱动程序支持的设备是否存在。
使用框架设备对象支持驱动程序中的PnP和电源管理
所有驱动程序都必须调用WdfDeviceCreate，以便为驱动程序支持的设备创建框架对象。
设备可以是插入到计算机中的一片硬件，也可以是仅限软件的设备。
框架设备对象支持PnP和电源管理操作，驱动程序可以注册事件回调函数，以便在设备进入或离开其工作状态时通知驱动程序。
使用框架队列对象和框架请求对象来支持驱动程序的i/o操作
从应用程序或其他驱动程序接收读取、写入或设备i/o控制请求的所有驱动程序都必须调用WdfIoQueueCreate，以创建表示i/o列队的框架列队对象。
驱动程序会为每个i/o队列注册一个或多个请求处理程序。
当i/o管理器向驱动程序发送i/o请求时，框架将为请求创建一个框架请求对象，将该请求对象放置在i/o队列中，并调用驱动程序的一个请求处理程序来通知驱动程序请求可用。
该驱动程序将获取i/o请求，并可以重新排队、完成、取消或转发该请求。
使用框架中断对象来处理设备中断
处理设备中断的驱动程序必须调用WdfInterruptCreate，以便为每个中断创建框架中断对象并注册回调函数。
这些回调函数启用和禁用中断，并充当中断服务例程（ISR），并为中断（DPC）延迟过程调用。
KMDF驱动程序可以使用框架的DMA启用码对象和DMA事务对象来处理设备（DMA）操作的直接内存访问
如果KMDF驱动程序的设备支持DMA操作，驱动程序应调用WdfDmaEnablerCreate来创建DMA启用程序对象，并使用WdfDmaTransactionCreate创建一个或多个DMA事务对象。
DMA transaction 对象定义于计划设备硬件执行DMA操作的EvtProgramDma回调函数。
使用框架的i/o目标对象将i/o请求发送到其他程序
若要将i/o请求传递到其他驱动程序（通常是驱动程序堆栈）中的下一个较低驱动程序，则驱动程序将请求发送到i/o目标对象。
KMDF驱动程序可以使用框架的wmi提供程序对象和wmi实例对象来支持（WMI）功能Windows Management Instrumentation
大多数KMDF驱动程序应支持WMI，并应调用WdfWmiInstanceCreate来注册发送或接收WMI数据的回调函数。
使用框架的同步功能
所有驱动程序都必须了解多处理器同步问题，并应使用框架提供的同步技术。
WDF体系结构 WDF为驱动程序提供了基于对象的接口，框架定义的对象接口包含：
对象方法
方法是驱动程序可以调用以对象执行操作或获取或设置对象属性的函数。
方法名为WdfObjectAction，其中对象描述对象，操作指示函数的作用。
例：WdfDeviceCreate创建设备对象。
对象事件回调函数
事件回调函数是驱动程序提供的函数。每个事件回调函数都与某个对象上可能发生的特定事件关联。当发生关联的事件时，框架将调用事件回调函数。
例：驱动程序将注册EvtDeviceD0Entry事件回调，以便在设备进入工作状态时收到通知。
对象属性
属性是存储在对象中的值，并且驱动程序可以获取并设置（即，更改）。在许多情况下，属性直接映射到相应的WDM对象中的字段。
不能失败的属性命名为WDF对象获取值和WDF对象集值，并且可能失败的属性被命名为WDF对象检索值和对象赋值。
对象描述对象，值标志函数设置或返回的数据。
例：WDfDeviceGetDriver返回与设备对象相关联的驱动程序对象的句柄。
对象句柄
基于框架的驱动程序绝不会直接访问框架对象。相反，驱动程序将接收对象句柄，该句柄可传递给对象的方法。
框架定义了基于框架的驱动程序使用的多种对象类型 框架驱动程序对象表示每个驱动程序。框架设备对象表示驱动程序支持的每个设备。框架队列对象代表接收设备i/o请求的i/o队列。Framework 请求对象表示每个i/o队列接收的i/o请求数。 " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/e32057c3af33024c0a2030b15e3ffb59/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-07T10:50:46+08:00" />
<meta property="article:modified_time" content="2021-02-07T10:50:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用WDF开发驱动程序</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="WDF_0"></a>使用WDF开发驱动程序</h3> 
<ul><li>Windows驱动程序框架（WDF）驱动程序由基于框架的驱动程序所使用的<strong>Windows驱动程序框架对象</strong>定义的DriverEntry 例程和一组事件回调函数组成。</li></ul> 
<h4><a id="WDF_3"></a>创建WDF驱动程序时，执行操作：</h4> 
<ul><li> <p>使用<strong>框架驱动程序对象</strong>来表示驱动程序</p> <p>驱动程序的<strong>DriverEntry</strong> 例程必须调用<strong>WdfDriverCreate</strong>以创建表示驱动程序的框架驱动程序对象。<br> <strong>WdfDriverCreate</strong>方法还会注册驱动程序的<strong>EvtDriverDeviceadd</strong>回调函数即插即用，该函数（PnP）管理器报告驱动程序支持的设备是否存在。</p> </li><li> <p>使用<strong>框架设备对象支持驱动程序中的PnP和电源管理</strong></p> <p>所有驱动程序都必须调用<strong>WdfDeviceCreate</strong>，以便为驱动程序支持的设备创建框架对象。<br> 设备可以是插入到计算机中的一片硬件，也可以是仅限软件的设备。<br> 框架设备对象支持PnP和电源管理操作，驱动程序可以注册事件回调函数，以便在设备进入或离开其工作状态时通知驱动程序。</p> </li><li> <p>使用<strong>框架队列对象</strong>和<strong>框架请求对象</strong>来支持驱动程序的i/o操作</p> <p>从应用程序或其他驱动程序接收读取、写入或设备i/o控制请求的所有驱动程序都必须调用<strong>WdfIoQueueCreate</strong>，以创建表示i/o列队的框架列队对象。<br> 驱动程序会为每个i/o队列注册一个或多个请求处理程序。<br> 当i/o管理器向驱动程序发送i/o请求时，框架将为请求创建一个框架请求对象，将该请求对象放置在i/o队列中，并调用驱动程序的一个请求处理程序来通知驱动程序请求可用。<br> 该驱动程序将获取i/o请求，并可以重新排队、完成、取消或转发该请求。</p> </li><li> <p>使用<strong>框架中断对象</strong>来处理设备中断</p> <p>处理设备中断的驱动程序必须调用<strong>WdfInterruptCreate</strong>，以便为每个中断创建框架中断对象并注册回调函数。<br> 这些回调函数启用和禁用中断，并充当中断服务例程（ISR），并为中断（DPC）延迟过程调用。</p> </li><li> <p>KMDF驱动程序可以使用框架的<strong>DMA启用码对象</strong>和<strong>DMA事务对象</strong>来处理设备（DMA）操作的直接内存访问</p> <p>如果KMDF驱动程序的设备支持DMA操作，驱动程序应调用<strong>WdfDmaEnablerCreate</strong>来创建DMA启用程序对象，并使用<strong>WdfDmaTransactionCreate</strong>创建一个或多个DMA事务对象。<br> DMA transaction 对象定义于计划设备硬件执行DMA操作的<strong>EvtProgramDma</strong>回调函数。</p> </li><li> <p>使用框架的<strong>i/o目标对象</strong>将i/o请求发送到其他程序</p> <p>若要将i/o请求传递到其他驱动程序（通常是驱动程序堆栈）中的下一个较低驱动程序，则驱动程序将请求发送到i/o目标对象。</p> </li><li> <p>KMDF驱动程序可以使用框架的<strong>wmi提供程序对象</strong>和<strong>wmi实例对象</strong>来支持（WMI）功能Windows Management Instrumentation</p> <p>大多数KMDF驱动程序应支持WMI，并应调用<strong>WdfWmiInstanceCreate</strong>来注册发送或接收WMI数据的回调函数。</p> </li><li> <p>使用框架的同步功能</p> <p>所有驱动程序都必须了解多处理器同步问题，并应使用框架提供的<strong>同步技术</strong>。</p> </li></ul> 
<h4><a id="WDF_37"></a>WDF体系结构</h4> 
<p><strong>WDF为驱动程序提供了基于对象的接口，框架定义的对象接口包含：</strong></p> 
<ul><li> <p><strong>对象方法</strong></p> <p>方法是驱动程序可以调用以对象执行操作或获取或设置对象属性的函数。<br> 方法名为<strong>WdfObjectAction</strong>，其中对象描述对象，操作指示函数的作用。<br> 例：<strong>WdfDeviceCreate</strong>创建设备对象。</p> </li><li> <p>对象事件回调函数</p> <p>事件回调函数是驱动程序提供的函数。每个事件回调函数都与某个对象上可能发生的特定事件关联。当发生关联的事件时，框架将调用事件回调函数。<br> 例：驱动程序将注册<strong>EvtDeviceD0Entry</strong>事件回调，以便在设备进入工作状态时收到通知。</p> </li><li> <p>对象属性</p> <p>属性是存储在对象中的值，并且驱动程序可以获取并设置（即，更改）。在许多情况下，属性直接映射到相应的WDM对象中的字段。<br> 不能失败的属性命名为WDF对象获取值和WDF对象集值，并且可能失败的属性被命名为WDF对象检索值和对象赋值。<br> 对象描述对象，值标志函数设置或返回的数据。<br> 例：WDfDeviceGetDriver返回与设备对象相关联的驱动程序对象的句柄。</p> </li><li> <p>对象句柄<br> 基于框架的驱动程序绝不会直接访问框架对象。相反，驱动程序将接收对象句柄，该句柄可传递给对象的方法。</p> </li></ul> 
<h4><a id="_58"></a>框架定义了基于框架的驱动程序使用的多种对象类型</h4> 
<ul><li>框架驱动程序对象表示每个驱动程序。</li><li>框架设备对象表示驱动程序支持的每个设备。</li><li>框架队列对象代表接收设备i/o请求的i/o队列。</li><li>Framework 请求对象表示每个i/o队列接收的i/o请求数。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ae9e1bf53a1c7a42a87f6bb64306288d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">idea部署失败怎么解决_解决IDEA Java Web项目没问题，但部署时出错的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4574f12f6bea4eca823aaa431b4ab5b6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JDK1.8中英文官方文档</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>