<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux：kubernetes（k8s）探针LivenessProbe的使用（9） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux：kubernetes（k8s）探针LivenessProbe的使用（9）" />
<meta property="og:description" content="他做的事情就是当我检测的一个东西他不在规定的时间内存在的话，我就让他重启，这个检测的目标可以是文件或者端口等
我这个是在上一章的基础之上继续操作，我会保留startupProbe探针让后看一下他俩的执行优先的一个效果
Linux：kubernetes（k8s）探针StartupProbe的使用（8）-CSDN博客https://blog.csdn.net/w14768855/article/details/136544481?spm=1001.2014.3001.5501 1.探针目标：错误的请求接口 apiVersion: v1 # api文档版本 kind: Pod # 资源对象类型 metadata: # pod相关的元数据，用于描述pod的数据 name: nginx-po # pod名称 labels: # pod的标签 type: app #这个是随便写的 自定义的标签 version: 1.0.0 #这个是随便写的 test: 1.0.0 #都标签随便写的 namespace: &#39;default&#39; #命名空间的配置 spec: #期望pod按照这里面的描述进行创建 containers: #对于pod容器的描述 - name: nginx #容器的名称 image: nginx:1.7.9 # 指定容器的镜像 imagePullPolicy: IfNotPresent #镜像拉取策略 startupProbe: #应用容器探针 # httpGet: # 探测方式 # path: /index.html #http 请求路径 # tcpSocket : # port: 80 # 请求端口 exec: command: - sh - -c - &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/946306ca8fdae5386c1bc9bba73a1649/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-07T21:08:52+08:00" />
<meta property="article:modified_time" content="2024-03-07T21:08:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux：kubernetes（k8s）探针LivenessProbe的使用（9）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>他做的事情就是当我检测的一个东西他不在规定的时间内存在的话，我就让他重启，这个检测的目标可以是文件或者端口等</p> 
</blockquote> 
<blockquote> 
 <p>我这个是在上一章的基础之上继续操作，我会保留startupProbe探针让后看一下他俩的执行优先的一个效果</p> 
</blockquote> 
<p><a class="has-card" href="https://blog.csdn.net/w14768855/article/details/136544481?spm=1001.2014.3001.5501" title="Linux：kubernetes（k8s）探针StartupProbe的使用（8）-CSDN博客"><span class="link-card-box"><span class="link-title">Linux：kubernetes（k8s）探针StartupProbe的使用（8）-CSDN博客</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/25/e7/a5Sb06Nd_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/w14768855/article/details/136544481?spm=1001.2014.3001.5501</span></span></a> </p> 
<hr> 
<h2>1.探针目标：错误的请求接口</h2> 
<pre><code class="hljs">apiVersion: v1 # api文档版本
kind: Pod  # 资源对象类型
metadata:  # pod相关的元数据，用于描述pod的数据
  name: nginx-po # pod名称
  labels:  # pod的标签
    type: app   #这个是随便写的 自定义的标签
    version: 1.0.0   #这个是随便写的
    test: 1.0.0    #都标签随便写的
  namespace: 'default'  #命名空间的配置
spec: #期望pod按照这里面的描述进行创建
  containers:  #对于pod容器的描述
  - name: nginx #容器的名称
    image: nginx:1.7.9 # 指定容器的镜像
    imagePullPolicy: IfNotPresent  #镜像拉取策略
    startupProbe: #应用容器探针
    #  httpGet: # 探测方式
    #     path: /index.html #http 请求路径
    #  tcpSocket :
    #     port: 80 # 请求端口
      exec:
        command:
        - sh
        - -c
        - "sleep 3; echo 'success' &gt; /inited"
      failureThreshold: 3 # 失败多少次，才算真正失败
      periodSeconds: 10 # 间隔时间
      successThreshold: 1 # 多少次检测成功算成功
      timeoutSeconds: 5  # 请求超时时间
    livenessProbe: #应用容器探针
      httpGet: # 探测方式
         path: /abc.html #http 请求路径
    #  tcpSocket :
         port: 80 # 请求端口
      failureThreshold: 3 # 失败多少次，才算真正失败
      periodSeconds: 10 # 间隔时间
      successThreshold: 1 # 多少次检测成功算成功
      timeoutSeconds: 5  # 请求超时时间  
    command: # 指定容器启动时执行的命令
    - nginx 
    - -g
    - 'daemon off;'
    workingDir: /usr/local/nginx/html # 定义容器启动后的工作目录
    ports: 
    - name: http # 端口名称
      containerPort: 80 # 描述容器内容要暴露的端口
      protocol: TCP # 端口是用什么协议通信
    env:   # 环境变量
    - name: JVM_OPTS  # 环境变量的名称
      value: '-Xms128m -Xmx128m'  # 环境变量的值
    resources: 
      requests: # 最少需要多少资源
        cpu: 100m #限制cpu最少使用 1000m=1核心 100m就是0.1个核心
        memory: 128Mi #限制内存最少使用129兆
      limits:  #最多可以用多少 
        cpu: 200m # 限制最多可以使用多少
        memory: 256Mi
  restartPolicy: OnFailure #重启策略，只有失败的情况才会重启</code></pre> 
<p>abc.html这个接口肯定是没有的 </p> 
<p><img alt="" height="879" src="https://images2.imgbox.com/5a/a8/QkX85s3R_o.png" width="1200"></p> 
<p>我这里让他请求一个错误的接口肯定是请求不到的，去看一下效果</p> 
<p>这里失败了 </p> 
<p>这时我们直接cp复制过去一个文件 abc.html</p> 
<pre><code class="hljs">kubectl cp abc.html nginx-po:/usr/share/nginx/html/</code></pre> 
<p> 这样在下一次重启后就可以了</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1302ebe436103cc059308790e64b75f8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言从入门到精通 第十一章（文件操作）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/128aaf58b605c47f1ec926d66589faf2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringBoot项目集成Redis&#43;JWT实现系统登录token校验</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>