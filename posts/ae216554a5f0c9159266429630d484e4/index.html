<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>iCloud 与  iAd---iOS - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="iCloud 与  iAd---iOS" />
<meta property="og:description" content="iCloud云存储 在苹果开发者中心 AppID中勾选iCloud，重新生成描述文件profile在项目中|Capabilities 中打开iCloud，勾选 Key-Value ， iCloud Documents。 会自动生成项目.entitlements文件手机中设置iCloud账号 存储文档 自定义UIDocument对象类 #import &lt;UIKit/UIKit.h&gt; @interface YTSDocument : UIDocument @property (nonatomic,strong) NSData *data; @end #import &#34;YTSDocument.h&#34; @implementation YTSDocument // 存储时调用 -(id)contentsForType:(NSString *)typeName error:(NSError * _Nullable __autoreleasing *)outError{ if(_data){ return [_data copy]; } return [NSData data]; } // 读取时调用 -(BOOL)loadFromContents:(id)contents ofType:(NSString *)typeName error:(NSError * _Nullable __autoreleasing *)outError{ _data=[contents copy]; return true; } @end VC #import &#34;YTViewController.h&#34; #import &#34;YTSDocument.h&#34; @interface YTViewController () @property (nonatomic,strong) NSMetadataQuery *dataQuery; @property (nonatomic,strong) NSMutableDictionary *fileDic; // @{文件名:修改时间} @property (nonatomic,strong) YTSDocument *dcocument; @end @implementation YTPersonCCViewController - (void)viewDidLoad { [super viewDidLoad]; // 查询icloud文档列表对象 _dataQuery=[NSMetadataQuery new]; _dataQuery." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/ae216554a5f0c9159266429630d484e4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-09-11T14:40:00+08:00" />
<meta property="article:modified_time" content="2017-09-11T14:40:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">iCloud 与  iAd---iOS</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="show-content-free"> 
 <h4>iCloud云存储</h4> 
 <ol><li>在苹果开发者中心 AppID中勾选iCloud，重新生成描述文件profile</li><li>在项目中|Capabilities 中打开iCloud，勾选 Key-Value ， iCloud Documents。 会自动生成项目.entitlements文件</li><li>手机中设置iCloud账号</li></ol> 
 <h6>存储文档</h6> 
 <ol><li>自定义UIDocument对象类</li></ol> 
 <pre><code>#import &lt;UIKit/UIKit.h&gt;

@interface YTSDocument : UIDocument

@property (nonatomic,strong) NSData *data;
@end

#import "YTSDocument.h"

@implementation YTSDocument


// 存储时调用
-(id)contentsForType:(NSString *)typeName error:(NSError * _Nullable __autoreleasing *)outError{

    if(_data){
    
        return [_data copy];
    }
    return [NSData data];
}

// 读取时调用
-(BOOL)loadFromContents:(id)contents ofType:(NSString *)typeName error:(NSError * _Nullable __autoreleasing *)outError{

    _data=[contents copy];
    return true;
}

@end

</code></pre> 
 <ol start="2"><li>VC</li></ol> 
 <pre><code>#import "YTViewController.h"
#import "YTSDocument.h"

@interface YTViewController ()
@property (nonatomic,strong) NSMetadataQuery *dataQuery;
@property (nonatomic,strong) NSMutableDictionary *fileDic;  // @{文件名:修改时间}
@property (nonatomic,strong) YTSDocument *dcocument;
@end


@implementation YTPersonCCViewController

- (void)viewDidLoad {
    [super viewDidLoad];

    
    // 查询icloud文档列表对象
    _dataQuery=[NSMetadataQuery new];
    _dataQuery.searchScopes=@[NSMetadataQueryUbiquitousDataScope];
    // noti
    [[NSNotificationCenter defaultCenter]addObserver:self selector:@selector(queryFinish:) name:NSMetadataQueryDidFinishGatheringNotification object:_dataQuery];
    [[NSNotificationCenter defaultCenter]addObserver:self selector:@selector(queryFinish:) name:NSMetadataQueryDidUpdateNotification object:_dataQuery];
    // 开始查询
    [_dataQuery startQuery];
}

-(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event{

    
    
}

// noti
-(void)queryFinish:(NSNotification *)noti{

    // 获取查询列表，遍历
    NSArray *dataArr=_dataQuery.results;
    _fileDic=[NSMutableDictionary dictionary];
    [dataArr enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        NSMetadataItem *item=obj;
        
        // 文件名,最后修改时间
        NSString *fileName=[item valueForAttribute:NSMetadataItemFSNameKey];
        NSDate *date=[item valueForAttribute:NSMetadataItemFSContentChangeDateKey];
        NSDateFormatter *dateFormat=[NSDateFormatter new];
        [dateFormat setDateFormat:@"yy-MM-dd hh:mm"];
        NSString *dateString=[dateFormat stringFromDate:date];
        [_fileDic setObject:dateString forKey:fileName];
    }];
}

// 获取icloud文件地址
-(NSURL *)getICloudURL:(NSString *)fileName{
    return [[[[NSFileManager defaultManager]URLForUbiquityContainerIdentifier:@"entitie文件中ID"]URLByAppendingPathComponent:@"Documents"]URLByAppendingPathComponent:fileName];
}
// 新建文档
-(void)addDocument:(NSString *)fileName{

    //
    NSURL *fileURL=[self getICloudURL:fileName];
    // 新建文档对象
    YTSDocument *document=[[YTSDocument alloc]initWithFileURL:fileURL];
    [document saveToURL:fileURL forSaveOperation:UIDocumentSaveForCreating completionHandler:^(BOOL success) {
        //
        if(success){
        
            // 开始查询
            [_dataQuery startQuery];
            // reloadData
            
            
            //
            _dcocument=document;    //
        }else{
        
            //
            NSLog(@"save fail");
        }
    }];

}

//
-(void)removeDocument:(NSString *)fileName{
    
    //
    NSError *error;
    [[NSFileManager defaultManager]removeItemAtURL:[self getICloudURL:fileName] error:&amp;error];
    if(error){
        //
        NSLog(@"error:%@",error.localizedDescription);
    }
    [_fileDic removeObjectForKey:fileName];
    
    // reloadData
}

-(void)querryDocument:(NSString *)fileName{
    // 获取文档
    NSURL *fileURL=[self getICloudURL:fileName];
    YTSDocument *document=[[YTSDocument alloc]initWithFileURL:fileURL];
    
    // 打开文档
    [document openWithCompletionHandler:^(BOOL success) {
        if(success){
        
            //
            NSString *dataText=[[NSString alloc]initWithData:document.data encoding:NSUTF8StringEncoding];
        }else{
            NSLog(@"read fail");
        }
    }];
    
    // 保存文档
    [document saveToURL:document.fileURL forSaveOperation:UIDocumentSaveForOverwriting completionHandler:^(BOOL success) {
        NSLog(@"save success");
    }];
}
@end

</code></pre> 
 <h6>存储键值对</h6> 
 <pre><code>    // 用法同NSUserDefaults
    NSUbiquitousKeyValueStore *defaults=[NSUbiquitousKeyValueStore defaultStore];
    [defaults setBool:true forKey:@""];
    [defaults synchronize];
    
    
    [[NSNotificationCenter defaultCenter]addObserver:self selector:@selector(valueChange:) name:NSUbiquitousKeyValueStoreDidChangeExternallyNotification object:defaults];
</code></pre> 
 <h4>iAd内置广告</h4> 
 <pre><code>#import "YTViewController.h"
#import &lt;iAd/iAd.h&gt;

@interface YTViewController ()&lt;ADBannerViewDelegate&gt;

@property (nonatomic,strong) ADBannerView *adView;
@end


@implementation YTPersonCCViewController

- (void)viewDidLoad {
    [super viewDidLoad];


    //
    _adView=[ADBannerView new];
    _adView.delegate=self;
    [_adView setFrame:self.view.frame];
    [self.view addSubview:_adView];
}

#pragma mark dele
// 广告加载完后调用
-(void)bannerViewDidLoadAd:(ADBannerView *)banner{
    NSLog(@"loaded ad");
}
// 点击广告后调用（false则不弹全屏）
-(BOOL)bannerViewActionShouldBegin:(ADBannerView *)banner willLeaveApplication:(BOOL)willLeave{
    return YES;
}
// 关闭广告后调用
-(void)bannerViewActionDidFinish:(ADBannerView *)banner{
    NSLog(@"广告已关闭");
}
// 获取广告失败后调用
-(void)bannerView:(ADBannerView *)banner didFailToReceiveAdWithError:(NSError *)error{
    NSLog(@"广告加载失败:%@",error);
    _adView.hidden=true;
}

@end
</code></pre> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eb8beff9ed0696a87658a04d94ed53d7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【转】证书安装指引（腾讯云）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/67fcfc5d4e3cf5d162a7b1fe7820a2a2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">美国高通 Snapdragon Neural Processing Engine SDK （SNPE） 系列 （2）：支持的网络层</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>