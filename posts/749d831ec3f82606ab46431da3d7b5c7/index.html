<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>目标检测的数据集制作一般流程（Pascal VOC标准格式） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="目标检测的数据集制作一般流程（Pascal VOC标准格式）" />
<meta property="og:description" content="了解Pascal VOC 利用深度学习方法如Faster R-CNN或YOLOv3等进行目标检测时需要训练数据集，我们很少会根据自己的数据集格式修改代码，更多的是按照一定格式修改自己的数据格式，而PASCAL VOC为图像识别和分类提供了一整套标准化的数据集，为了方便我们目标检测的进行，可以先来详细的记录一下PASCAL VOC的格式。
Pascal VOC数据集下载地址：http://host.robots.ox.ac.uk/pascal/VOC/
数据集下载后解压得到一个名为VOCdevkit的文件夹，该文件夹结构如下：
. └── VOCdevkit #根目录 └── VOC2017 #不同年份的数据集，这里只下载了2007的，还有2007等其它年份的 ├── Annotations #存放xml文件，与JPEGImages中的图片一一对应，解释图片的内容等等 ├── ImageSets #该目录下存放的都是txt文件，txt文件中每一行包含一个图片的名称，末尾会加上±1表示正负样本 │ ├── Action │ ├── Layout │ ├── Main │ └── Segmentation ├── JPEGImages #存放源图片 ├── SegmentationClass #存放的是图片，语义分割相关 └── SegmentationObject #存放的是图片，实例分割相关 （1）Annotations Annotations文件夹中存放的是xml格式的标签文件，每一个xml文件都对应于JPEGImages文件夹中的一张图片，包含了图片的重要信息：图片的名称，图片中object的类别及其bounding box坐标。xml文件的解析如下：
其中：
标签解释filename文件名source图像来源（不重要）size图像尺寸（长宽以及通道），包含了width，height和depthsegmented是否用于分割object需检测到的物体，包含了物体名称name，拍摄角度pose，是否截断truncated，难以识别difficult，object对应的bounding box信息 bndboxbndbox包含左下角和右上角x，y坐标 （xmin，ymin，xmax，ymax） &lt;annotation&gt; &lt;folder&gt;VOC2007&lt;/folder&gt; &lt;filename&gt;000051.jpg&lt;/filename&gt; &lt;source&gt; &lt;database&gt;The VOC2007 Database&lt;/database&gt; &lt;annotation&gt;PASCAL VOC2007&lt;/annotation&gt; &lt;image&gt;flickr&lt;/image&gt; &lt;flickrid&gt;291539949&lt;/flickrid&gt; &lt;/source&gt; &lt;owner&gt; &lt;flickrid&gt;kristian_svensson&lt;/flickrid&gt; &lt;name&gt;Kristian Svensson&lt;/name&gt; &lt;/owner&gt; &lt;size&gt; &lt;width&gt;500&lt;/width&gt; &lt;height&gt;375&lt;/height&gt; &lt;depth&gt;3&lt;/depth&gt; &lt;/size&gt; &lt;segmented&gt;0&lt;/segmented&gt; &lt;object&gt; &lt;name&gt;motorbike&lt;/name&gt; &lt;pose&gt;Unspecified&lt;/pose&gt; &lt;truncated&gt;1&lt;/truncated&gt; &lt;difficult&gt;0&lt;/difficult&gt; &lt;bndbox&gt; &lt;xmin&gt;352&lt;/xmin&gt; &lt;ymin&gt;138&lt;/ymin&gt; &lt;xmax&gt;500&lt;/xmax&gt; &lt;ymax&gt;375&lt;/ymax&gt; &lt;/bndbox&gt; &lt;/object&gt; &lt;object&gt; &lt;name&gt;motorbike&lt;/name&gt; &lt;pose&gt;Unspecified&lt;/pose&gt; &lt;truncated&gt;0&lt;/truncated&gt; &lt;difficult&gt;0&lt;/difficult&gt; &lt;bndbox&gt; &lt;xmin&gt;105&lt;/xmin&gt; &lt;ymin&gt;1&lt;/ymin&gt; &lt;xmax&gt;427&lt;/xmax&gt; &lt;ymax&gt;245&lt;/ymax&gt; &lt;/bndbox&gt; &lt;/object&gt; &lt;object&gt; &lt;name&gt;person&lt;/name&gt; &lt;pose&gt;Unspecified&lt;/pose&gt; &lt;truncated&gt;0&lt;/truncated&gt; &lt;difficult&gt;1&lt;/difficult&gt; &lt;bndbox&gt; &lt;xmin&gt;415&lt;/xmin&gt; &lt;ymin&gt;61&lt;/ymin&gt; &lt;xmax&gt;465&lt;/xmax&gt; &lt;ymax&gt;195&lt;/ymax&gt; &lt;/bndbox&gt; &lt;/object&gt; &lt;/annotation&gt; 以下程序可以将XML标签中目标绘制在图像中，并返回：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/749d831ec3f82606ab46431da3d7b5c7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-28T16:34:49+08:00" />
<meta property="article:modified_time" content="2019-05-28T16:34:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">目标检测的数据集制作一般流程（Pascal VOC标准格式）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="Pascal_VOC_0"></a>了解Pascal VOC</h3> 
<p>利用深度学习方法如Faster R-CNN或YOLOv3等进行目标检测时需要训练数据集，我们很少会根据自己的数据集格式修改代码，更多的是按照一定格式修改自己的数据格式，而PASCAL VOC为图像识别和分类提供了一整套标准化的数据集，为了方便我们目标检测的进行，可以先来详细的记录一下PASCAL VOC的格式。<br> <strong>Pascal VOC数据集下载地址</strong>：<a href="http://host.robots.ox.ac.uk/pascal/VOC/" rel="nofollow">http://host.robots.ox.ac.uk/pascal/VOC/</a></p> 
<p>数据集下载后解压得到一个名为VOCdevkit的文件夹，该文件夹结构如下：</p> 
<pre><code>.
└── VOCdevkit     #根目录
    └── VOC2017   #不同年份的数据集，这里只下载了2007的，还有2007等其它年份的
        ├── Annotations        #存放xml文件，与JPEGImages中的图片一一对应，解释图片的内容等等
        ├── ImageSets          #该目录下存放的都是txt文件，txt文件中每一行包含一个图片的名称，末尾会加上±1表示正负样本
        │   ├── Action
        │   ├── Layout
        │   ├── Main
        │   └── Segmentation
        ├── JPEGImages         #存放源图片
        ├── SegmentationClass  #存放的是图片，语义分割相关
        └── SegmentationObject #存放的是图片，实例分割相关
</code></pre> 
<h5><a id="1Annotations_19"></a>（1）Annotations</h5> 
<p><img src="https://images2.imgbox.com/dd/5b/WMes7Afu_o.png" alt="在这里插入图片描述"><br> Annotations文件夹中存放的是xml格式的标签文件，每一个xml文件都对应于JPEGImages文件夹中的一张图片，包含了图片的重要信息：<strong>图片的名称，图片中object的类别及其bounding box坐标</strong>。xml文件的解析如下：<br> 其中：</p> 
<table><thead><tr><th>标签</th><th>解释</th></tr></thead><tbody><tr><td>filename</td><td>文件名</td></tr><tr><td>source</td><td>图像来源（不重要）</td></tr><tr><td>size</td><td>图像尺寸（长宽以及通道），包含了width，height和depth</td></tr><tr><td>segmented</td><td>是否用于分割</td></tr><tr><td>object</td><td>需检测到的物体，包含了物体名称name，拍摄角度pose，是否截断truncated，难以识别difficult，object对应的bounding box信息 bndbox</td></tr><tr><td>bndbox</td><td>包含左下角和右上角x，y坐标 （xmin，ymin，xmax，ymax）</td></tr></tbody></table> 
<pre><code>&lt;annotation&gt;
	&lt;folder&gt;VOC2007&lt;/folder&gt;
	&lt;filename&gt;000051.jpg&lt;/filename&gt;
	&lt;source&gt;
		&lt;database&gt;The VOC2007 Database&lt;/database&gt;
		&lt;annotation&gt;PASCAL VOC2007&lt;/annotation&gt;
		&lt;image&gt;flickr&lt;/image&gt;
		&lt;flickrid&gt;291539949&lt;/flickrid&gt;
	&lt;/source&gt;
	&lt;owner&gt;
		&lt;flickrid&gt;kristian_svensson&lt;/flickrid&gt;
		&lt;name&gt;Kristian Svensson&lt;/name&gt;
	&lt;/owner&gt;
	&lt;size&gt;
		&lt;width&gt;500&lt;/width&gt;
		&lt;height&gt;375&lt;/height&gt;
		&lt;depth&gt;3&lt;/depth&gt;
	&lt;/size&gt;
	&lt;segmented&gt;0&lt;/segmented&gt;
	&lt;object&gt;
		&lt;name&gt;motorbike&lt;/name&gt;
		&lt;pose&gt;Unspecified&lt;/pose&gt;
		&lt;truncated&gt;1&lt;/truncated&gt;
		&lt;difficult&gt;0&lt;/difficult&gt;
		&lt;bndbox&gt;
			&lt;xmin&gt;352&lt;/xmin&gt;
			&lt;ymin&gt;138&lt;/ymin&gt;
			&lt;xmax&gt;500&lt;/xmax&gt;
			&lt;ymax&gt;375&lt;/ymax&gt;
		&lt;/bndbox&gt;
	&lt;/object&gt;
	&lt;object&gt;
		&lt;name&gt;motorbike&lt;/name&gt;
		&lt;pose&gt;Unspecified&lt;/pose&gt;
		&lt;truncated&gt;0&lt;/truncated&gt;
		&lt;difficult&gt;0&lt;/difficult&gt;
		&lt;bndbox&gt;
			&lt;xmin&gt;105&lt;/xmin&gt;
			&lt;ymin&gt;1&lt;/ymin&gt;
			&lt;xmax&gt;427&lt;/xmax&gt;
			&lt;ymax&gt;245&lt;/ymax&gt;
		&lt;/bndbox&gt;
	&lt;/object&gt;
	&lt;object&gt;
		&lt;name&gt;person&lt;/name&gt;
		&lt;pose&gt;Unspecified&lt;/pose&gt;
		&lt;truncated&gt;0&lt;/truncated&gt;
		&lt;difficult&gt;1&lt;/difficult&gt;
		&lt;bndbox&gt;
			&lt;xmin&gt;415&lt;/xmin&gt;
			&lt;ymin&gt;61&lt;/ymin&gt;
			&lt;xmax&gt;465&lt;/xmax&gt;
			&lt;ymax&gt;195&lt;/ymax&gt;
		&lt;/bndbox&gt;
	&lt;/object&gt;
&lt;/annotation&gt;

</code></pre> 
<p>以下程序可以将XML标签中目标绘制在图像中，并返回：<br> 具体步骤为：<br> 1.用xml.etree.ElementTree库中的parse方法解析xml文件；<br> 2.获取xml文件的根节点<br> 3.寻找object节点用find() 和findall()， .text表示获取节点中的内容<br> 4.cv2绘图，rectangle画框，putTEXT标注类别</p> 
<pre><code># -*- coding: utf-8 -*-
import xml.etree.ElementTree as ET  
import os,cv2
 
xml_file='Annotations/000282.xml'
tree=ET.parse(xml_file)
root=tree.getroot()
imgfile='JPEGImages/000282.jpg'
im = cv2.imread(imgfile)
for object in root.findall('object'):
    object_name=object.find('name').text
    Xmin=int(object.find('bndbox').find('xmin').text)
    Ymin=int(object.find('bndbox').find('ymin').text)
    Xmax=int(object.find('bndbox').find('xmax').text)
    Ymax=int(object.find('bndbox').find('ymax').text)
    color = (4, 250, 7)
    cv2.rectangle(im,(Xmin,Ymin),(Xmax,Ymax),color,2)
    font = cv2.FONT_HERSHEY_SIMPLEX  
    cv2.putText(im, object_name, (Xmin,Ymin - 7), font, 0.5, (6, 230, 230), 2)
    cv2.imshow('01',im)
#cv2.imwrite('02.jpg', im)
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/95/GqTtUgEO_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="JPEGImages_120"></a>JPEGImages</h5> 
<p>存放的是数据集的原图片，像素尺寸大小不一<br> <img src="https://images2.imgbox.com/7d/7a/D3fYjRND_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="ImageSets_124"></a>ImageSets</h5> 
<p>ImageSets存放的是每一种计算机视觉任务类型所对应的文件夹，各个文件夹均存放txt格式文件，txt中记录图片名：</p> 
<table><thead><tr><th>文件夹</th><th>数据信息</th></tr></thead><tbody><tr><td>Layout</td><td>具有人体部位的数据</td></tr><tr><td>Main</td><td>一般存放图像物体识别的数据</td></tr><tr><td>Segmentation</td><td>用于语义，实例分割的数据</td></tr></tbody></table> 
<p>目标检测主要用到Main文件夹中的txt文件（训练自己的数据时，我们需要自己生成）：</p> 
<table><thead><tr><th>Main中的txt文件</th><th>用途</th></tr></thead><tbody><tr><td>train</td><td>训练使用的图片名称（无后缀）</td></tr><tr><td>val</td><td>验证使用的图片名称（无后缀）</td></tr><tr><td>trainval</td><td>以上两者的合并</td></tr><tr><td>test</td><td>测试使用的图片名称（无后缀）</td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/b0/b9/k0DgFDMD_o.png" alt="在这里插入图片描述"><br> 以下代码可以通过统计Annotations文件夹里xml文件的数目划分各类数据集</p> 
<pre><code>import os
import random

path='D:/VOCtrainval_06-Nov-2007/yoloV3conf\keras-yolo3-master/VOCdevkit/VOC2007/'

trainval_percent = 0.66
train_percent = 0.5

xmlfilepath = path+'Annotations'
txtsavepath = path+'ImageSets/Main'
total_xml = os.listdir(xmlfilepath)
 
num=len(total_xml)
list=range(num)
tv=int(num*trainval_percent)
tr=int(tv*train_percent)
trainval= random.sample(list,tv)
train=random.sample(trainval,tr)
 
ftrainval = open(path+'ImageSets/Main/trainval.txt', 'w')
ftest = open(path+'ImageSets/Main/test.txt', 'w')
ftrain = open(path+'ImageSets/Main/train.txt', 'w')
fval = open(path+'ImageSets/Main/val.txt', 'w')
 
for i  in list:
    name=total_xml[i][:-4]+'\n'
    if i in trainval:
        ftrainval.write(name)
        if i in train:
            ftrain.write(name)
        else:
            fval.write(name)
    else:
        ftest.write(name)
 
ftrainval.close()
ftrain.close()
fval.close()
ftest .close()

</code></pre> 
<h3><a id="1_184"></a>1.安装标注工具</h3> 
<p>数据标注工具labelImg，可以通过可视化的操作界面进行画框标注，就能自动生成VOC格式的xml文件，该工具是基于Python语言编写的，这样就支持在Windows、Linux的跨平台运行，Windows和Linux下载地址为：<a href="https://tzutalin.github.io/labelImg/" rel="nofollow">https://tzutalin.github.io/labelImg/</a><br> <img src="https://images2.imgbox.com/51/f5/ZXiow3lx_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_188"></a>2.创建文件夹</h3> 
<p>按照VOC数据集的要求，创建以下文件夹<br> （1）<strong>Annotations</strong>：用于存放标注后的xml文件<br> （2）<strong>ImageSets/Main</strong>：用于存放训练集、测试集、验收集的文件列表<br> （3）<strong>JPEGImages</strong>：用于存放原始图像<br> <img src="https://images2.imgbox.com/61/7b/gM9iccgb_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_194"></a>3.标注数据</h3> 
<p>将源图片集放在JPEGImages文件夹里面，注意图片的格式必须是jpg格式的。<br> 打开labelImg标注工具，然后点击左侧的工具栏“<strong>Open Dir</strong>”按钮，选择刚才放猫的JPEGImages文件夹。这时，主界面将会自动加载第一张猫照片。<br> <img src="https://images2.imgbox.com/cf/d8/2k4GzbXF_o.png" alt="在这里插入图片描述"><br> 点击左侧工具栏的“<strong>Create RectBox</strong>”按钮，然后在主界面上点击拉个矩形框，将猫圈出来。圈定后，将会弹出一个对话框，用于<strong>输入标注物体的类别</strong>，这里输入cat作为object类别。</p> 
<p>然后点击左侧工具栏的“<strong>Save</strong>”按钮，选择刚才创建的Annotations作为保存目录，系统将自动生成VOC2007格式的xml文件保存起来。这样就完成了一张猫照片的物体标注了。<br> <img src="https://images2.imgbox.com/ec/c4/ZsKDZmL8_o.png" alt="在这里插入图片描述"><br> 接下来点击左侧工具栏的“<strong>Next Image</strong>”进入下一张图像，按照以上步骤，画框、输入名称、保存，如此反复，直到把所有照片都标注好，保存起来。</p> 
<p>这样就完成了数据集的准备</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6fc605fd8a7b579daa1547a05efefd83/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue：Elements in iteration expect to have &#39;v-bind:key&#39; directives的解决办法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c1791895a3870e542e56a55ae7e19509/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">凯斯西储大学轴承数据处理&#43;自制CNN数据集</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>