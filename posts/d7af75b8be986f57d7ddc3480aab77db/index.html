<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€Flink SQLã€‘Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆå››ï¼‰ï¼šSQL çš„æ—¶é—´å±æ€§ - ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ã€Flink SQLã€‘Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆå››ï¼‰ï¼šSQL çš„æ—¶é—´å±æ€§" />
<meta property="og:description" content="ã€ŠFlink SQL åŸºç¡€æ¦‚å¿µã€‹ç³»åˆ—ï¼Œå…±åŒ…å«ä»¥ä¸‹ 5 ç¯‡æ–‡ç« ï¼š
Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆä¸€ï¼‰ï¼šSQL &amp; Table è¿è¡Œç¯å¢ƒã€åŸºæœ¬æ¦‚å¿µåŠå¸¸ç”¨ APIFlink SQL åŸºç¡€æ¦‚å¿µï¼ˆäºŒï¼‰ï¼šæ•°æ®ç±»å‹Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆä¸‰ï¼‰ï¼šSQL åŠ¨æ€è¡¨ &amp; è¿ç»­æŸ¥è¯¢Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆå››ï¼‰ï¼šSQL çš„æ—¶é—´å±æ€§Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆäº”ï¼‰ï¼šSQL æ—¶åŒºé—®é¢˜ ğŸ˜Š å¦‚æœæ‚¨è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ç”¨ âœ”ï¸ çš„è¯ï¼Œè¯·ç»™åšä¸»ä¸€ä¸ªä¸€é”®ä¸‰è¿ ğŸš€ğŸš€ğŸš€ å§ ï¼ˆç‚¹èµ ğŸ§¡ã€å…³æ³¨ ğŸ’›ã€æ”¶è— ğŸ’šï¼‰ï¼ï¼ï¼æ‚¨çš„æ”¯æŒ ğŸ’–ğŸ’–ğŸ’– å°†æ¿€åŠ± ğŸ”¥ åšä¸»è¾“å‡ºæ›´å¤šä¼˜è´¨å†…å®¹ï¼ï¼ï¼
Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆå››ï¼‰ï¼šSQL çš„æ—¶é—´å±æ€§ 1.Flink ä¸‰ç§æ—¶é—´å±æ€§ç®€ä»‹2.Flink ä¸‰ç§æ—¶é—´å±æ€§çš„åº”ç”¨åœºæ™¯2.1 äº‹ä»¶æ—¶é—´æ¡ˆä¾‹2.2 å¤„ç†æ—¶é—´æ¡ˆä¾‹2.3 æ‘„å…¥æ—¶é—´æ¡ˆä¾‹ 3.SQL æŒ‡å®šæ—¶é—´å±æ€§çš„ä¸¤ç§æ–¹å¼4.SQL äº‹ä»¶æ—¶é—´æ¡ˆä¾‹5.SQL å¤„ç†æ—¶é—´æ¡ˆä¾‹ ä¸ç¦»çº¿å¤„ç†ä¸­å¸¸è§çš„æ—¶é—´åˆ†åŒºå­—æ®µä¸€æ ·ï¼Œåœ¨å®æ—¶å¤„ç†ä¸­ï¼Œæ—¶é—´å±æ€§ä¹Ÿæ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚Flink æ”¯æŒ å¤„ç†æ—¶é—´ã€äº‹ä»¶æ—¶é—´ã€æ‘„å…¥æ—¶é—´ ä¸‰ç§æ—¶é—´è¯­ä¹‰ã€‚
ä¸‰ç§æ—¶é—´åœ¨ç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨é¢‘æ¬¡ äº‹ä»¶æ—¶é—´ï¼ˆSQL å¸¸ç”¨ï¼‰ &gt; &gt; &gt; å¤„ç†æ—¶é—´ï¼ˆSQL å‡ ä¹ä¸ç”¨ï¼ŒDataStream å°‘ç”¨ï¼‰ &gt; &gt; &gt; æ‘„å…¥æ—¶é—´ï¼ˆä¸ç”¨ï¼‰ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/d7af75b8be986f57d7ddc3480aab77db/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-16T00:25:53+08:00" />
<meta property="article:modified_time" content="2024-03-16T00:25:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€Flink SQLã€‘Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆå››ï¼‰ï¼šSQL çš„æ—¶é—´å±æ€§</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>ã€Š<font color="#e47542"><strong>Flink SQL åŸºç¡€æ¦‚å¿µ</strong></font>ã€‹ç³»åˆ—ï¼Œå…±åŒ…å«ä»¥ä¸‹ 5 ç¯‡æ–‡ç« ï¼š</p> 
<ul><li><a href="https://blog.csdn.net/Be_racle/article/details/136637091">Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆä¸€ï¼‰ï¼šSQL &amp; Table è¿è¡Œç¯å¢ƒã€åŸºæœ¬æ¦‚å¿µåŠå¸¸ç”¨ API</a></li><li><a href="https://blog.csdn.net/Be_racle/article/details/136634313">Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆäºŒï¼‰ï¼šæ•°æ®ç±»å‹</a></li><li><a href="https://blog.csdn.net/Be_racle/article/details/136666759">Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆä¸‰ï¼‰ï¼šSQL åŠ¨æ€è¡¨ &amp; è¿ç»­æŸ¥è¯¢</a></li><li><a href="https://blog.csdn.net/Be_racle/article/details/136720727">Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆå››ï¼‰ï¼šSQL çš„æ—¶é—´å±æ€§</a></li><li><a href="https://blog.csdn.net/Be_racle/article/details/136723893">Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆäº”ï¼‰ï¼šSQL æ—¶åŒºé—®é¢˜</a></li></ul> 
<blockquote> 
 <p>ğŸ˜Š å¦‚æœæ‚¨è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ç”¨ âœ”ï¸ çš„è¯ï¼Œè¯·ç»™åšä¸»ä¸€ä¸ªä¸€é”®ä¸‰è¿ ğŸš€ğŸš€ğŸš€ å§ ï¼ˆç‚¹èµ ğŸ§¡ã€å…³æ³¨ ğŸ’›ã€æ”¶è— ğŸ’šï¼‰ï¼ï¼ï¼æ‚¨çš„æ”¯æŒ ğŸ’–ğŸ’–ğŸ’– å°†æ¿€åŠ± ğŸ”¥ åšä¸»è¾“å‡ºæ›´å¤šä¼˜è´¨å†…å®¹ï¼ï¼ï¼</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4> 
  <center>
    Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆå››ï¼‰ï¼šSQL çš„æ—¶é—´å±æ€§ 
  </center></h4> 
 <ul><li><a href="#1Flink__14" rel="nofollow">1.Flink ä¸‰ç§æ—¶é—´å±æ€§ç®€ä»‹</a></li><li><a href="#2Flink__22" rel="nofollow">2.Flink ä¸‰ç§æ—¶é—´å±æ€§çš„åº”ç”¨åœºæ™¯</a></li><li><ul><li><a href="#21__32" rel="nofollow">2.1 äº‹ä»¶æ—¶é—´æ¡ˆä¾‹</a></li><li><a href="#22__41" rel="nofollow">2.2 å¤„ç†æ—¶é—´æ¡ˆä¾‹</a></li><li><a href="#23__47" rel="nofollow">2.3 æ‘„å…¥æ—¶é—´æ¡ˆä¾‹</a></li></ul> 
  </li><li><a href="#3SQL__49" rel="nofollow">3.SQL æŒ‡å®šæ—¶é—´å±æ€§çš„ä¸¤ç§æ–¹å¼</a></li><li><a href="#4SQL__59" rel="nofollow">4.SQL äº‹ä»¶æ—¶é—´æ¡ˆä¾‹</a></li><li><a href="#5SQL__184" rel="nofollow">5.SQL å¤„ç†æ—¶é—´æ¡ˆä¾‹</a></li></ul> 
</div> 
<p></p> 
<p>ä¸ç¦»çº¿å¤„ç†ä¸­å¸¸è§çš„æ—¶é—´åˆ†åŒºå­—æ®µä¸€æ ·ï¼Œåœ¨å®æ—¶å¤„ç†ä¸­ï¼Œæ—¶é—´å±æ€§ä¹Ÿæ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚Flink æ”¯æŒ <font color="#e47542"><strong>å¤„ç†æ—¶é—´</strong></font>ã€<font color="#e47542"><strong>äº‹ä»¶æ—¶é—´</strong></font>ã€<font color="#e47542"><strong>æ‘„å…¥æ—¶é—´</strong></font> ä¸‰ç§æ—¶é—´è¯­ä¹‰ã€‚</p> 
<p>ä¸‰ç§æ—¶é—´åœ¨ç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨é¢‘æ¬¡ <font color="#e47542"><strong>äº‹ä»¶æ—¶é—´</strong></font>ï¼ˆSQL å¸¸ç”¨ï¼‰<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         &gt; 
        
       
      
        &gt; 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mrel">&gt;</span></span></span></span></span> <font color="#e47542"><strong>å¤„ç†æ—¶é—´</strong></font>ï¼ˆSQL å‡ ä¹ä¸ç”¨ï¼ŒDataStream å°‘ç”¨ï¼‰<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         &gt; 
        
       
      
        &gt; 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mrel">&gt;</span></span></span></span></span> <font color="#e47542"><strong>æ‘„å…¥æ—¶é—´</strong></font>ï¼ˆä¸ç”¨ï¼‰ã€‚</p> 
<h2><a id="1Flink__14"></a>1.Flink ä¸‰ç§æ—¶é—´å±æ€§ç®€ä»‹</h2> 
<ul><li><font color="#e47542"><strong>äº‹ä»¶æ—¶é—´</strong></font>ï¼šæŒ‡çš„æ˜¯æ•°æ®æœ¬èº«æºå¸¦çš„æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯åœ¨äº‹ä»¶äº§ç”Ÿæ—¶çš„æ—¶é—´ï¼Œè€Œä¸”åœ¨ Flink SQL è§¦å‘è®¡ç®—æ—¶ï¼Œä¹Ÿä½¿ç”¨æ•°æ®æœ¬èº«æºå¸¦çš„æ—¶é—´ã€‚è¿™å°±å«åšäº‹ä»¶æ—¶é—´ã€‚ç›®å‰ç”Ÿäº§ç¯å¢ƒä¸­ç”¨çš„æœ€å¤šã€‚</li><li><font color="#e47542"><strong>å¤„ç†æ—¶é—´</strong></font>ï¼šæŒ‡çš„æ˜¯å…·ä½“ç®—å­è®¡ç®—æ•°æ®æ‰§è¡Œæ—¶çš„æœºå™¨æ—¶é—´ï¼ˆä¾‹å¦‚åœ¨ç®—å­ä¸­ Java å– <code>System.currentTimeMillis()</code>ï¼‰ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”¨çš„æ¬¡å¤šã€‚</li><li><font color="#e47542"><strong>æ‘„å…¥æ—¶é—´</strong></font>ï¼šæŒ‡çš„æ˜¯æ•°æ®ä»æ•°æ®æºè¿›å…¥ Flink çš„æ—¶é—´ã€‚æ‘„å…¥æ—¶é—´ç”¨çš„æœ€å°‘ï¼Œå¯ä»¥è¯´åŸºæœ¬ä¸ä½¿ç”¨ã€‚</li></ul> 
<p>å°ä¼™ä¼´ä»¬è¦æ³¨æ„åˆ°ï¼š</p> 
<ul><li>ä¸Šè¿°çš„ä¸‰ç§æ—¶é—´æ¦‚å¿µä¸æ˜¯ç”±äºæœ‰äº†æ•°æ®è€Œè¯ç”Ÿçš„ï¼Œè€Œæ˜¯æœ‰äº† Flink ä¹‹åæ ¹æ®å®é™…çš„åº”ç”¨åœºæ™¯è€Œè¯ç”Ÿçš„ã€‚ä»¥äº‹ä»¶æ—¶é—´ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœåªæ˜¯æ•°æ®æºå¸¦äº†æ—¶é—´ï¼ŒFlink ä¹Ÿæ¶ˆè´¹äº†è¿™ä¸ªæ•°æ®ï¼Œä½†æ˜¯åœ¨ Flink ä¸­æ²¡æœ‰ä½¿ç”¨æ•°æ®çš„è¿™ä¸ªæ—¶é—´ä½œä¸ºè®¡ç®—çš„è§¦å‘æ¡ä»¶ï¼Œä¹Ÿä¸èƒ½æŠŠè¿™ä¸ª Flink ä»»åŠ¡å«åšäº‹ä»¶æ—¶é—´çš„ä»»åŠ¡ã€‚</li><li>å…¶æ¬¡ï¼Œè¦è®¤è¯†åˆ°ï¼Œä¸€èˆ¬ä¸€ä¸ª Flink ä»»åŠ¡åªä¼šæœ‰ä¸€ä¸ªæ—¶é—´å±æ€§ï¼Œæ‰€ä»¥æ—¶é—´å±æ€§é€šå¸¸è®¤ä¸ºæ˜¯ä¸€ä¸ªä»»åŠ¡ç²’åº¦çš„ã€‚ä¸¾ä¾‹ï¼šæˆ‘ä»¬å¯ä»¥è¯´ A ä»»åŠ¡æ˜¯äº‹ä»¶æ—¶é—´è¯­ä¹‰çš„ä»»åŠ¡ï¼ŒB ä»»åŠ¡æ˜¯å¤„ç†æ—¶é—´è¯­ä¹‰çš„ä»»åŠ¡ã€‚å½“ç„¶äº†ï¼Œä¸€ä¸ªä»»åŠ¡ä¹Ÿå¯ä»¥å­˜åœ¨å¤šä¸ªæ—¶é—´å±æ€§ã€‚</li></ul> 
<h2><a id="2Flink__22"></a>2.Flink ä¸‰ç§æ—¶é—´å±æ€§çš„åº”ç”¨åœºæ™¯</h2> 
<p>è®²åˆ°è¿™é‡Œï¼Œæœ‰äººä¼šé—®ï¼Œåšä¸»ä¸Šé¢å†™çš„ 3 ç§æ—¶é—´å±æ€§åˆ°åº•å¯¹æˆ‘ä»¬çš„ä»»åŠ¡æœ‰å•¥å½±å“å‘¢ï¼Ÿ3 ç§æ—¶é—´å±æ€§çš„åº”ç”¨åœºæ™¯æ˜¯å•¥ï¼Ÿ</p> 
<p>å…ˆè¯´ç»“è®ºï¼Œåœ¨ Flink ä¸­æ—¶é—´çš„ä½œç”¨ï¼š</p> 
<ul><li>ä¸»è¦ä½“ç°åœ¨åŒ…å«æ—¶é—´çª—å£çš„è®¡ç®—ä¸­ï¼šç”¨äºæ ‡è¯†ä»»åŠ¡çš„æ—¶é—´è¿›åº¦ï¼Œæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è§¦å‘çª—å£çš„è®¡ç®—ã€‚æ¯”å¦‚å¸¸ç”¨çš„æ»šåŠ¨çª—å£ã€æ»‘åŠ¨çª—å£ç­‰éƒ½éœ€è¦æ—¶é—´æ¨åŠ¨è§¦å‘ã€‚è¿™äº›çª—å£çš„åº”ç”¨åœºæ™¯åç»­ä¼šè¯¦ç»†ä»‹ç»ã€‚</li><li>æ¬¡è¦ä½“ç°åœ¨è‡ªå®šä¹‰æ—¶é—´è¯­ä¹‰çš„è®¡ç®—ä¸­ï¼šä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æ¯éš” 10s çš„æœ¬åœ°æ—¶é—´ï¼Œæˆ–è€…æ¶ˆè´¹åˆ°çš„æ•°æ®çš„æ—¶é—´æˆ³æ¯å¢å¤§ 10sï¼Œå°±æŠŠè®¡ç®—ç»“æœè¾“å‡ºä¸€æ¬¡ï¼Œæ—¶é—´åœ¨æ­¤ç±»åº”ç”¨ä¸­ä¹Ÿæ˜¯ä¸€ç§æ ‡è¯†ä»»åŠ¡è¿›åº¦çš„ä½œç”¨ã€‚</li></ul> 
<p>åšä¸»ä»¥ <font color="#e47542"><strong>æ»šåŠ¨çª—å£</strong></font> çš„èšåˆä»»åŠ¡ä¸ºä¾‹æ¥ä»‹ç»ä¸€ä¸‹äº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´çš„å¯¹æ¯”åŒºåˆ«ã€‚</p> 
<h3><a id="21__32"></a>2.1 äº‹ä»¶æ—¶é—´æ¡ˆä¾‹</h3> 
<p>è¿˜æ˜¯ä»¥ä¹‹å‰çš„ <code>clicks</code> è¡¨æ‹¿æ¥ä¸¾ä¾‹ã€‚</p> 
<p><img src="https://images2.imgbox.com/8f/31/lb4Ot2jI_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ä¸Šé¢è¿™ä¸ªæ¡ˆä¾‹çš„çª—å£å¤§å°æ˜¯ 1 å°æ—¶ï¼Œéœ€æ±‚æ–¹éœ€è¦æŒ‰ç…§ç”¨æˆ·ç‚¹å‡»æ—¶é—´æˆ³ <code>cTime</code> åˆ’åˆ†æ•°æ®ï¼ˆåˆ’åˆ†æ»šåŠ¨çª—å£ï¼‰ï¼Œç„¶åè®¡ç®—å‡º Count èšåˆç»“æœï¼ˆè¿™æ ·è®¡ç®—èƒ½åæ˜ å‡ºäº‹ä»¶çš„çœŸå®å‘ç”Ÿæ—¶é—´ï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠ <code>cTime</code> è®¾ç½®ä¸ºçª—å£çš„åˆ’åˆ†æ—¶é—´æˆ³ï¼Œå³ä»£ç ä¸­ <code>tumble(cTime, interval '1' hour)</code>ã€‚</p> 
<p>ä¸Šé¢è¿™ç§å°±å«åšäº‹ä»¶æ—¶é—´ã€‚å³ç”¨æ•°æ®ä¸­è‡ªå¸¦çš„æ—¶é—´æˆ³è¿›è¡Œçª—å£çš„åˆ’åˆ†ï¼ˆç‚¹å‡»æ“ä½œçœŸå®çš„å‘ç”Ÿæ—¶é—´ï¼‰ã€‚</p> 
<p>åç»­ Flink SQL ä»»åŠ¡åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šå®é™…æŒ‰ç…§ <code>cTime</code> çš„å½“å‰æ—¶é—´ä½œä¸ºä¸€å°æ—¶çª—å£ç»“æŸè§¦å‘æ¡ä»¶å¹¶è®¡ç®—ä¸€ä¸ªå°æ—¶çª—å£å†…çš„æ•°æ®ã€‚</p> 
<h3><a id="22__41"></a>2.2 å¤„ç†æ—¶é—´æ¡ˆä¾‹</h3> 
<p>è¿˜æ˜¯ä»¥ä¹‹å‰çš„ <code>clicks</code> è¡¨æ‹¿æ¥ä¸¾ä¾‹ã€‚</p> 
<p>è¿˜æ˜¯ä¸Šé¢é‚£ä¸ªæ¡ˆä¾‹ï¼Œä½†æ˜¯è¿™æ¬¡éœ€æ±‚æ–¹ä¸éœ€è¦æŒ‰ç…§æ•°æ®ä¸Šçš„æ—¶é—´æˆ³åˆ’åˆ†æ•°æ®ï¼ˆåˆ’åˆ†æ»šåŠ¨çª—å£ï¼‰ï¼Œåªéœ€è¦æ•°æ®æ¥äº†ä¹‹åï¼Œ åœ¨ Flink æœºå™¨ä¸Šçš„æ—¶é—´ä½œä¸ºä¸€å°æ—¶çª—å£ç»“æŸçš„è§¦å‘æ¡ä»¶å¹¶è®¡ç®—ã€‚</p> 
<p>é‚£ä¹ˆè¿™ç§è§¦å‘æœºåˆ¶å°±æ˜¯å¤„ç†æ—¶é—´ã€‚</p> 
<h3><a id="23__47"></a>2.3 æ‘„å…¥æ—¶é—´æ¡ˆä¾‹</h3> 
<p>åœ¨ Flink ä»å¤–éƒ¨æ•°æ®æºè¯»å–åˆ°æ•°æ®æ—¶ï¼Œç»™è¿™æ¡æ•°æ®å¸¦ä¸Šçš„å½“å‰æ•°æ®æºç®—å­çš„æœ¬åœ°æ—¶é—´æˆ³ã€‚ä¸‹æ¸¸å¯ä»¥ç”¨è¿™ä¸ªæ—¶é—´æˆ³è¿›è¡Œçª—å£èšåˆï¼Œä¸è¿‡è¿™ç§å‡ ä¹ä¸ä½¿ç”¨ã€‚</p> 
<h2><a id="3SQL__49"></a>3.SQL æŒ‡å®šæ—¶é—´å±æ€§çš„ä¸¤ç§æ–¹å¼</h2> 
<p>å¦‚æœè¦æ»¡è¶³ Flink SQL æ—¶é—´çª—å£ç±»çš„èšåˆæ“ä½œï¼ŒSQL æˆ– Table API ä¸­çš„ <font color="#e47542"><strong>æ•°æ®æºè¡¨</strong></font> å°±éœ€è¦æä¾›æ—¶é—´å±æ€§ï¼ˆç›¸å½“äºæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶é—´å±æ€§åœ¨ <font color="#e47542"><strong>æ•°æ®æºè¡¨</strong></font> ä¸Šé¢è¿›è¡Œå£°æ˜ï¼‰ï¼Œä»¥åŠæ”¯æŒæ—¶é—´ç›¸å…³çš„æ“ä½œã€‚</p> 
<p>é‚£ä¹ˆæ¥çœ‹çœ‹ Flink SQL ä¸ºæˆ‘ä»¬æä¾›çš„ä¸¤ç§æŒ‡å®šæ—¶é—´æˆ³çš„æ–¹å¼ï¼š</p> 
<ul><li><code>CREATE TABLE DDL</code> åˆ›å»ºè¡¨çš„æ—¶å€™æŒ‡å®š</li><li>å¯ä»¥åœ¨ <code>DataStream</code> ä¸­æŒ‡å®šï¼Œåœ¨åç»­çš„ DataStream è½¬çš„ Table ä¸­ä½¿ç”¨</li></ul> 
<p>ä¸€æ—¦æ—¶é—´å±æ€§å®šä¹‰å¥½ï¼Œå®ƒå°±å¯ä»¥åƒæ™®é€šåˆ—ä¸€æ ·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨æ—¶é—´ç›¸å…³çš„æ“ä½œä¸­ä½¿ç”¨ã€‚</p> 
<h2><a id="4SQL__59"></a>4.SQL äº‹ä»¶æ—¶é—´æ¡ˆä¾‹</h2> 
<p>æ¥çœ‹çœ‹ Flink ä¸­å¦‚ä½•æŒ‡å®šäº‹ä»¶æ—¶é—´ã€‚</p> 
<ul><li><code>CREATE TABLE DDL</code> æŒ‡å®šæ—¶é—´æˆ³çš„æ–¹å¼ã€‚</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_actions <span class="token punctuation">(</span>
  user_name STRING<span class="token punctuation">,</span>
  <span class="token keyword">data</span> STRING<span class="token punctuation">,</span>
  user_action_time <span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">-- ä½¿ç”¨ä¸‹é¢è¿™å¥æ¥å°† user_action_time å£°æ˜ä¸ºäº‹ä»¶æ—¶é—´ï¼Œå¹¶ä¸”å£°æ˜ watermark çš„ç”Ÿæˆè§„åˆ™ï¼Œå³ user_action_time å‡ 5 ç§’</span>
  <span class="token comment">-- äº‹ä»¶æ—¶é—´åˆ—çš„å­—æ®µç±»å‹å¿…é¡»æ˜¯ TIMESTAMP æˆ–è€… TIMESTAMP_LTZ ç±»å‹</span>
  WATERMARK <span class="token keyword">FOR</span> user_action_time <span class="token keyword">AS</span> user_action_time <span class="token operator">-</span> <span class="token keyword">INTERVAL</span> <span class="token string">'5'</span> <span class="token keyword">SECOND</span>
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> TUMBLE_START<span class="token punctuation">(</span>user_action_time<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'10'</span> <span class="token keyword">MINUTE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> user_name<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> user_actions
<span class="token comment">-- ç„¶åå°±å¯ä»¥åœ¨çª—å£ç®—å­ä¸­ä½¿ç”¨ user_action_time</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TUMBLE<span class="token punctuation">(</span>user_action_time<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'10'</span> <span class="token keyword">MINUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>ä»ä¸Šé¢è¿™æ¡è¯­å¥å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæƒ³ä½¿ç”¨äº‹ä»¶æ—¶é—´ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ—¶é—´æˆ³ç±»å‹å¿…é¡»æ˜¯ <code>TIMESTAMP</code> æˆ–è€… <code>TIMESTAMP_LTZ</code> ç±»å‹ã€‚å¾ˆå¤šå°ä¼™ä¼´ä¼šæƒ³åˆ°ï¼Œæˆ‘ä»¬çš„æ—¶é—´æˆ³ä¸€èˆ¬ä¸éƒ½æ˜¯ç§’æˆ–è€…æ˜¯æ¯«ç§’ï¼ˆ<code>BIGINT</code> ç±»å‹ï¼‰å˜›ï¼Œé‚£è¿™ç§æƒ…å†µæ€ä¹ˆåŠï¼Ÿ</p> 
<p>è§£å†³æ–¹æ¡ˆå¿…é¡»è¦æœ‰å•Šï¼Œå¦‚ä¸‹ã€‚</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_actions <span class="token punctuation">(</span>
  user_name STRING<span class="token punctuation">,</span>
  <span class="token keyword">data</span> STRING<span class="token punctuation">,</span>
  <span class="token comment">-- 1. è¿™ä¸ª ts å°±æ˜¯å¸¸è§çš„æ¯«ç§’çº§åˆ«æ—¶é—´æˆ³</span>
  ts <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  <span class="token comment">-- 2. å°†æ¯«ç§’æ—¶é—´æˆ³è½¬æ¢æˆ TIMESTAMP_LTZ ç±»å‹</span>
  time_ltz <span class="token keyword">AS</span> TO_TIMESTAMP_LTZ<span class="token punctuation">(</span>ts<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">-- 3. ä½¿ç”¨ä¸‹é¢è¿™å¥æ¥å°† user_action_time å£°æ˜ä¸ºäº‹ä»¶æ—¶é—´ï¼Œå¹¶ä¸”å£°æ˜ watermark çš„ç”Ÿæˆè§„åˆ™ï¼Œå³ user_action_time å‡ 5 ç§’</span>
  <span class="token comment">-- äº‹ä»¶æ—¶é—´åˆ—çš„å­—æ®µç±»å‹å¿…é¡»æ˜¯ TIMESTAMP æˆ–è€… TIMESTAMP_LTZ ç±»å‹</span>
  WATERMARK <span class="token keyword">FOR</span> time_ltz <span class="token keyword">AS</span> time_ltz <span class="token operator">-</span> <span class="token keyword">INTERVAL</span> <span class="token string">'5'</span> <span class="token keyword">SECOND</span>
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> TUMBLE_START<span class="token punctuation">(</span>time_ltz<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'10'</span> <span class="token keyword">MINUTE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> user_name<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> user_actions
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TUMBLE<span class="token punctuation">(</span>time_ltz<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'10'</span> <span class="token keyword">MINUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>DataStream ä¸­æŒ‡å®šäº‹ä»¶æ—¶é—´ã€‚</li></ul> 
<p>ä¹‹å‰ä»‹ç»äº† <code>Table</code> å’Œ <code>DataStream</code> å¯ä»¥äº’è½¬ï¼Œé‚£ä¹ˆ Flink ä¹Ÿæä¾›äº†ä¸€ä¸ªèƒ½åŠ›ï¼Œå°±æ˜¯åœ¨ <code>Table</code> è½¬ä¸º <code>DataStream</code> æ—¶ï¼ŒæŒ‡å®šæ—¶é—´æˆ³å­—æ®µã€‚å¦‚ä¸‹æ¡ˆä¾‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataStreamSourceEventTimeTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span>
                <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">createLocalEnvironmentWithWebUI</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">EnvironmentSettings</span> settings <span class="token operator">=</span> <span class="token class-name">EnvironmentSettings</span>
                <span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">useBlinkPlanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">inStreamingMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">StreamTableEnvironment</span> tEnv <span class="token operator">=</span> <span class="token class-name">StreamTableEnvironment</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 1. åˆ†é… watermark</span>
        <span class="token class-name">DataStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserDefinedSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">assignTimestampsAndWatermarks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BoundedOutOfOrdernessTimestampExtractor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Time</span><span class="token punctuation">.</span><span class="token function">minutes</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">extractTimestamp</span><span class="token punctuation">(</span><span class="token class-name">Row</span> element<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> element<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token string">"f2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. ä½¿ç”¨ f2.rowtime çš„æ–¹å¼å°† f2 å­—æ®µæŒ‡ä¸ºäº‹ä»¶æ—¶é—´æ—¶é—´æˆ³</span>
        <span class="token class-name">Table</span> sourceTable <span class="token operator">=</span> tEnv<span class="token punctuation">.</span><span class="token function">fromDataStream</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">"f0, f1, f2.rowtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        tEnv<span class="token punctuation">.</span><span class="token function">createTemporaryView</span><span class="token punctuation">(</span><span class="token string">"source_table"</span><span class="token punctuation">,</span> sourceTable<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. åœ¨ tumble window ä¸­ä½¿ç”¨ f2</span>
        <span class="token class-name">String</span> tumbleWindowSql <span class="token operator">=</span>
                <span class="token string">"SELECT TUMBLE_START(f2, INTERVAL '5' SECOND), COUNT(DISTINCT f0)\n"</span>
                <span class="token operator">+</span> <span class="token string">"FROM source_table\n"</span>
                <span class="token operator">+</span> <span class="token string">"GROUP BY TUMBLE(f2, INTERVAL '5' SECOND)"</span>
                <span class="token punctuation">;</span>

        <span class="token class-name">Table</span> resultTable <span class="token operator">=</span> tEnv<span class="token punctuation">.</span><span class="token function">sqlQuery</span><span class="token punctuation">(</span>tumbleWindowSql<span class="token punctuation">)</span><span class="token punctuation">;</span>

        tEnv<span class="token punctuation">.</span><span class="token function">toDataStream</span><span class="token punctuation">(</span>resultTable<span class="token punctuation">,</span> <span class="token class-name">Row</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UserDefinedSource</span> <span class="token keyword">implements</span> <span class="token class-name">SourceFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">ResultTypeQueryable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> isCancel<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SourceContext</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span> sourceContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isCancel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

                sourceContext<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Row</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isCancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">TypeInformation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span> <span class="token function">getProducedType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RowTypeInfo</span><span class="token punctuation">(</span><span class="token class-name">TypeInformation</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TypeInformation</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">TypeInformation</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="5SQL__184"></a>5.SQL å¤„ç†æ—¶é—´æ¡ˆä¾‹</h2> 
<p>æ¥çœ‹çœ‹ Flink SQL ä¸­å¦‚ä½•æŒ‡å®šå¤„ç†æ—¶é—´ã€‚</p> 
<ul><li><code>CREATE TABLE DDL</code> æŒ‡å®šæ—¶é—´æˆ³çš„æ–¹å¼ã€‚</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_actions <span class="token punctuation">(</span>
  user_name STRING<span class="token punctuation">,</span>
  <span class="token keyword">data</span> STRING<span class="token punctuation">,</span>
  <span class="token comment">-- ä½¿ç”¨ä¸‹é¢è¿™å¥æ¥å°† user_action_time å£°æ˜ä¸ºå¤„ç†æ—¶é—´</span>
  user_action_time <span class="token keyword">AS</span> PROCTIME<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> TUMBLE_START<span class="token punctuation">(</span>user_action_time<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'10'</span> <span class="token keyword">MINUTE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> user_name<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> user_actions
<span class="token comment">-- ç„¶åå°±å¯ä»¥åœ¨çª—å£ç®—å­ä¸­ä½¿ç”¨ user_action_time</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TUMBLE<span class="token punctuation">(</span>user_action_time<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'10'</span> <span class="token keyword">MINUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>DataStream ä¸­æŒ‡å®šå¤„ç†æ—¶é—´ã€‚</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataStreamSourceProcessingTimeTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span>
                <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">createLocalEnvironmentWithWebUI</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">EnvironmentSettings</span> settings <span class="token operator">=</span> <span class="token class-name">EnvironmentSettings</span>
                <span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">useBlinkPlanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">inStreamingMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">StreamTableEnvironment</span> tEnv <span class="token operator">=</span> <span class="token class-name">StreamTableEnvironment</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> settings<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 1. åˆ†é… watermark</span>
        <span class="token class-name">DataStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserDefinedSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. ä½¿ç”¨ proctime.proctime çš„æ–¹å¼å°† f2 å­—æ®µæŒ‡ä¸ºå¤„ç†æ—¶é—´æ—¶é—´æˆ³</span>
        <span class="token class-name">Table</span> sourceTable <span class="token operator">=</span> tEnv<span class="token punctuation">.</span><span class="token function">fromDataStream</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">"f0, f1, f2, proctime.proctime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        tEnv<span class="token punctuation">.</span><span class="token function">createTemporaryView</span><span class="token punctuation">(</span><span class="token string">"source_table"</span><span class="token punctuation">,</span> sourceTable<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. åœ¨ tumble window ä¸­ä½¿ç”¨ f2</span>
        <span class="token class-name">String</span> tumbleWindowSql <span class="token operator">=</span>
                <span class="token string">"SELECT TUMBLE_START(proctime, INTERVAL '5' SECOND), COUNT(DISTINCT f0)\n"</span>
                <span class="token operator">+</span> <span class="token string">"FROM source_table\n"</span>
                <span class="token operator">+</span> <span class="token string">"GROUP BY TUMBLE(proctime, INTERVAL '5' SECOND)"</span>
                <span class="token punctuation">;</span>

        <span class="token class-name">Table</span> resultTable <span class="token operator">=</span> tEnv<span class="token punctuation">.</span><span class="token function">sqlQuery</span><span class="token punctuation">(</span>tumbleWindowSql<span class="token punctuation">)</span><span class="token punctuation">;</span>

        tEnv<span class="token punctuation">.</span><span class="token function">toDataStream</span><span class="token punctuation">(</span>resultTable<span class="token punctuation">,</span> <span class="token class-name">Row</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UserDefinedSource</span> <span class="token keyword">implements</span> <span class="token class-name">SourceFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">ResultTypeQueryable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> isCancel<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SourceContext</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span> sourceContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isCancel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

                sourceContext<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Row</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isCancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">TypeInformation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span> <span class="token function">getProducedType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RowTypeInfo</span><span class="token punctuation">(</span><span class="token class-name">TypeInformation</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TypeInformation</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">TypeInformation</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2b2bad30209e33064f977531b7683fd1/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">åº”ç”¨å±‚_HTTP&amp;HTTPS</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/333ef06f139d4129b7b905bf7a095ff4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ã€Flink SQLã€‘Flink SQL åŸºç¡€æ¦‚å¿µï¼ˆä¸‰ï¼‰ï¼šSQL åŠ¨æ€è¡¨ &amp; è¿ç»­æŸ¥è¯¢</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>