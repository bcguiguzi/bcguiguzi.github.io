<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenCV_01基本操作 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenCV_01基本操作" />
<meta property="og:description" content="前言：总纲请查看《计算机视觉学习路》
环境配置： 新建requirements.txt，保存以下内容，然后执行命令创建虚拟环境
conda create --name py39-opencv --file requirements.txt
然后就可以在pycharm配置该环境进行编译
# This file may be used to create an environment using: # $ conda create --name &lt;env&gt; --file &lt;this file&gt; # platform: linux-64 _libgcc_mutex=0.1=conda_forge _openmp_mutex=4.5=2_gnu bzip2=1.0.8=h7f98852_4 ca-certificates=2022.5.18.1=ha878542_0 cvzone=1.5.6=pypi_0 cycler=0.11.0=pypi_0 evdev=1.5.0=pypi_0 fonttools=4.33.3=pypi_0 kiwisolver=1.4.2=pypi_0 ld_impl_linux-64=2.36.1=hea4e1c9_2 libffi=3.4.2=h7f98852_5 libgcc-ng=12.1.0=h8d9b700_16 libgomp=12.1.0=h8d9b700_16 libnsl=2.0.0=h7f98852_0 libuuid=2.32.1=h7f98852_1000 libzlib=1.2.11=h166bdaf_1014 matplotlib=3.5.2=pypi_0 ncurses=6.3=h27087fc_1 numpy=1.22.4=pypi_0 opencv-python=4.5.5.64=pypi_0 openssl=3.0.3=h166bdaf_0 packaging=21.3=pypi_0 pillow=9.1.1=pypi_0 pip=22.1.1=pyhd8ed1ab_0 pynput=1.7.6=pypi_0 pyparsing=3.0.9=pypi_0 python=3.9.12=h2660328_1_cpython python-dateutil=2.8.2=pypi_0 python-xlib=0.31=pypi_0 python_abi=3.9=2_cp39 readline=8.1=h46c0cb4_0 setuptools=62.3.2=py39hf3d152e_0 six=1.16.0=pypi_0 sqlite=3.38.5=h4ff8645_0 tk=8.6.12=h27826a3_0 tzdata=2022a=h191b570_0 wheel=0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/8f860f482e2ba82720e001baac0cc4c4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-01T11:25:18+08:00" />
<meta property="article:modified_time" content="2022-06-01T11:25:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenCV_01基本操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p><span style="color:#fe2c24;"> 前言</span>：总纲请查看<a href="https://blog.csdn.net/weixin_45231460/article/details/122439214" title="《计算机视觉学习路》">《计算机视觉学习路》</a></p> 
</blockquote> 
<h2>环境配置：</h2> 
<blockquote> 
 <p>新建requirements.txt，保存以下内容，然后执行命令创建虚拟环境</p> 
 <p><span style="color:#fe2c24;">conda create --name py39-opencv --file requirements.txt</span></p> 
 <p><span style="color:#0d0016;">然后就可以在pycharm配置该环境进行编译</span></p> 
</blockquote> 
<pre><code># This file may be used to create an environment using:
# $ conda create --name &lt;env&gt; --file &lt;this file&gt;
# platform: linux-64
_libgcc_mutex=0.1=conda_forge
_openmp_mutex=4.5=2_gnu
bzip2=1.0.8=h7f98852_4
ca-certificates=2022.5.18.1=ha878542_0
cvzone=1.5.6=pypi_0
cycler=0.11.0=pypi_0
evdev=1.5.0=pypi_0
fonttools=4.33.3=pypi_0
kiwisolver=1.4.2=pypi_0
ld_impl_linux-64=2.36.1=hea4e1c9_2
libffi=3.4.2=h7f98852_5
libgcc-ng=12.1.0=h8d9b700_16
libgomp=12.1.0=h8d9b700_16
libnsl=2.0.0=h7f98852_0
libuuid=2.32.1=h7f98852_1000
libzlib=1.2.11=h166bdaf_1014
matplotlib=3.5.2=pypi_0
ncurses=6.3=h27087fc_1
numpy=1.22.4=pypi_0
opencv-python=4.5.5.64=pypi_0
openssl=3.0.3=h166bdaf_0
packaging=21.3=pypi_0
pillow=9.1.1=pypi_0
pip=22.1.1=pyhd8ed1ab_0
pynput=1.7.6=pypi_0
pyparsing=3.0.9=pypi_0
python=3.9.12=h2660328_1_cpython
python-dateutil=2.8.2=pypi_0
python-xlib=0.31=pypi_0
python_abi=3.9=2_cp39
readline=8.1=h46c0cb4_0
setuptools=62.3.2=py39hf3d152e_0
six=1.16.0=pypi_0
sqlite=3.38.5=h4ff8645_0
tk=8.6.12=h27826a3_0
tzdata=2022a=h191b570_0
wheel=0.37.1=pyhd8ed1ab_0
xz=5.2.5=h516909a_1
zlib=1.2.11=h166bdaf_1014</code></pre> 
<h2>1.创建窗口</h2> 
<blockquote> 
 <p>使用Opencv的前提肯定是导入库啦</p> 
 <p>import cv2</p> 
</blockquote> 
<h3>1.窗口格式</h3> 
<blockquote> 
 <p>创建一个名为new和new2的窗口：</p> 
 <p>cv2.nameWindow('new',cv2.WINDOW_AUTOSIZE) # 窗口<span style="color:#fe2c24;">不可以</span>用鼠标进行拉伸</p> 
 <p>cv2.nameWindow('new2',cv2.WINDOW_NORMAL)   #  窗口<span style="color:#fe2c24;">可以</span>用鼠标进行拉伸</p> 
 <p>cv2.imshow('new',0)   #用于显示new窗口</p> 
 <p>cv2.imshow('new2',0)  # 用于显示new2窗口</p> 
</blockquote> 
<p></p> 
<p class="img-center"><img alt="" height="383" src="https://images2.imgbox.com/5b/56/MLJC9tvj_o.png" width="826"></p> 
<p></p> 
<h3>2.窗口停留和销毁</h3> 
<p>在进行imshow的时候，为了让窗口停留（即在桌面显示） ，我们可以通过cv2.waitkey(<span style="color:#fe2c24;">毫秒数</span>)函数，例如，让窗口停留一秒:</p> 
<blockquote> 
 <p>cv2.waitkey(1000)</p> 
</blockquote> 
<p>同时我们可以从键盘接收一个<span style="color:#fe2c24;">值</span>，当输入该值的时候，窗口才消失：</p> 
<blockquote> 
 <p>key=cv2.waitkey(0)   # 这里填0,即一直等待</p> 
 <p>while True:</p> 
 <p>        if key==113:   # 这里本来应该写if key == 'q'，但是我这里输入q的时候，key的值为int类型的113</p> 
 <p>                break</p> 
</blockquote> 
<p>在程序的最后我们需要销毁窗口：</p> 
<blockquote> 
 <p>cv2.destroyALLWindows() </p> 
</blockquote> 
<h3>3.设置窗口大小</h3> 
<blockquote> 
 <p>cv2.resizeWindow('new',640,480)  # 括号内的参数为：窗口名字，宽，高</p> 
</blockquote> 
<h3>4. 整体代码</h3> 
<pre><code class="language-python">import cv2

# 创建窗口
cv2.namedWindow('new', cv2.WINDOW_AUTOSIZE)
cv2.namedWindow('new2',cv2.WINDOW_NORMAL)
cv2.resizeWindow('new',640,480)
cv2.resizeWindow('new2',480,640)
cv2.imshow('new', 0)  # 显示框口
cv2.imshow('new2', 0)  # 显示框口

while True:
    # 不断接收键盘按键
    key = cv2.waitKey(0)  # 接收键盘事件，如果输入q，则退出
    if key == 113:  # 按键q
        print("退出")
        break
cv2.destroyAllWindows()</code></pre> 
<h2> 2.加载图片</h2> 
<blockquote> 
 <p>cv2.imread(路径, flags) </p> 
 <p>flags=0 : 读入<span style="color:#fe2c24;">灰色</span>图片</p> 
 <p>flags=1:  读入<span style="color:#fe2c24;">彩色</span>图片，BGR通道（忽略alpha通道）</p> 
 <p>flags=-1:  读入<span style="color:#fe2c24;">原</span>图片，包括alpah通道</p> 
 <p>flag也可以不写，<span style="color:#4da8ee;">默认flags=1</span></p> 
</blockquote> 
<pre><code class="language-python">import cv2

cv2.namedWindow('img', cv2.WINDOW_NORMAL)
img = cv2.imread('img/ex01.jpg',0)  #读入灰色通道图片

cv2.imshow('img', img)

key = cv2.waitKey(0)
if key == 'q':
    exit()

cv2.destroyAllWindows()</code></pre> 
<p class="img-center"><img alt="" height="706" src="https://images2.imgbox.com/ec/d4/fwC16WY6_o.png" width="1099"></p> 
<p> 如果flags不写，来看一下：</p> 
<blockquote> 
 <p>img = cv2.imread('img/ex01.jpg') </p> 
</blockquote> 
<p class="img-center"><img alt="" height="570" src="https://images2.imgbox.com/9b/ca/46l1kyyQ_o.png" width="754"></p> 
<h2>3.保存图片</h2> 
<blockquote> 
 <p>imwrite(name , img)</p> 
 <p>name:要保存的文件名</p> 
 <p>img:是Mat类型</p> 
</blockquote> 
<p>下面判断，当键盘输入x的时候，保存图片为123.png </p> 
<pre><code class="language-python">import cv2

cv2.namedWindow('img', cv2.WINDOW_NORMAL)
img = cv2.imread('img/ex01.jpg')
cv2.imshow('img', img)
while True:
    key = cv2.waitKey(0)
    print('key=',key)
    print('type=',type(key))
    if key == 113:  # 按键q
        print("退出")
        break
    elif key == 120:  # 按键x
        print("保存")
        cv2.imwrite('img/123.png',img)
    else:
        print('other')
cv2.destroyAllWindows()</code></pre> 
<p><img alt="" height="102" src="https://images2.imgbox.com/9f/ef/Ka3JV5lg_o.png" width="326"> <img alt="" height="102" src="https://images2.imgbox.com/4d/fd/5j0cvcJx_o.png" width="363"><img alt="" height="102" src="https://images2.imgbox.com/75/c5/PoQqBuwP_o.png" width="344"></p> 
<h2> 4. 读取视频文件</h2> 
<blockquote> 
 <p><span style="color:#fe2c24;">cap = cv2.VideoCapture(path)</span></p> 
 <p><span style="color:#0d0016;">这个时候</span><span style="color:#fe2c24;">cv2.waitkey( )</span><span style="color:#0d0016;">里面的值就关系到视频播放速度的</span><span style="color:#fe2c24;">快慢</span><span style="color:#0d0016;">，例如，我的视频为15帧/s，那么每一帧停留的时间为</span><span style="color:#fe2c24;">1000/15=66ms</span></p> 
</blockquote> 
<p><img alt="" height="250" src="https://images2.imgbox.com/b6/2a/6mQsBTkV_o.png" width="565"> <img alt="" height="250" src="https://images2.imgbox.com/da/7c/QF7ZWx5g_o.png" width="304"></p> 
<pre><code class="language-python">import cv2

cv2.namedWindow('video',cv2.WINDOW_NORMAL)
cv2.resizeWindow('video',640,480)

# 从视频文件读取视频帧
cap = cv2.VideoCapture('img/ex02.mp4')

while True:
    # 获取视频
    ret,frame = cap.read()
    cv2.imshow('video',frame)

    # 这里如果填0,则一直等待键盘事件，只能获取到一帧视频帧然后就停住了
    key = cv2.waitKey(66)
    if key == 113:
        break
# 释放资源
cap.release()
cv2.destroyAllWindows()</code></pre> 
<h2>5.从摄像头读取视频</h2> 
<blockquote> 
 <p>1.获取视频设备<br><span style="color:#fe2c24;">cap = cv2.VideoCapture(0) </span> # 0表示笔记本内置摄像头，1为外置摄像头，其他数字为其他设备</p> 
 <p>2.从摄像头获取视频帧<br><span style="color:#fe2c24;">ret,frame = cap.read()</span></p> 
 <p>read返回两个值，第一个为状态值，读到帧为True，第二个为视频帧</p> 
 <p>3.释放资源的操作为：</p> 
 <p><span style="color:#fe2c24;">cap.release()</span></p> 
</blockquote> 
<p>需要注意的是，想要将读取到的视频帧在窗口中显示出来，并且按q退出时，<span style="color:#fe2c24;">key = cv2.waitKey(1)，括号里不能填0</span>，可以填一个比较小的值。否则程序会一直等待键盘事件，这样一来就只能获取一帧图片，然后就卡住了。具体代码如下：</p> 
<pre><code class="language-python">import cv2

cv2.namedWindow('video',cv2.WINDOW_NORMAL)
cv2.resizeWindow('video',640,480)

# 获取视频设备
cap = cv2.VideoCapture(0)

while True:
    # 获取视频
    ret,frame = cap.read()
    cv2.imshow('video',frame)

    # 这里如果填0,则一直等待键盘事件，只能获取到一帧视频帧然后就停住了
    key = cv2.waitKey(1)
    if key == 113:
        break
# 释放资源
cap.release()
cv2.destroyAllWindows()</code></pre> 
<h2> 6.视频录制保存</h2> 
<blockquote> 
 <p>1.创建VieeoWriter</p> 
 <p><span style="color:#fe2c24;">cv2.VideoWriter( ) </span> # 参数：输出文件、int fourcc多媒体文件格式、帧率、分辨率（应复合摄像头参数）、颜色（默认True,彩色，填False则为灰色）</p> 
 <p><span style="color:#fe2c24;">fourcc = cv2.VideoWriter_fourcc(*'MJPG')  </span><span style="color:#0d0016;"># 多媒体文件格式 </span> </p> 
 <p>2.写入数据</p> 
 <p><span style="color:#fe2c24;">v2.write(获取到的视频帧)</span></p> 
 <p>3.释放资源：release( )</p> 
 <p>注：这里录好的视频是没有声音的，因为Opencv是处理图像的</p> 
</blockquote> 
<p>这里对摄像头是否开启做了判断，并且对是否读到了视频帧也作了判断。 </p> 
<pre><code class="language-python">import cv2

# 创建VideoWriter为多媒体文件
fourcc = cv2.VideoWriter_fourcc(*'MJPG')
vw = cv2.VideoWriter('img/out.mp4', fourcc, 25, (1920, 1080))

cv2.namedWindow('video', cv2.WINDOW_NORMAL)
cv2.resizeWindow('video', 1920, 1080)

cap = cv2.VideoCapture(0)

while cap.isOpened():  # 判断摄像头是否打开
    ret, frame = cap.read()
    if ret:  # 判断是否为True，读到一帧显示一帧，如果为False，则不显示
        cv2.imshow('video', frame)
        vw.write(frame)  # 写数据到多媒体文件

        key = cv2.waitKey(1)
        if key == 113:
            break
    else:
        break

cap.release()
vw.release()
cv2.destroyAllWindows()
</code></pre> 
<p> <img alt="" height="150" src="https://images2.imgbox.com/12/67/xPgU9Q5d_o.png" width="271"></p> 
<h2> 7.鼠标控制</h2> 
<blockquote> 
 <p>1.自定义回调函数，即鼠标进行操作后需要执行的命令</p> 
 <p><span style="color:#fe2c24;">callback(event x,y,flags,userdata) </span> #  事件（鼠标移动，单击..） ， 鼠标所在位置 ， flags用于组合键</p> 
 <p>2.设置回调函数</p> 
 <p><span style="color:#fe2c24;">cv2.setMouseCallback(窗口名字，callback, userdata) </span> # callback,用户自定义的逻辑函数   userdata是给callback的参数，默认为None</p> 
</blockquote> 
<div class="img-center"> 
 <figure class="image"> 
  <img alt="" height="384" src="https://images2.imgbox.com/30/9c/0XTziSBL_o.png" width="806"> 
  <figcaption>
    event可选值 
  </figcaption> 
 </figure> 
</div> 
<div class="img-center"> 
 <figure class="image"> 
  <img alt="" height="233" src="https://images2.imgbox.com/c5/fd/A89oYVhC_o.png" width="802"> 
  <figcaption>
    flags可选值 
  </figcaption> 
 </figure> 
</div> 
<p class="img-center"><img alt="" height="507" src="https://images2.imgbox.com/e1/71/bGTtMS6N_o.png" width="995"></p> 
<p> 完整代码为：</p> 
<pre><code class="language-python">import cv2
import numpy as np


# 定义鼠标回调函数
def mouse_callback(event, x, y, flags, userdata):
    print(event, x, y, flags, userdata)


# 创建窗口
cv2.namedWindow('mouse', cv2.WINDOW_NORMAL)
cv2.resizeWindow('mouse', 640, 480)

# 设置回调
cv2.setMouseCallback('mouse', mouse_callback, '调用回调函数')

# 利用numpy设置一个黑色的背景
img = np.zeros((480, 640, 3),np.uint8)
while True:
    cv2.imshow('mouse', img)
    key = cv2.waitKey(1)
    if key == 113:
        break

cv2.destroyAllWindows()
</code></pre> 
<h2> 8.滑块TrackBar操作</h2> 
<blockquote> 
 <p>cv2.createTrackbar(trackbarname , 窗口名, value:trackbar当前的值 , count:拖动值的范围是0-count , callback , userdata) </p> 
 <p>re = cv2.getTrackBarPos(trackbarname , 窗口名)  # 返回trackbar的当前值</p> 
</blockquote> 
<p>下面做显示一副黑色图片，根据RGB滑动条变化图片颜色，先看效果：</p> 
<p class="img-center"><img alt="" height="600" src="https://images2.imgbox.com/32/3c/94t236J6_o.png" width="696"></p> 
<pre><code class="language-python">import cv2
import numpy as np


def callback(a):
    pass


cv2.namedWindow('trackbar', cv2.WINDOW_NORMAL)

cv2.createTrackbar('R', 'trackbar', 0, 255, callback)
cv2.createTrackbar('G', 'trackbar', 0, 255, callback)
cv2.createTrackbar('B', 'trackbar', 0, 255, callback)

img = np.zeros((480, 640, 3),np.uint8)
while True:
    # 读取trackbar的值
    r = cv2.getTrackbarPos('R', 'trackbar')
    g = cv2.getTrackbarPos('G', 'trackbar')
    b = cv2.getTrackbarPos('B', 'trackbar')
    # 读取到r,g,b的值后对img进行操作
    img[:] = [b, g, r]  # 对img的所有像素赋值为刚才读取到的r,g,b值
    cv2.imshow('trackbar', img)
    key = cv2.waitKey(10)
    if key == 113:
        break

cv2.destroyAllWindows()
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/59fdf5dfe33c7b5a2c6070d6971aabac/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">hive建模和优化,impala刷新元数据和表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/31d8373eb59b890aae5f657f5218e478/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Go】FLV文件解析（一）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>