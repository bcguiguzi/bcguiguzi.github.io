<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ç”¨Java Socketæ‰‹æ’¸äº†ä¸€ä¸ªHTTPæœåŠ¡å™¨ - ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ç”¨Java Socketæ‰‹æ’¸äº†ä¸€ä¸ªHTTPæœåŠ¡å™¨" />
<meta property="og:description" content="ä½œä¸ºä¸€ä¸ª Java åç«¯ï¼Œæä¾› HTTP æœåŠ¡å¯ä»¥è¯´æ˜¯åŸºæœ¬æŠ€èƒ½ä¹‹ä¸€äº†ï¼Œä½†æ˜¯ä½ çœŸçš„äº†è§£ HTTP åè®®ä¹ˆï¼Ÿä½ çŸ¥é“çŸ¥é“å¦‚ä½•æ‰‹æ’¸ä¸€ä¸ª HTTP æœåŠ¡å™¨ä¹ˆï¼ŸTomcat çš„åº•å±‚æ˜¯æ€ä¹ˆæ”¯æŒ HTTP æœåŠ¡çš„å‘¢ï¼Ÿå¤§åé¼é¼çš„ Servlet åˆæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Œè¯¥æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿ
åœ¨åˆå­¦ Java æ—¶ï¼ŒSocket ç¼–ç¨‹æ˜¯é€ƒä¸æ‰çš„ä¸€ç« ï¼›è™½ç„¶åœ¨å®é™…ä¸šåŠ¡é¡¹ç›®ä¸­ï¼Œä½¿ç”¨è¿™ä¸ªçš„å¯èƒ½æ€§åŸºæœ¬ä¸º 0ï¼Œ ä½†å¹¶ä¸æ„å‘³ç€ä¸ç”¨å­¦ã€‚æœ¬ç¯‡å°†ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ Socket æ¥å®ç°ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œæä¾›å¸¸è§çš„ get/post è¯·æ±‚æ”¯æŒï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­äº†è§£ä¸‹ HTTP åè®®ã€‚
I. HTTP æœåŠ¡å™¨ä» 0 åˆ° 1 æ—¢ç„¶æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å€ŸåŠ© Socket æ¥æ­å»º HTTP æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®è®¤ä¸¤ç‚¹ï¼Œä¸€æ˜¯å¦‚ä½•ä½¿ç”¨ Socketï¼›å¦ä¸€ä¸ªåˆ™æ˜¯ HTTP åè®®å¦‚ä½•è§£ææ•°æ®ï¼›ä¸‹é¢åˆ†åˆ«è¿›è¡Œè¯´æ˜ã€‚
1. Socket ç¼–ç¨‹åŸºç¡€ æˆ‘ä»¬è¿™é‡Œä¸»è¦æ˜¯åˆ©ç”¨ ServerSocket æ¥ç»‘å®šç«¯å£ï¼Œæä¾› TCP æœåŠ¡ï¼ŒåŸºæœ¬ä½¿ç”¨å§¿åŠ¿ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬å¥—è·¯å¦‚ä¸‹
åˆ›å»º ServerSocket å¯¹è±¡ï¼Œç»‘å®šç›‘å¬ç«¯å£é€šè¿‡ accept() æ–¹æ³•ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥å»ºç«‹åï¼Œé€šè¿‡è¾“å…¥æµè¯»å–å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯é€šè¿‡è¾“å‡ºæµå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯å…³é—­ç›¸å…³èµ„æº
å¯¹åº”çš„ä¼ªä»£ç å¦‚ä¸‹: ServerSocket serverSocket = new ServerSocket(port, ip) serverSocket.accept(); // æ¥æ”¶è¯·æ±‚æ•°æ® socket.getInputStream(); // è¿”å›æ•°æ®ç»™è¯·æ±‚æ–¹ out = socket." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/6bf31e781791be5fc4915d1c9648ead1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-09T21:59:01+08:00" />
<meta property="article:modified_time" content="2024-03-09T21:59:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ç”¨Java Socketæ‰‹æ’¸äº†ä¸€ä¸ªHTTPæœåŠ¡å™¨</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>ä½œä¸ºä¸€ä¸ª Java åç«¯ï¼Œæä¾› HTTP æœåŠ¡å¯ä»¥è¯´æ˜¯åŸºæœ¬æŠ€èƒ½ä¹‹ä¸€äº†ï¼Œä½†æ˜¯ä½ çœŸçš„äº†è§£ HTTP åè®®ä¹ˆï¼Ÿä½ çŸ¥é“çŸ¥é“å¦‚ä½•æ‰‹æ’¸ä¸€ä¸ª HTTP æœåŠ¡å™¨ä¹ˆï¼ŸTomcat çš„åº•å±‚æ˜¯æ€ä¹ˆæ”¯æŒ HTTP æœåŠ¡çš„å‘¢ï¼Ÿå¤§åé¼é¼çš„ Servlet åˆæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Œè¯¥æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿ</p> 
<p>åœ¨åˆå­¦ Java æ—¶ï¼ŒSocket ç¼–ç¨‹æ˜¯é€ƒä¸æ‰çš„ä¸€ç« ï¼›è™½ç„¶åœ¨å®é™…ä¸šåŠ¡é¡¹ç›®ä¸­ï¼Œä½¿ç”¨è¿™ä¸ªçš„å¯èƒ½æ€§åŸºæœ¬ä¸º 0ï¼Œ ä½†å¹¶ä¸æ„å‘³ç€ä¸ç”¨å­¦ã€‚æœ¬ç¯‡å°†ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ Socket æ¥å®ç°ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œæä¾›å¸¸è§çš„ get/post è¯·æ±‚æ”¯æŒï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­äº†è§£ä¸‹ HTTP åè®®ã€‚</p> 
<h2><a id="I_HTTP__0__1_4"></a>I. HTTP æœåŠ¡å™¨ä» 0 åˆ° 1</h2> 
<p>æ—¢ç„¶æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å€ŸåŠ© Socket æ¥æ­å»º HTTP æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®è®¤ä¸¤ç‚¹ï¼Œä¸€æ˜¯å¦‚ä½•ä½¿ç”¨ Socketï¼›å¦ä¸€ä¸ªåˆ™æ˜¯ HTTP åè®®å¦‚ä½•è§£ææ•°æ®ï¼›ä¸‹é¢åˆ†åˆ«è¿›è¡Œè¯´æ˜ã€‚</p> 
<h2><a id="1_Socket__7"></a>1. Socket ç¼–ç¨‹åŸºç¡€</h2> 
<p>æˆ‘ä»¬è¿™é‡Œä¸»è¦æ˜¯åˆ©ç”¨ ServerSocket æ¥ç»‘å®šç«¯å£ï¼Œæä¾› TCP æœåŠ¡ï¼ŒåŸºæœ¬ä½¿ç”¨å§¿åŠ¿ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬å¥—è·¯å¦‚ä¸‹</p> 
<ul><li>åˆ›å»º ServerSocket å¯¹è±¡ï¼Œç»‘å®šç›‘å¬ç«¯å£</li><li>é€šè¿‡ accept() æ–¹æ³•ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚</li><li>è¿æ¥å»ºç«‹åï¼Œé€šè¿‡è¾“å…¥æµè¯»å–å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯</li><li>é€šè¿‡è¾“å‡ºæµå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯</li><li>å…³é—­ç›¸å…³èµ„æº<br> å¯¹åº”çš„ä¼ªä»£ç å¦‚ä¸‹:</li></ul> 
<pre><code class="prism language-java"><span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> ip<span class="token punctuation">)</span>
serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ¥æ”¶è¯·æ±‚æ•°æ®</span>
socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¿”å›æ•°æ®ç»™è¯·æ±‚æ–¹</span>
out <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span>
out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token comment">// å…³é—­è¿æ¥</span>
socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>å…·ä½“çš„ä»£ç ï¼Œæˆ‘ä»¬å‰é¢çš„ç« èŠ‚è¯¦ç»†åœ°è®²è¿‡äº†ï¼Œç¬¬ä¸€æ¬¡æ¥çš„å°ä¼™ä¼´å¯ä»¥<a href="https://blog.csdn.net/zch981964/article/details/136591338">æˆ³é“¾æ¥</a>å»å­¦ä¹ ä¸€ä¸‹ã€‚</p> 
<h2><a id="2_HTTP__33"></a>2. HTTP åè®®</h2> 
<p>ServerSocket èµ°çš„æ˜¯ TCP åè®®ï¼ŒHTTP åè®®æœ¬èº«æ˜¯åœ¨ TCP åè®®ä¹‹ä¸Šçš„ä¸€å±‚ã€‚</p> 
<p>TCP æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚åè®®ã€‚TCP åœ¨ä¸¤ä¸ªç½‘ç»œèŠ‚ç‚¹ä¹‹é—´æä¾›äº†ä¸€æ¡å¯é çš„é€šä¿¡ä¿¡é“ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šä¸¢å¤±ã€é‡å¤æˆ–ä¹±åºã€‚TCP ä½¿ç”¨æ¡æ‰‹è¿‡ç¨‹å»ºç«‹è¿æ¥ï¼Œé€šè¿‡ç¡®è®¤å’Œé‡ä¼ æœºåˆ¶ç¡®ä¿æ•°æ®å¯é ä¼ è¾“ï¼Œå¹¶ä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ç®—æ³•æ¥ä¼˜åŒ–ç½‘ç»œæ€§èƒ½ã€‚</p> 
<p>HTTP æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Web æµè§ˆå™¨å’Œ Web æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“è¶…æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘å’Œå…¶ä»–åª’ä½“èµ„æºçš„åº”ç”¨å±‚åè®®ã€‚HTTP ä½¿ç”¨è¯·æ±‚-å“åº”æ¨¡å‹ï¼Œå³å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯ Web æµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚HTTP åè®®å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼ˆå¦‚ GETã€POSTã€PUTã€DELETE ç­‰ï¼‰ï¼Œç”¨äºæŒ‡å®šè¯·æ±‚çš„ç±»å‹å’Œç›®çš„ã€‚æ­¤å¤–ï¼ŒHTTP åè®®è¿˜å®šä¹‰äº†ä¸€ç»„çŠ¶æ€ä»£ç ï¼ˆå¦‚ 200ã€404ã€500 ç­‰ï¼‰ï¼Œç”¨äºè¡¨ç¤ºå“åº”çš„ç»“æœã€‚</p> 
<p>HTTP åè®®ä¾èµ–äº TCP åè®®æ¥ä¼ è¾“æ•°æ®ã€‚å½“ Web æµè§ˆå™¨å‘ Web æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä½¿ç”¨ TCP åè®®ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚ä¸€æ—¦è¿æ¥å»ºç«‹ï¼ŒHTTP è¯·æ±‚æ¶ˆæ¯ä¼šè¢«å°è£…åœ¨ TCP æ•°æ®åŒ…ä¸­ï¼Œç„¶åé€šè¿‡ TCP ä¿¡é“å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ”¶åˆ° TCP æ•°æ®åŒ…åï¼Œè§£åŒ…æå– HTTP è¯·æ±‚æ¶ˆæ¯ï¼Œå¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆ HTTP å“åº”æ¶ˆæ¯ã€‚æœ€åï¼ŒHTTP å“åº”æ¶ˆæ¯è¢«å°è£…åœ¨ TCP æ•°æ®åŒ…ä¸­ï¼Œå¹¶é€šè¿‡ç›¸åŒçš„ TCP ä¿¡é“å‘é€å›å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ° TCP æ•°æ®åŒ…åï¼Œè§£åŒ…æå– HTTP å“åº”æ¶ˆæ¯å¹¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚<br> <img src="https://images2.imgbox.com/48/d5/2QpRoh9Z_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> è¿™å¹…å›¾å±•ç¤ºäº†å®¢æˆ·ç«¯ï¼ˆWeb æµè§ˆå™¨ï¼‰ä¸æœåŠ¡å™¨ï¼ˆWeb æœåŠ¡å™¨ï¼‰ä¹‹é—´çš„ HTTP è¯·æ±‚å’Œå“åº”ï¼Œå®ƒä»¬é€šè¿‡å¯é çš„ã€é¢å‘è¿æ¥çš„ TCP è¿æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p> 
<p>å¥½ï¼Œå†è¯´å› HTTP æœåŠ¡å™¨è¿™ä»¶äº‹ï¼Œæœ€éœ€è¦å…³æ³¨çš„æ— éä¸¤ç‚¹ï¼š</p> 
<p><strong>è¯·æ±‚æ¶ˆæ¯</strong></p> 
<p>HTTP è¯·æ±‚æ¶ˆæ¯ç”±è¯·æ±‚è¡Œï¼ˆRequest Lineï¼‰ã€è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰ã€ç©ºè¡Œï¼ˆEmpty Lineï¼‰ã€è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼Œå¯é€‰ï¼‰å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚</p> 
<p>â‘ ã€è¯·æ±‚è¡ŒåˆåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼ŒHTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ GET, POST, PUT, DELETE ç­‰ï¼‰ã€è¯·æ±‚çš„ç›®æ ‡ URLï¼ˆé€šå¸¸æ˜¯ç›¸å¯¹ URLï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹ URLï¼‰ã€HTTP ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ HTTP/1.1 æˆ– HTTP/2ï¼‰ï¼Œè¿™äº›éƒ¨åˆ†ç”¨ç©ºæ ¼åˆ†éš”ï¼Œä¾‹å¦‚ï¼š</p> 
<pre><code class="prism language-java"><span class="token constant">GET</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
</code></pre> 
<p>â‘¡ã€è¯·æ±‚å¤´æ˜¯ä¸€ç³»åˆ—ä»¥é”®å€¼å¯¹è¡¨ç¤ºçš„å…ƒæ•°æ®ï¼Œç”¨äºæè¿°è¯·æ±‚çš„é™„åŠ ä¿¡æ¯ã€‚æ¯ä¸ªè¯·æ±‚å¤´å ä¸€è¡Œï¼Œé”®å’Œå€¼ä¹‹é—´ç”¨å†’å·ï¼ˆ:ï¼‰åˆ†éš”ã€‚è¯·æ±‚å¤´åŒ…å«è¯¸å¦‚ Hostã€User-Agentã€Content-Typeã€Content-Lengthã€Accept ç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p> 
<pre><code class="prism language-java"><span class="token class-name">Host</span><span class="token operator">:</span> www<span class="token punctuation">.</span>tobebetterjavaer<span class="token punctuation">.</span>com
<span class="token class-name">User</span><span class="token operator">-</span><span class="token class-name">Agent</span><span class="token operator">:</span> <span class="token class-name">Mozilla</span><span class="token operator">/</span><span class="token number">5.0</span>
<span class="token class-name">Accept</span><span class="token operator">:</span> text<span class="token operator">/</span>html<span class="token punctuation">,</span>application<span class="token operator">/</span>xhtml<span class="token operator">+</span>xml<span class="token punctuation">,</span>application<span class="token operator">/</span>xml<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token comment">/*;q=0.8
</span></code></pre> 
<p>â‘¢ã€è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ä¹‹é—´æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œè¡¨ç¤ºè¯·æ±‚å¤´çš„ç»“æŸã€‚<br> â‘£ã€å¯¹äºæŸäº› HTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ POSTã€PUT ç­‰ï¼‰ï¼Œè¿˜å¯ä»¥åœ¨è¯·æ±‚æ¶ˆæ¯ä¸­åŒ…å«è¯·æ±‚ä½“ã€‚è¯·æ±‚ä½“ç”¨äºä¼ è¾“è¦å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ã€‚è¯·æ±‚ä½“çš„æ ¼å¼å’Œå†…å®¹å–å†³äº Content-Type è¯·æ±‚å¤´çš„å€¼ã€‚</p> 
<p>ä¾‹å¦‚ï¼Œå½“æäº¤ HTML è¡¨å•æ—¶ï¼Œè¯·æ±‚ä½“å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p> 
<pre><code>username=æ’äºŒå“¥&amp;password=123456
</code></pre> 
<p>å°†è¿™äº›éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œå°±æ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„ HTTP è¯·æ±‚æ¶ˆæ¯ï¼š</p> 
<pre><code class="prism language-java"><span class="token constant">POST</span> <span class="token operator">/</span>login <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
<span class="token class-name">Host</span><span class="token operator">:</span> <span class="token class-name">Host</span><span class="token operator">:</span> www<span class="token punctuation">.</span>tobebetterjavaer<span class="token punctuation">.</span>com
<span class="token class-name">User</span><span class="token operator">-</span><span class="token class-name">Agent</span><span class="token operator">:</span> <span class="token class-name">Mozilla</span><span class="token operator">/</span><span class="token number">5.0</span>
<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Type</span><span class="token operator">:</span> application<span class="token operator">/</span>x<span class="token operator">-</span>www<span class="token operator">-</span>form<span class="token operator">-</span>urlencoded
<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Length</span><span class="token operator">:</span> <span class="token number">29</span>
<span class="token class-name">Accept</span><span class="token operator">:</span> text<span class="token operator">/</span>html<span class="token punctuation">,</span>application<span class="token operator">/</span>xhtml<span class="token operator">+</span>xml<span class="token punctuation">,</span>application<span class="token operator">/</span>xml<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token comment">/*;q=0.8
username=æ’äºŒå“¥&amp;password=123456
</span></code></pre> 
<p><img src="https://images2.imgbox.com/1f/0f/BmzLZe8b_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>å“åº”æ¶ˆæ¯</strong></p> 
<p>ä¸€ä¸ªå…¸å‹çš„ HTTP å“åº”æ¶ˆæ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šçŠ¶æ€è¡Œï¼ˆStatus Lineï¼‰ã€å“åº”å¤´ï¼ˆResponse Headersï¼‰ã€å“åº”ä½“ï¼ˆResponse Bodyï¼‰ã€‚<br> <img src="https://images2.imgbox.com/b7/5d/ppIl5wyo_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ä¸Šé¢ä¸¤å¼ å›¾ï¼Œå¯ä»¥è®©ä½ å¯¹ HTTP è¯·æ±‚å’Œå“åº”æœ‰ä¸ªç›´è§‚æ˜ è±¡ï¼Œæ¥ä¸‹æ¥å¼€å§‹æŠ“é‡ç‚¹ã€‚<br> ä¸ç®¡æ˜¯è¯·æ±‚æ¶ˆæ¯è¿˜æ˜¯å“åº”æ¶ˆæ¯ï¼Œéƒ½å¯ä»¥åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œè¿™å°±ä¸ºæˆ‘ä»¬åé¢çš„å¤„ç†ç®€åŒ–äº†å¾ˆå¤šå·¥ä½œã€‚</p> 
<ul><li>ç¬¬ä¸€è¡Œï¼šçŠ¶æ€è¡Œ</li><li>ç¬¬äºŒè¡Œåˆ°ç¬¬ä¸€ä¸ªç©ºè¡Œï¼šheaderï¼ˆè¯·æ±‚å¤´/ç›¸åº”å¤´ï¼‰</li><li>å‰©ä¸‹æ‰€æœ‰ï¼šæ­£æ–‡</li></ul> 
<h2><a id="3_HTTP__94"></a>3. HTTP æœåŠ¡å™¨è®¾è®¡</h2> 
<p>æ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜ï¼ŒåŸºäº Socket åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½¿ç”¨ Socket åŸºæœ¬æ²¡å•¥å¤ªå¤§çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–å…³æ³¨ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p> 
<ul><li>å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œè§£æ</li><li>å°è£…è¿”å›ç»“æœ</li></ul> 
<h3><a id="a__100"></a>a. è¯·æ±‚æ•°æ®è§£æ</h3> 
<p>æ³¨æ„ğŸ“¢ï¼Œè¿™äº›ä»£ç æ”¾åœ¨ HttpMessageParser ç±»ä¸­ï¼Œéšåä¼šç»™å‡ºå®Œæ•´çš„ä»£ç ã€‚</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Request</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * è¯·æ±‚æ–¹æ³• GET/POST/PUT/DELETE/OPTION...
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> method<span class="token punctuation">;</span>
    <span class="token comment">/**
     * è¯·æ±‚çš„uri
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uri<span class="token punctuation">;</span>
    <span class="token comment">/**
     * HTTPç‰ˆæœ¬
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> version<span class="token punctuation">;</span>

    <span class="token comment">/**
     * è¯·æ±‚å¤´
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers<span class="token punctuation">;</span>

    <span class="token comment">/**
     * è¯·æ±‚å‚æ•°ç›¸å…³
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>æ ¹æ®å‰é¢çš„ HTTP åè®®ä»‹ç»ï¼Œè§£æè¿‡ç¨‹å¦‚ä¸‹ï¼Œæˆ‘ä»¬å…ˆçœ‹è¯·æ±‚è¡Œçš„è§£æè¿‡ç¨‹ã€‚</p> 
<p><strong>è¯·æ±‚è¡Œ</strong>ï¼ŒåŒ…å«ä¸‰ä¸ªåŸºæœ¬è¦ç´ ï¼šè¯·æ±‚æ–¹æ³• + URI + HTTP ç‰ˆæœ¬ï¼Œç”¨ç©ºæ ¼è¿›è¡Œåˆ†å‰²ï¼Œæ‰€ä»¥è§£æä»£ç å¦‚ä¸‹</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * æ ¹æ®æ ‡å‡†çš„HTTPåè®®ï¼Œè§£æè¯·æ±‚è¡Œ
 *
 * @param reader
 * @param request
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">decodeRequestLine</span><span class="token punctuation">(</span><span class="token class-name">BufferedReader</span> reader<span class="token punctuation">,</span> <span class="token class-name">Request</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> strs <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">assert</span> strs<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">setMethod</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">setUri</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">setVersion</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>**è¯·æ±‚å¤´çš„è§£æï¼Œ**ä»ç¬¬äºŒè¡Œï¼Œåˆ°ç¬¬ä¸€ä¸ªç©ºç™½è¡Œä¹‹é—´çš„æ‰€æœ‰æ•°æ®ï¼Œéƒ½æ˜¯è¯·æ±‚å¤´ï¼›è¯·æ±‚å¤´çš„æ ¼å¼ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œå½¢å¦‚ key:value, å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p> 
<p><strong>æœ€åå°±æ˜¯æ­£æ–‡çš„è§£æäº†</strong>ï¼Œè¿™ä¸€å—éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œæ­£æ–‡å¯èƒ½ä¸ºç©ºï¼Œä¹Ÿå¯èƒ½æœ‰æ•°æ®ï¼›æœ‰æ•°æ®æ—¶ï¼Œæˆ‘ä»¬è¦å¦‚ä½•æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½å–å‡ºæ¥å‘¢ï¼Ÿ</p> 
<p>å…ˆçœ‹å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * æ ¹æ®æ ‡æ³¨HTTPåè®®ï¼Œè§£ææ­£æ–‡
 *
 * @param reader    è¾“å…¥æµè¯»å–å™¨ï¼Œç”¨äºè¯»å–è¯·æ±‚ä¸­çš„æ•°æ®
 * @param request   Request å¯¹è±¡ï¼Œè¡¨ç¤º HTTP è¯·æ±‚
 * @throws IOException å½“å‘ç”Ÿ I/O é”™è¯¯æ—¶æŠ›å‡º
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">decodeRequestMessage</span><span class="token punctuation">(</span><span class="token class-name">BufferedReader</span> reader<span class="token punctuation">,</span> <span class="token class-name">Request</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ä»è¯·æ±‚å¤´ä¸­è·å– Content-Lengthï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤ä¸º 0</span>
    <span class="token keyword">int</span> contentLen <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å¦‚æœ Content-Length ä¸º 0ï¼Œè¡¨ç¤ºæ²¡æœ‰è¯·æ±‚æ­£æ–‡ï¼Œç›´æ¥è¿”å›ã€‚</span>
    <span class="token comment">// ä¾‹å¦‚ GET å’Œ OPTIONS è¯·æ±‚é€šå¸¸ä¸åŒ…å«è¯·æ±‚æ­£æ–‡</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>contentLen <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ ¹æ® Content-Length åˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„æ¥å­˜å‚¨è¯·æ±‚æ­£æ–‡</span>
    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>contentLen<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// ä½¿ç”¨ BufferedReader è¯»å–è¯·æ±‚æ­£æ–‡</span>
    reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å°†å­—ç¬¦æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º Request å¯¹è±¡çš„ message</span>
    request<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>æ³¨æ„ä¸Šé¢æˆ‘çš„ä½¿ç”¨å§¿åŠ¿ï¼Œé¦–å…ˆæ˜¯æ ¹æ®è¯·æ±‚å¤´ä¸­çš„Content-Typeçš„å€¼ï¼Œæ¥è·å¾—æ­£æ–‡çš„æ•°æ®å¤§å°ï¼Œå› æ­¤æˆ‘ä»¬è·å–çš„æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ªè¿™ä¹ˆå¤§çš„char[] æ•°ç»„æ¥è¯»å–æµä¸­æ‰€æœ‰æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°ç»„æ¯”å®é™…çš„å°ï¼Œåˆ™è¯»ä¸å®Œï¼›å¦‚æœå¤§ï¼Œåˆ™æ•°ç»„ä¸­ä¼šæœ‰ä¸€äº›ç©ºçš„æ•°æ®ï¼›</p> 
<p><strong>æœ€åå°†ä¸Šé¢çš„å‡ ä¸ªè§£æå°è£…ä¸€ä¸‹</strong>ï¼Œå®Œæˆ request è§£æï¼š</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * HTTP è¯·æ±‚å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š
 * 1. è¯·æ±‚è¡Œï¼šåŒ…æ‹¬è¯·æ±‚æ–¹æ³•ã€URI å’Œ HTTP åè®®ç‰ˆæœ¬
 * 2. è¯·æ±‚å¤´ï¼šä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œç›´åˆ°ä¸€ä¸ªç©ºè¡Œä¸ºæ­¢
 * 3. æ¶ˆæ¯æ­£æ–‡ï¼šç´§è·Ÿåœ¨ç©ºè¡Œåçš„æ‰€æœ‰å†…å®¹ï¼Œé•¿åº¦ç”±è¯·æ±‚å¤´ä¸­çš„ Content-Length å†³å®š
 *
 * æœ¬æ–¹æ³•å°† InputStream ä¸­çš„ HTTP è¯·æ±‚æ•°æ®è§£æä¸ºä¸€ä¸ª Request å¯¹è±¡
 *
 * @param reqStream  åŒ…å« HTTP è¯·æ±‚æ•°æ®çš„è¾“å…¥æµ
 * @return           ä¸€ä¸ªè¡¨ç¤º HTTP è¯·æ±‚çš„ Request å¯¹è±¡
 * @throws IOException å½“å‘ç”Ÿ I/O é”™è¯¯æ—¶æŠ›å‡º
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Request</span> <span class="token function">parse2request</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> reqStream<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ä½¿ç”¨ BufferedReader å’Œ InputStreamReader è¯»å–è¾“å…¥æµä¸­çš„æ•°æ®</span>
    <span class="token class-name">BufferedReader</span> httpReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>reqStream<span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Request å¯¹è±¡</span>
    <span class="token class-name">Request</span> httpRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è§£æè¯·æ±‚è¡Œå¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span>
    <span class="token function">decodeRequestLine</span><span class="token punctuation">(</span>httpReader<span class="token punctuation">,</span> httpRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è§£æè¯·æ±‚å¤´å¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span>
    <span class="token function">decodeRequestHeader</span><span class="token punctuation">(</span>httpReader<span class="token punctuation">,</span> httpRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è§£ææ¶ˆæ¯æ­£æ–‡å¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span>
    <span class="token function">decodeRequestMessage</span><span class="token punctuation">(</span>httpReader<span class="token punctuation">,</span> httpRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è¿”å›è§£æåçš„ Request å¯¹è±¡</span>
    <span class="token keyword">return</span> httpRequest<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>æ¥ä¸‹æ¥ï¼Œæ˜¯è¯·æ±‚ç»“æœçš„å°è£…ï¼Œç»™ä¸€ä¸ªç®€å•çš„è¿›è¡Œæ¼”ç¤ºï¼š</p> 
<pre><code class="prism language-java"><span class="token comment">/**
    * Response ç±»è¡¨ç¤ºä¸€ä¸ª HTTP å“åº”ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€ä¿¡æ¯ã€å“åº”å¤´å’Œå“åº”æ­£æ–‡ã€‚
    */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Response</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> version<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
    * æ ¹æ®ç»™å®šçš„ Request å¯¹è±¡å’Œå“åº”å­—ç¬¦ä¸²æ„å»ºä¸€ä¸ª HTTP å“åº”ã€‚
    *
    * @param request   ç”¨äºæ„å»ºå“åº”çš„ Request å¯¹è±¡
    * @param response  å“åº”å­—ç¬¦ä¸²
    * @return          ä¸€ä¸ªè¡¨ç¤º HTTP å“åº”çš„å­—ç¬¦ä¸²
    */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">buildResponse</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Response å¯¹è±¡ï¼Œå¹¶è®¾ç½®ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯</span>
    <span class="token class-name">Response</span> httpResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpResponse<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpResponse<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpResponse<span class="token punctuation">.</span><span class="token function">setVersion</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½®å“åº”å¤´</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpResponse<span class="token punctuation">.</span><span class="token function">setHeaders</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½®å“åº”æ­£æ–‡</span>
    httpResponse<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ„å»ºå“åº”å­—ç¬¦ä¸²</span>
    <span class="token class-name">StringBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">buildResponseLine</span><span class="token punctuation">(</span>httpResponse<span class="token punctuation">,</span> builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">buildResponseHeaders</span><span class="token punctuation">(</span>httpResponse<span class="token punctuation">,</span> builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">buildResponseMessage</span><span class="token punctuation">(</span>httpResponse<span class="token punctuation">,</span> builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
    * æ„å»ºå“åº”è¡Œï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯ã€‚
    *
    * @param response      ç”¨äºæ„å»ºå“åº”è¡Œçš„ Response å¯¹è±¡
    * @param stringBuilder ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡
    */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">buildResponseLine</span><span class="token punctuation">(</span><span class="token class-name">Response</span> response<span class="token punctuation">,</span> <span class="token class-name">StringBuilder</span> stringBuilder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
    * æ„å»ºå“åº”å¤´ã€‚
    *
    * @param response      ç”¨äºæ„å»ºå“åº”å¤´çš„ Response å¯¹è±¡
    * @param stringBuilder ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡
    */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">buildResponseHeaders</span><span class="token punctuation">(</span><span class="token class-name">Response</span> response<span class="token punctuation">,</span> <span class="token class-name">StringBuilder</span> stringBuilder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
    * æ„å»ºå“åº”æ­£æ–‡ã€‚
    *
    * @param response      ç”¨äºæ„å»ºå“åº”æ­£æ–‡çš„ Response å¯¹è±¡
    * @param stringBuilder ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡
    */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">buildResponseMessage</span><span class="token punctuation">(</span><span class="token class-name">Response</span> response<span class="token punctuation">,</span> <span class="token class-name">StringBuilder</span> stringBuilder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="b__HttpTask_305"></a>b. è¯·æ±‚ä»»åŠ¡ HttpTask</h3> 
<p>æ¯ä¸ªè¯·æ±‚ï¼Œå•ç‹¬åˆ†é…ä¸€ä¸ªä»»åŠ¡æ¥å¹²è¿™ä¸ªäº‹æƒ…ï¼Œå°±æ˜¯ä¸ºäº†æ”¯æŒå¹¶å‘ï¼Œå¯¹äº ServerSocket è€Œè¨€ï¼Œæ¥æ”¶åˆ°äº†ä¸€ä¸ªè¯·æ±‚ï¼Œé‚£å°±åˆ›å»ºä¸€ä¸ª HttpTask ä»»åŠ¡æ¥å®ç° HTTP é€šä¿¡ã€‚</p> 
<p>é‚£ä¹ˆè¿™ä¸ª httptask å¹²å•¥å‘¢ï¼Ÿ</p> 
<ul><li>ä»è¯·æ±‚ä¸­ææ•°æ®</li><li>å“åº”è¯·æ±‚</li><li>å°è£…ç»“æœå¹¶è¿”å›</li></ul> 
<pre><code class="prism language-java"><span class="token comment">/**
 * HttpTask ç±»å®ç°äº† Runnable æ¥å£ï¼Œç”¨äºå¤„ç†ä¸€ä¸ª HTTP è¯·æ±‚ã€‚
 * å½“åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ï¼Œè¯¥ä»»åŠ¡å°†å¤„ç†ä¸€ä¸ª Socket è¿æ¥ä¸Šçš„ HTTP è¯·æ±‚ï¼Œ
 * å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Socket</span>
    <span class="token keyword">private</span> <span class="token class-name">Socket</span> socket<span class="token punctuation">;</span>

    <span class="token comment">/**
     * æ„é€ ä¸€ä¸ªæ–°çš„ HttpTaskï¼Œç”¨äºå¤„ç†æŒ‡å®šçš„ Socket è¿æ¥ã€‚
     *
     * @param socket  ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Socket
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">HttpTask</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> socket<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>socket <span class="token operator">=</span> socket<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å®ç° Runnable æ¥å£çš„ run æ–¹æ³•ï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// æ£€æŸ¥ socket æ˜¯å¦ä¸º nullï¼Œå¦‚æœä¸º null åˆ™æŠ›å‡ºå¼‚å¸¸</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>socket <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"socket can't be null."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// è·å– Socket çš„è¾“å‡ºæµï¼Œå¹¶åˆ›å»ºä¸€ä¸ª PrintWriter å¯¹è±¡</span>
            <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// ä» Socket çš„è¾“å…¥æµä¸­è§£æ HTTP è¯·æ±‚</span>
            <span class="token class-name">HttpMessageParser<span class="token punctuation">.</span>Request</span> httpRequest <span class="token operator">=</span> <span class="token class-name">HttpMessageParser</span><span class="token punctuation">.</span><span class="token function">parse2request</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// æ ¹æ®è¯·æ±‚ç»“æœè¿›è¡Œå“åº”ï¼Œçœç•¥è¿”å›</span>
                <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                
                <span class="token comment">// æ ¹æ®è¯·æ±‚å’Œç»“æœæ„å»º HTTP å“åº”</span>
                <span class="token class-name">String</span> httpRes <span class="token operator">=</span> <span class="token class-name">HttpMessageParser</span><span class="token punctuation">.</span><span class="token function">buildResponse</span><span class="token punctuation">(</span>httpRequest<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// å°† HTTP å“åº”å‘é€åˆ°å®¢æˆ·ç«¯</span>
                out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>httpRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæ„å»ºä¸€ä¸ªåŒ…å«å¼‚å¸¸ä¿¡æ¯çš„ HTTP å“åº”</span>
                <span class="token class-name">String</span> httpRes <span class="token operator">=</span> <span class="token class-name">HttpMessageParser</span><span class="token punctuation">.</span><span class="token function">buildResponse</span><span class="token punctuation">(</span>httpRequest<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>httpRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// åˆ·æ–°è¾“å‡ºæµï¼Œç¡®ä¿å“åº”æ¶ˆæ¯è¢«å‘é€</span>
            out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// å…³é—­ Socket è¿æ¥</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="c_HTTP__382"></a>c. HTTP æœåŠ¡æ­å»º</h3> 
<p>å‰é¢çš„åŸºæœ¬ä¸ŠæŠŠè¯¥å¹²çš„äº‹æƒ…éƒ½å¹²äº†ï¼Œå‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œåˆ›å»ºServerSocketï¼Œç»‘å®šç«¯å£æ¥æ”¶è¯·æ±‚ï¼Œæˆ‘ä»¬åœ¨çº¿ç¨‹æ± ä¸­è·‘è¿™ä¸ª HTTP æœåŠ¡</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BasicHttpServer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼Œç”¨äºå¯åŠ¨ HTTP æœåŠ¡å™¨</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> bootstrapExecutor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> taskExecutor<span class="token punctuation">;</span>
    <span class="token comment">// è®¾ç½®æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">8999</span><span class="token punctuation">;</span>

    <span class="token comment">// å¯åŠ¨ HTTP æœåŠ¡å™¨çš„æ–¹æ³•</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// è·å–å¤„ç†å™¨å¯ç”¨æ ¸å¿ƒæ•°ï¼Œç”¨äºè®¾ç½®çº¿ç¨‹æ± å¤§å°</span>
        <span class="token keyword">int</span> nThreads <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆå§‹åŒ–çº¿ç¨‹æ± ï¼Œè®¾ç½®çº¿ç¨‹æ± å¤§å°ï¼Œé˜Ÿåˆ—å¤§å°å’Œä¸¢å¼ƒç­–ç•¥</span>
        taskExecutor <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> nThreads<span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>DiscardPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å¾ªç¯å°è¯•å¯åŠ¨æœåŠ¡å™¨ï¼Œå¦‚æœå¯åŠ¨å¤±è´¥ï¼Œåˆ™ç­‰å¾…10ç§’åé‡è¯•</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                bootstrapExecutor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServerThread</span><span class="token punctuation">(</span>serverSocket<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// é‡è¯•ï¼Œç­‰å¾… 10 ç§’</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ie<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// å…³é—­å¯åŠ¨æ‰§è¡Œå™¨</span>
        bootstrapExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// HTTP æœåŠ¡å™¨ä¸»è¦ä»»åŠ¡ç±»</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ServerThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ä¿å­˜ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ ServerSocket å®ä¾‹</span>
        <span class="token keyword">private</span> <span class="token class-name">ServerSocket</span> serverSocket<span class="token punctuation">;</span>

        <span class="token comment">// æ„é€ å‡½æ•°</span>
        <span class="token keyword">public</span> <span class="token class-name">ServerThread</span><span class="token punctuation">(</span><span class="token class-name">ServerSocket</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>serverSocket <span class="token operator">=</span> s<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// ä»»åŠ¡ä¸»ä½“æ–¹æ³•</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span>
                    <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// åˆ›å»ºä¸€ä¸ª HttpTask å®ä¾‹ï¼Œå°† Socket å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’</span>
                    <span class="token class-name">HttpTask</span> eventTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpTask</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// å°† HttpTask æäº¤ç»™ taskExecutor æ‰§è¡Œ</span>
                    taskExecutor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>eventTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œç­‰å¾… 1 ç§’åç»§ç»­å°è¯•</span>
                        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ie<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å®ç°ã€‚ä»¥ä¸‹æ˜¯å…³äºè¿™ä¸ª HTTP æœåŠ¡å™¨çš„ä¸»è¦ç»„ä»¶å’ŒåŠŸèƒ½çš„è¯¦ç»†è§£é‡Šï¼š</p> 
<p>1ã€bootstrapExecutorï¼šä¸€ä¸ªå•çº¿ç¨‹çš„ ExecutorServiceï¼Œç”¨äºæ‰§è¡Œ HTTP æœåŠ¡å™¨çš„å¯åŠ¨ä»»åŠ¡ã€‚</p> 
<p>2ã€taskExecutorï¼šä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ã€‚çº¿ç¨‹æ± çš„å¤§å°ç­‰äºå¤„ç†å™¨å¯ç”¨æ ¸å¿ƒæ•°ï¼Œé˜Ÿåˆ—å¤§å°ä¸º100ï¼Œä½¿ç”¨ DiscardPolicy ä¸¢å¼ƒç­–ç•¥ã€‚</p> 
<p>3ã€PORTï¼šæœåŠ¡å™¨ä¾¦å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸º 8999ã€‚</p> 
<p>4ã€startHttpServer() æ–¹æ³•ï¼š</p> 
<ul><li>a.åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ±  taskExecutor ç”¨äºå¤„ç† HTTP è¯·æ±‚ã€‚</li><li>b.åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå°è¯•åˆ›å»ºä¸€ä¸ª ServerSocket å®ä¾‹å¹¶ç»‘å®šåˆ°æŒ‡å®šç«¯å£ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™ç­‰å¾… 10 ç§’åé‡è¯•ã€‚</li><li>c.å½“æˆåŠŸåˆ›å»º ServerSocket å®ä¾‹åï¼Œå°†å…¶ä½œä¸ºå‚æ•°æäº¤ç»™ bootstrapExecutor æ‰§è¡Œ ServerThread ä»»åŠ¡ã€‚</li><li>d.å…³é—­ bootstrapExecutorã€‚<br> 5ã€ServerThread ç±»å®ç°äº† Runnable æ¥å£ï¼Œå®ƒæ˜¯ HTTP æœåŠ¡å™¨çš„ä¸»è¦ä»»åŠ¡ï¼š</li><li>a.serverSocket æˆå‘˜å˜é‡ï¼šä¿å­˜ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ ServerSocket å®ä¾‹ã€‚</li><li>b.run() æ–¹æ³•ï¼š</li><li>åœ¨ä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œè°ƒç”¨ serverSocket.accept() æ–¹æ³•ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</li><li>å½“æ¥å—åˆ°ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª HttpTask å®ä¾‹ï¼Œå°† Socket å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</li><li>å°† HttpTask æäº¤ç»™ taskExecutor æ‰§è¡Œã€‚</li></ul> 
<p>è¿™ä¸ª HTTP æœåŠ¡å™¨çš„ä¸»è¦é€»è¾‘æ˜¯ï¼šä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼Œå½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª HttpTask æ¥å¤„ç†å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ï¼Œå¹¶å°†è¿™ä¸ªä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ±  taskExecutor æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥å®ç°å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚çš„å¹¶å‘å¤„ç†ã€‚</p> 
<p>åˆ°è¿™é‡Œï¼Œä¸€ä¸ªåŸºäº Socket å®ç°çš„ HTTP æœåŠ¡å™¨åŸºæœ¬ä¸Šå°±æ­å»ºå®Œäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œæµ‹è¯•äº†</p> 
<h2><a id="4__483"></a>4. æµ‹è¯•</h2> 
<p>åšè¿™ä¸ªæœåŠ¡å™¨ï¼Œä¸»è¦æ˜¯åŸºäºé¡¹ç›® quick-fix äº§ç”Ÿçš„ï¼Œè¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯ä¸ºäº†è§£å†³åº”ç”¨å†…éƒ¨æœåŠ¡è®¿é—®ä¸æ•°æ®è®¢æ­£ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®çš„åŸºç¡€ä¸Šè¿›è¡Œæµ‹è¯•ã€‚</p> 
<p>ä¸€ä¸ªå®Œæ•´çš„ post è¯·æ±‚å¦‚ä¸‹<br> <img src="https://images2.imgbox.com/fc/47/Y6nj3QKo_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹æ‰“å°å‡ºè¿”å›å¤´çš„æƒ…å†µ</p> 
<p><img src="https://images2.imgbox.com/70/28/aGhyrca6_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2a8112adce1327c7ea03ff1d33c7965d/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Dutreeï¼šLinux æ–‡ä»¶ç³»ç»Ÿç£ç›˜ä½¿ç”¨è¿½è¸ªå·¥å…·</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d8f2a5a0ba1139324dcad97565725d23/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">spring boot 2.4.x ä¹‹å‰ç‰ˆæœ¬(å¯¹åº”spring-cloud-openfeign 3.0.0ä¹‹å‰ç‰ˆæœ¬)feignè¯·æ±‚å¼‚å¸¸é€»è¾‘</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹é¬¼è°·å­çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>