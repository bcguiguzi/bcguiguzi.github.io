<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>k8s安装dashboard报错CrashLoopBackOff - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="k8s安装dashboard报错CrashLoopBackOff" />
<meta property="og:description" content="报错信息 使用kubectl get pods -A查看集群，出现错误：
kubernetes-dashboard kubernetes-dashboard-xxxxxxxxxx6-2qrst 0/1 CrashLoopBackOff 6 15m 查看日志后，发现原因：
panic: Get &#34;https://10.6.10.1:443/api/v1/namespaces/kubernetes-dashboard/secrets/kubernetes-dashboard-csrf&#34;: dial tcp 10.96.0.1:443: i/o timeout goroutine 1 [running]: github.com/kubernetes/dashboard/src/app/backend/client/csrf.(*csrfTokenManager).init(0xc00041ca20) /home/runner/work/dashboard/dashboard/src/app/backend/client/csrf/manager.go:41 &#43;0x413 github.com/kubernetes/dashboard/src/app/backend/client/csrf.NewCsrfTokenManager(...) /home/runner/work/dashboard/dashboard/src/app/backend/client/csrf/manager.go:66 github.com/kubernetes/dashboard/src/app/backend/client.(*clientManager).initCSRFKey(0xc0004a0e00) /home/runner/work/dashboard/dashboard/src/app/backend/client/manager.go:502 &#43;0xc6 github.com/kubernetes/dashboard/src/app/backend/client.(*clientManager).init(0xc0004a0e00) /home/runner/work/dashboard/dashboard/src/app/backend/client/manager.go:470 &#43;0x47 github.com/kubernetes/dashboard/src/app/backend/client.NewClientManager(...) /home/runner/work/dashboard/dashboard/src/app/backend/client/manager.go:551 原因 dashboard的数据包直接被REJECT(拒绝)
解决方案 方案一： 原理：修改防火墙规则
方案弊端：虚拟机环境下创建的k8s可视化面板好像没有效果
操作如下：
保存现有的防火墙规则 iptables-save &gt; iptables.rules 修改规则策略为ACCEPT iptables -P INPUT ACCEPT iptables -P FORWARD ACCEPT iptables -P OUTPUT ACCEPT 执行下命令： iptables -F 方案二 原因：同样是网络问题，具体而言是在初始化k8s集群时，--pod-network-cidr=192.168.0.0/16网段与虚拟机IP网段冲突
操作：重装k8s集群，具体参考：Ubuntu重装kubernetes集群-CSDN博客
（下面步骤和参考链接有所不同，也是解决这个问题的关键）
将原来--pod-network-cidr=192.168.0.0/16修改为与虚拟机IP不同的网段，比如--pod-network-cidr=192.170.0.0/16
修改网络插件配置calico.yaml，修改IP" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/5678fb2d33194f5c539f567d4f729939/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-02-01T18:49:18+08:00" />
<meta property="article:modified_time" content="2024-02-01T18:49:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">k8s安装dashboard报错CrashLoopBackOff</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_2"></a>报错信息</h3> 
<p>使用kubectl get pods -A查看集群，出现错误：</p> 
<pre><code>kubernetes-dashboard   kubernetes-dashboard-xxxxxxxxxx6-2qrst        0/1     CrashLoopBackOff   6          15m
</code></pre> 
<p>查看日志后，发现原因：</p> 
<pre><code>panic: Get "https://10.6.10.1:443/api/v1/namespaces/kubernetes-dashboard/secrets/kubernetes-dashboard-csrf": dial tcp 10.96.0.1:443: i/o timeout 
goroutine 1 [running]:
github.com/kubernetes/dashboard/src/app/backend/client/csrf.(*csrfTokenManager).init(0xc00041ca20)
 /home/runner/work/dashboard/dashboard/src/app/backend/client/csrf/manager.go:41 +0x413
github.com/kubernetes/dashboard/src/app/backend/client/csrf.NewCsrfTokenManager(...)
 /home/runner/work/dashboard/dashboard/src/app/backend/client/csrf/manager.go:66
github.com/kubernetes/dashboard/src/app/backend/client.(*clientManager).initCSRFKey(0xc0004a0e00)
 /home/runner/work/dashboard/dashboard/src/app/backend/client/manager.go:502 +0xc6
github.com/kubernetes/dashboard/src/app/backend/client.(*clientManager).init(0xc0004a0e00)
 /home/runner/work/dashboard/dashboard/src/app/backend/client/manager.go:470 +0x47
github.com/kubernetes/dashboard/src/app/backend/client.NewClientManager(...)
 /home/runner/work/dashboard/dashboard/src/app/backend/client/manager.go:551
</code></pre> 
<h3><a id="_27"></a>原因</h3> 
<p>dashboard的数据包直接被REJECT(拒绝)</p> 
<h3><a id="_31"></a>解决方案</h3> 
<h4><a id="_33"></a>方案一：</h4> 
<p>原理：修改防火墙规则</p> 
<p><strong>方案弊端：虚拟机环境下创建的k8s可视化面板好像没有效果</strong></p> 
<p>操作如下：</p> 
<ol><li>保存现有的防火墙规则</li></ol> 
<pre><code>iptables-save &gt; iptables.rules
</code></pre> 
<ol start="2"><li>修改规则策略为ACCEPT</li></ol> 
<pre><code>iptables -P INPUT ACCEPT

iptables -P FORWARD ACCEPT

iptables -P OUTPUT ACCEPT
</code></pre> 
<ol start="3"><li>执行下命令：</li></ol> 
<pre><code>iptables -F
</code></pre> 
<h4><a id="_66"></a>方案二</h4> 
<p>原因：同样是网络问题，具体而言是在初始化k8s集群时，<code>--pod-network-cidr=192.168.0.0/16</code>网段与虚拟机IP网段冲突</p> 
<p>操作：重装k8s集群，具体参考：<a href="https://blog.csdn.net/weixin_43742062/article/details/135980293">Ubuntu重装kubernetes集群-CSDN博客</a></p> 
<p><strong><u>（下面步骤和参考链接有所不同，也是解决这个问题的关键）</u></strong></p> 
<ol><li> <p>将原来<code>--pod-network-cidr=192.168.0.0/16</code>修改为与虚拟机IP不同的网段，比如<code>--pod-network-cidr=192.170.0.0/16</code></p> </li><li> <p>修改网络插件配置calico.yaml，修改IP<br> <img src="https://images2.imgbox.com/d6/4f/aXElAIqg_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<h3><a id="_78"></a>参考</h3> 
<p>https://zhuanlan.zhihu.com/p/368578555</p> 
<p><a href="https://www.cnblogs.com/xuruiming/p/17037538.html" rel="nofollow">安装kubernetes-dashboard时显示为CrashLoopBackOff或Error状态的可能原因 - 岁月已走远 - 博客园</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c574a3320a3e3756992ad9008eecf733/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于STM32单片机车牌识别图像处理AI摄像头车位停车计费设计400</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/285a8fb443a92c113eb992ed6c608810/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">笔记本安装centos7和ubuntu22.02系统教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>