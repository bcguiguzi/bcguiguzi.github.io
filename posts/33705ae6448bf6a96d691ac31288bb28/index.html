<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>主机二层和三层通信的 数据包传输过程 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="主机二层和三层通信的 数据包传输过程" />
<meta property="og:description" content="1、两主机直连传输数据包过程 需要协议：tcp/ip 协议 、arp协议。
tcp/ip 四层：
4应用层 telnet、ftp、http、smtp、dns
3传输层 tcp、udp
2网络层 ip、icmp、arp、rarp
1数据链路层
注意：主机的arp表内容有：mac和ip
连接示意图：
左边是主机A
主机A：
应用层：我要和主机B建立可靠连接，并发送数据。
传输层：那我将用tcp，需要网络层将tcp syn发送给主机B
网络层：可是我的宝贝arp没有主机B的映射，先把数据包放在停车场等有映射了我再来取。
arp：那我发送个arp广播找主机B,B收到会恢复arp响应的 下面是arp广播格式：
主机B：
网络层：我收到个arp广播 我要转给arp
arp：收到主机A的mac和ip 让我添加到 arp表 然后我再应答。下面是应答格式：
主机A：
网络层：收到个arp，让我交给arp处理。
arp：好了收到B的 应答了 让我把B的IP和mac添加进arp表。然后告诉网络层我有B的映射了。
网络层：取出停车场的数据包发给B， 下面是格式：
这时B需要发送 syn ack 包 然后 A再发送 syn ack 包 完成三次握手 建立会话。
会话建立完成之后 就可以畅通的发送应用层数据包了：
A 发送数据包的格式：
B 回复的格式：
2、通过交换网络传播数据包 连接示意图：
左边是主机A。
交换机左边的端口是1。
注意：交换机的arp表中只有：mac和端口。
和上边的区别是多了个交换机， 主机A和B发送的数据包和上面一样。
交换机在此起到的作用：
1、遇到A发送的arp广播，交换机先将A的 mac和所在交换机端口的信息添加到表中。
2、然后将arp广播泛红到所有端口除了A所在的端口1。
3、B收到之后，发送arp应答包
4、交换机收到之后先把B的信息添加到表中，再把应答包转发给A。
3、通过路由网络传输数据包 连接示意图：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/33705ae6448bf6a96d691ac31288bb28/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-08T14:42:55+08:00" />
<meta property="article:modified_time" content="2020-03-08T14:42:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">主机二层和三层通信的 数据包传输过程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1、两主机直连传输数据包过程</h3> 
<p>需要协议：tcp/ip 协议 、arp协议。<br> <strong>tcp/ip 四层：</strong><br> 4应用层 telnet、ftp、http、smtp、dns<br> 3传输层 tcp、udp<br> 2网络层 ip、icmp、arp、rarp<br> 1数据链路层</p> 
<p><strong>注意</strong>：<strong>主机的arp表内容有：mac和ip</strong></p> 
<p><strong>连接示意图：</strong><br> 左边是主机A<br> <img src="https://images2.imgbox.com/8b/6f/5ePqYrJj_o.png" alt="在这里插入图片描述"><br> <strong>主机A：</strong><br> 应用层：我要和主机B建立可靠连接，并发送数据。<br> 传输层：那我将用tcp，需要网络层将tcp syn发送给主机B<br> 网络层：可是我的宝贝arp没有主机B的映射，先把数据包放在停车场等有映射了我再来取。<br> arp：那我发送个arp广播找主机B,B收到会恢复arp响应的 下面是arp广播格式：</p> 
<p><img src="https://images2.imgbox.com/17/52/T8rl57d9_o.png" alt="在这里插入图片描述"><br> <strong>主机B：</strong><br> 网络层：我收到个arp广播 我要转给arp<br> arp：收到主机A的mac和ip 让我添加到 arp表 然后我再应答。下面是应答格式：<br> <img src="https://images2.imgbox.com/ca/0b/nvZlzSHO_o.png" alt="在这里插入图片描述"><br> <strong>主机A：</strong><br> 网络层：收到个arp，让我交给arp处理。<br> arp：好了收到B的 应答了 让我把B的IP和mac添加进arp表。然后告诉网络层我有B的映射了。<br> 网络层：取出停车场的数据包发给B， 下面是格式：<br> <img src="https://images2.imgbox.com/cf/88/6yxRKwOF_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p>这时B需要发送 syn ack 包 然后 A再发送 syn ack 包 完成三次握手 建立会话。<br> 会话建立完成之后 就可以畅通的发送应用层数据包了：</p> 
<p>A 发送数据包的格式：<br> <img src="https://images2.imgbox.com/bc/09/OvP6jTiM_o.png" alt="在这里插入图片描述"></p> 
<p>B 回复的格式：<br> <img src="https://images2.imgbox.com/4f/19/Vs5ok6qL_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<hr> 
<h3><a id="2_45"></a>2、通过交换网络传播数据包</h3> 
<p>连接示意图：<br> 左边是主机A。<br> 交换机左边的端口是1。<br> <strong>注意：交换机的arp表中只有：mac和端口。</strong><br> <img src="https://images2.imgbox.com/e1/35/65BuHg0Y_o.png" alt="在这里插入图片描述"></p> 
<p>和上边的区别是多了个交换机， 主机A和B发送的数据包和上面一样。<br> <strong>交换机在此起到的作用：</strong><br> 1、遇到A发送的arp广播，交换机先将A的 mac和所在交换机端口的信息添加到表中。<br> 2、然后将arp广播泛红到所有端口除了A所在的端口1。<br> 3、B收到之后，发送arp应答包<br> 4、交换机收到之后先把B的信息添加到表中，再把应答包转发给A。</p> 
<hr> 
<hr> 
<h3><a id="3_62"></a>3、通过路由网络传输数据包</h3> 
<p>连接示意图：<br> 左边为A。<br> 路由器左边的端口是1</p> 
<p><strong>注意：路由器 arp表中只有 ip和mac</strong></p> 
<p><img src="https://images2.imgbox.com/2c/02/C6eEpDHH_o.png" alt="在这里插入图片描述"><br> <strong>主机A:</strong><br> A要给B发送数据包，经arp判断不在一个网段，所以要寻找默认网关有网关的ip却没有mac。<br> arp：我要发送广播帧如下： src mac是A的mac<br> <img src="https://images2.imgbox.com/d2/b5/hUj8qC9S_o.png" alt="在这里插入图片描述"><br> <strong>路由器：</strong><br> 收到广播，将A的信息加入arp表，然后给A应答。</p> 
<p><strong>主机A：</strong><br> 收到应答 将路由器信息加入到arp表。<br> 然后向路由器发送数据包ip是主机B的ip。 格式如下：<br> <img src="https://images2.imgbox.com/2a/08/LbeEJpeM_o.png" alt="在这里插入图片描述"><br> <strong>路由器：</strong><br> 路由器：收到包 发现IP不是自己 所以应该路由之。2端口可以将包发送给B。<br> 路由器：2端口请发送包！<br> 2端口：好嘞，可是没有B的mac地址 那我将发送 arp广播包。</p> 
<hr> 
<p>1、然后B将发送应答包。<br> 2、然后路由器将B的信息加入到arp表。<br> 3、主机B也有了默认路由。<br> 4、路由器2端口给B发送数据包，源ip和mc为2端口的IP和mac。如下所示：<br> <img src="https://images2.imgbox.com/ba/e5/buJsuZZF_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/107ea60e08fa862a60c5ad6ff5065e59/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">WebView使用方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2b96ef430202ac7e1a8e0937a8c467d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用Postman 连接服务器接口 报错 Bad Request This combination of host and port requires TLS.</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>