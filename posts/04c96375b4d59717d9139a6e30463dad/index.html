<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【问题记录】解决Qt连接MySQL报“QMYSQL driver not loaded”以及不支持MySQL事务操作的问题！ - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【问题记录】解决Qt连接MySQL报“QMYSQL driver not loaded”以及不支持MySQL事务操作的问题！" />
<meta property="og:description" content="环境 Windows 11 家庭中文版，64 位操作系统, 基于 x64 的处理器Qt 5.15.2 MinGW 32-bitmysql Ver 14.14 Distrib 5.7.42, for Win32 (AMD64) 问题情况 在Qt 5.15.2 中编写连接MySQL数据库代码后，使用 MinGW 32-bit 构建套件进行编译运行后，报了 “QMYSQL driver not loaded” 错误！工作中也还遇到了在 Qt 5.15.2 中操作MySql数据库不能开启事务操作的问题！判断是否支持MySQL事务操作的语句如下： m_db.driver()-&gt;hasFeature(QSqlDriver::DriverFeature::Transactions);
问题分析 问题一
Qt连接MySQL报 “QMYSQL driver not loaded” 错误很明显就是MySQL驱动的问题。之前在 Qt 5.9.6 中也遇到了驱动未加载的问题，在按该文章 【问题记录】Qt连接MySQL报 QMYSQL driver not loaded 错误！进行操作时，还是不能解决，因为使用的Qt版本不同，所以对MySQL的驱动要求也会有所改变。 问题二
Qt 5.15.2 应该支持MySQL数据库的事务操作，但具体的支持取决于所使用的数据库驱动程序和数据库引擎。以下是一些可能的原因，导致在 Qt 5.15.2 中无法对MySQL数据库进行事务操作的情况： 使用不支持事务的数据库引擎：某些数据库引擎（例如MySQL的MyISAM）不支持事务操作。如果在这些引擎上创建表格，那么无论您使用什么版本的Qt，都无法进行事务操作。确保使用的是支持事务的数据库引擎，如InnoDB。使用不正确的数据库驱动程序：Qt 使用不同的数据库驱动程序来连接到各种数据库。如果使用的数据库驱动程序不正确或不支持事务操作，就可能会遇到问题。使用确保选择了适当的数据库驱动程序，如QMYSQL。Qt 编译问题：在某些情况下，Qt 库可能未正确编译或配置以支持数据库的事务操作。确保使用的 Qt 5.15.2 版本已经正确构建并包括 SQL 模块。 总结
根据上面的情况进行分析，可以肯定这类问题的解决办法得从MySQL驱动上进行下手，但MySQL官网提供的最新驱动已经在2017年就停止更新了并且不支持当前Qt 5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/04c96375b4d59717d9139a6e30463dad/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-24T20:56:14+08:00" />
<meta property="article:modified_time" content="2023-10-24T20:56:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【问题记录】解决Qt连接MySQL报“QMYSQL driver not loaded”以及不支持MySQL事务操作的问题！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><span style="color:#fe2c24;">环</span><span style="color:#ff9900;">境</span></h2> 
<blockquote> 
 <ul><li>Windows 11 家庭中文版，64 位操作系统, 基于 x64 的处理器</li><li>Qt 5.15.2 MinGW 32-bit</li><li>mysql  Ver 14.14 Distrib 5.7.42, for Win32 (AMD64)</li></ul> 
</blockquote> 
<h2><span style="color:#fe2c24;">问</span><span style="color:#ff9900;">题</span><span style="color:#ffd900;">情</span><span style="color:#a2e043;">况</span></h2> 
<blockquote> 
 <ol><li>在Qt 5.15.2 中编写连接MySQL数据库代码后，使用 MinGW 32-bit 构建套件进行编译运行后，报了 “QMYSQL driver not loaded” 错误！<img alt="" src="https://images2.imgbox.com/76/fb/Wz9H7tc1_o.png"></li><li>工作中也还遇到了在 Qt 5.15.2 中操作MySql数据库不能开启事务操作的问题！判断是否支持MySQL事务操作的语句如下： 
   <ol><li> <p style="margin-left:.0001pt;text-align:justify;">m_db.driver()-&gt;hasFeature(QSqlDriver::DriverFeature::Transactions);</p> </li></ol></li></ol> 
</blockquote> 
<h2><span style="color:#fe2c24;">问</span><span style="color:#ff9900;">题</span><span style="color:#ffd900;">分</span><span style="color:#a2e043;">析</span></h2> 
<blockquote> 
 <p><strong>问题一</strong></p> 
 <ol><li>Qt连接MySQL报 “QMYSQL driver not loaded” 错误很明显就是MySQL驱动的问题。</li><li>之前在 Qt 5.9.6 中也遇到了驱动未加载的问题，在按该文章 <a class="link-info" href="https://blog.csdn.net/weixin_43729127/article/details/127708746" title="【问题记录】Qt连接MySQL报 QMYSQL driver not loaded 错误！">【问题记录】Qt连接MySQL报 QMYSQL driver not loaded 错误！</a>进行操作时，还是不能解决，因为使用的Qt版本不同，所以对MySQL的驱动要求也会有所改变。</li></ol> 
 <p><strong>问题二</strong></p> 
 <ol><li>Qt 5.15.2 应该支持MySQL数据库的事务操作，但具体的支持取决于所使用的数据库驱动程序和数据库引擎。</li><li>以下是一些可能的原因，导致在 Qt 5.15.2 中无法对MySQL数据库进行事务操作的情况： 
   <ol><li style="text-align:justify;"><strong><strong>使用不支持事务的数据库引擎</strong></strong>：某些数据库引擎（例如MySQL的MyISAM）不支持事务操作。如果在这些引擎上创建表格，那么无论您使用什么版本的Qt，都无法进行事务操作。确保使用的是支持事务的数据库引擎，如InnoDB。</li><li style="text-align:justify;"><strong><strong>使用不正确的数据库驱动程序</strong></strong>：Qt 使用不同的数据库驱动程序来连接到各种数据库。如果使用的数据库驱动程序不正确或不支持事务操作，就可能会遇到问题。使用确保选择了适当的数据库驱动程序，如QMYSQL。</li><li style="text-align:justify;"><strong><strong>Qt 编译问题</strong></strong>：在某些情况下，Qt 库可能未正确编译或配置以支持数据库的事务操作。确保使用的 Qt 5.15.2 版本已经正确构建并包括 SQL 模块。</li></ol></li></ol> 
 <hr> 
 <p style="text-align:justify;"><strong>总结</strong></p> 
 <ol><li style="text-align:justify;">根据上面的情况进行分析，可以肯定这类问题的解决办法得从MySQL驱动上进行下手，但MySQL官网提供的最新驱动已经在2017年就停止更新了并且不支持当前Qt 5.15.2版本了。</li><li style="text-align:justify;">所以还是得自己来根据 “Qt源码的MySQL源码部分” 和 已经安装好的MySQL来生成适用于当前Qt版本的MySQL驱动程序。</li></ol> 
</blockquote> 
<h2><span style="color:#fe2c24;">解</span><span style="color:#ff9900;">决</span><span style="color:#ffd900;">办</span><span style="color:#a2e043;">法</span></h2> 
<blockquote> 
 <p><strong>前提条件</strong></p> 
 <ol><li>在安装Qt的时候记得勾选Qt源码。</li><li>MySQL的安装位数要和Qt的构建套件位数一致（比如Qt使用的是MinGW 32-bit，那MySQL安装位数也必须位32位）。</li></ol> 
 <p><strong>编译Qt 的MySQL源码生成MySQL驱动程序</strong></p> 
 <ol><li>将 D:\Software\IT\MySQL\mysql-5.7.42-win32\lib 目录下的 libmysql.dll 和 libmysql.lib  库文件拷贝到 MinGW 32-bit 编译套件的bin目录下。<img alt="" src="https://images2.imgbox.com/f6/9c/SC1RFI7B_o.png"></li><li>找到MySQL源码所在路径（本人：D:\Software\IT\Qt\5.15.2\Src\qtbase\src\plugins\sqldrivers\mysql），然后双击mysql目录下的 mysql.pro 文件，在Qt Creator中选择 MinGW 32-bit 编译套件。</li><li>打开 mysql.pro 文件，进行如下的编辑：<img alt="" src="https://images2.imgbox.com/d6/dd/Jc6bN5fQ_o.png"></li><li>点击Qt Creator界面左下角的小锤子来构建当前mysql源码。</li><li>然后会在D:\Software\IT\Qt\5.15.2\mingw81_32\plugins\sqldrivers目录下生成如下几个文件。<img alt="" src="https://images2.imgbox.com/98/e5/J9rU4r35_o.png"></li><li>最后运行下测试MySQL驱动的例子，问题终于解决了！！！<img alt="" src="https://images2.imgbox.com/8c/19/kyt5uVSr_o.png"></li></ol> 
 <hr> 
 <p><strong>遗留问题</strong></p> 
 <ol><li>遇到了以下两种错误，我并没有去解决，但最终生成的库还是解决了Qt操作MySQL数据库的问题，（以下两种以后再说吧，目前无伤大雅） 
   <ol><li>Cannot read D:/Software/IT/Qt/5.15.2/Src/qtbase/src/plugins/sqldrivers/qtsqldrivers-config.pri: No such file or directory.</li><li>You need to set an executable in the custom run configuration.</li></ol></li></ol> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e2b5a8e1e596f4cf28b17d6ab1d3c25a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言基础（将持续更新版，接受提问，共同进步）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/579cbf5af770857e021820f72f03d7f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android 备忘录，记事本程序设计</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>