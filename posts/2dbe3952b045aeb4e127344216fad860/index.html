<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apache httpCient 连接池使用情况查看 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apache httpCient 连接池使用情况查看" />
<meta property="og:description" content="背景 ： 在springboot项目中使用 resetemplate 集成HttpClient 连接池使用状态。
如何知道目前连接池是否满负荷。
springboot
1）添加配置 如下 application.properties 配置文件 logging.config=classpath:log4j2_pro.xml
2）打开配置打印debug日志 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;configuration status=&#34;OFF&#34; monitorInterval=&#34;30&#34;&gt; &lt;Properties&gt; &lt;!--自定义一些常量，之后使用${变量名}引用--&gt; &lt;Property name=&#34;logFilePath&#34;&gt;/home/ucmed/logs/zsyy-api&lt;/Property&gt; &lt;/Properties&gt; &lt;!--先定义所有的appender--&gt; &lt;appenders&gt; &lt;!--这个输出控制台的配置--&gt; &lt;console name=&#34;Console&#34; target=&#34;SYSTEM_OUT&#34;&gt; &lt;!--输出日志的格式--&gt; &lt;PatternLayout pattern=&#34;[%d{HH:mm:ss:SSS}] [%p] - %l -%X{logId} - %m%n&#34;/&gt; &lt;/console&gt; &lt;!-- 这个会打印出所有的info及以下级别的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档--&gt; &lt;RollingFile name=&#34;RollingFileInfo&#34; fileName=&#34;${logFilePath}/info.log&#34; filePattern=&#34;${logFilePath}/$${date:yyyy-MM}/info-%d{yyyy-MM-dd}-%i.log&#34;&gt; &lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt; &lt;ThresholdFilter level=&#34;info&#34; onMatch=&#34;ACCEPT&#34; onMismatch=&#34;DENY&#34;/&gt; &lt;PatternLayout pattern=&#34;[%d{HH:mm:ss:SSS}] [%p] - %l -%X{logId} - %m%n&#34;/&gt; &lt;Policies&gt; &lt;TimeBasedTriggeringPolicy/&gt; &lt;/Policies&gt; &lt;DefaultRolloverStrategy max=&#34;30&#34;/&gt; &lt;/RollingFile&gt; &lt;RollingFile name=&#34;RollingFileError&#34; fileName=&#34;${logFilePath}/error.log&#34; filePattern=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/2dbe3952b045aeb4e127344216fad860/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-11T17:21:47+08:00" />
<meta property="article:modified_time" content="2022-10-11T17:21:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apache httpCient 连接池使用情况查看</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="__1"></a>背景 ：</h2> 
<p>在springboot项目中使用 resetemplate 集成HttpClient 连接池使用状态。</p> 
<p>如何知道目前连接池是否满负荷。</p> 
<p>springboot</p> 
<h3><a id="1___applicationproperties___7"></a>1）添加配置 如下 application.properties 配置文件</h3> 
<p>logging.config=classpath:log4j2_pro.xml</p> 
<h3><a id="2debug_12"></a>2）打开配置打印debug日志</h3> 
<p></p> 
<pre><code>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration status="OFF" monitorInterval="30"&gt;
    &lt;Properties&gt;
        &lt;!--自定义一些常量，之后使用${变量名}引用--&gt;
        &lt;Property name="logFilePath"&gt;/home/ucmed/logs/zsyy-api&lt;/Property&gt;
    &lt;/Properties&gt;
    &lt;!--先定义所有的appender--&gt;
    &lt;appenders&gt;
        &lt;!--这个输出控制台的配置--&gt;
        &lt;console name="Console" target="SYSTEM_OUT"&gt;
            &lt;!--输出日志的格式--&gt;
            &lt;PatternLayout pattern="[%d{HH:mm:ss:SSS}] [%p] - %l -%X{logId} - %m%n"/&gt;
        &lt;/console&gt;

        &lt;!-- 这个会打印出所有的info及以下级别的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档--&gt;
        &lt;RollingFile name="RollingFileInfo" fileName="${logFilePath}/info.log"
                     filePattern="${logFilePath}/$${date:yyyy-MM}/info-%d{yyyy-MM-dd}-%i.log"&gt;
            &lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;
            &lt;ThresholdFilter level="info" onMatch="ACCEPT" onMismatch="DENY"/&gt;
            &lt;PatternLayout pattern="[%d{HH:mm:ss:SSS}] [%p] - %l -%X{logId} - %m%n"/&gt;
            &lt;Policies&gt;
                &lt;TimeBasedTriggeringPolicy/&gt;
            &lt;/Policies&gt;
            &lt;DefaultRolloverStrategy max="30"/&gt;
        &lt;/RollingFile&gt;

        &lt;RollingFile name="RollingFileError" fileName="${logFilePath}/error.log"
                     filePattern="${logFilePath}/$${date:yyyy-MM}/error-%d{yyyy-MM-dd}-%i.log"&gt;
            &lt;ThresholdFilter level="error" onMatch="ACCEPT" onMismatch="DENY"/&gt;
            &lt;PatternLayout pattern="[%d{HH:mm:ss:SSS}] [%p] - %l -%X{logId} - %m%n"/&gt;
            &lt;Policies&gt;
                &lt;TimeBasedTriggeringPolicy/&gt;
            &lt;/Policies&gt;
            &lt;DefaultRolloverStrategy max="30"/&gt;
        &lt;/RollingFile&gt;
    &lt;/appenders&gt;

    &lt;!--然后定义logger，只有定义了logger并引入的appender，appender才会生效--&gt;

    &lt;loggers&gt;
        &lt;!--过滤掉spring和mybatis的一些无用的DEBUG信息--&gt;
        &lt;logger name="org.springframework" level="INFO"&gt;&lt;/logger&gt;
        &lt;logger name="org.mybatis" level="INFO"&gt;&lt;/logger&gt;
        &lt;logger name="io.netty" level="INFO"&gt;&lt;/logger&gt;
&lt;!--        &lt;logger name="org.apache.http" level="INFO"&gt;&lt;/logger&gt;--&gt;
        &lt;logger name="org.apache.http.impl.conn" level="DEBUG"&gt;&lt;/logger&gt;

        &lt;logger name="io.lettuce.core" level="INFO"&gt;&lt;/logger&gt;
        &lt;logger name="com.alibaba.druid.filter.logging" level="INFO"&gt;&lt;/logger&gt;
        &lt;root level="INFO"&gt;
            &lt;appender-ref ref="Console"/&gt;
            &lt;appender-ref ref="RollingFileInfo"/&gt;
            &lt;appender-ref ref="RollingFileError"/&gt;
        &lt;/root&gt;
    &lt;/loggers&gt;
&lt;/configuration&gt;

</code></pre> 
<h3><a id="3___79"></a>3）应用的日志 我们可以查看到请求完整 连接池信息：</h3> 
<pre><code>[16:59:21:744] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.requestConnection(PoolingHttpClientConnectionManager.java:267) -778bbf09-92e8-402b-9140-ba6df8960587 - Connection request: [route: {s}-&gt;https://paycenter.zwjk.com:443][total available: 1; route allocated: 0 of 5; total allocated: 1 of 10]
[16:59:21:745] [DEBUG] - org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:312) -778bbf09-92e8-402b-9140-ba6df8960587 - Connection leased: [id: 1][route: {s}-&gt;https://paycenter.zwjk.com:443][total available: 1; route allocated: 1 of 5; total allocated: 2 of 10]
[16:59:21:745] [DEBUG] - org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:139) -778bbf09-92e8-402b-9140-ba6df8960587 - Connecting to paycenter.zwjk.com/115.159.1.60:443
[16:59:21:891] [DEBUG] - org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:146) -778bbf09-92e8-402b-9140-ba6df8960587 - Connection established 172.17.0.7:49492&lt;-&gt;115.159.1.60:443
[16:59:21:892] [DEBUG] - org.apache.http.impl.conn.LoggingManagedHttpClientConnection.setSocketTimeout(LoggingManagedHttpClientConnection.java:88) -778bbf09-92e8-402b-9140-ba6df8960587 - http-outgoing-1: set socket timeout to 6000


</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2380909d4e7d6bbe3e96058d22dcac77/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Activiti工作流并行网关驳回在发起问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cd10ccf92a6f9bd646759273f085dad6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Hadoop的安装与配置（非常重要）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>