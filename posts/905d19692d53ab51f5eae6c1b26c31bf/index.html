<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MPU6050详解（含源码） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MPU6050详解（含源码）" />
<meta property="og:description" content="前言：MPU6050是一款强大的六轴传感器，需要理解MPU6050首先得有IIC的基础，MPU6050 内部整合了 3 轴陀螺仪和 3 轴加速度传感器，并且含有一个第二 IIC 接口，可用于连接外部磁力传感器，内部有硬件算法支持.
1.IO分配(MPU6050模块) 1. SCL 和 SDA 是连接 MCU 的 IIC 接口， MCU 通过这个 IIC 接口来控制 MPU6050，
另外还有一个 IIC 接口
2.AUX_CL 和 AUX_DA，这个接口可用来连接外部从设备，比如磁传感
器，这样就可以组成一个九轴传感器。
3.AD0 是从 IIC 接口（接 MCU）的地址控制引脚，该引脚控制 IIC 地址的最低位。如果接 GND，则 MPU6050 的 IIC 地址是： 0X68，如果接 VDD，则是 0X69.
2.MPU6050初始化（PA15 接 AD0 = GND） 注意：PA15默认是JTAG引脚，使用PA15时，需要使用IO的重映射功能。
（1）设置MPU6050的地址(AD0的电平) RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO,ENABLE);//打开辅助功能时钟 RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE); GPIO_InitStructure.GPIO_Pin = GPIO_Pin_15;	// GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;	GPIO_Init(GPIOA, &amp;GPIO_InitStructure);	GPIO_PinRemapConfig(GPIO_Remap_SWJ_JTAGDisable,ENABLE); MPU_AD0_CTRL=0;	//设置为低电平	注：这里使用PA15是默认是JTAG引脚 ，需要重映射。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/905d19692d53ab51f5eae6c1b26c31bf/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-06T19:37:09+08:00" />
<meta property="article:modified_time" content="2023-05-06T19:37:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MPU6050详解（含源码）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong><span style="color:#fe2c24;">前言</span></strong>：MPU6050是一款强大的六轴传感器，需要理解MPU6050首先得有IIC的基础，MPU6050 内部整合了 3 轴陀螺仪和 3 轴加速度传感器，并且含有一个第二 IIC 接口，可用于连接外部磁力传感器，内部有硬件算法支持.</p> 
<h2>1.IO分配(MPU6050模块)</h2> 
<p><img alt="" height="247" src="https://images2.imgbox.com/0d/44/OnbLcD71_o.png" width="413"></p> 
<p>1. SCL 和 SDA 是连接 MCU 的 IIC 接口， MCU 通过这个 IIC 接口来控制 MPU6050，<br> 另外还有一个 IIC 接口</p> 
<p>2.AUX_CL 和 AUX_DA，这个接口可用来连接外部从设备，比如磁传感<br> 器，这样就可以组成一个九轴传感器。</p> 
<p>3.AD0 是从 IIC 接口（接 MCU）的地址控制引脚，该引脚控制 IIC 地址的最低位。如果接 GND，则 MPU6050 的 IIC 地址是： 0X68，如果接 VDD，则是 0X69.</p> 
<h2>2.MPU6050初始化（PA15 接 AD0 = GND）</h2> 
<p>注意：PA15默认是JTAG引脚，使用PA15时，需要使用IO的重映射功能。</p> 
<p>（1）设置MPU6050的地址(AD0的电平) </p> 
<p><img alt="" height="561" src="https://images2.imgbox.com/1a/3e/HBpwidOe_o.png" width="1200"></p> 
<pre><code class="language-cpp">
RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO,ENABLE);//打开辅助功能时钟
RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);

 GPIO_InitStructure.GPIO_Pin = GPIO_Pin_15;	 // 
 GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; 		
 GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;		
 GPIO_Init(GPIOA, &amp;GPIO_InitStructure);					

GPIO_PinRemapConfig(GPIO_Remap_SWJ_JTAGDisable,ENABLE);
	
MPU_AD0_CTRL=0;	//设置为低电平		</code></pre> 
<p><span style="color:#fe2c24;"><strong>注：这里使用PA15是默认是JTAG引脚 ，需要重映射。</strong></span></p> 
<p>（2）完成IIC的初始化 </p> 
<pre><code class="language-cpp">	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB,ENABLE);//ÏÈÊ¹ÄÜÍâÉèIO PORTBÊ±ÖÓ 
		
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10|GPIO_Pin_11;	 // ¶Ë¿ÚÅäÖÃ
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; 		 //ÍÆÍìÊä³ö
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;		 //IO¿ÚËÙ¶ÈÎª50MHz
  GPIO_Init(GPIOB, &amp;GPIO_InitStructure);					 //¸ù¾ÝÉè¶¨²ÎÊý³õÊ¼»¯GPIO 
	
  GPIO_SetBits(GPIOB,GPIO_Pin_10|GPIO_Pin_11);						 //PB10,PB11 Êä³ö¸ß	</code></pre> 
<p>（3）配置MPU6050的设置</p> 
<pre><code class="language-cpp">	MPU_IIC_Init();//初始化IIC总线
	MPU_Write_Byte(MPU_PWR_MGMT1_REG,0X80);	//复位MPU6050
  delay_ms(100);
	MPU_Write_Byte(MPU_PWR_MGMT1_REG,0X00);	//唤醒MPU6050 
	MPU_Set_Gyro_Fsr(3);					//陀螺仪传感器,±2000dps
	MPU_Set_Accel_Fsr(0);					//加速度传感器,±2g
	MPU_Set_Rate(50);						//设置采样率50Hz
	MPU_Write_Byte(MPU_INT_EN_REG,0X00);	//关闭所有中断
	MPU_Write_Byte(MPU_USER_CTRL_REG,0X00);	//I2C主模式关闭
	MPU_Write_Byte(MPU_FIFO_EN_REG,0X00);	//关闭FIFO
	MPU_Write_Byte(MPU_INTBP_CFG_REG,0X80);	//INT引脚低电平有效
	res=MPU_Read_Byte(MPU_DEVICE_ID_REG);
	if(res==MPU_ADDR)//器件ID正确
	{
		MPU_Write_Byte(MPU_PWR_MGMT1_REG,0X01);	//设置CLKSEL,PLL X轴为参考
		MPU_Write_Byte(MPU_PWR_MGMT2_REG,0X00);	//加速度与陀螺仪都工作
		MPU_Set_Rate(50);						//设置采样率为50Hz
 	}</code></pre> 
<p><span style="color:#fe2c24;"><strong>注：这里配置MPU6050的操作，都是通过IIC协议，直接对MPU6050的寄存器进行访问.</strong></span></p> 
<p><span style="color:#fe2c24;"><strong>这里提供一个芯片初始化是否成功的小技巧，通常每个芯片都有自己的芯片ID，通常可以把初始化函数设置为u8类型，通过读取ID是否正确，返回不同类型的值（return 1或0），如：while(mpu_dmp_init())</strong></span></p> 
<h2> 3.MPU6050通信协议分析</h2> 
<p><strong>发送一个字节</strong></p> 
<p>（1）MCU发送一个起始信号。</p> 
<p>（2）传输从机7位地址+读/写位，等待应答信号</p> 
<p>（3）发送寄存器地址，等待应答</p> 
<p>（4）发送1个字节数据，等待应答</p> 
<p>（5）结束信号</p> 
<p>使用IIC写一个字节数据，程序如下：</p> 
<pre><code class="language-cpp">u8 MPU_Write_Byte(u8 reg,u8 data) 				 
{ 
    MPU_IIC_Start(); 
	MPU_IIC_Send_Byte((MPU_ADDR&lt;&lt;1)|0);//发送器件地址+写命令	
	if(MPU_IIC_Wait_Ack())	//等待应答
	{
		MPU_IIC_Stop();		 
		return 1;		
	}
    MPU_IIC_Send_Byte(reg);	//写寄存器地址
    MPU_IIC_Wait_Ack();		//等待应答 
	MPU_IIC_Send_Byte(data);//发送数据
	if(MPU_IIC_Wait_Ack())	//等待ACK
	{
		MPU_IIC_Stop();	 
		return 1;		 
	}		 
    MPU_IIC_Stop();	 
	return 0;
}</code></pre> 
<p> 读取IIC多个字节数据</p> 
<pre><code class="language-cpp">u8 MPU_Read_Len(u8 addr,u8 reg,u8 len,u8 *buf)
{ 
 	MPU_IIC_Start(); 
	MPU_IIC_Send_Byte((addr&lt;&lt;1)|0);//发送器件地址+写命令	
	if(MPU_IIC_Wait_Ack())	//等待应答
	{
		MPU_IIC_Stop();		 
		return 1;		
	}
    MPU_IIC_Send_Byte(reg);	//写寄存器地址
    MPU_IIC_Wait_Ack();		//等待应答
    MPU_IIC_Start();
	MPU_IIC_Send_Byte((addr&lt;&lt;1)|1);//发送器件地址+读命令	
    MPU_IIC_Wait_Ack();		//等待应答 
	while(len)
	{
		if(len==1)*buf=MPU_IIC_Read_Byte(0);//读数据,发送nACK 
		else *buf=MPU_IIC_Read_Byte(1);		//读数据,发送ACK  
		len--;
		buf++; 
	}    
    MPU_IIC_Stop();	//产生一个停止条件 
	return 0;	
}</code></pre> 
<p></p> 
<p>代码连接： </p> 
<blockquote> 
 <p> 链接：https://pan.baidu.com/s/1SKYUonB0yKy9iG6hjabvGQ?pwd=a81l <br> 提取码：a81l</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3fbbd7526bb5195e59a165aed835644d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">From.Item 包裹自定义 RangePicker 组件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/42d7b2dd38f424cf168e8ea80deae593/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux 下 安装多个mysql8.0</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>