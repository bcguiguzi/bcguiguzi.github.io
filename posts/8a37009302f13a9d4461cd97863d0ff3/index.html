<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CAS-Centos7安装CAS服务端 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CAS-Centos7安装CAS服务端" />
<meta property="og:description" content="环境信息 [root@suhw ~]# cat /etc/redhat-release CentOS Linux release 7.7.1908 (Core) [root@suhw ~]# uname -a Linux suhw 3.10.0-1062.4.3.el7.x86_64 #1 SMP Wed Nov 13 23:58:53 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux 安装jdk 查看系统信息 [root@suhw ~]# cat /etc/redhat-release CentOS Linux release 7.7.1908 (Core) [root@suhw ~]# uname -a Linux suhw 3.10.0-1062.4.3.el7.x86_64 #1 SMP Wed Nov 13 23:58:53 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux 查看yum包含的jdk版本 [root@suhw ~]# yum search java 安装jdk [root@suhw ~]# yum install java-1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/8a37009302f13a9d4461cd97863d0ff3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-03T14:26:14+08:00" />
<meta property="article:modified_time" content="2020-06-03T14:26:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CAS-Centos7安装CAS服务端</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>环境信息</h2> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/redhat-release </span>
CentOS Linux release 7.7.1908 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># uname -a</span>
Linux suhw 3.10.0-1062.4.3.el7.x86_64 <span class="token comment">#1 SMP Wed Nov 13 23:58:53 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
</code></pre> 
<hr> 
<h2><a id="jdk_13"></a>安装jdk</h2> 
<h3><a id="_15"></a>查看系统信息</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/redhat-release </span>
CentOS Linux release 7.7.1908 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># uname -a</span>
Linux suhw 3.10.0-1062.4.3.el7.x86_64 <span class="token comment">#1 SMP Wed Nov 13 23:58:53 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
</code></pre> 
<br> 
<h3><a id="yumjdk_26"></a>查看<code>yum</code>包含的<code>jdk</code>版本</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># yum search java</span>
</code></pre> 
<br> 
<h3><a id="jdk_34"></a>安装<code>jdk</code></h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># yum install java-1.8.0-openjdk-devel.x86_64</span>
</code></pre> 
<br> 
<h3><a id="_42"></a>环境变量配置</h3> 
<p>将以下三行内容写入<code>/etc/profile</code>中，<strong><code>JAVA_HOME</code>以实际为准</strong></p> 
<pre><code class="prism language-shell"><span class="token function">export</span> JAVA_HOME<span class="token operator">=</span>/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.252.b09-2.el7_8.x86_64
<span class="token function">export</span> CLASSPATH<span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">$PATH</span><span class="token keyword">:</span><span class="token variable">$JAVA_HOME</span>/bin

</code></pre> 
<br> 
<h3><a id="_55"></a>安装校验</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># source /etc/profile</span>
<span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># java -version</span>
openjdk version <span class="token string">"1.8.0_252"</span>
OpenJDK Runtime Environment <span class="token punctuation">(</span>build 1.8.0_252-b09<span class="token punctuation">)</span>
OpenJDK 64-Bit Server VM <span class="token punctuation">(</span>build 25.252-b09, mixed mode<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h2><a id="Tomcat_69"></a>安装<code>Tomcat</code></h2> 
<h3><a id="_71"></a>下载</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/</span>

<span class="token punctuation">[</span>root@suhw local<span class="token punctuation">]</span><span class="token comment"># wget http://mirrors.hust.edu.cn/apache/tomcat/tomcat-8/v8.5.55/bin/apache-tomcat-8.5.55.tar.gz</span>
</code></pre> 
<br> 
<h3><a id="_81"></a>解压</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw local<span class="token punctuation">]</span><span class="token comment"># tar -zxvf apache-tomcat-8.5.55.tar.gz </span>
<span class="token comment"># 修改名称</span>
<span class="token punctuation">[</span>root@suhw local<span class="token punctuation">]</span><span class="token comment"># mv apache-tomcat-8.5.55 tomcat</span>
</code></pre> 
<br> 
<h3><a id="_91"></a>启动</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># /usr/local/tomcat/bin/startup.sh </span>
Using CATALINA_BASE:   /usr/local/tomcat
Using CATALINA_HOME:   /usr/local/tomcat
Using CATALINA_TMPDIR: /usr/local/tomcat/temp
Using JRE_HOME:        /usr
Using CLASSPATH:       /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar
Tomcat started.
</code></pre> 
<br> 
<h3><a id="_105"></a>关闭</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># /usr/local/tomcat/bin/shutdown.sh </span>
Using CATALINA_BASE:   /usr/local/tomcat
Using CATALINA_HOME:   /usr/local/tomcat
Using CATALINA_TMPDIR: /usr/local/tomcat/temp
Using JRE_HOME:        /usr
Using CLASSPATH:       /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar
</code></pre> 
<br> 
<h3><a id="_118"></a>测试</h3> 
<p>查看默认端口是否监听</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw tomcat<span class="token punctuation">]</span><span class="token comment"># lsof -i:8080</span>
COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
java    9233 root   52u  IPv6  62224      0t0  TCP *:webcache <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span>

</code></pre> 
<p>默认端口配置在<code>/usr/local/tomcat/conf/server.xml</code>中</p> 
<pre><code class="prism language-xml">69     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8080<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HTTP/1.1<span class="token punctuation">"</span></span>
<span class="token attr-name">70</span>                <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span>
<span class="token attr-name">71</span>                <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>访问<code>ip:port</code>，出现下图即为配置成功</p> 
<p><img src="https://images2.imgbox.com/d4/ad/8Sy3fAGL_o.png" alt="image-20200603113100860"></p> 
<p><strong>注：可能需要关闭防火墙</strong></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw tomcat<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --state</span>
running

<span class="token punctuation">[</span>root@suhw tomcat<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld.service</span>
</code></pre> 
<hr> 
<h2><a id="CAS_156"></a><code>CAS</code>安装</h2> 
<h3><a id="_158"></a>下载</h3> 
<p>下载地址</p> 
<p>https://github.com/apereo/cas/releases/tag/v4.0.0</p> 
<br> 
<h3><a id="_166"></a>解压</h3> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># unzip cas-server-4.0.0-release.zip </span>
<span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># cd cas-server-4.0.0/modules/</span>
<span class="token comment"># 重命令为 cas.war</span>
<span class="token punctuation">[</span>root@suhw modules<span class="token punctuation">]</span><span class="token comment"># mv cas-server-webapp-4.0.0.war cas.war</span>
<span class="token comment"># 将cas.war 拷贝至 tomcat/webapps/ 下</span>
<span class="token punctuation">[</span>root@suhw modules<span class="token punctuation">]</span><span class="token comment"># cp cas.war /usr/local/tomcat/webapps/</span>
</code></pre> 
<br> 
<h3><a id="_179"></a>配置</h3> 
<p><code>tomcat</code>会自动解析<code>war</code>包，构建<code>web</code>项目<code>cas</code></p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># ll /usr/local/tomcat/webapps/</span>
total 24460
drwxr-x---.  7 root root      108 Jun  3 12:05 cas
-rw-r--r--.  1 root root 25038970 Jun  3 12:05 cas.war
drwxr-x---. 16 root root     4096 Jun  3 11:12 docs
drwxr-x---.  6 root root       83 Jun  3 11:12 examples
drwxr-x---.  5 root root       87 Jun  3 11:12 host-manager
drwxr-x---.  5 root root      103 Jun  3 11:12 manager
drwxr-x---.  3 root root      283 Jun  3 11:12 ROOT
</code></pre> 
<br> 
<h4><a id="_197"></a>端口修改</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@suhw ~<span class="token punctuation">]</span><span class="token comment"># vi /usr/local/tomcat/webapps/cas/WEB-INF/cas.properties </span>
</code></pre> 
<p>确保 <code>cas</code>与<code>tomcat</code>端口一致</p> 
<pre><code>20 server.name=http://localhost:8080
21 server.prefix=${server.name}/cas
</code></pre> 
<br> 
<h4><a id="https_212"></a>去除<code>https</code>校验</h4> 
<p><code>cas</code>默认使用<code>https</code>模式，由于没配置证书，所以取消<code>https</code></p> 
<p>1、修改<code>/usr/local/tomcat/webapps/cas/WEB-INF/deployerConfigContext.xml</code></p> 
<p>末尾增加<code>p:requireSecure="false"</code></p> 
<pre><code class="prism language-xml">90     <span class="token comment">&lt;!-- Required for proxy ticket mechanism. --&gt;</span>
91     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>proxyAuthenticationHandler<span class="token punctuation">"</span></span>
<span class="token attr-name">92</span>           <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler<span class="token punctuation">"</span></span>
<span class="token attr-name">93</span>           <span class="token attr-name"><span class="token namespace">p:</span>httpClient-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>httpClient<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">p:</span>requireSecure</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>2、修改<code>/usr/local/tomcat/webapps/cas/WEB-INF/spring-configuration/ticketGrantingTicketCookieGenerator.xml</code></p> 
<p>将<code>cookieSecure</code>置为<code>false</code></p> 
<pre><code> 31                 p:cookieSecure="false"
</code></pre> 
<p>3、修改<code>/usr/local/tomcat/webapps/cas/WEB-INF/spring-configuration/warnCookieGenerator.xml</code></p> 
<p>同样将<code>cookieSecure</code>置为<code>false</code></p> 
<pre><code> 32                 p:cookieSecure="false"
</code></pre> 
<br> 
<h3><a id="tomcat_249"></a>重启<code>tomcat</code></h3> 
<p>重启完成后访问<code>http://ip:port/cas/login</code></p> 
<p><img src="https://images2.imgbox.com/a6/21/hdfjeQOu_o.png" alt="image-20200603132053029"></p> 
<p>在<code>usr/local/tomcat/webapps/cas/WEB-INF/deployerConfigContext.xml</code>中有默认用户名密码</p> 
<table><thead><tr><th><code>username</code></th><th><code>password</code></th></tr></thead><tbody><tr><td><code>casuser</code></td><td><code>Mellon</code></td></tr></tbody></table> 
<pre><code>    109         &lt;property name="users"&gt;
    110             &lt;map&gt;
    111                 &lt;entry key="casuser" value="Mellon"/&gt;
    112             &lt;/map&gt;
    113         &lt;/property&gt;

</code></pre> 
<br> 
<p>使用默认用户名密码登录成功效果如下</p> 
<p><img src="https://images2.imgbox.com/d9/ae/x9OR17N8_o.png" alt="image-20200603132425465"></p> 
<p>退出登录访问<code>/cas/logout</code>即可</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/acb799b0774c279b35a9a1fccf451d0e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2020年如何卸载/退出亚信安全防毒墙网络版</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5aa38b1ddc0737265ea489508ffbd74d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">今日头条算法原理（全文）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>