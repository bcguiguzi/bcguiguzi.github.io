<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>V8引擎静态库及其调用方法 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="V8引擎静态库及其调用方法" />
<meta property="og:description" content="本V8引擎静态库分为x86版本和x64版本
V8引擎静态库下载地址
编译工具：VS2019
v8开头的即为V8引擎静态库（附送其它开源静态库libuv.lib、zlib.lib等_）
如何调用V8引擎
1、下载v8静态库到本地
2、配置开发环境
将上述v8的include目录配置到“附加包含目录”配置项中
根据你的开发环境配置不同版本的lib库（注意debug和release），如下：
3、调用代码如下，需要创建一个控制台程序
#include &lt;iostream&gt; #include &#34;v8.h&#34; #include &#34;libplatform/libplatform.h&#34; #include &lt;assert.h&gt; #include &lt;windows.h&gt; #pragma comment(lib, &#34;winmm.lib&#34;) #pragma comment(lib, &#34;dbghelp.lib&#34;) #pragma comment(lib, &#34;shlwapi.lib&#34;) #pragma comment(lib, &#34;v8_compiler.lib&#34;) #pragma comment(lib, &#34;v8_libbase.lib&#34;) #pragma comment(lib, &#34;v8_snapshot.lib&#34;) #pragma comment(lib, &#34;v8_libplatform.lib&#34;) #pragma comment(lib, &#34;v8_libsampler.lib&#34;) #pragma comment(lib, &#34;v8_init.lib&#34;) #pragma comment(lib, &#34;v8_initializers.lib&#34;) #pragma comment(lib, &#34;v8_zlib.lib&#34;) #pragma comment(lib, &#34;icudata.lib&#34;) #pragma comment(lib, &#34;icutools.lib&#34;) #pragma comment(lib, &#34;icuucx.lib&#34;) #pragma comment(lib, &#34;icui18n.lib&#34;) #pragma comment(lib, &#34;v8_base_without_compiler.lib&#34;) using namespace v8; using namespace std; wstring Utf8ToUnicode(const string&amp; strSrc) { /*!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/14ef5a596bfaf7fb12bde501d1ec94b1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-24T16:25:17+08:00" />
<meta property="article:modified_time" content="2021-05-24T16:25:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">V8引擎静态库及其调用方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>本V8引擎静态库分为x86版本和x64版本</strong></p> 
<p><a href="http://47.117.114.161:8000/v8.rar" rel="nofollow">V8引擎静态库下载地址</a><br> 编译工具：VS2019</p> 
<p>v8开头的即为V8引擎静态库（附送其它开源静态库libuv.lib、zlib.lib等<sup>_</sup>）<br> <img src="https://images2.imgbox.com/72/79/gdmlFV7y_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/d5/bf/mqcswWOj_o.png" alt="在这里插入图片描述"><br> <strong>如何调用V8引擎</strong><br> 1、下载v8静态库到本地<br> 2、配置开发环境<br> 将上述v8的include目录配置到“附加包含目录”配置项中<br> <img src="https://images2.imgbox.com/cd/54/olOw4h9p_o.png" alt="在这里插入图片描述"><br> 根据你的开发环境配置不同版本的lib库（注意debug和release），如下：<br> <img src="https://images2.imgbox.com/9a/35/kO42O57n_o.png" alt="在这里插入图片描述"><br> 3、调用代码如下，需要创建一个控制台程序</p> 
<pre><code class="prism language-cpp">
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"v8.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"libplatform/libplatform.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;windows.h&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "winmm.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "dbghelp.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "shlwapi.lib")</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "v8_compiler.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "v8_libbase.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "v8_snapshot.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "v8_libplatform.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "v8_libsampler.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "v8_init.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "v8_initializers.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "v8_zlib.lib") </span>

<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "icudata.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "icutools.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "icuucx.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "icui18n.lib") </span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "v8_base_without_compiler.lib") </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> v8<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

wstring <span class="token function">Utf8ToUnicode</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> strSrc<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*!&lt; 分配目标空间 */</span>
	<span class="token keyword">int</span> iAllocSize <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>strSrc<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	WCHAR<span class="token operator">*</span> pwszBuffer <span class="token operator">=</span> <span class="token keyword">new</span> WCHAR<span class="token punctuation">[</span>iAllocSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> pwszBuffer<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> L<span class="token string">""</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> iCharsRet <span class="token operator">=</span> <span class="token function">MultiByteToWideChar</span><span class="token punctuation">(</span>CP_UTF8<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> strSrc<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>strSrc<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		pwszBuffer<span class="token punctuation">,</span> iAllocSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/*!&lt; 成功 */</span>
	wstring wstrRet<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> iCharsRet<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		wstrRet<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>pwszBuffer<span class="token punctuation">,</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>size_t<span class="token operator">&gt;</span><span class="token punctuation">(</span>iCharsRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/*!&lt; 释放内存 */</span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pwszBuffer<span class="token punctuation">;</span>

	<span class="token keyword">return</span> wstrRet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
string <span class="token function">Utf8ToAnsi</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> strSrc<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	wstring wstrTemp <span class="token operator">=</span> <span class="token function">Utf8ToUnicode</span><span class="token punctuation">(</span>strSrc<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/*!&lt; 分配目标空间, 长度为 Ansi 编码的两倍 */</span>
	<span class="token keyword">int</span> iAllocSize <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>strSrc<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span><span class="token operator">*</span> pszBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>iAllocSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> pszBuffer<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> iCharsRet <span class="token operator">=</span> <span class="token function">WideCharToMultiByte</span><span class="token punctuation">(</span>CP_ACP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> wstrTemp<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>wstrTemp<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		pszBuffer<span class="token punctuation">,</span> iAllocSize<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/*!&lt; 成功 */</span>
	string strRet<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> iCharsRet<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		strRet<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>pszBuffer<span class="token punctuation">,</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>size_t<span class="token operator">&gt;</span><span class="token punctuation">(</span>iCharsRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/*!&lt; 释放内存 */</span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pszBuffer<span class="token punctuation">;</span>

	<span class="token keyword">return</span> strRet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string <span class="token function">UnicodeToUtf8</span><span class="token punctuation">(</span><span class="token keyword">const</span> wstring<span class="token operator">&amp;</span> wstrSrc<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*!&lt; 分配目标空间, 一个16位Unicode字符最多可以转为4个字节 */</span>
	<span class="token keyword">int</span> iAllocSize <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>wstrSrc<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span><span class="token operator">*</span> pszBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>iAllocSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> pszBuffer<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> iCharsRet <span class="token operator">=</span> <span class="token function">WideCharToMultiByte</span><span class="token punctuation">(</span>CP_UTF8<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> wstrSrc<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>wstrSrc<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		pszBuffer<span class="token punctuation">,</span> iAllocSize<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/*!&lt; 成功 */</span>
	string strRet<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> iCharsRet<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		strRet<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>pszBuffer<span class="token punctuation">,</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>size_t<span class="token operator">&gt;</span><span class="token punctuation">(</span>iCharsRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/*!&lt; 释放内存 */</span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pszBuffer<span class="token punctuation">;</span>

	<span class="token keyword">return</span> strRet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string <span class="token function">AnsiToUtf8</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> strSrc<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*!&lt; 分配目标空间, 长度为 Ansi 编码的两倍 */</span>
	<span class="token keyword">int</span> iAllocSize <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>strSrc<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	WCHAR<span class="token operator">*</span> pwszBuffer <span class="token operator">=</span> <span class="token keyword">new</span> WCHAR<span class="token punctuation">[</span>iAllocSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> pwszBuffer<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> iCharsRet <span class="token operator">=</span> <span class="token function">MultiByteToWideChar</span><span class="token punctuation">(</span>CP_ACP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> strSrc<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>strSrc<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		pwszBuffer<span class="token punctuation">,</span> iAllocSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/*!&lt; 成功 */</span>
	wstring wstrTemp<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> iCharsRet<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		wstrTemp<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>pwszBuffer<span class="token punctuation">,</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>size_t<span class="token operator">&gt;</span><span class="token punctuation">(</span>iCharsRet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/*!&lt; 释放内存 */</span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pwszBuffer<span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token function">UnicodeToUtf8</span><span class="token punctuation">(</span>wstrTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


Local<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token function">ToLocalString</span><span class="token punctuation">(</span>Isolate<span class="token operator">*</span> isolate<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> pData<span class="token punctuation">,</span> <span class="token keyword">int</span> iDataLen<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> String<span class="token operator">::</span><span class="token function">NewFromOneByte</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token keyword">reinterpret_cast</span><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">uint8_t</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>pData<span class="token punctuation">)</span><span class="token punctuation">,</span>
		NewStringType<span class="token operator">::</span>kNormal<span class="token punctuation">,</span> iDataLen<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CPerson</span>
<span class="token punctuation">{<!-- --></span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">CPerson</span><span class="token punctuation">(</span><span class="token keyword">int</span> iAge <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		m_iAge <span class="token operator">=</span> iAge<span class="token punctuation">;</span>
		m_pszName <span class="token operator">=</span> <span class="token string">"小ming"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">CPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"============~CPerson()============\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token keyword">const</span> FunctionCallbackInfo<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span><span class="token operator">&amp;</span> args<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">assert</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">IsConstructCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		Isolate<span class="token operator">*</span> isolate <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">GetIsolate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">int</span> iAge <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">Length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
			iAge <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>As<span class="token operator">&lt;</span>Int32<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		Handle<span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span> object <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">Holder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		object<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetInternalField</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> External<span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token function">CPerson</span><span class="token punctuation">(</span>iAge<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetAge</span><span class="token punctuation">(</span><span class="token keyword">const</span> FunctionCallbackInfo<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span><span class="token operator">&amp;</span> args<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 通过参数args获取Wrap对象</span>
		Local<span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span> self <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">Holder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Local<span class="token operator">&lt;</span>External<span class="token operator">&gt;</span> wrap <span class="token operator">=</span> Local<span class="token operator">&lt;</span>External<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">Cast</span><span class="token punctuation">(</span>self<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">GetInternalField</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">void</span><span class="token operator">*</span> ptr <span class="token operator">=</span> wrap<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		CPerson<span class="token operator">*</span> pThis <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>CPerson<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

		args<span class="token punctuation">.</span><span class="token function">GetReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>pThis<span class="token operator">-</span><span class="token operator">&gt;</span>m_iAge<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token keyword">const</span> FunctionCallbackInfo<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span><span class="token operator">&amp;</span> args<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 通过参数args获取Wrap对象</span>
		Local<span class="token operator">&lt;</span>Object<span class="token operator">&gt;</span> self <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">Holder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Local<span class="token operator">&lt;</span>External<span class="token operator">&gt;</span> wrap <span class="token operator">=</span> Local<span class="token operator">&lt;</span>External<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">Cast</span><span class="token punctuation">(</span>self<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">GetInternalField</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">void</span><span class="token operator">*</span> ptr <span class="token operator">=</span> wrap<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		Isolate<span class="token operator">*</span> isolate <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">GetIsolate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		CPerson<span class="token operator">*</span> pThis <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>CPerson<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

		string strUTF8 <span class="token operator">=</span> <span class="token function">AnsiToUtf8</span><span class="token punctuation">(</span>pThis<span class="token operator">-</span><span class="token operator">&gt;</span>m_pszName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		Local<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> strName <span class="token operator">=</span> String<span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> strUTF8<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			NewStringType<span class="token operator">::</span>kInternalized<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//Local&lt;String&gt; strName = ToLocalString(isolate, (const unsigned char*)pThis-&gt;m_pszName, strlen(pThis-&gt;m_pszName));</span>
		args<span class="token punctuation">.</span><span class="token function">GetReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>strName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">int</span> m_iAge<span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> m_pszName<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">void</span> <span class="token function">TestFuncByJsCall</span><span class="token punctuation">(</span><span class="token keyword">const</span> FunctionCallbackInfo<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span><span class="token operator">&amp;</span> args<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Isolate<span class="token operator">*</span> isolate <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">GetIsolate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> iLen <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">Length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>iLen <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">IsInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">IsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	Local<span class="token operator">&lt;</span>Context<span class="token operator">&gt;</span> context <span class="token operator">=</span> isolate<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">GetCurrentContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Int32Value</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">To</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	String<span class="token operator">::</span>Utf8Value <span class="token function">str</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token comment">//cout &lt;&lt; *str &lt;&lt; "\n";</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"进入函数："</span> <span class="token operator">&lt;&lt;</span> __FUNCTION__ <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">", \""</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>str <span class="token operator">&lt;&lt;</span> <span class="token string">"\")"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
	args<span class="token punctuation">.</span><span class="token function">GetReturnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">PersistentToLocal</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">// If persistent.IsWeak() == false, then do not call persistent.Reset()</span>
	<span class="token comment">// while the returned Local&lt;T&gt; is still in scope, it will destroy the</span>
	<span class="token comment">// reference to the object.</span>
	<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">TypeName</span><span class="token operator">&gt;</span>
	<span class="token keyword">static</span> <span class="token keyword">inline</span> v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>TypeName<span class="token operator">&gt;</span> <span class="token function">Default</span><span class="token punctuation">(</span>v8<span class="token operator">::</span>Isolate<span class="token operator">*</span> isolate<span class="token punctuation">,</span>
		<span class="token keyword">const</span> v8<span class="token operator">::</span>PersistentBase<span class="token operator">&lt;</span>TypeName<span class="token operator">&gt;</span><span class="token operator">&amp;</span> persistent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>persistent<span class="token punctuation">.</span><span class="token function">IsWeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> PersistentToLocal<span class="token operator">::</span><span class="token function">Weak</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> persistent<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> PersistentToLocal<span class="token operator">::</span><span class="token function">Strong</span><span class="token punctuation">(</span>persistent<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Unchecked conversion from a non-weak Persistent&lt;T&gt; to Local&lt;T&gt;,</span>
<span class="token comment">// use with care!</span>
<span class="token comment">//</span>
<span class="token comment">// Do not call persistent.Reset() while the returned Local&lt;T&gt; is still in</span>
<span class="token comment">// scope, it will destroy the reference to the object.</span>
	<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">TypeName</span><span class="token operator">&gt;</span>
	<span class="token keyword">static</span> <span class="token keyword">inline</span> v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>TypeName<span class="token operator">&gt;</span> <span class="token function">Strong</span><span class="token punctuation">(</span>
		<span class="token keyword">const</span> v8<span class="token operator">::</span>PersistentBase<span class="token operator">&lt;</span>TypeName<span class="token operator">&gt;</span><span class="token operator">&amp;</span> persistent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">reinterpret_cast</span><span class="token operator">&lt;</span>v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>TypeName<span class="token operator">&gt;</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
			<span class="token keyword">const_cast</span><span class="token operator">&lt;</span>v8<span class="token operator">::</span>PersistentBase<span class="token operator">&lt;</span>TypeName<span class="token operator">&gt;</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>persistent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">TypeName</span><span class="token operator">&gt;</span>
	<span class="token keyword">static</span> <span class="token keyword">inline</span> v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>TypeName<span class="token operator">&gt;</span> <span class="token function">Weak</span><span class="token punctuation">(</span>
		v8<span class="token operator">::</span>Isolate<span class="token operator">*</span> isolate<span class="token punctuation">,</span>
		<span class="token keyword">const</span> v8<span class="token operator">::</span>PersistentBase<span class="token operator">&lt;</span>TypeName<span class="token operator">&gt;</span><span class="token operator">&amp;</span> persistent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> v8<span class="token operator">::</span>Local<span class="token operator">&lt;</span>TypeName<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> persistent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
	<span class="token comment">// V8初试化.</span>
	V8<span class="token operator">::</span><span class="token function">InitializeICU</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 加载快照文件：natives_blob.bin、snapshot_blob.bin</span>
	V8<span class="token operator">::</span><span class="token function">InitializeICUDefaultLocation</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//V8::InitializeExternalStartupData(argv[0]);</span>
<span class="token comment">//	V8::InitializeExternalStartupDataFromFile("E:/VS2019/TestV8/x64/Debug/natives_blob.bin");</span>
<span class="token comment">//	V8::InitializeExternalStartupDataFromFile("E:/VS2019/TestV8/x64/Debug/snapshot_blob.bin");</span>

	<span class="token comment">// 生成一个默认的platform对象</span>
	std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>Platform<span class="token operator">&gt;</span> platform <span class="token operator">=</span> platform<span class="token operator">::</span><span class="token function">NewDefaultPlatform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 初始化platform</span>
	V8<span class="token operator">::</span><span class="token function">InitializePlatform</span><span class="token punctuation">(</span>platform<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// V8的初始化</span>
	V8<span class="token operator">::</span><span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	std<span class="token operator">::</span>ofstream trace_file<span class="token punctuation">;</span>
	platform<span class="token operator">::</span>InProcessStackDumping in_process_stack_dumping <span class="token operator">=</span> <span class="token comment">// v8::platform::InProcessStackDumping::kDisabled;</span>
		platform<span class="token operator">::</span>InProcessStackDumping<span class="token operator">::</span>kEnabled<span class="token punctuation">;</span>

	<span class="token comment">// 创建isolate.</span>
	Isolate<span class="token operator">::</span>CreateParams create_params<span class="token punctuation">;</span>
	create_params<span class="token punctuation">.</span>array_buffer_allocator <span class="token operator">=</span> ArrayBuffer<span class="token operator">::</span>Allocator<span class="token operator">::</span><span class="token function">NewDefaultAllocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Isolate<span class="token operator">*</span> isolate <span class="token operator">=</span> Isolate<span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>create_params<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">{<!-- --></span>
		HandleScope <span class="token function">scope</span><span class="token punctuation">(</span>isolate<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// start v8 trace</span>
		<span class="token comment">//platform::tracing::TraceConfig* trace_config;</span>
		<span class="token comment">//trace_config = v8::platform::tracing::TraceConfig::CreateDefaultTraceConfig();</span>
		<span class="token comment">//tracing_controller-&gt;StartTracing(trace_config);</span>

		Local<span class="token operator">&lt;</span>Context<span class="token operator">&gt;</span> context <span class="token operator">=</span> Context<span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">)</span><span class="token punctuation">;</span>
		Context<span class="token operator">::</span>Scope <span class="token function">context_scope</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/</span>
		<span class="token comment">// 一、执行JS脚本中的函数</span>
		<span class="token comment">/</span>
		Local<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> source <span class="token operator">=</span> String<span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span>
			<span class="token string">"function add(a, b){   var vmap = new Map(); vmap.set(\"123\", 1234); return vmap.get(\"123\");} add(1,1);"</span><span class="token punctuation">,</span>
			NewStringType<span class="token operator">::</span>kNormal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		Local<span class="token operator">&lt;</span>Script<span class="token operator">&gt;</span> script <span class="token operator">=</span> Script<span class="token operator">::</span><span class="token function">Compile</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Local<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span> result <span class="token operator">=</span> script<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Run</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">IsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Test V8 jet : add(1,1) = "</span> <span class="token operator">&lt;&lt;</span> Int32<span class="token operator">::</span><span class="token function">Cast</span><span class="token punctuation">(</span><span class="token operator">*</span>result<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>


		<span class="token comment">//const char* pszFuncName = "func";</span>
		<span class="token comment">//Local&lt;String&gt; strFuncName = ToLocalString(isolate, (const unsigned char*)pszFuncName, strlen(pszFuncName));</span>


		<span class="token comment">/</span>
		<span class="token comment">// 二、JS调用C函数</span>
		<span class="token comment">/</span>
		<span class="token comment">//Local&lt;ObjectTemplate&gt; global_template = ObjectTemplate::New(isolate);</span>
		<span class="token comment">//global_template-&gt;Set(isolate, "TestFunc", FunctionTemplate::New(isolate, TestFuncByJsCall));</span>

		context<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Set</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> String<span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"TestFunc"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			Function<span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> TestFuncByJsCall<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FromJust</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Local<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> jsCall <span class="token operator">=</span> String<span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span>
			<span class="token string">"TestFunc(1, 'Call From C++');"</span><span class="token punctuation">,</span> NewStringType<span class="token operator">::</span>kNormal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		Local<span class="token operator">&lt;</span>Script<span class="token operator">&gt;</span> scriptFunc<span class="token punctuation">;</span>
		Local<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span> ret<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>Script<span class="token operator">::</span><span class="token function">Compile</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> jsCall<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>scriptFunc<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
			scriptFunc<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Run</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">IsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Test V8 jet : TestFuncByJsCall = "</span> <span class="token operator">&lt;&lt;</span> Int32<span class="token operator">::</span><span class="token function">Cast</span><span class="token punctuation">(</span><span class="token operator">*</span>ret<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">/</span>
		<span class="token comment">// 三、JS调用C++类</span>
		<span class="token comment">/</span>
		Local<span class="token operator">&lt;</span>FunctionTemplate<span class="token operator">&gt;</span> clsPerson <span class="token operator">=</span> FunctionTemplate<span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> CPerson<span class="token operator">::</span>New<span class="token punctuation">,</span>
			Local<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Local<span class="token operator">&lt;</span>Signature<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
			ConstructorBehavior<span class="token operator">::</span>kAllow<span class="token punctuation">,</span> SideEffectType<span class="token operator">::</span>kHasSideEffect<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> pszClsName <span class="token operator">=</span> <span class="token string">"Person"</span><span class="token punctuation">;</span>
		Local<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> clsName <span class="token operator">=</span> <span class="token function">ToLocalString</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>pszClsName<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pszClsName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		clsPerson<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetClassName</span><span class="token punctuation">(</span>clsName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		Local<span class="token operator">&lt;</span>ObjectTemplate<span class="token operator">&gt;</span> objPerson <span class="token operator">=</span> clsPerson<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">InstanceTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		objPerson<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetInternalFieldCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 1、设置CPerson类的构造函数到全局Global中</span>
		context<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Set</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> clsName<span class="token punctuation">,</span> clsPerson<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">GetFunction</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 2、设置GetAge方法到CPerson类中</span>
		Local<span class="token operator">&lt;</span>Signature<span class="token operator">&gt;</span> signature <span class="token operator">=</span> Signature<span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> clsPerson<span class="token punctuation">)</span><span class="token punctuation">;</span>
		Local<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> NameGetAge <span class="token operator">=</span> String<span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"GetAge"</span><span class="token punctuation">,</span>
			NewStringType<span class="token operator">::</span>kInternalized<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		Local<span class="token operator">&lt;</span>FunctionTemplate<span class="token operator">&gt;</span> t <span class="token operator">=</span> FunctionTemplate<span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> CPerson<span class="token operator">::</span>GetAge<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">/*Local&lt;Value&gt;(), signature, 0, ConstructorBehavior::kThrow,
		SideEffectType::kHasSideEffectToReceiver);*/</span>

		clsPerson<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">PrototypeTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Set</span><span class="token punctuation">(</span>NameGetAge<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//clsPerson-&gt;PrototypeTemplate()-&gt;Set(isolate, "GetAge", t);</span>
		t<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetClassName</span><span class="token punctuation">(</span>NameGetAge<span class="token punctuation">)</span><span class="token punctuation">;</span>
		objPerson<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Set</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"GetAge"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
		objPerson<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Set</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"GetName"</span><span class="token punctuation">,</span> FunctionTemplate<span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> CPerson<span class="token operator">::</span>GetName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


		<span class="token comment">//	PersistentBase&lt;FunctionTemplate&gt;::Strong(Person_NEW);</span>
		<span class="token comment">// 3、执行脚本</span>
		Local<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> jsPerson <span class="token operator">=</span> String<span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span>
			<span class="token string">" var Values; "</span>
			<span class="token string">" function TestPerson(i){	var person = new Person(i); "</span>
			<span class="token string">" Values = person.GetName(); "</span>
			<span class="token comment">//" person.GetPage = OnGetPage();"</span>
			<span class="token string">" person = null; return Values;	 "</span>
			<span class="token string">"}	"</span>
			<span class="token string">"TestPerson(42);"</span><span class="token punctuation">,</span>
			NewStringType<span class="token operator">::</span>kNormal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// return person.GetAge();</span>
		Local<span class="token operator">&lt;</span>Script<span class="token operator">&gt;</span> scriptClass<span class="token punctuation">;</span>
		Local<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span> retClass<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>Script<span class="token operator">::</span><span class="token function">Compile</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> jsPerson<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>scriptClass<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
			scriptClass<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Run</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>retClass<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>retClass<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">IsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Test V8 jet : Person = GetAge() "</span> <span class="token operator">&lt;&lt;</span> Int32<span class="token operator">::</span><span class="token function">Cast</span><span class="token punctuation">(</span><span class="token operator">*</span>retClass<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>retClass<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">IsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				String<span class="token operator">::</span>Utf8Value <span class="token function">str</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> retClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
				string strName <span class="token operator">=</span> <span class="token function">Utf8ToAnsi</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
				std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Test V8 jet : Person = GetName() "</span> <span class="token operator">&lt;&lt;</span> strName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// C++调用JS中的变量和函数</span>
			Local<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> strValues <span class="token operator">=</span> String<span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"Values"</span><span class="token punctuation">,</span> NewStringType<span class="token operator">::</span>kNormal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			Local<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span> jsValues <span class="token operator">=</span> context<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Get</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> strValues<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			Local<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span> jsFunc <span class="token operator">=</span> context<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Get</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>
				String<span class="token operator">::</span><span class="token function">NewFromUtf8</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token string">"TestPerson"</span><span class="token punctuation">,</span> NewStringType<span class="token operator">::</span>kNormal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocalChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>jsValues<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"empty\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>jsValues<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">IsInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">int</span> iAge <span class="token operator">=</span> jsValues<span class="token punctuation">.</span>As<span class="token operator">&lt;</span>Int32<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"C++ Call JS values: %d\n"</span><span class="token punctuation">,</span> iAge<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>jsValues<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">IsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				String<span class="token operator">::</span>Utf8Value <span class="token function">str</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> jsValues<span class="token punctuation">)</span><span class="token punctuation">;</span>
				string strName <span class="token operator">=</span> <span class="token function">Utf8ToAnsi</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"C++ Call JS values: %s\n"</span><span class="token punctuation">,</span> strName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>jsFunc<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">IsFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Local<span class="token operator">&lt;</span>Function<span class="token operator">&gt;</span> callback <span class="token operator">=</span> jsFunc<span class="token punctuation">.</span>As<span class="token operator">&lt;</span>Function<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				Local<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span> recv <span class="token operator">=</span> <span class="token function">Undefined</span><span class="token punctuation">(</span>isolate<span class="token punctuation">)</span><span class="token punctuation">;</span>
				Local<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span> ret_v<span class="token punctuation">;</span>
				Local<span class="token operator">&lt;</span>Value<span class="token operator">&gt;</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Integer<span class="token operator">::</span><span class="token function">New</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				callback<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> recv<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLocal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ret_v<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>ret_v<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">IsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					String<span class="token operator">::</span>Utf8Value <span class="token function">str</span><span class="token punctuation">(</span>isolate<span class="token punctuation">,</span> ret_v<span class="token punctuation">)</span><span class="token punctuation">;</span>
					string strName <span class="token operator">=</span> <span class="token function">Utf8ToAnsi</span><span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"C++ Call JS Fuction: %s\n"</span><span class="token punctuation">,</span> strName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token comment">// end JS调用C++类</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">char</span> c<span class="token punctuation">;</span>
	std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> c<span class="token punctuation">;</span>

	<span class="token comment">// 关掉v8.</span>
	isolate<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	V8<span class="token operator">::</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	V8<span class="token operator">::</span><span class="token function">ShutdownPlatform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	platform<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4bddfb1f1c24e420f933e66e5ccc1476/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ubuntu(linux)系统查看文件夹下有多少文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2f76f4946393fa3a0d1bead2302db17c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Wireshark中无法显示网卡列表的解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>