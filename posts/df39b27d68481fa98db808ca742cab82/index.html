<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springboot3整合支付宝沙箱网页版 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="springboot3整合支付宝沙箱网页版" />
<meta property="og:description" content="1.maven依赖：
&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alipay.sdk&lt;/groupId&gt; &lt;artifactId&gt;alipay-sdk-java&lt;/artifactId&gt; &lt;version&gt;4.35.79.ALL&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.8.0&lt;/version&gt; &lt;/dependency&gt; 2. application.yml 包括支付宝沙箱appid, 私钥，支付宝公钥等，因为需要回调，先要配置外网接口，这里使用了natapp, 配置如下：
alipay: appId: appPrivateKey: alipayPublicKey: notifyUrl: http://vwe3ye.natappfree.cc/alipay/notify serverUrl: https://openapi-sandbox.dl.alipaydev.com/gateway.do format: json charset: UTF-8 signType: RSA2 returnUrl: http://localhost:8080/orders 3.config文件：
@Component @ConfigurationProperties(prefix = &#34;alipay&#34;) public class AliPayConfig { private String appId; private String appPrivateKey; private String alipayPublicKey; private String notifyUrl; private String serverUrl; private String format; private String charset; private String signType; private String returnUrl; ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/df39b27d68481fa98db808ca742cab82/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-31T08:24:30+08:00" />
<meta property="article:modified_time" content="2024-01-31T08:24:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springboot3整合支付宝沙箱网页版</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1.maven依赖：</p> 
<pre>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alipay.sdk&lt;/groupId&gt;
    &lt;artifactId&gt;alipay-sdk-java&lt;/artifactId&gt;
    &lt;version&gt;4.35.79.ALL&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
    &lt;version&gt;5.8.0&lt;/version&gt;
&lt;/dependency&gt;</pre> 
<p>2. application.yml 包括支付宝沙箱appid, 私钥，支付宝公钥等，因为需要回调，先要配置外网接口，这里使用了natapp, 配置如下：</p> 
<pre>alipay:
  appId: 
  appPrivateKey: 
  alipayPublicKey: 
  notifyUrl: http://vwe3ye.natappfree.cc/alipay/notify
  serverUrl: https://openapi-sandbox.dl.alipaydev.com/gateway.do
  format: json
  charset: UTF-8
  signType: RSA2
  returnUrl: http://localhost:8080/orders</pre> 
<p>3.config文件：</p> 
<pre>@Component
@ConfigurationProperties(prefix = "alipay")
public class AliPayConfig {

    private String appId;
    private String appPrivateKey;
    private String alipayPublicKey;

    private String notifyUrl;

    private String  serverUrl;

    private String format;
    private String charset;
    private String signType;

    private String returnUrl;</pre> 
<p>...  setters()、 getters()</p> 
<p>}</p> 
<p>4.编写controller：</p> 
<pre> @RequestMapping("/pay")
    public void pay4(HttpServletResponse response) throws AlipayApiException, IOException {
        AlipayClient client = new DefaultAlipayClient(aliPayConfig.getServerUrl(),
                aliPayConfig.getAppId(),
                aliPayConfig.getAppPrivateKey(),
                aliPayConfig.getFormat(),
                aliPayConfig.getCharset()
                , aliPayConfig.getAlipayPublicKey(),
                aliPayConfig.getSignType());
        AlipayTradePagePayRequest request = new AlipayTradePagePayRequest();
        AlipayTradePagePayModel model = new AlipayTradePagePayModel();
        model.setOutTradeNo("20240129"+new Random().nextInt(100000));
        model.setTotalAmount("88.88");
        model.setSubject("Iphone6 16G");
        model.setProductCode("FAST_INSTANT_TRADE_PAY");
        request.setBizModel(model);
//        request.setNotifyUrl("http://9w2mpf.natappfree.cc/alipay/notify");
        request.setNotifyUrl(aliPayConfig.getNotifyUrl());
        request.setReturnUrl(aliPayConfig.getReturnUrl());
        String form =client.pageExecute(request, "GET").getBody();

        response.sendRedirect(form);

    }</pre> 
<pre>@PostMapping("/notify")
    public String notify(HttpServletRequest request) throws AlipayApiException {
//        System.out.println(request);
        System.out.println("经过notify");
        if(request.getParameter("trade_status").equals("TRADE_SUCCESS")){
            HashMap&lt;String, String&gt; params = new HashMap&lt;&gt;();
            Map&lt;String, String[]&gt; parameterMap = request.getParameterMap();
            for(String name:parameterMap.keySet()){
                params.put(name, request.getParameter(name));
            }
            String sign = params.get("sign");
            String content = AlipaySignature.getSignCheckContentV1(params);
            boolean checkSignatrue =AlipaySignature.rsa256CheckContent(content
                                   , sign, aliPayConfig.getAlipayPublicKey(), CHARSET);
            if(checkSignatrue){
                System.out.println("交易名称 : "+params.get("subject"));
                System.out.println("支付宝订单号：" + params.get("trade_no"));
                System.out.println("本系统交易号: "+ params.get("out_trade_no"));
            }

        }
        return "支付成功";
    }</pre> 
<pre>@RequestMapping("/orders")
public String orders(){
    return "支付完成";
}</pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4a89881784e72f69efc9452b7aaf14a9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解密数据清洗，SQL中的数据分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/efcaecc4f6ebfefa6a9cffb6e97a979c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">A*算法（超级详细讲解，附有举例的详细手写步骤）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>