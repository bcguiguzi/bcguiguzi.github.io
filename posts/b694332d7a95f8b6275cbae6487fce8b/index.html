<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL服务器的管理与维护 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MySQL服务器的管理与维护" />
<meta property="og:description" content="MySQL服务器的管理与维护
1、监控复制
1）、查看主服务器状态：SHOW MASTER STATUS mysql&gt; show master status;
&#43;-------------------&#43;----------&#43;--------------&#43;------------------&#43;
| File | Position | Binlog_Do_DB |Binlog_Ignore_DB |
&#43;-------------------&#43;----------&#43;--------------&#43;------------------&#43;
| master-bin.000011 | 106 | | |
&#43;-------------------&#43;----------&#43;--------------&#43;------------------&#43;
1 row in set (0.04 sec)
2）、显示二进制日志中的事件：SHOW BINLOG EVENTS
SHOW BINLOG EVENTS [IN &#39;log_name&#39;] [FROMpos] [LIMIT [offset,] row_count]
如果不指定&#39;log_name&#39;，则显示第一个二进制日志。
FROMpos：从哪个位置开始
LIMIT[offset,] row_count：显示显示条目，用法同SELECT语句
例：第一个二进制日志，从第十个条目起，取3条目 mysql&gt; show binlog events limit 10,3;
&#43;-------------------&#43;------&#43;------------&#43;-----------&#43;-------------&#43;--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&#43;
| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/b694332d7a95f8b6275cbae6487fce8b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-09T19:56:47+08:00" />
<meta property="article:modified_time" content="2018-06-09T19:56:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL服务器的管理与维护</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>MySQL服务器的管理与维护</strong></p> 
<p><strong>1、监控复制</strong></p> 
<p><strong>1）、查看主服务器状态：SHOW MASTER STATUS </strong></p> 
<p>mysql&gt; show master status;</p> 
<p>+-------------------+----------+--------------+------------------+</p> 
<p>| File              | Position | Binlog_Do_DB |Binlog_Ignore_DB |</p> 
<p>+-------------------+----------+--------------+------------------+</p> 
<p>| master-bin.000011 |      106 |              |                  |</p> 
<p>+-------------------+----------+--------------+------------------+</p> 
<p>1 row in set (0.04 sec)</p> 
<p><strong>2）、显示二进制日志中的事件：SHOW BINLOG EVENTS</strong></p> 
<p>SHOW BINLOG EVENTS [IN 'log_name'] [FROMpos] [LIMIT [offset,] row_count]</p> 
<p>如果不指定'log_name'，则显示第一个二进制日志。</p> 
<p>         FROMpos：从哪个位置开始</p> 
<p>         LIMIT[offset,] row_count：显示显示条目，用法同SELECT语句</p> 
<p><strong>例：第一个二进制日志，从第十个条目起，取3条目       </strong></p> 
<p>mysql&gt; show binlog events limit 10,3;</p> 
<p>+-------------------+------+------------+-----------+-------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</p> 
<p>| Log_name          | Pos | Event_type | Server_id | End_log_pos | Info                                                                                                                                                                                                                                                                                                        |</p> 
<p>+-------------------+------+------------+-----------+-------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</p> 
<p>| master-bin.000001 | 9264 | Query      |        1 |        9615 | use `mysql`;CREATE TABLE IF NOT EXISTS help_category ( help_category_id smallint unsignednot null, name  char(64) not null,parent_category_id smallint unsigned null, url text not null, primary key(help_category_id), unique index (name) ) engine=MyISAM CHARACTER SET utf8comment='help categories' |</p> 
<p>| master-bin.000001 | 9615 | Query      |        1 |        9957 | use `mysql`;CREATE TABLE IF NOT EXISTS help_relation ( help_topic_id int unsigned not nullreferences help_topic, help_keyword_id int unsigned not null references help_keyword, primary key(help_keyword_id, help_topic_id) ) engine=MyISAM CHARACTER SET utf8 comment='keyword-topicrelation'          |</p> 
<p>| master-bin.000001 | 9957 | Query      |        1 |       10238 | use `mysql`;CREATE TABLE IF NOT EXISTS help_keyword (  help_keyword_id  int unsigned notnull, name char(64) not null, primary key (help_keyword_id), unique index(name) ) engine=MyISAM CHARACTER SET utf8 comment='help keywords'                                                                      |</p> 
<p>+-------------------+------+------------+-----------+-------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</p> 
<p>3 rows in set (0.00 sec)</p> 
<p><strong>例：查看master-bin.000010，从第5条起，取3条目</strong></p> 
<p>mysql&gt; show binlog events in'master-bin.000010' LIMIT 5,3;</p> 
<p>+-------------------+-----+------------+-----------+-------------+---------------------+</p> 
<p>| Log_name          | Pos | Event_type | Server_id |End_log_pos | Info                |</p> 
<p>+-------------------+-----+------------+-----------+-------------+---------------------+</p> 
<p>| master-bin.000010 | 550 | Xid        |         1 |         577 | COMMIT /* xid=28 */ |</p> 
<p>| master-bin.000010 | 577 | Query      |        1 |         648 | BEGIN               |</p> 
<p>| master-bin.000010 | 648 | Intvar     |        1 |         676 | INSERT_ID=2         |</p> 
<p>+-------------------+-----+------------+-----------+-------------+---------------------+</p> 
<p>3 rows in set (0.00 sec)</p> 
<p><strong>例：从位置1582开始查看master-bin.000010记录的event</strong></p> 
<p>mysql&gt; show binlog events in'master-bin.000010' from 1582;</p> 
<p>+-------------------+------+------------+-----------+-------------+----------------------------------------------------------------------------------+</p> 
<p>| Log_name          | Pos | Event_type | Server_id | End_log_pos | Info                                                                            |</p> 
<p>+-------------------+------+------------+-----------+-------------+----------------------------------------------------------------------------------+</p> 
<p>| master-bin.000010 | 1582 | Query      |        1 |        1713 | use `ibdatax`;insert into tb_emp value('3','Kin','Man','35','FS','kin@126.com') |</p> 
<p>| master-bin.000010 | 1713 | Xid        |         1 |        1740 | COMMIT /* xid=38 */                                                             |</p> 
<p>| master-bin.000010 | 1740 | Stop       |        1 |        1759 |                                                                                 |</p> 
<p>+-------------------+------+------------+-----------+-------------+----------------------------------------------------------------------------------+</p> 
<p>3 rows in set (0.00 sec)</p> 
<p><strong>例：从位置1582开始查看master-bin.000010记录的event，取2个条目</strong></p> 
<p>mysql&gt; show binlog events in'master-bin.000010' from 1582 limit 2;</p> 
<p>+-------------------+------+------------+-----------+-------------+----------------------------------------------------------------------------------+</p> 
<p>| Log_name          | Pos | Event_type | Server_id | End_log_pos | Info                                                                            |</p> 
<p>+-------------------+------+------------+-----------+-------------+----------------------------------------------------------------------------------+</p> 
<p>| master-bin.000010 | 1582 | Query      |        1 |        1713 | use `ibdatax`;insert into tb_emp value('3','Kin','Man','35','FS','kin@126.com') |</p> 
<p>| master-bin.000010 | 1713 | Xid        |         1 |        1740 | COMMIT /* xid=38 */                                                              |</p> 
<p>+-------------------+------+------------+-----------+-------------+----------------------------------------------------------------------------------+</p> 
<p>2 rows in set (0.00 sec)</p> 
<p> </p> 
<p><strong>3）、查看服务器二进制日志文件： </strong></p> 
<p><strong>SHOWBINARY LOGS</strong></p> 
<p><strong>SHOWMASTER LOGS</strong></p> 
<p>常用于确定确定哪些日志可以被清除（PURGE BINARY LOGS）。</p> 
<p>mysql&gt; show binary logs;</p> 
<p>+-------------------+-----------+</p> 
<p>| Log_name          | File_size |</p> 
<p>+-------------------+-----------+</p> 
<p>| master-bin.000001 |     19742 |</p> 
<p>| master-bin.000002 |    765307 |</p> 
<p>| master-bin.000003 |       764 |</p> 
<p>| master-bin.000004 |       599 |</p> 
<p>| master-bin.000005 |     10270 |</p> 
<p>| master-bin.000006 |       125 |</p> 
<p>| master-bin.000007 |       596 |</p> 
<p>| master-bin.000008 |       367 |</p> 
<p>| master-bin.000009 |      2893 |</p> 
<p>| master-bin.000010 |      1759 |</p> 
<p>| master-bin.000011 |       106 |</p> 
<p>+-------------------+-----------+</p> 
<p>11 rows in set (0.02 sec)</p> 
<p><strong>4）、查看从服务器状态：SHOW SLAVE STATUS</strong></p> 
<p>从服务器状态中，重点监控slave同步状态中的：</p> 
<p><span style="color:#FF0000;">Slave_IO_Running</span><span style="color:#FF0000;">、</span><span style="color:#FF0000;">Slave_SQL_Running</span><span style="color:#FF0000;">状态值，如果都为</span><span style="color:#FF0000;">YES</span><span style="color:#FF0000;">，则表示主从同步开启，状态正常。</span></p> 
<p><span style="color:#FF0000;">Seconds_Behind_Master</span><span style="color:#FF0000;">的值，如果为</span><span style="color:#FF0000;">0</span><span style="color:#FF0000;">，则表示主从同步不延时，反之同步延时。</span></p> 
<p>mysql&gt; show slave status\G</p> 
<p>*************************** 1. row***************************</p> 
<p>               Slave_IO_State: Waiting formaster to send event<span style="color:#FF0000;"> --&gt;</span><span style="color:#FF0000;">指示从服务器的当前状态</span></p> 
<p>                  Master_Host: 192.168.88.131</p> 
<p>                  Master_User: repluser</p> 
<p>                  Master_Port: 3306</p> 
<p>                Connect_Retry: 60</p> 
<p>              Master_Log_File:master-bin.000011 <span style="color:#FF0000;">&lt;--</span><span style="color:#FF0000;">同步的主服务器二进制文件</span></p> 
<p>         Read_Master_Log_Pos: 106    <span style="color:#FF0000;"> </span>&lt;--<span style="color:#FF0000;">相对于主库</span><span style="color:#FF0000;">,</span><span style="color:#FF0000;">从库</span><span style="color:#FF0000;">IO</span><span style="color:#FF0000;">线程读取到的主库的二进制日志的位置</span></p> 
<p>               Relay_Log_File: relay-log.000055<span style="color:#FF0000;"> </span>&lt;--<span style="color:#FF0000;">相对于从库，</span><span style="color:#FF0000;">sql</span><span style="color:#FF0000;">线程用于同步的中继日志文件</span></p> 
<p>                Relay_Log_Pos: 252     <span style="color:#FF0000;">&lt;--</span><span style="color:#FF0000;">相对于从库</span><span style="color:#FF0000;">,</span><span style="color:#FF0000;">从库的</span><span style="color:#FF0000;">sql</span><span style="color:#FF0000;">线程同步数据时执行到的位置</span></p> 
<p>       Relay_Master_Log_File: master-bin.000011 <span style="color:#FF0000;">&lt;--</span><span style="color:#FF0000;">相对于主库</span><span style="color:#FF0000;">,</span><span style="color:#FF0000;">是从库的</span><span style="color:#FF0000;">SQL</span><span style="color:#FF0000;">线程执行到的二进制日志</span></p> 
<p>            Slave_IO_Running: Yes    <span style="color:#FF0000;"> </span>&lt;--<span style="color:#FF0000;">从服务器</span><span style="color:#FF0000;">I/O</span><span style="color:#FF0000;">线程运行状态</span></p> 
<p>           Slave_SQL_Running: Yes     <span style="color:#FF0000;">&lt;--</span><span style="color:#FF0000;">从服务器</span><span style="color:#FF0000;">SQL</span><span style="color:#FF0000;">线程运行状态</span></p> 
<p>              Replicate_Do_DB: </p> 
<p>         Replicate_Ignore_DB: </p> 
<p>          Replicate_Do_Table: </p> 
<p>      Replicate_Ignore_Table: </p> 
<p>     Replicate_Wild_Do_Table: </p> 
<p> Replicate_Wild_Ignore_Table: </p> 
<p>                   Last_Errno: 0     <span style="color:#FF0000;">  </span>&lt;--<span style="color:#FF0000;">复制错误数</span></p> 
<p>                   Last_Error: </p> 
<p>                 Skip_Counter: 0</p> 
<p>         Exec_Master_Log_Pos: 106   <span style="color:#FF0000;">  </span>&lt;--<span style="color:#FF0000;">相对于主库</span><span style="color:#FF0000;">,</span><span style="color:#FF0000;">是从库的</span><span style="color:#FF0000;">sql</span><span style="color:#FF0000;">线程执行到的位置</span><span style="color:#FF0000;">  </span></p> 
<p>              Relay_Log_Space: 18331  <span style="color:#FF0000;"> </span>&lt;--<span style="color:#FF0000;">当前</span><span style="color:#FF0000;">relay-log</span><span style="color:#FF0000;">中继日志文件的大小</span></p> 
<p>              Until_Condition: None</p> 
<p>               Until_Log_File: </p> 
<p>                Until_Log_Pos: 0</p> 
<p>          Master_SSL_Allowed: No</p> 
<p>          Master_SSL_CA_File: </p> 
<p>          Master_SSL_CA_Path: </p> 
<p>              Master_SSL_Cert: </p> 
<p>           Master_SSL_Cipher: </p> 
<p>               Master_SSL_Key: </p> 
<p>       Seconds_Behind_Master: 0</p> 
<p>Master_SSL_Verify_Server_Cert: No</p> 
<p>                Last_IO_Errno: 0</p> 
<p>                Last_IO_Error: </p> 
<p>               Last_SQL_Errno: 0</p> 
<p>               Last_SQL_Error: </p> 
<p>1 row in set (0.00 sec)</p> 
<p>未同步完成时,read_master_log_pos 始终会大于exec_master_log_pos的值(也有可能相等)</p> 
<p>因为一个值是代表I/O线程,一个值代表SQL线程;SQL线程肯定在I/O线程之后；</p> 
<p>此外，Seconds_Behind_Master值大于0</p> 
<p></p> 
<p><strong>5）、查看进程状态：SHOW  FULL  PROCCESSLIST</strong></p> 
<p><span style="color:#FF0000;">必要时可以kill掉某些进程</span><strong><br></strong></p> 
<p><strong>查看主库进程状态</strong></p> 
<p>mysql&gt;show full processlist;</p> 
<p>+----+----------+----------------------+---------+-------------+------+----------------------------------------------------------------+-----------------------+</p> 
<p>| Id |User    | Host                | db     | Command    | Time | State                                                         | Info                 |</p> 
<p>+----+----------+----------------------+---------+-------------+------+----------------------------------------------------------------+-----------------------+</p> 
<p>|  2| repluser | 192.168.88.130:45975 | NULL   | Binlog Dump |  678 | Has sent allbinlog to slave; waiting for binlog to be updated |NULL                 |</p> 
<p>|  3| root    | localhost           |ibdatax | Query      |   0 | NULL                                                          | show full processlist |</p> 
<p>+----+----------+----------------------+---------+-------------+------+----------------------------------------------------------------+-----------------------+</p> 
<p><span style="color:#FF0000;">repluser</span><span style="color:#FF0000;">状态为：</span><span style="color:#FF0000;">Has sent all binlog to slave; waitingfor binlog to be updated</span></p> 
<p><span style="color:#FF0000;">意为二进制日志文件以通过</span><span style="color:#FF0000;">Binlog Dump</span><span style="color:#FF0000;">线程传递给从服务器的</span><span style="color:#FF0000;">I/O</span><span style="color:#FF0000;">线程，等待数据库操作后更新</span><span style="color:#FF0000;">binlog</span></p> 
<p>2 rows inset (0.00 sec)</p> 
<p><strong>查看从库进程状态</strong></p> 
<p>mysql&gt;show full processlist;</p> 
<p>+----+-------------+-----------+------+---------+------+-----------------------------------------------------------------------+-----------------------+</p> 
<p>| Id |User       | Host     | db   |Command | Time | State                                                                | Info                 |</p> 
<p>+----+-------------+-----------+------+---------+------+-----------------------------------------------------------------------+-----------------------+</p> 
<p>|  2| system user |          | NULL | Connect | 1332 | Waiting for master to sendevent                                     | NULL                 |</p> 
<p>|  1| system user |          | NULL | Connect |  248 | Has read allrelay log; waiting for the slave I/O thread to update it |NULL                 |</p> 
<p>|  4| root       | localhost | NULL | Query  |   0 | NULL                                                                 | show full processlist |</p> 
<p>+----+-------------+-----------+------+---------+------+-----------------------------------------------------------------------+-----------------------+</p> 
<p>3 rows inset (0.00 sec)</p> 
<p><span style="color:#FF0000;">从服务器</span><span style="color:#FF0000;">system user</span><span style="color:#FF0000;">状态一为：</span><span style="color:#FF0000;">Waiting for master to sendevent</span></p> 
<p><span style="color:#FF0000;">意为等待主服务器传递事件，即等待主服务器传递</span><span style="color:#FF0000;">binlog</span><span style="color:#FF0000;">，然后经由</span><span style="color:#FF0000;">I/O</span><span style="color:#FF0000;">线程更新到</span><span style="color:#FF0000;">relay log</span><span style="color:#FF0000;">中；</span></p> 
<p><span style="color:#FF0000;">另一个</span><span style="color:#FF0000;">system user</span><span style="color:#FF0000;">状态为：</span><span style="color:#FF0000;">Has read all relay log; waiting forthe slave I/O thread to update it</span></p> 
<p><span style="color:#FF0000;">意为二进制日志文件</span><span style="color:#FF0000;">relay log</span><span style="color:#FF0000;">中事件已重做完毕，等待</span><span style="color:#FF0000;">I/O</span><span style="color:#FF0000;">线程接收主服务器</span><span style="color:#FF0000;">binlog</span><span style="color:#FF0000;">后更新</span><span style="color:#FF0000;">relay log</span></p> 
<p><strong>2、slave是否发了复制延迟</strong></p> 
<p>mysql&gt; SHOW SLAVE STATUS\G查看以下项：</p> 
<p>Seconds_Behind_Master: 0</p> 
<p><strong>3、确定master/slave节点数据是否一致</strong></p> 
<p><strong>(1)表自身的checksum</strong></p> 
<p>   mysql&gt; help checksum table</p> 
<p><strong>(2)使用percona-tools中的pt-table-checksum</strong></p> 
<p><strong>4、数据不一致时的修改方法</strong></p> 
<p>重复设定复制机制</p> 
<p>使用mysqldump从master导出slave不同的数据</p> 
<p><span style="color:#FF0000;">参考《</span><span style="color:#FF0000;">mysqldump</span><span style="color:#FF0000;">和</span><span style="color:#FF0000;">mysqlbinlog</span><span style="color:#FF0000;">实现完全备份和增量备份》</span></p> 
<p>https://blog.csdn.net/field_yang/article/details/78641047</p> 
<p><strong>5、为从库设定新的主库</strong></p> 
<p>参考《mysql主从复制配置实现及其监控与维护》</p> 
<p>https://blog.csdn.net/field_yang/article/details/78639405</p> 
<p>在从库停止复制线程，而后重新设定CHANGE MASTER TO命令即可；</p> 
<p>mysql&gt; stop slave;</p> 
<p>Query OK, 0 rows affected (0.10 sec)</p> 
<p>mysql&gt; GRANT REPLICATIONSLAVE,REPLICATION CLIENT ON *.* TO 'repluser'@'192.168.%.%'IDENTIFIED BY'testpass';</p> 
<p>mysql&gt; CHANGE MASTERTOMASTER_HOST='192.168.88.131',MASTER_USER='repluser',MASTER_PASSWORD='testpass',MASTER_LOG_FILE='master-bin.000003',MASTER_LOG_POS=358;</p> 
<p><strong>6、跟复制功能相关的文件：</strong></p> 
<p><strong>master.info：保存slave连接master时所需要信息；纯文本文件；</strong></p> 
<p><strong>relay-log.info：保存了当前slave节点上（主节点上的）二进制日志和当前节点中继日志的对应关系；</strong></p> 
<p>[root@test mysql]# cat master.info</p> 
<p>15</p> 
<p>master-bin.000010   &lt;-- 主服务器binlog dump线程传递的给从服务器binlog文件</p> 
<p>1740              &lt;-- 主服务器Position</p> 
<p>192.168.88.131     &lt;-- 主服务地址</p> 
<p>repluser           &lt;-- 提供复制的账户</p> 
<p>replpass           &lt;-- 提供复制的账户密码</p> 
<p>3306              &lt;-- 主服务地址端口</p> 
<p>60</p> 
<p>0</p> 
<p>0</p> 
<p>[root@test mysql]# cat relay-log.info</p> 
<p>./relay-log.000046     &lt;-- 从服务器I/O线程更新event的从服务器relay-log文件</p> 
<p>1886                &lt;-- 从服务器Relay_Log_Pos</p> 
<p>master-bin.000010     &lt;-- 从服务器I/O线程传递的主服务器binlog文件</p> 
<p>1740                &lt;-- 主服务器Position</p> 
<p><strong>7、清理二进制日志：PURGE命令</strong></p> 
<p><strong>实例：</strong></p> 
<p>mysql&gt; show binary logs;</p> 
<p>+-------------------+-----------------+</p> 
<p>|Log_name           | File_size       |</p> 
<p>+-------------------+-----------------+</p> 
<p>|master-bin.000001  |    19924       |</p> 
<p>|master-bin.000002  |   775387       |</p> 
<p>|master-bin.000003  |      387       |</p> 
<p>|master-bin.000004  |      527       |</p> 
<p>+-------------------+-----------------+</p> 
<p>4rows in set (0.00 sec)</p> 
<p>mysql&gt;purge binary logs to'master-bin.000002';</p> 
<p>QueryOK, 0 rows affected (0.08 sec)</p> 
<p>mysql&gt;show binary logs;</p> 
<p>+-------------------+-----------------+</p> 
<p>|Log_name           | File_size       |</p> 
<p>+-------------------+-----------------+</p> 
<p>|master-bin.000002  |   775387       |</p> 
<p>|master-bin.000003  |      387       |</p> 
<p>|master-bin.000004  |      527       |</p> 
<p>+-------------------+-----------------+</p> 
<p>3rows in set (0.00 sec)</p> 
<p>mysql&gt;quit</p> 
<p>Bye</p> 
<p>[root@testmysql]# ls</p> 
<p>ibdata1     master-bin.000002 master-bin.index  mysql             relay-log.000006  test ib_logfile0  master-bin.000003  master.info       mysql.sock        relay-log.index ib_logfile1  master-bin.000004  mydb  relay-log.000005  relay-log.info</p> 
<p>[root@test mysql]# catmaster-bin.index</p> 
<p>./master-bin.000002</p> 
<p>./master-bin.000003</p> 
<p>./master-bin.000004</p> 
<p><strong>8、提升从服务器为主服务器</strong></p> 
<p>主从服务器配置参考《mysql主从复制配置实现及其监控与维护》</p> 
<p>https://blog.csdn.net/field_yang/article/details/78639405</p> 
<p><strong>1）、计划内提升一个从库为主库：</strong></p> 
<p>(1) 停止向老的主库写入数据；</p> 
<p>(2) 让计划提升为主库的从库赶上主库；</p> 
<p>(3) 提升从库为主库</p> 
<p>(4) 修改其它从库的指向</p> 
<p><strong>2）、计划外提升一个从库为主库：</strong></p> 
<p>(1) 确定哪个从库的数据为最新最全；</p> 
<p>Master_Log_File: master1-bin.000002</p> 
<p>Read_Master_Log_Pos:245</p> 
<p>(2) 等待所有的从库执行从主库那复制而来的生成的中继日志；</p> 
<p>(3) 在提升为主库的从库上STOP SLAVE；而后，让各从库指向新的主库；</p> 
<p>(4) 再次比较主库和各从库上的两个参数：</p> 
<p>    Master_Log_File:master1-bin.000002</p> 
<p>    Read_Master_Log_Pos:245                     </p> 
<p><strong>9、相对理想的主从复制配置：</strong></p> 
<p><strong>(1)、master上配置:</strong></p> 
<p><strong>sync_binlog=1</strong></p> 
<p>sync_binlog是MySQL的binlog写入方式。它可以设置0以上的值。最安全的设置是1，即写一个binlog，同步一次。确保每次事务提前之前都能将二进制日志同步磁盘上；</p> 
<p>对于使用InnoDB存储引擎的场景：</p> 
<p><strong>innodb_flush_logs_at_trx_commit=1</strong></p> 
<p>控制innodb的redo的刷盘策略，可以设置的值是0，1，2。默认值为1，每次事务提交时MySQL都会把log buffer的数据写入log file，并且flush(刷到磁盘)中去.</p> 
<p><strong>innodb_support_xa=1  </strong></p> 
<p>设为ON时，会使用二阶段提交协议来保证binlog和innodb的一致。</p> 
<p><strong>(2)、slave上配置:</strong></p> 
<p><strong>read_only=1  </strong></p> 
<p>从库只读，但是有super权限的依然可以写入</p> 
<p><strong>sync_master_info= 1</strong></p> 
<p><strong>sync_relay_log   = 1</strong></p> 
<p><strong>sync_relay_log_info= 1</strong></p> 
<p>设置为1以确保不会丢失信息</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/45ea084f138a4cdcab5391100eeccecf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">嵌入式Linux——oops：根据oops信息，找到错误的产生位置以及函数的调用关系</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e6052bf7770cd4f529f3f55ed1c486ae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">前端框架选型调研报告</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>