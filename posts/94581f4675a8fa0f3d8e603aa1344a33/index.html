<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>图神经网络07-从零构建一个电影推荐系统 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="图神经网络07-从零构建一个电影推荐系统" />
<meta property="og:description" content="欢迎大家“Fork”，点击右上角的 “ Fork ”,可直接运行并查看代码效果
关注我的专栏 👉 数据挖掘与可视化教程方便第一时间获取更新的项目
【B站美食视频图鉴】干饭人干饭魂干饭都是人上人 ✔︎ 【【多伦多单车数据】车骑好，车停好，车锁好，车才好 ✔︎ 【中国移动手机用户统计】-为发烧而生 TODO 【⛹你是真的蔡】真真假假,假假真真,真亦假时假亦真! TODO 全球🌍COVID-19新冠疫苗接种数据分析 ✔︎ 【🅱️B站热点追溯】二次元世界的星辰大海 ✔︎ 🏬一饼吃透破产名单：哪些知名公司终究没能撑过疫情 ✔︎ 【🐶单身人士友好的“理想国”】透过探探的在线社交洞察 ✔︎ 【👱♀️七仙女系列】Pandas教程 ✔︎ 【📱移动5G套餐潜客识别】7步让你成为机器学习达人 ✔︎ 【🧠大脑还健康吗】脑中风疾病预测模型✔︎ 【🎬猜猜你喜欢看什么】从零构建一个电影推荐系统 推荐系统机器学习✔︎ 1 简介 这个项目的目标是为Netflix上的电影和电视节目开发一个基于内容的推荐引擎。我们将比较两种不同的方法:
使用演员、导演、国家、等级和类型作为特色。用电影/电视节目中的词语作为特征。 Image Name &lt;figcaption style=&#34;margin-top: 5px; text-align: center; color: #888; font-size: 14px;&#34;&gt;Image Name&lt;/figcaption&gt;
2 导入工具包 &lt;pre class=&#34;custom&#34; data-tool=&#34;mdnice编辑器&#34; style=&#34;margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;&#34;&gt;!pip install nltk pytest -i https://pypi." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/94581f4675a8fa0f3d8e603aa1344a33/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-19T00:06:12+08:00" />
<meta property="article:modified_time" content="2021-04-19T00:06:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">图神经网络07-从零构建一个电影推荐系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <article class="_2rhmJa" style="font-size: 16px;"> 
 <p>欢迎大家“Fork”，点击右上角的 “ Fork ”,可直接运行并查看代码效果</p> 
 <p>关注我的专栏 👉 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fhome%2Fcolumn%2F6006b46b7ed5ab0015f0fa8d" rel="nofollow noopener noreferrer" target="_blank">数据挖掘与可视化教程</a>方便第一时间获取更新的项目</p> 
 <ul><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F600ece9de455800015bccbf7" rel="nofollow noopener noreferrer" target="_blank">【B站美食视频图鉴】干饭人干饭魂干饭都是人上人</a> ✔︎</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fhome%2Fcolumn%2F6006b46b7ed5ab0015f0fa8d" rel="nofollow noopener noreferrer" target="_blank">【【多伦多单车数据】车骑好，车停好，车锁好，车才好</a> ✔︎</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F601c2a25b2334400157e8aa0" rel="nofollow noopener noreferrer" target="_blank">【中国移动手机用户统计】-为发烧而生</a> TODO</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F601c2e8bb2334400157e8c45" rel="nofollow noopener noreferrer" target="_blank">【⛹你是真的蔡】真真假假,假假真真,真亦假时假亦真!</a> TODO</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F602e2e1d891f960015cd0a0b" rel="nofollow noopener noreferrer" target="_blank">全球🌍COVID-19新冠疫苗接种数据分析</a> ✔︎</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F6034c2b47844dd0015591fdf" rel="nofollow noopener noreferrer" target="_blank">【🅱️B站热点追溯】二次元世界的星辰大海</a> ✔︎</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F603cfb4c04f2500015a217f5" rel="nofollow noopener noreferrer" target="_blank">🏬一饼吃透破产名单：哪些知名公司终究没能撑过疫情</a> ✔︎</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F6046e1506b48c200152ba4c1" rel="nofollow noopener noreferrer" target="_blank">【🐶单身人士友好的“理想国”】透过探探的在线社交洞察</a> ✔︎</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F604a285c74dfc60016e0fda0" rel="nofollow noopener noreferrer" target="_blank">【👱♀️七仙女系列】Pandas教程</a> ✔︎</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F60594d95c910a90015814db9" rel="nofollow noopener noreferrer" target="_blank">【📱移动5G套餐潜客识别】7步让你成为机器学习达人</a> ✔︎</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F605cb14fce98c30015d33a48" rel="nofollow noopener noreferrer" target="_blank">【🧠大脑还健康吗】脑中风疾病预测模型</a>✔︎</li><li> <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heywhale.com%2Fmw%2Fproject%2F606acd72cbb4020018e51eb9" rel="nofollow noopener noreferrer" target="_blank">【🎬猜猜你喜欢看什么】从零构建一个电影推荐系统 推荐系统机器学习</a>✔︎</li></ul> 
 <h3>1 简介</h3> 
 <p>这个项目的目标是为Netflix上的电影和电视节目开发一个基于内容的推荐引擎。我们将比较两种不同的方法:</p> 
 <ul><li>使用演员、导演、国家、等级和类型作为特色。</li><li>用电影/电视节目中的词语作为特征。</li></ul> 
 <div class="image-package"> 
  <div class="image-container"> 
   <div class="image-view" style="text-align: center;"> 
    <img src="https://images2.imgbox.com/1c/83/2x2swUIq_o.png" style="outline: none;"> 
   </div> 
  </div> 
  <div class="image-caption">
    Image Name 
  </div> 
 </div> 
 <p>&lt;figcaption style="margin-top: 5px; text-align: center; color: #888; font-size: 14px;"&gt;Image Name&lt;/figcaption&gt;</p> 
 <h3>2 导入工具包</h3> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>!pip install nltk pytest -i https://pypi.tuna.tsinghua.edu.cn/simple</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>Looking in indexes: https://pypi.tuna.tsinghua.edu.cn/simple
Requirement already satisfied: nltk in /opt/conda/lib/python3.8/site-packages (3.6.1)
Requirement already satisfied: pytest in /opt/conda/lib/python3.8/site-packages (6.2.3)
Requirement already satisfied: regex in /opt/conda/lib/python3.8/site-packages (from nltk) (2021.4.4)
Requirement already satisfied: tqdm in /opt/conda/lib/python3.8/site-packages (from nltk) (4.48.2)
Requirement already satisfied: joblib in /opt/conda/lib/python3.8/site-packages (from nltk) (0.16.0)
Requirement already satisfied: click in /opt/conda/lib/python3.8/site-packages (from nltk) (7.1.2)
Requirement already satisfied: iniconfig in /opt/conda/lib/python3.8/site-packages (from pytest) (1.1.1)
Requirement already satisfied: attrs&gt;=19.2.0 in /opt/conda/lib/python3.8/site-packages (from pytest) (20.1.0)
Requirement already satisfied: pluggy&lt;1.0.0a1,&gt;=0.12 in /opt/conda/lib/python3.8/site-packages (from pytest) (0.13.1)
Requirement already satisfied: packaging in /opt/conda/lib/python3.8/site-packages (from pytest) (20.4)
Requirement already satisfied: toml in /opt/conda/lib/python3.8/site-packages (from pytest) (0.10.2)
Requirement already satisfied: py&gt;=1.8.2 in /opt/conda/lib/python3.8/site-packages (from pytest) (1.10.0)
Requirement already satisfied: six in /opt/conda/lib/python3.8/site-packages (from packaging-&gt;pytest) (1.15.0)
Requirement already satisfied: pyparsing&gt;=2.0.2 in /opt/conda/lib/python3.8/site-packages (from packaging-&gt;pytest) (2.4.7)</code></pre> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`import numpy as np<br> import pandas as pd<br> import re<br> from tqdm import tqdm<br> import nltk</p> 
 <h2>from nltk.corpus import stopwords</h2> 
 <h2>nltk.download('stopwords')</h2> 
 <p>from nltk.tokenize import word_tokenize` &lt;/pre&gt;</p> 
 <h3>3 加载数据</h3> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code># 查看当前挂载的数据集目录 !ls /home/kesci/input/</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>netflix8714</code></pre> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>data=pd.read_csv('/home/kesci/input/netflix8714/netflix_titles.csv') data.head()</code> &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>show_id</th><th>type</th><th>title</th><th>director</th><th>cast</th><th>country</th><th>date_added</th><th>release_year</th><th>rating</th><th>duration</th><th>listed_in</th><th>description</th></tr></thead><tbody><tr><td>0</td><td>s1</td><td>TV Show</td><td>3%</td><td>NaN</td><td>João Miguel, Bianca Comparato, Michel Gomes, R...</td><td>Brazil</td><td>August 14, 2020</td><td>2020</td><td>TV-MA</td><td>4 Seasons</td><td>International TV Shows, TV Dramas, TV Sci-Fi &amp;...</td><td>In a future where the elite inhabit an island ...</td></tr><tr><td>1</td><td>s2</td><td>Movie</td><td>7:19</td><td>Jorge Michel Grau</td><td>Demián Bichir, Héctor Bonilla, Oscar Serrano, ...</td><td>Mexico</td><td>December 23, 2016</td><td>2016</td><td>TV-MA</td><td>93 min</td><td>Dramas, International Movies</td><td>After a devastating earthquake hits Mexico Cit...</td></tr><tr><td>2</td><td>s3</td><td>Movie</td><td>23:59</td><td>Gilbert Chan</td><td>Tedd Chan, Stella Chung, Henley Hii, Lawrence ...</td><td>Singapore</td><td>December 20, 2018</td><td>2011</td><td>R</td><td>78 min</td><td>Horror Movies, International Movies</td><td>When an army recruit is found dead, his fellow...</td></tr><tr><td>3</td><td>s4</td><td>Movie</td><td>9</td><td>Shane Acker</td><td>Elijah Wood, John C. Reilly, Jennifer Connelly...</td><td>United States</td><td>November 16, 2017</td><td>2009</td><td>PG-13</td><td>80 min</td><td>Action &amp; Adventure, Independent Movies, Sci-Fi...</td><td>In a postapocalyptic world, rag-doll robots hi...</td></tr><tr><td>4</td><td>s5</td><td>Movie</td><td>21</td><td>Robert Luketic</td><td>Jim Sturgess, Kevin Spacey, Kate Bosworth, Aar...</td><td>United States</td><td>January 1, 2020</td><td>2008</td><td>PG-13</td><td>123 min</td><td>Dramas</td><td>A brilliant group of students become card-coun...</td></tr></tbody></table> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>data.groupby('type').count()</code> &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>show_id</th><th>title</th><th>director</th><th>cast</th><th>country</th><th>date_added</th><th>release_year</th><th>rating</th><th>duration</th><th>listed_in</th><th>description</th></tr></thead><tbody><tr><td>type</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>---</td><td>---</td><td>---</td><td>---</td><td>---</td><td>---</td><td>---</td><td>---</td><td>---</td><td>---</td><td>---</td><td>---</td></tr><tr><td>Movie</td><td>5377</td><td>5377</td><td>5214</td><td>4951</td><td>5147</td><td>5377</td><td>5377</td><td>5372</td><td>5377</td><td>5377</td><td>5377</td></tr><tr><td>TV Show</td><td>2410</td><td>2410</td><td>184</td><td>2118</td><td>2133</td><td>2400</td><td>2410</td><td>2408</td><td>2410</td><td>2410</td><td>2410</td></tr></tbody></table> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>data.isnull().sum()</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>show_id            0
type               0
title              0
director        2389
cast             718
country          507
date_added        10
release_year       0
rating             7
duration           0
listed_in          0
description        0
dtype: int64</code></pre> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>data.shape</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>(7787, 12)</code></pre> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code># 删除空值 data = data.dropna(subset=['cast', 'country', 'rating']) data.shape</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>(6652, 12)</code></pre> 
 <h3>4 使用cast, director, country, rating 和 genres开发推荐系统</h3> 
 <p>使用演员，导演，国家/地区，评分和类型开发推荐系统</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>movies = data[data['type'] == 'Movie'].reset_index() movies = movies.drop(['index', 'show_id', 'type', 'date_added', 'release_year', 'duration', 'description'], axis=1) movies.head()</code> &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>title</th><th>director</th><th>cast</th><th>country</th><th>rating</th><th>listed_in</th></tr></thead><tbody><tr><td>0</td><td>7:19</td><td>Jorge Michel Grau</td><td>Demián Bichir, Héctor Bonilla, Oscar Serrano, ...</td><td>Mexico</td><td>TV-MA</td><td>Dramas, International Movies</td></tr><tr><td>1</td><td>23:59</td><td>Gilbert Chan</td><td>Tedd Chan, Stella Chung, Henley Hii, Lawrence ...</td><td>Singapore</td><td>R</td><td>Horror Movies, International Movies</td></tr><tr><td>2</td><td>9</td><td>Shane Acker</td><td>Elijah Wood, John C. Reilly, Jennifer Connelly...</td><td>United States</td><td>PG-13</td><td>Action &amp; Adventure, Independent Movies, Sci-Fi...</td></tr><tr><td>3</td><td>21</td><td>Robert Luketic</td><td>Jim Sturgess, Kevin Spacey, Kate Bosworth, Aar...</td><td>United States</td><td>PG-13</td><td>Dramas</td></tr><tr><td>4</td><td>122</td><td>Yasir Al Yasiri</td><td>Amina Khalil, Ahmed Dawood, Tarek Lotfy, Ahmed...</td><td>Egypt</td><td>TV-MA</td><td>Horror Movies, International Movies</td></tr></tbody></table> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>tv = data[data['type'] == 'TV Show'].reset_index() tv = tv.drop(['index', 'show_id', 'type', 'date_added', 'release_year', 'duration', 'description'], axis=1) tv.head()</code> &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>title</th><th>director</th><th>cast</th><th>country</th><th>rating</th><th>listed_in</th></tr></thead><tbody><tr><td>0</td><td>3%</td><td>NaN</td><td>João Miguel, Bianca Comparato, Michel Gomes, R...</td><td>Brazil</td><td>TV-MA</td><td>International TV Shows, TV Dramas, TV Sci-Fi &amp;...</td></tr><tr><td>1</td><td>46</td><td>Serdar Akar</td><td>Erdal Beşikçioğlu, Yasemin Allen, Melis Birkan...</td><td>Turkey</td><td>TV-MA</td><td>International TV Shows, TV Dramas, TV Mysteries</td></tr><tr><td>2</td><td>1983</td><td>NaN</td><td>Robert Więckiewicz, Maciej Musiał, Michalina O...</td><td>Poland, United States</td><td>TV-MA</td><td>Crime TV Shows, International TV Shows, TV Dramas</td></tr><tr><td>3</td><td>SAINT SEIYA: Knights of the Zodiac</td><td>NaN</td><td>Bryson Baugus, Emily Neves, Blake Shepard, Pat...</td><td>Japan</td><td>TV-14</td><td>Anime Series, International TV Shows</td></tr><tr><td>4</td><td>#blackAF</td><td>NaN</td><td>Kenya Barris, Rashida Jones, Iman Benson, Genn...</td><td>United States</td><td>TV-MA</td><td>TV Comedies</td></tr></tbody></table> 
 <h4>4.1 演员one hot 编码</h4> 
 <ul><li>获取演员列表</li><li>独热编码</li></ul> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`# 首先获取所有的演员列表<br> actors = []<br> for i in movies['cast']:<br> actor = re.split(r', \s*', i)<br> actors.append(actor)</p> 
 <p>flat_list = []<br> for sublist in actors:<br> for item in sublist:<br> flat_list.append(item)</p> 
 <p>actors_list = sorted(set(flat_list))<br> len(actors_list)` &lt;/pre&gt;</p> 
 <pre class="has"><code>22622</code></pre> 
 <p>我们可以看到有一共有22622个演员</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code># 打印前10个演员 actors_list[:10]</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>['"Riley" Lakdhar Dridi',
 "'Najite Dede",
 '4Minute',
 '50 Cent',
 'A. Murat Özgen',
 'A.C. Peterson',
 'A.J. Cook',
 'A.J. LoCascio',
 'A.K. Hangal',
 'A.R. Rahman']</code></pre> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`binary_actors = [[0] * 0 for i in range(len(set(flat_list)))]</p> 
 <h2>遍历所有的数据</h2> 
 <p>for i in tqdm(movies['cast']):<br> k = 0<br> # 遍历所有的演员<br> for j in actors_list:<br> # 如果演员名字出现在作品演员列表里，那么对应位置设置为1<br> # 例如João Miguel存在于João Miguel, Bianca Comparato, Michel Gomes<br> # 那么João Miguel所在actors_list的位置设置为1<br> if j in i:<br> binary_actors[k].append(1.0)<br> else:<br> # 如果演员名字没有出现在作品演员列表里，那么对应位置设置为0<br> binary_actors[k].append(0.0)<br> k+=1</p> 
 <h2>这样我们对每一条数据得到一个22622维度的独热编码向量</h2> 
 <p>binary_actors = pd.DataFrame(binary_actors).transpose()<br> binary_actors` &lt;/pre&gt;</p> 
 <pre class="has"><code>100%|██████████| 4761/4761 [00:56&lt;00:00, 84.33it/s]</code></pre> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>...</th><th>22612</th><th>22613</th><th>22614</th><th>22615</th><th>22616</th><th>22617</th><th>22618</th><th>22619</th><th>22620</th><th>22621</th></tr></thead><tbody><tr><td>0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>2</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>3</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><td>4756</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4757</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4758</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4759</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4760</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table> 
 <p>4761 rows × 22622 columns</p> 
 <p>以下其他变量的独热编码获取思路同上</p> 
 <h4>4.2 导演one hot 编码</h4> 
 <ul><li>获取导演列表</li><li>独热编码</li></ul> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`directors = []</p> 
 <p>for i in movies['director']:<br> if pd.notna(i):<br> director = re.split(r', \s*', i)<br> directors.append(director)</p> 
 <p>flat_list2 = []<br> for sublist in directors:<br> for item in sublist:<br> flat_list2.append(item)</p> 
 <p>directors_list = sorted(set(flat_list2))</p> 
 <p>binary_directors = [[0] * 0 for i in range(len(set(flat_list2)))]</p> 
 <p>for i in tqdm(movies['director']):<br> k = 0<br> for j in directors_list:<br> if pd.isna(i):<br> binary_directors[k].append(0.0)<br> elif j in i:<br> binary_directors[k].append(1.0)<br> else:<br> binary_directors[k].append(0.0)<br> k+=1</p> 
 <p>binary_directors = pd.DataFrame(binary_directors).transpose()<br> binary_directors.head()` &lt;/pre&gt;</p> 
 <pre class="has"><code>100%|██████████| 4761/4761 [00:14&lt;00:00, 337.39it/s]</code></pre> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>...</th><th>3823</th><th>3824</th><th>3825</th><th>3826</th><th>3827</th><th>3828</th><th>3829</th><th>3830</th><th>3831</th><th>3832</th></tr></thead><tbody><tr><td>0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>2</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>3</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table> 
 <p>5 rows × 3833 columns</p> 
 <h4>4.3 国家one hot 编码</h4> 
 <ul><li>获取导演列表</li><li>独热编码</li></ul> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`countries = []</p> 
 <p>for i in movies['country']:<br> country = re.split(r', \s*', i)<br> countries.append(country)</p> 
 <p>flat_list3 = []<br> for sublist in countries:<br> for item in sublist:<br> flat_list3.append(item)</p> 
 <p>countries_list = sorted(set(flat_list3))</p> 
 <p>binary_countries = [[0] * 0 for i in range(len(set(flat_list3)))]</p> 
 <p>for i in tqdm(movies['country']):<br> k = 0<br> for j in countries_list:<br> if j in i:<br> binary_countries[k].append(1.0)<br> else:<br> binary_countries[k].append(0.0)<br> k+=1</p> 
 <p>binary_countries = pd.DataFrame(binary_countries).transpose()<br> binary_countries.head()` &lt;/pre&gt;</p> 
 <pre class="has"><code>100%|██████████| 4761/4761 [00:00&lt;00:00, 35151.57it/s]</code></pre> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>...</th><th>95</th><th>96</th><th>97</th><th>98</th><th>99</th><th>100</th><th>101</th><th>102</th><th>103</th><th>104</th></tr></thead><tbody><tr><td>0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>2</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>3</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table> 
 <p>5 rows × 105 columns</p> 
 <h4>4.4 题材one hot 编码</h4> 
 <ul><li>获取题材列表</li><li>独热编码</li></ul> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt; `genres = []</p> 
 <p>for i in movies['listed_in']:<br> genre = re.split(r', \s*', i)<br> genres.append(genre)</p> 
 <p>flat_list4 = []<br> for sublist in genres:<br> for item in sublist:<br> flat_list4.append(item)</p> 
 <p>genres_list = sorted(set(flat_list4))</p> 
 <p>binary_genres = [[0] * 0 for i in range(len(set(flat_list4)))]</p> 
 <p>for i in tqdm(movies['listed_in']):<br> k = 0<br> for j in genres_list:<br> if j in i:<br> binary_genres[k].append(1.0)<br> else:<br> binary_genres[k].append(0.0)<br> k+=1</p> 
 <p>binary_genres = pd.DataFrame(binary_genres).transpose()<br> binary_genres.head()` &lt;/pre&gt;</p> 
 <pre class="has"><code>100%|██████████| 4761/4761 [00:00&lt;00:00, 198223.96it/s]</code></pre> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th><th>19</th></tr></thead><tbody><tr><td>0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>2</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>3</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table> 
 <h4>4.5 评分one hot 编码</h4> 
 <ul><li>获取评分列表</li><li>独热编码</li></ul> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt; `ratings = []</p> 
 <p>for i in movies['rating']:<br> ratings.append(i)</p> 
 <p>ratings_list = sorted(set(ratings))</p> 
 <p>binary_ratings = [[0] * 0 for i in range(len(set(ratings_list)))]</p> 
 <p>for i in tqdm(movies['rating']):<br> k = 0<br> for j in ratings_list:<br> if j in i:<br> binary_ratings[k].append(1.0)<br> else:<br> binary_ratings[k].append(0.0)<br> k+=1</p> 
 <p>binary_ratings = pd.DataFrame(binary_ratings).transpose()<br> binary_ratings` &lt;/pre&gt;</p> 
 <pre class="has"><code>100%|██████████| 4761/4761 [00:00&lt;00:00, 294134.44it/s]</code></pre> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th></tr></thead><tbody><tr><td>0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>2</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>3</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><td>4756</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4757</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4758</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4759</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4760</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table> 
 <p>4761 rows × 14 columns</p> 
 <p>最后我们将5个特征向量进行拼接在一起</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>binary = pd.concat([binary_actors, binary_directors, binary_countries, binary_genres], axis=1,ignore_index=True) binary</code> &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>...</th><th>26570</th><th>26571</th><th>26572</th><th>26573</th><th>26574</th><th>26575</th><th>26576</th><th>26577</th><th>26578</th><th>26579</th></tr></thead><tbody><tr><td>0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>2</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>3</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><td>4756</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4757</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>1.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4758</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4759</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4760</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table> 
 <p>4761 rows × 26580 columns</p> 
 <p>以上为电影所有特征向量的独热编码获取思路，接下来我们对电视节目tv也做同样的操作</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`actors2 = []</p> 
 <p>for i in tv['cast']:<br> actor2 = re.split(r', \s*', i)<br> actors2.append(actor2)</p> 
 <p>flat_list5 = []<br> for sublist in actors2:<br> for item in sublist:<br> flat_list5.append(item)</p> 
 <p>actors_list2 = sorted(set(flat_list5))</p> 
 <p>binary_actors2 = [[0] * 0 for i in range(len(set(flat_list5)))]</p> 
 <p>for i in tv['cast']:<br> k = 0<br> for j in actors_list2:<br> if j in i:<br> binary_actors2[k].append(1.0)<br> else:<br> binary_actors2[k].append(0.0)<br> k+=1</p> 
 <p>binary_actors2 = pd.DataFrame(binary_actors2).transpose()</p> 
 <p>countries2 = []</p> 
 <p>for i in tv['country']:<br> country2 = re.split(r', \s*', i)<br> countries2.append(country2)</p> 
 <p>flat_list6 = []<br> for sublist in countries2:<br> for item in sublist:<br> flat_list6.append(item)</p> 
 <p>countries_list2 = sorted(set(flat_list6))</p> 
 <p>binary_countries2 = [[0] * 0 for i in range(len(set(flat_list6)))]</p> 
 <p>for i in tv['country']:<br> k = 0<br> for j in countries_list2:<br> if j in i:<br> binary_countries2[k].append(1.0)<br> else:<br> binary_countries2[k].append(0.0)<br> k+=1</p> 
 <p>binary_countries2 = pd.DataFrame(binary_countries2).transpose()</p> 
 <p>genres2 = []</p> 
 <p>for i in tv['listed_in']:<br> genre2 = re.split(r', \s*', i)<br> genres2.append(genre2)</p> 
 <p>flat_list7 = []<br> for sublist in genres2:<br> for item in sublist:<br> flat_list7.append(item)</p> 
 <p>genres_list2 = sorted(set(flat_list7))</p> 
 <p>binary_genres2 = [[0] * 0 for i in range(len(set(flat_list7)))]</p> 
 <p>for i in tv['listed_in']:<br> k = 0<br> for j in genres_list2:<br> if j in i:<br> binary_genres2[k].append(1.0)<br> else:<br> binary_genres2[k].append(0.0)<br> k+=1</p> 
 <p>binary_genres2 = pd.DataFrame(binary_genres2).transpose()</p> 
 <p>ratings2 = []</p> 
 <p>for i in tv['rating']:<br> ratings2.append(i)</p> 
 <p>ratings_list2 = sorted(set(ratings2))</p> 
 <p>binary_ratings2 = [[0] * 0 for i in range(len(set(ratings_list2)))]</p> 
 <p>for i in tv['rating']:<br> k = 0<br> for j in ratings_list2:<br> if j in i:<br> binary_ratings2[k].append(1.0)<br> else:<br> binary_ratings2[k].append(0.0)<br> k+=1</p> 
 <p>binary_ratings2 = pd.DataFrame(binary_ratings2).transpose()<br> binary2 = pd.concat([binary_actors2, binary_countries2, binary_genres2], axis=1, ignore_index=True)<br> binary2` &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>...</th><th>12741</th><th>12742</th><th>12743</th><th>12744</th><th>12745</th><th>12746</th><th>12747</th><th>12748</th><th>12749</th><th>12750</th></tr></thead><tbody><tr><td>0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><td>2</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><td>3</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><td>4</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><td>1886</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1887</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1888</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1889</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><td>1890</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>...</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr></tbody></table> 
 <p>1891 rows × 12751 columns</p> 
 <h4>4.6 基于特征向量的相似性影视推荐</h4> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`def recommender(search):<br> cs_list = [] # 存放余弦相似度结果<br> binary_list = []</p> 
 <pre class="has"><code># 判断搜索的title是电影还是电视节目
if search in movies['title'].values:
    # 获取查询作品的特征向量
    idx = movies[movies['title'] == search].index.item()
    for i in binary.iloc[idx]:
        binary_list.append(i)
    point1 = np.array(binary_list).reshape(1, -1)
    point1 = [val for sublist in point1 for val in sublist] 
    # 获取所有候选集作品的特征向量
    for j in tqdm(range(len(movies)),desc="searching"):
        binary_list2 = []
        for k in binary.iloc[j]:
            binary_list2.append(k)
        point2 = np.array(binary_list2).reshape(1, -1)
        point2 = [val for sublist in point2 for val in sublist]
        # 计算查询作品特征向量与当前候选作品特征向量的余弦相似度
        dot_product = np.dot(point1, point2)
        norm_1 = np.linalg.norm(point1)
        norm_2 = np.linalg.norm(point2)
        cos_sim = dot_product / (norm_1 * norm_2)
        cs_list.append(cos_sim)
    movies_copy = movies.copy()
    movies_copy['cos_sim'] = cs_list
    # 按照cos_sim从大到小进行排序
    results = movies_copy.sort_values('cos_sim', ascending=False)
    results = results[results['title'] != search]    
    # 返回相似度前5的结果
    top_results = results.head(5)
    return(top_results)
elif search in tv['title'].values:
    idx = tv[tv['title'] == search].index.item()
    for i in binary2.iloc[idx]:
        binary_list.append(i)
    point1 = np.array(binary_list).reshape(1, -1)
    point1 = [val for sublist in point1 for val in sublist]
    for j in range(len(tv)):
        binary_list2 = []
        for k in binary2.iloc[j]:
            binary_list2.append(k)
        point2 = np.array(binary_list2).reshape(1, -1)
        point2 = [val for sublist in point2 for val in sublist]
        dot_product = np.dot(point1, point2)
        norm_1 = np.linalg.norm(point1)
        norm_2 = np.linalg.norm(point2)
        cos_sim = dot_product / (norm_1 * norm_2)
        cs_list.append(cos_sim)
    tv_copy = tv.copy()
    tv_copy['cos_sim'] = cs_list
    results = tv_copy.sort_values('cos_sim', ascending=False)
    results = results[results['title'] != search]    
    top_results = results.head(5)
    return(top_results)
else:
    return("Title not in dataset. Please check spelling.")` &lt;/pre&gt;</code></pre> 
 <h4>4.7 电影推荐</h4> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>recommender('The Conjuring')</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>searching: 100%|██████████| 4761/4761 [10:52&lt;00:00,  7.30it/s]</code></pre> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>title</th><th>director</th><th>cast</th><th>country</th><th>rating</th><th>listed_in</th><th>cos_sim</th></tr></thead><tbody><tr><td>1868</td><td>Insidious</td><td>James Wan</td><td>Patrick Wilson, Rose Byrne, Lin Shaye, Ty Simp...</td><td>United States, Canada, United Kingdom</td><td>PG-13</td><td>Horror Movies, Thrillers</td><td>0.388922</td></tr><tr><td>968</td><td>Creep</td><td>Patrick Brice</td><td>Mark Duplass, Patrick Brice</td><td>United States</td><td>R</td><td>Horror Movies, Independent Movies, Thrillers</td><td>0.377964</td></tr><tr><td>1844</td><td>In the Tall Grass</td><td>Vincenzo Natali</td><td>Patrick Wilson, Laysla De Oliveira, Avery Whit...</td><td>Canada, United States</td><td>TV-MA</td><td>Horror Movies, Thrillers</td><td>0.370625</td></tr><tr><td>969</td><td>Creep 2</td><td>Patrick Brice</td><td>Mark Duplass, Desiree Akhavan, Karan Soni</td><td>United States</td><td>TV-MA</td><td>Horror Movies, Independent Movies, Thrillers</td><td>0.356348</td></tr><tr><td>1077</td><td>Desolation</td><td>Sam Patton</td><td>Jaimi Paige, Alyshia Ochse, Toby Nichols, Clau...</td><td>United States</td><td>TV-MA</td><td>Horror Movies, Thrillers</td><td>0.356348</td></tr></tbody></table> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>recommender("Dr. Seuss' The Cat in the Hat")</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>searching: 100%|██████████| 4761/4761 [10:51&lt;00:00,  7.31it/s]</code></pre> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>title</th><th>director</th><th>cast</th><th>country</th><th>rating</th><th>listed_in</th><th>cos_sim</th></tr></thead><tbody><tr><td>2798</td><td>NOVA: Bird Brain</td><td>NaN</td><td>Craig Sechler</td><td>United States</td><td>TV-G</td><td>Children &amp; Family Movies, Documentaries</td><td>0.372104</td></tr><tr><td>3624</td><td>Sugar High</td><td>Ariel Boles</td><td>Hunter March</td><td>United States</td><td>TV-G</td><td>Children &amp; Family Movies</td><td>0.372104</td></tr><tr><td>4758</td><td>Zoom</td><td>Peter Hewitt</td><td>Tim Allen, Courteney Cox, Chevy Chase, Kate Ma...</td><td>United States</td><td>PG</td><td>Children &amp; Family Movies, Comedies</td><td>0.370625</td></tr><tr><td>4624</td><td>What a Girl Wants</td><td>Dennie Gordon</td><td>Amanda Bynes, Colin Firth, Kelly Preston, Eile...</td><td>United States, United Kingdom</td><td>PG</td><td>Children &amp; Family Movies, Comedies</td><td>0.370625</td></tr><tr><td>3066</td><td>Prince of Peoria: A Christmas Moose Miracle</td><td>Jon Rosenbaum</td><td>Gavin Lewis, Theodore Barnes, Shelby Simmons, ...</td><td>United States</td><td>TV-G</td><td>Children &amp; Family Movies, Comedies</td><td>0.369800</td></tr></tbody></table> 
 <h4>4.8 电视节目推荐</h4> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>recommender('After Life')</code> &lt;/pre&gt;</p> 
 <h3>5.使用电影/电视节目描述开发推荐引擎</h3> 
 <h4>5.1 划分电影和电视节目数据集</h4> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>movies_des = data[data['type'] == 'Movie'].reset_index() movies_des = movies_des[['title', 'description']] movies_des.head()</code> &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>title</th><th>description</th></tr></thead><tbody><tr><td>0</td><td>7:19</td><td>After a devastating earthquake hits Mexico Cit...</td></tr><tr><td>1</td><td>23:59</td><td>When an army recruit is found dead, his fellow...</td></tr><tr><td>2</td><td>9</td><td>In a postapocalyptic world, rag-doll robots hi...</td></tr><tr><td>3</td><td>21</td><td>A brilliant group of students become card-coun...</td></tr><tr><td>4</td><td>122</td><td>After an awful accident, a couple admitted to ...</td></tr></tbody></table> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>tv_des = data[data['type'] == 'TV Show'].reset_index() tv_des = tv_des[['title', 'description']] tv_des.head()</code> &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>title</th><th>description</th></tr></thead><tbody><tr><td>0</td><td>3%</td><td>In a future where the elite inhabit an island ...</td></tr><tr><td>1</td><td>46</td><td>A genetics professor experiments with a treatm...</td></tr><tr><td>2</td><td>1983</td><td>In this dark alt-history thriller, a naïve law...</td></tr><tr><td>3</td><td>SAINT SEIYA: Knights of the Zodiac</td><td>Seiya and the Knights of the Zodiac rise again...</td></tr><tr><td>4</td><td>#blackAF</td><td>Kenya Barris and his family navigate relations...</td></tr></tbody></table> 
 <h4>5.2 构建词汇表</h4> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>stopwords=['i', 'me', 'my', 'myself', 'we', 'our', 'ours', 'ourselves', 'you', 'your', 'yours', 'yourself', 'yourselves', 'he', 'him', 'his', 'himself', 'she', 'her', 'hers', 'herself', 'it', 'its', 'itself', 'they', 'them', 'their', 'theirs', 'themselves', 'what', 'which', 'who', 'whom', 'this', 'that', 'these', 'those', 'am', 'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'having', 'do', 'does', 'did', 'doing', 'a', 'an', 'the', 'and', 'but', 'if', 'or', 'because', 'as', 'until', 'while', 'of', 'at', 'by', 'for', 'with', 'about', 'against', 'between', 'into', 'through', 'during', 'before', 'after', 'above', 'below', 'to', 'from', 'up', 'down', 'in', 'out', 'on', 'off', 'over', 'under', 'again', 'further', 'then', 'once', 'here', 'there', 'when', 'where', 'why', 'how', 'all', 'any', 'both', 'each', 'few', 'more', 'most', 'other', 'some', 'such', 'no', 'nor', 'not', 'only', 'own', 'same', 'so', 'than', 'too', 'very', 's', 't', 'can', 'will', 'just', 'don', 'should', 'now', 'd', 'll', 'm', 'o', 're', 've', 'y', 'ain', 'aren', 'couldn', 'didn', 'doesn', 'hadn', 'hasn', 'haven', 'isn', 'ma', 'mightn', 'mustn', 'needn', 'shan', 'shouldn', 'wasn', 'weren', 'won', 'wouldn']</code> &lt;/pre&gt;</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>def word_tokenize(text): return [w.lower() for w in text.split()]</code> &lt;/pre&gt;</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`filtered_movies = []<br> movies_words = []</p> 
 <p>for text in movies_des['description']:<br> text_tokens = word_tokenize(text)<br> tokens_without_sw = [word.lower() for word in text_tokens if not word in stopwords]<br> movies_words.append(tokens_without_sw)<br> filtered = (" ").join(tokens_without_sw)<br> filtered_movies.append(filtered)</p> 
 <p>movies_words = [val for sublist in movies_words for val in sublist]<br> movies_words = sorted(set(movies_words))<br> movies_des['description_filtered'] = filtered_movies<br> movies_des.head()` &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>title</th><th>description</th><th>description_filtered</th></tr></thead><tbody><tr><td>0</td><td>7:19</td><td>After a devastating earthquake hits Mexico Cit...</td><td>devastating earthquake hits mexico city, trapp...</td></tr><tr><td>1</td><td>23:59</td><td>When an army recruit is found dead, his fellow...</td><td>army recruit found dead, fellow soldiers force...</td></tr><tr><td>2</td><td>9</td><td>In a postapocalyptic world, rag-doll robots hi...</td><td>postapocalyptic world, rag-doll robots hide fe...</td></tr><tr><td>3</td><td>21</td><td>A brilliant group of students become card-coun...</td><td>brilliant group students become card-counting ...</td></tr><tr><td>4</td><td>122</td><td>After an awful accident, a couple admitted to ...</td><td>awful accident, couple admitted grisly hospita...</td></tr></tbody></table> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`filtered_tv = []<br> tv_words = []<br> for text in tv_des['description']:<br> text_tokens = word_tokenize(text)<br> tokens_without_sw = [word.lower() for word in text_tokens if not word in stopwords]<br> tv_words.append(tokens_without_sw)<br> filtered = (" ").join(tokens_without_sw)<br> filtered_tv.append(filtered)</p> 
 <p>tv_words = [val for sublist in tv_words for val in sublist]<br> tv_words = sorted(set(tv_words))<br> tv_des['description_filtered'] = filtered_tv<br> tv_des.head()` &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>title</th><th>description</th><th>description_filtered</th></tr></thead><tbody><tr><td>0</td><td>3%</td><td>In a future where the elite inhabit an island ...</td><td>future elite inhabit island paradise far crowd...</td></tr><tr><td>1</td><td>46</td><td>A genetics professor experiments with a treatm...</td><td>genetics professor experiments treatment comat...</td></tr><tr><td>2</td><td>1983</td><td>In this dark alt-history thriller, a naïve law...</td><td>dark alt-history thriller, naïve law student w...</td></tr><tr><td>3</td><td>SAINT SEIYA: Knights of the Zodiac</td><td>Seiya and the Knights of the Zodiac rise again...</td><td>seiya knights zodiac rise protect reincarnatio...</td></tr><tr><td>4</td><td>#blackAF</td><td>Kenya Barris and his family navigate relations...</td><td>kenya barris family navigate relationships, ra...</td></tr></tbody></table> 
 <h4>5.3 构建文本one hot表示向量</h4> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`movie_word_binary = [[0] * 0 for i in range(len(set(movies_words)))]</p> 
 <p>for des in movies_des['description_filtered']:<br> k = 0<br> for word in movies_words:<br> if word in des:<br> movie_word_binary[k].append(1.0)<br> else:<br> movie_word_binary[k].append(0.0)<br> k+=1</p> 
 <p>movie_word_binary = pd.DataFrame(movie_word_binary).transpose()` &lt;/pre&gt;</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`tv_word_binary = [[0] * 0 for i in range(len(set(tv_words)))]</p> 
 <p>for des in tv_des['description_filtered']:<br> k = 0<br> for word in tv_words:<br> if word in des:<br> tv_word_binary[k].append(1.0)<br> else:<br> tv_word_binary[k].append(0.0)<br> k+=1</p> 
 <p>tv_word_binary = pd.DataFrame(tv_word_binary).transpose()` &lt;/pre&gt;</p> 
 <h4>5.4 基于内容的影视作品推荐</h4> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>def recommender2(search): cs_list = [] binary_list = [] if search in movies_des['title'].values: idx = movies_des[movies_des['title'] == search].index.item() for i in movie_word_binary.iloc[idx]: binary_list.append(i) point1 = np.array(binary_list).reshape(1, -1) point1 = [val for sublist in point1 for val in sublist] for j in tqdm(range(len(movies_des))): binary_list2 = [] for k in movie_word_binary.iloc[j]: binary_list2.append(k) point2 = np.array(binary_list2).reshape(1, -1) point2 = [val for sublist in point2 for val in sublist] dot_product = np.dot(point1, point2) norm_1 = np.linalg.norm(point1) norm_2 = np.linalg.norm(point2) cos_sim = dot_product / (norm_1 * norm_2) cs_list.append(cos_sim) movies_copy = movies_des.copy() movies_copy['cos_sim'] = cs_list results = movies_copy.sort_values('cos_sim', ascending=False) results = results[results['title'] != search] top_results = results.head(5) return(top_results) elif search in tv_des['title'].values: idx = tv_des[tv_des['title'] == search].index.item() for i in tv_word_binary.iloc[idx]: binary_list.append(i) point1 = np.array(binary_list).reshape(1, -1) point1 = [val for sublist in point1 for val in sublist] for j in tqdm(range(len(tv))): binary_list2 = [] for k in tv_word_binary.iloc[j]: binary_list2.append(k) point2 = np.array(binary_list2).reshape(1, -1) point2 = [val for sublist in point2 for val in sublist] dot_product = np.dot(point1, point2) norm_1 = np.linalg.norm(point1) norm_2 = np.linalg.norm(point2) cos_sim = dot_product / (norm_1 * norm_2) cs_list.append(cos_sim) tv_copy = tv_des.copy() tv_copy['cos_sim'] = cs_list results = tv_copy.sort_values('cos_sim', ascending=False) results = results[results['title'] != search] top_results = results.head(5) return(top_results) else: return("Title not in dataset. Please check spelling.")</code> &lt;/pre&gt;</p> 
 <h4>5.3 电影推荐</h4> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>pd.options.display.max_colwidth = 300 recommender2('The Conjuring')</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>100%|██████████| 4761/4761 [06:03&lt;00:00, 13.11it/s]</code></pre> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>title</th><th>description</th><th>description_filtered</th><th>cos_sim</th></tr></thead><tbody><tr><td>2549</td><td>Mirai</td><td>Unhappy after his new baby sister displaces him, four-year-old Kun begins meeting people and pets from his family's history in their unique house.</td><td>unhappy new baby sister displaces him, four-year-old kun begins meeting people pets family's history unique house.</td><td>0.426401</td></tr><tr><td>1632</td><td>Hard Lessons</td><td>This drama based on real-life events tells the story of George McKenna, the tough, determined new principal of a notorious Los Angeles high school.</td><td>drama based real-life events tells story george mckenna, tough, determined new principal notorious los angeles high school.</td><td>0.376256</td></tr><tr><td>2372</td><td>Macchli Jal Ki Rani Hai</td><td>After relocating to a different town with her husband, a housewife begins to sense the existence of a mysterious presence in their new house.</td><td>relocating different town husband, housewife begins sense existence mysterious presence new house.</td><td>0.375467</td></tr><tr><td>3910</td><td>The Eyes of My Mother</td><td>At the remote farmhouse where she once witnessed a traumatic childhood event, a young woman develops a grisly fascination with violence.</td><td>remote farmhouse witnessed traumatic childhood event, young woman develops grisly fascination violence.</td><td>0.371312</td></tr><tr><td>227</td><td>Adrishya</td><td>A family’s harmonious existence is interrupted when the young son begins showing symptoms of anxiety that seem linked to disturbing events at home.</td><td>family’s harmonious existence interrupted young son begins showing symptoms anxiety seem linked disturbing events home.</td><td>0.367423</td></tr></tbody></table> 
 <h4>5.4 电视节目推荐</h4> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>recommender2('After Life')</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>100%|██████████| 1891/1891 [01:32&lt;00:00, 20.46it/s]</code></pre> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>title</th><th>description</th><th>description_filtered</th><th>cos_sim</th></tr></thead><tbody><tr><td>1628</td><td>The Paper</td><td>A construction magnate takes over a struggling newspaper and attempts to wield editorial influence for power and personal gain.</td><td>construction magnate takes struggling newspaper attempts wield editorial influence power personal gain.</td><td>0.351351</td></tr><tr><td>1848</td><td>Winter Sun</td><td>Years after ruthless businessmen kill his father and order the death of his twin brother, a modest fisherman adopts a new persona to exact revenge.</td><td>years ruthless businessmen kill father order death twin brother, modest fisherman adopts new persona exact revenge.</td><td>0.311741</td></tr><tr><td>1768</td><td>Under the Black Moonlight</td><td>A college art club welcomes a new member who has the secret ability to smell death and who warns one of them to leave her boyfriend ... or else.</td><td>college art club welcomes new member secret ability smell death warns one leave boyfriend ... else.</td><td>0.277885</td></tr><tr><td>1180</td><td>Private Practice</td><td>At Oceanside Wellness Center, Dr. Addison Montgomery deals with competing personalities in the new world of holistic medicine.</td><td>oceanside wellness center, dr. addison montgomery deals competing personalities new world holistic medicine.</td><td>0.275777</td></tr><tr><td>1271</td><td>Santa Clarita Diet</td><td>They're ordinary husband and wife realtors until she undergoes a dramatic change that sends them down a road of death and destruction. In a good way.</td><td>they're ordinary husband wife realtors undergoes dramatic change sends road death destruction. good way.</td><td>0.256748</td></tr></tbody></table> 
 <h2>基于Graph的推荐引擎构建</h2> 
 <p>我们这个教程的主要目的是基于Graph 节点的Adamic Adar指标来推荐相似电影。如果Adamic Adar指标越高，就代表两个节点越相近。</p> 
 <h2>Adamic Adar 指标</h2> 
 <p>Adamic/Adar (Frequency-Weighted Common Neighbors)</p> 
 <p>Adamic-Adar 简称AA，该指标根据共同邻居的节点的度给每个节点赋予一个权重值，即为每个节点的度的对数分之一。然后把节点对的所有共同邻居的权重值相加，其和作为该节点对的相似度值。</p> 
 <p>这个方法同样是对Common Neighbors的改进，当我们计算两个相同邻居的数量的时候，其实每个邻居的“重要程度”都是不一样的，我们认为这个邻居的邻居数量越少，就越凸显它作为“中间人”的重要性，毕竟一共只认识那么少人，却恰好是x，y的好朋友。</p> 
 <p>例如：</p> 
 <ul><li>x,y是两个节点(在这个例子中就是两个电影)</li><li>N(one_node)是返回某个节点的相邻节点集合大小的函数，比如x有相邻节点a,b,c那么这个函数就返回3</li></ul> 
 <p>这个公式的含义就是，比如对于节点x和y，遍历x和y的每一个共同节点u，然后将他们所有的 1/log(N(u))相加</p> 
 <p>的大小决定了节点u的重要性:</p> 
 <ul><li>如果x和y共享节点u，并且节点u有大量的邻居节点，说明这个节点u越不重要或者越不相关：N(u)值越大，1/log((u))就越小</li><li>如果x和y共享节点u，并且节点u只有很少的的邻居节点，说明这个节点u越重要或者越相关：N(u)值越小，1/log((u))就越大</li></ul> 
 <p>这个可以理解我向我们生活中，如果同学A和同学B是通过同学C认识的，而同学C的社交关系很简单或者周围人很少，说明C是能够将A和B强关联的人物</p> 
 <h2>基于Graph的影视推荐系统如何应用文本描述信息?</h2> 
 <h3>方法1 将文本的TF-IDF权重作为Kmeans进行无监督聚类</h3> 
 <p>如果两个电影同属于分组，那么这两个电影共享一个节点。如果这个分组内的电影数量越少，该聚类分组对于这两个电影越重要，但是这个结论有可能在”聚类标签之前的样本非常不均衡“的时候失效。</p> 
 <h3>方法2 构建电影的TF-IDF向量表示矩阵</h3> 
 <p>通过获取每一个电影的tfidf向量表示，然后基于余弦相似度获取相似性最高的top5个其他电影，然后创建一个相似节点簇，然后通过Adamin Adar评估该簇</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code># 导入包 import networkx as nx # 构建Graph import matplotlib.pyplot as plt import pandas as pd import numpy as np import math as math import time plt.style.use('seaborn') plt.rcParams['figure.figsize'] = [14,14]</code> &lt;/pre&gt;</p> 
 <h2>加载数据集</h2> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`# 加载数据<br> df = pd.read_csv('/home/kesci/input/netflix8714/netflix_titles.csv')</p> 
 <h2>转换时间格式:将August 14, 2020字符串转为2020-08-14</h2> 
 <p>df["date_added"] = pd.to_datetime(df['date_added'])<br> df['year'] = df['date_added'].dt.year # 获取年份<br> df['month'] = df['date_added'].dt.month # 获取月份<br> df['day'] = df['date_added'].dt.day # 获取天<br> df.head()` &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>show_id</th><th>type</th><th>title</th><th>director</th><th>cast</th><th>country</th><th>date_added</th><th>release_year</th><th>rating</th><th>duration</th><th>listed_in</th><th>description</th><th>year</th><th>month</th><th>day</th></tr></thead><tbody><tr><td>0</td><td>s1</td><td>TV Show</td><td>3%</td><td>NaN</td><td>João Miguel, Bianca Comparato, Michel Gomes, R...</td><td>Brazil</td><td>2020-08-14</td><td>2020</td><td>TV-MA</td><td>4 Seasons</td><td>International TV Shows, TV Dramas, TV Sci-Fi &amp;...</td><td>In a future where the elite inhabit an island ...</td><td>2020.0</td><td>8.0</td><td>14.0</td></tr><tr><td>1</td><td>s2</td><td>Movie</td><td>7:19</td><td>Jorge Michel Grau</td><td>Demián Bichir, Héctor Bonilla, Oscar Serrano, ...</td><td>Mexico</td><td>2016-12-23</td><td>2016</td><td>TV-MA</td><td>93 min</td><td>Dramas, International Movies</td><td>After a devastating earthquake hits Mexico Cit...</td><td>2016.0</td><td>12.0</td><td>23.0</td></tr><tr><td>2</td><td>s3</td><td>Movie</td><td>23:59</td><td>Gilbert Chan</td><td>Tedd Chan, Stella Chung, Henley Hii, Lawrence ...</td><td>Singapore</td><td>2018-12-20</td><td>2011</td><td>R</td><td>78 min</td><td>Horror Movies, International Movies</td><td>When an army recruit is found dead, his fellow...</td><td>2018.0</td><td>12.0</td><td>20.0</td></tr><tr><td>3</td><td>s4</td><td>Movie</td><td>9</td><td>Shane Acker</td><td>Elijah Wood, John C. Reilly, Jennifer Connelly...</td><td>United States</td><td>2017-11-16</td><td>2009</td><td>PG-13</td><td>80 min</td><td>Action &amp; Adventure, Independent Movies, Sci-Fi...</td><td>In a postapocalyptic world, rag-doll robots hi...</td><td>2017.0</td><td>11.0</td><td>16.0</td></tr><tr><td>4</td><td>s5</td><td>Movie</td><td>21</td><td>Robert Luketic</td><td>Jim Sturgess, Kevin Spacey, Kate Bosworth, Aar...</td><td>United States</td><td>2020-01-01</td><td>2008</td><td>PG-13</td><td>123 min</td><td>Dramas</td><td>A brilliant group of students become card-coun...</td><td>2020.0</td><td>1.0</td><td>1.0</td></tr></tbody></table> 
 <p>通过上表输出我们可以已经获取了每个作品的year,month，day</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt; `# 导演列表director，标签列表listed_in，演员列表cast和国家country这些列包含一组值，我们可以按照逗号，进行分割，后去列表值</p> 
 <h2>如果还有NAN值，我们就返回一个空列表[]</h2> 
 <p>df['directors'] = df['director'].apply(lambda l: [] if pd.isna(l) else [i.strip() for i in l.split(",")])<br> df['categories'] = df['listed_in'].apply(lambda l: [] if pd.isna(l) else [i.strip() for i in l.split(",")])<br> df['actors'] = df['cast'].apply(lambda l: [] if pd.isna(l) else [i.strip() for i in l.split(",")])<br> df['countries'] = df['country'].apply(lambda l: [] if pd.isna(l) else [i.strip() for i in l.split(",")])</p> 
 <p>df.head(3)` &lt;/pre&gt;</p> 
 <p>&lt;style scoped=""&gt;.dataframe tbody tr th:only-of-type { vertical-align: middle; } &lt;pre&gt;&lt;code&gt;.dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } &lt;/code&gt;&lt;/pre&gt;&lt;/style&gt;</p> 
 <table><thead><tr><th></th><th>show_id</th><th>type</th><th>title</th><th>director</th><th>cast</th><th>country</th><th>date_added</th><th>release_year</th><th>rating</th><th>duration</th><th>listed_in</th><th>description</th><th>year</th><th>month</th><th>day</th><th>directors</th><th>categories</th><th>actors</th><th>countries</th></tr></thead><tbody><tr><td>0</td><td>s1</td><td>TV Show</td><td>3%</td><td>NaN</td><td>João Miguel, Bianca Comparato, Michel Gomes, R...</td><td>Brazil</td><td>2020-08-14</td><td>2020</td><td>TV-MA</td><td>4 Seasons</td><td>International TV Shows, TV Dramas, TV Sci-Fi &amp;...</td><td>In a future where the elite inhabit an island ...</td><td>2020.0</td><td>8.0</td><td>14.0</td><td>[]</td><td>[International TV Shows, TV Dramas, TV Sci-Fi ...</td><td>[João Miguel, Bianca Comparato, Michel Gomes, ...</td><td>[Brazil]</td></tr><tr><td>1</td><td>s2</td><td>Movie</td><td>7:19</td><td>Jorge Michel Grau</td><td>Demián Bichir, Héctor Bonilla, Oscar Serrano, ...</td><td>Mexico</td><td>2016-12-23</td><td>2016</td><td>TV-MA</td><td>93 min</td><td>Dramas, International Movies</td><td>After a devastating earthquake hits Mexico Cit...</td><td>2016.0</td><td>12.0</td><td>23.0</td><td>[Jorge Michel Grau]</td><td>[Dramas, International Movies]</td><td>[Demián Bichir, Héctor Bonilla, Oscar Serrano,...</td><td>[Mexico]</td></tr><tr><td>2</td><td>s3</td><td>Movie</td><td>23:59</td><td>Gilbert Chan</td><td>Tedd Chan, Stella Chung, Henley Hii, Lawrence ...</td><td>Singapore</td><td>2018-12-20</td><td>2011</td><td>R</td><td>78 min</td><td>Horror Movies, International Movies</td><td>When an army recruit is found dead, his fellow...</td><td>2018.0</td><td>12.0</td><td>20.0</td><td>[Gilbert Chan]</td><td>[Horror Movies, International Movies]</td><td>[Tedd Chan, Stella Chung, Henley Hii, Lawrence...</td><td>[Singapore]</td></tr></tbody></table> 
 <p>我们可以看到listed_in中International TV Shows, TV Dramas, TV Sci-Fi转为[International TV Shows, TV Dramas, TV Sci-Fi ]，其他几列也是</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>print(df.shape)</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>(7787, 19)</code></pre> 
 <h2>基于TF-IDF的Kmeans聚类</h2> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`from sklearn.feature_extraction.text import TfidfVectorizer # 构建TFIDF向量<br> from sklearn.metrics.pairwise import linear_kernel<br> from sklearn.cluster import MiniBatchKMeans # Kmeans算法</p> 
 <h2>构建作品文本描述tfidf矩阵</h2> 
 <p>start_time = time.time()<br> text_content = df['description']<br> vector = TfidfVectorizer(max_df=0.4, # 去除文本频率大约0.4的词<br> min_df=1, # 词语最小出现次数<br> stop_words='english', # 去除停用词<br> lowercase=True, # 将大写字母转为小写<br> use_idf=True, # 使用idf<br> norm=u'l2', # 正则化<br> smooth_idf=True # 平滑因子，避免idf为0<br> )<br> tfidf = vector.fit_transform(text_content)</p> 
 <h2>Kmeans聚类</h2> 
 <p>k = 200# 聚类中心个数<br> kmeans = MiniBatchKMeans(n_clusters = k)<br> kmeans.fit(tfidf)<br> centers = kmeans.cluster_centers_.argsort()[:,::-1]<br> terms = vector.get_feature_names()</p> 
 <p>request_transform = vector.transform(df['description'])</p> 
 <h2>聚类标签</h2> 
 <p>df['cluster'] = kmeans.predict(request_transform)</p> 
 <p>df['cluster'].value_counts().head()` &lt;/pre&gt;</p> 
 <pre class="has"><code>19     7179
39      333
182       6
1         5
144       5
Name: cluster, dtype: int64</code></pre> 
 <p>我们可以看到聚类标签很不均衡，19有7179，39 有333个，所以我们不能基于聚类标签cluster来做节点创建了。</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code># 输入目标电影描述，查找最相似的topn个电影 def find_similar(tfidf_matrix, index, top_n = 5): cosine_similarities = linear_kernel(tfidf_matrix[index:index+1], tfidf_matrix).flatten() related_docs_indices = [i for i in cosine_similarities.argsort()[::-1] if i != index] return [index for index in related_docs_indices][0:top_n]</code> &lt;/pre&gt;</p> 
 <h2>影视作品的知识图谱构建</h2> 
 <h3>节点定义</h3> 
 <p>节点包括如下 :</p> 
 <ul><li>Movies：电影</li><li>Person ( actor or director) ：人物</li><li>Categorie：勒边</li><li>Countries：国家</li><li>Cluster (description)：描述</li><li>Sim(title) top 5 similar movies in the sense of the description:相似电影电影</li></ul> 
 <h3>边定义</h3> 
 <p>关系包括如下 :</p> 
 <ul><li>ACTED_IN：演员和电影之间的关系</li><li>CAT_IN：类别和电影之间的关系</li><li>DIRECTED：导演与电影之间的关系</li><li>COU_IN：国家与电影之间的关系</li><li>DESCRIPTION：聚类标签和电影之间的关系</li><li>SIMILARITY：在描述意义上相似的关系</li></ul> 
 <p>两部电影不是直接相连的，而是它们共享人物，类别，团伙和国家，所以可以构建联系</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`G = nx.Graph(label="MOVIE")<br> start_time = time.time()<br> for i, rowi in df.iterrows():<br> if (i%1000==0):<br> print(" iter {} -- {} seconds --".format(i,time.time() - start_time))<br> G.add_node(rowi['title'],key=rowi['show_id'],label="MOVIE",mtype=rowi['type'],rating=rowi['rating'])</p> 
 <h2>G.add_node(rowi['cluster'],label="CLUSTER")</h2> 
 <h2>G.add_edge(rowi['title'], rowi['cluster'], label="DESCRIPTION")</h2> 
 <pre class="has"><code>for element in rowi['actors']: 
    # 创建“演员”节点”,类型为PERSON
    G.add_node(element,label="PERSON")
    # 创建作品与演员的关系：ACTED_IN
    G.add_edge(rowi['title'], element, label="ACTED_IN")
for element in rowi['categories']:
    # 创建“类别标签”节点“，类型为CAT
    G.add_node(element,label="CAT")
    # 创建作品与类别标签的关系：CAT_IN
    G.add_edge(rowi['title'], element, label="CAT_IN")
for element in rowi['directors']:
    # 创建“导演”节点，类别为PERSON
    G.add_node(element,label="PERSON")
    # 创建作品与导演的关系：DIRECTED
    G.add_edge(rowi['title'], element, label="DIRECTED")
for element in rowi['countries']:
    # 创建“国家”节点，类别为COU
    G.add_node(element,label="COU")
    # 创建作品与国家的关系：COU_IN
    G.add_edge(rowi['title'], element, label="COU_IN")
# 创建相似作品节点
indices = find_similar(tfidf, i, top_n = 5) # 取相似性最高的top5
snode="Sim("+rowi['title'][:15].strip()+")"        
G.add_node(snode,label="SIMILAR")
G.add_edge(rowi['title'], snode, label="SIMILARITY")
for element in indices:
    G.add_edge(snode, df['title'].loc[element], label="SIMILARITY")</code></pre> 
 <p>print(" finish -- {} seconds --".format(time.time() - start_time))` &lt;/pre&gt;</p> 
 <pre class="has"><code>iter 0 -- 0.02708911895751953 seconds --
 iter 1000 -- 4.080239295959473 seconds --
 iter 2000 -- 8.126200675964355 seconds --
 iter 3000 -- 12.209706783294678 seconds --
 iter 4000 -- 16.362282037734985 seconds --
 iter 5000 -- 20.392311811447144 seconds --
 iter 6000 -- 24.43456506729126 seconds --
 iter 7000 -- 28.474121809005737 seconds --
 finish -- 31.648479461669922 seconds --</code></pre> 
 <h2>构建Graph</h2> 
 <p>设置不同类型节点的颜色</p> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`def get_all_adj_nodes(list_in):<br> sub_graph=set()<br> for m in list_in:<br> sub_graph.add(m)<br> for e in G.neighbors(m):<br> sub_graph.add(e)<br> return list(sub_graph)<br> def draw_sub_graph(sub_graph):<br> subgraph = G.subgraph(sub_graph)<br> colors=[]<br> for e in subgraph.nodes():<br> if G.nodes[e]['label']=="MOVIE":<br> colors.append('blue')<br> elif G.nodes[e]['label']=="PERSON":<br> colors.append('red')<br> elif G.nodes[e]['label']=="CAT":<br> colors.append('green')<br> elif G.nodes[e]['label']=="COU":<br> colors.append('yellow')<br> elif G.nodes[e]['label']=="SIMILAR":<br> colors.append('orange')<br> elif G.nodes[e]['label']=="CLUSTER":<br> colors.append('orange')</p> 
 <pre class="has"><code>nx.draw(subgraph, with_labels=True, font_weight='bold',node_color=colors)
plt.show()` &lt;/pre&gt;</code></pre> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>list_in=["Ocean's Twelve","Ocean's Thirteen"] sub_graph = get_all_adj_nodes(list_in) draw_sub_graph(sub_graph)</code> &lt;/pre&gt;</p> 
 <div class="image-package"> 
  <div class="image-container"> 
   <div class="image-view" style="text-align: center;"> 
    <img src="https://images2.imgbox.com/df/41/rQq6jWiL_o.png" style="outline: none;"> 
   </div> 
  </div> 
  <div class="image-caption">
    image 
  </div> 
 </div> 
 <h2>基于影视知识图谱的推荐系统</h2> 
 <ul><li>探索目标电影的所在地→这是演员，导演，国家/地区和类别的列表</li><li>探索每个邻居的邻居→发现与目标字段共享节点的电影</li><li>计算 Adamic Adar度量→最终结果</li></ul> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;`def get_recommendation(root):<br> commons_dict = {}<br> for e in G.neighbors(root):<br> for e2 in G.neighbors(e):<br> if e2==root:<br> continue<br> if G.nodes[e2]['label']=="MOVIE":<br> commons = commons_dict.get(e2)<br> if commons==None:<br> commons_dict.update({e2 : [e]})<br> else:<br> commons.append(e)<br> commons_dict.update({e2 : commons})<br> movies=[]<br> weight=[]<br> for key, values in commons_dict.items():<br> w=0.0<br> for e in values:<br> w=w+1/math.log(G.degree(e))<br> movies.append(key)<br> weight.append(w)</p> 
 <pre class="has"><code>result = pd.Series(data=np.array(weight),index=movies)
result.sort_values(inplace=True,ascending=False)        
return result;` &lt;/pre&gt;</code></pre> 
 <h2>推荐结果测试</h2> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>result = get_recommendation("Ocean's Twelve") result2 = get_recommendation("Ocean's Thirteen") result3 = get_recommendation("The Devil Inside") result4 = get_recommendation("Stranger Things") print("*"*40+"\n Recommendation for 'Ocean's Twelve'\n"+"*"*40) print(result.head()) print("*"*40+"\n Recommendation for 'Ocean's Thirteen'\n"+"*"*40) print(result2.head()) print("*"*40+"\n Recommendation for 'Belmonte'\n"+"*"*40) print(result3.head()) print("*"*40+"\n Recommendation for 'Stranger Things'\n"+"*"*40) print(result4.head())</code> &lt;/pre&gt;</p> 
 <pre class="has"><code>****************************************
 Recommendation for 'Ocean's Twelve'
****************************************
Ocean's Thirteen    7.033613
Ocean's Eleven      1.528732
The Informant!      1.252955
Babel               1.162454
Cannabis            1.116221
dtype: float64
****************************************
 Recommendation for 'Ocean's Thirteen'
****************************************
Ocean's Twelve       7.033613
The Departed         2.232071
Ocean's Eleven       2.086843
Brooklyn's Finest    1.467979
Boyka: Undisputed    1.391627
dtype: float64
****************************************
 Recommendation for 'Belmonte'
****************************************
The Boy                                  1.901648
The Devil and Father Amorth              1.413791
Making a Murderer                        1.239666
Belief: The Possession of Janet Moses    1.116221
I Am Vengeance                           1.116221
dtype: float64
****************************************
 Recommendation for 'Stranger Things'
****************************************
Beyond Stranger Things    12.047956
Rowdy Rathore              2.585399
Big Stone Gap              2.355888
Kicking and Screaming      1.566140
Prank Encounters           1.269862
dtype: float64</code></pre> 
 <h2>推荐结果画图展示</h2> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>reco=list(result.index[:4].values) reco.extend(["Ocean's Twelve"]) sub_graph = get_all_adj_nodes(reco) draw_sub_graph(sub_graph)</code> &lt;/pre&gt;</p> 
 <div class="image-package"> 
  <div class="image-container"> 
   <div class="image-view" style="text-align: center;"> 
    <img src="https://images2.imgbox.com/91/1d/UGkMAEfX_o.png" style="outline: none;"> 
   </div> 
  </div> 
  <div class="image-caption">
    image 
  </div> 
 </div> 
 <p>&lt;pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"&gt;<code>reco=list(result4.index[:4].values) reco.extend(["Stranger Things"]) sub_graph = get_all_adj_nodes(reco) draw_sub_graph(sub_graph)</code> &lt;/pre&gt;</p> 
 <div class="image-package"> 
  <div class="image-container"> 
   <div class="image-view" style="text-align: center;"> 
    <img src="https://images2.imgbox.com/39/a7/1yIztoa4_o.png" style="outline: none;"> 
   </div> 
  </div> 
  <div class="image-caption">
    image 
  </div> 
 </div> 
</article>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/00714578b49918b8f1d73bfec01b1361/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">c&#43;&#43;primer</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/80637609f807db53f78e813f37717b16/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">RocketMQ入门-RocketMQ批量消息</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>