<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Laravel自带SMTP邮件组件实现发送邮件（QQ、163、企业邮箱都可） - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Laravel自带SMTP邮件组件实现发送邮件（QQ、163、企业邮箱都可）" />
<meta property="og:description" content="laravel自带SMTP邮件配置和遇到的坑 laravel自带SwiftMailer库，集成了多种邮件API，可以很方便的实现邮件的发送。在本教程中使用到的是SMTP（Simple Message Transfer Protocol）简单邮件传输协议，通常理解为邮件发送服务器。
以QQ邮箱为例 使用QQ邮箱的话，需要开启POP3和SMTP服务（QQ邮箱登录=》选择设置=》账户=》下拉找到图2）。 使用企业邮箱不用开启SMTP，因为企业邮箱自带，如果配置有问题去查一下是否关闭安全登录（企业邮箱） 开启方式如下： 当开启成功会生成密钥，这个东西会在配置中用： 配置laravel .env文件 MAIL_DRIVER=smtp MAIL_HOST=smtp.qq.com MAIL_PORT=465 MAIL_USERNAME=********@qq.com MAIL_PASSWORD=qq邮箱此处填写上图产生的授权码 MAIL_FROM_NAME=邮箱的名称 MAIL_ENCRYPTION=ssl 配置laravel config/mail.php文件 这文件是laravel自带的文件，如果没有需求，内容可不动
return [ &#39;driver&#39; =&gt; env(&#39;MAIL_DRIVER&#39;, &#39;smtp&#39;), &#39;host&#39; =&gt; env(&#39;MAIL_HOST&#39;, &#39;smtp.mailgun.org&#39;), &#39;port&#39; =&gt; env(&#39;MAIL_PORT&#39;, 587), &#39;from&#39; =&gt; [ &#39;address&#39; =&gt; env(&#34;MAIL_USERNAME&#34;, &#34;&#34;), &#39;name&#39; =&gt; env(&#34;MAIL_FROM_NAME&#34;) ], &#39;encryption&#39; =&gt; env(&#39;MAIL_ENCRYPTION&#39;), &#39;username&#39; =&gt; env(&#39;MAIL_USERNAME&#39;), &#39;password&#39; =&gt; env(&#39;MAIL_PASSWORD&#39;), &#39;sendmail&#39; =&gt; &#39;/usr/sbin/sendmail -bs&#39;, &#39;pretend&#39; =&gt; env(&#39;MAIL_PRETEND&#39;, false), ]; driver：用于配置默认的邮件发送驱动，Laravel支持多种邮件驱动方式，包括smtp、Mailgun、Maildrill、Amazon SES、mail和sendmail，Mailgun和Amazon SES都是收费的Maildrill目前不支持中国区用户，这三个都是第三方邮件服务。mail驱动使用PHP提供的mail函数发送，sendmail驱动通过Sendmail/Postfix（Linux）提供的命令发送邮件，smtp驱动通过支持ESMTP的SMTP发送邮件。就目前状况来看，使用smtp是最明智的选择，mail不安全，sendmail需要安装配置Sendmail/Postfix，其他要么付费要么不能用。host:邮箱所在主机，使用163邮箱，对应值是smtp.163.com，使用QQ邮箱，对应值是smtp.qq.com。使用腾讯企业邮箱，对应值是smtp.exmail.qq.comport:用于配置邮箱发送服务端口号，一般默认值是25，但如果设置SMTP使用SSL加密，该值为465。from:配置项包含address和name，前者表示你自己的邮箱，后者表示你邮件用户名（这里邮箱，是用来发邮件的邮箱）。encryption:表示加密类型，可以设置为null表示不使用任何加密，也可以设置为tls或ssl。username: 表示邮箱账号，比如123456789@qq.com password 表示上述邮箱登录对应登录密码。注意QQ邮箱的话应该开启POP3|SMTP服务时给的授权码。sendmail: 是在设置driver为sendmail时使用，用于指定sendmail命令路径。pretend: 用于配置是否将邮件发送记录到日志中，默认为false则发送邮件不记录日志，如果为true的话只记录日志不发送邮件，这一配置在本地开发中调试时很有用 开始代码之旅 生成控制器 php artisan make::controller MailController 配置路由 Route::any(&#39;mail/send&#39;,&#39;MailController@send&#39;); 在app/Http/Controllers生成了一个MailController控制器，如下所示： &lt;?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/84dabc4d0e5e76ceb1da8a98663eec14/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-13T00:30:37+08:00" />
<meta property="article:modified_time" content="2018-07-13T00:30:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Laravel自带SMTP邮件组件实现发送邮件（QQ、163、企业邮箱都可）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="laravel自带smtp邮件配置和遇到的坑">laravel自带SMTP邮件配置和遇到的坑</h2> 
<p>laravel自带SwiftMailer库，集成了多种邮件API，可以很方便的实现邮件的发送。在本教程中使用到的是SMTP（Simple Message Transfer Protocol）简单邮件传输协议，通常理解为邮件发送服务器。</p> 
<h3 id="以qq邮箱为例">以QQ邮箱为例</h3> 
<p>使用QQ邮箱的话，需要开启POP3和SMTP服务（QQ邮箱登录=》选择设置=》账户=》下拉找到图2）。 <br> 使用企业邮箱不用开启SMTP，因为企业邮箱自带，如果配置有问题去查一下是否关闭安全登录（企业邮箱） <br> 开启方式如下： <br> <img src="https://images2.imgbox.com/fb/27/vBv2iLp5_o.png" alt="这里写图片描述" title=""> <br> <img src="https://images2.imgbox.com/7e/9b/R7S1Rtc0_o.png" alt="这里写图片描述" title=""> <br> 当开启成功会生成密钥，这个东西会在配置中用： <br> <img src="https://images2.imgbox.com/89/9c/3f8Xc7Jl_o.png" alt="这里写图片描述" title=""></p> 
<h3 id="配置laravel-env文件">配置laravel .env文件</h3> 
<pre class="prettyprint"><code class=" hljs ini"><span class="hljs-setting">MAIL_DRIVER=<span class="hljs-value">smtp</span></span>
<span class="hljs-setting">MAIL_HOST=<span class="hljs-value">smtp.qq.com</span></span>
<span class="hljs-setting">MAIL_PORT=<span class="hljs-value"><span class="hljs-number">465</span></span></span>
<span class="hljs-setting">MAIL_USERNAME=<span class="hljs-value">********@qq.com</span></span>
<span class="hljs-setting">MAIL_PASSWORD=<span class="hljs-value">qq邮箱此处填写上图产生的授权码</span></span>
<span class="hljs-setting">MAIL_FROM_NAME=<span class="hljs-value">邮箱的名称</span></span>
<span class="hljs-setting">MAIL_ENCRYPTION=<span class="hljs-value">ssl</span></span></code></pre> 
<h3 id="配置laravel-configmailphp文件">配置laravel config/mail.php文件</h3> 
<p>这文件是laravel自带的文件，如果没有需求，内容可不动</p> 
<pre class="prettyprint"><code class=" hljs php"><span class="hljs-keyword">return</span> [
    <span class="hljs-string">'driver'</span> =&gt; env(<span class="hljs-string">'MAIL_DRIVER'</span>, <span class="hljs-string">'smtp'</span>),
    <span class="hljs-string">'host'</span> =&gt; env(<span class="hljs-string">'MAIL_HOST'</span>, <span class="hljs-string">'smtp.mailgun.org'</span>),
    <span class="hljs-string">'port'</span> =&gt; env(<span class="hljs-string">'MAIL_PORT'</span>, <span class="hljs-number">587</span>),
    <span class="hljs-string">'from'</span> =&gt; [
        <span class="hljs-string">'address'</span> =&gt; env(<span class="hljs-string">"MAIL_USERNAME"</span>, <span class="hljs-string">""</span>),
        <span class="hljs-string">'name'</span> =&gt; env(<span class="hljs-string">"MAIL_FROM_NAME"</span>)
    ],
    <span class="hljs-string">'encryption'</span> =&gt; env(<span class="hljs-string">'MAIL_ENCRYPTION'</span>),
    <span class="hljs-string">'username'</span> =&gt; env(<span class="hljs-string">'MAIL_USERNAME'</span>),
    <span class="hljs-string">'password'</span> =&gt; env(<span class="hljs-string">'MAIL_PASSWORD'</span>),
    <span class="hljs-string">'sendmail'</span> =&gt; <span class="hljs-string">'/usr/sbin/sendmail -bs'</span>,
    <span class="hljs-string">'pretend'</span> =&gt; env(<span class="hljs-string">'MAIL_PRETEND'</span>, <span class="hljs-keyword">false</span>),
];</code></pre> 
<ol><li><code>driver：</code>用于配置默认的邮件发送驱动，Laravel支持多种邮件驱动方式，包括smtp、Mailgun、Maildrill、Amazon SES、mail和sendmail，Mailgun和Amazon SES都是收费的Maildrill目前不支持中国区用户，这三个都是第三方邮件服务。mail驱动使用PHP提供的mail函数发送，sendmail驱动通过Sendmail/Postfix（Linux）提供的命令发送邮件，smtp驱动通过支持ESMTP的SMTP发送邮件。就目前状况来看，使用smtp是最明智的选择，mail不安全，sendmail需要安装配置Sendmail/Postfix，其他要么付费要么不能用。</li><li><code>host:</code>邮箱所在主机，使用163邮箱，对应值是smtp.163.com，使用QQ邮箱，对应值是smtp.qq.com。使用腾讯企业邮箱，对应值是smtp.exmail.qq.com</li><li><code>port:</code>用于配置邮箱发送服务端口号，一般默认值是25，但如果设置SMTP使用SSL加密，该值为465。</li><li><code>from:</code>配置项包含address和name，前者表示你自己的邮箱，后者表示你邮件用户名（这里邮箱，是用来发邮件的邮箱）。</li><li><code>encryption:</code>表示加密类型，可以设置为null表示不使用任何加密，也可以设置为tls或ssl。</li><li><code>username:</code> 表示邮箱账号，比如123456789@qq.com </li><li><code>password</code> 表示上述邮箱登录对应登录密码。注意QQ邮箱的话应该开启POP3|SMTP服务时给的授权码。</li><li><code>sendmail:</code> 是在设置driver为sendmail时使用，用于指定sendmail命令路径。</li><li><code>pretend:</code> 用于配置是否将邮件发送记录到日志中，默认为false则发送邮件不记录日志，如果为true的话只记录日志不发送邮件，这一配置在本地开发中调试时很有用</li></ol> 
<h3 id="开始代码之旅">开始代码之旅</h3> 
<h5 id="生成控制器">生成控制器</h5> 
<pre class="prettyprint"><code class=" hljs ruby">php artisan <span class="hljs-symbol">make:</span><span class="hljs-symbol">:controller</span> <span class="hljs-constant">MailController</span></code></pre> 
<h5 id="配置路由">配置路由</h5> 
<pre class="prettyprint"><code class=" hljs scss">Route<span class="hljs-value">::any(<span class="hljs-string">'mail/send'</span>,<span class="hljs-string">'MailController@send'</span>);</span></code></pre> 
<h5 id="在apphttpcontrollers生成了一个mailcontroller控制器如下所示">在app/Http/Controllers生成了一个MailController控制器，如下所示：</h5> 
<pre class="prettyprint"><code class=" hljs xml"><span class="php"><span class="hljs-preprocessor">&lt;?php</span> 
    <span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>; 
    <span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Requests</span>; 
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span> {<!-- --></span> 
        <span class="hljs-comment">//</span>
     }</span></code></pre> 
<p>编辑上面控制器，加入以下的逻辑处理：</p> 
<pre class="prettyprint"><code class=" hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">Mail</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailController</span>{<!-- --></span> 
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send</span><span class="hljs-params">()</span> {<!-- --></span>
     <span class="hljs-variable">$name</span> = <span class="hljs-string">'我发的第一份邮件'</span>; 
     <span class="hljs-comment">// Mail::send()的返回值为空，所以可以其他方法进行判断 </span>
     Mail::send(<span class="hljs-string">'emails.test'</span>,[<span class="hljs-string">'name'</span>=&gt;<span class="hljs-variable">$name</span>],<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(<span class="hljs-variable">$message</span>)</span>{<!-- --></span> 
     <span class="hljs-variable">$to</span> = <span class="hljs-string">'123456789@qq.com'</span>; <span class="hljs-variable">$message</span> -&gt;to(<span class="hljs-variable">$to</span>)-&gt;subject(<span class="hljs-string">'邮件测试'</span>); 
     }); 
     <span class="hljs-comment">// 返回的一个错误数组，利用此可以判断是否发送成功</span>
      dd(Mail::failures());
    } 
} </code></pre> 
<p>Mail::send();需要传三个参数，第一个为引用的模板，第二个为给模板传递的变量（邮箱发送的文本内容），第三个为一个闭包，参数绑定Mail类的一个实例。</p> 
<h5 id="在resourcesemails下创建一个模板文件">在resources/emails下创建一个模板文件。</h5> 
<pre class="prettyprint"><code class=" hljs handlebars"><span class="xml"><span class="php"></span></span><span class="hljs-expression">{<!-- -->{$<span class="hljs-variable">name</span>}}</span><span class="xml"><span class="php"> hello world。</span></span></code></pre> 
<p>好，现在在服务器上进行测试了，在地址栏输入<a href="http://localhost/mail/send" rel="nofollow">http://localhost/mail/send</a>(自己的访问地址)，发送成功。</p> 
<h3 id="1-发送纯文本邮件">1. 发送纯文本邮件</h3> 
<pre class="prettyprint"><code class=" hljs lasso">Mail<span class="hljs-tag">::raw</span>(<span class="hljs-string">'你好，我是PHP程序！'</span>, function (<span class="hljs-variable">$message</span>) {
    <span class="hljs-variable">$to</span> <span class="hljs-subst">=</span> <span class="hljs-string">'123456789@qq.com'</span>;
    <span class="hljs-variable">$message</span> <span class="hljs-subst">-&gt;</span><span class="hljs-keyword">to</span>(<span class="hljs-variable">$to</span>)<span class="hljs-subst">-&gt;</span>subject(<span class="hljs-string">'纯文本信息邮件测试'</span>);
});</code></pre> 
<h3 id="2邮件中发送附件">2.邮件中发送附件</h3> 
<p>发生图片：</p> 
<pre class="prettyprint"><code class=" hljs handlebars"><span class="xml"><span class="php"></span></span><span class="hljs-expression">{<!-- -->{$<span class="hljs-variable">name</span>}}</span><span class="xml"><span class="php">，这是一封测试邮件
&lt;br&gt;
&lt;img src=<span class="hljs-string">"</span></span></span><span class="hljs-expression">{<!-- -->{$<span class="hljs-variable">message-</span>&gt;<span class="hljs-variable">embedData</span>($<span class="hljs-variable">image</span>,'<span class="hljs-variable">test.jpg</span>')}}</span><span class="xml"><span class="php"><span class="hljs-string">"</span>&gt;</span></span></code></pre> 
<pre class="prettyprint"><code class=" hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send</span><span class="hljs-params">()</span>{<!-- --></span> 
    <span class="hljs-variable">$image</span> = Storage::get(<span class="hljs-string">'images/obama.jpg'</span>); <span class="hljs-comment">//本地文件</span>
    <span class="hljs-comment">//$image = 'http://www.baidu.com/sousuo/pic/sdaadar24545ssqq22.jpg';//网上图片</span>
    Mail::send(<span class="hljs-string">'emails.test'</span>,[<span class="hljs-string">'image'</span>=&gt;<span class="hljs-variable">$image</span>],<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(<span class="hljs-variable">$message</span>)</span>{<!-- --></span> 
        <span class="hljs-variable">$to</span> = <span class="hljs-string">'123456789@qq.com'</span>;
        <span class="hljs-variable">$message</span>-&gt;to(<span class="hljs-variable">$to</span>)-&gt;subject(<span class="hljs-string">'图片测试'</span>); 
    }); 
    <span class="hljs-keyword">if</span>(count(Mail::failures()) &lt; <span class="hljs-number">1</span>){
     <span class="hljs-keyword">echo</span> <span class="hljs-string">'发送邮件成功，请查收！'</span>; 
    }<span class="hljs-keyword">else</span>{
     <span class="hljs-keyword">echo</span> <span class="hljs-string">'发送邮件失败，请重试！'</span>;
    } 
}</code></pre> 
<h3 id="3-邮件附件">3. 邮件附件</h3> 
<pre class="prettyprint"><code class=" hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendFile</span><span class="hljs-params">()</span>{<!-- --></span> 
    <span class="hljs-variable">$name</span> = <span class="hljs-string">'我发的第一份邮件'</span>; 
    Mail::send(<span class="hljs-string">'emails.test'</span>,[<span class="hljs-string">'name'</span>=&gt;<span class="hljs-variable">$name</span>],<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(<span class="hljs-variable">$message</span>)</span>{<!-- --></span> 
        <span class="hljs-variable">$to</span> = <span class="hljs-string">'123456789@qq.com'</span>;
        <span class="hljs-variable">$message</span>-&gt;to(<span class="hljs-variable">$to</span>)-&gt;subject(<span class="hljs-string">'邮件测试'</span>); 
        <span class="hljs-variable">$attachment</span> = storage_path(<span class="hljs-string">'xls/files/test.xls'</span>);
         <span class="hljs-comment">// 在邮件中上传附件 </span>
        <span class="hljs-variable">$message</span>-&gt;attach(<span class="hljs-variable">$attachment</span>,[<span class="hljs-string">'as'</span>=&gt;<span class="hljs-string">'中文文档.xls'</span>]); 
    }); 
} </code></pre> 
<blockquote> 
 <p>$message的attach方法上传附件，该方法第一个参数是附件地址，第二个参数为一些额外参数，这里我们通过as指定附件在邮件中的显示名称。</p> 
</blockquote> 
<p>测试如果显示文件名乱码的话，就这样写</p> 
<pre class="prettyprint"><code class=" hljs php"><span class="hljs-variable">$message</span>-&gt;attach(<span class="hljs-variable">$attachment</span>,[<span class="hljs-string">'as'</span>=&gt;<span class="hljs-string">"=?UTF-8?B?"</span>.base64_encode(<span class="hljs-string">'中文文档'</span>).<span class="hljs-string">"?=.xls"</span>]);</code></pre> 
<p>好了，现在我们的邮件发生功能已经基本满足所有客户的需求了，欢迎小伙伴的留言和光顾，希望帮助每一个踩坑的小伙伴，如果有哪里不对的还希望各位小伙伴多多指出，如果对你请推荐给身边的小伙伴，此博客会时常更新，感谢参考过的每一个博客，谢谢这些前辈为我们填好的坑</p> 
<p>-</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/305f774f0b2d8af4fe9ebb36dae5a6dc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">springboot学习(九) websocket stomp配置,与session的结合以及ws/wss协议的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7a4900171f3a3fe27f7a5b8af2a7fc98/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Filesystem Hierarchy Standard(FHS文件系统结构标准）第一章&amp;第二章</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>