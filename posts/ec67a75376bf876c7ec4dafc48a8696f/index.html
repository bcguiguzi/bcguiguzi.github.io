<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ubuntu 20.04 aarch64 平台交叉编译 opencv 静态库 - 编程鬼谷子的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ubuntu 20.04 aarch64 平台交叉编译 opencv 静态库" />
<meta property="og:description" content="编译环境 win10 64 位
VMware Workstation Pro 16 虚拟机
虚拟机安装 ubuntu 20.04
opencv 版本： 来自 github 当前最新 4.7
目的 交叉编译 opencv 生成静态库（.a），用于 嵌入式 aarch64 平台。 环境配置方法 参考上一篇 ubuntu 20.04 aarch64 平台交叉编译 opencv 生成静态库 默认会生成 动态库（so），可以通过cmake 配置 -DBUILD_SHARED_LIBS=OFF 关闭动态库生成，这样就可以生成静态库了 cmake -DCMAKE_TOOLCHAIN_FILE=../platforms/linux/aarch64-musl.toolchain.cmake .. -DCMAKE_CXX_FLAGS=&#34;-march=armv8-a --static&#34; -DCMAKE_C_FLAGS=&#34;-march=armv8-a --static&#34; -DBUILD_SHARED_LIBS=OFF
其他 如果感觉 cmake 的命令太长，可以把各个配置放进 platforms/linux/aarch64-musl.toolchain.cmake 里面，这样 cmake 命令就会很精简
打开 vim platforms/linux/aarch64-musl.toolchain.cmake，然后进行各个特性或者第三方库的开关配置
set(CMAKE_SYSTEM_PROCESSOR aarch64) set(GCC_COMPILER_VERSION &#34;&#34; CACHE STRING &#34;GCC Compiler version&#34;) set(GNU_MACHINE &#34;aarch64-linux-musleabi&#34; CACHE STRING &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bcguiguzi.github.io/posts/ec67a75376bf876c7ec4dafc48a8696f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-13T21:23:52+08:00" />
<meta property="article:modified_time" content="2023-06-13T21:23:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程鬼谷子的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程鬼谷子的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ubuntu 20.04 aarch64 平台交叉编译 opencv 静态库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>编译环境</h3> 
<ul><li> <p>win10 64 位</p> </li><li> <p>VMware Workstation Pro 16 虚拟机</p> </li><li> <p>虚拟机安装 ubuntu 20.04</p> </li><li> <p>opencv 版本： 来自 github 当前最新 4.7</p> </li></ul> 
<h3><a id="_10"></a>目的</h3> 
<ul><li>交叉编译 opencv 生成静态库（.a），用于 嵌入式 aarch64 平台。</li></ul> 
<h3><a id="_14"></a>环境配置方法</h3> 
<ul><li>参考上一篇 <a href="https://blog.csdn.net/tcjy1000/article/details/131195531">ubuntu 20.04 aarch64 平台交叉编译 opencv</a></li></ul> 
<h3><a id="_18"></a>生成静态库</h3> 
<ul><li>默认会生成 动态库（so），可以通过cmake 配置 <code>-DBUILD_SHARED_LIBS=OFF</code> 关闭动态库生成，这样就可以生成静态库了</li></ul> 
<p><code>cmake -DCMAKE_TOOLCHAIN_FILE=../platforms/linux/aarch64-musl.toolchain.cmake .. -DCMAKE_CXX_FLAGS="-march=armv8-a --static" -DCMAKE_C_FLAGS="-march=armv8-a --static" -DBUILD_SHARED_LIBS=OFF</code></p> 
<h3><a id="_24"></a>其他</h3> 
<ul><li> <p>如果感觉 cmake 的命令太长，可以把各个配置放进 <code>platforms/linux/aarch64-musl.toolchain.cmake</code> 里面，这样 cmake 命令就会很精简</p> </li><li> <p>打开 <code>vim platforms/linux/aarch64-musl.toolchain.cmake</code>，然后进行各个特性或者第三方库的开关配置</p> </li></ul> 
<p><img src="https://images2.imgbox.com/4b/58/K8UH0ODc_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token function">set</span><span class="token punctuation">(</span>CMAKE_SYSTEM_PROCESSOR aarch64<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>GCC_COMPILER_VERSION <span class="token string">""</span> CACHE STRING <span class="token string">"GCC Compiler version"</span><span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>GNU_MACHINE <span class="token string">"aarch64-linux-musleabi"</span> CACHE STRING <span class="token string">"GNU compiler triple"</span><span class="token punctuation">)</span>

<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_BUILD_TYPE <span class="token string">"Release"</span><span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>WITH_CAROTENE OFF<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>WITH_ITT OFF<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>WITH_OPENCL OFF<span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>WITH_ADE OFF<span class="token punctuation">)</span>

<span class="token function">include</span><span class="token punctuation">(</span><span class="token string">"${CMAKE_CURRENT_LIST_DIR}/arm.toolchain.cmake"</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li> <p><code>set(CMAKE_BUILD_TYPE "Release")</code> 编译 Release 版本</p> </li><li> <p><code>set(WITH_ITT OFF)</code> 关闭了 itt 相关</p> </li><li> <p><code>set(WITH_CAROTENE OFF)</code> 关闭了 第三方库 CAROTENE</p> </li><li> <p><code>set(WITH_OPENCL OFF)</code> 关闭了 OPENCL</p> </li><li> <p><code>set(WITH_ADE OFF)</code> 关闭 ADE</p> </li></ul> 
<h3><a id="_57"></a>编译</h3> 
<ul><li> <p>make，可以 make -j12 等多线程编译，大大加快编译速度，当然编译的电脑硬件配置要高一些，多核 大内存</p> </li><li> <p>make install，可以把生成的 opencv 库存放到 当前的目录 <code>build_a/install</code> 目录下，由于是交叉编译，所以需要额外注意 安装路径，不要安装到 系统的目录下。</p> </li></ul> 
<h3><a id="_64"></a>查看编译产物</h3> 
<ul><li>make 编译完成后，执行 <code>make install</code>，会存放到指定路径，默认不配做，会在当前的build路径下，如 <code>build_a/install</code> 目录</li></ul> 
<p><img src="https://images2.imgbox.com/95/95/5OtScovy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_70"></a>小结</h3> 
<ul><li> <p>可以配置 cmake，开关各个需要的选项，包括第三方库等</p> </li><li> <p>可以生成静态的 opencv 库，不过使用静态库，静态连接，这样应用程序体积会比较大</p> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dac44bc455ca0f12f316742b14d018ef/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue3对比vue2的总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/865ddcf7581b2cba31722df2afb90b2c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">大二下学期期末总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程鬼谷子的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>